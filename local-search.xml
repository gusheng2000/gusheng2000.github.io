<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ã€ç½‘ç»œç¼–ç¨‹ã€‘Netty å®ç°WebSocket æœåŠ¡</title>
    <link href="/2024/09/13/Java%E7%AC%94%E8%AE%B0/Netty%20%E5%AE%9E%E7%8E%B0WebSocket%20%E6%9C%8D%E5%8A%A1/"/>
    <url>/2024/09/13/Java%E7%AC%94%E8%AE%B0/Netty%20%E5%AE%9E%E7%8E%B0WebSocket%20%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1>Netty å®ç°WebSocket æœåŠ¡</h1><p>åœ¨ä½¿ç”¨ Netty å®ç° WebSocket æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å‡ ä¸ªå…³é”®æ­¥éª¤æ¥ç¡®ä¿æœåŠ¡çš„æ­£ç¡®è¿è¡Œå’Œä¼˜åŒ–æ€§èƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® Netty æœåŠ¡å™¨ï¼Œå¹¶é…ç½®ç›¸åº”çš„é€šé“åˆå§‹åŒ–å™¨æ¥å¤„ç† WebSocket è¯·æ±‚ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦å®ç° WebSocket å¤„ç†å™¨æ¥ç®¡ç†è¿æ¥ã€æ¶ˆæ¯å’Œå…³é—­äº‹ä»¶ã€‚</p><ol><li><strong>è®¾ç½® Netty æœåŠ¡å™¨</strong>ï¼šå¯åŠ¨ä¸€ä¸ª Netty æœåŠ¡å™¨ï¼Œç›‘å¬ç‰¹å®šç«¯å£å¹¶ç­‰å¾… WebSocket å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</li><li><strong>é…ç½®é€šé“åˆå§‹åŒ–å™¨</strong>ï¼šåœ¨é€šé“åˆå§‹åŒ–å™¨ä¸­æ·»åŠ å¿…è¦çš„å¤„ç†å™¨ï¼Œä¾‹å¦‚ <code>HttpServerCodec</code>ã€<code>HttpObjectAggregator</code> å’Œ <code>WebSocketServerProtocolHandler</code>ã€‚</li><li><strong>å®ç° WebSocket å¤„ç†å™¨</strong>ï¼šç¼–å†™è‡ªå®šä¹‰å¤„ç†å™¨æ¥å¤„ç† WebSocket çš„è¿æ¥ã€æ¶ˆæ¯å’Œæ–­å¼€äº‹ä»¶ã€‚ç¡®ä¿å¤„ç†å™¨èƒ½å¤Ÿå¤„ç†æ–‡æœ¬æ¶ˆæ¯ã€äºŒè¿›åˆ¶æ¶ˆæ¯ä»¥åŠå¿ƒè·³æ£€æµ‹ã€‚</li><li><strong>å®ç°WebSocketæ¡æ‰‹é‰´æƒ</strong>ï¼šå®é™…æƒ…å†µæœåŠ¡ç«¯éœ€è¦å¯¹å®¢æˆ·ç«¯çš„æ¡æ‰‹è¯·æ±‚è¿›è¡Œç›¸å…³åˆ¤æ–­ç­–ç•¥éªŒè¯ï¼Œé€šè¿‡æ‰å¯ä»¥è¿æ¥æˆåŠŸï¼Œä¸é€šè¿‡å°±è®¤ä¸ºæ˜¯éæ³•é“¾æ¥æ‹’ç»é“¾æ¥ã€‚</li></ol><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Netty æ­å»ºä¸€ä¸ªé«˜æ•ˆçš„ WebSocket æœåŠ¡ï¼Œæ”¯æŒå®æ—¶é€šä¿¡éœ€æ±‚ã€‚</p><p>åœ¨å·¥ä½œä¸­é€šå¸¸æ˜¯ä½¿ç”¨çš„æ˜¯å°†NettyæœåŠ¡å½“ä½œä¸€ä¸ªbeanäº¤ç»™äº†springç®¡ç†ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹æ•°æ®æ­å»ºè¿‡ç¨‹</p><h1>ä¸€ã€è®¾ç½®NettyæœåŠ¡å™¨</h1><p><strong>Menservants</strong> ç±»æ˜¯springçš„ä¸€ä¸ªbean åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå’Œé”€æ¯æ—¶è‡ªåŠ¨å¯¹WebSocketæœåŠ¡è¿›è¡Œå¯åŠ¨å’Œå…³é—­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CAgentServer</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(CAgentServer.class);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;server.cagent.listener.port&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">8888</span>;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CAgentServerInitializer serverInitializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> EventLoopGroup bossGroup;</span><br><span class="line"><span class="keyword">private</span> EventLoopGroup workerGroup;</span><br><span class="line"><span class="keyword">private</span> ChannelFuture channelFuture;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">log.info(<span class="string">&quot;Before run server&quot;</span>);</span><br><span class="line">bossGroup = <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">workerGroup = <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">512</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ServerBootstrap</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">b.group(bossGroup, workerGroup);</span><br><span class="line">b.channel(NioServerSocketChannel.class);</span><br><span class="line"><span class="comment">// b.channel(OioServerSocketChannel.class);</span></span><br><span class="line">b.childHandler(serverInitializer);</span><br><span class="line">b.option(ChannelOption.SO_BACKLOG, <span class="number">128</span>);</span><br><span class="line">b.childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>);</span><br><span class="line">channelFuture = b.bind(port).sync();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PreDestroy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destory</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">channelFuture.channel().close().sync();</span><br><span class="line">log.info(<span class="string">&quot;after stop server&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">workerGroup.shutdownGracefully();</span><br><span class="line">bossGroup.shutdownGracefully();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†ä»£ç åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆå˜åŒ– ï¼Œ<code>b.childHandler(serverInitializer);</code>è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ªé€šé“åˆå§‹åŒ–å™¨ï¼Œè¿™é‡ŒåŒ…å«äº†æˆ‘ä»¬å¯¹é€šé“çš„æ‰€æœ‰å¤„ç†é€»è¾‘ã€‚</p><h1>äºŒã€é…ç½®é€šé“åˆå§‹åŒ–å™¨</h1><p><strong>ChannelInitializer</strong> ç±»ç”¨äºè®¾ç½® Netty å¤„ç†ç®¡é“ï¼ŒåŒ…æ‹¬å¤„ç† HTTP è¯·æ±‚å’Œ WebSocket åè®®çš„å¤„ç†å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CAgentServerInitializer</span> <span class="keyword">extends</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(CAgentServerInitializer.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ  HTTP æœåŠ¡ç«¯ç¼–è§£ç å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>());</span><br><span class="line">        <span class="comment">// æ·»åŠ  HTTP å¯¹è±¡èšåˆå™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">65536</span>));</span><br><span class="line">        <span class="comment">// æ·»åŠ  WebSocket åè®®å¤„ç†å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandler</span>(<span class="string">&quot;/ws&quot;</span>));</span><br><span class="line">        <span class="comment">// æ·»åŠ è‡ªå®šä¹‰çš„ WebSocket å¤„ç†å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">CAgentWebSocketHandler</span>());</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;WebSocket channel initialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ Netty æœåŠ¡å™¨èƒ½å¤Ÿæ­£ç¡®å¤„ç† WebSocket è¯·æ±‚ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¿…è¦çš„æƒ…å†µä¸‹è¿›è¡Œæ¡æ‰‹é‰´æƒã€‚</p><h1>ä¸‰ã€è‡ªå®šä¹‰ WebSocket å¤„ç†å™¨</h1><p>è‡ªå®šä¹‰çš„ WebSocket å¤„ç†å™¨ <code>CAgentWebSocketHandler</code> ç”¨äºå¤„ç†è¿æ¥æˆåŠŸäº‹ä»¶ã€æ¶ˆæ¯äº‹ä»¶å’Œæ–­å¼€äº‹ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CAgentWebSocketHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;TextWebSocketFrame&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(CAgentWebSocketHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Client connected: &#123;&#125;&quot;</span>, ctx.channel().id().asLongText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerRemoved</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Client disconnected: &#123;&#125;&quot;</span>, ctx.channel().id().asLongText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, TextWebSocketFrame msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">request</span> <span class="operator">=</span> msg.text();</span><br><span class="line">        log.info(<span class="string">&quot;Received message: &#123;&#125;&quot;</span>, request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤„ç†æ¶ˆæ¯ï¼Œå“åº”ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">        ctx.channel().writeAndFlush(<span class="keyword">new</span> <span class="title class_">TextWebSocketFrame</span>(<span class="string">&quot;Server received your message: &quot;</span> + request));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Error occurred: &quot;</span>, cause);</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå¤„ç†å™¨ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä»¥ä¸‹æ–¹æ³•ï¼š</p><ol><li><code>handlerAdded(ChannelHandlerContext ctx)</code>ï¼šå½“å®¢æˆ·ç«¯æˆåŠŸè¿æ¥æ—¶è°ƒç”¨ã€‚</li><li><code>handlerRemoved(ChannelHandlerContext ctx)</code>ï¼šå½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶è°ƒç”¨ã€‚</li><li><code>channelRead0(ChannelHandlerContext ctx, TextWebSocketFrame msg)</code>ï¼šå½“æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯æ—¶è°ƒç”¨ã€‚</li><li><code>exceptionCaught(ChannelHandlerContext ctx, Throwable cause)</code>ï¼šå½“å‘ç”Ÿå¼‚å¸¸æ—¶è°ƒç”¨ï¼Œè®°å½•é”™è¯¯å¹¶å…³é—­è¿æ¥ã€‚</li></ol><h2 id="3-1-ChannelHandlerçš„ç”Ÿå‘½å‘¨æœŸä¸äº‹ä»¶å¤„ç†æœºåˆ¶">3.1 <strong>ChannelHandlerçš„ç”Ÿå‘½å‘¨æœŸä¸äº‹ä»¶å¤„ç†æœºåˆ¶</strong></h2><p><img src="Netty%20%E5%AE%9E%E7%8E%B0WebSocket%20%E6%9C%8D%E5%8A%A1%20657c76b554e648f6aadfc6c919ca1493/Untitled.png" alt="Untitled"></p><h3 id="æ¦‚è¿°"><strong>æ¦‚è¿°</strong></h3><p>Nettyçš„<code>ChannelHandler</code>æ˜¯å¤„ç†ç½‘ç»œäº‹ä»¶ï¼ˆå¦‚æ•°æ®è¯»å–ã€æ•°æ®å†™å…¥ã€è¿æ¥å»ºç«‹ã€è¿æ¥å…³é—­ç­‰ï¼‰çš„æ ¸å¿ƒç»„ä»¶ã€‚</p><p>åœ¨Nettyä¸­ï¼Œ<code>ChannelHandler</code>çš„ç”Ÿå‘½å‘¨æœŸä¸<code>Channel</code>çš„çŠ¶æ€ç´§å¯†ç›¸å…³ï¼Œä¸»è¦æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong>:<ul><li><code>handlerAdded</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨<code>ChannelPipeline</code>åˆå§‹åŒ–æ—¶ï¼Œè¡¨ç¤ºä¸€ä¸ªæ–°çš„<code>ChannelHandler</code>è¢«åŠ å…¥åˆ°<code>ChannelPipeline</code>ä¸­ã€‚</li></ul></li><li><strong>æ³¨å†Œï¼ˆRegistrationï¼‰</strong>:<ul><li><code>channelRegistered</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¿™è¡¨ç¤º<code>Channel</code>å·²ç»æˆåŠŸæ³¨å†Œåˆ°å®ƒçš„<code>EventLoop</code>ä¸Šã€‚</li></ul></li><li><strong>æ¿€æ´»ï¼ˆActivationï¼‰</strong>:<ul><li><code>channelActive</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¡¨ç¤º<code>Channel</code>å·²ç»æˆåŠŸæ¿€æ´»ï¼Œå¯ä»¥å¼€å§‹æ¥æ”¶å’Œå‘é€æ•°æ®ã€‚</li></ul></li><li><strong>è¯»å–æ•°æ®ï¼ˆReadï¼‰</strong>:<ul><li><code>channelRead</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¿™è¡¨ç¤ºä»<code>Channel</code>ä¸­è¯»å–åˆ°äº†æ•°æ®ã€‚</li></ul></li><li><strong>è¯»å®Œæˆï¼ˆRead Completeï¼‰</strong>:<ul><li><code>channelReadComplete</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¿™è¡¨ç¤ºä¸€æ¬¡è¯»å–æ“ä½œå®Œæˆã€‚</li></ul></li><li><strong>å…³é—­ï¼ˆDeactivationï¼‰</strong>:<ul><li><code>channelInactive</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¡¨ç¤º<code>Channel</code>ä¸è¿œç«¯ä¸»æœºå¤±å»äº†è¿æ¥ï¼Œå˜æˆäº†éæ¿€æ´»çŠ¶æ€ã€‚</li></ul></li><li><strong>æ³¨é”€ï¼ˆDeregistrationï¼‰</strong>:<ul><li><code>channelUnregistered</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¡¨ç¤º<code>Channel</code>ä»å®ƒçš„<code>EventLoop</code>ä¸Šæ³¨é”€ã€‚</li></ul></li><li><strong>ç§»é™¤ï¼ˆRemovalï¼‰</strong>:<ul><li><code>handlerRemoved</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¡¨ç¤º<code>ChannelHandler</code>è¢«ä»<code>ChannelPipeline</code>ä¸­ç§»é™¤ã€‚</li></ul></li></ol><p>è¿™äº›æ–¹æ³•çš„è°ƒç”¨é¡ºåºä¸<code>Channel</code>çš„çŠ¶æ€è½¬æ¢é¡ºåºç›¸å¯¹åº”ï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ ¹æ®ä¸åŒçš„éœ€æ±‚ï¼Œå¼€å‘è€…å¯ä»¥é‡å†™è¿™äº›æ–¹æ³•æ¥å®ç°è‡ªå®šä¹‰çš„é€»è¾‘å¤„ç†ï¼Œæ¯”å¦‚å¤„ç†è¶…æ—¶ã€å¿ƒè·³ä¿æ´»ã€æ•°æ®ç¼–è§£ç ç­‰ã€‚</p><aside>ğŸ’¡ å¸¸è§ç”¨æ³•<p>handlerAdded() ä¸ handlerRemoved()å¯ä»¥ç”¨åœ¨ä¸€äº›èµ„æºçš„ç”³è¯·å’Œé‡Šæ”¾<br>channelActive() ä¸ channelInActive()å¯ä»¥ç»Ÿè®¡å•æœºçš„è¿æ¥æ•°ï¼ŒchannelActive() è¢«è°ƒç”¨ï¼Œè¿æ¥æ•°åŠ ä¸€ï¼ŒchannelInActive() è¢«è°ƒç”¨ï¼Œè¿æ¥æ•°å‡ä¸€ã€‚channelActive() è¿˜å¯ä»¥å®ç°ipé»‘ç™½åå•çš„è¿‡æ»¤</p><p>channelRead()ç”¨æ¥æ‹†åŒ…è¯»å–ä¿¡æ¯</p><p>channelReadComplete()å®ç°æ‰¹é‡åˆ·æ–°çš„æœºåˆ¶ï¼Œè¿™æ ·channelRead()ä¸­åªä½¿ç”¨write() æ–¹æ³•è€Œä¸ç”¨writeAndFlush()æ¯æ¬¡éƒ½åˆ·æ–°å†™å…¥åˆ°ç¼“å­˜ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p></aside><p><strong>ç”Ÿå‘½å‘¨æœŸHandler Dem</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.artisan.reconnect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  handlerçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ¥å£è°ƒç”¨é¡ºåº:</span></span><br><span class="line"><span class="comment"> *  handlerAdded -&gt; channelRegistered -&gt; channelActive -&gt; channelRead -&gt; channelReadComplete</span></span><br><span class="line"><span class="comment"> *  -&gt; channelInactive -&gt; channelUnRegistered -&gt; handlerRemoved</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * handlerAdded: æ–°å»ºç«‹çš„è¿æ¥ä¼šæŒ‰ç…§åˆå§‹åŒ–ç­–ç•¥ï¼ŒæŠŠhandleræ·»åŠ åˆ°è¯¥channelçš„pipelineé‡Œé¢ï¼Œä¹Ÿå°±æ˜¯channel.pipeline.addLast(new LifeCycleInBoundHandler)æ‰§è¡Œå®Œæˆåçš„å›è°ƒï¼›</span></span><br><span class="line"><span class="comment"> * channelRegistered: å½“è¯¥è¿æ¥åˆ†é…åˆ°å…·ä½“çš„workerçº¿ç¨‹åï¼Œè¯¥å›è°ƒä¼šè¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * channelActiveï¼šchannelçš„å‡†å¤‡å·¥ä½œå·²ç»å®Œæˆï¼Œæ‰€æœ‰çš„pipelineæ·»åŠ å®Œæˆï¼Œå¹¶åˆ†é…åˆ°å…·ä½“çš„çº¿ä¸Šä¸Šï¼Œè¯´æ˜è¯¥channelå‡†å¤‡å°±ç»ªï¼Œå¯ä»¥ä½¿ç”¨äº†ã€‚</span></span><br><span class="line"><span class="comment"> * channelReadï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘æ¥æ•°æ®ï¼Œæ¯æ¬¡éƒ½ä¼šå›è°ƒæ­¤æ–¹æ³•ï¼Œè¡¨ç¤ºæœ‰æ•°æ®å¯è¯»ï¼›</span></span><br><span class="line"><span class="comment"> * channelReadCompleteï¼šæœåŠ¡ç«¯æ¯æ¬¡è¯»å®Œä¸€æ¬¡å®Œæ•´çš„æ•°æ®ä¹‹åï¼Œå›è°ƒè¯¥æ–¹æ³•ï¼Œè¡¨ç¤ºæ•°æ®è¯»å–å®Œæ¯•ï¼›</span></span><br><span class="line"><span class="comment"> * channelInactiveï¼šå½“è¿æ¥æ–­å¼€æ—¶ï¼Œè¯¥å›è°ƒä¼šè¢«è°ƒç”¨ï¼Œè¯´æ˜è¿™æ—¶å€™åº•å±‚çš„TCPè¿æ¥å·²ç»è¢«æ–­å¼€äº†ã€‚</span></span><br><span class="line"><span class="comment"> * channelUnRegistered: å¯¹åº”channelRegisteredï¼Œå½“è¿æ¥å…³é—­åï¼Œé‡Šæ”¾ç»‘å®šçš„workderçº¿ç¨‹ï¼›</span></span><br><span class="line"><span class="comment"> * handlerRemovedï¼š å¯¹åº”handlerAddedï¼Œå°†handlerä»è¯¥channelçš„pipelineç§»é™¤åçš„å›è°ƒæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LifeCycleInBoundHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRegistered</span><span class="params">(ChannelHandlerContext ctx)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;channelRegistered: channelæ³¨å†Œåˆ°NioEventLoop&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.channelRegistered(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelUnregistered</span><span class="params">(ChannelHandlerContext ctx)</span> </span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;channelUnregistered: channelå–æ¶ˆå’ŒNioEventLoopçš„ç»‘å®š&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.channelUnregistered(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> </span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;channelActive: channelå‡†å¤‡å°±ç»ª&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.channelActive(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> </span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;channelInactive: channelè¢«å…³é—­&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.channelInactive(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> </span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;channelRead: channelä¸­æœ‰å¯è¯»çš„æ•°æ®&quot;</span> );</span><br><span class="line">        <span class="built_in">super</span>.channelRead(ctx, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> </span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;channelReadComplete: channelè¯»æ•°æ®å®Œæˆ&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.channelReadComplete(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> </span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;handlerAdded: handlerè¢«æ·»åŠ åˆ°channelçš„pipeline&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.handlerAdded(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerRemoved</span><span class="params">(ChannelHandlerContext ctx)</span> </span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;handlerRemoved: handlerä»channelçš„pipelineä¸­ç§»é™¤&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.handlerRemoved(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å››ã€å¿ƒè·³è¶…æ—¶å‰”é™¤</h1><p>ä¸ºäº†ç¡®ä¿ WebSocket è¿æ¥çš„ç¨³å®šæ€§å’ŒåŠæ—¶é‡Šæ”¾èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ä¸­å®ç°å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œå¹¶åœ¨è¿æ¥è¶…æ—¶æ—¶å‰”é™¤ä¸æ´»è·ƒçš„è¿æ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®ç°å¿ƒè·³æ£€æµ‹çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CAgentServerInitializer</span> <span class="keyword">extends</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(CAgentServerInitializer.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ  HTTP æœåŠ¡ç«¯ç¼–è§£ç å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>());</span><br><span class="line">        <span class="comment">// æ·»åŠ  HTTP å¯¹è±¡èšåˆå™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">65536</span>));</span><br><span class="line">        <span class="comment">// æ·»åŠ  WebSocket åè®®å¤„ç†å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandler</span>(<span class="string">&quot;/ws&quot;</span>));</span><br><span class="line">        <span class="comment">// æ·»åŠ å¿ƒè·³æ£€æµ‹å¤„ç†å™¨ï¼ˆå¦‚æœè¶…è¿‡60ç§’æ²¡æœ‰æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…ï¼Œåˆ™å…³é—­è¿æ¥ï¼‰</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">60</span>, <span class="number">0</span>, <span class="number">0</span>, TimeUnit.SECONDS));</span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HeartbeatHandler</span>());</span><br><span class="line">        <span class="comment">// æ·»åŠ è‡ªå®šä¹‰çš„ WebSocket å¤„ç†å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">CAgentWebSocketHandler</span>());</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;WebSocket channel initialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeartbeatHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(HeartbeatHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> IdleStateEvent) &#123;</span><br><span class="line">            <span class="type">IdleStateEvent</span> <span class="variable">event</span> <span class="operator">=</span> (IdleStateEvent) evt;</span><br><span class="line">            <span class="keyword">if</span> (event.state() == IdleState.READER_IDLE) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;No heartbeat received from client, closing connection: &#123;&#125;&quot;</span>, ctx.channel().id().asLongText());</span><br><span class="line">                ctx.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.userEventTriggered(ctx, evt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨æ­¤å®ç°ä¸­ï¼Œæˆ‘ä»¬åœ¨ <code>CAgentServerInitializer</code> ä¸­æ·»åŠ äº† <code>IdleStateHandler</code> å’Œ <code>HeartbeatHandler</code> ä¸¤ä¸ªå¤„ç†å™¨ï¼š</p><ol><li><code>IdleStateHandler</code>ï¼šç”¨äºæ£€æµ‹è¿æ¥çš„ç©ºé—²çŠ¶æ€ã€‚å¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼ˆå¦‚60ç§’ï¼‰æ²¡æœ‰æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼Œè¯¥å¤„ç†å™¨ä¼šè§¦å‘ <code>IdleStateEvent</code> äº‹ä»¶ã€‚</li><li><code>HeartbeatHandler</code>ï¼šç»§æ‰¿è‡ª <code>ChannelInboundHandlerAdapter</code>ï¼Œç”¨äºå¤„ç† <code>IdleStateEvent</code> äº‹ä»¶ã€‚å¦‚æœæ£€æµ‹åˆ°è¯»å–ç©ºé—²çŠ¶æ€ï¼ˆå³è¶…è¿‡æŒ‡å®šæ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…ï¼‰ï¼Œåˆ™å…³é—­è¯¥è¿æ¥ã€‚</li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ WebSocket æœåŠ¡èƒ½å¤ŸåŠæ—¶å‰”é™¤ä¸æ´»è·ƒçš„è¿æ¥ï¼Œä¿æŒè¿æ¥çš„å¥åº·çŠ¶æ€ã€‚</p><hr><h2 id="å¦å¤–ä¸€ç§æ“ä½œ-é˜…è¯»ä¸‹æºç ">å¦å¤–ä¸€ç§æ“ä½œ,é˜…è¯»ä¸‹æºç </h2><p><code>IdleStateHandler</code> å†…æœ‰ä¸‰ä¸ªå†…éƒ¨ç±», <code>ReaderIdleTimeoutTask</code>,<code>WriterIdleTimeoutTask ,AllIdleTimeoutTask</code> é‡Œé¢éƒ½ä¼šè°ƒç”¨  channelIdle æ–¹æ³•  ä¹Ÿå°±æ˜¯å‡ºç°è¶…æ—¶äº‹ä»¶æ—¶ éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</p><p><img src="Netty%20%E5%AE%9E%E7%8E%B0WebSocket%20%E6%9C%8D%E5%8A%A1%20657c76b554e648f6aadfc6c919ca1493/Untitled%201.png" alt="Untitled"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Is called when an &#123;<span class="doctag">@link</span> IdleStateEvent&#125; should be fired. This implementation calls</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ChannelHandlerContext#fireUserEventTriggered(Object)&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelIdle</span><span class="params">(ChannelHandlerContext ctx, IdleStateEvent evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    ctx.fireUserEventTriggered(evt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°è¶…æ—¶ç›´æ¥å…³é—­channel å…¶å®ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªç±»ç»§æ‰¿ <code>IdleStateHandler</code> ç›´æ¥é‡å†™ <code>channelIdle</code> ç„¶ååŠ å…¥åˆ¤æ–­pipelineå†…,é€»è¾‘å°±æ˜¯å¯¹åº”çš„äº‹ä»¶å¤„ç†,è¿™æ ·ä¹Ÿå¯ä»¥åšåˆ°,è€Œä¸”æ–¹æ³•çš„å‚æ•°å°±æ˜¯IdleStateEvent  ä¸ç”¨åˆ¤æ–­ç±»å‹,ä¹Ÿç®—æ˜¯ä¸€ä¸ªéªšæ“ä½œå§ ä¸è¿‡è¿™æ ·ä¸æ˜¯å®˜æ–¹è®¾è®¡çš„ç”¨æ³•ã€‚å®˜æ–¹æ¨èç¬¬ä¸€ç§ç”¨æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelIdle</span><span class="params">(ChannelHandlerContext ctx, IdleStateEvent evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (evt.state() == IdleState.READER_IDLE) &#123;</span><br><span class="line">      log.warn(<span class="string">&quot;no data received after 60s, channel=&quot;</span> + ctx.channel().remoteAddress().toString()</span><br><span class="line">          + <span class="string">&quot; will close&quot;</span>);</span><br><span class="line">      ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">* &lt;pre&gt;</span><br><span class="line">* <span class="comment">// An example that sends a ping message when there is no outbound traffic</span></span><br><span class="line">* <span class="comment">// for 30 seconds.  The connection is closed when there is no inbound traffic</span></span><br><span class="line">* <span class="comment">// for 60 seconds.</span></span><br><span class="line">*</span><br><span class="line">* <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyChannelInitializer</span> extends &#123;<span class="meta">@link</span> ChannelInitializer&#125;&amp;lt;&#123;<span class="meta">@link</span> Channel&#125;&amp;gt; &#123;</span><br><span class="line">*     &#123;<span class="meta">@code</span> <span class="meta">@Override</span>&#125;</span><br><span class="line">*     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(&#123;<span class="meta">@link</span> Channel&#125; channel)</span> &#123;</span><br><span class="line">*         channel.pipeline().addLast(<span class="string">&quot;idleStateHandler&quot;</span>, <span class="keyword">new</span> &#123;<span class="meta">@link</span> IdleStateHandler&#125;(<span class="number">60</span>, <span class="number">30</span>, <span class="number">0</span>));</span><br><span class="line">*         channel.pipeline().addLast(<span class="string">&quot;myHandler&quot;</span>, <span class="keyword">new</span> <span class="title class_">MyHandler</span>());</span><br><span class="line">*     &#125;</span><br><span class="line">* &#125;</span><br><span class="line">*</span><br><span class="line">* <span class="comment">// Handler should handle the &#123;@link IdleStateEvent&#125; triggered by &#123;@link IdleStateHandler&#125;.</span></span><br><span class="line">* <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHandler</span> extends &#123;<span class="meta">@link</span> ChannelDuplexHandler&#125; &#123;</span><br><span class="line">*     &#123;<span class="meta">@code</span> <span class="meta">@Override</span>&#125;</span><br><span class="line">*     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userEventTriggered</span><span class="params">(&#123;<span class="meta">@link</span> ChannelHandlerContext&#125; ctx, &#123;<span class="meta">@link</span> Object&#125; evt)</span> <span class="keyword">throws</span> &#123;<span class="meta">@link</span> Exception&#125; &#123;</span><br><span class="line">*         <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> &#123;<span class="meta">@link</span> IdleStateEvent&#125;) &#123;</span><br><span class="line">*             &#123;<span class="meta">@link</span> IdleStateEvent&#125; e = (&#123;<span class="meta">@link</span> IdleStateEvent&#125;) evt;</span><br><span class="line">*             <span class="keyword">if</span> (e.state() == &#123;<span class="meta">@link</span> IdleState&#125;.READER_IDLE) &#123;</span><br><span class="line">*                 ctx.close();</span><br><span class="line">*             &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.state() == &#123;<span class="meta">@link</span> IdleState&#125;.WRITER_IDLE) &#123;</span><br><span class="line">*                 ctx.writeAndFlush(<span class="keyword">new</span> <span class="title class_">PingMessage</span>());</span><br><span class="line">*             &#125;</span><br><span class="line">*         &#125;</span><br><span class="line">*     &#125;</span><br><span class="line">* &#125;</span><br></pre></td></tr></table></figure><p><strong>ç›¸å…³é“¾æ¥</strong></p><p><a href="https://blog.csdn.net/weixin_43935927/article/details/112001309">https://blog.csdn.net/weixin_43935927/article/details/112001309</a></p><p><a href="https://blog.csdn.net/m0_60259116/article/details/137680824">https://blog.csdn.net/m0_60259116/article/details/137680824</a></p><p><a href="https://blog.csdn.net/RisenMyth/article/details/104441155">https://blog.csdn.net/RisenMyth/article/details/104441155</a></p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nettyå­¦ä¹ ç¬”è®°</title>
    <link href="/2024/07/31/Java%E7%AC%94%E8%AE%B0/Netty%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C/"/>
    <url>/2024/07/31/Java%E7%AC%94%E8%AE%B0/Netty%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h1>Nettyå­¦ä¹ æ‰‹å†Œ</h1><p>Netty æ˜¯ä¸€ä¸ªåŸºäº Java çš„é«˜æ€§èƒ½ç½‘ç»œå¼€å‘æ¡†æ¶ï¼Œä¸“é—¨ç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜å¹¶å‘ç½‘ç»œåº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶å’Œå·¥å…·ï¼Œæ”¯æŒå¤šç§åè®®ï¼ˆå¦‚ HTTPã€TCPã€UDP ç­‰ï¼‰ï¼Œå¹¶ä¸”å…·æœ‰é«˜åº¦çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚Netty é€šè¿‡å…¶é«˜æ•ˆçš„çº¿ç¨‹æ¨¡å‹å’Œä¸°å¯Œçš„åŠŸèƒ½é›†ï¼Œç®€åŒ–äº†ç½‘ç»œç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p><p><strong>å®ç”¨å·¥å…·ç½‘ç«™</strong></p><ul><li><a href="https://waylau.gitbooks.io/netty-4-user-guide/content/">https://waylau.gitbooks.io/netty-4-user-guide/content/</a> â­</li><li><a href="https://github.com/waylau/netty-4-user-guide-demos">https://github.com/waylau/netty-4-user-guide-demos</a> Nettyå„ç§å¼€å‘Demo</li><li><a href="https://www.gitbook.com/?utm_source=legacy&amp;utm_medium=redirect&amp;utm_campaign=close_legacy">https://www.gitbook.com/?utm_source=legacy&amp;utm_medium=redirect&amp;utm_campaign=close_legacy</a>    Product documentation your users will love</li><li><a href="https://dongzl.github.io/netty-handbook/#/">https://dongzl.github.io/netty-handbook/#/</a></li></ul><h1>ç›®å½•</h1><h1>ç¬¬ 1 ç«  Netty ä»‹ç»å’Œåº”ç”¨åœºæ™¯</h1><h2 id="1-1-æœ¬è¯¾ç¨‹å­¦ä¹ è¦æ±‚"><strong>1.1 æœ¬è¯¾ç¨‹å­¦ä¹ è¦æ±‚</strong></h2><ol><li>æœ¬è¯¾ç¨‹ä¸é€‚ç”¨äºÂ <code>0</code>Â åŸºç¡€çš„å­¦å‘˜ã€‚</li><li>è¦æ±‚å·²ç»æŒæ¡äº†Â <code>Java</code>Â ç¼–ç¨‹ï¼Œä¸»è¦æŠ€æœ¯æ„æˆï¼š<code>Java OOP</code>Â ç¼–ç¨‹ã€<code>Java</code>Â å¤šçº¿ç¨‹ç¼–ç¨‹ã€<code>Java IO</code>Â ç¼–ç¨‹ã€<code>Java</code>Â ç½‘ç»œç¼–ç¨‹ã€å¸¸ç”¨çš„Â <code>Java</code>Â è®¾è®¡æ¨¡å¼ï¼ˆæ¯”å¦‚è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå‘½ä»¤æ¨¡å¼ï¼ŒèŒè´£é“¾æ¨¡å¼ï¼‰ã€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚é“¾è¡¨ï¼‰ã€‚</li><li>æœ¬è¯¾ç¨‹çš„ã€Š<code>Netty</code>Â æ ¸å¿ƒæºç å‰–æç« èŠ‚ã€‹è¦æ±‚å­¦å‘˜æœ€å¥½æœ‰é¡¹ç›®å¼€å‘å’Œé˜…è¯»æºç çš„ç»å†ã€‚</li></ol><h2 id="1-2-Netty-çš„ä»‹ç»"><strong>1.2 Netty çš„ä»‹ç»</strong></h2><ol><li><code>Netty</code>Â æ˜¯ç”±Â <code>JBOSS</code>Â æä¾›çš„ä¸€ä¸ªÂ <code>Java</code>Â å¼€æºæ¡†æ¶ï¼Œç°ä¸ºÂ <code>Github</code>Â ä¸Šçš„ç‹¬ç«‹é¡¹ç›®ã€‚</li><li><code>Netty</code>Â æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨ä»¥å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç½‘ç»œÂ <code>IO</code>Â ç¨‹åºã€‚</li><li><code>Netty</code>Â ä¸»è¦é’ˆå¯¹åœ¨Â <code>TCP</code>Â åè®®ä¸‹ï¼Œé¢å‘Â <code>Client</code>Â ç«¯çš„é«˜å¹¶å‘åº”ç”¨ï¼Œæˆ–è€…Â <code>Peer-to-Peer</code>Â åœºæ™¯ä¸‹çš„å¤§é‡æ•°æ®æŒç»­ä¼ è¾“çš„åº”ç”¨ã€‚</li><li><code>Netty</code>Â æœ¬è´¨æ˜¯ä¸€ä¸ªÂ <code>NIO</code>Â æ¡†æ¶ï¼Œé€‚ç”¨äºæœåŠ¡å™¨é€šè®¯ç›¸å…³çš„å¤šç§åº”ç”¨åœºæ™¯ã€‚</li><li>è¦é€å½»ç†è§£Â <code>Netty</code>ï¼Œéœ€è¦å…ˆå­¦ä¹ Â <code>NIO</code>ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½é˜…è¯»Â <code>Netty</code>Â çš„æºç ã€‚</li></ol><h2 id="1-3-Netty-çš„åº”ç”¨åœºæ™¯"><strong>1.3 Netty çš„åº”ç”¨åœºæ™¯</strong></h2><h3 id="1-3-1-äº’è”ç½‘è¡Œä¸š"><strong>1.3.1 äº’è”ç½‘è¡Œä¸š</strong></h3><ol><li>äº’è”ç½‘è¡Œä¸šï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¹‹é—´éœ€è¦è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œé«˜æ€§èƒ½çš„Â <code>RPC</code>Â æ¡†æ¶å¿…ä¸å¯å°‘ï¼Œ<code>Netty</code>Â ä½œä¸ºå¼‚æ­¥é«˜æ€§èƒ½çš„é€šä¿¡æ¡†æ¶ï¼Œå¾€å¾€ä½œä¸ºåŸºç¡€é€šä¿¡ç»„ä»¶è¢«è¿™äº›Â <code>RPC</code>Â æ¡†æ¶ä½¿ç”¨ã€‚</li><li>å…¸å‹çš„åº”ç”¨æœ‰ï¼šé˜¿é‡Œåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶Â <code>Dubbo</code>Â çš„Â <code>RPC</code>Â æ¡† æ¶ä½¿ç”¨Â <code>Dubbo</code>Â åè®®è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡ï¼Œ<code>Dubbo</code>Â åè®®é»˜è®¤ä½¿ç”¨Â <code>Netty</code>Â ä½œä¸ºåŸºç¡€é€šä¿¡ç»„ä»¶ï¼Œç”¨äºå®ç°å„è¿›ç¨‹èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡ã€‚</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter01/chapter01_01.png" alt="1-1"></p><h3 id="1-3-2-æ¸¸æˆè¡Œä¸š"><strong>1.3.2 æ¸¸æˆè¡Œä¸š</strong></h3><ol><li>æ— è®ºæ˜¯æ‰‹æ¸¸æœåŠ¡ç«¯è¿˜æ˜¯å¤§å‹çš„ç½‘ç»œæ¸¸æˆï¼Œ<code>Java</code>Â è¯­è¨€å¾—åˆ°äº†è¶Šæ¥è¶Šå¹¿æ³›çš„åº”ç”¨ã€‚</li><li><code>Netty</code>Â ä½œä¸ºé«˜æ€§èƒ½çš„åŸºç¡€é€šä¿¡ç»„ä»¶ï¼Œæä¾›äº†Â <code>TCP/UDP</code>Â å’ŒÂ <code>HTTP</code>Â åè®®æ ˆï¼Œæ–¹ä¾¿å®šåˆ¶å’Œå¼€å‘ç§æœ‰åè®®æ ˆï¼Œè´¦å·ç™»å½•æœåŠ¡å™¨ã€‚</li><li>åœ°å›¾æœåŠ¡å™¨ä¹‹é—´å¯ä»¥æ–¹ä¾¿çš„é€šè¿‡Â <code>Netty</code>Â è¿›è¡Œé«˜æ€§èƒ½çš„é€šä¿¡ã€‚</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter01/chapter01_02.png" alt="01_02.png"></p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter01/chapter01_03.png" alt="01_03.png"></p><h3 id="1-3-3-å¤§æ•°æ®é¢†åŸŸ"><strong>1.3.3 å¤§æ•°æ®é¢†åŸŸ</strong></h3><ol><li>ç»å…¸çš„Â <code>Hadoop</code>Â çš„é«˜æ€§èƒ½é€šä¿¡å’Œåºåˆ—åŒ–ç»„ä»¶Â <code>Avro</code>Â çš„Â <code>RPC</code>Â æ¡†æ¶ï¼Œé»˜è®¤é‡‡ç”¨Â <code>Netty</code>Â è¿›è¡Œè·¨ç•Œç‚¹é€šä¿¡ã€‚</li><li>å®ƒçš„Â <code>NettyService</code>Â åŸºäºÂ <code>Netty</code>Â æ¡†æ¶äºŒæ¬¡å°è£…å®ç°ã€‚</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter01/chapter01_04.png" alt="01_04.png"></p><h3 id="1-3-4-å…¶å®ƒå¼€æºé¡¹ç›®ä½¿ç”¨åˆ°-Netty"><strong>1.3.4 å…¶å®ƒå¼€æºé¡¹ç›®ä½¿ç”¨åˆ° Netty</strong></h3><p>ç½‘å€ï¼š<a href="https://netty.io/wiki/related-projects.html"><strong>https://netty.io/wiki/related-projects.html</strong></a></p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter01/chapter01_05.png" alt="01_05.png"></p><h2 id="1-4-Netty-çš„å­¦ä¹ èµ„æ–™å‚è€ƒ"><strong>1.4 Netty çš„å­¦ä¹ èµ„æ–™å‚è€ƒ</strong></h2><p><img src="https://img11.360buyimg.com/n1/jfs/t1516/258/38352851/215555/68f629a5/555080b2Ne6cbf9e3.jpg" alt="https://img11.360buyimg.com/n1/jfs/t1516/258/38352851/215555/68f629a5/555080b2Ne6cbf9e3.jpg"></p><p><img src="https://img10.360buyimg.com/n1/jfs/t5227/173/1793618117/453810/1253bd90/59141c1dN7a93c127.jpg" alt="https://img10.360buyimg.com/n1/jfs/t5227/173/1793618117/453810/1253bd90/59141c1dN7a93c127.jpg"></p><h1>ç¬¬ 3 ç«  Java NIO ç¼–ç¨‹</h1><h2 id="3-1-Java-NIO-åŸºæœ¬ä»‹ç»"><strong>3.1 Java NIO åŸºæœ¬ä»‹ç»</strong></h2><ol><li><code>Java NIO</code>Â å…¨ç§°Â <strong><code>Java non-blocking IO</code></strong>Â ï¼Œæ˜¯æŒ‡Â <code>JDK</code>Â æä¾›çš„æ–°Â <code>API</code>ã€‚ä»Â <code>JDK1.4</code>Â å¼€å§‹ï¼Œ<code>Java</code>Â æä¾›äº†ä¸€ç³»åˆ—æ”¹è¿›çš„è¾“å…¥/è¾“å‡ºçš„æ–°ç‰¹æ€§ï¼Œè¢«ç»Ÿç§°ä¸ºÂ <code>NIO</code>ï¼ˆå³Â <code>NewIO</code>ï¼‰ï¼Œæ˜¯åŒæ­¥éé˜»å¡çš„ã€‚</li><li><code>NIO</code>Â ç›¸å…³ç±»éƒ½è¢«æ”¾åœ¨Â <strong><code>java.nio</code></strong>Â åŒ…åŠå­åŒ…ä¸‹ï¼Œå¹¶ä¸”å¯¹åŸÂ <code>java.io</code>Â åŒ…ä¸­çš„å¾ˆå¤šç±»è¿›è¡Œæ”¹å†™ã€‚ã€åŸºæœ¬æ¡ˆä¾‹ã€‘</li><li><code>NIO</code>Â æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†:Â <strong><code>Channel</code>ï¼ˆé€šé“ï¼‰ã€<code>Buffer</code>ï¼ˆç¼“å†²åŒºï¼‰ã€<code>Selector</code>ï¼ˆé€‰æ‹©å™¨ï¼‰</strong>Â ã€‚</li><li><code>NIO</code>Â æ˜¯<strong>é¢å‘ç¼“å†²åŒºï¼Œæˆ–è€…é¢å‘å—ç¼–ç¨‹</strong>çš„ã€‚æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºä¸­å‰åç§»åŠ¨ï¼Œè¿™å°±å¢åŠ äº†å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ï¼Œä½¿ç”¨å®ƒå¯ä»¥æä¾›éé˜»å¡å¼çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œã€‚</li><li><code>Java NIO</code>Â çš„éé˜»å¡æ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»æŸé€šé“å‘é€è¯·æ±‚æˆ–è€…è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šè·å–ï¼Œè€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡ï¼Œæ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…ã€‚éé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚ã€åé¢æœ‰æ¡ˆä¾‹è¯´æ˜ã€‘</li><li>é€šä¿—ç†è§£ï¼š<code>NIO</code>Â æ˜¯å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªæ“ä½œçš„ã€‚å‡è®¾æœ‰Â <code>10000</code>Â ä¸ªè¯·æ±‚è¿‡æ¥,æ ¹æ®å®é™…æƒ…å†µï¼Œå¯ä»¥åˆ†é…Â <code>50</code>Â æˆ–è€…Â <code>100</code>Â ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ä¸åƒä¹‹å‰çš„é˜»å¡Â <code>IO</code>Â é‚£æ ·ï¼Œéå¾—åˆ†é…Â <code>10000</code>Â ä¸ªã€‚</li><li><code>HTTP 2.0</code>Â ä½¿ç”¨äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ï¼Œåšåˆ°åŒä¸€ä¸ªè¿æ¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸”å¹¶å‘è¯·æ±‚çš„æ•°é‡æ¯”Â <code>HTTP 1.1</code>Â å¤§äº†å¥½å‡ ä¸ªæ•°é‡çº§ã€‚</li><li>æ¡ˆä¾‹è¯´æ˜Â <code>NIO</code>Â çš„Â <code>Buffer</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.IntBuffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicBuffer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸¾ä¾‹è¯´æ˜ Buffer çš„ä½¿ç”¨(ç®€å•è¯´æ˜)</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ª Bufferï¼Œå¤§å°ä¸º 5ï¼Œå³å¯ä»¥å­˜æ”¾ 5 ä¸ª int</span></span><br><span class="line">        <span class="type">IntBuffer</span> <span class="variable">intBuffer</span> <span class="operator">=</span> IntBuffer.allocate(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘bufferå­˜æ”¾æ•°æ®</span></span><br><span class="line">        <span class="comment">//intBuffer.put(10);</span></span><br><span class="line">        <span class="comment">//intBuffer.put(11);</span></span><br><span class="line">        <span class="comment">//intBuffer.put(12);</span></span><br><span class="line">        <span class="comment">//intBuffer.put(13);</span></span><br><span class="line">        <span class="comment">//intBuffer.put(14);</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; intBuffer.capacity(); i++) &#123;</span><br><span class="line">            intBuffer.put(i * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚ä½•ä» buffer è¯»å–æ•°æ®</span></span><br><span class="line">        <span class="comment">//å°† buffer è½¬æ¢ï¼Œè¯»å†™åˆ‡æ¢(!!!)</span></span><br><span class="line">        intBuffer.flip();</span><br><span class="line">        <span class="keyword">while</span> (intBuffer.hasRemaining()) &#123;</span><br><span class="line">            System.out.println(intBuffer.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-NIO-å’Œ-BIO-çš„æ¯”è¾ƒ"><strong>3.2 NIO å’Œ BIO çš„æ¯”è¾ƒ</strong></h2><ol><li><code>BIO</code>Â ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€ŒÂ <code>NIO</code>Â ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œå—Â <code>I/O</code>Â çš„æ•ˆç‡æ¯”æµÂ <code>I/O</code>Â é«˜å¾ˆå¤šã€‚</li><li><code>BIO</code>Â æ˜¯é˜»å¡çš„ï¼Œ<code>NIO</code>Â åˆ™æ˜¯éé˜»å¡çš„ã€‚</li><li><code>BIO</code>Â åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€ŒÂ <code>NIO</code>Â åŸºäºÂ <code>Channel</code>ï¼ˆé€šé“ï¼‰å’ŒÂ <code>Buffer</code>ï¼ˆç¼“å†²åŒºï¼‰è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚<code>Selector</code>ï¼ˆé€‰æ‹©å™¨ï¼‰ç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥è¯·æ±‚ï¼Œæ•°æ®åˆ°è¾¾ç­‰ï¼‰ï¼Œå› æ­¤ä½¿ç”¨å•ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯é€šé“ã€‚</li></ol><h2 id="3-3-NIO-ä¸‰å¤§æ ¸å¿ƒåŸç†ç¤ºæ„å›¾"><strong>3.3 NIO ä¸‰å¤§æ ¸å¿ƒåŸç†ç¤ºæ„å›¾</strong></h2><p>ä¸€å¼ å›¾æè¿°Â <code>NIO</code>Â çš„Â <code>Selector</code>ã€<code>Channel</code>Â å’ŒÂ <code>Buffer</code>Â çš„å…³ç³»ã€‚</p><h3 id="3-3-1-Selectorã€Channel-å’Œ-Buffer-å…³ç³»å›¾ï¼ˆç®€å•ç‰ˆï¼‰"><strong>3.3.1 Selectorã€Channel å’Œ Buffer å…³ç³»å›¾ï¼ˆç®€å•ç‰ˆï¼‰</strong></h3><p>å…³ç³»å›¾çš„è¯´æ˜:</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_01.png"></p><ol><li>æ¯ä¸ªÂ <code>Channel</code>Â éƒ½ä¼šå¯¹åº”ä¸€ä¸ªÂ <code>Buffer</code>ã€‚</li><li><code>Selector</code>Â å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”å¤šä¸ªÂ <code>Channel</code>ï¼ˆè¿æ¥ï¼‰ã€‚</li><li>è¯¥å›¾ååº”äº†æœ‰ä¸‰ä¸ªÂ <code>Channel</code>Â æ³¨å†Œåˆ°è¯¥Â <code>Selector</code>Â //ç¨‹åº</li><li>ç¨‹åºåˆ‡æ¢åˆ°å“ªä¸ªÂ <code>Channel</code>Â æ˜¯ç”±äº‹ä»¶å†³å®šçš„ï¼Œ<code>Event</code>Â å°±æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚</li><li><code>Selector</code>Â ä¼šæ ¹æ®ä¸åŒçš„äº‹ä»¶ï¼Œåœ¨å„ä¸ªé€šé“ä¸Šåˆ‡æ¢ã€‚</li><li><code>Buffer</code>Â å°±æ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œåº•å±‚æ˜¯æœ‰ä¸€ä¸ªæ•°ç»„ã€‚</li><li>æ•°æ®çš„è¯»å–å†™å…¥æ˜¯é€šè¿‡Â <code>Buffer</code>ï¼Œè¿™ä¸ªå’ŒÂ <code>BIO</code>ï¼Œ<code>BIO</code>Â ä¸­è¦ä¹ˆæ˜¯è¾“å…¥æµï¼Œæˆ–è€…æ˜¯è¾“å‡ºæµï¼Œä¸èƒ½åŒå‘ï¼Œä½†æ˜¯Â <code>NIO</code>Â çš„Â <code>Buffer</code>Â æ˜¯å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œéœ€è¦Â <code>flip</code>Â æ–¹æ³•åˆ‡æ¢Â <code>Channel</code>Â æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¿”å›åº•å±‚æ“ä½œç³»ç»Ÿçš„æƒ…å†µï¼Œæ¯”å¦‚Â <code>Linux</code>ï¼Œåº•å±‚çš„æ“ä½œç³»ç»Ÿé€šé“å°±æ˜¯åŒå‘çš„ã€‚</li></ol><h2 id="3-4-ç¼“å†²åŒºï¼ˆBufferï¼‰"><strong>3.4 ç¼“å†²åŒºï¼ˆBufferï¼‰</strong></h2><h3 id="3-4-1-åŸºæœ¬ä»‹ç»"><strong>3.4.1 åŸºæœ¬ä»‹ç»</strong></h3><p>ç¼“å†²åŒºï¼ˆ<code>Buffer</code>ï¼‰ï¼šç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å¯ä»¥è¯»å†™æ•°æ®çš„å†…å­˜å—</strong>ï¼Œå¯ä»¥ç†è§£æˆæ˜¯ä¸€ä¸ª<strong>å®¹å™¨å¯¹è±¡ï¼ˆå«æ•°ç»„ï¼‰</strong>ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨å†…å­˜å—ï¼Œï¼Œç¼“å†²åŒºå¯¹è±¡å†…ç½®äº†ä¸€äº›æœºåˆ¶ï¼Œèƒ½å¤Ÿè·Ÿè¸ªå’Œè®°å½•ç¼“å†²åŒºçš„çŠ¶æ€å˜åŒ–æƒ…å†µã€‚<code>Channel</code>Â æä¾›ä»æ–‡ä»¶ã€ç½‘ç»œè¯»å–æ•°æ®çš„æ¸ é“ï¼Œä½†æ˜¯è¯»å–æˆ–å†™å…¥çš„æ•°æ®éƒ½å¿…é¡»ç”±Â <code>Buffer</code>ï¼Œå¦‚å›¾:ã€åé¢ä¸¾ä¾‹è¯´æ˜ã€‘</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_02.png"></p><h3 id="3-4-2-Buffer-ç±»åŠå…¶å­ç±»"><strong>3.4.2 Buffer ç±»åŠå…¶å­ç±»</strong></h3><ol><li>åœ¨Â <code>NIO</code>Â ä¸­ï¼Œ<code>Buffer</code>Â æ˜¯ä¸€ä¸ªé¡¶å±‚çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç±»çš„å±‚çº§å…³ç³»å›¾ï¼š</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_03.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_03.png"></p><ol><li><code>Buffer</code>Â ç±»å®šä¹‰äº†æ‰€æœ‰çš„ç¼“å†²åŒºéƒ½å…·æœ‰çš„å››ä¸ªå±æ€§æ¥æä¾›å…³äºå…¶æ‰€åŒ…å«çš„æ•°æ®å…ƒç´ çš„ä¿¡æ¯ï¼š</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_05.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_05.png"></p><ol><li><code>Buffer</code>Â ç±»ç›¸å…³æ–¹æ³•ä¸€è§ˆ</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_06.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_06.png"></p><h3 id="3-4-3-ByteBuffer"><strong>3.4.3 ByteBuffer</strong></h3><p>ä»å‰é¢å¯ä»¥çœ‹å‡ºå¯¹äºÂ <code>Java</code>Â ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ<code>boolean</code>Â é™¤å¤–ï¼‰ï¼Œéƒ½æœ‰ä¸€ä¸ªÂ <code>Buffer</code>Â ç±»å‹ä¸ä¹‹ç›¸å¯¹åº”ï¼Œæœ€å¸¸ç”¨çš„è‡ªç„¶æ˜¯Â <code>ByteBuffer</code>Â ç±»ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œè¯¥ç±»çš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_07.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_07.png"></p><h2 id="3-5-é€šé“ï¼ˆChannelï¼‰"><strong>3.5 é€šé“ï¼ˆChannelï¼‰</strong></h2><h2 id="3-6-åŸºæœ¬ä»‹ç»"><strong>3.6 åŸºæœ¬ä»‹ç»</strong></h2><ol><li><code>NIO</code>Â çš„é€šé“ç±»ä¼¼äºæµï¼Œä½†æœ‰äº›åŒºåˆ«å¦‚ä¸‹ï¼š<ul><li>é€šé“å¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–è€…åªèƒ½å†™</li><li>é€šé“å¯ä»¥å®ç°å¼‚æ­¥è¯»å†™æ•°æ®</li><li>é€šé“å¯ä»¥ä»ç¼“å†²è¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²:</li></ul></li><li><code>BIO</code>Â ä¸­çš„Â <code>Stream</code>Â æ˜¯å•å‘çš„ï¼Œä¾‹å¦‚Â <code>FileInputStream</code>Â å¯¹è±¡åªèƒ½è¿›è¡Œè¯»å–æ•°æ®çš„æ“ä½œï¼Œè€ŒÂ <code>NIO</code>Â ä¸­çš„é€šé“ï¼ˆ<code>Channel</code>ï¼‰æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¯»æ“ä½œï¼Œä¹Ÿå¯ä»¥å†™æ“ä½œã€‚</li><li><code>Channel</code>Â åœ¨Â <code>NIO</code>Â ä¸­æ˜¯ä¸€ä¸ªæ¥å£Â <code>public interface Channel extends Closeable&#123;&#125;</code></li><li>å¸¸ç”¨çš„Â <code>Channel</code>Â ç±»æœ‰:Â <strong><code>FileChannel</code>ã€<code>DatagramChannel</code>ã€<code>ServerSocketChannel</code>Â å’ŒÂ <code>SocketChannel</code></strong>Â ã€‚ã€<code>ServerSocketChanne</code>Â ç±»ä¼¼Â <code>ServerSocket</code>ã€<code>SocketChannel</code>Â ç±»ä¼¼Â <code>Socket</code>ã€‘</li><li><code>FileChannel</code>Â ç”¨äºæ–‡ä»¶çš„æ•°æ®è¯»å†™ï¼Œ<code>DatagramChannel</code>Â ç”¨äºÂ <code>UDP</code>Â çš„æ•°æ®è¯»å†™ï¼Œ<code>ServerSocketChannel</code>Â å’ŒÂ <code>SocketChannel</code>Â ç”¨äºÂ <code>TCP</code>Â çš„æ•°æ®è¯»å†™ã€‚</li><li>å›¾ç¤º</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_08.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_08.png"></p><h3 id="3-6-1-FileChannel-ç±»"><strong>3.6.1 FileChannel ç±»</strong></h3><p><code>FileChannel</code>Â ä¸»è¦ç”¨æ¥å¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡ŒÂ <code>IO</code>Â æ“ä½œï¼Œå¸¸è§çš„æ–¹æ³•æœ‰</p><ul><li><code>public int read(ByteBuffer dst)</code>ï¼Œä»é€šé“è¯»å–æ•°æ®å¹¶æ”¾åˆ°ç¼“å†²åŒºä¸­</li><li><code>public int write(ByteBuffer src)</code>ï¼ŒæŠŠç¼“å†²åŒºçš„æ•°æ®å†™åˆ°é€šé“ä¸­</li><li><code>public long transferFrom(ReadableByteChannel src, long position, long count)</code>ï¼Œä»ç›®æ ‡é€šé“ä¸­å¤åˆ¶æ•°æ®åˆ°å½“å‰é€šé“</li><li><code>public long transferTo(long position, long count, WritableByteChannel target)</code>ï¼ŒæŠŠæ•°æ®ä»å½“å‰é€šé“å¤åˆ¶ç»™ç›®æ ‡é€šé“</li></ul><h3 id="3-6-2-åº”ç”¨å®ä¾‹1-æœ¬åœ°æ–‡ä»¶å†™æ•°æ®"><strong>3.6.2 åº”ç”¨å®ä¾‹1 - æœ¬åœ°æ–‡ä»¶å†™æ•°æ®</strong></h3><p>å®ä¾‹è¦æ±‚ï¼š</p><ol><li>ä½¿ç”¨å‰é¢å­¦ä¹ åçš„Â <code>ByteBuffer</code>ï¼ˆç¼“å†²ï¼‰å’ŒÂ <code>FileChannel</code>ï¼ˆé€šé“ï¼‰ï¼Œå°† â€œhello,å°šç¡…è°·â€ å†™å…¥åˆ°Â <code>file01.txt</code>Â ä¸­</li><li>æ–‡ä»¶ä¸å­˜åœ¨å°±åˆ›å»º</li><li>ä»£ç æ¼”ç¤º</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line">import java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line">public class NIOFileChannel01 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        String str = &quot;hello,å°šç¡…è°·&quot;;</span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªè¾“å‡ºæµ -&gt; channel</span><br><span class="line">        FileOutputStream fileOutputStream = new FileOutputStream(&quot;d:\\file01.txt&quot;);</span><br><span class="line"></span><br><span class="line">        //é€šè¿‡ fileOutputStream è·å–å¯¹åº”çš„ FileChannel</span><br><span class="line">        //è¿™ä¸ª fileChannel çœŸå®ç±»å‹æ˜¯ FileChannelImpl</span><br><span class="line">        FileChannel fileChannel = fileOutputStream.getChannel();</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº ByteBuffer</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(1024);</span><br><span class="line"></span><br><span class="line">        //å°† str æ”¾å…¥ byteBuffer</span><br><span class="line">        byteBuffer.put(str.getBytes());</span><br><span class="line"></span><br><span class="line">        //å¯¹ byteBuffer è¿›è¡Œ flip</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line"></span><br><span class="line">        //å°† byteBuffer æ•°æ®å†™å…¥åˆ° fileChannel</span><br><span class="line">        fileChannel.write(byteBuffer);</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="3-6-3-åº”ç”¨å®ä¾‹2-æœ¬åœ°æ–‡ä»¶è¯»æ•°æ®"><strong>3.6.3 åº”ç”¨å®ä¾‹2 - æœ¬åœ°æ–‡ä»¶è¯»æ•°æ®</strong></h3><p>å®ä¾‹è¦æ±‚ï¼š</p><ol><li>ä½¿ç”¨å‰é¢å­¦ä¹ åçš„Â <code>ByteBuffer</code>ï¼ˆç¼“å†²ï¼‰å’ŒÂ <code>FileChannel</code>ï¼ˆé€šé“ï¼‰ï¼Œå°†Â <code>file01.txt</code>Â ä¸­çš„æ•°æ®è¯»å…¥åˆ°ç¨‹åºï¼Œå¹¶æ˜¾ç¤ºåœ¨æ§åˆ¶å°å±å¹•</li><li>å‡å®šæ–‡ä»¶å·²ç»å­˜åœ¨</li><li>ä»£ç æ¼”ç¤º</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line">import java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line">public class NIOFileChannel02 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºæ–‡ä»¶çš„è¾“å…¥æµ</span><br><span class="line">        File file = new File(&quot;d:\\file01.txt&quot;);</span><br><span class="line">        FileInputStream fileInputStream = new FileInputStream(file);</span><br><span class="line"></span><br><span class="line">        //é€šè¿‡ fileInputStream è·å–å¯¹åº”çš„ FileChannel -&gt; å®é™…ç±»å‹ FileChannelImpl</span><br><span class="line">        FileChannel fileChannel = fileInputStream.getChannel();</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºç¼“å†²åŒº</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate((int)file.length());</span><br><span class="line"></span><br><span class="line">        //å°†é€šé“çš„æ•°æ®è¯»å…¥åˆ° Buffer</span><br><span class="line">        fileChannel.read(byteBuffer);</span><br><span class="line"></span><br><span class="line">        //å°† byteBuffer çš„å­—èŠ‚æ•°æ®è½¬æˆ String</span><br><span class="line">        System.out.println(new String(byteBuffer.array()));</span><br><span class="line">        fileInputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="3-6-4-åº”ç”¨å®ä¾‹3-ä½¿ç”¨ä¸€ä¸ª-Buffer-å®Œæˆæ–‡ä»¶è¯»å–ã€å†™å…¥"><strong>3.6.4 åº”ç”¨å®ä¾‹3 - ä½¿ç”¨ä¸€ä¸ª Buffer å®Œæˆæ–‡ä»¶è¯»å–ã€å†™å…¥</strong></h3><p>å®ä¾‹è¦æ±‚ï¼š</p><ol><li>ä½¿ç”¨Â <code>FileChannel</code>ï¼ˆé€šé“ï¼‰å’Œæ–¹æ³•Â <code>readã€write</code>ï¼Œå®Œæˆæ–‡ä»¶çš„æ‹·è´</li><li>æ‹·è´ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶Â <code>1.txt</code>ï¼Œæ”¾åœ¨é¡¹ç›®ä¸‹å³å¯</li><li>ä»£ç æ¼”ç¤º</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_09.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_09.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line">import java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line">public class NIOFileChannel03 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        FileInputStream fileInputStream = new FileInputStream(&quot;1.txt&quot;);</span><br><span class="line">        FileChannel fileChannel01 = fileInputStream.getChannel();</span><br><span class="line">        FileOutputStream fileOutputStream = new FileOutputStream(&quot;2.txt&quot;);</span><br><span class="line">        FileChannel fileChannel02 = fileOutputStream.getChannel();</span><br><span class="line"></span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(512);</span><br><span class="line"></span><br><span class="line">        while (true) &#123; //å¾ªç¯è¯»å–</span><br><span class="line"></span><br><span class="line">            //è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„æ“ä½œï¼Œä¸€å®šä¸è¦å¿˜äº†</span><br><span class="line">            /*</span><br><span class="line">            public final Buffer clear() &#123;</span><br><span class="line">                position = 0;</span><br><span class="line">                limit = capacity;</span><br><span class="line">                mark = -1;</span><br><span class="line">                return this;</span><br><span class="line">            &#125;</span><br><span class="line">            */</span><br><span class="line">            byteBuffer.clear(); //æ¸…ç©º buffer</span><br><span class="line">            int read = fileChannel01.read(byteBuffer);</span><br><span class="line">            System.out.println(&quot;read = &quot; + read);</span><br><span class="line">            if (read == -1) &#123; //è¡¨ç¤ºè¯»å®Œ</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //å°† buffer ä¸­çš„æ•°æ®å†™å…¥åˆ° fileChannel02--2.txt</span><br><span class="line">            byteBuffer.flip();</span><br><span class="line">            fileChannel02.write(byteBuffer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å…³é—­ç›¸å…³çš„æµ</span><br><span class="line">        fileInputStream.close();</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="3-6-5-åº”ç”¨å®ä¾‹4-æ‹·è´æ–‡ä»¶-transferFrom-æ–¹æ³•"><strong>3.6.5 åº”ç”¨å®ä¾‹4 - æ‹·è´æ–‡ä»¶ transferFrom æ–¹æ³•</strong></h3><ol><li>å®ä¾‹è¦æ±‚ï¼š</li><li>ä½¿ç”¨Â <code>FileChannel</code>ï¼ˆé€šé“ï¼‰å’Œæ–¹æ³•Â <code>transferFrom</code>ï¼Œå®Œæˆæ–‡ä»¶çš„æ‹·è´</li><li>æ‹·è´ä¸€å¼ å›¾ç‰‡</li><li>ä»£ç æ¼”ç¤º</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line">public class NIOFileChannel04 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºç›¸å…³æµ</span><br><span class="line">        FileInputStream fileInputStream = new FileInputStream(&quot;d:\\a.jpg&quot;);</span><br><span class="line">        FileOutputStream fileOutputStream = new FileOutputStream(&quot;d:\\a2.jpg&quot;);</span><br><span class="line"></span><br><span class="line">        //è·å–å„ä¸ªæµå¯¹åº”çš„ FileChannel</span><br><span class="line">        FileChannel sourceCh = fileInputStream.getChannel();</span><br><span class="line">        FileChannel destCh = fileOutputStream.getChannel();</span><br><span class="line"></span><br><span class="line">        //ä½¿ç”¨ transferForm å®Œæˆæ‹·è´</span><br><span class="line">        destCh.transferFrom(sourceCh, 0, sourceCh.size());</span><br><span class="line"></span><br><span class="line">        //å…³é—­ç›¸å…³é€šé“å’Œæµ</span><br><span class="line">        sourceCh.close();</span><br><span class="line">        destCh.close();</span><br><span class="line">        fileInputStream.close();</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="3-6-6-å…³äº-Buffer-å’Œ-Channel-çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><strong>3.6.6 å…³äº Buffer å’Œ Channel çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</strong></h3><ol><li><code>ByteBuffer</code>Â æ”¯æŒç±»å‹åŒ–çš„Â <code>put</code>Â å’ŒÂ <code>get</code>ï¼Œ<code>put</code>Â æ”¾å…¥çš„æ˜¯ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œ<code>get</code>Â å°±åº”è¯¥ä½¿ç”¨ç›¸åº”çš„æ•°æ®ç±»å‹æ¥å–å‡ºï¼Œå¦åˆ™å¯èƒ½æœ‰Â <code>BufferUnderflowException</code>Â å¼‚å¸¸ã€‚ã€ä¸¾ä¾‹è¯´æ˜ã€‘</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line"></span><br><span class="line">public class NIOByteBufferPutGet &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸€ä¸ª Buffer</span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(64);</span><br><span class="line"></span><br><span class="line">        //ç±»å‹åŒ–æ–¹å¼æ”¾å…¥æ•°æ®</span><br><span class="line">        buffer.putInt(100);</span><br><span class="line">        buffer.putLong(9);</span><br><span class="line">        buffer.putChar(&#x27;å°š&#x27;);</span><br><span class="line">        buffer.putShort((short) 4);</span><br><span class="line"></span><br><span class="line">        //å–å‡º</span><br><span class="line">        buffer.flip();</span><br><span class="line"></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        System.out.println(buffer.getInt());</span><br><span class="line">        System.out.println(buffer.getLong());</span><br><span class="line">        System.out.println(buffer.getChar());</span><br><span class="line">        System.out.println(buffer.getShort());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>å¯ä»¥å°†ä¸€ä¸ªæ™®é€šÂ <code>Buffer</code>Â è½¬æˆåªè¯»Â <code>Buffer</code>ã€ä¸¾ä¾‹è¯´æ˜ã€‘</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line"></span><br><span class="line">public class ReadOnlyBuffer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸€ä¸ª buffer</span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(64);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 64; i++) &#123;</span><br><span class="line">            buffer.put((byte) i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //è¯»å–</span><br><span class="line">        buffer.flip();</span><br><span class="line"></span><br><span class="line">        //å¾—åˆ°ä¸€ä¸ªåªè¯»çš„ Buffer</span><br><span class="line">        ByteBuffer readOnlyBuffer = buffer.asReadOnlyBuffer();</span><br><span class="line">        System.out.println(readOnlyBuffer.getClass());</span><br><span class="line"></span><br><span class="line">        //è¯»å–</span><br><span class="line">        while (readOnlyBuffer.hasRemaining()) &#123;</span><br><span class="line">            System.out.println(readOnlyBuffer.get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        readOnlyBuffer.put((byte) 100); //ReadOnlyBufferException</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li><code>NIO</code>Â è¿˜æä¾›äº†Â <code>MappedByteBuffer</code>ï¼Œå¯ä»¥è®©æ–‡ä»¶ç›´æ¥åœ¨å†…å­˜ï¼ˆå †å¤–çš„å†…å­˜ï¼‰ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè€Œå¦‚ä½•åŒæ­¥åˆ°æ–‡ä»¶ç”±Â <code>NIO</code>Â æ¥å®Œæˆã€‚ã€ä¸¾ä¾‹è¯´æ˜ã€‘</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.io.RandomAccessFile;</span><br><span class="line">import java.nio.MappedByteBuffer;</span><br><span class="line">import java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¯´æ˜ 1.MappedByteBuffer å¯è®©æ–‡ä»¶ç›´æ¥åœ¨å†…å­˜ï¼ˆå †å¤–å†…å­˜ï¼‰ä¿®æ”¹,æ“ä½œç³»ç»Ÿä¸éœ€è¦æ‹·è´ä¸€æ¬¡</span><br><span class="line"> */</span><br><span class="line">public class MappedByteBufferTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        RandomAccessFile randomAccessFile = new RandomAccessFile(&quot;1.txt&quot;, &quot;rw&quot;);</span><br><span class="line">        //è·å–å¯¹åº”çš„é€šé“</span><br><span class="line">        FileChannel channel = randomAccessFile.getChannel();</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * å‚æ•° 1:FileChannel.MapMode.READ_WRITE ä½¿ç”¨çš„è¯»å†™æ¨¡å¼</span><br><span class="line">         * å‚æ•° 2ï¼š0ï¼šå¯ä»¥ç›´æ¥ä¿®æ”¹çš„èµ·å§‹ä½ç½®</span><br><span class="line">         * å‚æ•° 3:5: æ˜¯æ˜ å°„åˆ°å†…å­˜çš„å¤§å°ï¼ˆä¸æ˜¯ç´¢å¼•ä½ç½®ï¼‰ï¼Œå³å°† 1.txt çš„å¤šå°‘ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜</span><br><span class="line">         * å¯ä»¥ç›´æ¥ä¿®æ”¹çš„èŒƒå›´å°±æ˜¯ 0-5</span><br><span class="line">         * å®é™…ç±»å‹ DirectByteBuffer</span><br><span class="line">         */</span><br><span class="line">        MappedByteBuffer mappedByteBuffer = channel.map(FileChannel.MapMode.READ_WRITE, 0, 5);</span><br><span class="line"></span><br><span class="line">        mappedByteBuffer.put(0, (byte) &#x27;H&#x27;);</span><br><span class="line">        mappedByteBuffer.put(3, (byte) &#x27;9&#x27;);</span><br><span class="line">        mappedByteBuffer.put(5, (byte) &#x27;Y&#x27;);//IndexOutOfBoundsException</span><br><span class="line"></span><br><span class="line">        randomAccessFile.close();</span><br><span class="line">        System.out.println(&quot;ä¿®æ”¹æˆåŠŸ~~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>å‰é¢æˆ‘ä»¬è®²çš„è¯»å†™æ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡ä¸€ä¸ªÂ <code>Buffer</code>Â å®Œæˆçš„ï¼Œ<code>NIO</code>Â è¿˜æ”¯æŒé€šè¿‡å¤šä¸ªÂ <code>Buffer</code>ï¼ˆå³Â <code>Buffer</code>æ•°ç»„ï¼‰å®Œæˆè¯»å†™æ“ä½œï¼Œå³Â <code>Scattering</code>Â å’ŒÂ <code>Gathering</code>ã€ä¸¾ä¾‹è¯´æ˜ã€‘</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.nio;</span><br><span class="line"></span><br><span class="line">import java.net.InetSocketAddress;</span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line">import java.nio.channels.ServerSocketChannel;</span><br><span class="line">import java.nio.channels.SocketChannel;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Scatteringï¼šå°†æ•°æ®å†™å…¥åˆ° buffer æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ buffer æ•°ç»„ï¼Œä¾æ¬¡å†™å…¥ [åˆ†æ•£]</span><br><span class="line"> * Gatheringï¼šä» buffer è¯»å–æ•°æ®æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ buffer æ•°ç»„ï¼Œä¾æ¬¡è¯»</span><br><span class="line"> */</span><br><span class="line">public class ScatteringAndGatheringTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //ä½¿ç”¨ ServerSocketChannel å’Œ SocketChannel ç½‘ç»œ</span><br><span class="line">        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">        InetSocketAddress inetSocketAddress = new InetSocketAddress(7000);</span><br><span class="line"></span><br><span class="line">        //ç»‘å®šç«¯å£åˆ° socketï¼Œå¹¶å¯åŠ¨</span><br><span class="line">        serverSocketChannel.socket().bind(inetSocketAddress);</span><br><span class="line"></span><br><span class="line">        //åˆ›å»º buffer æ•°ç»„</span><br><span class="line">        ByteBuffer[] byteBuffers = new ByteBuffer[2];</span><br><span class="line">        byteBuffers[0] = ByteBuffer.allocate(5);</span><br><span class="line">        byteBuffers[1] = ByteBuffer.allocate(3);</span><br><span class="line"></span><br><span class="line">        //ç­‰å®¢æˆ·ç«¯è¿æ¥ (telnet)</span><br><span class="line">        SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line"></span><br><span class="line">        int messageLength = 8; //å‡å®šä»å®¢æˆ·ç«¯æ¥æ”¶ 8 ä¸ªå­—èŠ‚</span><br><span class="line"></span><br><span class="line">        //å¾ªç¯çš„è¯»å–</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            int byteRead = 0;</span><br><span class="line"></span><br><span class="line">            while (byteRead &lt; messageLength) &#123;</span><br><span class="line">                long l = socketChannel.read(byteBuffers);</span><br><span class="line">                byteRead += l; //ç´¯è®¡è¯»å–çš„å­—èŠ‚æ•°</span><br><span class="line">                System.out.println(&quot;byteRead = &quot; + byteRead);</span><br><span class="line">                //ä½¿ç”¨æµæ‰“å°,çœ‹çœ‹å½“å‰çš„è¿™ä¸ª buffer çš„ position å’Œ limit</span><br><span class="line">                Arrays.asList(byteBuffers).stream().map(buffer -&gt; &quot;position = &quot; + buffer.position() + &quot;, limit = &quot; + buffer.limit()).forEach(System.out::println);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //å°†æ‰€æœ‰çš„ buffer è¿›è¡Œ flip</span><br><span class="line">            Arrays.asList(byteBuffers).forEach(buffer -&gt; buffer.flip());</span><br><span class="line">            //å°†æ•°æ®è¯»å‡ºæ˜¾ç¤ºåˆ°å®¢æˆ·ç«¯</span><br><span class="line">            long byteWirte = 0;</span><br><span class="line">            while (byteWirte &lt; messageLength) &#123;</span><br><span class="line">                long l = socketChannel.write(byteBuffers);//</span><br><span class="line">                byteWirte += l;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //å°†æ‰€æœ‰çš„bufferè¿›è¡Œclear</span><br><span class="line">            Arrays.asList(byteBuffers).forEach(buffer -&gt; &#123;</span><br><span class="line">                buffer.clear();</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;byteRead = &quot; + byteRead + &quot;, byteWrite = &quot; + byteWirte + &quot;, messagelength = &quot; + messageLength);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="3-7-Selectorï¼ˆé€‰æ‹©å™¨ï¼‰"><strong>3.7 Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</strong></h2><h3 id="3-7-1-åŸºæœ¬ä»‹ç»"><strong>3.7.1 åŸºæœ¬ä»‹ç»</strong></h3><ol><li><code>Java</code>Â çš„Â <code>NIO</code>ï¼Œç”¨éé˜»å¡çš„Â <code>IO</code>Â æ–¹å¼ã€‚å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šä½¿ç”¨åˆ°Â <code>Selector</code>ï¼ˆé€‰æ‹©å™¨ï¼‰ã€‚</li><li><code>Selector</code>Â èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆæ³¨æ„ï¼šå¤šä¸ªÂ <code>Channel</code>Â ä»¥äº‹ä»¶çš„æ–¹å¼å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ªÂ <code>Selector</code>ï¼‰ï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿è·å–äº‹ä»¶ç„¶åé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹å»ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿æ¥å’Œè¯·æ±‚ã€‚ã€ç¤ºæ„å›¾ã€‘</li><li>åªæœ‰åœ¨è¿æ¥/é€šé“çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§åœ°å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç”¨å»ç»´æŠ¤å¤šä¸ªçº¿ç¨‹ã€‚</li><li>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€ã€‚</li></ol><h3 id="3-7-2-Selector-ç¤ºæ„å›¾å’Œç‰¹ç‚¹è¯´æ˜"><strong>3.7.2 Selector ç¤ºæ„å›¾å’Œç‰¹ç‚¹è¯´æ˜</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_10.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_10.png"></p><p>è¯´æ˜å¦‚ä¸‹ï¼š</p><ol><li><code>Netty</code>Â çš„Â <code>IO</code>Â çº¿ç¨‹Â <code>NioEventLoop</code>Â èšåˆäº†Â <code>Selector</code>ï¼ˆé€‰æ‹©å™¨ï¼Œä¹Ÿå«å¤šè·¯å¤ç”¨å™¨ï¼‰ï¼Œå¯ä»¥åŒæ—¶å¹¶å‘å¤„ç†æˆç™¾ä¸Šåƒä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</li><li>å½“çº¿ç¨‹ä»æŸå®¢æˆ·ç«¯Â <code>Socket</code>Â é€šé“è¿›è¡Œè¯»å†™æ•°æ®æ—¶ï¼Œè‹¥æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œè¯¥çº¿ç¨‹å¯ä»¥è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚</li><li>çº¿ç¨‹é€šå¸¸å°†éé˜»å¡Â <code>IO</code>Â çš„ç©ºé—²æ—¶é—´ç”¨äºåœ¨å…¶ä»–é€šé“ä¸Šæ‰§è¡ŒÂ <code>IO</code>Â æ“ä½œï¼Œæ‰€ä»¥å•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“ã€‚</li><li>ç”±äºè¯»å†™æ“ä½œéƒ½æ˜¯éé˜»å¡çš„ï¼Œè¿™å°±å¯ä»¥å……åˆ†æå‡Â <code>IO</code>Â çº¿ç¨‹çš„è¿è¡Œæ•ˆç‡ï¼Œé¿å…ç”±äºé¢‘ç¹Â <code>I/O</code>Â é˜»å¡å¯¼è‡´çš„çº¿ç¨‹æŒ‚èµ·ã€‚</li><li>ä¸€ä¸ªÂ <code>I/O</code>Â çº¿ç¨‹å¯ä»¥å¹¶å‘å¤„ç†Â <code>N</code>Â ä¸ªå®¢æˆ·ç«¯è¿æ¥å’Œè¯»å†™æ“ä½œï¼Œè¿™ä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»ŸåŒæ­¥é˜»å¡Â <code>I/O</code>Â ä¸€è¿æ¥ä¸€çº¿ç¨‹æ¨¡å‹ï¼Œæ¶æ„çš„æ€§èƒ½ã€å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›å’Œå¯é æ€§éƒ½å¾—åˆ°äº†æå¤§çš„æå‡ã€‚</li></ol><h3 id="3-7-3-Selector-ç±»ç›¸å…³æ–¹æ³•"><strong>3.7.3 Selector ç±»ç›¸å…³æ–¹æ³•</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_11.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_11.png"></p><h3 id="3-7-4-æ³¨æ„äº‹é¡¹"><strong>3.7.4 æ³¨æ„äº‹é¡¹</strong></h3><ol><li><code>NIO</code>Â ä¸­çš„Â <code>ServerSocketChannel</code>Â åŠŸèƒ½ç±»ä¼¼Â <code>ServerSocket</code>ã€<code>SocketChannel</code>Â åŠŸèƒ½ç±»ä¼¼Â <code>Socket</code>ã€‚</li><li><code>Selector</code>Â ç›¸å…³æ–¹æ³•è¯´æ˜<ul><li><code>selector.select();</code>Â //é˜»å¡</li><li><code>selector.select(1000);</code>Â //é˜»å¡ 1000 æ¯«ç§’ï¼Œåœ¨ 1000 æ¯«ç§’åè¿”å›</li><li><code>selector.wakeup();</code>Â //å”¤é†’ selector</li><li><code>selector.selectNow();</code>Â //ä¸é˜»å¡ï¼Œç«‹é©¬è¿”è¿˜</li></ul></li></ol><h2 id="3-8-NIO-éé˜»å¡ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾"><strong>3.8 NIO éé˜»å¡ç½‘ç»œç¼–ç¨‹åŸç†åˆ†æå›¾</strong></h2><p><code>NIO</code>Â éé˜»å¡ç½‘ç»œç¼–ç¨‹ç›¸å…³çš„ï¼ˆ<code>Selector</code>ã€<code>SelectionKey</code>ã€<code>ServerScoketChannel</code>Â å’ŒÂ <code>SocketChannel</code>ï¼‰å…³ç³»æ¢³ç†å›¾</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_22.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_22.png"></p><p>å¯¹ä¸Šå›¾çš„è¯´æ˜ï¼š</p><ol><li>å½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šé€šè¿‡Â <code>ServerSocketChannel</code>Â å¾—åˆ°Â <code>SocketChannel</code>ã€‚</li><li><code>Selector</code>Â è¿›è¡Œç›‘å¬Â <code>select</code>Â æ–¹æ³•ï¼Œè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„é€šé“çš„ä¸ªæ•°ã€‚</li><li>å°†Â <code>socketChannel</code>Â æ³¨å†Œåˆ°Â <code>Selector</code>Â ä¸Šï¼Œ<code>register(Selector sel, int ops)</code>ï¼Œä¸€ä¸ªÂ <code>Selector</code>Â ä¸Šå¯ä»¥æ³¨å†Œå¤šä¸ªÂ <code>SocketChannel</code>ã€‚</li><li>æ³¨å†Œåè¿”å›ä¸€ä¸ªÂ <code>SelectionKey</code>ï¼Œä¼šå’Œè¯¥Â <code>Selector</code>Â å…³è”ï¼ˆé›†åˆï¼‰ã€‚</li><li>è¿›ä¸€æ­¥å¾—åˆ°å„ä¸ªÂ <code>SelectionKey</code>ï¼ˆæœ‰äº‹ä»¶å‘ç”Ÿï¼‰ã€‚</li><li>åœ¨é€šè¿‡Â <code>SelectionKey</code>Â åå‘è·å–Â <code>SocketChannel</code>ï¼Œæ–¹æ³•Â <code>channel()</code>ã€‚</li><li>å¯ä»¥é€šè¿‡å¾—åˆ°çš„Â <code>channel</code>ï¼Œå®Œæˆä¸šåŠ¡å¤„ç†ã€‚</li><li>ä»£ç æ’‘è…°ã€‚ã€‚ã€‚</li></ol><h2 id="3-9-NIO-éé˜»å¡ç½‘ç»œç¼–ç¨‹å¿«é€Ÿå…¥é—¨"><strong>3.9 NIO éé˜»å¡ç½‘ç»œç¼–ç¨‹å¿«é€Ÿå…¥é—¨</strong></h2><p>æ¡ˆä¾‹è¦æ±‚ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªÂ <code>NIO</code>Â å…¥é—¨æ¡ˆä¾‹ï¼Œå®ç°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéé˜»å¡ï¼‰</li><li>ç›®çš„ï¼šç†è§£Â <code>NIO</code>Â éé˜»å¡ç½‘ç»œç¼–ç¨‹æœºåˆ¶</li><li>çœ‹è€å¸ˆä»£ç æ¼”ç¤º</li></ol><h2 id="3-10-SelectionKey"><strong>3.10 SelectionKey</strong></h2><ol><li><code>SelectionKey</code>ï¼Œè¡¨ç¤ºÂ <code>Selector</code>Â å’Œç½‘ç»œé€šé“çš„æ³¨å†Œå…³ç³»ï¼Œå…±å››ç§ï¼š<ul><li><code>int OP_ACCEPT</code>ï¼šæœ‰æ–°çš„ç½‘ç»œè¿æ¥å¯ä»¥Â <code>accept</code>ï¼Œå€¼ä¸ºÂ <code>16</code></li><li><code>int OP_CONNECT</code>ï¼šä»£è¡¨è¿æ¥å·²ç»å»ºç«‹ï¼Œå€¼ä¸ºÂ <code>8</code></li><li><code>int OP_READ</code>ï¼šä»£è¡¨è¯»æ“ä½œï¼Œå€¼ä¸ºÂ <code>1</code></li><li><code>int OP_WRITE</code>ï¼šä»£è¡¨å†™æ“ä½œï¼Œå€¼ä¸ºÂ <code>4</code></li></ul></li></ol><p>æºç ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static final int OP_READ = 1 &lt;&lt; 0;</span><br><span class="line">public static final int OP_WRITE = 1 &lt;&lt; 2;</span><br><span class="line">public static final int OP_CONNECT = 1 &lt;&lt; 3;</span><br><span class="line">public static final int OP_ACCEPT = 1 &lt;&lt; 4;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li><code>SelectionKey</code>Â ç›¸å…³æ–¹æ³•</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_12.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_12.png"></p><h2 id="3-11-ServerSocketChannel"><strong>3.11 ServerSocketChannel</strong></h2><ol><li><code>ServerSocketChannel</code>Â åœ¨æœåŠ¡å™¨ç«¯ç›‘å¬æ–°çš„å®¢æˆ·ç«¯Â <code>Socket</code>Â è¿æ¥</li><li>ç›¸å…³æ–¹æ³•å¦‚ä¸‹</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_13.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_13.png"></p><h2 id="3-12-SocketChannel"><strong>3.12 SocketChannel</strong></h2><ol><li><code>SocketChannel</code>ï¼Œç½‘ç»œÂ <code>IO</code>Â é€šé“ï¼Œå…·ä½“è´Ÿè´£è¿›è¡Œè¯»å†™æ“ä½œã€‚<code>NIO</code>Â æŠŠç¼“å†²åŒºçš„æ•°æ®å†™å…¥é€šé“ï¼Œæˆ–è€…æŠŠé€šé“é‡Œçš„æ•°æ®è¯»åˆ°ç¼“å†²åŒºã€‚</li><li>ç›¸å…³æ–¹æ³•å¦‚ä¸‹</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_14.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_14.png"></p><h2 id="3-13-NIO-ç½‘ç»œç¼–ç¨‹åº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ"><strong>3.13 NIO ç½‘ç»œç¼–ç¨‹åº”ç”¨å®ä¾‹ - ç¾¤èŠç³»ç»Ÿ</strong></h2><p>å®ä¾‹è¦æ±‚ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªÂ <code>NIO</code>Â ç¾¤èŠç³»ç»Ÿï¼Œå®ç°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéé˜»å¡ï¼‰</li><li>å®ç°å¤šäººç¾¤èŠ</li><li>æœåŠ¡å™¨ç«¯ï¼šå¯ä»¥ç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®ç°æ¶ˆæ¯è½¬å‘åŠŸèƒ½</li><li>å®¢æˆ·ç«¯ï¼šé€šè¿‡Â <code>Channel</code>Â å¯ä»¥æ— é˜»å¡å‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æ¥å—å…¶å®ƒç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼ˆæœ‰æœåŠ¡å™¨è½¬å‘å¾—åˆ°ï¼‰</li><li>ç›®çš„ï¼šè¿›ä¸€æ­¥ç†è§£Â <code>NIO</code>Â éé˜»å¡ç½‘ç»œç¼–ç¨‹æœºåˆ¶</li><li>ç¤ºæ„å›¾åˆ†æå’Œä»£ç </li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_15.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_15.png"></p><p>ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line">// æœåŠ¡ç«¯ï¼š</span><br><span class="line"></span><br><span class="line">package com.atguigu.nio.groupchat;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.InetSocketAddress;</span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line">import java.nio.channels.Channel;</span><br><span class="line">import java.nio.channels.SelectionKey;</span><br><span class="line">import java.nio.channels.Selector;</span><br><span class="line">import java.nio.channels.ServerSocketChannel;</span><br><span class="line">import java.nio.channels.SocketChannel;</span><br><span class="line">import java.util.Iterator;</span><br><span class="line"></span><br><span class="line">public class GroupChatServer &#123;</span><br><span class="line"></span><br><span class="line">    //å®šä¹‰å±æ€§</span><br><span class="line">    private Selector selector;</span><br><span class="line">    private ServerSocketChannel listenChannel;</span><br><span class="line"></span><br><span class="line">    private static final int PORT = 6667;</span><br><span class="line"></span><br><span class="line">    //æ„é€ å™¨</span><br><span class="line">    //åˆå§‹åŒ–å·¥ä½œ</span><br><span class="line">    public GroupChatServer() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //å¾—åˆ°é€‰æ‹©å™¨</span><br><span class="line">            selector = Selector.open();</span><br><span class="line">            //ServerSocketChannel</span><br><span class="line">            listenChannel = ServerSocketChannel.open();</span><br><span class="line">            //ç»‘å®šç«¯å£</span><br><span class="line">            listenChannel.socket().bind(new InetSocketAddress(PORT));</span><br><span class="line">            //è®¾ç½®éé˜»å¡æ¨¡å¼</span><br><span class="line">            listenChannel.configureBlocking(false);</span><br><span class="line">            //å°†è¯¥ listenChannel æ³¨å†Œåˆ° selector</span><br><span class="line">            listenChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void listen() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //å¾ªç¯å¤„ç†</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                int count = selector.select();</span><br><span class="line">                if (count &gt; 0) &#123; //æœ‰äº‹ä»¶å¤„ç†</span><br><span class="line">                    // éå†å¾—åˆ° selectionKey é›†åˆ</span><br><span class="line">                    Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                    while (iterator.hasNext()) &#123;</span><br><span class="line">                        //å–å‡º selectionkey</span><br><span class="line">                        SelectionKey key = iterator.next();</span><br><span class="line">                        //ç›‘å¬åˆ° accept</span><br><span class="line">                        if (key.isAcceptable()) &#123;</span><br><span class="line">                            SocketChannel sc = listenChannel.accept();</span><br><span class="line">                            sc.configureBlocking(false);</span><br><span class="line">                            //å°†è¯¥ sc æ³¨å†Œåˆ° seletor</span><br><span class="line">                            sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                            //æç¤º</span><br><span class="line">                            System.out.println(sc.getRemoteAddress() + &quot; ä¸Šçº¿ &quot;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        if (key.isReadable()) &#123;//é€šé“å‘é€readäº‹ä»¶ï¼Œå³é€šé“æ˜¯å¯è¯»çš„çŠ¶æ€</span><br><span class="line">                            // å¤„ç†è¯»(ä¸“é—¨å†™æ–¹æ³•..)</span><br><span class="line">                            readData(key);</span><br><span class="line">                        &#125;</span><br><span class="line">                        //å½“å‰çš„ key åˆ é™¤ï¼Œé˜²æ­¢é‡å¤å¤„ç†</span><br><span class="line">                        iterator.remove();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    System.out.println(&quot;ç­‰å¾…....&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            //å‘ç”Ÿå¼‚å¸¸å¤„ç†....</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span><br><span class="line">    public void readData(SelectionKey key) &#123;</span><br><span class="line">        SocketChannel channel = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            //å¾—åˆ° channel</span><br><span class="line">            channel = (SocketChannel) key.channel();</span><br><span class="line">            //åˆ›å»º buffer</span><br><span class="line">            ByteBuffer buffer = ByteBuffer.allocate(1024);</span><br><span class="line">            int count = channel.read(buffer);</span><br><span class="line">            //æ ¹æ® count çš„å€¼åšå¤„ç†</span><br><span class="line">            if (count &gt; 0) &#123;</span><br><span class="line">                //æŠŠç¼“å­˜åŒºçš„æ•°æ®è½¬æˆå­—ç¬¦ä¸²</span><br><span class="line">                String msg = new String(buffer.array());</span><br><span class="line">                //è¾“å‡ºè¯¥æ¶ˆæ¯</span><br><span class="line">                System.out.println(&quot;formå®¢æˆ·ç«¯:&quot; + msg);</span><br><span class="line">                //å‘å…¶å®ƒçš„å®¢æˆ·ç«¯è½¬å‘æ¶ˆæ¯(å»æ‰è‡ªå·±),ä¸“é—¨å†™ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†</span><br><span class="line">                sendInfoToOtherClients(msg, channel);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                System.out.println(channel.getRemoteAddress() + &quot;ç¦»çº¿äº†..&quot;);</span><br><span class="line">                //å–æ¶ˆæ³¨å†Œ</span><br><span class="line">                key.cancel();</span><br><span class="line">                //å…³é—­é€šé“</span><br><span class="line">                channel.close();</span><br><span class="line">            &#125; catch (IOException e2) &#123;</span><br><span class="line">                e2.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è½¬å‘æ¶ˆæ¯ç»™å…¶å®ƒå®¢æˆ·(é€šé“)</span><br><span class="line">    private void sendInfoToOtherClients(String msg, SocketChannel self) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨è½¬å‘æ¶ˆæ¯ä¸­...&quot;);</span><br><span class="line">        //éå†æ‰€æœ‰æ³¨å†Œåˆ° selector ä¸Šçš„ SocketChannel,å¹¶æ’é™¤ self</span><br><span class="line">        for (SelectionKey key : selector.keys()) &#123;</span><br><span class="line">            //é€šè¿‡ key å–å‡ºå¯¹åº”çš„ SocketChannel</span><br><span class="line">            Channel targetChannel = key.channel();</span><br><span class="line">            //æ’é™¤è‡ªå·±</span><br><span class="line">            if (targetChannel instanceof SocketChannel &amp;&amp; targetChannel != self) &#123;</span><br><span class="line">                //è½¬å‹</span><br><span class="line">                SocketChannel dest = (SocketChannel) targetChannel;</span><br><span class="line">                //å°† msg å­˜å‚¨åˆ° buffer</span><br><span class="line">                ByteBuffer buffer = ByteBuffer.wrap(msg.getBytes());</span><br><span class="line">                //å°† buffer çš„æ•°æ®å†™å…¥é€šé“</span><br><span class="line">                dest.write(buffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //åˆ›å»ºæœåŠ¡å™¨å¯¹è±¡</span><br><span class="line">        GroupChatServer groupChatServer = new GroupChatServer();</span><br><span class="line">        groupChatServer.listen();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®¢æˆ·ç«¯ï¼š</span><br><span class="line"></span><br><span class="line">package com.atguigu.nio.groupchat;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.InetSocketAddress;</span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line">import java.nio.channels.SelectionKey;</span><br><span class="line">import java.nio.channels.Selector;</span><br><span class="line">import java.nio.channels.SocketChannel;</span><br><span class="line">import java.util.Iterator;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class GroupChatClient &#123;</span><br><span class="line"></span><br><span class="line">    //å®šä¹‰ç›¸å…³çš„å±æ€§</span><br><span class="line">    private final String HOST = &quot;127.0.0.1&quot;;//æœåŠ¡å™¨çš„ip</span><br><span class="line">    private final int PORT = 6667;//æœåŠ¡å™¨ç«¯å£</span><br><span class="line">    private Selector selector;</span><br><span class="line">    private SocketChannel socketChannel;</span><br><span class="line">    private String username;</span><br><span class="line"></span><br><span class="line">    //æ„é€ å™¨,å®Œæˆåˆå§‹åŒ–å·¥ä½œ</span><br><span class="line">    public GroupChatClient() throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        selector = Selector.open();</span><br><span class="line">        //è¿æ¥æœåŠ¡å™¨</span><br><span class="line">        socketChannel = SocketChannel.open(new InetSocketAddress(HOST, PORT));</span><br><span class="line">        //è®¾ç½®éé˜»å¡</span><br><span class="line">        socketChannel.configureBlocking(false);</span><br><span class="line">        //å°† channel æ³¨å†Œåˆ°selector</span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        //å¾—åˆ° username</span><br><span class="line">        username = socketChannel.getLocalAddress().toString().substring(1);</span><br><span class="line">        System.out.println(username + &quot; is ok...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯</span><br><span class="line">    public void sendInfo(String info) &#123;</span><br><span class="line">        info = username + &quot; è¯´ï¼š&quot; + info;</span><br><span class="line">        try &#123;</span><br><span class="line">            socketChannel.write(ByteBuffer.wrap(info.getBytes()));</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¯»å–ä»æœåŠ¡å™¨ç«¯å›å¤çš„æ¶ˆæ¯</span><br><span class="line">    public void readInfo() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            int readChannels = selector.select();</span><br><span class="line">            if (readChannels &gt; 0) &#123;//æœ‰å¯ä»¥ç”¨çš„é€šé“</span><br><span class="line">                Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                while (iterator.hasNext()) &#123;</span><br><span class="line">                    SelectionKey key = iterator.next();</span><br><span class="line">                    if (key.isReadable()) &#123;</span><br><span class="line">                        //å¾—åˆ°ç›¸å…³çš„é€šé“</span><br><span class="line">                        SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">                        //å¾—åˆ°ä¸€ä¸ª Buffer</span><br><span class="line">                        ByteBuffer buffer = ByteBuffer.allocate(1024);</span><br><span class="line">                        //è¯»å–</span><br><span class="line">                        sc.read(buffer);</span><br><span class="line">                        //æŠŠè¯»åˆ°çš„ç¼“å†²åŒºçš„æ•°æ®è½¬æˆå­—ç¬¦ä¸²</span><br><span class="line">                        String msg = new String(buffer.array());</span><br><span class="line">                        System.out.println(msg.trim());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                iterator.remove(); //åˆ é™¤å½“å‰çš„ selectionKey,é˜²æ­¢é‡å¤æ“ä½œ</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                //System.out.println(&quot;æ²¡æœ‰å¯ä»¥ç”¨çš„é€šé“...&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //å¯åŠ¨æˆ‘ä»¬å®¢æˆ·ç«¯</span><br><span class="line">        GroupChatClient chatClient = new GroupChatClient();</span><br><span class="line">        //å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹,æ¯ä¸ª 3 ç§’ï¼Œè¯»å–ä»æœåŠ¡å™¨å‘é€æ•°æ®</span><br><span class="line">        new Thread() &#123;</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                while (true) &#123;</span><br><span class="line">                    chatClient.readInfo();</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.currentThread().sleep(3000);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line"></span><br><span class="line">        //å‘é€æ•°æ®ç»™æœåŠ¡å™¨ç«¯</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        while (scanner.hasNextLine()) &#123;</span><br><span class="line">            String s = scanner.nextLine();</span><br><span class="line">            chatClient.sendInfo(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="3-14-NIO-ä¸é›¶æ‹·è´"><strong>3.14 NIO ä¸é›¶æ‹·è´</strong></h2><h3 id="3-14-1-é›¶æ‹·è´åŸºæœ¬ä»‹ç»"><strong>3.14.1 é›¶æ‹·è´åŸºæœ¬ä»‹ç»</strong></h3><ol><li>é›¶æ‹·è´æ˜¯ç½‘ç»œç¼–ç¨‹çš„å…³é”®ï¼Œå¾ˆå¤šæ€§èƒ½ä¼˜åŒ–éƒ½ç¦»ä¸å¼€ã€‚</li><li>åœ¨Â <code>Java</code>Â ç¨‹åºä¸­ï¼Œå¸¸ç”¨çš„é›¶æ‹·è´æœ‰Â <code>mmap</code>ï¼ˆå†…å­˜æ˜ å°„ï¼‰å’ŒÂ <code>sendFile</code>ã€‚é‚£ä¹ˆï¼Œä»–ä»¬åœ¨Â <code>OS</code>Â é‡Œï¼Œåˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„ä¸€ä¸ªçš„è®¾è®¡ï¼Ÿæˆ‘ä»¬åˆ†æÂ <code>mmap</code>Â å’ŒÂ <code>sendFile</code>Â è¿™ä¸¤ä¸ªé›¶æ‹·è´</li><li>å¦å¤–æˆ‘ä»¬çœ‹ä¸‹Â <code>NIO</code>Â ä¸­å¦‚ä½•ä½¿ç”¨é›¶æ‹·è´</li></ol><h3 id="3-14-2-ä¼ ç»Ÿ-IO-æ•°æ®è¯»å†™"><strong>3.14.2 ä¼ ç»Ÿ IO æ•°æ®è¯»å†™</strong></h3><p><code>Java</code>Â ä¼ ç»ŸÂ <code>IO</code>Â å’Œç½‘ç»œç¼–ç¨‹çš„ä¸€æ®µä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">File file = new File(&quot;test.txt&quot;);</span><br><span class="line">RandomAccessFile raf = new RandomAccessFile(file, &quot;rw&quot;);</span><br><span class="line"></span><br><span class="line">byte[] arr = new byte[(int) file.length()];</span><br><span class="line">raf.read(arr);</span><br><span class="line"></span><br><span class="line">Socket socket = new ServerSocket(8080).accept();</span><br><span class="line">socket.getOutputStream().write(arr);Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="3-14-3-ä¼ ç»Ÿ-IO-æ¨¡å‹"><strong>3.14.3 ä¼ ç»Ÿ IO æ¨¡å‹</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_17.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_17.png"></p><p><strong>DMA</strong>ï¼š<code>direct memory access</code>Â ç›´æ¥å†…å­˜æ‹·è´ï¼ˆä¸ä½¿ç”¨Â <code>CPU</code>ï¼‰</p><h3 id="3-14-4-mmap-ä¼˜åŒ–"><strong>3.14.4 mmap ä¼˜åŒ–</strong></h3><ol><li><code>mmap</code>Â é€šè¿‡å†…å­˜æ˜ å°„ï¼Œå°†æ–‡ä»¶æ˜ å°„åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒåŒæ—¶ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥å…±äº«å†…æ ¸ç©ºé—´çš„æ•°æ®ã€‚è¿™æ ·ï¼Œåœ¨è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶ï¼Œå°±å¯ä»¥å‡å°‘å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´æ¬¡æ•°ã€‚å¦‚ä¸‹å›¾</li><li><code>mmap</code>Â ç¤ºæ„å›¾</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_18.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_18.png"></p><h3 id="3-14-5-sendFile-ä¼˜åŒ–"><strong>3.14.5 sendFile ä¼˜åŒ–</strong></h3><ol><li><code>Linux2.1</code>Â ç‰ˆæœ¬æä¾›äº†Â <code>sendFile</code>Â å‡½æ•°ï¼Œå…¶åŸºæœ¬åŸç†å¦‚ä¸‹ï¼šæ•°æ®æ ¹æœ¬ä¸ç»è¿‡ç”¨æˆ·æ€ï¼Œç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºè¿›å…¥åˆ°Â <code>SocketBuffer</code>ï¼ŒåŒæ—¶ï¼Œç”±äºå’Œç”¨æˆ·æ€å®Œå…¨æ— å…³ï¼Œå°±å‡å°‘äº†ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>ç¤ºæ„å›¾å’Œå°ç»“</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_19.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_19.png"></p><ol><li>æç¤ºï¼šé›¶æ‹·è´ä»æ“ä½œç³»ç»Ÿè§’åº¦ï¼Œæ˜¯æ²¡æœ‰Â <code>cpu</code>Â æ‹·è´</li><li><code>Linuxåœ¨2.4</code>Â ç‰ˆæœ¬ä¸­ï¼Œåšäº†ä¸€äº›ä¿®æ”¹ï¼Œé¿å…äº†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°Â <code>Socketbuffer</code>Â çš„æ“ä½œï¼Œç›´æ¥æ‹·è´åˆ°åè®®æ ˆï¼Œä»è€Œå†ä¸€æ¬¡å‡å°‘äº†æ•°æ®æ‹·è´ã€‚å…·ä½“å¦‚ä¸‹å›¾å’Œå°ç»“ï¼š</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_20.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter03/chapter03_20.png"></p><ol><li>è¿™é‡Œå…¶å®æœ‰ä¸€æ¬¡Â <code>cpu</code>Â æ‹·è´Â <code>kernel buffer</code>Â -&gt;Â <code>socket buffer</code>Â ä½†æ˜¯ï¼Œæ‹·è´çš„ä¿¡æ¯å¾ˆå°‘ï¼Œæ¯”å¦‚Â <code>lenght</code>ã€<code>offset</code>Â æ¶ˆè€—ä½ï¼Œå¯ä»¥å¿½ç•¥</li></ol><h3 id="3-14-6-é›¶æ‹·è´çš„å†æ¬¡ç†è§£"><strong>3.14.6 é›¶æ‹·è´çš„å†æ¬¡ç†è§£</strong></h3><ol><li>æˆ‘ä»¬è¯´é›¶æ‹·è´ï¼Œæ˜¯ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥è¯´çš„ã€‚å› ä¸ºå†…æ ¸ç¼“å†²åŒºä¹‹é—´ï¼Œæ²¡æœ‰æ•°æ®æ˜¯é‡å¤çš„ï¼ˆåªæœ‰Â <code>kernel buffer</code>Â æœ‰ä¸€ä»½æ•°æ®ï¼‰ã€‚</li><li>é›¶æ‹·è´ä¸ä»…ä»…å¸¦æ¥æ›´å°‘çš„æ•°æ®å¤åˆ¶ï¼Œè¿˜èƒ½å¸¦æ¥å…¶ä»–çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œä¾‹å¦‚æ›´å°‘çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ›´å°‘çš„Â <code>CPU</code>Â ç¼“å­˜ä¼ªå…±äº«ä»¥åŠæ— Â <code>CPU</code>Â æ ¡éªŒå’Œè®¡ç®—ã€‚</li></ol><h3 id="3-14-7-mmap-å’Œ-sendFile-çš„åŒºåˆ«"><strong>3.14.7 mmap å’Œ sendFile çš„åŒºåˆ«</strong></h3><ol><li><code>mmap</code>Â é€‚åˆå°æ•°æ®é‡è¯»å†™ï¼Œ<code>sendFile</code>Â é€‚åˆå¤§æ–‡ä»¶ä¼ è¾“ã€‚</li><li><code>mmap</code>Â éœ€è¦Â <code>4</code>Â æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ<code>3</code>Â æ¬¡æ•°æ®æ‹·è´ï¼›<code>sendFile</code>Â éœ€è¦Â <code>3</code>Â æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæœ€å°‘Â <code>2</code>Â æ¬¡æ•°æ®æ‹·è´ã€‚</li><li><code>sendFile</code>Â å¯ä»¥åˆ©ç”¨Â <code>DMA</code>Â æ–¹å¼ï¼Œå‡å°‘Â <code>CPU</code>Â æ‹·è´ï¼Œ<code>mmap</code>Â åˆ™ä¸èƒ½ï¼ˆå¿…é¡»ä»å†…æ ¸æ‹·è´åˆ°Â <code>Socket</code>ç¼“å†²åŒºï¼‰ã€‚</li></ol><h3 id="3-14-8-NIO-é›¶æ‹·è´æ¡ˆä¾‹"><strong>3.14.8 NIO é›¶æ‹·è´æ¡ˆä¾‹</strong></h3><p>æ¡ˆä¾‹è¦æ±‚ï¼š</p><ol><li>ä½¿ç”¨ä¼ ç»Ÿçš„Â <code>IO</code>Â æ–¹æ³•ä¼ é€’ä¸€ä¸ªå¤§æ–‡ä»¶</li><li>ä½¿ç”¨Â <code>NIO</code>Â é›¶æ‹·è´æ–¹å¼ä¼ é€’ï¼ˆ<code>transferTo</code>ï¼‰ä¸€ä¸ªå¤§æ–‡ä»¶</li><li>çœ‹çœ‹ä¸¤ç§ä¼ é€’æ–¹å¼è€—æ—¶æ—¶é—´åˆ†åˆ«æ˜¯å¤šå°‘</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">NewIOServer.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.nio.zerocopy;</span><br><span class="line"></span><br><span class="line">import java.net.InetSocketAddress;</span><br><span class="line">import java.net.ServerSocket;</span><br><span class="line">import java.nio.ByteBuffer;</span><br><span class="line">import java.nio.channels.ServerSocketChannel;</span><br><span class="line">import java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line">//æœåŠ¡å™¨</span><br><span class="line">public class NewIOServer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        InetSocketAddress address = new InetSocketAddress(7001);</span><br><span class="line">        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">        ServerSocket serverSocket = serverSocketChannel.socket();</span><br><span class="line">        serverSocket.bind(address);</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºbuffer</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(4096);</span><br><span class="line"></span><br><span class="line">        while (true) &#123;</span><br><span class="line">            SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line">            int readcount = 0;</span><br><span class="line">            while (-1 != readcount) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    readcount = socketChannel.read(byteBuffer);</span><br><span class="line">                &#125; catch (Exception ex) &#123;</span><br><span class="line">                    // ex.printStackTrace();</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                //</span><br><span class="line">                byteBuffer.rewind(); //å€’å¸¦ position = 0 mark ä½œåºŸ</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NewIOClient.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.nio.zerocopy;</span><br><span class="line"></span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.net.InetSocketAddress;</span><br><span class="line">import java.nio.channels.FileChannel;</span><br><span class="line">import java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line">public class NewIOClient &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        SocketChannel socketChannel = SocketChannel.open();</span><br><span class="line">        socketChannel.connect(new InetSocketAddress(&quot;localhost&quot;, 7001));</span><br><span class="line">        String filename = &quot;protoc-3.6.1-win32.zip&quot;;</span><br><span class="line">        //å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶channel</span><br><span class="line">        FileChannel fileChannel = new FileInputStream(filename).getChannel();</span><br><span class="line">        //å‡†å¤‡å‘é€</span><br><span class="line">        long startTime = System.currentTimeMillis();</span><br><span class="line">        //åœ¨ linux ä¸‹ä¸€ä¸ª transferTo æ–¹æ³•å°±å¯ä»¥å®Œæˆä¼ è¾“</span><br><span class="line">        //åœ¨ windows ä¸‹ä¸€æ¬¡è°ƒç”¨ transferTo åªèƒ½å‘é€ 8m, å°±éœ€è¦åˆ†æ®µä¼ è¾“æ–‡ä»¶,è€Œä¸”è¦ä¸»è¦</span><br><span class="line">        //ä¼ è¾“æ—¶çš„ä½ç½®=ã€‹è¯¾åæ€è€ƒ...</span><br><span class="line">        //transferTo åº•å±‚ä½¿ç”¨åˆ°é›¶æ‹·è´</span><br><span class="line">        long transferCount = fileChannel.transferTo(0, fileChannel.size(), socketChannel);</span><br><span class="line">        System.out.println(&quot;å‘é€çš„æ€»çš„å­—èŠ‚æ•° = &quot; + transferCount + &quot; è€—æ—¶: &quot; + (System.currentTimeMillis() - startTime));</span><br><span class="line"></span><br><span class="line">        //å…³é—­</span><br><span class="line">        fileChannel.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="3-15-Java-AIO-åŸºæœ¬ä»‹ç»"><strong>3.15 Java AIO åŸºæœ¬ä»‹ç»</strong></h2><ol><li><code>JDK7</code>Â å¼•å…¥äº†Â <code>AsynchronousI/O</code>ï¼Œå³Â <code>AIO</code>ã€‚åœ¨è¿›è¡ŒÂ <code>I/O</code>Â ç¼–ç¨‹ä¸­ï¼Œå¸¸ç”¨åˆ°ä¸¤ç§æ¨¡å¼ï¼š<code>Reactor</code>Â å’ŒÂ <code>Proactor</code>ã€‚<code>Java</code>Â çš„Â <code>NIO</code>Â å°±æ˜¯Â <code>Reactor</code>ï¼Œå½“æœ‰äº‹ä»¶è§¦å‘æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†</li><li><code>AIO</code>Â å³Â <code>NIO2.0</code>ï¼Œå«åšå¼‚æ­¥ä¸é˜»å¡çš„Â <code>IO</code>ã€‚<code>AIO</code>Â å¼•å…¥å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº†Â <code>Proactor</code>Â æ¨¡å¼ï¼Œç®€åŒ–äº†ç¨‹åºç¼–å†™ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®Œæˆåæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹å»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºè¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨</li><li>ç›®å‰Â <code>AIO</code>Â è¿˜æ²¡æœ‰å¹¿æ³›åº”ç”¨ï¼Œ<code>Netty</code>Â ä¹Ÿæ˜¯åŸºäºÂ <code>NIO</code>ï¼Œè€Œä¸æ˜¯Â <code>AIO</code>ï¼Œå› æ­¤æˆ‘ä»¬å°±ä¸è¯¦è§£Â <code>AIO</code>Â äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒ<a href="http://www.52im.net/thread-306-1-1.html"><strong>ã€ŠJavaæ–°ä¸€ä»£ç½‘ç»œç¼–ç¨‹æ¨¡å‹AIOåŸç†åŠLinuxç³»ç»ŸAIOä»‹ç»ã€‹</strong></a></li></ol><h2 id="3-16-BIOã€NIOã€AIO-å¯¹æ¯”è¡¨"><strong>3.16 BIOã€NIOã€AIO å¯¹æ¯”è¡¨</strong></h2><table><thead><tr><th></th><th>BIO</th><th>NIO</th><th>AIO</th></tr></thead><tbody><tr><td>IOæ¨¡å‹</td><td>åŒæ­¥é˜»å¡</td><td>åŒæ­¥éé˜»å¡ï¼ˆå¤šè·¯å¤ç”¨ï¼‰</td><td>å¼‚æ­¥éé˜»å¡</td></tr><tr><td>ç¼–ç¨‹éš¾åº¦</td><td>ç®€å•</td><td>å¤æ‚</td><td>å¤æ‚</td></tr><tr><td>å¯é æ€§</td><td>å·®</td><td>å¥½</td><td>å¥½</td></tr><tr><td>ååé‡</td><td>ä½</td><td>é«˜</td><td>é«˜</td></tr></tbody></table><p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p><ol><li>åŒæ­¥é˜»å¡ï¼šåˆ°ç†å‘åº—ç†å‘ï¼Œå°±ä¸€ç›´ç­‰ç†å‘å¸ˆï¼Œç›´åˆ°è½®åˆ°è‡ªå·±ç†å‘ã€‚</li><li>åŒæ­¥éé˜»å¡ï¼šåˆ°ç†å‘åº—ç†å‘ï¼Œå‘ç°å‰é¢æœ‰å…¶å®ƒäººç†å‘ï¼Œç»™ç†å‘å¸ˆè¯´ä¸‹ï¼Œå…ˆå¹²å…¶ä»–äº‹æƒ…ï¼Œä¸€ä¼šè¿‡æ¥çœ‹æ˜¯å¦è½®åˆ°è‡ªå·±.</li><li>å¼‚æ­¥éé˜»å¡ï¼šç»™ç†å‘å¸ˆæ‰“ç”µè¯ï¼Œè®©ç†å‘å¸ˆä¸Šé—¨æœåŠ¡ï¼Œè‡ªå·±å¹²å…¶å®ƒäº‹æƒ…ï¼Œç†å‘å¸ˆè‡ªå·±æ¥å®¶ç»™ä½ ç†å‘</li></ol><h1><strong>ç¬¬ 4 ç«  Netty æ¦‚è¿°</strong></h1><h2 id="4-1-åŸç”Ÿ-NIO-å­˜åœ¨çš„é—®é¢˜"><strong>4.1 åŸç”Ÿ NIO å­˜åœ¨çš„é—®é¢˜</strong></h2><ol><li><code>NIO</code>Â çš„ç±»åº“å’ŒÂ <code>API</code>Â ç¹æ‚ï¼Œä½¿ç”¨éº»çƒ¦ï¼šéœ€è¦ç†Ÿç»ƒæŒæ¡Â <code>Selector</code>ã€<code>ServerSocketChannel</code>ã€<code>SocketChannel</code>ã€<code>ByteBuffer</code>ç­‰ã€‚</li><li>éœ€è¦å…·å¤‡å…¶ä»–çš„é¢å¤–æŠ€èƒ½ï¼šè¦ç†Ÿæ‚‰Â <code>Java</code>Â å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå› ä¸ºÂ <code>NIO</code>Â ç¼–ç¨‹æ¶‰åŠåˆ°Â <code>Reactor</code>Â æ¨¡å¼ï¼Œä½ å¿…é¡»å¯¹å¤šçº¿ç¨‹å’Œç½‘ç»œç¼–ç¨‹éå¸¸ç†Ÿæ‚‰ï¼Œæ‰èƒ½ç¼–å†™å‡ºé«˜è´¨é‡çš„Â <code>NIO</code>Â ç¨‹åºã€‚</li><li>å¼€å‘å·¥ä½œé‡å’Œéš¾åº¦éƒ½éå¸¸å¤§ï¼šä¾‹å¦‚å®¢æˆ·ç«¯é¢ä¸´æ–­è¿é‡è¿ã€ç½‘ç»œé—ªæ–­ã€åŠåŒ…è¯»å†™ã€å¤±è´¥ç¼“å­˜ã€ç½‘ç»œæ‹¥å¡å’Œå¼‚å¸¸æµçš„å¤„ç†ç­‰ç­‰ã€‚4.Â <code>JDK NIO</code>Â çš„Â <code>Bug</code>ï¼šä¾‹å¦‚è‡­åæ˜­è‘—çš„Â <code>Epoll Bug</code>ï¼Œå®ƒä¼šå¯¼è‡´Â <code>Selector</code>Â ç©ºè½®è¯¢ï¼Œæœ€ç»ˆå¯¼è‡´Â <code>CPU100%</code>ã€‚ç›´åˆ°Â <code>JDK1.7</code>Â ç‰ˆæœ¬è¯¥é—®é¢˜ä»æ—§å­˜åœ¨ï¼Œæ²¡æœ‰è¢«æ ¹æœ¬è§£å†³ã€‚</li></ol><h2 id="4-2-Netty-å®˜ç½‘è¯´æ˜"><strong>4.2 Netty å®˜ç½‘è¯´æ˜</strong></h2><p>å®˜ç½‘ï¼š<a href="https://netty.io/"><strong>https://netty.io/</strong></a></p><p>Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients.</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter04/chapter04_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter04/chapter04_01.png"></p><h2 id="4-3-Netty-çš„ä¼˜ç‚¹"><strong>4.3 Netty çš„ä¼˜ç‚¹</strong></h2><p><code>Netty</code>Â å¯¹Â <code>JDK</code>Â è‡ªå¸¦çš„Â <code>NIO</code>Â çš„Â <code>API</code>Â è¿›è¡Œäº†å°è£…ï¼Œè§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚</p><ol><li>è®¾è®¡ä¼˜é›…ï¼šé€‚ç”¨äºå„ç§ä¼ è¾“ç±»å‹çš„ç»Ÿä¸€Â <code>API</code>Â é˜»å¡å’Œéé˜»å¡Â <code>Socket</code>ï¼›åŸºäºçµæ´»ä¸”å¯æ‰©å±•çš„äº‹ä»¶æ¨¡å‹ï¼Œå¯ä»¥æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹ï¼›é«˜åº¦å¯å®šåˆ¶çš„çº¿ç¨‹æ¨¡å‹-å•çº¿ç¨‹ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ± ã€‚</li><li>ä½¿ç”¨æ–¹ä¾¿ï¼šè¯¦ç»†è®°å½•çš„Â <code>Javadoc</code>ï¼Œç”¨æˆ·æŒ‡å—å’Œç¤ºä¾‹ï¼›æ²¡æœ‰å…¶ä»–ä¾èµ–é¡¹ï¼Œ<code>JDK5ï¼ˆNetty3.xï¼‰</code>æˆ–Â <code>6ï¼ˆNetty4.xï¼‰</code>å°±è¶³å¤Ÿäº†ã€‚</li><li>é«˜æ€§èƒ½ã€ååé‡æ›´é«˜ï¼šå»¶è¿Ÿæ›´ä½ï¼›å‡å°‘èµ„æºæ¶ˆè€—ï¼›æœ€å°åŒ–ä¸å¿…è¦çš„å†…å­˜å¤åˆ¶ã€‚</li><li>å®‰å…¨ï¼šå®Œæ•´çš„Â <code>SSL/TLS</code>Â å’ŒÂ <code>StartTLS</code>Â æ”¯æŒã€‚</li><li>ç¤¾åŒºæ´»è·ƒã€ä¸æ–­æ›´æ–°ï¼šç¤¾åŒºæ´»è·ƒï¼Œç‰ˆæœ¬è¿­ä»£å‘¨æœŸçŸ­ï¼Œå‘ç°çš„Â <code>Bug</code>Â å¯ä»¥è¢«åŠæ—¶ä¿®å¤ï¼ŒåŒæ—¶ï¼Œæ›´å¤šçš„æ–°åŠŸèƒ½ä¼šè¢«åŠ å…¥ã€‚</li></ol><h2 id="4-4-Netty-ç‰ˆæœ¬è¯´æ˜"><strong>4.4 Netty ç‰ˆæœ¬è¯´æ˜</strong></h2><ol><li><code>Netty</code>Â ç‰ˆæœ¬åˆ†ä¸ºÂ <code>Netty 3.x</code>Â å’ŒÂ <code>Netty 4.x</code>ã€<code>Netty 5.x</code></li><li>å› ä¸ºÂ <code>Netty 5</code>Â å‡ºç°é‡å¤§Â <code>bug</code>ï¼Œå·²ç»è¢«å®˜ç½‘åºŸå¼ƒäº†ï¼Œç›®å‰æ¨èä½¿ç”¨çš„æ˜¯Â <code>Netty 4.x</code>çš„ç¨³å®šç‰ˆæœ¬</li><li>ç›®å‰åœ¨å®˜ç½‘å¯ä¸‹è½½çš„ç‰ˆæœ¬Â <code>Netty 3.x</code>ã€<code>Netty 4.0.x</code>Â å’ŒÂ <code>Netty 4.1.x</code></li><li>åœ¨æœ¬å¥—è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è®²è§£Â <code>Netty4.1.x</code>Â ç‰ˆæœ¬</li><li><code>Netty</code>Â ä¸‹è½½åœ°å€ï¼š<a href="https://bintray.com/netty/downloads/netty/"><strong>https://bintray.com/netty/downloads/netty/</strong></a></li></ol><h1><strong>ç¬¬ 5 ç«  Netty é«˜æ€§èƒ½æ¶æ„è®¾è®¡</strong></h1><h2 id="5-1-çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä»‹ç»"><strong>5.1 çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä»‹ç»</strong></h2><ol><li>ä¸åŒçš„çº¿ç¨‹æ¨¡å¼ï¼Œå¯¹ç¨‹åºçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œä¸ºäº†ææ¸…Â <code>Netty</code>Â çº¿ç¨‹æ¨¡å¼ï¼Œæˆ‘ä»¬æ¥ç³»ç»Ÿçš„è®²è§£ä¸‹å„ä¸ªçº¿ç¨‹æ¨¡å¼ï¼Œæœ€åçœ‹çœ‹Â <code>Netty</code>Â çº¿ç¨‹æ¨¡å‹æœ‰ä»€ä¹ˆä¼˜è¶Šæ€§ã€‚</li><li>ç›®å‰å­˜åœ¨çš„çº¿ç¨‹æ¨¡å‹æœ‰ï¼šä¼ ç»Ÿé˜»å¡Â <code>I/O</code>Â æœåŠ¡æ¨¡å‹Â <code>Reactor</code>Â æ¨¡å¼</li><li>æ ¹æ®Â <code>Reactor</code>Â çš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹çš„æ•°é‡ä¸åŒï¼Œæœ‰Â <code>3</code>Â ç§å…¸å‹çš„å®ç°å•Â <code>Reactor</code>Â å•çº¿ç¨‹ï¼›å•Â <code>Reactor</code>å¤šçº¿ç¨‹ï¼›ä¸»ä»Â <code>Reactor</code>å¤šçº¿ç¨‹</li><li><code>Netty</code>Â çº¿ç¨‹æ¨¡å¼ï¼ˆ<code>Netty</code>Â ä¸»è¦åŸºäºä¸»ä»Â <code>Reactor</code>Â å¤šçº¿ç¨‹æ¨¡å‹åšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä»Â <code>Reactor</code>Â å¤šçº¿ç¨‹æ¨¡å‹æœ‰å¤šä¸ªÂ <code>Reactor</code>ï¼‰</li></ol><h2 id="5-2-ä¼ ç»Ÿé˜»å¡-I-O-æœåŠ¡æ¨¡å‹"><strong>5.2 ä¼ ç»Ÿé˜»å¡ I/O æœåŠ¡æ¨¡å‹</strong></h2><h3 id="5-2-1-å·¥ä½œåŸç†å›¾"><strong>5.2.1 å·¥ä½œåŸç†å›¾</strong></h3><ol><li>é»„è‰²çš„æ¡†è¡¨ç¤ºå¯¹è±¡ï¼Œè“è‰²çš„æ¡†è¡¨ç¤ºçº¿ç¨‹</li><li>ç™½è‰²çš„æ¡†è¡¨ç¤ºæ–¹æ³•ï¼ˆ<code>API</code>ï¼‰</li></ol><h3 id="5-2-2-æ¨¡å‹ç‰¹ç‚¹"><strong>5.2.2 æ¨¡å‹ç‰¹ç‚¹</strong></h3><ol><li>é‡‡ç”¨é˜»å¡Â <code>IO</code>Â æ¨¡å¼è·å–è¾“å…¥çš„æ•°æ®</li><li>æ¯ä¸ªè¿æ¥éƒ½éœ€è¦ç‹¬ç«‹çš„çº¿ç¨‹å®Œæˆæ•°æ®çš„è¾“å…¥ï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®è¿”å›</li></ol><h3 id="5-2-3-é—®é¢˜åˆ†æ"><strong>5.2.3 é—®é¢˜åˆ†æ</strong></h3><ol><li>å½“å¹¶å‘æ•°å¾ˆå¤§ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œå ç”¨å¾ˆå¤§ç³»ç»Ÿèµ„æº</li><li>è¿æ¥åˆ›å»ºåï¼Œå¦‚æœå½“å‰çº¿ç¨‹æš‚æ—¶æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œè¯¥çº¿ç¨‹ä¼šé˜»å¡åœ¨Â <code>read</code>Â æ“ä½œï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_01.png"></p><h2 id="5-3-Reactor-æ¨¡å¼"><strong>5.3 Reactor æ¨¡å¼</strong></h2><h3 id="5-3-1-é’ˆå¯¹ä¼ ç»Ÿé˜»å¡-I-O-æœåŠ¡æ¨¡å‹çš„-2-ä¸ªç¼ºç‚¹ï¼Œè§£å†³æ–¹æ¡ˆï¼š"><strong>5.3.1 é’ˆå¯¹ä¼ ç»Ÿé˜»å¡ I/O æœåŠ¡æ¨¡å‹çš„ 2 ä¸ªç¼ºç‚¹ï¼Œè§£å†³æ–¹æ¡ˆï¼š</strong></h3><ol><li>åŸºäºÂ <code>I/O</code>Â å¤ç”¨æ¨¡å‹ï¼šå¤šä¸ªè¿æ¥å…±ç”¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦åœ¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ç­‰å¾…ï¼Œæ— éœ€é˜»å¡ç­‰å¾…æ‰€æœ‰è¿æ¥ã€‚å½“æŸä¸ªè¿æ¥æœ‰æ–°çš„æ•°æ®å¯ä»¥å¤„ç†æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œçº¿ç¨‹ä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†Â <code>Reactor</code>Â å¯¹åº”çš„å«æ³•ï¼š<ol><li>ååº”å™¨æ¨¡å¼</li><li>åˆ†å‘è€…æ¨¡å¼ï¼ˆDispatcherï¼‰</li><li>é€šçŸ¥è€…æ¨¡å¼ï¼ˆnotifierï¼‰</li></ol></li><li>åŸºäºçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹èµ„æºï¼šä¸å¿…å†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œå°†è¿æ¥å®Œæˆåçš„ä¸šåŠ¡å¤„ç†ä»»åŠ¡åˆ†é…ç»™çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ã€‚</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_02.png"></p><h3 id="5-3-2-I-O-å¤ç”¨ç»“åˆçº¿ç¨‹æ± ï¼Œå°±æ˜¯-Reactor-æ¨¡å¼åŸºæœ¬è®¾è®¡æ€æƒ³ï¼Œå¦‚å›¾"><strong>5.3.2 I/O å¤ç”¨ç»“åˆçº¿ç¨‹æ± ï¼Œå°±æ˜¯ Reactor æ¨¡å¼åŸºæœ¬è®¾è®¡æ€æƒ³ï¼Œå¦‚å›¾</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_03.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_03.png"></p><p>å¯¹ä¸Šå›¾è¯´æ˜ï¼š</p><ol><li><code>Reactor</code>Â æ¨¡å¼ï¼Œé€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥åŒæ—¶ä¼ é€’ç»™æœåŠ¡å¤„ç†å™¨çš„æ¨¡å¼ï¼ˆåŸºäºäº‹ä»¶é©±åŠ¨ï¼‰</li><li>æœåŠ¡å™¨ç«¯ç¨‹åºå¤„ç†ä¼ å…¥çš„å¤šä¸ªè¯·æ±‚,å¹¶å°†å®ƒä»¬åŒæ­¥åˆ†æ´¾åˆ°ç›¸åº”çš„å¤„ç†çº¿ç¨‹ï¼Œå› æ­¤Â <code>Reactor</code>Â æ¨¡å¼ä¹Ÿå«Â <code>Dispatcher</code>Â æ¨¡å¼</li><li><code>Reactor</code>Â æ¨¡å¼ä½¿ç”¨Â <code>IO</code>Â å¤ç”¨ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œåˆ†å‘ç»™æŸä¸ªçº¿ç¨‹ï¼ˆè¿›ç¨‹ï¼‰ï¼Œè¿™ç‚¹å°±æ˜¯ç½‘ç»œæœåŠ¡å™¨é«˜å¹¶å‘å¤„ç†å…³é”®</li></ol><h3 id="5-3-3-Reactor-æ¨¡å¼ä¸­æ ¸å¿ƒç»„æˆ"><strong>5.3.3 Reactor æ¨¡å¼ä¸­æ ¸å¿ƒç»„æˆ</strong></h3><ol><li><code>Reactor</code>ï¼š<code>Reactor</code>Â åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œè´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œåˆ†å‘ç»™é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å¯¹Â <code>IO</code>Â äº‹ä»¶åšå‡ºååº”ã€‚å®ƒå°±åƒå…¬å¸çš„ç”µè¯æ¥çº¿å‘˜ï¼Œå®ƒæ¥å¬æ¥è‡ªå®¢æˆ·çš„ç”µè¯å¹¶å°†çº¿è·¯è½¬ç§»åˆ°é€‚å½“çš„è”ç³»äººï¼›</li><li><code>Handlers</code>ï¼šå¤„ç†ç¨‹åºæ‰§è¡ŒÂ <code>I/O</code>Â äº‹ä»¶è¦å®Œæˆçš„å®é™…äº‹ä»¶ï¼Œç±»ä¼¼äºå®¢æˆ·æƒ³è¦ä¸ä¹‹äº¤è°ˆçš„å…¬å¸ä¸­çš„å®é™…å®˜å‘˜ã€‚<code>Reactor</code>Â é€šè¿‡è°ƒåº¦é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å“åº”Â <code>I/O</code>Â äº‹ä»¶ï¼Œå¤„ç†ç¨‹åºæ‰§è¡Œéé˜»å¡æ“ä½œã€‚</li></ol><h3 id="5-3-4-Reactor-æ¨¡å¼åˆ†ç±»"><strong>5.3.4 Reactor æ¨¡å¼åˆ†ç±»</strong></h3><p>æ ¹æ®Â <code>Reactor</code>Â çš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹çš„æ•°é‡ä¸åŒï¼Œæœ‰Â <code>3</code>Â ç§å…¸å‹çš„å®ç°</p><ol><li>å•Â <code>Reactor</code>Â å•çº¿ç¨‹</li><li>å•Â <code>Reactor</code>Â å¤šçº¿ç¨‹</li><li>ä¸»ä»Â <code>Reactor</code>Â å¤šçº¿ç¨‹</li></ol><h2 id="5-4-å•-Reactor-å•çº¿ç¨‹"><strong>5.4 å• Reactor å•çº¿ç¨‹</strong></h2><p>åŸç†å›¾ï¼Œå¹¶ä½¿ç”¨Â <code>NIO</code>Â ç¾¤èŠç³»ç»ŸéªŒè¯</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_04.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_04.png"></p><h3 id="5-4-1-æ–¹æ¡ˆè¯´æ˜"><strong>5.4.1 æ–¹æ¡ˆè¯´æ˜</strong></h3><ol><li><code>Select</code>Â æ˜¯å‰é¢Â <code>I/O</code>Â å¤ç”¨æ¨¡å‹ä»‹ç»çš„æ ‡å‡†ç½‘ç»œç¼–ç¨‹Â <code>API</code>ï¼Œå¯ä»¥å®ç°åº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªé˜»å¡å¯¹è±¡ç›‘å¬å¤šè·¯è¿æ¥è¯·æ±‚</li><li><code>Reactor</code>Â å¯¹è±¡é€šè¿‡Â <code>Select</code>Â ç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡Â <code>Dispatch</code>Â è¿›è¡Œåˆ†å‘</li><li>å¦‚æœæ˜¯å»ºç«‹è¿æ¥è¯·æ±‚äº‹ä»¶ï¼Œåˆ™ç”±Â <code>Acceptor</code>Â é€šè¿‡Â <code>Accept</code>Â å¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªÂ <code>Handler</code>Â å¯¹è±¡å¤„ç†è¿æ¥å®Œæˆåçš„åç»­ä¸šåŠ¡å¤„ç†</li><li>å¦‚æœä¸æ˜¯å»ºç«‹è¿æ¥äº‹ä»¶ï¼Œåˆ™Â <code>Reactor</code>Â ä¼šåˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„Â <code>Handler</code>Â æ¥å“åº”</li><li><code>Handler</code>Â ä¼šå®ŒæˆÂ <code>Read</code>Â â†’ ä¸šåŠ¡å¤„ç† â†’Â <code>Send</code>Â çš„å®Œæ•´ä¸šåŠ¡æµç¨‹</li></ol><p>ç»“åˆå®ä¾‹ï¼šæœåŠ¡å™¨ç«¯ç”¨ä¸€ä¸ªçº¿ç¨‹é€šè¿‡å¤šè·¯å¤ç”¨æå®šæ‰€æœ‰çš„Â <code>IO</code>Â æ“ä½œï¼ˆåŒ…æ‹¬è¿æ¥ï¼Œè¯»ã€å†™ç­‰ï¼‰ï¼Œç¼–ç ç®€å•ï¼Œæ¸…æ™°æ˜äº†ï¼Œä½†æ˜¯å¦‚æœå®¢æˆ·ç«¯è¿æ¥æ•°é‡è¾ƒå¤šï¼Œå°†æ— æ³•æ”¯æ’‘ï¼Œå‰é¢çš„Â <code>NIO</code>Â æ¡ˆä¾‹å°±å±äºè¿™ç§æ¨¡å‹ã€‚</p><h3 id="5-4-2-æ–¹æ¡ˆä¼˜ç¼ºç‚¹åˆ†æ"><strong>5.4.2 æ–¹æ¡ˆä¼˜ç¼ºç‚¹åˆ†æ</strong></h3><ol><li>ä¼˜ç‚¹ï¼šæ¨¡å‹ç®€å•ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹ã€è¿›ç¨‹é€šä¿¡ã€ç«äº‰çš„é—®é¢˜ï¼Œå…¨éƒ¨éƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆ</li><li>ç¼ºç‚¹ï¼šæ€§èƒ½é—®é¢˜ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ— æ³•å®Œå…¨å‘æŒ¥å¤šæ ¸Â <code>CPU</code>Â çš„æ€§èƒ½ã€‚<code>Handler</code>åœ¨å¤„ç†æŸä¸ªè¿æ¥ä¸Šçš„ä¸šåŠ¡æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ— æ³•å¤„ç†å…¶ä»–è¿æ¥äº‹ä»¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆ</li><li>ç¼ºç‚¹ï¼šå¯é æ€§é—®é¢˜ï¼Œçº¿ç¨‹æ„å¤–ç»ˆæ­¢ï¼Œæˆ–è€…è¿›å…¥æ­»å¾ªç¯ï¼Œä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿé€šä¿¡æ¨¡å—ä¸å¯ç”¨ï¼Œä¸èƒ½æ¥æ”¶å’Œå¤„ç†å¤–éƒ¨æ¶ˆæ¯ï¼Œé€ æˆèŠ‚ç‚¹æ•…éšœ</li><li>ä½¿ç”¨åœºæ™¯ï¼šå®¢æˆ·ç«¯çš„æ•°é‡æœ‰é™ï¼Œä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿï¼Œæ¯”å¦‚Â <code>Redis</code>Â åœ¨ä¸šåŠ¡å¤„ç†çš„æ—¶é—´å¤æ‚åº¦Â <code>O(1)</code>Â çš„æƒ…å†µ</li></ol><h2 id="5-5-å•-Reactor-å¤šçº¿ç¨‹"><strong>5.5 å• Reactor å¤šçº¿ç¨‹</strong></h2><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_05.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_05.png"></p><h3 id="5-5-1-åŸç†å›¾"><strong>5.5.1 åŸç†å›¾</strong></h3><h3 id="5-5-2-å¯¹ä¸Šå›¾çš„å°ç»“"><strong>5.5.2 å¯¹ä¸Šå›¾çš„å°ç»“</strong></h3><ol><li><code>Reactor</code>Â å¯¹è±¡é€šè¿‡Â <code>Select</code>Â ç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡Â <code>Dispatch</code>Â è¿›è¡Œåˆ†å‘</li><li>å¦‚æœå»ºç«‹è¿æ¥è¯·æ±‚ï¼Œåˆ™å³Â <code>Acceptor</code>Â é€šè¿‡Â <code>accept</code>Â å¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªÂ <code>Handler</code>Â å¯¹è±¡å¤„ç†å®Œæˆè¿æ¥åçš„å„ç§äº‹ä»¶</li><li>å¦‚æœä¸æ˜¯è¿æ¥è¯·æ±‚ï¼Œåˆ™ç”±Â <code>Reactor</code>Â åˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„Â <code>handler</code>Â æ¥å¤„ç†</li><li><code>handler</code>Â åªè´Ÿè´£å“åº”äº‹ä»¶ï¼Œä¸åšå…·ä½“çš„ä¸šåŠ¡å¤„ç†ï¼Œé€šè¿‡Â <code>read</code>Â è¯»å–æ•°æ®åï¼Œä¼šåˆ†å‘ç»™åé¢çš„Â <code>worker</code>Â çº¿ç¨‹æ± çš„æŸä¸ªçº¿ç¨‹å¤„ç†ä¸šåŠ¡</li><li><code>worker</code>Â çº¿ç¨‹æ± ä¼šåˆ†é…ç‹¬ç«‹çº¿ç¨‹å®ŒæˆçœŸæ­£çš„ä¸šåŠ¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™Â <code>handler</code></li><li><code>handler</code>Â æ”¶åˆ°å“åº”åï¼Œé€šè¿‡Â <code>send</code>Â å°†ç»“æœè¿”å›ç»™Â <code>client</code></li></ol><h3 id="5-5-3-æ–¹æ¡ˆä¼˜ç¼ºç‚¹åˆ†æ"><strong>5.5.3 æ–¹æ¡ˆä¼˜ç¼ºç‚¹åˆ†æ</strong></h3><ol><li>ä¼˜ç‚¹ï¼šå¯ä»¥å……åˆ†çš„åˆ©ç”¨å¤šæ ¸Â <code>cpu</code>Â çš„å¤„ç†èƒ½åŠ›</li><li>ç¼ºç‚¹ï¼šå¤šçº¿ç¨‹æ•°æ®å…±äº«å’Œè®¿é—®æ¯”è¾ƒå¤æ‚ï¼Œ<code>Reactor</code>Â å¤„ç†æ‰€æœ‰çš„äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œåœ¨å•çº¿ç¨‹è¿è¡Œï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯å®¹æ˜“å‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚</li></ol><h2 id="5-6-ä¸»ä»-Reactor-å¤šçº¿ç¨‹"><strong>5.6 ä¸»ä» Reactor å¤šçº¿ç¨‹</strong></h2><h3 id="5-6-1-å·¥ä½œåŸç†å›¾"><strong>5.6.1 å·¥ä½œåŸç†å›¾</strong></h3><p>é’ˆå¯¹å•Â <code>Reactor</code>Â å¤šçº¿ç¨‹æ¨¡å‹ä¸­ï¼Œ<code>Reactor</code>Â åœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¯ä»¥è®©Â <code>Reactor</code>Â åœ¨å¤šçº¿ç¨‹ä¸­è¿è¡Œ</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_06.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_06.png"></p><h3 id="5-6-2-ä¸Šå›¾çš„æ–¹æ¡ˆè¯´æ˜"><strong>5.6.2 ä¸Šå›¾çš„æ–¹æ¡ˆè¯´æ˜</strong></h3><ol><li><code>Reactor</code>Â ä¸»çº¿ç¨‹Â <code>MainReactor</code>Â å¯¹è±¡é€šè¿‡Â <code>select</code>Â ç›‘å¬è¿æ¥äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡Â <code>Acceptor</code>Â å¤„ç†è¿æ¥äº‹ä»¶</li><li>å½“Â <code>Acceptor</code>Â å¤„ç†è¿æ¥äº‹ä»¶åï¼Œ<code>MainReactor</code>Â å°†è¿æ¥åˆ†é…ç»™Â <code>SubReactor</code></li><li><code>subreactor</code>Â å°†è¿æ¥åŠ å…¥åˆ°è¿æ¥é˜Ÿåˆ—è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»ºÂ <code>handler</code>Â è¿›è¡Œå„ç§äº‹ä»¶å¤„ç†</li><li>å½“æœ‰æ–°äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ<code>subreactor</code>Â å°±ä¼šè°ƒç”¨å¯¹åº”çš„Â <code>handler</code>Â å¤„ç†</li><li><code>handler</code>Â é€šè¿‡Â <code>read</code>Â è¯»å–æ•°æ®ï¼Œåˆ†å‘ç»™åé¢çš„Â <code>worker</code>Â çº¿ç¨‹å¤„ç†</li><li><code>worker</code>Â çº¿ç¨‹æ± åˆ†é…ç‹¬ç«‹çš„Â <code>worker</code>Â çº¿ç¨‹è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¹¶è¿”å›ç»“æœ</li><li><code>handler</code>Â æ”¶åˆ°å“åº”çš„ç»“æœåï¼Œå†é€šè¿‡Â <code>send</code>Â å°†ç»“æœè¿”å›ç»™Â <code>client</code></li><li><code>Reactor</code>Â ä¸»çº¿ç¨‹å¯ä»¥å¯¹åº”å¤šä¸ªÂ <code>Reactor</code>Â å­çº¿ç¨‹ï¼Œå³Â <code>MainRecator</code>Â å¯ä»¥å…³è”å¤šä¸ªÂ <code>SubReactor</code></li></ol><h3 id="5-6-3-Scalable-IO-in-Java-å¯¹-Multiple-Reactors-çš„åŸç†å›¾è§£ï¼š"><strong>5.6.3 Scalable IO in Java å¯¹ Multiple Reactors çš„åŸç†å›¾è§£ï¼š</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_07.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_07.png"></p><h3 id="5-6-4-æ–¹æ¡ˆä¼˜ç¼ºç‚¹è¯´æ˜"><strong>5.6.4 æ–¹æ¡ˆä¼˜ç¼ºç‚¹è¯´æ˜</strong></h3><ol><li>ä¼˜ç‚¹ï¼šçˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•èŒè´£æ˜ç¡®ï¼Œçˆ¶çº¿ç¨‹åªéœ€è¦æ¥æ”¶æ–°è¿æ¥ï¼Œå­çº¿ç¨‹å®Œæˆåç»­çš„ä¸šåŠ¡å¤„ç†ã€‚</li><li>ä¼˜ç‚¹ï¼šçˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•ï¼Œ<code>Reactor</code>Â ä¸»çº¿ç¨‹åªéœ€è¦æŠŠæ–°è¿æ¥ä¼ ç»™å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹æ— éœ€è¿”å›æ•°æ®ã€‚</li><li>ç¼ºç‚¹ï¼šç¼–ç¨‹å¤æ‚åº¦è¾ƒé«˜</li><li>ç»“åˆå®ä¾‹ï¼šè¿™ç§æ¨¡å‹åœ¨è®¸å¤šé¡¹ç›®ä¸­å¹¿æ³›ä½¿ç”¨ï¼ŒåŒ…æ‹¬Â <code>Nginx</code>Â ä¸»ä»Â <code>Reactor</code>Â å¤šè¿›ç¨‹æ¨¡å‹ï¼Œ<code>Memcached</code>Â ä¸»ä»å¤šçº¿ç¨‹ï¼Œ<code>Netty</code>Â ä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹çš„æ”¯æŒ</li></ol><h2 id="5-7-Reactor-æ¨¡å¼å°ç»“"><strong>5.7 Reactor æ¨¡å¼å°ç»“</strong></h2><h3 id="5-7-1-3-ç§æ¨¡å¼ç”¨ç”Ÿæ´»æ¡ˆä¾‹æ¥ç†è§£"><strong>5.7.1 3 ç§æ¨¡å¼ç”¨ç”Ÿæ´»æ¡ˆä¾‹æ¥ç†è§£</strong></h3><ol><li>å•Â <code>Reactor</code>Â å•çº¿ç¨‹ï¼Œå‰å°æ¥å¾…å‘˜å’ŒæœåŠ¡å‘˜æ˜¯åŒä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡</li><li>å•Â <code>Reactor</code>Â å¤šçº¿ç¨‹ï¼Œ<code>1</code>Â ä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜ï¼Œæ¥å¾…å‘˜åªè´Ÿè´£æ¥å¾…</li><li>ä¸»ä»Â <code>Reactor</code>Â å¤šçº¿ç¨‹ï¼Œå¤šä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡ç”Ÿ</li></ol><h3 id="5-7-2-Reactor-æ¨¡å¼å…·æœ‰å¦‚ä¸‹çš„ä¼˜ç‚¹"><strong>5.7.2 Reactor æ¨¡å¼å…·æœ‰å¦‚ä¸‹çš„ä¼˜ç‚¹</strong></h3><ol><li>å“åº”å¿«ï¼Œä¸å¿…ä¸ºå•ä¸ªåŒæ­¥æ—¶é—´æ‰€é˜»å¡ï¼Œè™½ç„¶Â <code>Reactor</code>Â æœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„</li><li>å¯ä»¥æœ€å¤§ç¨‹åº¦çš„é¿å…å¤æ‚çš„å¤šçº¿ç¨‹åŠåŒæ­¥é—®é¢˜ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹/è¿›ç¨‹çš„åˆ‡æ¢å¼€é”€</li><li>æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥æ–¹ä¾¿çš„é€šè¿‡å¢åŠ Â <code>Reactor</code>Â å®ä¾‹ä¸ªæ•°æ¥å……åˆ†åˆ©ç”¨Â <code>CPU</code>Â èµ„æº</li><li>å¤ç”¨æ€§å¥½ï¼Œ<code>Reactor</code>Â æ¨¡å‹æœ¬èº«ä¸å…·ä½“äº‹ä»¶å¤„ç†é€»è¾‘æ— å…³ï¼Œå…·æœ‰å¾ˆé«˜çš„å¤ç”¨æ€§</li></ol><h2 id="5-8-Netty-æ¨¡å‹"><strong>5.8 Netty æ¨¡å‹</strong></h2><h3 id="5-8-1-å·¥ä½œåŸç†ç¤ºæ„å›¾1-ç®€å•ç‰ˆ"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter05?id=_581-%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e7%a4%ba%e6%84%8f%e5%9b%be1-%e7%ae%80%e5%8d%95%e7%89%88"><strong>5.8.1 å·¥ä½œåŸç†ç¤ºæ„å›¾1 - ç®€å•ç‰ˆ</strong></a></h3><p><code>Netty</code>Â ä¸»è¦åŸºäºä¸»ä»Â <code>Reactors</code>Â å¤šçº¿ç¨‹æ¨¡å‹ï¼ˆå¦‚å›¾ï¼‰åšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä»Â <code>Reactor</code>Â å¤šçº¿ç¨‹æ¨¡å‹æœ‰å¤šä¸ªÂ <code>Reactor</code></p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_08.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_08.png"></p><h3 id="5-8-2-å¯¹ä¸Šå›¾è¯´æ˜"><strong>5.8.2 å¯¹ä¸Šå›¾è¯´æ˜</strong></h3><ol><li><code>BossGroup</code>Â çº¿ç¨‹ç»´æŠ¤Â <code>Selector</code>ï¼Œåªå…³æ³¨Â <code>Accecpt</code></li><li>å½“æ¥æ”¶åˆ°Â <code>Accept</code>Â äº‹ä»¶ï¼Œè·å–åˆ°å¯¹åº”çš„Â <code>SocketChannel</code>ï¼Œå°è£…æˆÂ <code>NIOScoketChannel</code>Â å¹¶æ³¨å†Œåˆ°Â <code>Worker</code>Â çº¿ç¨‹ï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ï¼Œå¹¶è¿›è¡Œç»´æŠ¤</li><li>å½“Â <code>Worker</code>Â çº¿ç¨‹ç›‘å¬åˆ°Â <code>Selector</code>Â ä¸­é€šé“å‘ç”Ÿè‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶åï¼Œå°±è¿›è¡Œå¤„ç†ï¼ˆå°±ç”±Â <code>handler</code>ï¼‰ï¼Œæ³¨æ„Â <code>handler</code>Â å·²ç»åŠ å…¥åˆ°é€šé“</li></ol><h3 id="5-8-3-å·¥ä½œåŸç†ç¤ºæ„å›¾2-è¿›é˜¶ç‰ˆ"><strong>5.8.3 å·¥ä½œåŸç†ç¤ºæ„å›¾2 - è¿›é˜¶ç‰ˆ</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_09.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_09.png"></p><h3 id="5-8-4-å·¥ä½œåŸç†ç¤ºæ„å›¾-è¯¦ç»†ç‰ˆ"><strong>5.8.4 å·¥ä½œåŸç†ç¤ºæ„å›¾ - è¯¦ç»†ç‰ˆ</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_10.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_10.png"></p><h3 id="5-8-5-å¯¹ä¸Šå›¾çš„è¯´æ˜å°ç»“"><strong>5.8.5 å¯¹ä¸Šå›¾çš„è¯´æ˜å°ç»“</strong></h3><ol><li><code>Netty</code>Â æŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ± Â <code>BossGroup</code>Â ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œ<code>WorkerGroup</code>Â ä¸“é—¨è´Ÿè´£ç½‘ç»œçš„è¯»å†™</li><li><code>BossGroup</code>Â å’ŒÂ <code>WorkerGroup</code>Â ç±»å‹éƒ½æ˜¯Â <code>NioEventLoopGroup</code></li><li><code>NioEventLoopGroup</code>Â ç›¸å½“äºä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„ï¼Œè¿™ä¸ªç»„ä¸­å«æœ‰å¤šä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ˜¯Â <code>NioEventLoop</code></li><li><code>NioEventLoop</code>Â è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªç¯çš„æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ¯ä¸ªÂ <code>NioEventLoop</code>Â éƒ½æœ‰ä¸€ä¸ªÂ <code>Selector</code>ï¼Œç”¨äºç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„Â <code>socket</code>Â çš„ç½‘ç»œé€šè®¯</li><li><code>NioEventLoopGroup</code>Â å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå³å¯ä»¥å«æœ‰å¤šä¸ªÂ <code>NioEventLoop</code></li><li>æ¯ä¸ªÂ <code>BossNioEventLoop</code>Â å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤æœ‰Â <code>3</code>Â æ­¥<ul><li>è½®è¯¢Â <code>accept</code>Â äº‹ä»¶</li><li>å¤„ç†Â <code>accept</code>Â äº‹ä»¶ï¼Œä¸Â <code>client</code>Â å»ºç«‹è¿æ¥ï¼Œç”ŸæˆÂ <code>NioScocketChannel</code>ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°æŸä¸ªÂ <code>worker</code>Â <code>NIOEventLoop</code>Â ä¸Šçš„Â <code>Selector</code></li><li>å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³Â <code>runAllTasks</code></li></ul></li><li>æ¯ä¸ªÂ <code>Worker</code>Â <code>NIOEventLoop</code>Â å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤<ul><li>è½®è¯¢Â <code>read</code>ï¼Œ<code>write</code>Â äº‹ä»¶</li><li>å¤„ç†Â <code>I/O</code>Â äº‹ä»¶ï¼Œå³Â <code>read</code>ï¼Œ<code>write</code>Â äº‹ä»¶ï¼Œåœ¨å¯¹åº”Â <code>NioScocketChannel</code>Â å¤„ç†</li><li>å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³Â <code>runAllTasks</code></li></ul></li><li>æ¯ä¸ªÂ <code>Worker</code>Â <code>NIOEventLoop</code>Â å¤„ç†ä¸šåŠ¡æ—¶ï¼Œä¼šä½¿ç”¨Â <code>pipeline</code>ï¼ˆç®¡é“ï¼‰ï¼Œ<code>pipeline</code>Â ä¸­åŒ…å«äº†Â <code>channel</code>ï¼Œå³é€šè¿‡Â <code>pipeline</code>Â å¯ä»¥è·å–åˆ°å¯¹åº”é€šé“ï¼Œç®¡é“ä¸­ç»´æŠ¤äº†å¾ˆå¤šçš„å¤„ç†å™¨</li></ol><h3 id="5-8-6-Netty-å¿«é€Ÿå…¥é—¨å®ä¾‹-TCP-æœåŠ¡"><strong>5.8.6 Netty å¿«é€Ÿå…¥é—¨å®ä¾‹ - TCP æœåŠ¡</strong></h3><p>å®ä¾‹è¦æ±‚ï¼šä½¿ç”¨Â <code>IDEA</code>Â åˆ›å»ºÂ <code>Netty</code>Â é¡¹ç›®</p><ol><li><code>Netty</code>Â æœåŠ¡å™¨åœ¨Â <code>6668</code>Â ç«¯å£ç›‘å¬ï¼Œå®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨&quot;hello,æœåŠ¡å™¨~&quot;</li><li>æœåŠ¡å™¨å¯ä»¥å›å¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯&quot;hello,å®¢æˆ·ç«¯~&quot;</li><li>ç›®çš„ï¼šå¯¹Â <code>Netty</code>Â çº¿ç¨‹æ¨¡å‹æœ‰ä¸€ä¸ªåˆæ­¥è®¤è¯†ï¼Œä¾¿äºç†è§£Â <code>Netty</code>Â æ¨¡å‹ç†è®º</li><li>çœ‹è€å¸ˆä»£ç æ¼”ç¤º 5.1 ç¼–å†™æœåŠ¡ç«¯ 5.2 ç¼–å†™å®¢æˆ·ç«¯ 5.3 å¯¹Â <code>netty</code>Â ç¨‹åºè¿›è¡Œåˆ†æï¼Œçœ‹çœ‹Â <code>netty</code>Â æ¨¡å‹ç‰¹ç‚¹ è¯´æ˜ï¼šåˆ›å»ºÂ <code>Maven</code>Â é¡¹ç›®ï¼Œå¹¶å¼•å…¥Â <code>Netty</code>Â åŒ…</li><li>ä»£ç å¦‚ä¸‹</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">NettyServer.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.simple;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.ServerBootstrap;</span><br><span class="line">import io.netty.channel.ChannelFuture;</span><br><span class="line">import io.netty.channel.ChannelFutureListener;</span><br><span class="line">import io.netty.channel.ChannelInitializer;</span><br><span class="line">import io.netty.channel.ChannelOption;</span><br><span class="line">import io.netty.channel.EventLoopGroup;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line">public class NettyServer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºBossGroup å’Œ WorkerGroup</span><br><span class="line">        //è¯´æ˜</span><br><span class="line">        //1. åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„ bossGroup å’Œ workerGroup</span><br><span class="line">        //2. bossGroup åªæ˜¯å¤„ç†è¿æ¥è¯·æ±‚ , çœŸæ­£çš„å’Œå®¢æˆ·ç«¯ä¸šåŠ¡å¤„ç†ï¼Œä¼šäº¤ç»™ workerGroupå®Œæˆ</span><br><span class="line">        //3. ä¸¤ä¸ªéƒ½æ˜¯æ— é™å¾ªç¯</span><br><span class="line">        //4. bossGroup å’Œ workerGroup å«æœ‰çš„å­çº¿ç¨‹(NioEventLoop)çš„ä¸ªæ•°</span><br><span class="line">        //   é»˜è®¤å®é™… cpuæ ¸æ•° * 2</span><br><span class="line">        EventLoopGroup bossGroup = new NioEventLoopGroup(1);</span><br><span class="line">        EventLoopGroup workerGroup = new NioEventLoopGroup(); //8</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            //åˆ›å»ºæœåŠ¡å™¨ç«¯çš„å¯åŠ¨å¯¹è±¡ï¼Œé…ç½®å‚æ•°</span><br><span class="line">            ServerBootstrap bootstrap = new ServerBootstrap();</span><br><span class="line">            //ä½¿ç”¨é“¾å¼ç¼–ç¨‹æ¥è¿›è¡Œè®¾ç½®</span><br><span class="line">            bootstrap.group(bossGroup, workerGroup) //è®¾ç½®ä¸¤ä¸ªçº¿ç¨‹ç»„</span><br><span class="line">                    .channel(NioServerSocketChannel.class) //ä½¿ç”¨NioSocketChannel ä½œä¸ºæœåŠ¡å™¨çš„é€šé“å®ç°</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, 128) // è®¾ç½®çº¿ç¨‹é˜Ÿåˆ—å¾—åˆ°è¿æ¥ä¸ªæ•°</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, true) //è®¾ç½®ä¿æŒæ´»åŠ¨è¿æ¥çŠ¶æ€</span><br><span class="line">            //          .handler(null) // è¯¥ handlerå¯¹åº” bossGroup , childHandler å¯¹åº” workerGroup</span><br><span class="line">                    .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;//åˆ›å»ºä¸€ä¸ªé€šé“åˆå§‹åŒ–å¯¹è±¡(åŒ¿åå¯¹è±¡)</span><br><span class="line">                        //ç»™pipeline è®¾ç½®å¤„ç†å™¨</span><br><span class="line">                        @Override</span><br><span class="line">                        protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                            System.out.println(&quot;å®¢æˆ·socketchannel hashcode=&quot; + ch.hashCode()); //å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé›†åˆç®¡ç† SocketChannelï¼Œ å†æ¨é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥å°†ä¸šåŠ¡åŠ å…¥åˆ°å„ä¸ªchannel å¯¹åº”çš„ NIOEventLoop çš„ taskQueue æˆ–è€… scheduleTaskQueue</span><br><span class="line">                            ch.pipeline().addLast(new NettyServerHandler());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;); // ç»™æˆ‘ä»¬çš„workerGroup çš„ EventLoop å¯¹åº”çš„ç®¡é“è®¾ç½®å¤„ç†å™¨</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;.....æœåŠ¡å™¨ is ready...&quot;);</span><br><span class="line"></span><br><span class="line">            //ç»‘å®šä¸€ä¸ªç«¯å£å¹¶ä¸”åŒæ­¥, ç”Ÿæˆäº†ä¸€ä¸ª ChannelFuture å¯¹è±¡</span><br><span class="line">            //å¯åŠ¨æœåŠ¡å™¨(å¹¶ç»‘å®šç«¯å£)</span><br><span class="line">            ChannelFuture cf = bootstrap.bind(6668).sync();</span><br><span class="line"></span><br><span class="line">            //ç»™cf æ³¨å†Œç›‘å¬å™¨ï¼Œç›‘æ§æˆ‘ä»¬å…³å¿ƒçš„äº‹ä»¶</span><br><span class="line"></span><br><span class="line">            cf.addListener(new ChannelFutureListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void operationComplete(ChannelFuture future) throws Exception &#123;</span><br><span class="line">                    if (cf.isSuccess()) &#123;</span><br><span class="line">                        System.out.println(&quot;ç›‘å¬ç«¯å£ 6668 æˆåŠŸ&quot;);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        System.out.println(&quot;ç›‘å¬ç«¯å£ 6668 å¤±è´¥&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            //å¯¹å…³é—­é€šé“è¿›è¡Œç›‘å¬</span><br><span class="line">            cf.channel().closeFuture().sync();</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NettyServerHandler.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.simple;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.buffer.Unpooled;</span><br><span class="line">import io.netty.channel.Channel;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line">import io.netty.channel.ChannelPipeline;</span><br><span class="line">import io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¯´æ˜</span><br><span class="line"> * 1. æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªHandler éœ€è¦ç»§ç»­netty è§„å®šå¥½çš„æŸä¸ªHandlerAdapter(è§„èŒƒ)</span><br><span class="line"> * 2. è¿™æ—¶æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªHandler , æ‰èƒ½ç§°ä¸ºä¸€ä¸ªhandler</span><br><span class="line"> */</span><br><span class="line">public class NettyServerHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    //è¯»å–æ•°æ®å®é™…(è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯)</span><br><span class="line">    /**</span><br><span class="line">     * 1. ChannelHandlerContext ctx:ä¸Šä¸‹æ–‡å¯¹è±¡, å«æœ‰ ç®¡é“pipeline , é€šé“channel, åœ°å€</span><br><span class="line">     * 2. Object msg: å°±æ˜¯å®¢æˆ·ç«¯å‘é€çš„æ•°æ® é»˜è®¤Object</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨è¯»å–çº¿ç¨‹ &quot; + Thread.currentThread().getName() + &quot; channle =&quot; + ctx.channel());</span><br><span class="line">        System.out.println(&quot;server ctx =&quot; + ctx);</span><br><span class="line">        System.out.println(&quot;çœ‹çœ‹channel å’Œ pipelineçš„å…³ç³»&quot;);</span><br><span class="line">        Channel channel = ctx.channel();</span><br><span class="line">        ChannelPipeline pipeline = ctx.pipeline(); //æœ¬è´¨æ˜¯ä¸€ä¸ªåŒå‘é“¾æ¥, å‡ºç«™å…¥ç«™</span><br><span class="line"></span><br><span class="line">        //å°† msg è½¬æˆä¸€ä¸ª ByteBuf</span><br><span class="line">        //ByteBuf æ˜¯ Netty æä¾›çš„ï¼Œä¸æ˜¯ NIO çš„ ByteBuffer.</span><br><span class="line">        ByteBuf buf = (ByteBuf) msg;</span><br><span class="line">        System.out.println(&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯:&quot; + buf.toString(CharsetUtil.UTF_8));</span><br><span class="line">        System.out.println(&quot;å®¢æˆ·ç«¯åœ°å€:&quot; + channel.remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æ•°æ®è¯»å–å®Œæ¯•</span><br><span class="line">    @Override</span><br><span class="line">    public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        //writeAndFlush æ˜¯ write + flush</span><br><span class="line">        //å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–°</span><br><span class="line">        //ä¸€èˆ¬è®²ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªå‘é€çš„æ•°æ®è¿›è¡Œç¼–ç </span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ1&quot;, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å¤„ç†å¼‚å¸¸, ä¸€èˆ¬æ˜¯éœ€è¦å…³é—­é€šé“</span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NettyClient.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.simple;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.Bootstrap;</span><br><span class="line">import io.netty.channel.ChannelFuture;</span><br><span class="line">import io.netty.channel.ChannelInitializer;</span><br><span class="line">import io.netty.channel.EventLoopGroup;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"></span><br><span class="line">public class NettyClient &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //å®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„</span><br><span class="line">        EventLoopGroup group = new NioEventLoopGroup();</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            //åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡</span><br><span class="line">            //æ³¨æ„å®¢æˆ·ç«¯ä½¿ç”¨çš„ä¸æ˜¯ ServerBootstrap è€Œæ˜¯ Bootstrap</span><br><span class="line">            Bootstrap bootstrap = new Bootstrap();</span><br><span class="line">            //è®¾ç½®ç›¸å…³å‚æ•°</span><br><span class="line">            bootstrap.group(group) //è®¾ç½®çº¿ç¨‹ç»„</span><br><span class="line">                    .channel(NioSocketChannel.class) // è®¾ç½®å®¢æˆ·ç«¯é€šé“çš„å®ç°ç±»(åå°„)</span><br><span class="line">                    .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                            ch.pipeline().addLast(new NettyClientHandler()); //åŠ å…¥è‡ªå·±çš„å¤„ç†å™¨</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;å®¢æˆ·ç«¯ ok..&quot;);</span><br><span class="line">            //å¯åŠ¨å®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡å™¨ç«¯</span><br><span class="line">            //å…³äº ChannelFuture è¦åˆ†æï¼Œæ¶‰åŠåˆ°nettyçš„å¼‚æ­¥æ¨¡å‹</span><br><span class="line">            ChannelFuture channelFuture = bootstrap.connect(&quot;127.0.0.1&quot;, 6668).sync();</span><br><span class="line">            //ç»™å…³é—­é€šé“è¿›è¡Œç›‘å¬</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NettyClientHandler.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.simple;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.buffer.Unpooled;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line">import io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line">public class NettyClientHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    //å½“é€šé“å°±ç»ªå°±ä¼šè§¦å‘è¯¥æ–¹æ³•</span><br><span class="line">    @Override</span><br><span class="line">    public void channelActive(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;client &quot; + ctx);</span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, server: (&gt;^Ï‰^&lt;)å–µ&quot;, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å½“é€šé“æœ‰è¯»å–äº‹ä»¶æ—¶ï¼Œä¼šè§¦å‘</span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span><br><span class="line">        ByteBuf buf = (ByteBuf) msg;</span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯:&quot; + buf.toString(CharsetUtil.UTF_8));</span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨çš„åœ°å€ï¼š &quot; + ctx.channel().remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopiedCopy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="5-8-7-ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„-Task-æœ‰-3-ç§å…¸å‹ä½¿ç”¨åœºæ™¯"><strong>5.8.7 ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ Task æœ‰ 3 ç§å…¸å‹ä½¿ç”¨åœºæ™¯</strong></h3><ol><li>ç”¨æˆ·ç¨‹åºè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡ã€ä¸¾ä¾‹è¯´æ˜ã€‘</li><li>ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡</li><li>éå½“å‰Â <code>Reactor</code>Â çº¿ç¨‹è°ƒç”¨Â <code>Channel</code>Â çš„å„ç§æ–¹æ³• ä¾‹å¦‚åœ¨æ¨é€ç³»ç»Ÿçš„ä¸šåŠ¡çº¿ç¨‹é‡Œé¢ï¼Œæ ¹æ®ç”¨æˆ·çš„æ ‡è¯†ï¼Œæ‰¾åˆ°å¯¹åº”çš„Â <code>Channel</code>Â å¼•ç”¨ï¼Œç„¶åè°ƒç”¨Â <code>Write</code>Â ç±»æ–¹æ³•å‘è¯¥ç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼Œå°±ä¼šè¿›å…¥åˆ°è¿™ç§åœºæ™¯ã€‚æœ€ç»ˆçš„Â <code>Write</code>Â ä¼šæäº¤åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­åè¢«å¼‚æ­¥æ¶ˆè´¹</li><li>ä»£ç æ¼”ç¤º</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.simple;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.Unpooled;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line">import io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¯´æ˜</span><br><span class="line"> * 1. æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªHandler éœ€è¦ç»§ç»­netty è§„å®šå¥½çš„æŸä¸ªHandlerAdapter(è§„èŒƒ)</span><br><span class="line"> * 2. è¿™æ—¶æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªHandler , æ‰èƒ½ç§°ä¸ºä¸€ä¸ªhandler</span><br><span class="line"> */</span><br><span class="line">public class NettyServerHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    //è¯»å–æ•°æ®å®é™…(è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯)</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 1. ChannelHandlerContext ctx:ä¸Šä¸‹æ–‡å¯¹è±¡, å«æœ‰ ç®¡é“pipeline , é€šé“channel, åœ°å€</span><br><span class="line">     * 2. Object msg: å°±æ˜¯å®¢æˆ·ç«¯å‘é€çš„æ•°æ® é»˜è®¤Object</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        // æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸è€—æ—¶é•¿çš„ä¸šåŠ¡-&gt; å¼‚æ­¥æ‰§è¡Œ -&gt; æäº¤è¯¥channel å¯¹åº”çš„</span><br><span class="line">        // NIOEventLoop çš„ taskQueueä¸­,</span><br><span class="line"></span><br><span class="line">        // è§£å†³æ–¹æ¡ˆ1 ç”¨æˆ·ç¨‹åºè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡</span><br><span class="line"></span><br><span class="line">        ctx.channel().eventLoop().execute(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line"></span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(5 * 1000);</span><br><span class="line">                    ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ2&quot;, CharsetUtil.UTF_8));</span><br><span class="line">                    System.out.println(&quot;channel code=&quot; + ctx.channel().hashCode());</span><br><span class="line">                &#125; catch (Exception ex) &#123;</span><br><span class="line">                    System.out.println(&quot;å‘ç”Ÿå¼‚å¸¸&quot; + ex.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        ctx.channel().eventLoop().execute(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line"></span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(5 * 1000);</span><br><span class="line">                    ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ3&quot;, CharsetUtil.UTF_8));</span><br><span class="line">                    System.out.println(&quot;channel code=&quot; + ctx.channel().hashCode());</span><br><span class="line">                &#125; catch (Exception ex) &#123;</span><br><span class="line">                    System.out.println(&quot;å‘ç”Ÿå¼‚å¸¸&quot; + ex.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        //è§£å†³æ–¹æ¡ˆ2 : ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ -ã€‹ è¯¥ä»»åŠ¡æ˜¯æäº¤åˆ° scheduleTaskQueueä¸­</span><br><span class="line"></span><br><span class="line">        ctx.channel().eventLoop().schedule(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line"></span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(5 * 1000);</span><br><span class="line">                    ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ4&quot;, CharsetUtil.UTF_8));</span><br><span class="line">                    System.out.println(&quot;channel code=&quot; + ctx.channel().hashCode());</span><br><span class="line">                &#125; catch (Exception ex) &#123;</span><br><span class="line">                    System.out.println(&quot;å‘ç”Ÿå¼‚å¸¸&quot; + ex.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, 5, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;go on ...&quot;);</span><br><span class="line"></span><br><span class="line">//        System.out.println(&quot;æœåŠ¡å™¨è¯»å–çº¿ç¨‹ &quot; + Thread.currentThread().getName() + &quot; channle =&quot; + ctx.channel());</span><br><span class="line">//        System.out.println(&quot;server ctx =&quot; + ctx);</span><br><span class="line">//        System.out.println(&quot;çœ‹çœ‹channel å’Œ pipelineçš„å…³ç³»&quot;);</span><br><span class="line">//        Channel channel = ctx.channel();</span><br><span class="line">//        ChannelPipeline pipeline = ctx.pipeline(); //æœ¬è´¨æ˜¯ä¸€ä¸ªåŒå‘é“¾æ¥, å‡ºç«™å…¥ç«™</span><br><span class="line">//</span><br><span class="line">//        //å°† msg è½¬æˆä¸€ä¸ª ByteBuf</span><br><span class="line">//        //ByteBuf æ˜¯ Netty æä¾›çš„ï¼Œä¸æ˜¯ NIO çš„ ByteBuffer.</span><br><span class="line">//        ByteBuf buf = (ByteBuf) msg;</span><br><span class="line">//        System.out.println(&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯:&quot; + buf.toString(CharsetUtil.UTF_8));</span><br><span class="line">//        System.out.println(&quot;å®¢æˆ·ç«¯åœ°å€:&quot; + channel.remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æ•°æ®è¯»å–å®Œæ¯•</span><br><span class="line">    @Override</span><br><span class="line">    public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        //writeAndFlush æ˜¯ write + flush</span><br><span class="line">        //å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–°</span><br><span class="line">        //ä¸€èˆ¬è®²ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªå‘é€çš„æ•°æ®è¿›è¡Œç¼–ç </span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ1&quot;, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å¤„ç†å¼‚å¸¸, ä¸€èˆ¬æ˜¯éœ€è¦å…³é—­é€šé“</span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopiedCopy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="5-8-8-æ–¹æ¡ˆå†è¯´æ˜"><strong>5.8.8 æ–¹æ¡ˆå†è¯´æ˜</strong></h3><ol><li><code>Netty</code>Â æŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ± ï¼Œ<code>BossGroup</code>Â ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œ<code>WorkerGroup</code>Â ä¸“é—¨è´Ÿè´£ç½‘ç»œè¯»å†™æ“ä½œã€‚</li><li><code>NioEventLoop</code>Â è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªç¯æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ¯ä¸ªÂ <code>NioEventLoop</code>Â éƒ½æœ‰ä¸€ä¸ªÂ <code>Selector</code>ï¼Œç”¨äºç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„Â <code>socket</code>ç½‘ç»œé€šé“ã€‚</li><li><code>NioEventLoop</code>Â å†…éƒ¨é‡‡ç”¨ä¸²è¡ŒåŒ–è®¾è®¡ï¼Œä»æ¶ˆæ¯çš„Â <strong>è¯»å–-&gt;è§£ç -&gt;å¤„ç†-&gt;ç¼–ç -&gt;å‘é€</strong>ï¼Œå§‹ç»ˆç”±Â <code>IO</code>Â çº¿ç¨‹Â <code>NioEventLoop</code>Â è´Ÿè´£</li></ol><p><code>NioEventLoopGroup</code>Â ä¸‹åŒ…å«å¤šä¸ªÂ <code>NioEventLoop</code></p><ul><li>æ¯ä¸ªÂ <code>NioEventLoop</code>Â ä¸­åŒ…å«æœ‰ä¸€ä¸ªÂ <code>Selector</code>ï¼Œä¸€ä¸ªÂ <code>taskQueue</code></li><li>æ¯ä¸ªÂ <code>NioEventLoop</code>Â çš„Â <code>Selector</code>Â ä¸Šå¯ä»¥æ³¨å†Œç›‘å¬å¤šä¸ªÂ <code>NioChannel</code></li><li>æ¯ä¸ªÂ <code>NioChannel</code>Â åªä¼šç»‘å®šåœ¨å”¯ä¸€çš„Â <code>NioEventLoop</code>Â ä¸Š</li><li>æ¯ä¸ªÂ <code>NioChannel</code>Â éƒ½ç»‘å®šæœ‰ä¸€ä¸ªè‡ªå·±çš„Â <code>ChannelPipeline</code></li></ul><h2 id="5-9-å¼‚æ­¥æ¨¡å‹"><strong>5.9 å¼‚æ­¥æ¨¡å‹</strong></h2><h3 id="5-9-1-åŸºæœ¬ä»‹ç»"><strong>5.9.1 åŸºæœ¬ä»‹ç»</strong></h3><ol><li>å¼‚æ­¥çš„æ¦‚å¿µå’ŒåŒæ­¥ç›¸å¯¹ã€‚å½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœã€‚å®é™…å¤„ç†è¿™ä¸ªè°ƒç”¨çš„ç»„ä»¶åœ¨å®Œæˆåï¼Œé€šè¿‡çŠ¶æ€ã€é€šçŸ¥å’Œå›è°ƒæ¥é€šçŸ¥è°ƒç”¨è€…ã€‚</li><li><code>Netty</code>Â ä¸­çš„Â <code>I/O</code>Â æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼ŒåŒ…æ‹¬Â <code>Bindã€Writeã€Connect</code>Â ç­‰æ“ä½œä¼šç®€å•çš„è¿”å›ä¸€ä¸ªÂ <code>ChannelFuture</code>ã€‚</li><li>è°ƒç”¨è€…å¹¶ä¸èƒ½ç«‹åˆ»è·å¾—ç»“æœï¼Œè€Œæ˜¯é€šè¿‡Â <code>Future-Listener</code>Â æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„ä¸»åŠ¨è·å–æˆ–è€…é€šè¿‡é€šçŸ¥æœºåˆ¶è·å¾—Â <code>IO</code>Â æ“ä½œç»“æœã€‚</li><li><code>Netty</code>Â çš„å¼‚æ­¥æ¨¡å‹æ˜¯å»ºç«‹åœ¨Â <code>future</code>Â å’ŒÂ <code>callback</code>Â çš„ä¹‹ä¸Šçš„ã€‚<code>callback</code>Â å°±æ˜¯å›è°ƒã€‚é‡ç‚¹è¯´Â <code>Future</code>ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå‡è®¾ä¸€ä¸ªæ–¹æ³•Â <code>fun</code>ï¼Œè®¡ç®—è¿‡ç¨‹å¯èƒ½éå¸¸è€—æ—¶ï¼Œç­‰å¾…Â <code>fun</code>Â è¿”å›æ˜¾ç„¶ä¸åˆé€‚ã€‚é‚£ä¹ˆå¯ä»¥åœ¨è°ƒç”¨Â <code>fun</code>Â çš„æ—¶å€™ï¼Œç«‹é©¬è¿”å›ä¸€ä¸ªÂ <code>Future</code>ï¼Œåç»­å¯ä»¥é€šè¿‡Â <code>Future</code>Â å»ç›‘æ§æ–¹æ³•Â <code>fun</code>Â çš„å¤„ç†è¿‡ç¨‹ï¼ˆå³ï¼š<code>Future-Listener</code>Â æœºåˆ¶ï¼‰</li></ol><h3 id="5-9-2-Future-è¯´æ˜"><strong>5.9.2 Future è¯´æ˜</strong></h3><ol><li>è¡¨ç¤ºå¼‚æ­¥çš„æ‰§è¡Œç»“æœ,å¯ä»¥é€šè¿‡å®ƒæä¾›çš„æ–¹æ³•æ¥æ£€æµ‹æ‰§è¡Œæ˜¯å¦å®Œæˆï¼Œæ¯”å¦‚æ£€ç´¢è®¡ç®—ç­‰ç­‰ã€‚</li><li><code>ChannelFuture</code>Â æ˜¯ä¸€ä¸ªæ¥å£ï¼š<code>public interface ChannelFuture extends Future&lt;Void&gt;</code>Â æˆ‘ä»¬å¯ä»¥æ·»åŠ ç›‘å¬å™¨ï¼Œå½“ç›‘å¬çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šé€šçŸ¥åˆ°ç›‘å¬å™¨ã€‚æ¡ˆä¾‹è¯´æ˜</li></ol><h3 id="5-9-3-å·¥ä½œåŸç†ç¤ºæ„å›¾"><strong>5.9.3 å·¥ä½œåŸç†ç¤ºæ„å›¾</strong></h3><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_11.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_11.png"></p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_12.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter05/chapter05_12.png"></p><p>è¯´æ˜ï¼š</p><ol><li>åœ¨ä½¿ç”¨Â <code>Netty</code>Â è¿›è¡Œç¼–ç¨‹æ—¶ï¼Œæ‹¦æˆªæ“ä½œå’Œè½¬æ¢å‡ºå…¥ç«™æ•°æ®åªéœ€è¦æ‚¨æä¾›Â <code>callback</code>Â æˆ–åˆ©ç”¨Â <code>future</code>Â å³å¯ã€‚è¿™ä½¿å¾—é“¾å¼æ“ä½œç®€å•ã€é«˜æ•ˆï¼Œå¹¶æœ‰åˆ©äºç¼–å†™å¯é‡ç”¨çš„ã€é€šç”¨çš„ä»£ç ã€‚</li><li><code>Netty</code>Â æ¡†æ¶çš„ç›®æ ‡å°±æ˜¯è®©ä½ çš„ä¸šåŠ¡é€»è¾‘ä»ç½‘ç»œåŸºç¡€åº”ç”¨ç¼–ç ä¸­åˆ†ç¦»å‡ºæ¥ã€è§£è„±å‡ºæ¥ã€‚</li></ol><h3 id="5-9-4-Future-Listener-æœºåˆ¶"><strong>5.9.4 Future-Listener æœºåˆ¶</strong></h3><ol><li>å½“Â <code>Future</code>Â å¯¹è±¡åˆšåˆšåˆ›å»ºæ—¶ï¼Œå¤„äºéå®ŒæˆçŠ¶æ€ï¼Œè°ƒç”¨è€…å¯ä»¥é€šè¿‡è¿”å›çš„Â <code>ChannelFuture</code>Â æ¥è·å–æ“ä½œæ‰§è¡Œçš„çŠ¶æ€ï¼Œæ³¨å†Œç›‘å¬å‡½æ•°æ¥æ‰§è¡Œå®Œæˆåçš„æ“ä½œã€‚</li><li>å¸¸è§æœ‰å¦‚ä¸‹æ“ä½œ<ul><li>é€šè¿‡Â <code>isDone</code>Â æ–¹æ³•æ¥åˆ¤æ–­å½“å‰æ“ä½œæ˜¯å¦å®Œæˆï¼›</li><li>é€šè¿‡Â <code>isSuccess</code>Â æ–¹æ³•æ¥åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦æˆåŠŸï¼›</li><li>é€šè¿‡Â <code>getCause</code>Â æ–¹æ³•æ¥è·å–å·²å®Œæˆçš„å½“å‰æ“ä½œå¤±è´¥çš„åŸå› ï¼›</li><li>é€šè¿‡Â <code>isCancelled</code>Â æ–¹æ³•æ¥åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦è¢«å–æ¶ˆï¼›</li><li>é€šè¿‡Â <code>addListener</code>Â æ–¹æ³•æ¥æ³¨å†Œç›‘å¬å™¨ï¼Œå½“æ“ä½œå·²å®Œæˆï¼ˆ<code>isDone</code>æ–¹æ³•è¿”å›å®Œæˆï¼‰ï¼Œå°†ä¼šé€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨ï¼›å¦‚æœÂ <code>Future</code>Â å¯¹è±¡å·²å®Œæˆï¼Œåˆ™é€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨</li></ul></li></ol><p>ä¸¾ä¾‹è¯´æ˜ æ¼”ç¤ºï¼šç»‘å®šç«¯å£æ˜¯å¼‚æ­¥æ“ä½œï¼Œå½“ç»‘å®šæ“ä½œå¤„ç†å®Œï¼Œå°†ä¼šè°ƒç”¨ç›¸åº”çš„ç›‘å¬å™¨å¤„ç†é€»è¾‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//ç»‘å®šä¸€ä¸ªç«¯å£å¹¶ä¸”åŒæ­¥,ç”Ÿæˆäº†ä¸€ä¸ªChannelFutureå¯¹è±¡</span><br><span class="line">//å¯åŠ¨æœåŠ¡å™¨(å¹¶ç»‘å®šç«¯å£)</span><br><span class="line">ChannelFuture cf = bootstrap.bind(6668).sync();</span><br><span class="line">//ç»™cfæ³¨å†Œç›‘å¬å™¨ï¼Œç›‘æ§æˆ‘ä»¬å…³å¿ƒçš„äº‹ä»¶</span><br><span class="line">cf.addListener(new ChannelFutureListener() &#123;</span><br><span class="line">   @Override</span><br><span class="line">   public void operationComplete (ChannelFuture future) throws Exception &#123;</span><br><span class="line">      if (cf.isSuccess()) &#123;</span><br><span class="line">         System.out.println(&quot;ç›‘å¬ç«¯å£6668æˆåŠŸ&quot;);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">         System.out.println(&quot;ç›‘å¬ç«¯å£6668å¤±è´¥&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);Copy to clipboardErrorCopiedCopy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="5-10-å¿«é€Ÿå…¥é—¨å®ä¾‹-HTTPæœåŠ¡"><strong>5.10 å¿«é€Ÿå…¥é—¨å®ä¾‹ - HTTPæœåŠ¡</strong></h2><ol><li>å®ä¾‹è¦æ±‚ï¼šä½¿ç”¨Â <code>IDEA</code>Â åˆ›å»ºÂ <code>Netty</code>Â é¡¹ç›®</li><li><code>Netty</code>Â æœåŠ¡å™¨åœ¨Â <code>6668</code>Â ç«¯å£ç›‘å¬ï¼Œæµè§ˆå™¨å‘å‡ºè¯·æ±‚Â <code>http://localhost:6668/</code></li><li>æœåŠ¡å™¨å¯ä»¥å›å¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯&quot;Hello!æˆ‘æ˜¯æœåŠ¡å™¨5&quot;,å¹¶å¯¹ç‰¹å®šè¯·æ±‚èµ„æºè¿›è¡Œè¿‡æ»¤ã€‚</li><li>ç›®çš„ï¼š<code>Netty</code>Â å¯ä»¥åšÂ <code>Http</code>Â æœåŠ¡å¼€å‘ï¼Œå¹¶ä¸”ç†è§£Â <code>Handler</code>Â å®ä¾‹å’Œå®¢æˆ·ç«¯åŠå…¶è¯·æ±‚çš„å…³ç³»ã€‚</li><li>çœ‹è€å¸ˆä»£ç æ¼”ç¤º</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">TestServer.java</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.atguigu.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">EventLoopGroup</span> <span class="variable">bossGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">EventLoopGroup</span> <span class="variable">workerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line"></span><br><span class="line">            serverBootstrap.group(bossGroup, workerGroup).channel(NioServerSocketChannel.class).childHandler(<span class="keyword">new</span> <span class="title class_">TestServerInitializer</span>());</span><br><span class="line"></span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">channelFuture</span> <span class="operator">=</span> serverBootstrap.bind(<span class="number">6668</span>).sync();</span><br><span class="line"></span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TestServerInitializer.java</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.atguigu.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServerInitializer</span> <span class="keyword">extends</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘ç®¡é“åŠ å…¥å¤„ç†å™¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾—åˆ°ç®¡é“</span></span><br><span class="line">        <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŠ å…¥ä¸€ä¸ªnetty æä¾›çš„httpServerCodec codec =&gt;[coder - decoder]</span></span><br><span class="line">        <span class="comment">//HttpServerCodec è¯´æ˜</span></span><br><span class="line">        <span class="comment">//1. HttpServerCodec æ˜¯netty æä¾›çš„å¤„ç†httpçš„ ç¼–-è§£ç å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;MyHttpServerCodec&quot;</span>, <span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>());</span><br><span class="line">        <span class="comment">//2. å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„handler</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;MyTestHttpServerHandler&quot;</span>, <span class="keyword">new</span> <span class="title class_">TestHttpServerHandler</span>());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ok~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TestHttpServerHandler.java</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.atguigu.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯´æ˜</span></span><br><span class="line"><span class="comment"> * 1. SimpleChannelInboundHandler æ˜¯ ChannelInboundHandlerAdapter</span></span><br><span class="line"><span class="comment"> * 2. HttpObject å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ç›¸äº’é€šè®¯çš„æ•°æ®è¢«å°è£…æˆ HttpObject</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestHttpServerHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;HttpObject&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//channelRead0 è¯»å–å®¢æˆ·ç«¯æ•°æ®</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, HttpObject msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;å¯¹åº”çš„channel=&quot;</span> + ctx.channel() + <span class="string">&quot; pipeline=&quot;</span> + ctx</span><br><span class="line">                .pipeline() + <span class="string">&quot; é€šè¿‡pipelineè·å–channel&quot;</span> + ctx.pipeline().channel());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰ctxçš„handler=&quot;</span> + ctx.handler());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­ msg æ˜¯ä¸æ˜¯ httprequestè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpRequest) &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;ctx ç±»å‹=&quot;</span> + ctx.getClass());</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;pipeline hashcode&quot;</span> + ctx.pipeline().hashCode() + <span class="string">&quot; TestHttpServerHandler hash=&quot;</span> + <span class="built_in">this</span>.hashCode());</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;msg ç±»å‹=&quot;</span> + msg.getClass());</span><br><span class="line">            System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯åœ°å€&quot;</span> + ctx.channel().remoteAddress());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–åˆ°</span></span><br><span class="line">            <span class="type">HttpRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpRequest) msg;</span><br><span class="line">            <span class="comment">//è·å–uri, è¿‡æ»¤æŒ‡å®šçš„èµ„æº</span></span><br><span class="line">            <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(httpRequest.uri());</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;/favicon.ico&quot;</span>.equals(uri.getPath())) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯·æ±‚äº† favicon.ico, ä¸åšå“åº”&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å›å¤ä¿¡æ¯ç»™æµè§ˆå™¨ [httpåè®®]</span></span><br><span class="line"></span><br><span class="line">            <span class="type">ByteBuf</span> <span class="variable">content</span> <span class="operator">=</span> Unpooled.copiedBuffer(<span class="string">&quot;hello, æˆ‘æ˜¯æœåŠ¡å™¨&quot;</span>, CharsetUtil.UTF_8);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ„é€ ä¸€ä¸ªhttpçš„ç›¸åº”ï¼Œå³ httpresponse</span></span><br><span class="line">            <span class="type">FullHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFullHttpResponse</span>(HttpVersion.HTTP_1_1, HttpResponseStatus.OK, content);</span><br><span class="line"></span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_LENGTH, content.readableBytes());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å°†æ„å»ºå¥½ responseè¿”å›</span></span><br><span class="line">            ctx.writeAndFlush(response);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><strong>ç¬¬ 6 ç«  Netty æ ¸å¿ƒæ¨¡å—ç»„ä»¶</strong></h1><h2 id="6-1-Bootstrapã€ServerBootstrap"><strong>6.1 Bootstrapã€ServerBootstrap</strong></h2><ol><li><code>Bootstrap</code>Â æ„æ€æ˜¯å¼•å¯¼ï¼Œä¸€ä¸ªÂ <code>Netty</code>Â åº”ç”¨é€šå¸¸ç”±ä¸€ä¸ªÂ <code>Bootstrap</code>Â å¼€å§‹ï¼Œä¸»è¦ä½œç”¨æ˜¯é…ç½®æ•´ä¸ªÂ <code>Netty</code>Â ç¨‹åºï¼Œä¸²è”å„ä¸ªç»„ä»¶ï¼Œ<code>Netty</code>Â ä¸­Â <code>Bootstrap</code>Â ç±»æ˜¯å®¢æˆ·ç«¯ç¨‹åºçš„å¯åŠ¨å¼•å¯¼ç±»ï¼Œ<code>ServerBootstrap</code>Â æ˜¯æœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼ç±»ã€‚</li><li>å¸¸è§çš„æ–¹æ³•æœ‰<ul><li><code>public ServerBootstrap group(EventLoopGroup parentGroup, EventLoopGroup childGroup)</code>ï¼Œè¯¥æ–¹æ³•ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸¤ä¸ªÂ <code>EventLoop</code></li><li><code>public B group(EventLoopGroup group)</code>ï¼Œè¯¥æ–¹æ³•ç”¨äºå®¢æˆ·ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸€ä¸ªÂ <code>EventLoop</code></li><li><code>public B channel(Class&lt;? extends C&gt; channelClass)</code>ï¼Œè¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„é€šé“å®ç°</li><li><code>public &lt;T&gt; B option(ChannelOption&lt;T&gt; option, T value)</code>ï¼Œç”¨æ¥ç»™Â <code>ServerChannel</code>Â æ·»åŠ é…ç½®</li><li><code>public &lt;T&gt; ServerBootstrap childOption(ChannelOption&lt;T&gt; childOption, T value)</code>ï¼Œç”¨æ¥ç»™æ¥æ”¶åˆ°çš„é€šé“æ·»åŠ é…ç½®</li><li><code>public ServerBootstrap childHandler(ChannelHandler childHandler)</code>ï¼Œè¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸šåŠ¡å¤„ç†ç±»ï¼ˆè‡ªå®šä¹‰çš„<code>handler</code>ï¼‰</li><li><code>public ChannelFuture bind(int inetPort)</code>ï¼Œè¯¥æ–¹æ³•ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®å ç”¨çš„ç«¯å£å·</li><li><code>public ChannelFuture connect(String inetHost, int inetPort)</code>ï¼Œè¯¥æ–¹æ³•ç”¨äºå®¢æˆ·ç«¯ï¼Œç”¨æ¥è¿æ¥æœåŠ¡å™¨ç«¯</li></ul></li></ol><h2 id="6-2-Futureã€ChannelFuture"><strong>6.2 Futureã€ChannelFuture</strong></h2><p><code>Netty</code>Â ä¸­æ‰€æœ‰çš„Â <code>IO</code>Â æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸èƒ½ç«‹åˆ»å¾—çŸ¥æ¶ˆæ¯æ˜¯å¦è¢«æ­£ç¡®å¤„ç†ã€‚ä½†æ˜¯å¯ä»¥è¿‡ä¸€ä¼šç­‰å®ƒæ‰§è¡Œå®Œæˆæˆ–è€…ç›´æ¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå…·ä½“çš„å®ç°å°±æ˜¯é€šè¿‡Â <code>Future</code>Â å’ŒÂ <code>ChannelFutures</code>ï¼Œä»–ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå½“æ“ä½œæ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥æ—¶ç›‘å¬ä¼šè‡ªåŠ¨è§¦å‘æ³¨å†Œçš„ç›‘å¬äº‹ä»¶</p><p>å¸¸è§çš„æ–¹æ³•æœ‰</p><ul><li><code>Channel channel()</code>ï¼Œè¿”å›å½“å‰æ­£åœ¨è¿›è¡ŒÂ <code>IO</code>Â æ“ä½œçš„é€šé“</li><li><code>ChannelFuture sync()</code>ï¼Œç­‰å¾…å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæ¯•</li></ul><h2 id="6-3-Channel"><strong>6.3 Channel</strong></h2><ol><li><code>Netty</code>Â ç½‘ç»œé€šä¿¡çš„ç»„ä»¶ï¼Œèƒ½å¤Ÿç”¨äºæ‰§è¡Œç½‘ç»œÂ <code>I/O</code>Â æ“ä½œã€‚</li><li>é€šè¿‡Â <code>Channel</code>Â å¯è·å¾—å½“å‰ç½‘ç»œè¿æ¥çš„é€šé“çš„çŠ¶æ€</li><li>é€šè¿‡Â <code>Channel</code>Â å¯è·å¾—ç½‘ç»œè¿æ¥çš„é…ç½®å‚æ•°ï¼ˆä¾‹å¦‚æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼‰</li><li><code>Channel</code>Â æä¾›å¼‚æ­¥çš„ç½‘ç»œÂ <code>I/O</code>Â æ“ä½œ(å¦‚å»ºç«‹è¿æ¥ï¼Œè¯»å†™ï¼Œç»‘å®šç«¯å£)ï¼Œå¼‚æ­¥è°ƒç”¨æ„å‘³ç€ä»»ä½•Â <code>I/O</code>Â è°ƒç”¨éƒ½å°†ç«‹å³è¿”å›ï¼Œå¹¶ä¸”ä¸ä¿è¯åœ¨è°ƒç”¨ç»“æŸæ—¶æ‰€è¯·æ±‚çš„Â <code>I/O</code>Â æ“ä½œå·²å®Œæˆ</li><li>è°ƒç”¨ç«‹å³è¿”å›ä¸€ä¸ªÂ <code>ChannelFuture</code>Â å®ä¾‹ï¼Œé€šè¿‡æ³¨å†Œç›‘å¬å™¨åˆ°Â <code>ChannelFuture</code>Â ä¸Šï¼Œå¯ä»¥Â <code>I/O</code>Â æ“ä½œæˆåŠŸã€å¤±è´¥æˆ–å–æ¶ˆæ—¶å›è°ƒé€šçŸ¥è°ƒç”¨æ–¹</li><li>æ”¯æŒå…³è”Â <code>I/O</code>Â æ“ä½œä¸å¯¹åº”çš„å¤„ç†ç¨‹åº</li><li>ä¸åŒåè®®ã€ä¸åŒçš„é˜»å¡ç±»å‹çš„è¿æ¥éƒ½æœ‰ä¸åŒçš„Â <code>Channel</code>Â ç±»å‹ä¸ä¹‹å¯¹åº”ï¼Œå¸¸ç”¨çš„Â <code>Channel</code>Â ç±»å‹ï¼š<ul><li><code>NioSocketChannel</code>ï¼Œå¼‚æ­¥çš„å®¢æˆ·ç«¯Â <code>TCP</code>Â <code>Socket</code>Â è¿æ¥ã€‚</li><li><code>NioServerSocketChannel</code>ï¼Œå¼‚æ­¥çš„æœåŠ¡å™¨ç«¯Â <code>TCP</code>Â <code>Socket</code>Â è¿æ¥ã€‚</li><li><code>NioDatagramChannel</code>ï¼Œå¼‚æ­¥çš„Â <code>UDP</code>Â è¿æ¥ã€‚</li><li><code>NioSctpChannel</code>ï¼Œå¼‚æ­¥çš„å®¢æˆ·ç«¯Â <code>Sctp</code>Â è¿æ¥ã€‚</li><li><code>NioSctpServerChannel</code>ï¼Œå¼‚æ­¥çš„Â <code>Sctp</code>Â æœåŠ¡å™¨ç«¯è¿æ¥ï¼Œè¿™äº›é€šé“æ¶µç›–äº†Â <code>UDP</code>Â å’ŒÂ <code>TCP</code>Â ç½‘ç»œÂ <code>IO</code>Â ä»¥åŠæ–‡ä»¶Â <code>IO</code>ã€‚</li></ul></li></ol><h2 id="6-4-Selector"><strong>6.4 Selector</strong></h2><ol><li><code>Netty</code>Â åŸºäºÂ <code>Selector</code>Â å¯¹è±¡å®ç°Â <code>I/O</code>Â å¤šè·¯å¤ç”¨ï¼Œé€šè¿‡Â <code>Selector</code>Â ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªè¿æ¥çš„Â <code>Channel</code>Â äº‹ä»¶ã€‚</li><li>å½“å‘ä¸€ä¸ªÂ <code>Selector</code>Â ä¸­æ³¨å†ŒÂ <code>Channel</code>Â åï¼Œ<code>Selector</code>Â å†…éƒ¨çš„æœºåˆ¶å°±å¯ä»¥è‡ªåŠ¨ä¸æ–­åœ°æŸ¥è¯¢ï¼ˆ<code>Select</code>ï¼‰è¿™äº›æ³¨å†Œçš„Â <code>Channel</code>Â æ˜¯å¦æœ‰å·²å°±ç»ªçš„Â <code>I/O</code>Â äº‹ä»¶ï¼ˆä¾‹å¦‚å¯è¯»ï¼Œå¯å†™ï¼Œç½‘ç»œè¿æ¥å®Œæˆç­‰ï¼‰ï¼Œè¿™æ ·ç¨‹åºå°±å¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªÂ <code>Channel</code></li></ol><h2 id="6-5-ChannelHandler-åŠå…¶å®ç°ç±»"><strong>6.5 ChannelHandler åŠå…¶å®ç°ç±»</strong></h2><ol><li><code>ChannelHandler</code>Â æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¤„ç†Â <code>I/O</code>Â äº‹ä»¶æˆ–æ‹¦æˆªÂ <code>I/O</code>Â æ“ä½œï¼Œå¹¶å°†å…¶è½¬å‘åˆ°å…¶Â <code>ChannelPipeline</code>ï¼ˆä¸šåŠ¡å¤„ç†é“¾ï¼‰ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚</li><li><code>ChannelHandler</code>Â æœ¬èº«å¹¶æ²¡æœ‰æä¾›å¾ˆå¤šæ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£æœ‰è®¸å¤šçš„æ–¹æ³•éœ€è¦å®ç°ï¼Œæ–¹ä¾¿ä½¿ç”¨æœŸé—´ï¼Œå¯ä»¥ç»§æ‰¿å®ƒçš„å­ç±»</li><li><code>ChannelHandler</code>Â åŠå…¶å®ç°ç±»ä¸€è§ˆå›¾ï¼ˆåï¼‰</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_01.png"></p><ol><li>æˆ‘ä»¬ç»å¸¸éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªÂ <code>Handler</code>Â ç±»å»ç»§æ‰¿Â <code>ChannelInboundHandlerAdapter</code>ï¼Œç„¶åé€šè¿‡é‡å†™ç›¸åº”æ–¹æ³•å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ä¸€èˆ¬éƒ½éœ€è¦é‡å†™å“ªäº›æ–¹æ³•</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_02.png"></p><h2 id="6-6-Pipeline-å’Œ-ChannelPipeline"><strong>6.6 Pipeline å’Œ ChannelPipeline</strong></h2><p><code>ChannelPipeline</code>Â æ˜¯ä¸€ä¸ªé‡ç‚¹ï¼š</p><ol><li><code>ChannelPipeline</code>Â æ˜¯ä¸€ä¸ªÂ <code>Handler</code>Â çš„é›†åˆï¼Œå®ƒè´Ÿè´£å¤„ç†å’Œæ‹¦æˆªÂ <code>inbound</code>Â æˆ–è€…Â <code>outbound</code>Â çš„äº‹ä»¶å’Œæ“ä½œï¼Œç›¸å½“äºä¸€ä¸ªè´¯ç©¿Â <code>Netty</code>Â çš„é“¾ã€‚ï¼ˆä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼š<code>ChannelPipeline</code>Â æ˜¯ä¿å­˜Â <code>ChannelHandler</code>Â çš„Â <code>List</code>ï¼Œç”¨äºå¤„ç†æˆ–æ‹¦æˆªÂ <code>Channel</code>Â çš„å…¥ç«™äº‹ä»¶å’Œå‡ºç«™æ“ä½œï¼‰</li><li><code>ChannelPipeline</code>Â å®ç°äº†ä¸€ç§é«˜çº§å½¢å¼çš„æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼Œä½¿ç”¨æˆ·å¯ä»¥å®Œå…¨æ§åˆ¶äº‹ä»¶çš„å¤„ç†æ–¹å¼ï¼Œä»¥åŠÂ <code>Channel</code>Â ä¸­å„ä¸ªçš„Â <code>ChannelHandler</code>Â å¦‚ä½•ç›¸äº’äº¤äº’</li><li>åœ¨Â <code>Netty</code>Â ä¸­æ¯ä¸ªÂ <code>Channel</code>Â éƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªÂ <code>ChannelPipeline</code>Â ä¸ä¹‹å¯¹åº”ï¼Œå®ƒä»¬çš„ç»„æˆå…³ç³»å¦‚ä¸‹</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_03.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_03.png"></p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_04.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_04.png"></p><ol><li>å¸¸ç”¨æ–¹æ³•Â <code>ChannelPipeline addFirst(ChannelHandler... handlers)</code>ï¼ŒæŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆ<code>handler</code>ï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®<code>ChannelPipeline addLast(ChannelHandler... handlers)</code>ï¼ŒæŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆ<code>handler</code>ï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„æœ€åä¸€ä¸ªä½ç½®</li></ol><h2 id="6-7-ChannelHandlerContext"><strong>6.7 ChannelHandlerContext</strong></h2><ol><li>ä¿å­˜Â <code>Channel</code>Â ç›¸å…³çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒæ—¶å…³è”ä¸€ä¸ªÂ <code>ChannelHandler</code>Â å¯¹è±¡</li><li>å³Â <code>ChannelHandlerContext</code>Â ä¸­åŒ…å«ä¸€ä¸ªå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨Â <code>ChannelHandler</code>ï¼ŒåŒæ—¶Â <code>ChannelHandlerContext</code>Â ä¸­ä¹Ÿç»‘å®šäº†å¯¹åº”çš„Â <code>pipeline</code>Â å’ŒÂ <code>Channel</code>Â çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿å¯¹Â <code>ChannelHandler</code>Â è¿›è¡Œè°ƒç”¨ã€‚</li><li>å¸¸ç”¨æ–¹æ³•<ul><li><code>ChannelFuture close()</code>ï¼Œå…³é—­é€šé“</li><li><code>ChannelOutboundInvoker flush()</code>ï¼Œåˆ·æ–°</li><li><code>ChannelFuture writeAndFlush(Object msg)</code>ï¼Œå°†æ•°æ®å†™åˆ°</li><li><code>ChannelPipeline</code>Â ä¸­å½“å‰Â <code>ChannelHandler</code>Â çš„ä¸‹ä¸€ä¸ªÂ <code>ChannelHandler</code>Â å¼€å§‹å¤„ç†ï¼ˆå‡ºç«™ï¼‰</li></ul></li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_05.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_05.png"></p><h2 id="6-8-ChannelOption"><strong>6.8 ChannelOption</strong></h2><ol><li><code>Netty</code>Â åœ¨åˆ›å»ºÂ <code>Channel</code>Â å®ä¾‹åï¼Œä¸€èˆ¬éƒ½éœ€è¦è®¾ç½®Â <code>ChannelOption</code>Â å‚æ•°ã€‚</li><li><code>ChannelOption</code>Â å‚æ•°å¦‚ä¸‹ï¼š</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_06.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_06.png"></p><h2 id="6-9-EventLoopGroup-å’Œå…¶å®ç°ç±»-NioEventLoopGroup"><strong>6.9 EventLoopGroup å’Œå…¶å®ç°ç±» NioEventLoopGroup</strong></h2><ol><li><code>EventLoopGroup</code>Â æ˜¯ä¸€ç»„Â <code>EventLoop</code>Â çš„æŠ½è±¡ï¼Œ<code>Netty</code>Â ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨å¤šæ ¸Â <code>CPU</code>Â èµ„æºï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªÂ <code>EventLoop</code>Â åŒæ—¶å·¥ä½œï¼Œæ¯ä¸ªÂ <code>EventLoop</code>Â ç»´æŠ¤ç€ä¸€ä¸ªÂ <code>Selector</code>Â å®ä¾‹ã€‚</li><li><code>EventLoopGroup</code>Â æä¾›Â <code>next</code>Â æ¥å£ï¼Œå¯ä»¥ä»ç»„é‡Œé¢æŒ‰ç…§ä¸€å®šè§„åˆ™è·å–å…¶ä¸­ä¸€ä¸ªÂ <code>EventLoop</code>Â æ¥å¤„ç†ä»»åŠ¡ã€‚åœ¨Â <code>Netty</code>Â æœåŠ¡å™¨ç«¯ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½éœ€è¦æä¾›ä¸¤ä¸ªÂ <code>EventLoopGroup</code>ï¼Œä¾‹å¦‚ï¼š<code>BossEventLoopGroup</code>Â å’ŒÂ <code>WorkerEventLoopGroup</code>ã€‚</li><li>é€šå¸¸ä¸€ä¸ªæœåŠ¡ç«¯å£å³ä¸€ä¸ªÂ <code>ServerSocketChannel</code>Â å¯¹åº”ä¸€ä¸ªÂ <code>Selector</code>Â å’Œä¸€ä¸ªÂ <code>EventLoop</code>Â çº¿ç¨‹ã€‚<code>BossEventLoop</code>Â è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥å¹¶å°†Â <code>SocketChannel</code>Â äº¤ç»™Â <code>WorkerEventLoopGroup</code>Â æ¥è¿›è¡ŒÂ <code>IO</code>Â å¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_07.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_07.png"></p><ol><li>å¸¸ç”¨æ–¹æ³•Â <code>public NioEventLoopGroup()</code>ï¼Œæ„é€ æ–¹æ³•Â <code>public Future&lt;?&gt; shutdownGracefully()</code>ï¼Œæ–­å¼€è¿æ¥ï¼Œå…³é—­çº¿ç¨‹</li></ol><h2 id="6-10-Unpooled-ç±»"><strong>6.10 Unpooled ç±»</strong></h2><ol><li><code>Netty</code>Â æä¾›ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ“ä½œç¼“å†²åŒºï¼ˆå³Â <code>Netty</code>Â çš„æ•°æ®å®¹å™¨ï¼‰çš„å·¥å…·ç±»</li><li>å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤º</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_08.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_08.png"></p><ol><li>ä¸¾ä¾‹è¯´æ˜Â <code>Unpooled</code>Â è·å–Â <code>Netty</code>Â çš„æ•°æ®å®¹å™¨Â <code>ByteBuf</code>Â çš„åŸºæœ¬ä½¿ç”¨ã€æ¡ˆä¾‹æ¼”ç¤ºã€‘</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_09.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_09.png"></p><p>æ¡ˆä¾‹ 1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.buf;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.buffer.Unpooled;</span><br><span class="line"></span><br><span class="line">public class NettyByteBuf01 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªByteBuf</span><br><span class="line">        //è¯´æ˜</span><br><span class="line">        //1. åˆ›å»º å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ªæ•°ç»„arr , æ˜¯ä¸€ä¸ªbyte[10]</span><br><span class="line">        //2. åœ¨netty çš„bufferä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨flip è¿›è¡Œåè½¬</span><br><span class="line">        //   åº•å±‚ç»´æŠ¤äº† readerindex å’Œ writerIndex</span><br><span class="line">        //3. é€šè¿‡ readerindex å’Œ  writerIndex å’Œ  capacityï¼Œ å°†bufferåˆ†æˆä¸‰ä¸ªåŒºåŸŸ</span><br><span class="line">        // 0---readerindex å·²ç»è¯»å–çš„åŒºåŸŸ</span><br><span class="line">        // readerindex---writerIndex ï¼Œ å¯è¯»çš„åŒºåŸŸ</span><br><span class="line">        // writerIndex -- capacity, å¯å†™çš„åŒºåŸŸ</span><br><span class="line">        ByteBuf buffer = Unpooled.buffer(10);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            buffer.writeByte(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;capacity=&quot; + buffer.capacity());//10</span><br><span class="line">        //è¾“å‡º</span><br><span class="line">//        for(int i = 0; i&lt;buffer.capacity(); i++) &#123;</span><br><span class="line">//            System.out.println(buffer.getByte(i));</span><br><span class="line">//        &#125;</span><br><span class="line">        for (int i = 0; i &lt; buffer.capacity(); i++) &#123;</span><br><span class="line">            System.out.println(buffer.readByte());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;æ‰§è¡Œå®Œæ¯•&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.buf;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.buffer.Unpooled;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">public class NettyByteBuf02 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºByteBuf</span><br><span class="line">        ByteBuf byteBuf = Unpooled.copiedBuffer(&quot;hello,world!&quot;, Charset.forName(&quot;utf-8&quot;));</span><br><span class="line"></span><br><span class="line">        //ä½¿ç”¨ç›¸å…³çš„æ–¹æ³•</span><br><span class="line">        if (byteBuf.hasArray()) &#123; // true</span><br><span class="line"></span><br><span class="line">            byte[] content = byteBuf.array();</span><br><span class="line"></span><br><span class="line">            //å°† content è½¬æˆå­—ç¬¦ä¸²</span><br><span class="line">            System.out.println(new String(content, Charset.forName(&quot;utf-8&quot;)));</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;byteBuf=&quot; + byteBuf);</span><br><span class="line"></span><br><span class="line">            System.out.println(byteBuf.arrayOffset()); // 0</span><br><span class="line">            System.out.println(byteBuf.readerIndex()); // 0</span><br><span class="line">            System.out.println(byteBuf.writerIndex()); // 12</span><br><span class="line">            System.out.println(byteBuf.capacity()); // 36</span><br><span class="line"></span><br><span class="line">            //System.out.println(byteBuf.readByte()); //</span><br><span class="line">            System.out.println(byteBuf.getByte(0)); // 104</span><br><span class="line"></span><br><span class="line">            int len = byteBuf.readableBytes(); //å¯è¯»çš„å­—èŠ‚æ•°  12</span><br><span class="line">            System.out.println(&quot;len=&quot; + len);</span><br><span class="line"></span><br><span class="line">            //ä½¿ç”¨forå–å‡ºå„ä¸ªå­—èŠ‚</span><br><span class="line">            for (int i = 0; i &lt; len; i++) &#123;</span><br><span class="line">                System.out.println((char) byteBuf.getByte(i));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //æŒ‰ç…§æŸä¸ªèŒƒå›´è¯»å–</span><br><span class="line">            System.out.println(byteBuf.getCharSequence(0, 4, Charset.forName(&quot;utf-8&quot;)));</span><br><span class="line">            System.out.println(byteBuf.getCharSequence(4, 6, Charset.forName(&quot;utf-8&quot;)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="6-11-Netty-åº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ"><strong>6.11 Netty åº”ç”¨å®ä¾‹-ç¾¤èŠç³»ç»Ÿ</strong></h2><p>å®ä¾‹è¦æ±‚ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªÂ <code>Netty</code>Â ç¾¤èŠç³»ç»Ÿï¼Œå®ç°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéé˜»å¡ï¼‰</li><li>å®ç°å¤šäººç¾¤èŠ</li><li>æœåŠ¡å™¨ç«¯ï¼šå¯ä»¥ç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®ç°æ¶ˆæ¯è½¬å‘åŠŸèƒ½</li><li>å®¢æˆ·ç«¯ï¼šé€šè¿‡Â <code>channel</code>Â å¯ä»¥æ— é˜»å¡å‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æ¥å—å…¶å®ƒç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼ˆæœ‰æœåŠ¡å™¨è½¬å‘å¾—åˆ°ï¼‰</li><li>ç›®çš„ï¼šè¿›ä¸€æ­¥ç†è§£Â <code>Netty</code>Â éé˜»å¡ç½‘ç»œç¼–ç¨‹æœºåˆ¶</li><li>çœ‹è€å¸ˆä»£ç æ¼”ç¤º</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_10.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_10.png"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.groupchat;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.ServerBootstrap;</span><br><span class="line">import io.netty.channel.*;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line">import io.netty.handler.codec.string.StringDecoder;</span><br><span class="line">import io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line">public class GroupChatServer &#123;</span><br><span class="line"></span><br><span class="line">    private int port; //ç›‘å¬ç«¯å£</span><br><span class="line"></span><br><span class="line">    public GroupChatServer(int port) &#123;</span><br><span class="line">        this.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //ç¼–å†™runæ–¹æ³•ï¼Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚</span><br><span class="line">    public void run() throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„</span><br><span class="line">        EventLoopGroup bossGroup = new NioEventLoopGroup(1);</span><br><span class="line">        EventLoopGroup workerGroup = new NioEventLoopGroup(); //8ä¸ªNioEventLoop</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            ServerBootstrap b = new ServerBootstrap();</span><br><span class="line"></span><br><span class="line">            b.group(bossGroup, workerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, 128)</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, true)</span><br><span class="line">                    .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                        @Override</span><br><span class="line">                        protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">                            //è·å–åˆ°pipeline</span><br><span class="line">                            ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                            //å‘pipelineåŠ å…¥è§£ç å™¨</span><br><span class="line">                            pipeline.addLast(&quot;decoder&quot;, new StringDecoder());</span><br><span class="line">                            //å‘pipelineåŠ å…¥ç¼–ç å™¨</span><br><span class="line">                            pipeline.addLast(&quot;encoder&quot;, new StringEncoder());</span><br><span class="line">                            //åŠ å…¥è‡ªå·±çš„ä¸šåŠ¡å¤„ç†handler</span><br><span class="line">                            pipeline.addLast(new GroupChatServerHandler());</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;netty æœåŠ¡å™¨å¯åŠ¨&quot;);</span><br><span class="line">            ChannelFuture channelFuture = b.bind(port).sync();</span><br><span class="line"></span><br><span class="line">            //ç›‘å¬å…³é—­</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        new GroupChatServer(7000).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.groupchat;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.Channel;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line">import io.netty.channel.group.ChannelGroup;</span><br><span class="line">import io.netty.channel.group.DefaultChannelGroup;</span><br><span class="line">import io.netty.util.concurrent.GlobalEventExecutor;</span><br><span class="line"></span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class GroupChatServerHandler extends SimpleChannelInboundHandler&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    //public static List&lt;Channel&gt; channels = new ArrayList&lt;Channel&gt;();</span><br><span class="line"></span><br><span class="line">    //ä½¿ç”¨ä¸€ä¸ªhashmap ç®¡ç†</span><br><span class="line">    //public static Map&lt;String, Channel&gt; channels = new HashMap&lt;String,Channel&gt;();</span><br><span class="line"></span><br><span class="line">    //å®šä¹‰ä¸€ä¸ªchannle ç»„ï¼Œç®¡ç†æ‰€æœ‰çš„channel</span><br><span class="line">    //GlobalEventExecutor.INSTANCE) æ˜¯å…¨å±€çš„äº‹ä»¶æ‰§è¡Œå™¨ï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹</span><br><span class="line">    private static ChannelGroup channelGroup = new DefaultChannelGroup(GlobalEventExecutor.INSTANCE);</span><br><span class="line">    SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line"></span><br><span class="line">    //handlerAdded è¡¨ç¤ºè¿æ¥å»ºç«‹ï¼Œä¸€æ—¦è¿æ¥ï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œ</span><br><span class="line">    //å°†å½“å‰channel åŠ å…¥åˆ°  channelGroup</span><br><span class="line">    @Override</span><br><span class="line">    public void handlerAdded(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        Channel channel = ctx.channel();</span><br><span class="line">        //å°†è¯¥å®¢æˆ·åŠ å…¥èŠå¤©çš„ä¿¡æ¯æ¨é€ç»™å…¶å®ƒåœ¨çº¿çš„å®¢æˆ·ç«¯</span><br><span class="line">        /*</span><br><span class="line">        è¯¥æ–¹æ³•ä¼šå°† channelGroup ä¸­æ‰€æœ‰çš„channel éå†ï¼Œå¹¶å‘é€ æ¶ˆæ¯ï¼Œ</span><br><span class="line">        æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±éå†</span><br><span class="line">         */</span><br><span class="line">        channelGroup.writeAndFlush(&quot;[å®¢æˆ·ç«¯]&quot; + channel.remoteAddress() + &quot; åŠ å…¥èŠå¤©&quot; + sdf.format(new java.util.Date()) + &quot; \n&quot;);</span><br><span class="line">        channelGroup.add(channel);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æ–­å¼€è¿æ¥, å°†xxå®¢æˆ·ç¦»å¼€ä¿¡æ¯æ¨é€ç»™å½“å‰åœ¨çº¿çš„å®¢æˆ·</span><br><span class="line">    @Override</span><br><span class="line">    public void handlerRemoved(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        Channel channel = ctx.channel();</span><br><span class="line">        channelGroup.writeAndFlush(&quot;[å®¢æˆ·ç«¯]&quot; + channel.remoteAddress() + &quot; ç¦»å¼€äº†\n&quot;);</span><br><span class="line">        System.out.println(&quot;channelGroup size&quot; + channelGroup.size());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¡¨ç¤ºchannel å¤„äºæ´»åŠ¨çŠ¶æ€, æç¤º xxä¸Šçº¿</span><br><span class="line">    @Override</span><br><span class="line">    public void channelActive(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(ctx.channel().remoteAddress() + &quot; ä¸Šçº¿äº†~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¡¨ç¤ºchannel å¤„äºä¸æ´»åŠ¨çŠ¶æ€, æç¤º xxç¦»çº¿äº†</span><br><span class="line">    @Override</span><br><span class="line">    public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(ctx.channel().remoteAddress() + &quot; ç¦»çº¿äº†~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¯»å–æ•°æ®</span><br><span class="line">    @Override</span><br><span class="line">    protected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //è·å–åˆ°å½“å‰channel</span><br><span class="line">        Channel channel = ctx.channel();</span><br><span class="line">        //è¿™æ—¶æˆ‘ä»¬éå†channelGroup, æ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œå›é€ä¸åŒçš„æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">        channelGroup.forEach(ch -&gt; &#123;</span><br><span class="line">            if (channel != ch) &#123; //ä¸æ˜¯å½“å‰çš„channel,è½¬å‘æ¶ˆæ¯</span><br><span class="line">                ch.writeAndFlush(&quot;[å®¢æˆ·]&quot; + channel.remoteAddress() + &quot; å‘é€äº†æ¶ˆæ¯&quot; + msg + &quot;\n&quot;);</span><br><span class="line">            &#125; else &#123;//å›æ˜¾è‡ªå·±å‘é€çš„æ¶ˆæ¯ç»™è‡ªå·±</span><br><span class="line">                ch.writeAndFlush(&quot;[è‡ªå·±]å‘é€äº†æ¶ˆæ¯&quot; + msg + &quot;\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        //å…³é—­é€šé“</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.groupchat;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.Bootstrap;</span><br><span class="line">import io.netty.channel.*;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line">import io.netty.handler.codec.string.StringDecoder;</span><br><span class="line">import io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class GroupChatClient &#123;</span><br><span class="line"></span><br><span class="line">    //å±æ€§</span><br><span class="line">    private final String host;</span><br><span class="line">    private final int port;</span><br><span class="line"></span><br><span class="line">    public GroupChatClient(String host, int port) &#123;</span><br><span class="line">        this.host = host;</span><br><span class="line">        this.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void run() throws Exception &#123;</span><br><span class="line">        EventLoopGroup group = new NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            Bootstrap bootstrap = new Bootstrap()</span><br><span class="line">                    .group(group)</span><br><span class="line">                    .channel(NioSocketChannel.class)</span><br><span class="line">                    .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                        @Override</span><br><span class="line">                        protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">                            //å¾—åˆ°pipeline</span><br><span class="line">                            ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                            //åŠ å…¥ç›¸å…³handler</span><br><span class="line">                            pipeline.addLast(&quot;decoder&quot;, new StringDecoder());</span><br><span class="line">                            pipeline.addLast(&quot;encoder&quot;, new StringEncoder());</span><br><span class="line">                            //åŠ å…¥è‡ªå®šä¹‰çš„handler</span><br><span class="line">                            pipeline.addLast(new GroupChatClientHandler());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">            ChannelFuture channelFuture = bootstrap.connect(host, port).sync();</span><br><span class="line">            //å¾—åˆ°channel</span><br><span class="line">            Channel channel = channelFuture.channel();</span><br><span class="line">            System.out.println(&quot;-------&quot; + channel.localAddress() + &quot;--------&quot;);</span><br><span class="line">            //å®¢æˆ·ç«¯éœ€è¦è¾“å…¥ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªæ‰«æå™¨</span><br><span class="line">            Scanner scanner = new Scanner(System.in);</span><br><span class="line">            while (scanner.hasNextLine()) &#123;</span><br><span class="line">                String msg = scanner.nextLine();</span><br><span class="line">                //é€šè¿‡channel å‘é€åˆ°æœåŠ¡å™¨ç«¯</span><br><span class="line">                channel.writeAndFlush(msg + &quot;\r\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        new GroupChatClient(&quot;127.0.0.1&quot;, 7000).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.groupchat;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line">public class GroupChatClientHandler extends SimpleChannelInboundHandler&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123;</span><br><span class="line">        System.out.println(msg.trim());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="6-12-Netty-å¿ƒè·³æ£€æµ‹æœºåˆ¶æ¡ˆä¾‹"><strong>6.12 Netty å¿ƒè·³æ£€æµ‹æœºåˆ¶æ¡ˆä¾‹</strong></h2><p>å®ä¾‹è¦æ±‚ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªÂ <code>Netty</code>Â å¿ƒè·³æ£€æµ‹æœºåˆ¶æ¡ˆä¾‹,å½“æœåŠ¡å™¨è¶…è¿‡Â <code>3</code>Â ç§’æ²¡æœ‰è¯»æ—¶ï¼Œå°±æç¤ºè¯»ç©ºé—²</li><li>å½“æœåŠ¡å™¨è¶…è¿‡Â <code>5</code>Â ç§’æ²¡æœ‰å†™æ“ä½œæ—¶ï¼Œå°±æç¤ºå†™ç©ºé—²</li><li>å®ç°å½“æœåŠ¡å™¨è¶…è¿‡Â <code>7</code>Â ç§’æ²¡æœ‰è¯»æˆ–è€…å†™æ“ä½œæ—¶ï¼Œå°±æç¤ºè¯»å†™ç©ºé—²</li><li>ä»£ç å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.heartbeat;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.ServerBootstrap;</span><br><span class="line">import io.netty.channel.ChannelFuture;</span><br><span class="line">import io.netty.channel.ChannelInitializer;</span><br><span class="line">import io.netty.channel.ChannelPipeline;</span><br><span class="line">import io.netty.channel.EventLoopGroup;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line">import io.netty.handler.logging.LogLevel;</span><br><span class="line">import io.netty.handler.logging.LoggingHandler;</span><br><span class="line">import io.netty.handler.timeout.IdleStateHandler;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">public class MyServer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„</span><br><span class="line">        EventLoopGroup bossGroup = new NioEventLoopGroup(1);</span><br><span class="line">        EventLoopGroup workerGroup = new NioEventLoopGroup(); //8ä¸ªNioEventLoop</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            ServerBootstrap serverBootstrap = new ServerBootstrap();</span><br><span class="line"></span><br><span class="line">            serverBootstrap.group(bossGroup, workerGroup);</span><br><span class="line">            serverBootstrap.channel(NioServerSocketChannel.class);</span><br><span class="line">            serverBootstrap.handler(new LoggingHandler(LogLevel.INFO));</span><br><span class="line">            serverBootstrap.childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                    ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                    //åŠ å…¥ä¸€ä¸ªnetty æä¾› IdleStateHandler</span><br><span class="line">                    /*</span><br><span class="line">                    è¯´æ˜</span><br><span class="line">                    1. IdleStateHandler æ˜¯netty æä¾›çš„å¤„ç†ç©ºé—²çŠ¶æ€çš„å¤„ç†å™¨</span><br><span class="line">                    2. long readerIdleTime : è¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰è¯», å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿æ¥</span><br><span class="line">                    3. long writerIdleTime : è¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰å†™, å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿æ¥</span><br><span class="line">                    4. long allIdleTime : è¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰è¯»å†™, å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿æ¥</span><br><span class="line"></span><br><span class="line">                    5. æ–‡æ¡£è¯´æ˜</span><br><span class="line">                    triggers an &#123;@link IdleStateEvent&#125; when a &#123;@link Channel&#125; has not performed</span><br><span class="line"> * read, write, or both operation for a while.</span><br><span class="line"> *                  6. å½“ IdleStateEvent è§¦å‘å , å°±ä¼šä¼ é€’ç»™ç®¡é“ çš„ä¸‹ä¸€ä¸ªhandlerå»å¤„ç†</span><br><span class="line"> *                  é€šè¿‡è°ƒç”¨(è§¦å‘)ä¸‹ä¸€ä¸ªhandler çš„ userEventTiggered , åœ¨è¯¥æ–¹æ³•ä¸­å»å¤„ç† IdleStateEvent(è¯»ç©ºé—²ï¼Œå†™ç©ºé—²ï¼Œè¯»å†™ç©ºé—²)</span><br><span class="line">                     */</span><br><span class="line">                    pipeline.addLast(new IdleStateHandler(7000, 7000, 10, TimeUnit.SECONDS));</span><br><span class="line">                    //åŠ å…¥ä¸€ä¸ªå¯¹ç©ºé—²æ£€æµ‹è¿›ä¸€æ­¥å¤„ç†çš„handler(è‡ªå®šä¹‰)</span><br><span class="line">                    pipeline.addLast(new MyServerHandler());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            //å¯åŠ¨æœåŠ¡å™¨</span><br><span class="line">            ChannelFuture channelFuture = serverBootstrap.bind(7000).sync();</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.heartbeat;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line">import io.netty.handler.timeout.IdleStateEvent;</span><br><span class="line"></span><br><span class="line">public class MyServerHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param ctx ä¸Šä¸‹æ–‡</span><br><span class="line">     * @param evt äº‹ä»¶</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        if (evt instanceof IdleStateEvent) &#123;</span><br><span class="line"></span><br><span class="line">            //å°†  evt å‘ä¸‹è½¬å‹ IdleStateEvent</span><br><span class="line">            IdleStateEvent event = (IdleStateEvent) evt;</span><br><span class="line">            String eventType = null;</span><br><span class="line">            switch (event.state()) &#123;</span><br><span class="line">                case READER_IDLE:</span><br><span class="line">                    eventType = &quot;è¯»ç©ºé—²&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case WRITER_IDLE:</span><br><span class="line">                    eventType = &quot;å†™ç©ºé—²&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case ALL_IDLE:</span><br><span class="line">                    eventType = &quot;è¯»å†™ç©ºé—²&quot;;</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(ctx.channel().remoteAddress() + &quot;--è¶…æ—¶æ—¶é—´--&quot; + eventType);</span><br><span class="line">            System.out.println(&quot;æœåŠ¡å™¨åšç›¸åº”å¤„ç†..&quot;);</span><br><span class="line"></span><br><span class="line">            //å¦‚æœå‘ç”Ÿç©ºé—²ï¼Œæˆ‘ä»¬å…³é—­é€šé“</span><br><span class="line">            // ctx.channel().close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="6-13-Netty-é€šè¿‡-WebSocket-ç¼–ç¨‹å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é•¿è¿æ¥"><strong>6.13 Netty é€šè¿‡ WebSocket ç¼–ç¨‹å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é•¿è¿æ¥</strong></h2><p>å®ä¾‹è¦æ±‚ï¼š</p><ol><li><code>Http</code>Â åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨é—´çš„è¯·æ±‚å“åº”ä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡ä¼šé‡æ–°åˆ›å»ºè¿æ¥ã€‚</li><li>è¦æ±‚ï¼šå®ç°åŸºäºÂ <code>WebSocket</code>Â çš„é•¿è¿æ¥çš„å…¨åŒå·¥çš„äº¤äº’</li><li>æ”¹å˜Â <code>Http</code>Â åè®®å¤šæ¬¡è¯·æ±‚çš„çº¦æŸï¼Œå®ç°é•¿è¿æ¥äº†ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€æ¶ˆæ¯ç»™æµè§ˆå™¨</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç«¯ä¼šç›¸äº’æ„ŸçŸ¥ï¼Œæ¯”å¦‚æœåŠ¡å™¨å…³é—­äº†ï¼Œæµè§ˆå™¨ä¼šæ„ŸçŸ¥ï¼ŒåŒæ ·æµè§ˆå™¨å…³é—­äº†ï¼ŒæœåŠ¡å™¨ä¼šæ„ŸçŸ¥</li><li>è¿è¡Œç•Œé¢</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_11.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter06/chapter06_11.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.websocket;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.ServerBootstrap;</span><br><span class="line">import io.netty.channel.ChannelFuture;</span><br><span class="line">import io.netty.channel.ChannelInitializer;</span><br><span class="line">import io.netty.channel.ChannelPipeline;</span><br><span class="line">import io.netty.channel.EventLoopGroup;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line">import io.netty.handler.codec.http.HttpObjectAggregator;</span><br><span class="line">import io.netty.handler.codec.http.HttpServerCodec;</span><br><span class="line">import io.netty.handler.codec.http.websocketx.WebSocketServerProtocolHandler;</span><br><span class="line">import io.netty.handler.logging.LogLevel;</span><br><span class="line">import io.netty.handler.logging.LoggingHandler;</span><br><span class="line">import io.netty.handler.stream.ChunkedWriteHandler;</span><br><span class="line"></span><br><span class="line">public class MyServer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„</span><br><span class="line">        EventLoopGroup bossGroup = new NioEventLoopGroup(1);</span><br><span class="line">        EventLoopGroup workerGroup = new NioEventLoopGroup(); //8ä¸ªNioEventLoop</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            ServerBootstrap serverBootstrap = new ServerBootstrap();</span><br><span class="line"></span><br><span class="line">            serverBootstrap.group(bossGroup, workerGroup);</span><br><span class="line">            serverBootstrap.channel(NioServerSocketChannel.class);</span><br><span class="line">            serverBootstrap.handler(new LoggingHandler(LogLevel.INFO));</span><br><span class="line">            serverBootstrap.childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                    ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line"></span><br><span class="line">                    //å› ä¸ºåŸºäºhttpåè®®ï¼Œä½¿ç”¨httpçš„ç¼–ç å’Œè§£ç å™¨</span><br><span class="line">                    pipeline.addLast(new HttpServerCodec());</span><br><span class="line">                    //æ˜¯ä»¥å—æ–¹å¼å†™ï¼Œæ·»åŠ ChunkedWriteHandlerå¤„ç†å™¨</span><br><span class="line">                    pipeline.addLast(new ChunkedWriteHandler());</span><br><span class="line"></span><br><span class="line">                    /*</span><br><span class="line">                    è¯´æ˜</span><br><span class="line">                    1. httpæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åˆ†æ®µ, HttpObjectAggregator ï¼Œå°±æ˜¯å¯ä»¥å°†å¤šä¸ªæ®µèšåˆ</span><br><span class="line">                    2. è¿™å°±å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œå½“æµè§ˆå™¨å‘é€å¤§é‡æ•°æ®æ—¶ï¼Œå°±ä¼šå‘å‡ºå¤šæ¬¡httpè¯·æ±‚</span><br><span class="line">                     */</span><br><span class="line">                    pipeline.addLast(new HttpObjectAggregator(8192));</span><br><span class="line">                    /*</span><br><span class="line">                    è¯´æ˜</span><br><span class="line">                    1. å¯¹åº”websocket ï¼Œå®ƒçš„æ•°æ®æ˜¯ä»¥ å¸§(frame) å½¢å¼ä¼ é€’</span><br><span class="line">                    2. å¯ä»¥çœ‹åˆ°WebSocketFrame ä¸‹é¢æœ‰å…­ä¸ªå­ç±»</span><br><span class="line">                    3. æµè§ˆå™¨è¯·æ±‚æ—¶ ws://localhost:7000/hello è¡¨ç¤ºè¯·æ±‚çš„uri</span><br><span class="line">                    4. WebSocketServerProtocolHandler æ ¸å¿ƒåŠŸèƒ½æ˜¯å°† httpåè®®å‡çº§ä¸º wsåè®® , ä¿æŒé•¿è¿æ¥</span><br><span class="line">                    5. æ˜¯é€šè¿‡ä¸€ä¸ª çŠ¶æ€ç  101</span><br><span class="line">                     */</span><br><span class="line">                    pipeline.addLast(new WebSocketServerProtocolHandler(&quot;/hello2&quot;));</span><br><span class="line"></span><br><span class="line">                    //è‡ªå®šä¹‰çš„handler ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘</span><br><span class="line">                    pipeline.addLast(new MyTextWebSocketFrameHandler());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            //å¯åŠ¨æœåŠ¡å™¨</span><br><span class="line">            ChannelFuture channelFuture = serverBootstrap.bind(7000).sync();</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.websocket;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line">import io.netty.handler.codec.http.websocketx.TextWebSocketFrame;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">//è¿™é‡Œ TextWebSocketFrame ç±»å‹ï¼Œè¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬å¸§(frame)</span><br><span class="line">public class MyTextWebSocketFrameHandler extends SimpleChannelInboundHandler&lt;TextWebSocketFrame&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void channelRead0(ChannelHandlerContext ctx, TextWebSocketFrame msg) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯ &quot; + msg.text());</span><br><span class="line"></span><br><span class="line">        //å›å¤æ¶ˆæ¯</span><br><span class="line">        ctx.channel().writeAndFlush(new TextWebSocketFrame(&quot;æœåŠ¡å™¨æ—¶é—´&quot; + LocalDateTime.now() + &quot; &quot; + msg.text()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å½“webå®¢æˆ·ç«¯è¿æ¥åï¼Œ è§¦å‘æ–¹æ³•</span><br><span class="line">    @Override</span><br><span class="line">    public void handlerAdded(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        //id è¡¨ç¤ºå”¯ä¸€çš„å€¼ï¼ŒLongText æ˜¯å”¯ä¸€çš„ ShortText ä¸æ˜¯å”¯ä¸€</span><br><span class="line">        System.out.println(&quot;handlerAdded è¢«è°ƒç”¨&quot; + ctx.channel().id().asLongText());</span><br><span class="line">        System.out.println(&quot;handlerAdded è¢«è°ƒç”¨&quot; + ctx.channel().id().asShortText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handlerRemoved(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;handlerRemoved è¢«è°ƒç”¨&quot; + ctx.channel().id().asLongText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;å¼‚å¸¸å‘ç”Ÿ &quot; + cause.getMessage());</span><br><span class="line">        ctx.close(); //å…³é—­è¿æ¥</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello.html</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;&lt;script&gt;var socket;</span><br><span class="line">    //åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒwebsocket</span><br><span class="line">    if(window.WebSocket) &#123;</span><br><span class="line">        //go on</span><br><span class="line">        socket = new WebSocket(&quot;ws://localhost:7000/hello2&quot;);</span><br><span class="line">        //ç›¸å½“äºchannelReado, ev æ”¶åˆ°æœåŠ¡å™¨ç«¯å›é€çš„æ¶ˆæ¯</span><br><span class="line">        socket.onmessage = function (ev) &#123;</span><br><span class="line">            var rt = document.getElementById(&quot;responseText&quot;);</span><br><span class="line">            rt.value = rt.value + &quot;\n&quot; + ev.data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //ç›¸å½“äºè¿æ¥å¼€å¯(æ„ŸçŸ¥åˆ°è¿æ¥å¼€å¯)</span><br><span class="line">        socket.onopen = function (ev) &#123;</span><br><span class="line">            var rt = document.getElementById(&quot;responseText&quot;);</span><br><span class="line">            rt.value = &quot;è¿æ¥å¼€å¯äº†..&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //ç›¸å½“äºè¿æ¥å…³é—­(æ„ŸçŸ¥åˆ°è¿æ¥å…³é—­)</span><br><span class="line">        socket.onclose = function (ev) &#123;</span><br><span class="line"></span><br><span class="line">            var rt = document.getElementById(&quot;responseText&quot;);</span><br><span class="line">            rt.value = rt.value + &quot;\n&quot; + &quot;è¿æ¥å…³é—­äº†..&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        alert(&quot;å½“å‰æµè§ˆå™¨ä¸æ”¯æŒwebsocket&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨</span><br><span class="line">    function send(message) &#123;</span><br><span class="line">        if(!window.socket) &#123; //å…ˆåˆ¤æ–­socketæ˜¯å¦åˆ›å»ºå¥½</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if(socket.readyState == WebSocket.OPEN) &#123;</span><br><span class="line">            //é€šè¿‡socket å‘é€æ¶ˆæ¯</span><br><span class="line">            socket.send(message)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            alert(&quot;è¿æ¥æ²¡æœ‰å¼€å¯&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">    &lt;form onsubmit=&quot;return false&quot;&gt;</span><br><span class="line">        &lt;textarea name=&quot;message&quot; style=&quot;height: 300px; width: 300px&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;å‘ç”Ÿæ¶ˆæ¯&quot; onclick=&quot;send(this.form.message.value)&quot;&gt;</span><br><span class="line">        &lt;textarea id=&quot;responseText&quot; style=&quot;height: 300px; width: 300px&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;æ¸…ç©ºå†…å®¹&quot; onclick=&quot;document.getElementById(&#x27;responseText&#x27;).value=&#x27;&#x27;&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h1><strong>ç¬¬ 7 ç«  Google Protobuf</strong></h1><h2 id="7-1-ç¼–ç å’Œè§£ç çš„åŸºæœ¬ä»‹ç»"><strong>7.1 ç¼–ç å’Œè§£ç çš„åŸºæœ¬ä»‹ç»</strong></h2><ol><li>ç¼–å†™ç½‘ç»œåº”ç”¨ç¨‹åºæ—¶ï¼Œå› ä¸ºæ•°æ®åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„éƒ½æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç æ•°æ®ï¼Œåœ¨å‘é€æ•°æ®æ—¶å°±éœ€è¦ç¼–ç ï¼Œæ¥æ”¶æ•°æ®æ—¶å°±éœ€è¦è§£ç [ç¤ºæ„å›¾]</li><li><code>codec</code>ï¼ˆç¼–è§£ç å™¨ï¼‰çš„ç»„æˆéƒ¨åˆ†æœ‰ä¸¤ä¸ªï¼š<code>decoder</code>ï¼ˆè§£ç å™¨ï¼‰å’ŒÂ <code>encoder</code>ï¼ˆç¼–ç å™¨ï¼‰ã€‚<code>encoder</code>Â è´Ÿè´£æŠŠä¸šåŠ¡æ•°æ®è½¬æ¢æˆå­—èŠ‚ç æ•°æ®ï¼Œ<code>decoder</code>Â è´Ÿè´£æŠŠå­—èŠ‚ç æ•°æ®è½¬æ¢æˆä¸šåŠ¡æ•°æ®</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter07/chapter07_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter07/chapter07_01.png"></p><h2 id="7-2-Netty-æœ¬èº«çš„ç¼–ç è§£ç çš„æœºåˆ¶å’Œé—®é¢˜åˆ†æ"><strong>7.2 Netty æœ¬èº«çš„ç¼–ç è§£ç çš„æœºåˆ¶å’Œé—®é¢˜åˆ†æ</strong></h2><ol><li><code>Netty</code>Â è‡ªèº«æä¾›äº†ä¸€äº›Â <code>codec</code>(ç¼–è§£ç å™¨)</li><li><code>Netty</code>Â æä¾›çš„ç¼–ç å™¨Â <code>StringEncoder</code>ï¼Œå¯¹å­—ç¬¦ä¸²æ•°æ®è¿›è¡Œç¼–ç Â <code>ObjectEncoder</code>ï¼Œå¯¹Javaå¯¹è±¡è¿›è¡Œç¼–ç â€¦</li><li><code>Netty</code>Â æä¾›çš„è§£ç å™¨Â <code>StringDecoder</code>,å¯¹å­—ç¬¦ä¸²æ•°æ®è¿›è¡Œè§£ç Â <code>ObjectDecoder</code>ï¼Œå¯¹Â <code>Java</code>Â å¯¹è±¡è¿›è¡Œè§£ç â€¦</li><li><code>Netty</code>Â æœ¬èº«è‡ªå¸¦çš„Â <code>ObjectDecoder</code>Â å’ŒÂ <code>ObjectEncoder</code>Â å¯ä»¥ç”¨æ¥å®ç°Â <code>POJO</code>Â å¯¹è±¡æˆ–å„ç§ä¸šåŠ¡å¯¹è±¡çš„ç¼–ç å’Œè§£ç ï¼Œåº•å±‚ä½¿ç”¨çš„ä»æ˜¯Javaåºåˆ—åŒ–æŠ€æœ¯,è€ŒJavaåºåˆ—åŒ–æŠ€æœ¯æœ¬èº«æ•ˆç‡å°±ä¸é«˜ï¼Œå­˜åœ¨å¦‚ä¸‹é—®é¢˜<ul><li>æ— æ³•è·¨è¯­è¨€</li><li>åºåˆ—åŒ–åçš„ä½“ç§¯å¤ªå¤§ï¼Œæ˜¯äºŒè¿›åˆ¶ç¼–ç çš„5å€å¤šã€‚</li><li>åºåˆ—åŒ–æ€§èƒ½å¤ªä½</li></ul></li><li>=&gt;å¼•å‡ºæ–°çš„è§£å†³æ–¹æ¡ˆ[<code>Google</code>Â çš„Â <code>Protobuf</code>]</li></ol><h2 id="7-3-Protobuf"><strong>7.3 Protobuf</strong></h2><ol><li><code>Protobuf</code>Â åŸºæœ¬ä»‹ç»å’Œä½¿ç”¨ç¤ºæ„å›¾</li><li><code>Protobuf</code>Â æ˜¯Â <code>Google</code>Â å‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œå…¨ç§°Â <code>Google Protocol Buffers</code>ï¼Œæ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¯ä»¥ç”¨äºç»“æ„åŒ–æ•°æ®ä¸²è¡ŒåŒ–ï¼Œæˆ–è€…è¯´åºåˆ—åŒ–ã€‚å®ƒå¾ˆé€‚åˆåšæ•°æ®å­˜å‚¨æˆ–Â <code>RPC</code>Â [è¿œç¨‹è¿‡ç¨‹è°ƒç”¨Â <code>remote procedure call</code>Â ]æ•°æ®äº¤æ¢æ ¼å¼ã€‚ç›®å‰å¾ˆå¤šå…¬å¸Â <code>http + json tcp + protobuf</code></li><li>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://developers.google.com/protocol-buffers/docs/proto"><strong>https://developers.google.com/protocol-buffers/docs/proto</strong></a>Â è¯­è¨€æŒ‡å—</li><li><code>Protobuf</code>Â æ˜¯ä»¥Â <code>message</code>Â çš„æ–¹å¼æ¥ç®¡ç†æ•°æ®çš„.</li><li>æ”¯æŒè·¨å¹³å°ã€è·¨è¯­è¨€ï¼Œå³[å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å¯ä»¥æ˜¯ä¸åŒçš„è¯­è¨€ç¼–å†™çš„]ï¼ˆæ”¯æŒç›®å‰ç»å¤§å¤šæ•°è¯­è¨€ï¼Œä¾‹å¦‚Â <code>C++</code>ã€<code>C#</code>ã€<code>Java</code>ã€<code>python</code>Â ç­‰ï¼‰</li><li>é«˜æ€§èƒ½ï¼Œé«˜å¯é æ€§</li><li>ä½¿ç”¨Â <code>protobuf</code>Â ç¼–è¯‘å™¨èƒ½è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œ<code>Protobuf</code>Â æ˜¯å°†ç±»çš„å®šä¹‰ä½¿ç”¨Â <code>.proto</code>Â æ–‡ä»¶è¿›è¡Œæè¿°ã€‚è¯´æ˜ï¼Œåœ¨Â <code>idea</code>Â ä¸­ç¼–å†™Â <code>.proto</code>Â æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨æç¤ºæ˜¯å¦ä¸‹è½½Â <code>.ptoto</code>Â ç¼–å†™æ’ä»¶.å¯ä»¥è®©è¯­æ³•é«˜äº®ã€‚</li><li>ç„¶åé€šè¿‡Â <code>protoc.exe</code>Â ç¼–è¯‘å™¨æ ¹æ®Â <code>.proto</code>Â è‡ªåŠ¨ç”ŸæˆÂ <code>.java</code>Â æ–‡ä»¶</li><li><code>protobuf</code>Â ä½¿ç”¨ç¤ºæ„å›¾</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter07/chapter07_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter07/chapter07_02.png"></p><h2 id="7-4-Protobuf-å¿«é€Ÿå…¥é—¨å®ä¾‹"><strong>7.4 Protobuf å¿«é€Ÿå…¥é—¨å®ä¾‹</strong></h2><p>ç¼–å†™ç¨‹åºï¼Œä½¿ç”¨Â <code>Protobuf</code>Â å®Œæˆå¦‚ä¸‹åŠŸèƒ½</p><ol><li>å®¢æˆ·ç«¯å¯ä»¥å‘é€ä¸€ä¸ªÂ <code>StudentPoJo</code>Â å¯¹è±¡åˆ°æœåŠ¡å™¨(é€šè¿‡Â <code>Protobuf</code>Â ç¼–ç )</li><li>æœåŠ¡ç«¯èƒ½æ¥æ”¶Â <code>StudentPoJo</code>Â å¯¹è±¡ï¼Œå¹¶æ˜¾ç¤ºä¿¡æ¯(é€šè¿‡Â <code>Protobuf</code>Â è§£ç )</li><li>å…·ä½“çœ‹è€å¸ˆæ¼”ç¤ºæ­¥éª¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Student.proto</span><br><span class="line"></span><br><span class="line">syntax = &quot;proto3&quot;; //ç‰ˆæœ¬</span><br><span class="line">option java_outer_classname = &quot;StudentPOJO&quot;;//ç”Ÿæˆçš„å¤–éƒ¨ç±»åï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ–‡ä»¶å</span><br><span class="line">//protobuf ä½¿ç”¨message ç®¡ç†æ•°æ®</span><br><span class="line">message Student &#123; //ä¼šåœ¨ StudentPOJO å¤–éƒ¨ç±»ç”Ÿæˆä¸€ä¸ªå†…éƒ¨ç±» Studentï¼Œ ä»–æ˜¯çœŸæ­£å‘é€çš„POJOå¯¹è±¡</span><br><span class="line">    int32 id = 1; // Student ç±»ä¸­æœ‰ ä¸€ä¸ªå±æ€§ åå­—ä¸º id ç±»å‹ä¸ºint32(protobufç±»å‹) 1è¡¨ç¤ºå±æ€§åºå·ï¼Œä¸æ˜¯å€¼</span><br><span class="line">    string name = 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘</span><br><span class="line">protoc.exe--java_out=.Student.proto</span><br><span class="line">å°†ç”Ÿæˆçš„ StudentPOJO æ”¾å…¥åˆ°é¡¹ç›®ä½¿ç”¨Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="7-5-Protobuf-å¿«é€Ÿå…¥é—¨å®ä¾‹-2"><strong>7.5 Protobuf å¿«é€Ÿå…¥é—¨å®ä¾‹ 2</strong></h2><ol><li>ç¼–å†™ç¨‹åºï¼Œä½¿ç”¨Â <code>Protobuf</code>Â å®Œæˆå¦‚ä¸‹åŠŸèƒ½</li><li>å®¢æˆ·ç«¯å¯ä»¥éšæœºå‘é€Â <code>StudentPoJo</code>Â /Â <code>WorkerPoJo</code>Â å¯¹è±¡åˆ°æœåŠ¡å™¨(é€šè¿‡Â <code>Protobuf</code>Â ç¼–ç )</li><li>æœåŠ¡ç«¯èƒ½æ¥æ”¶Â <code>StudentPoJo</code>Â /Â <code>WorkerPoJo</code>Â å¯¹è±¡(éœ€è¦åˆ¤æ–­æ˜¯å“ªç§ç±»å‹)ï¼Œå¹¶æ˜¾ç¤ºä¿¡æ¯(é€šè¿‡Â <code>Protobuf</code>Â è§£ç )</li><li>å…·ä½“çœ‹è€å¸ˆæ¼”ç¤ºæ­¥éª¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Student.proto</span><br><span class="line"></span><br><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line">option optimize_for = SPEED; // åŠ å¿«è§£æ</span><br><span class="line">option java_package=&quot;com.atguigu.netty.codec2&quot;;   //æŒ‡å®šç”Ÿæˆåˆ°å“ªä¸ªåŒ…ä¸‹</span><br><span class="line">option java_outer_classname=&quot;MyDataInfo&quot;; // å¤–éƒ¨ç±»å, æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">//protobuf å¯ä»¥ä½¿ç”¨message ç®¡ç†å…¶ä»–çš„message</span><br><span class="line">message MyMessage &#123;</span><br><span class="line"></span><br><span class="line">    //å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹</span><br><span class="line">    enum DataType &#123;</span><br><span class="line">        StudentType = 0; //åœ¨proto3 è¦æ±‚enumçš„ç¼–å·ä»0å¼€å§‹</span><br><span class="line">        WorkerType = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //ç”¨data_type æ¥æ ‡è¯†ä¼ çš„æ˜¯å“ªä¸€ä¸ªæšä¸¾ç±»å‹</span><br><span class="line">    DataType data_type = 1;</span><br><span class="line"></span><br><span class="line">    //è¡¨ç¤ºæ¯æ¬¡æšä¸¾ç±»å‹æœ€å¤šåªèƒ½å‡ºç°å…¶ä¸­çš„ä¸€ä¸ª, èŠ‚çœç©ºé—´</span><br><span class="line">    oneof dataBody &#123;</span><br><span class="line">        Student student = 2;</span><br><span class="line">        Worker worker = 3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Student &#123;</span><br><span class="line">    int32 id = 1;//Studentç±»çš„å±æ€§</span><br><span class="line">    string name = 2; //</span><br><span class="line">&#125;</span><br><span class="line">message Worker &#123;</span><br><span class="line">    string name=1;</span><br><span class="line">    int32 age=2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><strong>ç¬¬ 8 ç«  Netty ç¼–è§£ç å™¨å’Œ Handler è°ƒç”¨æœºåˆ¶</strong></h1><h2 id="8-1-åŸºæœ¬è¯´æ˜"><strong>8.1 åŸºæœ¬è¯´æ˜</strong></h2><ol><li><code>Netty</code>Â çš„ç»„ä»¶è®¾è®¡ï¼š<code>Netty</code>Â çš„ä¸»è¦ç»„ä»¶æœ‰Â <code>Channel</code>ã€<code>EventLoop</code>ã€<code>ChannelFuture</code>ã€<code>ChannelHandler</code>ã€<code>ChannelPipe</code>Â ç­‰</li><li><code>ChannelHandler</code>Â å……å½“äº†å¤„ç†å…¥ç«™å’Œå‡ºç«™æ•°æ®çš„åº”ç”¨ç¨‹åºé€»è¾‘çš„å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå®ç°Â <code>ChannelInboundHandler</code>Â æ¥å£ï¼ˆæˆ–Â <code>ChannelInboundHandlerAdapter</code>ï¼‰ï¼Œä½ å°±å¯ä»¥æ¥æ”¶å…¥ç«™äº‹ä»¶å’Œæ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šè¢«ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚å½“è¦ç»™å®¢æˆ·ç«¯å‘é€å“åº”æ—¶ï¼Œä¹Ÿå¯ä»¥ä»Â <code>ChannelInboundHandler</code>Â å†²åˆ·æ•°æ®ã€‚ä¸šåŠ¡é€»è¾‘é€šå¸¸å†™åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªÂ <code>ChannelInboundHandler</code>Â ä¸­ã€‚<code>ChannelOutboundHandler</code>Â åŸç†ä¸€æ ·ï¼Œåªä¸è¿‡å®ƒæ˜¯ç”¨æ¥å¤„ç†å‡ºç«™æ•°æ®çš„</li><li><code>ChannelPipeline</code>Â æä¾›äº†Â <code>ChannelHandler</code>Â é“¾çš„å®¹å™¨ã€‚ä»¥å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸ºä¾‹ï¼Œå¦‚æœäº‹ä»¶çš„è¿åŠ¨æ–¹å‘æ˜¯ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™äº›äº‹ä»¶ä¸ºå‡ºç«™çš„ï¼Œå³å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ®ä¼šé€šè¿‡Â <code>pipeline</code>Â ä¸­çš„ä¸€ç³»åˆ—Â <code>ChannelOutboundHandler</code>ï¼Œå¹¶è¢«è¿™äº›Â <code>Handler</code>Â å¤„ç†ï¼Œåä¹‹åˆ™ç§°ä¸ºå…¥ç«™çš„</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_01.png"></p><h2 id="8-2ç¼–ç è§£ç å™¨"><strong>8.2ç¼–ç è§£ç å™¨</strong></h2><ol><li>å½“Â <code>Netty</code>Â å‘é€æˆ–è€…æ¥å—ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±å°†ä¼šå‘ç”Ÿä¸€æ¬¡æ•°æ®è½¬æ¢ã€‚å…¥ç«™æ¶ˆæ¯ä¼šè¢«è§£ç ï¼šä»å­—èŠ‚è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼ˆæ¯”å¦‚Â <code>java</code>Â å¯¹è±¡ï¼‰ï¼›å¦‚æœæ˜¯å‡ºç«™æ¶ˆæ¯ï¼Œå®ƒä¼šè¢«ç¼–ç æˆå­—èŠ‚ã€‚</li><li><code>Netty</code>Â æä¾›ä¸€ç³»åˆ—å®ç”¨çš„ç¼–è§£ç å™¨ï¼Œä»–ä»¬éƒ½å®ç°äº†Â <code>ChannelInboundHadnler</code>Â æˆ–è€…Â <code>ChannelOutboundHandler</code>Â æ¥å£ã€‚åœ¨è¿™äº›ç±»ä¸­ï¼Œ<code>channelRead</code>Â æ–¹æ³•å·²ç»è¢«é‡å†™äº†ã€‚ä»¥å…¥ç«™ä¸ºä¾‹ï¼Œå¯¹äºæ¯ä¸ªä»å…¥ç«™Â <code>Channel</code>Â è¯»å–çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚éšåï¼Œå®ƒå°†è°ƒç”¨ç”±è§£ç å™¨æ‰€æä¾›çš„Â <code>decode()</code>Â æ–¹æ³•è¿›è¡Œè§£ç ï¼Œå¹¶å°†å·²ç»è§£ç çš„å­—èŠ‚è½¬å‘ç»™Â <code>ChannelPipeline</code>Â ä¸­çš„ä¸‹ä¸€ä¸ªÂ <code>ChannelInboundHandler</code>ã€‚</li></ol><h2 id="8-3-è§£ç å™¨-ByteToMessageDecoder"><strong>8.3 è§£ç å™¨ - ByteToMessageDecoder</strong></h2><ol><li>å…³ç³»ç»§æ‰¿å›¾</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_02.png"></p><ol><li>ç”±äºä¸å¯èƒ½çŸ¥é“è¿œç¨‹èŠ‚ç‚¹æ˜¯å¦ä¼šä¸€æ¬¡æ€§å‘é€ä¸€ä¸ªå®Œæ•´çš„ä¿¡æ¯ï¼Œ<code>tcp</code>Â æœ‰å¯èƒ½å‡ºç°ç²˜åŒ…æ‹†åŒ…çš„é—®é¢˜ï¼Œè¿™ä¸ªç±»ä¼šå¯¹å…¥ç«™æ•°æ®è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°å®ƒå‡†å¤‡å¥½è¢«å¤„ç†.</li><li>ä¸€ä¸ªå…³äºÂ <code>ByteToMessageDecoder</code>Â å®ä¾‹åˆ†æ</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_03.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_03.png"></p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_04.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_04.png"></p><h2 id="8-4-Netty-çš„-handler-é“¾çš„è°ƒç”¨æœºåˆ¶"><strong>8.4 Netty çš„ handler é“¾çš„è°ƒç”¨æœºåˆ¶</strong></h2><p>å®ä¾‹è¦æ±‚:</p><ol><li>ä½¿ç”¨è‡ªå®šä¹‰çš„ç¼–ç å™¨å’Œè§£ç å™¨æ¥è¯´æ˜Â <code>Netty</code>Â çš„Â <code>handler</code>Â è°ƒç”¨æœºåˆ¶ å®¢æˆ·ç«¯å‘é€Â <code>long</code>Â -&gt; æœåŠ¡å™¨ æœåŠ¡ç«¯å‘é€Â <code>long</code>Â -&gt; å®¢æˆ·ç«¯</li><li>æ¡ˆä¾‹æ¼”ç¤º</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_05.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_05.png"></p><ol><li>ç»“è®º<ul><li>ä¸è®ºè§£ç å™¨Â <code>handler</code>Â è¿˜æ˜¯ç¼–ç å™¨Â <code>handler</code>Â å³æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹å¿…é¡»ä¸å¾…å¤„ç†çš„æ¶ˆæ¯ç±»å‹ä¸€è‡´ï¼Œå¦åˆ™è¯¥Â <code>handler</code>Â ä¸ä¼šè¢«æ‰§è¡Œ</li><li>åœ¨è§£ç å™¨è¿›è¡Œæ•°æ®è§£ç æ—¶ï¼Œéœ€è¦åˆ¤æ–­ç¼“å­˜åŒºï¼ˆ<code>ByteBuf</code>ï¼‰çš„æ•°æ®æ˜¯å¦è¶³å¤Ÿï¼Œå¦åˆ™æ¥æ”¶åˆ°çš„ç»“æœä¼šæœŸæœ›ç»“æœå¯èƒ½ä¸ä¸€è‡´</li></ul></li></ol><h2 id="8-5-è§£ç å™¨-ReplayingDecoder"><strong>8.5 è§£ç å™¨ - ReplayingDecoder</strong></h2><ol><li><code>public abstract class ReplayingDecoder&lt;S&gt; extends ByteToMessageDecoder</code></li><li><code>ReplayingDecoder</code>Â æ‰©å±•äº†Â <code>ByteToMessageDecoder</code>Â ç±»ï¼Œä½¿ç”¨è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬ä¸å¿…è°ƒç”¨Â <code>readableBytes()</code>Â æ–¹æ³•ã€‚å‚æ•°Â <code>S</code>Â æŒ‡å®šäº†ç”¨æˆ·çŠ¶æ€ç®¡ç†çš„ç±»å‹ï¼Œå…¶ä¸­Â <code>Void</code>Â ä»£è¡¨ä¸éœ€è¦çŠ¶æ€ç®¡ç†</li><li>åº”ç”¨å®ä¾‹ï¼šä½¿ç”¨Â <code>ReplayingDecoder</code>Â ç¼–å†™è§£ç å™¨ï¼Œå¯¹å‰é¢çš„æ¡ˆä¾‹è¿›è¡Œç®€åŒ–[æ¡ˆä¾‹æ¼”ç¤º]</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.inboundhandlerandoutboundhandler;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.handler.codec.ReplayingDecoder;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class MyByteToLongDecoder2 extends ReplayingDecoder&lt;Void&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyByteToLongDecoder2 è¢«è°ƒç”¨&quot;);</span><br><span class="line">        //åœ¨ ReplayingDecoder ä¸éœ€è¦åˆ¤æ–­æ•°æ®æ˜¯å¦è¶³å¤Ÿè¯»å–ï¼Œå†…éƒ¨ä¼šè¿›è¡Œå¤„ç†åˆ¤æ–­</span><br><span class="line">        out.add(in.readLong());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li><code>ReplayingDecoder</code>Â ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼š<ul><li>å¹¶ä¸æ˜¯æ‰€æœ‰çš„Â <code>ByteBuf</code>Â æ“ä½œéƒ½è¢«æ”¯æŒï¼Œå¦‚æœè°ƒç”¨äº†ä¸€ä¸ªä¸è¢«æ”¯æŒçš„æ–¹æ³•ï¼Œå°†ä¼šæŠ›å‡ºä¸€ä¸ªÂ <code>UnsupportedOperationException</code>ã€‚</li><li><code>ReplayingDecoder</code>Â åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ç¨æ…¢äºÂ <code>ByteToMessageDecoder</code>ï¼Œä¾‹å¦‚ç½‘ç»œç¼“æ…¢å¹¶ä¸”æ¶ˆæ¯æ ¼å¼å¤æ‚æ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«æ‹†æˆäº†å¤šä¸ªç¢ç‰‡ï¼Œé€Ÿåº¦å˜æ…¢</li></ul></li></ol><h2 id="8-6-å…¶å®ƒç¼–è§£ç å™¨"><strong>8.6 å…¶å®ƒç¼–è§£ç å™¨</strong></h2><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_06.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_06.png"></p><h3 id="8-6-1-å…¶å®ƒè§£ç å™¨"><strong>8.6.1 å…¶å®ƒè§£ç å™¨</strong></h3><ol><li><code>LineBasedFrameDecoder</code>ï¼šè¿™ä¸ªç±»åœ¨Â <code>Netty</code>Â å†…éƒ¨ä¹Ÿæœ‰ä½¿ç”¨ï¼Œå®ƒä½¿ç”¨è¡Œå°¾æ§åˆ¶å­—ç¬¦ï¼ˆ\næˆ–è€…\r\nï¼‰ä½œä¸ºåˆ†éš”ç¬¦æ¥è§£ææ•°æ®ã€‚</li><li><code>DelimiterBasedFrameDecoder</code>ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„ç‰¹æ®Šå­—ç¬¦ä½œä¸ºæ¶ˆæ¯çš„åˆ†éš”ç¬¦ã€‚</li><li><code>HttpObjectDecoder</code>ï¼šä¸€ä¸ªÂ <code>HTTP</code>Â æ•°æ®çš„è§£ç å™¨</li><li><code>LengthFieldBasedFrameDecoder</code>ï¼šé€šè¿‡æŒ‡å®šé•¿åº¦æ¥æ ‡è¯†æ•´åŒ…æ¶ˆæ¯ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨çš„å¤„ç†é»åŒ…å’ŒåŠåŒ…æ¶ˆæ¯ã€‚</li></ol><h3 id="8-6-2-å…¶å®ƒç¼–ç å™¨"><strong>8.6.2 å…¶å®ƒç¼–ç å™¨</strong></h3><h2 id="8-7-Log4j-æ•´åˆåˆ°-Netty"><strong>8.7 Log4j æ•´åˆåˆ° Netty</strong></h2><ol><li>åœ¨Â <code>Maven</code>Â ä¸­æ·»åŠ å¯¹Â <code>Log4j</code>Â çš„ä¾èµ–åœ¨Â <code>pom.xml</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;&lt;groupId&gt;log4j&lt;/groupId&gt;&lt;artifactId&gt;log4j&lt;/artifactId&gt;&lt;version&gt;1.2.17&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;&lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;&lt;version&gt;1.7.25&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;&lt;version&gt;1.7.25&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>é…ç½®Â <code>Log4j</code>ï¼Œåœ¨Â <code>resources/log4j.properties</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger=DEBUG,stdout</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=[%p]%C&#123;1&#125;-%m%nCopy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>æ¼”ç¤ºæ•´åˆ</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_07.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter08/chapter08_07.png"></p><h1><strong>ç¬¬ 9 ç«  TCP ç²˜åŒ…å’Œæ‹†åŒ…åŠè§£å†³æ–¹æ¡ˆ</strong></h1><h2 id="9-1-TCP-ç²˜åŒ…å’Œæ‹†åŒ…åŸºæœ¬ä»‹ç»"><strong>9.1 TCP ç²˜åŒ…å’Œæ‹†åŒ…åŸºæœ¬ä»‹ç»</strong></h2><ol><li><code>TCP</code>Â æ˜¯é¢å‘è¿æ¥çš„ï¼Œé¢å‘æµçš„ï¼Œæä¾›é«˜å¯é æ€§æœåŠ¡ã€‚æ”¶å‘ä¸¤ç«¯ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼‰éƒ½è¦æœ‰ä¸€ä¸€æˆå¯¹çš„Â <code>socket</code>ï¼Œå› æ­¤ï¼Œå‘é€ç«¯ä¸ºäº†å°†å¤šä¸ªå‘ç»™æ¥æ”¶ç«¯çš„åŒ…ï¼Œæ›´æœ‰æ•ˆçš„å‘ç»™å¯¹æ–¹ï¼Œä½¿ç”¨äº†ä¼˜åŒ–æ–¹æ³•ï¼ˆ<code>Nagle</code>Â ç®—æ³•ï¼‰ï¼Œå°†å¤šæ¬¡é—´éš”è¾ƒå°ä¸”æ•°æ®é‡å°çš„æ•°æ®ï¼Œåˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°æ®å—ï¼Œç„¶åè¿›è¡Œå°åŒ…ã€‚è¿™æ ·åšè™½ç„¶æé«˜äº†æ•ˆç‡ï¼Œä½†æ˜¯æ¥æ”¶ç«¯å°±éš¾äºåˆ†è¾¨å‡ºå®Œæ•´çš„æ•°æ®åŒ…äº†ï¼Œå› ä¸ºé¢å‘æµçš„é€šä¿¡æ˜¯æ— æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œçš„</li><li>ç”±äºÂ <code>TCP</code>Â æ— æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œ,éœ€è¦åœ¨æ¥æ”¶ç«¯å¤„ç†æ¶ˆæ¯è¾¹ç•Œé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç²˜åŒ…ã€æ‹†åŒ…é—®é¢˜,çœ‹ä¸€å¼ å›¾</li><li>ç¤ºæ„å›¾Â <code>TCP</code>Â ç²˜åŒ…ã€æ‹†åŒ…å›¾è§£</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter09/chapter09_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter09/chapter09_01.png"></p><p>å¯¹å›¾çš„è¯´æ˜: å‡è®¾å®¢æˆ·ç«¯åˆ†åˆ«å‘é€äº†ä¸¤ä¸ªæ•°æ®åŒ…Â <code>D1</code>Â å’ŒÂ <code>D2</code>Â ç»™æœåŠ¡ç«¯ï¼Œç”±äºæœåŠ¡ç«¯ä¸€æ¬¡è¯»å–åˆ°å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ•…å¯èƒ½å­˜åœ¨ä»¥ä¸‹å››ç§æƒ…å†µï¼š</p><ol><li>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®åŒ…ï¼Œåˆ†åˆ«æ˜¯Â <code>D1</code>Â å’ŒÂ <code>D2</code>ï¼Œæ²¡æœ‰ç²˜åŒ…å’Œæ‹†åŒ…</li><li>æœåŠ¡ç«¯ä¸€æ¬¡æ¥å—åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œ<code>D1</code>Â å’ŒÂ <code>D2</code>Â ç²˜åˆåœ¨ä¸€èµ·ï¼Œç§°ä¹‹ä¸ºÂ <code>TCP</code>Â ç²˜åŒ…</li><li>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†æ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†å®Œæ•´çš„Â <code>D1</code>Â åŒ…å’ŒÂ <code>D2</code>Â åŒ…çš„éƒ¨åˆ†å†…å®¹ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†Â <code>D2</code>Â åŒ…çš„å‰©ä½™å†…å®¹ï¼Œè¿™ç§°ä¹‹ä¸ºÂ <code>TCP</code>Â æ‹†åŒ…</li><li>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†æ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†Â <code>D1</code>Â åŒ…çš„éƒ¨åˆ†å†…å®¹Â <code>D1_1</code>ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†Â <code>D1</code>Â åŒ…çš„å‰©ä½™éƒ¨åˆ†å†…å®¹Â <code>D1_2</code>Â å’Œå®Œæ•´çš„Â <code>D2</code>Â åŒ…ã€‚</li></ol><h2 id="9-2-TCP-ç²˜åŒ…å’Œæ‹†åŒ…ç°è±¡å®ä¾‹"><strong>9.2 TCP ç²˜åŒ…å’Œæ‹†åŒ…ç°è±¡å®ä¾‹</strong></h2><p>åœ¨ç¼–å†™Â <code>Netty</code>Â ç¨‹åºæ—¶ï¼Œå¦‚æœæ²¡æœ‰åšå¤„ç†ï¼Œå°±ä¼šå‘ç”Ÿç²˜åŒ…å’Œæ‹†åŒ…çš„é—®é¢˜</p><p>çœ‹ä¸€ä¸ªå…·ä½“çš„å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">// æ ¸å¿ƒä»£ç </span><br><span class="line"></span><br><span class="line">MyClientHandler.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.tcp;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.buffer.Unpooled;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">public class MyClientHandler extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private int count;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelActive(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        //ä½¿ç”¨å®¢æˆ·ç«¯å‘é€10æ¡æ•°æ® hello,server ç¼–å·</span><br><span class="line">        for (int i = 0; i &lt; 10; ++i) &#123;</span><br><span class="line">            ByteBuf buffer = Unpooled.copiedBuffer(&quot;hello,server &quot; + i, Charset.forName(&quot;utf-8&quot;));</span><br><span class="line">            ctx.writeAndFlush(buffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void channelRead0(ChannelHandlerContext ctx, ByteBuf msg) throws Exception &#123;</span><br><span class="line">        byte[] buffer = new byte[msg.readableBytes()];</span><br><span class="line">        msg.readBytes(buffer);</span><br><span class="line"></span><br><span class="line">        String message = new String(buffer, Charset.forName(&quot;utf-8&quot;));</span><br><span class="line">        System.out.println(&quot;å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯=&quot; + message);</span><br><span class="line">        System.out.println(&quot;å®¢æˆ·ç«¯æ¥æ”¶æ¶ˆæ¯æ•°é‡=&quot; + (++this.count));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyServerHandler.java</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.tcp;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.buffer.Unpooled;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">public class MyServerHandler extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private int count;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        //cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void channelRead0(ChannelHandlerContext ctx, ByteBuf msg) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        byte[] buffer = new byte[msg.readableBytes()];</span><br><span class="line">        msg.readBytes(buffer);</span><br><span class="line"></span><br><span class="line">        //å°†bufferè½¬æˆå­—ç¬¦ä¸²</span><br><span class="line">        String message = new String(buffer, Charset.forName(&quot;utf-8&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ® &quot; + message);</span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨æ¥æ”¶åˆ°æ¶ˆæ¯é‡=&quot; + (++this.count));</span><br><span class="line"></span><br><span class="line">        //æœåŠ¡å™¨å›é€æ•°æ®ç»™å®¢æˆ·ç«¯, å›é€ä¸€ä¸ªéšæœºid ,</span><br><span class="line">        ByteBuf responseByteBuf = Unpooled.copiedBuffer(UUID.randomUUID().toString() + &quot; &quot;, Charset.forName(&quot;utf-8&quot;));</span><br><span class="line">        ctx.writeAndFlush(responseByteBuf);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h2 id="9-3-TCP-ç²˜åŒ…å’Œæ‹†åŒ…è§£å†³æ–¹æ¡ˆ"><strong>9.3 TCP ç²˜åŒ…å’Œæ‹†åŒ…è§£å†³æ–¹æ¡ˆ</strong></h2><ol><li>ä½¿ç”¨è‡ªå®šä¹‰åè®®+ç¼–è§£ç å™¨æ¥è§£å†³</li><li>å…³é”®å°±æ˜¯è¦è§£å†³æœåŠ¡å™¨ç«¯æ¯æ¬¡è¯»å–æ•°æ®é•¿åº¦çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜è§£å†³ï¼Œå°±ä¸ä¼šå‡ºç°æœåŠ¡å™¨å¤šè¯»æˆ–å°‘è¯»æ•°æ®çš„é—®é¢˜ï¼Œä»è€Œé¿å…çš„Â <code>TCP</code>Â ç²˜åŒ…ã€æ‹†åŒ…ã€‚</li></ol><h2 id="9-4-çœ‹ä¸€ä¸ªå…·ä½“çš„å®ä¾‹"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter09?id=_94-%e7%9c%8b%e4%b8%80%e4%b8%aa%e5%85%b7%e4%bd%93%e7%9a%84%e5%ae%9e%e4%be%8b"><strong>9.4 çœ‹ä¸€ä¸ªå…·ä½“çš„å®ä¾‹</strong></a></h2><ol><li>è¦æ±‚å®¢æˆ·ç«¯å‘é€Â <code>5</code>Â ä¸ªÂ <code>Message</code>Â å¯¹è±¡ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡å‘é€ä¸€ä¸ªÂ <code>Message</code>Â å¯¹è±¡</li><li>æœåŠ¡å™¨ç«¯æ¯æ¬¡æ¥æ”¶ä¸€ä¸ªÂ <code>Message</code>ï¼Œåˆ†Â <code>5</code>Â æ¬¡è¿›è¡Œè§£ç ï¼Œæ¯è¯»å–åˆ°ä¸€ä¸ªÂ <code>Message</code>ï¼Œä¼šå›å¤ä¸€ä¸ªÂ <code>Message</code>Â å¯¹è±¡ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter09/chapter09_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter09/chapter09_02.png"></p><ol><li>ä»£ç æ¼”ç¤ºï¼Œå…¨éƒ¨ä»£ç æ ¸å¿ƒ</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">// æ ¸å¿ƒ</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.protocoltcp;</span><br><span class="line"></span><br><span class="line">//åè®®åŒ…</span><br><span class="line">public class MessageProtocol &#123;</span><br><span class="line"></span><br><span class="line">    private int len; //å…³é”®</span><br><span class="line"></span><br><span class="line">    private byte[] content;</span><br><span class="line"></span><br><span class="line">    public int getLen() &#123;</span><br><span class="line">        return len;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLen(int len) &#123;</span><br><span class="line">        this.len = len;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public byte[] getContent() &#123;</span><br><span class="line">        return content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setContent(byte[] content) &#123;</span><br><span class="line">        this.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.protocoltcp;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">public class MyClientHandler extends SimpleChannelInboundHandler&lt;MessageProtocol&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private int count;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelActive(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        //ä½¿ç”¨å®¢æˆ·ç«¯å‘é€10æ¡æ•°æ® &quot;ä»Šå¤©å¤©æ°”å†·ï¼Œåƒç«é”…&quot; ç¼–å·</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">            String mes = &quot;ä»Šå¤©å¤©æ°”å†·ï¼Œåƒç«é”…&quot;;</span><br><span class="line">            byte[] content = mes.getBytes(Charset.forName(&quot;utf-8&quot;));</span><br><span class="line">            int length = mes.getBytes(Charset.forName(&quot;utf-8&quot;)).length;</span><br><span class="line"></span><br><span class="line">            //åˆ›å»ºåè®®åŒ…å¯¹è±¡</span><br><span class="line">            MessageProtocol messageProtocol = new MessageProtocol();</span><br><span class="line">            messageProtocol.setLen(length);</span><br><span class="line">            messageProtocol.setContent(content);</span><br><span class="line">            ctx.writeAndFlush(messageProtocol);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //    @Override</span><br><span class="line">    protected void channelRead0(ChannelHandlerContext ctx, MessageProtocol msg) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        int len = msg.getLen();</span><br><span class="line">        byte[] content = msg.getContent();</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯å¦‚ä¸‹&quot;);</span><br><span class="line">        System.out.println(&quot;é•¿åº¦=&quot; + len);</span><br><span class="line">        System.out.println(&quot;å†…å®¹=&quot; + new String(content, Charset.forName(&quot;utf-8&quot;)));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;å®¢æˆ·ç«¯æ¥æ”¶æ¶ˆæ¯æ•°é‡=&quot; + (++this.count));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;å¼‚å¸¸æ¶ˆæ¯=&quot; + cause.getMessage());</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.protocoltcp;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.handler.codec.MessageToByteEncoder;</span><br><span class="line"></span><br><span class="line">public class MyMessageEncoder extends MessageToByteEncoder&lt;MessageProtocol&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void encode(ChannelHandlerContext ctx, MessageProtocol msg, ByteBuf out) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyMessageEncoder encode æ–¹æ³•è¢«è°ƒç”¨&quot;);</span><br><span class="line">        out.writeInt(msg.getLen());</span><br><span class="line">        out.writeBytes(msg.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.protocoltcp;</span><br><span class="line"></span><br><span class="line">import io.netty.buffer.ByteBuf;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.handler.codec.ReplayingDecoder;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class MyMessageDecoder extends ReplayingDecoder&lt;Void&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyMessageDecoder decode è¢«è°ƒç”¨&quot;);</span><br><span class="line">        //éœ€è¦å°†å¾—åˆ°äºŒè¿›åˆ¶å­—èŠ‚ç -&gt; MessageProtocol æ•°æ®åŒ…(å¯¹è±¡)</span><br><span class="line">        int length = in.readInt();</span><br><span class="line"></span><br><span class="line">        byte[] content = new byte[length];</span><br><span class="line">        in.readBytes(content);</span><br><span class="line"></span><br><span class="line">        //å°è£…æˆ MessageProtocol å¯¹è±¡ï¼Œæ”¾å…¥ outï¼Œ ä¼ é€’ä¸‹ä¸€ä¸ªhandlerä¸šåŠ¡å¤„ç†</span><br><span class="line">        MessageProtocol messageProtocol = new MessageProtocol();</span><br><span class="line">        messageProtocol.setLen(length);</span><br><span class="line">        messageProtocol.setContent(content);</span><br><span class="line">        out.add(messageProtocol);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.protocoltcp;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">//å¤„ç†ä¸šåŠ¡çš„handler</span><br><span class="line">public class MyServerHandler extends SimpleChannelInboundHandler&lt;MessageProtocol&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private int count;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        //cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void channelRead0(ChannelHandlerContext ctx, MessageProtocol msg) throws Exception &#123;</span><br><span class="line">        //æ¥æ”¶åˆ°æ•°æ®ï¼Œå¹¶å¤„ç†</span><br><span class="line">        int len = msg.getLen();</span><br><span class="line">        byte[] content = msg.getContent();</span><br><span class="line"></span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨æ¥æ”¶åˆ°ä¿¡æ¯å¦‚ä¸‹&quot;);</span><br><span class="line">        System.out.println(&quot;é•¿åº¦=&quot; + len);</span><br><span class="line">        System.out.println(&quot;å†…å®¹=&quot; + new String(content, Charset.forName(&quot;utf-8&quot;)));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨æ¥æ”¶åˆ°æ¶ˆæ¯åŒ…æ•°é‡=&quot; + (++this.count));</span><br><span class="line"></span><br><span class="line">        //å›å¤æ¶ˆæ¯</span><br><span class="line">        String responseContent = UUID.randomUUID().toString();</span><br><span class="line">        int responseLen = responseContent.getBytes(&quot;utf-8&quot;).length;</span><br><span class="line">        byte[] responseContent2 = responseContent.getBytes(&quot;utf-8&quot;);</span><br><span class="line">        //æ„å»ºä¸€ä¸ªåè®®åŒ…</span><br><span class="line">        MessageProtocol messageProtocol = new MessageProtocol();</span><br><span class="line">        messageProtocol.setLen(responseLen);</span><br><span class="line">        messageProtocol.setContent(responseContent2);</span><br><span class="line"></span><br><span class="line">        ctx.writeAndFlush(messageProtocol);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><strong>ç¬¬ 10 ç«  Netty æ ¸å¿ƒæºç å‰–æ</strong></h1><h2 id="10-1-åŸºæœ¬è¯´æ˜"><strong>10.1 åŸºæœ¬è¯´æ˜</strong></h2><ol><li>åªæœ‰çœ‹è¿‡Â <code>Netty</code>Â æºç ï¼Œæ‰èƒ½è¯´æ˜¯çœŸçš„æŒæ¡äº†Â <code>Netty</code>Â æ¡†æ¶ã€‚</li><li>åœ¨Â <code>io.netty.example</code>Â åŒ…ä¸‹ï¼Œæœ‰å¾ˆå¤šÂ <code>Netty</code>Â æºç æ¡ˆä¾‹ï¼Œå¯ä»¥ç”¨æ¥åˆ†æã€‚</li><li>æºç åˆ†æç« èŠ‚æ˜¯é’ˆå¯¹æœ‰Â <code>Java</code>Â é¡¹ç›®ç»éªŒï¼Œå¹¶ä¸”ç©è¿‡æ¡†æ¶æºç çš„äººå‘˜è®²çš„ï¼Œå¦åˆ™ä½ å¬èµ·æ¥ä¼šæœ‰ç›¸å½“çš„éš¾åº¦ã€‚</li></ol><h2 id="10-2-Netty-å¯åŠ¨è¿‡ç¨‹æºç å‰–æ"><strong>10.2 Netty å¯åŠ¨è¿‡ç¨‹æºç å‰–æ</strong></h2><h3 id="10-2-1-æºç å‰–æç›®çš„"><strong>10.2.1 æºç å‰–æç›®çš„</strong></h3><p>ç”¨æºç åˆ†æçš„æ–¹å¼èµ°ä¸€ä¸‹Â <code>Netty</code>ï¼ˆæœåŠ¡å™¨ï¼‰çš„å¯åŠ¨è¿‡ç¨‹ï¼Œæ›´å¥½çš„ç†è§£Â <code>Netty</code>Â çš„æ•´ä½“è®¾è®¡å’Œè¿è¡Œæœºåˆ¶ã€‚</p><h3 id="10-2-2-æºç å‰–æ"><strong>10.2.2 æºç å‰–æ</strong></h3><p>è¯´æ˜ï¼š</p><ol><li>æºç éœ€è¦å‰–æåˆ°Â <code>Netty</code>Â è°ƒç”¨Â <code>doBind</code>Â æ–¹æ³•ï¼Œè¿½è¸ªåˆ°Â <code>NioServerSocketChannel</code>Â çš„Â <code>doBind</code>ã€‚</li><li>å¹¶ä¸”è¦Â <code>Debug</code>Â ç¨‹åºåˆ°Â <code>NioEventLoop</code>Â ç±»çš„Â <code>run</code>Â ä»£ç ï¼Œæ— é™å¾ªç¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œã€‚</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_01.png"></p><h3 id="10-2-3-æºç å‰–æè¿‡ç¨‹"><strong>10.2.3 æºç å‰–æè¿‡ç¨‹</strong></h3><p><strong>1.Â <code>demo</code>Â æºç çš„åŸºæœ¬ç†è§£</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">// æœåŠ¡å™¨å¯åŠ¨ç±»æºç </span><br><span class="line">/*</span><br><span class="line"> * Copyright 2012 The Netty Project</span><br><span class="line"> *</span><br><span class="line"> * The Netty Project licenses this file to you under the Apache License,</span><br><span class="line"> * version 2.0 (the &quot;License&quot;); you may not use this file except in compliance</span><br><span class="line"> * with the License. You may obtain a copy of the License at:</span><br><span class="line"> *</span><br><span class="line"> *   http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"> *</span><br><span class="line"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="line"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span><br><span class="line"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span><br><span class="line"> * License for the specific language governing permissions and limitations</span><br><span class="line"> * under the License.</span><br><span class="line"> */</span><br><span class="line">package atguigu.netty.example.echo2;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.ServerBootstrap;</span><br><span class="line">import io.netty.channel.ChannelFuture;</span><br><span class="line">import io.netty.channel.ChannelInitializer;</span><br><span class="line">import io.netty.channel.ChannelOption;</span><br><span class="line">import io.netty.channel.ChannelPipeline;</span><br><span class="line">import io.netty.channel.EventLoopGroup;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line">import io.netty.handler.logging.LogLevel;</span><br><span class="line">import io.netty.handler.logging.LoggingHandler;</span><br><span class="line">import io.netty.handler.ssl.SslContext;</span><br><span class="line">import io.netty.handler.ssl.SslContextBuilder;</span><br><span class="line">import io.netty.handler.ssl.util.SelfSignedCertificate;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Echoes back any received data from a client.</span><br><span class="line"> */</span><br><span class="line">public final class EchoServer &#123;</span><br><span class="line"></span><br><span class="line">    static final boolean SSL = System.getProperty(&quot;ssl&quot;) != null;</span><br><span class="line">    static final int PORT = Integer.parseInt(System.getProperty(&quot;port&quot;, &quot;8007&quot;));</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        // Configure SSL.</span><br><span class="line">        final SslContext sslCtx;</span><br><span class="line">        if (SSL) &#123;</span><br><span class="line">            SelfSignedCertificate ssc = new SelfSignedCertificate();</span><br><span class="line">            sslCtx = SslContextBuilder.forServer(ssc.certificate(), ssc.privateKey()).build();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            sslCtx = null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Configure the server.</span><br><span class="line">        EventLoopGroup bossGroup = new NioEventLoopGroup(1);</span><br><span class="line">        EventLoopGroup workerGroup = new NioEventLoopGroup();</span><br><span class="line">        try &#123;</span><br><span class="line">            ServerBootstrap b = new ServerBootstrap();</span><br><span class="line">            b.group(bossGroup, workerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, 100)</span><br><span class="line">                    .handler(new LoggingHandler(LogLevel.INFO))</span><br><span class="line">                    .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                            ChannelPipeline p = ch.pipeline();</span><br><span class="line">                            if (sslCtx != null) &#123;</span><br><span class="line">                                p.addLast(sslCtx.newHandler(ch.alloc()));</span><br><span class="line">                            &#125;</span><br><span class="line">                            //p.addLast(new LoggingHandler(LogLevel.INFO));</span><br><span class="line">                            p.addLast(new EchoServerHandler());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">            // Start the server.</span><br><span class="line">            ChannelFuture f = b.bind(PORT).sync();</span><br><span class="line"></span><br><span class="line">            // Wait until the server socket is closed.</span><br><span class="line">            f.channel().closeFuture().sync();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            // Shut down all event loops to terminate all threads.</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ol><li>å…ˆçœ‹å¯åŠ¨ç±»ï¼š<code>main</code>Â æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†å…³äº SSL çš„é…ç½®ç±»ã€‚</li><li>é‡ç‚¹åˆ†æä¸‹åˆ›å»ºäº†ä¸¤ä¸ªÂ <code>EventLoopGroup</code>Â å¯¹è±¡ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EventLoopGroup bossGroup = new NioEventLoopGroup(1);</span><br><span class="line">EventLoopGroup workerGroup = new NioEventLoopGroup();Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>(1) è¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯æ•´ä¸ªÂ <code>Netty</code>Â çš„æ ¸å¿ƒå¯¹è±¡ï¼Œå¯ä»¥è¯´ï¼Œæ•´ä¸ªÂ <code>Netty</code>Â çš„è¿ä½œéƒ½ä¾èµ–äºä»–ä»¬ã€‚<code>bossGroup</code>Â ç”¨äºæ¥å—Â <code>TCP</code>Â è¯·æ±‚ï¼Œä»–ä¼šå°†è¯·æ±‚äº¤ç»™Â <code>workerGroup</code>ï¼Œ<code>workerGroup</code>Â ä¼šè·å–åˆ°çœŸæ­£çš„è¿æ¥ï¼Œç„¶åå’Œè¿æ¥è¿›è¡Œé€šä¿¡ï¼Œæ¯”å¦‚è¯»å†™è§£ç ç¼–ç ç­‰æ“ä½œã€‚</p><p>(2)Â <code>EventLoopGroup</code>Â æ˜¯äº‹ä»¶å¾ªç¯ç»„ï¼ˆçº¿ç¨‹ç»„ï¼‰å«æœ‰å¤šä¸ªÂ <code>EventLoop</code>ï¼Œå¯ä»¥æ³¨å†ŒÂ <code>channel</code>ï¼Œç”¨äºåœ¨äº‹ä»¶å¾ªç¯ä¸­å»è¿›è¡Œé€‰æ‹©ï¼ˆå’Œé€‰æ‹©å™¨ç›¸å…³ï¼‰ã€‚ã€debugçœ‹ã€‘</p><p>(3)Â <code>new NioEventLoopGroup(1);</code>Â è¿™ä¸ªÂ <code>1</code>Â è¡¨ç¤ºÂ <code>bossGroup</code>Â äº‹ä»¶ç»„æœ‰Â <code>1</code>Â ä¸ªçº¿ç¨‹ä½ å¯ä»¥æŒ‡å®šï¼Œå¦‚æœÂ <code>new NioEventLoopGroup()</code>Â ä¼šå«æœ‰é»˜è®¤ä¸ªçº¿ç¨‹Â <code>cpuæ ¸æ•° * 2</code>ï¼Œå³å¯ä»¥å……åˆ†çš„åˆ©ç”¨å¤šæ ¸çš„ä¼˜åŠ¿ï¼Œã€å¯ä»¥dubugä¸€æŠŠã€‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_EVENT_LOOP_THREADS = Math.max(1, SystemPropertyUtil.getInt(&quot;io.netty.eventLoopThreads&quot;, NettyRuntime.availableProcessors() * 2));Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>ä¼šåˆ›å»ºÂ <code>EventExecutor</code>Â æ•°ç»„Â <code>children = new EventExecutor[nThreads];</code>Â //Â <code>debug</code>Â ä¸€ä¸‹æ¯ä¸ªå…ƒç´ çš„ç±»å‹å°±æ˜¯Â <code>NIOEventLoop</code>ï¼Œ<code>NIOEventLoop</code>Â å®ç°äº†Â <code>EventLoop</code>Â æ¥å£å’ŒÂ <code>Executor</code>Â æ¥å£Â <code>try</code>Â å—ä¸­åˆ›å»ºäº†ä¸€ä¸ªÂ <code>ServerBootstrap</code>Â å¯¹è±¡ï¼Œä»–æ˜¯ä¸€ä¸ªå¼•å¯¼ç±»ï¼Œç”¨äºå¯åŠ¨æœåŠ¡å™¨å’Œå¼•å¯¼æ•´ä¸ªç¨‹åºçš„åˆå§‹åŒ–ï¼ˆçœ‹ä¸‹æºç Â <code>allowseasybootstrapof&#123;@linkServerChannel&#125;</code>ï¼‰ã€‚å®ƒå’ŒÂ <code>ServerChannel</code>Â å…³è”ï¼Œè€ŒÂ <code>ServerChannel</code>Â ç»§æ‰¿äº†Â <code>Channel</code>ï¼Œæœ‰ä¸€äº›æ–¹æ³•Â <code>remoteAddress</code>Â ç­‰[å¯ä»¥Debugä¸‹]éšåï¼Œå˜é‡Â <code>b</code>Â è°ƒç”¨äº†Â <code>group</code>Â æ–¹æ³•å°†ä¸¤ä¸ªÂ <code>group</code>Â æ”¾å…¥äº†è‡ªå·±çš„å­—æ®µä¸­ï¼Œç”¨äºåæœŸå¼•å¯¼ä½¿ç”¨ã€<code>debug</code>Â ä¸‹Â <code>group</code>Â æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *Set the &#123;@link EventLoopGroup&#125; for the parent (acceptor) and the child (client) . These</span><br><span class="line"> *&#123;@link EventLoopGroup&#125;&#x27;s are used to handle all the events and IO for &#123;@link ServerChannel&#125; and</span><br><span class="line"> *&#123;@link Channel&#125;&#x27;s.</span><br><span class="line"> */Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>ã€‘ã€‚</p><p>(4) ç„¶åæ·»åŠ äº†ä¸€ä¸ªÂ <code>channel</code>ï¼Œå…¶ä¸­å‚æ•°ä¸€ä¸ªÂ <code>Class</code>Â å¯¹è±¡ï¼Œå¼•å¯¼ç±»å°†é€šè¿‡è¿™ä¸ªÂ <code>Class</code>Â å¯¹è±¡åå°„åˆ›å»ºÂ <code>ChannelFactory</code>ã€‚ç„¶åæ·»åŠ äº†ä¸€äº›Â <code>TCP</code>Â çš„å‚æ•°ã€‚ã€è¯´æ˜ï¼š<code>Channel</code>Â çš„åˆ›å»ºåœ¨Â <code>bind</code>Â æ–¹æ³•ï¼Œå¯ä»¥Â <code>Debug</code>Â ä¸‹Â <code>bind</code>ï¼Œä¼šæ‰¾åˆ°Â <code>channel = channelFactory.newChannel();</code>Â ã€‘</p><p>(5) å†æ·»åŠ äº†ä¸€ä¸ªæœåŠ¡å™¨ä¸“å±çš„æ—¥å¿—å¤„ç†å™¨Â <code>handler</code>Â ã€‚</p><p>(6) å†æ·»åŠ ä¸€ä¸ªÂ <code>SocketChannel</code>ï¼ˆä¸æ˜¯Â <code>ServerSocketChannel</code>ï¼‰çš„Â <code>handler</code>ã€‚</p><p>(7) ç„¶åç»‘å®šç«¯å£å¹¶é˜»å¡è‡³è¿æ¥æˆåŠŸã€‚</p><p>(8) æœ€åÂ <code>main</code>Â çº¿ç¨‹é˜»å¡ç­‰å¾…å…³é—­ã€‚</p><p>(9)Â <code>finally</code>Â å—ä¸­çš„ä»£ç å°†åœ¨æœåŠ¡å™¨å…³é—­æ—¶ä¼˜é›…å…³é—­æ‰€æœ‰èµ„æºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Copyright 2012 The Netty Project</span><br><span class="line"> *</span><br><span class="line"> * The Netty Project licenses this file to you under the Apache License,</span><br><span class="line"> * version 2.0 (the &quot;License&quot;); you may not use this file except in compliance</span><br><span class="line"> * with the License. You may obtain a copy of the License at:</span><br><span class="line"> *</span><br><span class="line"> *   http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"> *</span><br><span class="line"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="line"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span><br><span class="line"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span><br><span class="line"> * License for the specific language governing permissions and limitations</span><br><span class="line"> * under the License.</span><br><span class="line"> */</span><br><span class="line">package atguigu.netty.example.echo2;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.ChannelHandler.Sharable;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Handler implementation for the echo server.</span><br><span class="line"> */</span><br><span class="line">@Sharable</span><br><span class="line">public class EchoServerHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) &#123;</span><br><span class="line">        ctx.write(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelReadComplete(ChannelHandlerContext ctx) &#123;</span><br><span class="line">        ctx.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) &#123;</span><br><span class="line">        // Close the connection when an exception is raised.</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜:</p><ol><li>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„å¤„ç†å™¨ç±»ï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯å‘é€æ¥çš„æ¶ˆæ¯ï¼Œåœ¨æˆ‘ä»¬è¿™é‡Œï¼Œæˆ‘ä»¬ç®€å•çš„è§£æå‡ºå®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„å†…å®¹ï¼Œç„¶åæ‰“å°ï¼Œæœ€åå‘é€å­—ç¬¦ä¸²ç»™å®¢æˆ·ç«¯ã€‚</li><li>å¤§è‡´è®²è§£äº†æˆ‘ä»¬çš„Â <code>demo</code>Â æºç çš„ä½œç”¨ã€‚åé¢çš„Â <code>debug</code>Â çš„æ—¶å€™ä¼šè¯¦ç»†ã€‚</li></ol><p><strong>2. åˆ†æ EventLoopGroup çš„è¿‡ç¨‹</strong></p><p>2.1 æ„é€ å™¨æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public NioEventLoopGroup (int nThreads) &#123;</span><br><span class="line">    this(nThreads, (Executor) null);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>2.2 ä¸Šé¢çš„Â <code>this(nThreads, (Executor) null);</code>Â è°ƒç”¨æ„é€ å™¨ï¼ˆé€šè¿‡Â <code>alt + d</code>Â çœ‹å³å¯ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public NioEventLoopGroup (int nThreads, Executor executor) &#123;</span><br><span class="line">    this(nThreads, executor, SelectorProvider.provider());</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>2.3 ä¸Šé¢çš„Â <code>this(nThreads, executor, SelectorProvider.provider());</code>Â è°ƒç”¨ä¸‹é¢æ„é€ å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public NioEventLoopGroup (int nThreads, Executor executor, final SelectorProvider selectorProvider) &#123;</span><br><span class="line">    this(nThreads, executor, selectorProvider,DefaultSelectStrategyFactory.INSTANCE);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>2.4 ä¸Šé¢çš„Â <code>this()...</code>Â è°ƒç”¨æ„é€ å™¨ï¼ˆ<code>alt + d</code>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public NioEventLoopGroup (int nThreads, Executor executor, final SelectorProvider selectorProvider,final SelectStrategyFactory selectStrategyFactory) &#123;</span><br><span class="line">    super(nThreads, executor, selectorProvider, selectStrategyFactory, RejectedExecutionHandlers.reject());</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>2.5 ä¸Šé¢çš„Â <code>super()..</code>Â çš„æ–¹æ³•æ˜¯çˆ¶ç±»ï¼š<code>MultithreadEventLoopGroup</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protected MultithreadEventLoopGroup (int nThreads, Executor executor, Object...args) &#123;</span><br><span class="line">    super(nThreads == 0 ? DEFAULT_EVENT_LOOP_THREADS : nThreads, executor, args);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>2.6 è¿½è¸ªåˆ°æºç æŠ½è±¡ç±»Â <code>MultithreadEventExecutorGroup</code>Â çš„æ„é€ å™¨æ–¹æ³•Â <code>MultithreadEventExecutorGroup</code>Â æ‰æ˜¯Â <code>NioEventLoopGroup</code>Â çœŸæ­£çš„æ„é€ æ–¹æ³•ï¼Œè¿™é‡Œå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œä½¿ç”¨äº†è®¾è®¡æ¨¡å¼çš„æ¨¡æ¿æ¨¡å¼ï¼ˆå¯çœ‹æˆ‘å½•åˆ¶è§†é¢‘ï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦å¥½å¥½åˆ†æÂ <code>MultithreadEventExecutorGroup</code>Â æ–¹æ³•äº†</p><p>2.7 åˆ†æÂ <code>MultithreadEventExecutorGroup</code></p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>@param nThreads</code>Â ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸ºÂ <code>core * 2</code>ã€å¯ä»¥è¿½è¸ªæºç ã€‘</li><li><code>@param executor</code>Â æ‰§è¡Œå™¨:å¦‚æœä¼ å…¥Â <code>null</code>, åˆ™é‡‡ç”¨Â <code>Netty</code>Â é»˜è®¤çš„çº¿ç¨‹å·¥å‚å’Œé»˜è®¤çš„æ‰§è¡Œå™¨Â <code>ThreadPerTaskExecutor</code></li><li><code>@param chooserFactory</code>Â å•ä¾‹Â <code>new DefaultEventExecutorChooserFactory()</code></li><li><code>@param args args</code>Â åœ¨åˆ›å»ºæ‰§è¡Œå™¨çš„æ—¶å€™ä¼ å…¥å›ºå®šå‚æ•°</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">protected MultithreadEventExecutorGroup(int nThreads, Executor executor,</span><br><span class="line">                                        EventExecutorChooserFactory chooserFactory, Object... args) &#123;</span><br><span class="line">    if (nThreads &lt;= 0) &#123;</span><br><span class="line">        throw new IllegalArgumentException(String.format(&quot;nThreads: %d (expected: &gt; 0)&quot;, nThreads));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (executor == null) &#123; // å¦‚æœä¼ å…¥çš„æ‰§è¡Œå™¨æ˜¯ç©ºçš„åˆ™é‡‡ç”¨é»˜è®¤çš„çº¿ç¨‹å·¥å‚å’Œé»˜è®¤çš„æ‰§è¡Œå™¨</span><br><span class="line">        executor = new ThreadPerTaskExecutor(newDefaultThreadFactory());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ›å»ºæŒ‡å®šçº¿ç¨‹æ•°çš„æ‰§è¡Œå™¨æ•°ç»„</span><br><span class="line">    children = new EventExecutor[nThreads];</span><br><span class="line"></span><br><span class="line">    // åˆå§‹åŒ–çº¿ç¨‹æ•°ç»„</span><br><span class="line">    for (int i = 0; i &lt; nThreads; i ++) &#123;</span><br><span class="line">        boolean success = false;</span><br><span class="line">        try &#123;</span><br><span class="line">            // åˆ›å»º new NioEventLoop</span><br><span class="line">            children[i] = newChild(executor, args);</span><br><span class="line">            success = true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // TODO: Think about if this is a good exception type</span><br><span class="line">            throw new IllegalStateException(&quot;failed to create a child event loop&quot;, e);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            // å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œä¼˜é›…å…³é—­</span><br><span class="line">            if (!success) &#123;</span><br><span class="line">                for (int j = 0; j &lt; i; j ++) &#123;</span><br><span class="line">                    children[j].shutdownGracefully();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                for (int j = 0; j &lt; i; j ++) &#123;</span><br><span class="line">                    EventExecutor e = children[j];</span><br><span class="line">                    try &#123;</span><br><span class="line">                        while (!e.isTerminated()) &#123;</span><br><span class="line">                            e.awaitTermination(Integer.MAX_VALUE, TimeUnit.SECONDS);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; catch (InterruptedException interrupted) &#123;</span><br><span class="line">                        // Let the caller handle the interruption.</span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    chooser = chooserFactory.newChooser(children);</span><br><span class="line"></span><br><span class="line">    final FutureListener&lt;Object&gt; terminationListener = new FutureListener&lt;Object&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void operationComplete(Future&lt;Object&gt; future) throws Exception &#123;</span><br><span class="line">            if (terminatedChildren.incrementAndGet() == children.length) &#123;</span><br><span class="line">                terminationFuture.setSuccess(null);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // ä¸ºæ¯ä¸€ä¸ªå•ä¾‹çº¿ç¨‹æ± æ·»åŠ ä¸€ä¸ªå…³é—­ç›‘å¬å™¨</span><br><span class="line">    for (EventExecutor e: children) &#123;</span><br><span class="line">        e.terminationFuture().addListener(terminationListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Set&lt;EventExecutor&gt; childrenSet = new LinkedHashSet&lt;EventExecutor&gt;(children.length);</span><br><span class="line">    //å°†æ‰€æœ‰çš„å•ä¾‹çº¿ç¨‹æ± æ·»åŠ åˆ°ä¸€ä¸ª HashSet ä¸­ã€‚</span><br><span class="line">    Collections.addAll(childrenSet, children);</span><br><span class="line">    readonlyChildren = Collections.unmodifiableSet(childrenSet);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ol><li>å¦‚æœÂ <code>executor</code>Â æ˜¯Â <code>null</code>ï¼Œåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„Â <code>ThreadPerTaskExecutor</code>ï¼Œä½¿ç”¨Â <code>Netty</code>Â é»˜è®¤çš„çº¿ç¨‹å·¥å‚ã€‚</li><li>æ ¹æ®ä¼ å…¥çš„çº¿ç¨‹æ•°ï¼ˆ<code>CPU * 2</code>ï¼‰åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆå•ä¾‹çº¿ç¨‹æ± ï¼‰æ•°ç»„ã€‚</li><li>å¾ªç¯å¡«å……æ•°ç»„ä¸­çš„å…ƒç´ ã€‚å¦‚æœå¼‚å¸¸ï¼Œåˆ™å…³é—­æ‰€æœ‰çš„å•ä¾‹çº¿ç¨‹æ± ã€‚</li><li>æ ¹æ®çº¿ç¨‹é€‰æ‹©å·¥å‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹é€‰æ‹©å™¨ã€‚</li><li>ä¸ºæ¯ä¸€ä¸ªå•ä¾‹çº¿ç¨‹æ± æ·»åŠ ä¸€ä¸ªå…³é—­ç›‘å¬å™¨ã€‚</li><li>å°†æ‰€æœ‰çš„å•ä¾‹çº¿ç¨‹æ± æ·»åŠ åˆ°ä¸€ä¸ªÂ <code>HashSet</code>Â ä¸­ã€‚</li></ol><p><strong>3. ServerBootstrap åˆ›å»ºå’Œæ„é€ è¿‡ç¨‹</strong></p><p>3.1Â <code>ServerBootstrap</code>Â æ˜¯ä¸ªç©ºæ„é€ ï¼Œä½†æ˜¯æœ‰é»˜è®¤çš„æˆå‘˜å˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">private final Map&lt;ChannelOption&lt;?&gt;, Object&gt; childOptions = new LinkedHashMap&lt;ChannelOption&lt;?&gt;, Object&gt;();</span><br><span class="line">private final Map&lt;AttributeKey&lt;?&gt;, Object&gt; childAttrs = new ConcurrentHashMap&lt;AttributeKey&lt;?&gt;, Object&gt;();</span><br><span class="line"></span><br><span class="line">// config å¯¹è±¡ï¼Œä¼šåœ¨åé¢èµ·å¾ˆå¤§ä½œç”¨</span><br><span class="line">private final ServerBootstrapConfig config = new ServerBootstrapConfig(this);</span><br><span class="line">private volatile EventLoopGroup childGroup;</span><br><span class="line">private volatile ChannelHandler childHandler;</span><br><span class="line">Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>3.2 åˆ†æä¸€ä¸‹Â <code>ServerBootstrap</code>Â åŸºæœ¬ä½¿ç”¨æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ServerBootstrap b = new ServerBootstrap();</span><br><span class="line">b.group(bossGroup, workerGroup)</span><br><span class="line">        .channel(NioServerSocketChannel.class)</span><br><span class="line">        .option(ChannelOption.SO_BACKLOG, 100)</span><br><span class="line">        .handler(new LoggingHandler(LogLevel.INFO))</span><br><span class="line">        .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                ChannelPipeline p = ch.pipeline();</span><br><span class="line">                if (sslCtx != null) &#123;</span><br><span class="line">                    p.addLast(sslCtx.newHandler(ch.alloc()));</span><br><span class="line">                &#125;</span><br><span class="line">                //p.addLast(new LoggingHandler(LogLevel.INFO));</span><br><span class="line">                p.addLast(new EchoServerHandler());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜:</p><ol><li>é“¾å¼è°ƒç”¨ï¼š<code>group</code>Â æ–¹æ³•ï¼Œå°†Â <code>boss</code>Â å’ŒÂ <code>worker</code>Â ä¼ å…¥ï¼Œ<code>boss</code>Â èµ‹å€¼ç»™Â <code>parentGroup</code>Â å±æ€§,Â <code>worker</code>Â èµ‹å€¼ç»™Â <code>childGroup</code>Â å±æ€§ã€‚</li><li><code>channel</code>Â æ–¹æ³•ä¼ å…¥Â <code>NioServerSocketChannelclass</code>Â å¯¹è±¡ã€‚ä¼šæ ¹æ®è¿™ä¸ªÂ <code>class</code>Â åˆ›å»ºÂ <code>channel</code>Â å¯¹è±¡ã€‚</li><li><code>option</code>Â æ–¹æ³•ä¼ å…¥Â <code>TCP</code>Â å‚æ•°ï¼Œæ”¾åœ¨ä¸€ä¸ªÂ <code>LinkedHashMap</code>Â ä¸­ã€‚</li><li><code>handler</code>Â æ–¹æ³•ä¼ å…¥ä¸€ä¸ªÂ <code>handler</code>Â ä¸­ï¼Œè¿™ä¸ªÂ <code>hanlder</code>Â åªä¸“å±äºÂ <code>ServerSocketChannel</code>Â è€Œä¸æ˜¯Â <code>SocketChannel</code>ã€‚</li><li><code>childHandler</code>Â ä¼ å…¥ä¸€ä¸ªÂ <code>hanlder</code>ï¼Œè¿™ä¸ªÂ <code>handler</code>Â å°†ä¼šåœ¨æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™è°ƒç”¨ã€‚ä¾›Â <code>SocketChannel</code>Â ä½¿ç”¨ã€‚</li></ol><p><strong>4. ç»‘å®šç«¯å£çš„åˆ†æ</strong></p><p>4.1 æœåŠ¡å™¨å°±æ˜¯åœ¨è¿™ä¸ªÂ <code>bind</code>Â æ–¹æ³•é‡Œå¯åŠ¨å®Œæˆçš„ 4.2Â <code>bind</code>Â æ–¹æ³•ä»£ç ,è¿½è¸ªåˆ°åˆ›å»ºäº†ä¸€ä¸ªç«¯å£å¯¹è±¡ï¼Œå¹¶åšäº†ä¸€äº›ç©ºåˆ¤æ–­ï¼Œæ ¸å¿ƒä»£ç Â <code>doBind</code>ï¼Œæˆ‘ä»¬çœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public ChannelFuture bind(SocketAddress localAddress) &#123;</span><br><span class="line">    validate();</span><br><span class="line">    if (localAddress == null) &#123;</span><br><span class="line">        throw new NullPointerException(&quot;localAddress&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return doBind(localAddress);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>4.3Â <code>doBind</code>Â æºç å‰–æï¼Œæ ¸å¿ƒæ˜¯ä¸¤ä¸ªæ–¹æ³•Â <code>initAndRegister</code>Â å’ŒÂ <code>doBind0</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">private ChannelFuture doBind(final SocketAddress localAddress) &#123;</span><br><span class="line">    final ChannelFuture regFuture = initAndRegister();</span><br><span class="line">    final Channel channel = regFuture.channel();</span><br><span class="line">    if (regFuture.cause() != null) &#123;</span><br><span class="line">        return regFuture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (regFuture.isDone()) &#123;</span><br><span class="line">        // At this point we know that the registration was complete and successful.</span><br><span class="line">        ChannelPromise promise = channel.newPromise();</span><br><span class="line">        //============================================</span><br><span class="line">        //è¯´æ˜:æ‰§è¡ŒdoBind0æ–¹æ³•ï¼Œå®Œæˆå¯¹ç«¯å£çš„ç»‘å®š</span><br><span class="line">        //============================================</span><br><span class="line">        doBind0(regFuture, channel, localAddress, promise);</span><br><span class="line">        return promise;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Registration future is almost always fulfilled already, but just in case it&#x27;s not.</span><br><span class="line">        final PendingRegistrationPromise promise = new PendingRegistrationPromise(channel);</span><br><span class="line">        regFuture.addListener(new ChannelFutureListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void operationComplete(ChannelFuture future) throws Exception &#123;</span><br><span class="line">                Throwable cause = future.cause();</span><br><span class="line">                if (cause != null) &#123;</span><br><span class="line">                    // Registration on the EventLoop failed so fail the ChannelPromise directly to not cause an</span><br><span class="line">                    // IllegalStateException once we try to access the EventLoop of the Channel.</span><br><span class="line">                    promise.setFailure(cause);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // Registration was successful, so set the correct executor to use.</span><br><span class="line">                    // See https://github.com/netty/netty/issues/2586</span><br><span class="line">                    promise.registered();</span><br><span class="line"></span><br><span class="line">                    doBind0(regFuture, channel, localAddress, promise);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return promise;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>4.4 åˆ†æè¯´æ˜Â <code>initAndRegister</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">final ChannelFuture initAndRegister() &#123;</span><br><span class="line">    Channel channel = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        channel = channelFactory.newChannel();</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * è¯´æ˜ï¼šchannelFactory.newChannel() æ–¹æ³•çš„ä½œç”¨é€šè¿‡ ServerBootstrap çš„é€šé“å·¥å‚åå°„åˆ›å»ºä¸€ä¸ª NioServerSocketChannel,å…·ä½“è¿½è¸ªæºç å¯ä»¥å¾—åˆ°ä¸‹é¢ç»“è®º</span><br><span class="line">         * (1)é€šè¿‡ NIO çš„ SelectorProvider çš„ openServerSocketChannel æ–¹æ³•å¾—åˆ° JDK çš„ channelã€‚ç›®çš„æ˜¯è®© Netty åŒ…è£… JDK çš„ channelã€‚</span><br><span class="line">         * (2)åˆ›å»ºäº†ä¸€ä¸ªå”¯ä¸€çš„ ChannelIdï¼Œåˆ›å»ºäº†ä¸€ä¸ª NioMessageUnsafeï¼Œç”¨äºæ“ä½œæ¶ˆæ¯ï¼Œåˆ›å»ºäº†ä¸€ä¸ª DefaultChannelPipeline ç®¡é“ï¼Œæ˜¯ä¸ªåŒå‘é“¾è¡¨ç»“æ„ï¼Œç”¨äºè¿‡æ»¤æ‰€æœ‰çš„è¿›å‡ºçš„æ¶ˆæ¯ã€‚</span><br><span class="line">         * (3)åˆ›å»ºäº†ä¸€ä¸ª NioServerSocketChannelConfig å¯¹è±¡ï¼Œç”¨äºå¯¹å¤–å±•ç¤ºä¸€äº›é…ç½®ã€‚</span><br><span class="line"></span><br><span class="line">         * channel = channelFactory.newChannel();//NioServerSocketChannel</span><br><span class="line"></span><br><span class="line">         * è¯´æ˜ï¼šinit åˆå§‹åŒ–è¿™ä¸ª NioServerSocketChannelï¼Œå…·ä½“è¿½è¸ªæºç å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®º</span><br><span class="line">         * (1) init æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ªæŠ½è±¡æ–¹æ³• (AbstractBootstrapç±»çš„ï¼‰ï¼Œç”±ServerBootstrapå®ç°ï¼ˆå¯ä»¥è¿½ä¸€ä¸‹æºç //setChannelOptions(channel,options,logger);ï¼‰ã€‚</span><br><span class="line">         * (2)è®¾ç½® NioServerSocketChannel çš„ TCP å±æ€§ã€‚</span><br><span class="line">         * (3)ç”±äº LinkedHashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿ç”¨åŒæ­¥è¿›è¡Œå¤„ç†ã€‚</span><br><span class="line">         * (4)å¯¹ NioServerSocketChannel çš„ ChannelPipeline æ·»åŠ  ChannelInitializer å¤„ç†å™¨ã€‚</span><br><span class="line">         * (5)å¯ä»¥çœ‹å‡ºï¼Œinit çš„æ–¹æ³•çš„æ ¸å¿ƒä½œç”¨åœ¨å’Œ ChannelPipeline ç›¸å…³ã€‚</span><br><span class="line">         * (6)ä» NioServerSocketChannel çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œpipeline æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¹¶ä¸”ï¼Œä»–æœ¬èº«å°±åˆå§‹åŒ–äº† head å’Œ tailï¼Œè¿™é‡Œè°ƒç”¨äº†ä»–çš„ addLast æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å°†æ•´ä¸ª handler æ’å…¥åˆ° tail çš„å‰é¢ï¼Œå› ä¸º tail æ°¸è¿œä¼šåœ¨åé¢ï¼Œéœ€è¦åšä¸€äº›ç³»ç»Ÿçš„å›ºå®šå·¥ä½œã€‚</span><br><span class="line">         */</span><br><span class="line">        init(channel);</span><br><span class="line">    &#125; catch (Throwable t) &#123;</span><br><span class="line">        if (channel != null) &#123;</span><br><span class="line">            channel.unsafe().closeForcibly();</span><br><span class="line">            return new DefaultChannelPromise(channel, GlobalEventExecutor.INSTANCE).setFailure(t);</span><br><span class="line">        &#125;</span><br><span class="line">        return new DefaultChannelPromise(new FailedChannel(), GlobalEventExecutor.INSTANCE).setFailure(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ChannelFuture regFuture = config().group().register(channel);</span><br><span class="line">    if (regFuture.cause() != null) &#123;</span><br><span class="line">        if (channel.isRegistered()) &#123;</span><br><span class="line">            channel.close();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            channel.unsafe().closeForcibly();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return regFuture;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ol><li>åŸºæœ¬è¯´æ˜ï¼š<code>initAndRegister()</code>Â åˆå§‹åŒ–Â <code>NioServerSocketChannel</code>Â é€šé“å¹¶æ³¨å†Œå„ä¸ªÂ <code>handler</code>ï¼Œè¿”å›ä¸€ä¸ªÂ <code>future</code>ã€‚</li><li>é€šè¿‡Â <code>ServerBootstrap</code>Â çš„é€šé“å·¥å‚åå°„åˆ›å»ºä¸€ä¸ªÂ <code>NioServerSocketChannel</code>ã€‚</li><li><code>init</code>Â åˆå§‹åŒ–è¿™ä¸ªÂ <code>NioServerSocketChannel</code>ã€‚</li><li><code>config().group().register(channel)</code>Â é€šè¿‡Â <code>ServerBootstrap</code>Â çš„Â <code>bossGroup</code>Â æ³¨å†ŒÂ <code>NioServerSocketChannel</code>ã€‚</li><li>æœ€åï¼Œè¿”å›è¿™ä¸ªå¼‚æ­¥æ‰§è¡Œçš„å ä½ç¬¦å³Â <code>regFuture</code>ã€‚</li></ol><p>4.5Â <code>init</code>Â æ–¹æ³•ä¼šè°ƒç”¨Â <code>addLast</code>ï¼Œç°åœ¨è¿›å…¥åˆ°Â <code>addLast</code>Â æ–¹æ³•å†…æŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public final ChannelPipeline addLast(EventExecutorGroup group, String name, ChannelHandler handler) &#123;</span><br><span class="line">    final AbstractChannelHandlerContext newCtx;</span><br><span class="line">    synchronized (this) &#123;</span><br><span class="line">        checkMultiplicity(handler);</span><br><span class="line">        newCtx = newContext(group, filterName(name, handler), handler);</span><br><span class="line">        addLast0(newCtx);</span><br><span class="line">        if (!registered) &#123;</span><br><span class="line">            newCtx.setAddPending();</span><br><span class="line">            callHandlerCallbackLater(newCtx, true);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">        EventExecutor executor = newCtx.executor();</span><br><span class="line">        if (!executor.inEventLoop()) &#123;</span><br><span class="line">            callHandlerAddedInEventLoop(newCtx, executor);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    callHandlerAdded0(newCtx);</span><br><span class="line">    return this;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ol><li><code>addLast</code>Â æ–¹æ³•ï¼Œåœ¨Â <code>DefaultChannelPipeline</code>Â ç±»ä¸­</li><li><code>addLast</code>Â æ–¹æ³•è¿™å°±æ˜¯Â <code>pipeline</code>Â æ–¹æ³•çš„æ ¸å¿ƒ</li><li>æ£€æŸ¥è¯¥Â <code>handler</code>Â æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚</li><li>åˆ›å»ºä¸€ä¸ªÂ <code>AbstractChannelHandlerContext</code>Â å¯¹è±¡ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹ï¼Œ<code>ChannelHandlerContext</code>Â å¯¹è±¡æ˜¯Â <code>ChannelHandler</code>Â å’ŒÂ <code>ChannelPipeline</code>Â ä¹‹é—´çš„å…³è”ï¼Œæ¯å½“æœ‰Â <code>ChannelHandler</code>Â æ·»åŠ åˆ°Â <code>Pipeline</code>Â ä¸­æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºÂ <code>Context</code>ã€‚<code>Context</code>Â çš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç†ä»–æ‰€å…³è”çš„Â <code>Handler</code>Â å’ŒåŒä¸€ä¸ªÂ <code>Pipeline</code>Â ä¸­çš„å…¶ä»–Â <code>Handler</code>Â ä¹‹é—´çš„äº¤äº’ã€‚</li><li>å°†Â <code>Context</code>Â æ·»åŠ åˆ°é“¾è¡¨ä¸­ã€‚ä¹Ÿå°±æ˜¯è¿½åŠ åˆ°Â <code>tail</code>Â èŠ‚ç‚¹çš„å‰é¢ã€‚</li><li>æœ€åï¼ŒåŒæ­¥æˆ–è€…å¼‚æ­¥æˆ–è€…æ™šç‚¹å¼‚æ­¥çš„è°ƒç”¨Â <code>callHandlerAdded0</code>Â æ–¹æ³•</li></ol><p>4.6 å‰é¢è¯´äº†Â <code>dobind</code>Â æ–¹æ³•æœ‰Â <code>2</code>Â ä¸ªé‡è¦çš„æ­¥éª¤ï¼Œ<code>initAndRegister</code>Â è¯´å®Œï¼Œæ¥ä¸‹æ¥çœ‹Â <code>doBind0</code>Â æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private static void doBind0(</span><br><span class="line">        final ChannelFuture regFuture, final Channel channel,</span><br><span class="line">        final SocketAddress localAddress, final ChannelPromise promise) &#123;</span><br><span class="line"></span><br><span class="line">    // This method is invoked before channelRegistered() is triggered.  Give user handlers a chance to set up</span><br><span class="line">    // the pipeline in its channelRegistered() implementation.</span><br><span class="line">    channel.eventLoop().execute(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            if (regFuture.isSuccess()) &#123;</span><br><span class="line">                //bindæ–¹æ³•è¿™é‡Œä¸‹æ–­ç‚¹ï¼Œè¿™é‡Œä¸‹æ–­ç‚¹ï¼Œæ¥ç©!!</span><br><span class="line">                channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                promise.setFailure(regFuture.cause());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ol><li>è¯¥æ–¹æ³•çš„å‚æ•°ä¸ºÂ <code>initAndRegister</code>Â çš„Â <code>future</code>ï¼Œ<code>NioServerSocketChannel</code>ï¼Œç«¯å£åœ°å€ï¼Œ<code>NioServerSocketChannel</code>Â çš„Â <code>promise</code></li><li>è¿™é‡Œå°±å¯ä»¥æ ¹æ®å‰é¢ä¸‹çš„æ–­ç‚¹ï¼Œä¸€ç›´Â <code>debug</code>ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// å°†è°ƒç”¨ LoggingHandler çš„ invokeBind æ–¹æ³•,æœ€åä¼šè¿½åˆ°</span><br><span class="line">// DefaultChannelPipeline ç±»çš„ bind</span><br><span class="line">// ç„¶åè¿›å…¥åˆ° unsafe.bind æ–¹æ³• debugï¼Œæ³¨æ„è¦è¿½è¸ªåˆ°</span><br><span class="line">// unsafe.bindï¼Œè¦ debug ç¬¬äºŒåœˆçš„æ—¶å€™ï¼Œæ‰èƒ½çœ‹åˆ°ã€‚</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void bind (ChannelHandlerContext ctx, SocketAddress localAddress, ChannelPromise promise) throws Exception &#123;</span><br><span class="line">    unsafe.bind(localAddress,promise);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç»§ç»­è¿½è¸ª AbstractChannel çš„</span><br><span class="line"></span><br><span class="line">public final void bind (final SocketAddress localAddress, final ChannelPromise promise) &#123;</span><br><span class="line">    //....</span><br><span class="line">    try&#123;</span><br><span class="line">        //!!!! å°çº¢æ——å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ€ç»ˆçš„æ–¹æ³•å°±æ˜¯ doBind æ–¹æ³•ï¼Œæ‰§è¡ŒæˆåŠŸåï¼Œæ‰§è¡Œé€šé“çš„ fireChannelActive æ–¹æ³•ï¼Œå‘Šè¯‰æ‰€æœ‰çš„ handlerï¼Œå·²ç»æˆåŠŸç»‘å®šã€‚</span><br><span class="line">        doBind(localAddress);//</span><br><span class="line">    &#125; catch (Throwable t) &#123;</span><br><span class="line">        safeSetFailure(promise, t);</span><br><span class="line">        closeIfClosed();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>æœ€ç»ˆÂ <code>doBind</code>Â å°±ä¼šè¿½è¸ªåˆ°Â <code>NioServerSocketChannel</code>Â çš„Â <code>doBind</code>ï¼Œè¯´æ˜Â <code>Netty</code>Â åº•å±‚ä½¿ç”¨çš„æ˜¯Â <code>NIO</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void doBind (SocketAddress localAddress) throws Exception &#123;</span><br><span class="line">    if (PlatformDependent.javaVersion() &gt;= 7) &#123;</span><br><span class="line">        javaChannel().bind(localAddress, config.getBacklog());</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        javaChannel().socket().bind(localAddress, config.getBacklog());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>å›åˆ°Â <code>bind</code>Â æ–¹æ³•ï¼ˆ<code>alt + v</code>ï¼‰ï¼Œæœ€åä¸€æ­¥ï¼š<code>safeSetSuccess(promise)</code>ï¼Œå‘Šè¯‰Â <code>promise</code>Â ä»»åŠ¡æˆåŠŸäº†ã€‚å…¶å¯ä»¥æ‰§è¡Œç›‘å¬å™¨çš„æ–¹æ³•äº†ã€‚åˆ°æ­¤æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹å·²ç»ç»“æŸäº†ï¼Œok äº†</li><li>ç»§ç»­Â <code>atl + v</code>Â æœåŠ¡å™¨å°±å›è¿›å…¥åˆ°ï¼ˆ<code>NioEventLoop</code>Â ç±»ï¼‰ä¸€ä¸ªå¾ªç¯ä»£ç ï¼Œè¿›è¡Œç›‘å¬</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void run() &#123;</span><br><span class="line">    for(;;) &#123;</span><br><span class="line">        try&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h3 id="10-2-4-Netty-å¯åŠ¨è¿‡ç¨‹æ¢³ç†"><strong>10.2.4 Netty å¯åŠ¨è¿‡ç¨‹æ¢³ç†</strong></h3><ol><li>åˆ›å»ºÂ <code>2</code>Â ä¸ªÂ <code>EventLoopGroup</code>Â çº¿ç¨‹æ± æ•°ç»„ã€‚æ•°ç»„é»˜è®¤å¤§å°Â <code>CPU * 2</code>ï¼Œæ–¹ä¾¿Â <code>chooser</code>Â é€‰æ‹©çº¿ç¨‹æ± æ—¶æé«˜æ€§èƒ½</li><li><code>BootStrap</code>Â å°†Â <code>boss</code>Â è®¾ç½®ä¸ºÂ <code>group</code>Â å±æ€§ï¼Œå°†Â <code>worker</code>Â è®¾ç½®ä¸ºÂ <code>childer</code>Â å±æ€§</li><li>é€šè¿‡Â <code>bind</code>Â æ–¹æ³•å¯åŠ¨ï¼Œå†…éƒ¨é‡è¦æ–¹æ³•ä¸ºÂ <code>initAndRegister</code>Â å’ŒÂ <code>dobind</code>Â æ–¹æ³•</li><li><code>initAndRegister</code>Â æ–¹æ³•ä¼šåå°„åˆ›å»ºÂ <code>NioServerSocketChannel</code>Â åŠå…¶ç›¸å…³çš„Â <code>NIO</code>Â çš„å¯¹è±¡ï¼Œ<code>pipeline</code>ï¼Œ<code>unsafe</code>ï¼ŒåŒæ—¶ä¹Ÿä¸ºÂ <code>pipeline</code>Â åˆå§‹äº†Â <code>head</code>Â èŠ‚ç‚¹å’ŒÂ <code>tail</code>Â èŠ‚ç‚¹ã€‚</li><li>åœ¨Â <code>register0</code>Â æ–¹æ³•æˆåŠŸä»¥åè°ƒç”¨åœ¨Â <code>dobind</code>Â æ–¹æ³•ä¸­è°ƒç”¨Â <code>doBind0</code>Â æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨Â <code>NioServerSocketChannel</code>Â çš„Â <code>doBind</code>Â æ–¹æ³•å¯¹Â <code>JDK</code>Â çš„Â <code>channel</code>Â å’Œç«¯å£è¿›è¡Œç»‘å®šï¼Œå®ŒæˆÂ <code>Netty</code>Â æœåŠ¡å™¨çš„æ‰€æœ‰å¯åŠ¨ï¼Œå¹¶å¼€å§‹ç›‘å¬è¿æ¥äº‹ä»¶ã€‚</li></ol><h2 id="10-3-Netty-æ¥å—è¯·æ±‚è¿‡ç¨‹æºç å‰–æ"><strong>10.3 Netty æ¥å—è¯·æ±‚è¿‡ç¨‹æºç å‰–æ</strong></h2><h3 id="10-3-1-æºç å‰–æç›®çš„"><strong>10.3.1 æºç å‰–æç›®çš„</strong></h3><ol><li>æœåŠ¡å™¨å¯åŠ¨åè‚¯å®šæ˜¯è¦æ¥å—å®¢æˆ·ç«¯è¯·æ±‚å¹¶è¿”å›å®¢æˆ·ç«¯æƒ³è¦çš„ä¿¡æ¯çš„ï¼Œä¸‹é¢æºç åˆ†æÂ <code>Netty</code>Â åœ¨å¯åŠ¨ä¹‹åæ˜¯å¦‚ä½•æ¥å—å®¢æˆ·ç«¯è¯·æ±‚çš„</li><li>åœ¨Â <code>io.netty.example</code>Â åŒ…ä¸‹</li></ol><h3 id="10-3-2-æºç å‰–æ"><strong>10.3.2 æºç å‰–æ</strong></h3><p>è¯´æ˜ï¼š</p><ol><li>ä»ä¹‹å‰æœåŠ¡å™¨å¯åŠ¨çš„æºç ä¸­ï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼ŒæœåŠ¡å™¨æœ€ç»ˆæ³¨å†Œäº†ä¸€ä¸ªÂ <code>Accept</code>Â äº‹ä»¶ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œ<code>NioServerSocketChannel</code>Â å°†è‡ªå·±æ³¨å†Œåˆ°äº†Â <code>boss</code>Â å•ä¾‹çº¿ç¨‹æ± ï¼ˆ<code>reactor</code>Â çº¿ç¨‹ï¼‰ä¸Šï¼Œä¹Ÿå°±æ˜¯Â <code>EventLoop</code>ã€‚</li><li>å…ˆç®€å•è¯´ä¸‹Â <code>EventLoop</code>Â çš„é€»è¾‘(åé¢æˆ‘ä»¬è¯¦ç»†è®²è§£Â <code>EventLoop</code>)</li></ol><p><code>EventLoop</code>Â çš„ä½œç”¨æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œè€Œè¿™ä¸ªå¾ªç¯ä¸­åš 3 ä»¶äº‹æƒ…ï¼š</p><ol><li><p>æœ‰æ¡ä»¶çš„ç­‰å¾…Â <code>NIO</code>Â äº‹ä»¶ã€‚</p></li><li><p>å¤„ç†Â <code>NIO</code>Â äº‹ä»¶ã€‚</p></li><li><p>å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p></li><li><p>ä»ç”¨å‰é¢çš„é¡¹ç›®æ¥åˆ†æï¼šè¿›å…¥åˆ°Â <code>NioEventLoop</code>Â æºç ä¸­åï¼Œåœ¨Â <code>private void processSelectedKey(SelectionKey k, AbstractNioChannel ch)</code>Â æ–¹æ³•å¼€å§‹è°ƒè¯•æœ€ç»ˆæˆ‘ä»¬è¦åˆ†æåˆ°Â <code>AbstractNioChannel</code>Â çš„Â <code>doBeginRead</code>Â æ–¹æ³•ï¼Œå½“åˆ°è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œé’ˆå¯¹äºè¿™ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç›‘å¬è¯»äº‹ä»¶äº†</p><p>æºç åˆ†æè¿‡ç¨‹</p></li><li><p>æ–­ç‚¹ä½ç½®Â <code>NioEventLoop</code>Â çš„å¦‚ä¸‹æ–¹æ³•Â <code>processSelectedKey</code></p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != 0 || readyOps == 0) &#123;</span><br><span class="line">    unsafe.read();//æ–­ç‚¹ä½ç½®</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>æ‰§è¡Œæµè§ˆå™¨Â <code>http://localhost:8007/</code>Â ï¼Œå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚</li><li>ä»çš„æ–­ç‚¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>readyOps</code>Â æ˜¯Â <code>16</code>ï¼Œä¹Ÿå°±æ˜¯Â <code>Accept</code>Â äº‹ä»¶ã€‚è¯´æ˜æµè§ˆå™¨çš„è¯·æ±‚å·²ç»è¿›æ¥äº†ã€‚</li><li>è¿™ä¸ªÂ <code>unsafe</code>Â æ˜¯Â <code>boss</code>Â çº¿ç¨‹ä¸­Â <code>NioServerSocketChannel</code>Â çš„Â <code>AbstractNioMessageChannel$NioMessageUnsafe</code>Â å¯¹è±¡ã€‚æˆ‘ä»¬è¿›å…¥åˆ°Â <code>AbstractNioMessageChannel$NioMessageUnsafe</code>Â çš„Â <code>read</code>Â æ–¹æ³•ä¸­</li><li><code>read</code>Â æ–¹æ³•ä»£ç å¹¶åˆ†æ:</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void read() &#123;</span><br><span class="line">    asserteventLoop().inEventLoop();</span><br><span class="line">    final ChannelConfig config = config();</span><br><span class="line">    final ChannelPipeline pipeline = pipeline();</span><br><span class="line">    final RecvByteBufAllocator.Handle allocHandle = unsafe().recvBufAllocHandle();</span><br><span class="line">    allocHandle.reset(config);</span><br><span class="line">    booleanclosed = false;</span><br><span class="line">    Throwable exception = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            do &#123;</span><br><span class="line">                int localRead = doReadMessages(readBuf);</span><br><span class="line">                if (localRead == 0) &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                if (localRead &lt; 0) &#123;</span><br><span class="line">                    closed = true;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                allocHandle.incMessagesRead(localRead);</span><br><span class="line">            &#125; while (allocHandle.continueReading());</span><br><span class="line">        &#125; catch (Throwable t) &#123;</span><br><span class="line">            exception = t;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        int size = readBuf.size();</span><br><span class="line">        for (int i = 0; i &lt; size; i++) &#123;</span><br><span class="line">            readPending = false;</span><br><span class="line">            pipeline.fireChannelRead(readBuf.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        readBuf.clear();</span><br><span class="line">        allocHandle.readComplete();</span><br><span class="line">        pipeline.fireChannelReadComplete();</span><br><span class="line"></span><br><span class="line">        if (exception != null) &#123;</span><br><span class="line">            closed = closeOnReadError(exception);</span><br><span class="line"></span><br><span class="line">            pipeline.fireExceptionCaught(exception);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (closed) &#123;</span><br><span class="line">            inputShutdown = true;</span><br><span class="line">            if(isOpen()) &#123;</span><br><span class="line">                close(voidPromise());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        //Check if there is a readPending which was not processed yet.</span><br><span class="line">        //This could be for two reasons:</span><br><span class="line">        //* The user called Channel.read() or ChannelHandlerContext.read() in channelRead(...) method</span><br><span class="line">        //* The user called Channel.read() or ChannelHandlerContext.read() in channelReadComplete(...) method</span><br><span class="line">        //</span><br><span class="line">        // See https://github.com/netty/netty/issues/2254</span><br><span class="line">        if (!readPending &amp;&amp; !config.isAutoRead()) &#123;</span><br><span class="line">            removeReadOp();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š 1)æ£€æŸ¥è¯¥Â <code>eventloop</code>Â çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ã€‚<code>asserteventLoop().inEventLoop()</code></p><p>2)æ‰§è¡ŒÂ <code>doReadMessages</code>Â æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªÂ <code>readBuf</code>Â å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªÂ <code>List</code>ï¼Œä¹Ÿå°±æ˜¯å®¹å™¨ã€‚</p><p>3)å¾ªç¯å®¹å™¨ï¼Œæ‰§è¡ŒÂ <code>pipeline.fireChannelRead(readBuf.get(i));</code></p><p>4)<code>doReadMessages</code>Â æ˜¯è¯»å–Â <code>boss</code>Â çº¿ç¨‹ä¸­çš„Â <code>NioServerSocketChannel</code>Â æ¥å—åˆ°çš„è¯·æ±‚ã€‚å¹¶æŠŠè¿™äº›è¯·æ±‚æ”¾è¿›å®¹å™¨ï¼Œä¸€ä¼šæˆ‘ä»¬Â <code>debug</code>Â ä¸‹Â <code>doReadMessages</code>Â æ–¹æ³•ã€‚</p><p>5)å¾ªç¯éå†å®¹å™¨ä¸­çš„æ‰€æœ‰è¯·æ±‚ï¼Œè°ƒç”¨Â <code>pipeline</code>Â çš„Â <code>fireChannelRead</code>Â æ–¹æ³•ï¼Œç”¨äºå¤„ç†è¿™äº›æ¥å—çš„è¯·æ±‚æˆ–è€…å…¶ä»–äº‹ä»¶ï¼Œåœ¨Â <code>read</code>Â æ–¹æ³•ä¸­ï¼Œå¾ªç¯è°ƒç”¨Â <code>ServerSocket</code>Â çš„Â <code>pipeline</code>Â çš„Â <code>fireChannelRead</code>Â æ–¹æ³•,å¼€å§‹æ‰§è¡Œç®¡é“ä¸­çš„Â <code>handler</code>Â çš„Â <code>ChannelRead</code>Â æ–¹æ³•ï¼ˆ<code>debug</code>Â è¿›å…¥ï¼‰</p><ol><li>è¿½è¸ªä¸€ä¸‹Â <code>doReadMessages</code>Â æ–¹æ³•ï¼Œå°±å¯ä»¥çœ‹å¾—æ›´æ¸…æ™°</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">protected int doReadMessages (List&lt;Object&gt; buf) throws Exception &#123;</span><br><span class="line">    SocketChannel ch = SocketUtils.accept(javaChannel());</span><br><span class="line">    buf.add(newNioSocketChannel(this, ch));</span><br><span class="line">    return 1;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š 1)é€šè¿‡å·¥å…·ç±»ï¼Œè°ƒç”¨Â <code>NioServerSocketChannel</code>Â å†…éƒ¨å°è£…çš„Â <code>serverSocketChannel</code>Â çš„Â <code>accept</code>Â æ–¹æ³•ï¼Œè¿™æ˜¯Â <code>NIO</code>Â åšæ³•ã€‚</p><p>2)è·å–åˆ°ä¸€ä¸ªÂ <code>JDK</code>Â çš„Â <code>SocketChannel</code>ï¼Œç„¶åï¼Œä½¿ç”¨Â <code>NioSocketChannel</code>Â è¿›è¡Œå°è£…ã€‚æœ€åæ·»åŠ åˆ°å®¹å™¨ä¸­</p><p>3)è¿™æ ·å®¹å™¨Â <code>buf</code>Â ä¸­å°±æœ‰äº†Â <code>NioSocketChannel</code>Â ã€å¦‚æœæœ‰å…´è¶£å¯ä»¥è¿½ä¸€ä¸‹Â <code>NioSocketChannel</code>Â æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œæˆ‘å°±ä¸è¿½äº†ã€‘</p><ol><li>å›åˆ°Â <code>read</code>Â æ–¹æ³•ï¼Œç»§ç»­åˆ†æå¾ªç¯æ‰§è¡ŒÂ <code>pipeline.fireChannelRead</code>Â æ–¹æ³•</li></ol><p>1)å‰é¢åˆ†æÂ <code>doReadMessages</code>Â æ–¹æ³•çš„ä½œç”¨æ˜¯é€šè¿‡Â <code>ServerSocket</code>Â çš„Â <code>accept</code>Â æ–¹æ³•è·å–åˆ°Â <code>TCP</code>Â è¿æ¥ï¼Œç„¶åå°è£…æˆÂ <code>Netty</code>Â çš„Â <code>NioSocketChannel</code>Â å¯¹è±¡ã€‚æœ€åæ·»åŠ åˆ°å®¹å™¨ä¸­</p><p>2)åœ¨Â <code>read</code>Â æ–¹æ³•ä¸­ï¼Œå¾ªç¯è°ƒç”¨Â <code>ServerSocket</code>Â çš„Â <code>pipeline</code>Â çš„Â <code>fireChannelRead</code>Â æ–¹æ³•,å¼€å§‹æ‰§è¡Œç®¡é“ä¸­çš„Â <code>handler</code>Â çš„Â <code>ChannelRead</code>Â æ–¹æ³•ï¼ˆ<code>debug</code>Â è¿›å…¥ï¼‰</p><p>3)ç»è¿‡Â <code>dubug</code>ï¼ˆå¤šæ¬¡ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ä¼šåå¤æ‰§è¡Œå¤šä¸ªÂ <code>handler</code>Â çš„Â <code>ChannelRead</code>ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œ<code>pipeline</code>Â é‡Œé¢åˆÂ <code>4</code>Â ä¸ªÂ <code>handler</code>ï¼Œåˆ†åˆ«æ˜¯Â <code>Head</code>ï¼Œ<code>LoggingHandler</code>ï¼Œ<code>ServerBootstrapAcceptor</code>ï¼Œ<code>Tail</code>ã€‚</p><p>4)æˆ‘ä»¬é‡ç‚¹çœ‹çœ‹Â <code>ServerBootstrapAcceptor</code>ã€‚<code>debug</code>Â ä¹‹åï¼Œæ–­ç‚¹ä¼šè¿›å…¥åˆ°Â <code>ServerBootstrapAcceptor</code>Â ä¸­æ¥ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹Â <code>ServerBootstrapAcceptor</code>Â çš„Â <code>channelRead</code>Â æ–¹æ³•ï¼ˆè¦å¤šæ¬¡Â <code>debug</code>Â æ‰å¯ä»¥ï¼‰</p><p>5)<code>channelRead</code>Â æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public void channelRead (ChannelHandlerContext ctx, Object msg) &#123;</span><br><span class="line">    final Channelchild = (Channel)msg;</span><br><span class="line">    child.pipeline().addLast(childHandler);</span><br><span class="line">    setChannelOptions(child, childOptions, logger);</span><br><span class="line">    for (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e : childAttrs) &#123;</span><br><span class="line">        child.attr((AttributeKey&lt;Object&gt;)e.getKey()).set(e.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;//å°†å®¢æˆ·ç«¯è¿æ¥æ³¨å†Œåˆ° worker çº¿ç¨‹æ± </span><br><span class="line">        childGroup.register(child).addListener(new ChannelFutureListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void operationComplete(ChannelFuturefuture) throws Exception &#123;</span><br><span class="line">                if (!future.isSuccess()) &#123;</span><br><span class="line">                    forceClose(child, future.cause());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; catch (Throwable t) &#123;</span><br><span class="line">        forceClose(child, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š 1)<code>msg</code>Â å¼ºè½¬æˆÂ <code>Channel</code>ï¼Œå®é™…ä¸Šå°±æ˜¯Â <code>NioSocketChannel</code>ã€‚</p><p>2)æ·»åŠ Â <code>NioSocketChannel</code>Â çš„Â <code>pipeline</code>Â çš„Â <code>handler</code>ï¼Œå°±æ˜¯æˆ‘ä»¬Â <code>main</code>Â æ–¹æ³•é‡Œé¢è®¾ç½®çš„Â <code>childHandler</code>Â æ–¹æ³•é‡Œçš„ã€‚</p><p>3)è®¾ç½®Â <code>NioSocketChannel</code>Â çš„å„ç§å±æ€§ã€‚</p><p>4)å°†è¯¥Â <code>NioSocketChannel</code>Â æ³¨å†Œåˆ°Â <code>childGroup</code>Â ä¸­çš„ä¸€ä¸ªÂ <code>EventLoop</code>Â ä¸Šï¼Œå¹¶æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ã€‚</p><p>5)è¿™ä¸ªÂ <code>childGroup</code>Â å°±æ˜¯æˆ‘ä»¬Â <code>main</code>Â æ–¹æ³•åˆ›å»ºçš„æ•°ç»„Â <code>workerGroup</code>ã€‚</p><ol><li>è¿›å…¥Â <code>register</code>Â æ–¹æ³•æŸ¥çœ‹(æ­¥æ­¥è¿½è¸ªä¼šåˆ°)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public final void register (EventLoop eventLoop, final ChannelPromise promise) &#123;</span><br><span class="line">    AbstractChannel.this.eventLoop = eventLoop;</span><br><span class="line">    if (eventLoop.inEventLoop()) &#123;</span><br><span class="line">        register0(promise);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        eventLoop.execute(new Runnable()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                register0(promise);//è¿›å…¥åˆ°è¿™é‡Œ</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç»§ç»­è¿›å…¥åˆ°ä¸‹é¢æ–¹æ³•ï¼Œæ‰§è¡Œç®¡é“ä¸­å¯èƒ½å­˜åœ¨çš„ä»»åŠ¡,è¿™é‡Œæˆ‘ä»¬å°±ä¸è¿½äº†Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>æœ€ç»ˆä¼šè°ƒç”¨Â <code>doBeginRead</code>Â æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯Â <code>AbstractNioChannel</code>Â ç±»çš„æ–¹æ³•</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void doBeginRead() throws Exception &#123;</span><br><span class="line">    //Channel.read() or ChannelHandlerContext.read() was called</span><br><span class="line">    final SelectionKey selectionKey = this.selectionKey;//æ–­ç‚¹</span><br><span class="line">    if (!selectionKey.isValid()) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    readPending = true;</span><br><span class="line">    final int interestOps = selectionKey.interestOps();</span><br><span class="line">    if ((interestOps&amp;readInterestOp) == 0) &#123;</span><br><span class="line">        selectionKey.interestOps(interestOps | readInterestOp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><ol><li>è¿™ä¸ªåœ°æ–¹è°ƒè¯•æ—¶ï¼Œè¯·æŠŠå‰é¢çš„æ–­ç‚¹éƒ½å»æ‰ï¼Œç„¶åå¯åŠ¨æœåŠ¡å™¨å°±ä¼šåœæ­¢åœ¨Â <code>doBeginRead</code>ï¼ˆéœ€è¦å…ˆæ”¾è¿‡è¯¥æ–­ç‚¹ï¼Œç„¶åæµè§ˆå™¨è¯·æ±‚ï¼Œæ‰èƒ½çœ‹åˆ°æ•ˆæœï¼‰</li><li>æ‰§è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œé’ˆå¯¹äºè¿™ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç›‘å¬è¯»äº‹ä»¶äº†</li></ol><h3 id="10-3-3-Netty-æ¥å—è¯·æ±‚è¿‡ç¨‹æ¢³ç†"><strong>10.3.3 Netty æ¥å—è¯·æ±‚è¿‡ç¨‹æ¢³ç†</strong></h3><p>æ€»ä½“æµç¨‹ï¼šæ¥å—è¿æ¥ --&gt; åˆ›å»ºä¸€ä¸ªæ–°çš„Â <code>NioSocketChannel</code>Â --&gt; æ³¨å†Œåˆ°ä¸€ä¸ªÂ <code>workerEventLoop</code>Â ä¸Š --&gt; æ³¨å†ŒÂ <code>selecotRead</code>Â äº‹ä»¶ã€‚</p><ol><li>æœåŠ¡å™¨è½®è¯¢Â <code>Accept</code>Â äº‹ä»¶ï¼Œè·å–äº‹ä»¶åè°ƒç”¨Â <code>unsafe</code>Â çš„Â <code>read</code>Â æ–¹æ³•ï¼Œè¿™ä¸ªÂ <code>unsafe</code>Â æ˜¯Â <code>ServerSocket</code>Â çš„å†…éƒ¨ç±»ï¼Œè¯¥æ–¹æ³•å†…éƒ¨ç”±Â <code>2</code>Â éƒ¨åˆ†ç»„æˆ</li><li><code>doReadMessages</code>Â ç”¨äºåˆ›å»ºÂ <code>NioSocketChannel</code>Â å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…è£…Â <code>JDK</code>Â çš„Â <code>NioChannel</code>Â å®¢æˆ·ç«¯ã€‚è¯¥æ–¹æ³•ä¼šåƒåˆ›å»ºÂ <code>ServerSocketChanel</code>Â ç±»ä¼¼åˆ›å»ºç›¸å…³çš„Â <code>pipeline</code>ï¼Œ<code>unsafe</code>ï¼Œ<code>config</code></li><li>éšåæ‰§è¡Œæ‰§è¡ŒÂ <code>pipeline.fireChannelRead</code>Â æ–¹æ³•ï¼Œå¹¶å°†è‡ªå·±ç»‘å®šåˆ°ä¸€ä¸ªÂ <code>chooser</code>Â é€‰æ‹©å™¨é€‰æ‹©çš„Â <code>workerGroup</code>Â ä¸­çš„ä¸€ä¸ªÂ <code>EventLoop</code>ã€‚å¹¶ä¸”æ³¨å†Œä¸€ä¸ªÂ <code>0</code>ï¼Œè¡¨ç¤ºæ³¨å†ŒæˆåŠŸï¼Œä½†å¹¶æ²¡æœ‰æ³¨å†Œè¯»ï¼ˆ1ï¼‰äº‹ä»¶</li></ol><h2 id="10-4-Pipeline-Handler-HandlerContext-åˆ›å»ºæºç å‰–æ"><strong>10.4 Pipeline Handler HandlerContext åˆ›å»ºæºç å‰–æ</strong></h2><h3 id="10-4-1-æºç å‰–æç›®çš„"><strong>10.4.1 æºç å‰–æç›®çš„</strong></h3><p><code>Netty</code>Â ä¸­çš„Â <code>ChannelPipeline</code>ã€<code>ChannelHandler</code>Â å’ŒÂ <code>ChannelHandlerContext</code>Â æ˜¯éå¸¸æ ¸å¿ƒçš„ç»„ä»¶ï¼Œæˆ‘ä»¬ä»æºç æ¥åˆ†æÂ <code>Netty</code>Â æ˜¯å¦‚ä½•è®¾è®¡è¿™ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶çš„ï¼Œå¹¶åˆ†ææ˜¯å¦‚ä½•åˆ›å»ºå’Œåè°ƒå·¥ä½œçš„.</p><h3 id="10-4-2-æºç å‰–æè¯´æ˜"><strong>10.4.2 æºç å‰–æè¯´æ˜</strong></h3><p>è¯´æ˜ åˆ†æè¿‡ç¨‹ä¸­ï¼Œæœ‰å¾ˆå¤šçš„å›¾å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªæ–‡æ¡£ï¼Œåœ¨æ–‡æ¡£çš„åŸºç¡€ä¸Šæ¥åšæºç å‰–æ</p><h3 id="10-4-3-æºç å‰–æ"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter10?id=_1043-%e6%ba%90%e7%a0%81%e5%89%96%e6%9e%90"><strong>10.4.3 æºç å‰–æ</strong></a></h3><ol><li>ChannelPipeline | ChannelHandler | ChannelHandlerContextä»‹ç»</li><li>1 ä¸‰è€…å…³ç³»</li></ol><p>1)æ¯å½“Â <code>ServerSocket</code>Â åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªÂ <code>Socket</code>ï¼Œå¯¹åº”çš„å°±æ˜¯ç›®æ ‡å®¢æˆ·ç«¯ã€‚</p><p>2)æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„Â <code>Socket</code>Â éƒ½å°†ä¼šåˆ†é…ä¸€ä¸ªå…¨æ–°çš„Â <code>ChannelPipeline</code>ï¼ˆä»¥ä¸‹ç®€ç§°Â <code>pipeline</code>ï¼‰</p><p>3)æ¯ä¸€ä¸ªÂ <code>ChannelPipeline</code>Â å†…éƒ¨éƒ½å«æœ‰å¤šä¸ªÂ <code>ChannelHandlerContext</code>ï¼ˆä»¥ä¸‹ç®€ç§°Â <code>Context</code>ï¼‰</p><p>4)ä»–ä»¬ä¸€èµ·ç»„æˆäº†åŒå‘é“¾è¡¨ï¼Œè¿™äº›Â <code>Context</code>Â ç”¨äºåŒ…è£…æˆ‘ä»¬è°ƒç”¨Â <code>addLast</code>Â æ–¹æ³•æ—¶æ·»åŠ çš„Â <code>ChannelHandler</code>ï¼ˆä»¥ä¸‹ç®€ç§°Â <code>handler</code>ï¼‰</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_02.png"></p><p>1)ä¸Šå›¾ä¸­ï¼š<code>ChannelSocket</code>Â å’ŒÂ <code>ChannelPipeline</code>Â æ˜¯ä¸€å¯¹ä¸€çš„å…³è”å…³ç³»ï¼Œè€ŒÂ <code>pipeline</code>Â å†…éƒ¨çš„å¤šä¸ªÂ <code>Context</code>Â å½¢æˆäº†é“¾è¡¨ï¼Œ<code>Context</code>Â åªæ˜¯å¯¹Â <code>Handler</code>Â çš„å°è£…ã€‚ 2)å½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼Œä¼šè¿›å…¥Â <code>Socket</code>Â å¯¹åº”çš„Â <code>pipeline</code>ï¼Œå¹¶ç»è¿‡Â <code>pipeline</code>Â æ‰€æœ‰çš„Â <code>handler</code>ï¼Œå¯¹ï¼Œå°±æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„è¿‡æ»¤å™¨æ¨¡å¼ã€‚</p><p>1.2 ChannelPipeline ä½œç”¨åŠè®¾è®¡</p><p>1)<code>pipeline</code>Â çš„æ¥å£è®¾è®¡</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_03.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_03.png"></p><p>éƒ¨åˆ†æºç </p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_04.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_04.png"></p><p>å¯ä»¥çœ‹åˆ°è¯¥æ¥å£ç»§æ‰¿äº†Â <code>inBound</code>ï¼Œ<code>outBound</code>ï¼Œ<code>Iterable</code>Â æ¥å£ï¼Œè¡¨ç¤ºä»–å¯ä»¥è°ƒç”¨æ•°æ®å‡ºç«™çš„æ–¹æ³•å’Œå…¥ç«™çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿèƒ½éå†å†…éƒ¨çš„é“¾è¡¨ï¼Œçœ‹çœ‹ä»–çš„å‡ ä¸ªä»£è¡¨æ€§çš„æ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é’ˆå¯¹Â <code>handler</code>Â é“¾è¡¨çš„æ’å…¥ï¼Œè¿½åŠ ï¼Œåˆ é™¤ï¼Œæ›¿æ¢æ“ä½œï¼Œç±»ä¼¼æ˜¯ä¸€ä¸ªÂ <code>LinkedList</code>ã€‚åŒæ—¶ï¼Œä¹Ÿèƒ½è¿”å›Â <code>channel</code>ï¼ˆä¹Ÿå°±æ˜¯Â <code>socket</code>ï¼‰</p><p>1)åœ¨Â <code>pipeline</code>Â çš„æ¥å£æ–‡æ¡£ä¸Šï¼Œæä¾›äº†ä¸€å¹…å›¾</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_05.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_05.png"></p><p>å¯¹ä¸Šå›¾çš„è§£é‡Šè¯´æ˜ï¼š *è¿™æ˜¯ä¸€ä¸ªÂ <code>handler</code>Â çš„Â <code>list</code>ï¼Œ<code>handler</code>Â ç”¨äºå¤„ç†æˆ–æ‹¦æˆªå…¥ç«™äº‹ä»¶å’Œå‡ºç«™äº‹ä»¶ï¼Œ<code>pipeline</code>Â å®ç°äº†è¿‡æ»¤å™¨çš„é«˜çº§å½¢å¼ï¼Œä»¥ä¾¿ç”¨æˆ·æ§åˆ¶äº‹ä»¶å¦‚ä½•å¤„ç†ä»¥åŠÂ <code>handler</code>Â åœ¨Â <code>pipeline</code>Â ä¸­å¦‚ä½•äº¤äº’ã€‚</p><ul><li>ä¸Šå›¾æè¿°äº†ä¸€ä¸ªå…¸å‹çš„Â <code>handler</code>Â åœ¨Â <code>pipeline</code>Â ä¸­å¤„ç†Â <code>I/O</code>Â äº‹ä»¶çš„æ–¹å¼ï¼Œ<code>IO</code>Â äº‹ä»¶ç”±Â <code>inboundHandler</code>Â æˆ–è€…Â <code>outBoundHandler</code>Â å¤„ç†ï¼Œå¹¶é€šè¿‡è°ƒç”¨Â <code>ChannelHandlerContext.fireChannelRead</code>Â æ–¹æ³•è½¬å‘ç»™å…¶æœ€è¿‘çš„å¤„ç†ç¨‹åºã€‚</li><li>å…¥ç«™äº‹ä»¶ç”±å…¥ç«™å¤„ç†ç¨‹åºä»¥è‡ªä¸‹è€Œä¸Šçš„æ–¹å‘å¤„ç†ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚å…¥ç«™å¤„ç†ç¨‹åºé€šå¸¸å¤„ç†ç”±å›¾åº•éƒ¨çš„Â <code>I/O</code>Â çº¿ç¨‹ç”Ÿæˆå…¥ç«™æ•°æ®ã€‚å…¥ç«™æ•°æ®é€šå¸¸ä»å¦‚Â <code>SocketChannel.read(ByteBuffer)</code>Â è·å–ã€‚</li><li>é€šå¸¸ä¸€ä¸ªÂ <code>pipeline</code>Â æœ‰å¤šä¸ªÂ <code>handler</code>ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå…¸å‹çš„æœåŠ¡å™¨åœ¨æ¯ä¸ªé€šé“çš„ç®¡é“ä¸­éƒ½ä¼šæœ‰ä»¥ä¸‹å¤„ç†ç¨‹åºåè®®è§£ç å™¨-å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºÂ <code>Java</code>Â å¯¹è±¡ã€‚åè®®ç¼–ç å™¨-å°†Â <code>Java</code>Â å¯¹è±¡è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ä¸šåŠ¡é€»è¾‘å¤„ç†ç¨‹åº-æ‰§è¡Œå®é™…ä¸šåŠ¡é€»è¾‘ï¼ˆä¾‹å¦‚æ•°æ®åº“è®¿é—®ï¼‰</li><li>ä½ çš„ä¸šåŠ¡ç¨‹åºä¸èƒ½å°†çº¿ç¨‹é˜»å¡ï¼Œä¼šå½±å“Â <code>IO</code>Â çš„é€Ÿåº¦ï¼Œè¿›è€Œå½±å“æ•´ä¸ªÂ <code>Netty</code>Â ç¨‹åºçš„æ€§èƒ½ã€‚å¦‚æœä½ çš„ä¸šåŠ¡ç¨‹åºå¾ˆå¿«ï¼Œå°±å¯ä»¥æ”¾åœ¨Â <code>IO</code>Â çº¿ç¨‹ä¸­ï¼Œåä¹‹ï¼Œä½ éœ€è¦å¼‚æ­¥æ‰§è¡Œã€‚æˆ–è€…åœ¨æ·»åŠ Â <code>handler</code>Â çš„æ—¶å€™æ·»åŠ ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä¾‹å¦‚ï¼š</li></ul><p>// ä¸‹é¢è¿™ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™ï¼Œå°†ä¸ä¼šé˜»å¡Â <code>IO</code>Â çº¿ç¨‹ï¼Œæ‰§è¡Œçš„çº¿ç¨‹æ¥è‡ªÂ <code>group</code>Â çº¿ç¨‹æ± </p><p><code>pipeline.addLast(group, &quot;handler&quot;, new MyBusinessLogicHandler());</code></p><p>1.3Â <code>ChannelHandler</code>Â ä½œç”¨åŠè®¾è®¡</p><p>1)æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface ChannelHandler &#123;</span><br><span class="line">    //å½“æŠŠ ChannelHandler æ·»åŠ åˆ° pipeline æ—¶è¢«è°ƒç”¨</span><br><span class="line">    void handlerAdded(ChannelHandlerContext ctx) throws Exception;</span><br><span class="line">    //å½“ä» pipeline ä¸­ç§»é™¤æ—¶è°ƒç”¨</span><br><span class="line">    void handlerRemoved(ChannelHandlerContext ctx) throws Exception;</span><br><span class="line">    //å½“å¤„ç†è¿‡ç¨‹ä¸­åœ¨ pipeline å‘ç”Ÿå¼‚å¸¸æ—¶è°ƒç”¨</span><br><span class="line">    @Deprecated</span><br><span class="line">    void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>2)<code>ChannelHandler</code>Â çš„ä½œç”¨å°±æ˜¯å¤„ç†Â <code>IO</code>Â äº‹ä»¶æˆ–æ‹¦æˆªÂ <code>IO</code>Â äº‹ä»¶ï¼Œå¹¶å°†å…¶è½¬å‘ç»™ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºÂ <code>ChannelHandler</code>ã€‚<code>Handler</code>Â å¤„ç†äº‹ä»¶æ—¶åˆ†å…¥ç«™å’Œå‡ºç«™çš„ï¼Œä¸¤ä¸ªæ–¹å‘çš„æ“ä½œéƒ½æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ï¼Œ<code>Netty</code>Â å®šä¹‰äº†ä¸¤ä¸ªå­æ¥å£ç»§æ‰¿Â <code>ChannelHandler</code></p><p>2)<code>ChannelInboundHandler</code>Â å…¥ç«™äº‹ä»¶æ¥å£</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_06.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_06.png"></p><ul><li><code>channelActive</code>Â ç”¨äºå½“Â <code>Channel</code>Â å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶è¢«è°ƒç”¨ï¼›</li><li><code>channelRead</code>Â å½“ä»Â <code>Channel</code>Â è¯»å–æ•°æ®æ—¶è¢«è°ƒç”¨ç­‰ç­‰æ–¹æ³•ã€‚</li><li>ç¨‹åºå‘˜éœ€è¦é‡å†™ä¸€äº›æ–¹æ³•ï¼Œå½“å‘ç”Ÿå…³æ³¨çš„äº‹ä»¶ï¼Œéœ€è¦åœ¨æ–¹æ³•ä¸­å®ç°æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ï¼Œå› ä¸ºå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ<code>Netty</code>Â ä¼šå›è°ƒå¯¹åº”çš„æ–¹æ³•ã€‚</li></ul><p>3)`ChannelOutboundHandler å‡ºç«™äº‹ä»¶æ¥å£</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_07.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_07.png"></p><ul><li><code>bind</code>Â æ–¹æ³•ï¼Œå½“è¯·æ±‚å°†Â <code>Channel</code>Â ç»‘å®šåˆ°æœ¬åœ°åœ°å€æ—¶è°ƒç”¨</li><li><code>close</code>Â æ–¹æ³•ï¼Œå½“è¯·æ±‚å…³é—­Â <code>Channel</code>Â æ—¶è°ƒç”¨ç­‰ç­‰</li><li>å‡ºç«™æ“ä½œéƒ½æ˜¯ä¸€äº›è¿æ¥å’Œå†™å‡ºæ•°æ®ç±»ä¼¼çš„æ–¹æ³•ã€‚</li></ul><p>4)<code>ChannelDuplexHandler</code>Â å¤„ç†å‡ºç«™å’Œå…¥ç«™äº‹ä»¶</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_08.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_08.png"></p><ul><li><code>ChannelDuplexHandler</code>Â é—´æ¥å®ç°äº†å…¥ç«™æ¥å£å¹¶ç›´æ¥å®ç°äº†å‡ºç«™æ¥å£ã€‚</li><li>æ˜¯ä¸€ä¸ªé€šç”¨çš„èƒ½å¤ŸåŒæ—¶å¤„ç†å…¥ç«™äº‹ä»¶å’Œå‡ºç«™äº‹ä»¶çš„ç±»ã€‚</li></ul><p>1.4Â <code>ChannelHandlerContext</code>Â ä½œç”¨åŠè®¾è®¡</p><p>1)<code>ChannelHandlerContext</code>Â <code>UML</code>Â å›¾</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_09.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_09.png"></p><p><code>ChannelHandlerContext</code>Â ç»§æ‰¿äº†å‡ºç«™æ–¹æ³•è°ƒç”¨æ¥å£å’Œå…¥ç«™æ–¹æ³•è°ƒç”¨æ¥å£</p><p>1)<code>ChannelOutboundInvoker</code>Â å’ŒÂ <code>ChannelInboundInvoker</code>Â éƒ¨åˆ†æºç </p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_10.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_10.png"></p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_11.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_11.png"></p><ul><li>è¿™ä¸¤ä¸ªÂ <code>invoker</code>Â å°±æ˜¯é’ˆå¯¹å…¥ç«™æˆ–å‡ºç«™æ–¹æ³•æ¥çš„ï¼Œå°±æ˜¯åœ¨å…¥ç«™æˆ–å‡ºç«™Â <code>handler</code>Â çš„å¤–å±‚å†åŒ…è£…ä¸€å±‚ï¼Œè¾¾åˆ°åœ¨æ–¹æ³•å‰åæ‹¦æˆªå¹¶åšä¸€äº›ç‰¹å®šæ“ä½œçš„ç›®çš„</li></ul><p>2)<code>ChannelHandlerContext</code>Â éƒ¨åˆ†æºç </p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_12.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_12.png"></p><ul><li><code>ChannelHandlerContext</code>Â ä¸ä»…ä»…æ—¶ç»§æ‰¿äº†ä»–ä»¬ä¸¤ä¸ªçš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå®šä¹‰äº†ä¸€äº›è‡ªå·±çš„æ–¹æ³•</li><li>è¿™äº›æ–¹æ³•èƒ½å¤Ÿè·å–Â <code>Context</code>Â ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å¯¹åº”çš„æ¯”å¦‚Â <code>channel</code>ï¼Œ<code>executor</code>ï¼Œ<code>handler</code>ï¼Œ<code>pipeline</code>ï¼Œå†…å­˜åˆ†é…å™¨ï¼Œå…³è”çš„Â <code>handler</code>Â æ˜¯å¦è¢«åˆ é™¤ã€‚</li><li><code>Context</code>Â å°±æ˜¯åŒ…è£…äº†Â <code>handler</code>Â ç›¸å…³çš„ä¸€åˆ‡ï¼Œä»¥æ–¹ä¾¿Â <code>Context</code>Â å¯ä»¥åœ¨Â <code>pipeline</code>Â æ–¹ä¾¿çš„æ“ä½œÂ <code>handler</code></li></ul><p>2.ChannelPipeline | ChannelHandler | ChannelHandlerContext</p><p>åˆ›å»ºè¿‡ç¨‹åˆ†ä¸ºÂ <code>3</code>Â ä¸ªæ­¥éª¤æ¥çœ‹åˆ›å»ºçš„è¿‡ç¨‹ï¼š</p><ul><li>ä»»ä½•ä¸€ä¸ªÂ <code>ChannelSocket</code>Â åˆ›å»ºçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªÂ <code>pipeline</code>ã€‚</li><li>å½“ç”¨æˆ·æˆ–ç³»ç»Ÿå†…éƒ¨è°ƒç”¨Â <code>pipeline</code>Â çš„Â <code>add</code></li><li>** æ–¹æ³•æ·»åŠ Â <code>handler</code>Â æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªåŒ…è£…è¿™Â <code>handler</code>Â çš„Â <code>Context</code>ã€‚</li><li>è¿™äº›Â <code>Context</code>Â åœ¨Â <code>pipeline</code>Â ä¸­ç»„æˆäº†åŒå‘é“¾è¡¨ã€‚</li></ul><p>2.1Â <code>Socket</code>Â åˆ›å»ºçš„æ—¶å€™åˆ›å»ºÂ <code>pipeline</code>Â åœ¨Â <code>SocketChannel</code>Â çš„æŠ½è±¡çˆ¶ç±»Â <code>AbstractChannel</code>Â çš„æ„é€ æ–¹æ³•ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">protected AbstractChannel(Channel parent) &#123;</span><br><span class="line">    this.parent=parent;//æ–­ç‚¹æµ‹è¯•</span><br><span class="line">    id = newId();</span><br><span class="line">    unsafe = new Unsafe();</span><br><span class="line">    pipeline = new ChannelPipeline();</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p><code>Debug</code>Â ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä»£ç ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œç„¶åç»§ç»­è¿½è¸ªåˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">protected DefaultChannelPipeline(Channel channel) &#123;</span><br><span class="line">    this.channel = ObjectUtil.checkNotNull(channel, &quot;channel&quot;);</span><br><span class="line">    succeededFuture = new SucceededChannelFuture(channel, null);</span><br><span class="line">    voidPromise = new VoidChannelPromise(channel, true);</span><br><span class="line">    tail = new TailContext(this);</span><br><span class="line">    head = new HeadContext(this);</span><br><span class="line">    head.next = tail;</span><br><span class="line">    tail.prev = head;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>1ï¼‰å°†Â <code>channel</code>Â èµ‹å€¼ç»™Â <code>channel</code>Â å­—æ®µï¼Œç”¨äºÂ <code>pipeline</code>Â æ“ä½œÂ <code>channel</code>ã€‚</p><p>2ï¼‰åˆ›å»ºä¸€ä¸ªÂ <code>future</code>Â å’ŒÂ <code>promise</code>ï¼Œç”¨äºå¼‚æ­¥å›è°ƒä½¿ç”¨ã€‚</p><p>3ï¼‰åˆ›å»ºä¸€ä¸ªÂ <code>inbound</code>Â çš„Â <code>tailContext</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ—¢æ˜¯Â <code>inbound</code>Â ç±»å‹åˆæ˜¯Â <code>outbound</code>Â ç±»å‹çš„Â <code>headContext</code>ã€‚</p><p>4ï¼‰æœ€åï¼Œå°†ä¸¤ä¸ªÂ <code>Context</code>Â äº’ç›¸è¿æ¥ï¼Œå½¢æˆåŒå‘é“¾è¡¨ã€‚</p><p>5ï¼‰<code>tailContext</code>Â å’ŒÂ <code>HeadContext</code>Â éå¸¸çš„é‡è¦ï¼Œæ‰€æœ‰Â <code>pipeline</code>Â ä¸­çš„äº‹ä»¶éƒ½ä¼šæµç»ä»–ä»¬ï¼Œ</p><p>2.2 åœ¨ add<strong>æ·»åŠ å¤„ç†å™¨çš„æ—¶å€™åˆ›å»ºContext</strong>çœ‹ä¸‹Â <code>DefaultChannelPipeline</code>Â çš„Â <code>addLast</code>Â æ–¹æ³•å¦‚ä½•åˆ›å»ºçš„Â <code>Context</code>ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public final ChannelPipeline addLast(EventExecutorGroup executor, ChannelHandler... handlers) &#123;</span><br><span class="line">    if (handlers == null) &#123;//æ–­ç‚¹</span><br><span class="line">        throw new NullPointerException(&quot;handlers&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    for (ChannelHandler h : handlers) &#123;</span><br><span class="line">        if (h == null) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        addLast(executor, null, h);</span><br><span class="line">    &#125;</span><br><span class="line">    return this;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>ç»§ç»­ Debug</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public final ChannelPipeline addLast(EventExecutorGroup group, String name, ChannelHandler handler) &#123;</span><br><span class="line">    final AbstractChannelHandlerContext newCtx;</span><br><span class="line">    synchronized(this) &#123;</span><br><span class="line">        checkMultiplicity(handler);</span><br><span class="line"></span><br><span class="line">        newCtx = newContext(group, filterName(name, handler), handler);</span><br><span class="line">        addLast0(newCtx);</span><br><span class="line">        //If the registered is false it means that the channel was not registered on an eventloop yet.</span><br><span class="line">        //In this case we add the context to the pipeline and add a task that will call</span><br><span class="line">        //ChannelHandler.handlerAdded(...) once the channel is registered.</span><br><span class="line">        if (!registered) &#123;</span><br><span class="line">            newCtx.setAddPending();</span><br><span class="line">            callHandlerCallbackLater(newCtx, true);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        EventExecutor executor = newCtx.executor();</span><br><span class="line">        if (!executor.inEventLoop()) &#123;</span><br><span class="line">            newCtx.setAddPending();</span><br><span class="line">            executor.execute(new Runnable() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void run () &#123;</span><br><span class="line">                    callHandlerAdded0(newCtx);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    callHandlerAdded0(newCtx);</span><br><span class="line">    return this;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ 1)<code>pipeline</code>Â æ·»åŠ Â <code>handler</code>ï¼Œå‚æ•°æ˜¯çº¿ç¨‹æ± ï¼Œ<code>name</code>Â æ˜¯Â <code>null</code>ï¼Œ<code>handler</code>Â æ˜¯æˆ‘ä»¬æˆ–è€…ç³»ç»Ÿä¼ å…¥çš„Â <code>handler</code>ã€‚<code>Netty</code>Â ä¸ºäº†é˜²æ­¢å¤šä¸ªçº¿ç¨‹å¯¼è‡´å®‰å…¨é—®é¢˜ï¼ŒåŒæ­¥äº†è¿™æ®µä»£ç ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>2)æ£€æŸ¥è¿™ä¸ªÂ <code>handler</code>Â å®ä¾‹æ˜¯å¦æ˜¯å…±äº«çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œå¹¶ä¸”å·²ç»è¢«åˆ«çš„Â <code>pipeline</code>Â ä½¿ç”¨äº†ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>3)è°ƒç”¨Â <code>new Context(group, filterName(name, handler), handler)</code>Â æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªÂ <code>Context</code>ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥äº†ï¼Œæ¯æ¬¡æ·»åŠ ä¸€ä¸ªÂ <code>handler</code>Â éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…³è”Â <code>Context</code>ã€‚</p><p>4)è°ƒç”¨Â <code>addLast</code>Â æ–¹æ³•ï¼Œå°†Â <code>Context</code>Â è¿½åŠ åˆ°é“¾è¡¨ä¸­ã€‚</p><p>5)å¦‚æœè¿™ä¸ªé€šé“è¿˜æ²¡æœ‰æ³¨å†Œåˆ°Â <code>selecor</code>Â ä¸Šï¼Œå°±å°†è¿™ä¸ªÂ <code>Context</code>Â æ·»åŠ åˆ°è¿™ä¸ªÂ <code>pipeline</code>Â çš„å¾…åŠä»»åŠ¡ä¸­ã€‚å½“æ³¨å†Œå¥½äº†ä»¥åï¼Œå°±ä¼šè°ƒç”¨Â <code>callHandlerAdded0</code>Â æ–¹æ³•ï¼ˆé»˜è®¤æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œç”¨æˆ·å¯ä»¥å®ç°è¿™ä¸ªæ–¹æ³•ï¼‰ã€‚</p><p>6)åˆ°è¿™é‡Œï¼Œé’ˆå¯¹ä¸‰å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ï¼Œäº†è§£çš„å·®ä¸å¤šäº†ï¼Œå’Œæœ€åˆè¯´çš„ä¸€æ ·ï¼Œæ¯å½“åˆ›å»ºÂ <code>ChannelSocket</code>Â çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªç»‘å®šçš„Â <code>pipeline</code>ï¼Œä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œåˆ›å»ºÂ <code>pipeline</code>Â çš„æ—¶å€™ä¹Ÿä¼šåˆ›å»ºÂ <code>tail</code>Â èŠ‚ç‚¹å’ŒÂ <code>head</code>Â èŠ‚ç‚¹ï¼Œå½¢æˆæœ€åˆçš„é“¾è¡¨ã€‚<code>tail</code>Â æ˜¯å…¥ç«™Â <code>inbound</code>Â ç±»å‹çš„Â <code>handler</code>ï¼Œ<code>head</code>Â æ—¢æ˜¯Â <code>inbound</code>Â ä¹Ÿæ˜¯Â <code>outbound</code>Â ç±»å‹çš„Â <code>handler</code>ã€‚åœ¨è°ƒç”¨Â <code>pipeline</code>Â çš„Â <code>addLast</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ç»™å®šçš„Â <code>handler</code>Â åˆ›å»ºä¸€ä¸ªÂ <code>Context</code>ï¼Œç„¶åï¼Œå°†è¿™ä¸ªÂ <code>Context</code>Â æ’å…¥åˆ°é“¾è¡¨çš„å°¾ç«¯ï¼ˆ<code>tail</code>Â å‰é¢ï¼‰ã€‚åˆ°æ­¤å°±Â <code>OK</code>Â äº†ã€‚</p><h3 id="10-4-4-Pipeline-Handler-HandlerContext-åˆ›å»ºè¿‡ç¨‹æ¢³ç†"><strong>10.4.4 Pipeline Handler HandlerContext åˆ›å»ºè¿‡ç¨‹æ¢³ç†</strong></h3><ol><li>æ¯å½“åˆ›å»ºÂ <code>ChannelSocket</code>Â çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªç»‘å®šçš„Â <code>pipeline</code>ï¼Œä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œåˆ›å»ºÂ <code>pipeline</code>Â çš„æ—¶å€™ä¹Ÿä¼šåˆ›å»ºÂ <code>tail</code>Â èŠ‚ç‚¹å’ŒÂ <code>head</code>Â èŠ‚ç‚¹ï¼Œå½¢æˆæœ€åˆçš„é“¾è¡¨ã€‚</li><li>åœ¨è°ƒç”¨Â <code>pipeline</code>Â çš„Â <code>addLast</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ç»™å®šçš„Â <code>handler</code>Â åˆ›å»ºä¸€ä¸ªÂ <code>Context</code>ï¼Œç„¶åï¼Œå°†è¿™ä¸ªÂ <code>Context</code>Â æ’å…¥åˆ°é“¾è¡¨çš„å°¾ç«¯ï¼ˆ<code>tail</code>Â å‰é¢ï¼‰ã€‚</li><li><code>Context</code>Â åŒ…è£…Â <code>handler</code>ï¼Œå¤šä¸ªÂ <code>Context</code>Â åœ¨Â <code>pipeline</code>Â ä¸­å½¢æˆäº†åŒå‘é“¾è¡¨</li><li>å…¥ç«™æ–¹å‘å«Â <code>inbound</code>ï¼Œç”±Â <code>head</code>Â èŠ‚ç‚¹å¼€å§‹ï¼Œå‡ºç«™æ–¹æ³•å«Â <code>outbound</code>ï¼Œç”±Â <code>tail</code>Â èŠ‚ç‚¹å¼€å§‹</li></ol><h2 id="10-5-ChannelPipeline-è°ƒåº¦-handler-çš„æºç å‰–æ"><strong>10.5 ChannelPipeline è°ƒåº¦ handler çš„æºç å‰–æ</strong></h2><h3 id="10-5-1-æºç å‰–æç›®çš„"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter10?id=_1051-%e6%ba%90%e7%a0%81%e5%89%96%e6%9e%90%e7%9b%ae%e7%9a%84"><strong>10.5.1 æºç å‰–æç›®çš„</strong></a></h3><ol><li><p>å½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼Œ<code>ChannelPipeline</code>Â æ˜¯å¦‚ä½•è°ƒç”¨å†…éƒ¨çš„è¿™äº›Â <code>handler</code>Â çš„å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸‹ã€‚</p></li><li><p>é¦–å…ˆï¼Œå½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼Œä¼šç¬¬ä¸€ä¸ªè°ƒç”¨Â <code>pipeline</code>Â çš„ç›¸å…³æ–¹æ³•ï¼Œå¦‚æœæ˜¯å…¥ç«™äº‹ä»¶ï¼Œè¿™äº›æ–¹æ³•ç”±Â <code>fire</code>Â å¼€å¤´ï¼Œè¡¨ç¤ºå¼€å§‹ç®¡é“çš„æµåŠ¨ã€‚è®©åé¢çš„Â <code>handler</code>Â ç»§ç»­å¤„ç†</p></li></ol><h3 id="10-5-2-æºç å‰–æ"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter10?id=_1052-%e6%ba%90%e7%a0%81%e5%89%96%e6%9e%90"><strong>10.5.2 æºç å‰–æ</strong></a></h3><p>è¯´æ˜</p><p>å½“æµè§ˆå™¨è¾“å…¥Â <code>http://localhost:8007</code>Â ã€‚å¯ä»¥çœ‹åˆ°ä¼šæ‰§è¡ŒÂ <code>handler</code>Â åœ¨Â <code>Debug</code>Â æ—¶ï¼Œå¯ä»¥å°†æ–­ç‚¹ä¸‹åœ¨Â <code>DefaultChannelPipeline</code>Â ç±»çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public final ChannelPipeline fireChannelActive() &#123;</span><br><span class="line">    AbstractChannelHandlerContext.invokeChannelActive(head);//æ–­ç‚¹</span><br><span class="line">    return this;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>æºç åˆ†æ</p><ol><li><code>DefaultChannelPipeline</code>Â æ˜¯å¦‚ä½•å®ç°è¿™äº›Â <code>fire</code>Â æ–¹æ³•çš„ 3.1Â <code>DefaultChannelPipeline</code>Â æºç </li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public class DefaultChannelPipeline implements ChannelPipeline &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipeline fireChannelActive() &#123;</span><br><span class="line">        AbstractChannelHandlerContext.invokeChannelActive(head);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipelinefireChannelInactive() &#123;</span><br><span class="line">        AbstractChannelHandlerContext.invokeChannelInactive(head);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipeline fireExceptionCaught(Throwable cause) &#123;</span><br><span class="line">        AbstractChannelHandlerContext.invokeExceptionCaught(head, cause);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipeline fireUserEventTriggered(Object event) &#123;</span><br><span class="line">        AbstractChannelHandlerContext.invokeUserEventTriggered(head, event);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipeline fireChannelRead(Objectmsg) &#123;</span><br><span class="line">        AbstractChannelHandlerContext.invokeChannelRead(head, msg);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipeline fireChannelReadComplete() &#123;</span><br><span class="line">        AbstractChannelHandlerContext.invokeChannelReadComplete(head);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipeline fireChannelWritabilityChanged() &#123;</span><br><span class="line">        AbstractChannelHandlerContext.invokeChannelWritabilityChanged(head);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯Â <code>inbound</code>Â çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å…¥ç«™äº‹ä»¶ï¼Œè°ƒç”¨é™æ€æ–¹æ³•ä¼ å…¥çš„ä¹Ÿæ˜¯Â <code>inbound</code>Â çš„ç±»å‹Â <code>head</code>Â <code>handler</code>ã€‚è¿™äº›é™æ€æ–¹æ³•åˆ™ä¼šè°ƒç”¨Â <code>head</code>Â çš„Â <code>ChannelInboundInvoker</code>Â æ¥å£çš„æ–¹æ³•ï¼Œå†ç„¶åè°ƒç”¨Â <code>handler</code>Â çš„çœŸæ­£æ–¹æ³•</p><p>3.2å†çœ‹ä¸‹Â <code>piepline</code>Â çš„Â <code>outbound</code>Â çš„Â <code>fire</code>Â æ–¹æ³•å®ç°æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">public class DefaultChannelPipeline implements ChannelPipeline &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture bind(SocketAddress localAddress) &#123;</span><br><span class="line">        return tail.bind(localAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture connect(SocketAddress remoteAddress) &#123;</span><br><span class="line">        return tail.connect(remoteAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture connect(SocketAddress remoteAddress, SocketAddress localAddress) &#123;</span><br><span class="line">        return tail.connect(remoteAddress, localAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture disconnect()&#123;</span><br><span class="line">        return tail.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture close() &#123;</span><br><span class="line">        return tail.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture deregister() &#123;</span><br><span class="line">        return tail.deregister();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelPipeline flush() &#123;</span><br><span class="line">        tail.flush();</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture bind(SocketAddress localAddress, ChannelPromise promise) &#123;</span><br><span class="line">        return tail.bind(localAddress, promise);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture connect(SocketAddress remoteAddress, ChannelPromise promise) &#123;</span><br><span class="line">        return tail.connect(remoteAddress, promise);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture connect(SocketAddress remoteAddress, SocketAddress localAddress, ChannelPromise promise) &#123;</span><br><span class="line">        return tail.connect(remoteAddress, localAddress, promise);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public final ChannelFuture disconnect(ChannelPromise promise) &#123;</span><br><span class="line">        return tail.disconnect(promise);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>1)è¿™äº›éƒ½æ˜¯å‡ºç«™çš„å®ç°ï¼Œä½†æ˜¯è°ƒç”¨çš„æ˜¯Â <code>outbound</code>Â ç±»å‹çš„Â <code>tailhandler</code>Â æ¥è¿›è¡Œå¤„ç†ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯Â <code>outbound</code>Â äº‹ä»¶ã€‚</p><p>2)å‡ºç«™æ˜¯Â <code>tail</code>Â å¼€å§‹ï¼Œå…¥ç«™ä»Â <code>head</code>Â å¼€å§‹ã€‚å› ä¸ºå‡ºç«™æ˜¯ä»å†…éƒ¨å‘å¤–é¢å†™ï¼Œä»Â <code>tail</code>Â å¼€å§‹ï¼Œèƒ½å¤Ÿè®©å‰é¢çš„Â <code>handler</code>Â è¿›è¡Œå¤„ç†ï¼Œé˜²æ­¢Â <code>handler</code>Â è¢«é—æ¼ï¼Œæ¯”å¦‚ç¼–ç ã€‚åä¹‹ï¼Œå…¥ç«™å½“ç„¶æ˜¯ä»Â <code>head</code>Â å¾€å†…éƒ¨è¾“å…¥ï¼Œè®©åé¢çš„Â <code>handler</code>Â èƒ½å¤Ÿå¤„ç†è¿™äº›è¾“å…¥çš„æ•°æ®ã€‚æ¯”å¦‚è§£ç ã€‚å› æ­¤è™½ç„¶Â <code>head</code>Â ä¹Ÿå®ç°äº†Â <code>outbound</code>Â æ¥å£ï¼Œä½†ä¸æ˜¯ä» head å¼€å§‹æ‰§è¡Œå‡ºç«™ä»»åŠ¡</p><p>4.å…³äºå¦‚ä½•è°ƒåº¦ï¼Œç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤º:</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_13.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_13.png"></p><p>è¯´æ˜ï¼š 1)<code>pipeline</code>Â é¦–å…ˆä¼šè°ƒç”¨Â <code>Context</code>Â çš„é™æ€æ–¹æ³•Â <code>fireXXX</code>ï¼Œå¹¶ä¼ å…¥Â <code>Context</code></p><p>2)ç„¶åï¼Œé™æ€æ–¹æ³•è°ƒç”¨Â <code>Context</code>Â çš„Â <code>invoker</code>Â æ–¹æ³•ï¼Œè€ŒÂ <code>invoker</code>Â æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨è¯¥Â <code>Context</code>Â æ‰€åŒ…å«çš„Â <code>Handler</code>Â çš„çœŸæ­£çš„Â <code>XXX</code>Â æ–¹æ³•ï¼Œè°ƒç”¨ç»“æŸåï¼Œå¦‚æœè¿˜éœ€è¦ç»§ç»­å‘åä¼ é€’ï¼Œå°±è°ƒç”¨Â <code>Context</code>Â çš„Â <code>fireXXX2</code>Â æ–¹æ³•ï¼Œå¾ªç¯å¾€å¤ã€‚</p><h3 id="10-5-3-ChannelPipeline-è°ƒåº¦-handler-æ¢³ç†"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter10?id=_1053-channelpipeline-%e8%b0%83%e5%ba%a6-handler-%e6%a2%b3%e7%90%86"><strong>10.5.3 ChannelPipeline è°ƒåº¦ handler æ¢³ç†</strong></a></h3><ol><li><code>Context</code>Â åŒ…è£…Â <code>handler</code>ï¼Œå¤šä¸ªÂ <code>Context</code>Â åœ¨Â <code>pipeline</code>Â ä¸­å½¢æˆäº†åŒå‘é“¾è¡¨ï¼Œå…¥ç«™æ–¹å‘å«Â <code>inbound</code>ï¼Œç”±Â <code>head</code>Â èŠ‚ç‚¹å¼€å§‹ï¼Œå‡ºç«™æ–¹æ³•å«Â <code>outbound</code>ï¼Œç”±Â <code>tail</code>Â èŠ‚ç‚¹å¼€å§‹ã€‚</li><li>è€ŒèŠ‚ç‚¹ä¸­é—´çš„ä¼ é€’é€šè¿‡Â <code>Abstract ChannelHandlerContext</code>Â ç±»å†…éƒ¨çš„Â <code>fire</code>Â ç³»åˆ—æ–¹æ³•ï¼Œæ‰¾åˆ°å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸æ–­çš„å¾ªç¯ä¼ æ’­ã€‚æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨å½¢å¼å®Œæˆå¯¹Â <code>handler</code>Â çš„è°ƒåº¦</li></ol><h2 id="10-6-Netty-å¿ƒè·³-heartbeat-æœåŠ¡æºç å‰–æ"><strong>10.6 Netty å¿ƒè·³(heartbeat)æœåŠ¡æºç å‰–æ</strong></h2><h3 id="10-6-1-æºç å‰–æç›®çš„"><strong>10.6.1 æºç å‰–æç›®çš„</strong></h3><p><code>Netty</code>Â ä½œä¸ºä¸€ä¸ªç½‘ç»œæ¡†æ¶ï¼Œæä¾›äº†è¯¸å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚ç¼–ç è§£ç ç­‰ï¼Œ<code>Netty</code>Â è¿˜æä¾›äº†éå¸¸é‡è¦çš„ä¸€ä¸ªæœåŠ¡ â€“ å¿ƒè·³æœºåˆ¶Â <code>heartbeat</code>ã€‚é€šè¿‡å¿ƒè·³æ£€æŸ¥å¯¹æ–¹æ˜¯å¦æœ‰æ•ˆï¼Œè¿™æ˜¯Â <code>RPC</code>Â æ¡†æ¶ä¸­æ˜¯å¿…ä¸å¯å°‘çš„åŠŸèƒ½ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹Â <code>Netty</code>Â å†…éƒ¨å¿ƒè·³æœåŠ¡æºç å®ç°ã€‚</p><h3 id="10-6-2-æºç å‰–æ"><strong>10.6.2 æºç å‰–æ</strong></h3><p>è¯´æ˜</p><p><code>Netty</code>Â æä¾›äº†Â <code>IdleStateHandler</code>ï¼Œ<code>ReadTimeoutHandler</code>ï¼Œ<code>WriteTimeoutHandler</code>Â ä¸‰ä¸ªÂ <code>Handler</code>Â æ£€æµ‹è¿æ¥çš„æœ‰æ•ˆæ€§ï¼Œé‡ç‚¹åˆ†æÂ <code>IdleStateHandler</code>ã€‚</p><p>å¦‚å›¾</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_14.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_14.png"></p><p>æºç å‰–æï¼š</p><p>5.<code>Netty</code>Â æä¾›çš„å¿ƒè·³ä»‹ç»</p><p>1)<code>Netty</code>Â æä¾›äº†Â <code>IdleStateHandler</code>ï¼Œ<code>ReadTimeoutHandler</code>ï¼Œ<code>WriteTimeoutHandler</code>Â ä¸‰ä¸ªÂ <code>Handler</code>Â æ£€æµ‹è¿æ¥çš„æœ‰æ•ˆæ€§ã€‚</p><p>2)å¦‚å›¾</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_15.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_15.png"></p><p>3)<code>ReadTimeout</code>Â äº‹ä»¶å’ŒÂ <code>WriteTimeout</code>Â äº‹ä»¶éƒ½ä¼šè‡ªåŠ¨å…³é—­è¿æ¥ï¼Œè€Œä¸”ï¼Œå±äºå¼‚å¸¸å¤„ç†ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œåªæ˜¯ä»‹ç»ä»¥ä¸‹ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹Â <code>IdleStateHandler</code>ã€‚</p><p>6.<code>IdleStateHandler</code>Â åˆ†æ</p><p>6.1Â <code>4</code>Â ä¸ªå±æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private final boolean observeOutput; //æ˜¯å¦è€ƒè™‘å‡ºç«™æ—¶è¾ƒæ…¢çš„æƒ…å†µã€‚é»˜è®¤å€¼æ˜¯ false</span><br><span class="line"></span><br><span class="line">private final long readerIdleTimeNanos; //è¯»äº‹ä»¶ç©ºé—²æ—¶é—´ï¼Œ0 åˆ™ç¦ç”¨äº‹ä»¶</span><br><span class="line"></span><br><span class="line">private final long writerIdleTimeNanos;//å†™äº‹ä»¶ç©ºé—²æ—¶é—´ï¼Œ0 åˆ™ç¦ç”¨äº‹ä»¶</span><br><span class="line"></span><br><span class="line">private final long allIdleTimeNanos;//è¯»æˆ–å†™ç©ºé—²æ—¶é—´ï¼Œ0 åˆ™ç¦ç”¨äº‹ä»¶Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>6.2<code>handlerAdded</code>Â æ–¹æ³•</p><p>å½“è¯¥Â <code>handler</code>Â è¢«æ·»åŠ åˆ°Â <code>pipeline</code>Â ä¸­æ—¶ï¼Œåˆ™è°ƒç”¨Â <code>initialize</code>Â æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">private void initialize(ChannelHandlerContext ctx) &#123;</span><br><span class="line">    //Avoid the case where destroy() is called before scheduling timeouts.</span><br><span class="line">    //See:https://github.com/netty/netty/issues/143</span><br><span class="line">    switch(state) &#123;</span><br><span class="line">        case1:</span><br><span class="line">        case2:</span><br><span class="line">            return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state=1;</span><br><span class="line">    initOutputChanged(ctx);</span><br><span class="line"></span><br><span class="line">    lastReadTime = lastWriteTime = ticksInNanos();</span><br><span class="line"></span><br><span class="line">    if(readerIdleTimeNanos &gt; 0) &#123;</span><br><span class="line">        //è¿™é‡Œçš„ schedule æ–¹æ³•ä¼šè°ƒç”¨ eventLoop çš„ schedule æ–¹æ³•ï¼Œå°†å®šæ—¶ä»»åŠ¡æ·»åŠ è¿›é˜Ÿåˆ—ä¸­</span><br><span class="line">        readerIdleTimeout = schedule(ctx, new ReaderIdleTimeoutTask(ctx), readerIdleTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(writerIdleTimeNanos &gt; 0) &#123;</span><br><span class="line">        writerIdleTimeout = schedule(ctx, new WriterIdleTimeoutTask(ctx), writerIdleTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(allIdleTimeNanos &gt; 0) &#123;</span><br><span class="line">        allIdleTimeout = schedule(ctx, new AllIdleTimeoutTask(ctx), allIdleTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>åªè¦ç»™å®šçš„å‚æ•°å¤§äºÂ <code>0</code>ï¼Œå°±åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯ä¸ªäº‹ä»¶éƒ½åˆ›å»ºã€‚åŒæ—¶ï¼Œå°†Â <code>state</code>Â çŠ¶æ€è®¾ç½®ä¸ºÂ <code>1</code>ï¼Œé˜²æ­¢é‡å¤åˆå§‹åŒ–ã€‚è°ƒç”¨Â <code>initOutputChanged</code>Â æ–¹æ³•ï¼Œåˆå§‹åŒ–â€œç›‘æ§å‡ºç«™æ•°æ®å±æ€§â€ã€‚</p><p>6.3è¯¥ç±»å†…éƒ¨çš„Â <code>3</code>Â ä¸ªå®šæ—¶ä»»åŠ¡ç±»</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_16.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_16.png"></p><p>1)è¿™Â <code>3</code>Â ä¸ªå®šæ—¶ä»»åŠ¡åˆ†åˆ«å¯¹åº”è¯»ï¼Œå†™ï¼Œè¯»æˆ–è€…å†™äº‹ä»¶ã€‚å…±æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼ˆ<code>AbstractIdleTask</code>ï¼‰ã€‚è¿™ä¸ªçˆ¶ç±»æä¾›äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private abstract static class AbstractIdleTask implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    private final ChannelHandlerContext ctx;</span><br><span class="line"></span><br><span class="line">    AbstractIdleTask(ChannelHandlerContext ctx) &#123;</span><br><span class="line">        this.ctx = ctx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        if(!ctx.channel().isOpen()) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        run(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected abstract void run(ChannelHandlerContext ctx);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå½“é€šé“å…³é—­äº†ï¼Œå°±ä¸æ‰§è¡Œä»»åŠ¡äº†ã€‚åä¹‹ï¼Œæ‰§è¡Œå­ç±»çš„Â <code>run</code>Â æ–¹æ³•</p><p>7.è¯»äº‹ä»¶çš„Â <code>run</code>Â æ–¹æ³•ï¼ˆå³Â <code>ReaderIdleTimeoutTask</code>Â çš„Â <code>run</code>Â æ–¹æ³•ï¼‰åˆ†æ</p><p>1)ä»£ç åŠå…¶è¯´æ˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void run(ChannelHandlerContext ctx) &#123;</span><br><span class="line">    long nextDelay = readerIdleTimeNanos;</span><br><span class="line">    if(!reading) &#123;</span><br><span class="line">        nextDelay -= ticksInNanos() - lastReadTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(nextDelay &lt;= 0) &#123;</span><br><span class="line">        //Reader is idle-set a new timeout and notify the callback.</span><br><span class="line">        //ç”¨äºå–æ¶ˆä»»åŠ¡ promise</span><br><span class="line">        readerIdleTimeout = schedule(ctx, this, readerIdleTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line">        boolean first = firstReaderIdleEvent;</span><br><span class="line">        firstReaderIdleEvent = false;</span><br><span class="line">        try &#123;</span><br><span class="line">            //å†æ¬¡æäº¤ä»»åŠ¡</span><br><span class="line">            IdleStateEvent event = new IdleStateEvent(IdleState.READER_IDLE, first);</span><br><span class="line">            //è§¦å‘ç”¨æˆ· handler use</span><br><span class="line">            channelIdle(ctx, event);</span><br><span class="line">        &#125; catch (Throwable t) &#123;</span><br><span class="line">            ctx.fireExceptionCaught(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //Read occurred before the timeout - set a new timeout with shorter delay.</span><br><span class="line">        readerIdleTimeout = schedule(ctx, this, nextDelay, TimeUnit.NANOSECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>1)å¾—åˆ°ç”¨æˆ·è®¾ç½®çš„è¶…æ—¶æ—¶é—´ã€‚</p><p>2)å¦‚æœè¯»å–æ“ä½œç»“æŸäº†ï¼ˆæ‰§è¡Œäº†Â <code>channelReadComplete</code>Â æ–¹æ³•è®¾ç½®ï¼‰ï¼Œå°±ç”¨å½“å‰æ—¶é—´å‡å»ç»™å®šæ—¶é—´å’Œæœ€åä¸€æ¬¡è¯»ï¼ˆæ‰§æ“ä½œçš„æ—¶é—´è¡Œäº†Â <code>channelReadComplete</code>Â æ–¹æ³•è®¾ç½®ï¼‰ï¼Œå¦‚æœå°äºÂ <code>0</code>ï¼Œå°±è§¦å‘äº‹ä»¶ã€‚åä¹‹ï¼Œç»§ç»­æ”¾å…¥é˜Ÿåˆ—ã€‚é—´éš”æ—¶é—´æ˜¯æ–°çš„è®¡ç®—æ—¶é—´ã€‚</p><p>3)è§¦å‘çš„é€»è¾‘æ˜¯ï¼šé¦–å…ˆå°†ä»»åŠ¡å†æ¬¡æ”¾åˆ°é˜Ÿåˆ—ï¼Œæ—¶é—´æ˜¯åˆšå¼€å§‹è®¾ç½®çš„æ—¶é—´ï¼Œè¿”å›ä¸€ä¸ªÂ <code>promise</code>Â å¯¹è±¡ï¼Œç”¨äºåšå–æ¶ˆæ“ä½œã€‚ç„¶åï¼Œè®¾ç½®Â <code>first</code>Â å±æ€§ä¸º<code>false</code>ï¼Œè¡¨ç¤ºï¼Œä¸‹ä¸€æ¬¡è¯»å–ä¸å†æ˜¯ç¬¬ä¸€æ¬¡äº†ï¼Œè¿™ä¸ªå±æ€§åœ¨Â <code>channelRead</code>Â æ–¹æ³•ä¼šè¢«æ”¹æˆÂ <code>true</code>ã€‚</p><p>4)åˆ›å»ºä¸€ä¸ªÂ <code>IdleStateEvent</code>Â ç±»å‹çš„å†™äº‹ä»¶å¯¹è±¡ï¼Œå°†æ­¤å¯¹è±¡ä¼ é€’ç»™ç”¨æˆ·çš„Â <code>UserEventTriggered</code>Â æ–¹æ³•ã€‚å®Œæˆè§¦å‘äº‹ä»¶çš„æ“ä½œã€‚</p><p>5)æ€»çš„æ¥è¯´ï¼Œæ¯æ¬¡è¯»å–æ“ä½œéƒ½ä¼šè®°å½•ä¸€ä¸ªæ—¶é—´ï¼Œå®šæ—¶ä»»åŠ¡æ—¶é—´åˆ°äº†ï¼Œä¼šè®¡ç®—å½“å‰æ—¶é—´å’Œæœ€åä¸€æ¬¡è¯»çš„æ—¶é—´çš„é—´éš”ï¼Œå¦‚æœé—´éš”è¶…è¿‡äº†è®¾ç½®çš„æ—¶é—´ï¼Œå°±è§¦å‘Â <code>UserEventTriggered</code>Â æ–¹æ³•ã€‚//å‰é¢ä»‹ç»Â <code>IdleStateHandler</code>Â è¯´è¿‡,å¯ä»¥çœ‹ä¸€ä¸‹</p><p>8.å†™äº‹ä»¶çš„Â <code>run</code>Â æ–¹æ³•ï¼ˆå³Â <code>WriterIdleTimeoutTask</code>Â çš„Â <code>run</code>Â æ–¹æ³•ï¼‰åˆ†æ</p><p>1)<code>run</code>Â ä»£ç å’Œåˆ†æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void run(ChannelHandlerContext ctx) &#123;</span><br><span class="line">    long lastWriteTime = IdleStateHandler.this.lastWriteTime;</span><br><span class="line">    long nextDelay = writerIdleTimeNanos - (ticksInNanos()-lastWriteTime);</span><br><span class="line">    if (nextDelay &lt;=0 ) &#123;</span><br><span class="line">        //Writer is idle - set a new timeout and notify the callback.</span><br><span class="line">        writerIdleTimeout = schedule(ctx, this, writerIdleTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line">        boolean first = firstWriterIdleEvent;</span><br><span class="line">        firstWriterIdleEvent = false;</span><br><span class="line">        try &#123;</span><br><span class="line">            if(hasOutputChanged(ctx, first)) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            IdleStateEvent event = new IdleStateEvent(IdleState.WRITER_IDLE, first);</span><br><span class="line">            channelIdle(ctx, event);</span><br><span class="line">        &#125; catch (Throwable t) &#123;</span><br><span class="line">            ctx.fireExceptionCaught(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //Write occurred before the timeout - set a new timeout with shorter delay.</span><br><span class="line">        writerIdleTimeout = schedule(ctx, this, nextDelay, TimeUnit.NANOSECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå†™ä»»åŠ¡çš„Â <code>run</code>Â ä»£ç é€»è¾‘åŸºæœ¬å’Œè¯»ä»»åŠ¡çš„é€»è¾‘ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯æœ‰ä¸€ä¸ªé’ˆå¯¹å‡ºç«™è¾ƒæ…¢æ•°æ®çš„åˆ¤æ–­Â <code>hasOutputChanged</code></p><p>9.æ‰€æœ‰äº‹ä»¶çš„Â <code>run</code>Â æ–¹æ³•ï¼ˆå³Â <code>AllIdleTimeoutTask</code>Â çš„Â <code>run</code>Â æ–¹æ³•ï¼‰åˆ†æ</p><p>ä»£ç åˆ†æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void run(ChannelHandlerContext ctx) &#123;</span><br><span class="line">    long nextDelay = allIdleTimeNanos;</span><br><span class="line">    if(!reading) &#123;</span><br><span class="line">        nextDelay -= ticksInNanos() - Math.max(lastReadTime, lastWriteTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(nextDelay &lt;= 0) &#123;</span><br><span class="line">        //Both reader and writer are idle - set a new timeout and</span><br><span class="line">        //notify the callback.</span><br><span class="line">        allIdleTimeout = schedule(ctx, this, allIdleTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line">        boolean first = firstAllIdleEvent;</span><br><span class="line">        firstAllIdleEvent = false;</span><br><span class="line">        try &#123;</span><br><span class="line">            if(hasOutputChanged(ctx, first)) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            IdleStateEvent event = new IdleStateEvent(IdleState.ALL_IDLE, first);</span><br><span class="line">            channelIdle(ctx, event);</span><br><span class="line">        &#125; catch(Throwable t) &#123;</span><br><span class="line">            ctx.fireExceptionCaught(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //Either read or write occurred before the timeout - set a new</span><br><span class="line">        //timeout with shorter delay.</span><br><span class="line">        allIdleTimeout = schedule(ctx, this, nextDelay, TimeUnit.NANOSECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>1)è¡¨ç¤ºè¿™ä¸ªç›‘æ§ç€æ‰€æœ‰çš„äº‹ä»¶ã€‚å½“è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéƒ½ä¼šè®°å½•ã€‚ä»£ç é€»è¾‘å’Œå†™äº‹ä»¶çš„çš„åŸºæœ¬ä¸€è‡´ï¼š</p><p>2)éœ€è¦å¤§å®¶æ³¨æ„çš„åœ°æ–¹æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">long nextDelay = allIdleTimeNanos;</span><br><span class="line">if(!reading) &#123;</span><br><span class="line">    //å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡å†™æˆ–è¯»çš„æ—¶é—´ï¼Œè‹¥å¤§äº 0ï¼Œè¯´æ˜è¶…æ—¶äº†</span><br><span class="line">    nextDelay -= ticksInNanos() - Math.max(lastReadTime, lastWriteTime);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>3)è¿™é‡Œçš„æ—¶é—´è®¡ç®—æ˜¯å–è¯»å†™äº‹ä»¶ä¸­çš„æœ€å¤§å€¼æ¥çš„ã€‚ç„¶ååƒå†™äº‹ä»¶ä¸€æ ·ï¼Œåˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†å†™çš„æ…¢çš„æƒ…å†µã€‚</p><p>10.å°ç»“Â <code>Netty</code>Â çš„å¿ƒè·³æœºåˆ¶</p><p>1)<code>IdleStateHandler</code>Â å¯ä»¥å®ç°å¿ƒè·³åŠŸèƒ½ï¼Œå½“æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•è¯»å†™äº¤äº’æ—¶ï¼Œå¹¶è¶…è¿‡äº†ç»™å®šçš„æ—¶é—´ï¼Œåˆ™ä¼šè§¦å‘ç”¨æˆ·Â <code>handler</code>Â çš„Â <code>userEventTriggered</code>Â æ–¹æ³•ã€‚ç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°è¯•å‘å¯¹æ–¹å‘é€ä¿¡æ¯ï¼Œå¦‚æœå‘é€å¤±è´¥ï¼Œåˆ™å…³é—­è¿æ¥ã€‚</p><p>2)<code>IdleStateHandler</code>Â çš„å®ç°åŸºäºÂ <code>EventLoop</code>Â çš„å®šæ—¶ä»»åŠ¡ï¼Œæ¯æ¬¡è¯»å†™éƒ½ä¼šè®°å½•ä¸€ä¸ªå€¼ï¼Œåœ¨å®šæ—¶ä»»åŠ¡è¿è¡Œçš„æ—¶å€™ï¼Œé€šè¿‡è®¡ç®—å½“å‰æ—¶é—´å’Œè®¾ç½®æ—¶é—´å’Œä¸Šæ¬¡äº‹ä»¶å‘ç”Ÿæ—¶é—´çš„ç»“æœï¼Œæ¥åˆ¤æ–­æ˜¯å¦ç©ºé—²ã€‚</p><p>3)å†…éƒ¨æœ‰Â <code>3</code>Â ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåˆ†åˆ«å¯¹åº”è¯»äº‹ä»¶ï¼Œå†™äº‹ä»¶ï¼Œè¯»å†™äº‹ä»¶ã€‚é€šå¸¸ç”¨æˆ·ç›‘å¬è¯»å†™äº‹ä»¶å°±è¶³å¤Ÿäº†ã€‚</p><p>4)åŒæ—¶ï¼Œ<code>IdleStateHandler</code>Â å†…éƒ¨ä¹Ÿè€ƒè™‘äº†ä¸€äº›æç«¯æƒ…å†µï¼šå®¢æˆ·ç«¯æ¥æ”¶ç¼“æ…¢ï¼Œä¸€æ¬¡æ¥æ”¶æ•°æ®çš„é€Ÿåº¦è¶…è¿‡äº†è®¾ç½®çš„ç©ºé—²æ—¶é—´ã€‚<code>Netty</code>Â é€šè¿‡æ„é€ æ–¹æ³•ä¸­çš„Â <code>observeOutput</code>Â å±æ€§æ¥å†³å®šæ˜¯å¦å¯¹å‡ºç«™ç¼“å†²åŒºçš„æƒ…å†µè¿›è¡Œåˆ¤æ–­ã€‚</p><p>5)å¦‚æœå‡ºç«™ç¼“æ…¢ï¼Œ<code>Netty</code>Â ä¸è®¤ä¸ºè¿™æ˜¯ç©ºé—²ï¼Œä¹Ÿå°±ä¸è§¦å‘ç©ºé—²äº‹ä»¶ã€‚ä½†ç¬¬ä¸€æ¬¡æ— è®ºå¦‚ä½•ä¹Ÿæ˜¯è¦è§¦å‘çš„ã€‚å› ä¸ºç¬¬ä¸€æ¬¡æ— æ³•åˆ¤æ–­æ˜¯å‡ºç«™ç¼“æ…¢è¿˜æ˜¯ç©ºé—²ã€‚å½“ç„¶ï¼Œå‡ºç«™ç¼“æ…¢çš„è¯ï¼Œå¯èƒ½é€ æˆÂ <code>OOM</code>ï¼Œ<code>OOM</code>Â æ¯”ç©ºé—²çš„é—®é¢˜æ›´å¤§ã€‚</p><p>6)æ‰€ä»¥ï¼Œå½“ä½ çš„åº”ç”¨å‡ºç°äº†å†…å­˜æº¢å‡ºï¼Œ<code>OOM</code>Â ä¹‹ç±»ï¼Œå¹¶ä¸”å†™ç©ºé—²æå°‘å‘ç”Ÿï¼ˆä½¿ç”¨äº†Â <code>observeOutput</code>Â ä¸ºÂ <code>true</code>ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦æ³¨æ„æ˜¯ä¸æ˜¯æ•°æ®å‡ºç«™é€Ÿåº¦è¿‡æ…¢ã€‚</p><p>7)è¿˜æœ‰ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹ï¼šå°±æ˜¯Â <code>ReadTimeoutHandler</code>ï¼Œå®ƒç»§æ‰¿è‡ªÂ <code>IdleStateHandler</code>ï¼Œå½“è§¦å‘è¯»ç©ºé—²äº‹ä»¶çš„æ—¶å€™ï¼Œå°±è§¦å‘Â <code>ctx</code>.Â <code>fireExceptionCaught</code>Â æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªÂ <code>ReadTimeoutException</code>ï¼Œç„¶åå…³é—­Â <code>Socket</code>ã€‚</p><p>8)è€ŒÂ <code>WriteTimeoutHandler</code>Â çš„å®ç°ä¸æ˜¯åŸºäºÂ <code>IdleStateHandler</code>Â çš„ï¼Œä»–çš„åŸç†æ˜¯ï¼Œå½“è°ƒç”¨Â <code>write</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä»»åŠ¡å†…å®¹æ˜¯æ ¹æ®ä¼ å…¥çš„Â <code>promise</code>Â çš„å®Œæˆæƒ…å†µæ¥åˆ¤æ–­æ˜¯å¦è¶…å‡ºäº†å†™çš„æ—¶é—´ã€‚å½“å®šæ—¶ä»»åŠ¡æ ¹æ®æŒ‡å®šæ—¶é—´å¼€å§‹è¿è¡Œï¼Œå‘ç°Â <code>promise</code>Â çš„Â <code>isDone</code>Â æ–¹æ³•è¿”å›Â <code>false</code>ï¼Œè¡¨æ˜è¿˜æ²¡æœ‰å†™å®Œï¼Œè¯´æ˜è¶…æ—¶äº†ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚å½“Â <code>write</code>Â æ–¹æ³•å®Œæˆåï¼Œä¼šæ‰“æ–­å®šæ—¶ä»»åŠ¡ã€‚</p><h2 id="10-7-Netty-æ ¸å¿ƒç»„ä»¶-EventLoop-æºç å‰–æ"><strong>10.7 Netty æ ¸å¿ƒç»„ä»¶ EventLoop æºç å‰–æ</strong></h2><h3 id="10-7-1-æºç å‰–æç›®çš„"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter10?id=_1071-%e6%ba%90%e7%a0%81%e5%89%96%e6%9e%90%e7%9b%ae%e7%9a%84"><strong>10.7.1 æºç å‰–æç›®çš„</strong></a></h3><p><code>Echo</code>Â ç¬¬ä¸€è¡Œä»£ç å°±æ˜¯ï¼š<code>EventLoopGroup bossGroup = new NioEventLoopGroup(1)</code>; ä¸‹é¢åˆ†æå…¶æœ€æ ¸å¿ƒçš„ç»„ä»¶Â <code>EventLoop</code>ã€‚</p><h3 id="10-7-2-æºç å‰–æ"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter10?id=_1072-%e6%ba%90%e7%a0%81%e5%89%96%e6%9e%90"><strong>10.7.2 æºç å‰–æ</strong></a></h3><p>æºç å‰–æ</p><p>1.<code>EventLoop</code>ä»‹ç» 1.1é¦–å…ˆçœ‹çœ‹Â <code>NioEventLoop</code>Â çš„ç»§æ‰¿å›¾</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_17.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_17.png"></p><p>è¯´æ˜é‡ç‚¹ï¼š 1)<code>ScheduledExecutorService</code>Â æ¥å£è¡¨ç¤ºæ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥å£ï¼Œ<code>EventLoop</code>Â å¯ä»¥æ¥å—å®šæ—¶ä»»åŠ¡ã€‚</p><p>2)<code>EventLoop</code>Â æ¥å£ï¼š<code>Netty</code>Â æ¥å£æ–‡æ¡£è¯´æ˜è¯¥æ¥å£ä½œç”¨ï¼šä¸€æ—¦Â <code>Channel</code>Â æ³¨å†Œäº†ï¼Œå°±å¤„ç†è¯¥Â <code>Channel</code>Â å¯¹åº”çš„æ‰€æœ‰Â <code>I/O</code>Â æ“ä½œã€‚</p><p>3)<code>SingleThreadEventExecutor</code>Â è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </p><p>4)<code>EventLoop</code>Â æ˜¯ä¸€ä¸ªå•ä¾‹çš„çº¿ç¨‹æ± ï¼Œé‡Œé¢å«æœ‰ä¸€ä¸ªæ­»å¾ªç¯çš„çº¿ç¨‹ä¸æ–­çš„åšç€Â <code>3</code>Â ä»¶äº‹æƒ…ï¼šç›‘å¬ç«¯å£ï¼Œå¤„ç†ç«¯å£äº‹ä»¶ï¼Œå¤„ç†é˜Ÿåˆ—äº‹ä»¶ã€‚æ¯ä¸ªÂ <code>EventLoop</code>Â éƒ½å¯ä»¥ç»‘å®šå¤šä¸ªÂ <code>Channel</code>ï¼Œè€Œæ¯ä¸ªÂ <code>Channel</code>Â å§‹ç»ˆåªèƒ½ç”±ä¸€ä¸ªÂ <code>EventLoop</code>Â æ¥å¤„ç†</p><ol><li><code>NioEventLoop</code>Â çš„ä½¿ç”¨ -Â <code>execute</code>Â æ–¹æ³•</li></ol><p>2.1Â <code>execute</code>Â æºç å‰–æ</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_18.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_18.png"></p><p>åœ¨Â <code>EventLoop</code>Â çš„ä½¿ç”¨ï¼Œä¸€èˆ¬å°±æ˜¯Â <code>eventloop.execute(task);</code>Â çœ‹ä¸‹Â <code>execute</code>Â æ–¹æ³•çš„å®ç°(åœ¨Â <code>SingleThreadEventExecutor</code>Â ç±»ä¸­)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void execute(Runnable task) &#123;</span><br><span class="line">    if(task == null) &#123;</span><br><span class="line">        throw new NullPointerException(&quot;task&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    boolean inEventLoop = inEventLoop();</span><br><span class="line">    if(inEventLoop) &#123;</span><br><span class="line">        addTask(task);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        startThread();</span><br><span class="line">        addTask(task);</span><br><span class="line">        if(isShutdown() &amp;&amp; removeTask(task)) &#123;</span><br><span class="line">            reject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!addTaskWakesUp&amp;&amp;wakesUpForTask(task)) &#123;</span><br><span class="line">        wakeup(inEventLoop);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜: 1)é¦–å…ˆåˆ¤æ–­è¯¥Â <code>EventLoop</code>Â çš„çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å»ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å°è¯•å¯åŠ¨çº¿ç¨‹ï¼ˆä½†ç”±äºçº¿ç¨‹æ˜¯å•ä¸ªçš„ï¼Œå› æ­¤åªèƒ½å¯åŠ¨ä¸€æ¬¡ï¼‰ï¼Œéšåå†å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å»ã€‚</p><p>2)å¦‚æœçº¿ç¨‹å·²ç»åœæ­¢ï¼Œå¹¶ä¸”åˆ é™¤ä»»åŠ¡å¤±è´¥ï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼Œé»˜è®¤æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>3)å¦‚æœÂ <code>addTaskWakesUp</code>Â æ˜¯Â <code>false</code>ï¼Œå¹¶ä¸”ä»»åŠ¡ä¸æ˜¯Â <code>NonWakeupRunnable</code>Â ç±»å‹çš„ï¼Œå°±å°è¯•å”¤é†’Â <code>selector</code>ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé˜»å¡åœ¨Â <code>selecor</code>çš„çº¿ç¨‹å°±ä¼šç«‹å³è¿”å›</p><p>4)å¯ä»¥ä¸‹æ–­ç‚¹æ¥è¿½è¸ª</p><p>2.2æˆ‘ä»¬Â <code>debugaddTask</code>Â å’ŒÂ <code>offerTask</code>Â æ–¹æ³•æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">protected void addTask(Runnable task) &#123;</span><br><span class="line">    if(task == null) &#123;</span><br><span class="line">        throw new NullPointerException(&quot;task&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!offerTask(task)) &#123;</span><br><span class="line">        reject(task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final boolean offerTask(Runnable task) &#123;</span><br><span class="line">    if(isShutdown()) &#123;</span><br><span class="line">        reject();</span><br><span class="line">    &#125;</span><br><span class="line">    return taskQueue.offer(task);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>3.<code>NioEventLoop</code>Â çš„çˆ¶ç±»Â <code>SingleThreadEventExecutor</code>Â çš„Â <code>startThread</code>Â æ–¹æ³• 3.1å½“æ‰§è¡ŒÂ <code>execute</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯Â <code>EventLoop</code>Â æ‰€å±çº¿ç¨‹ï¼Œåˆ™å°è¯•å¯åŠ¨çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯Â <code>startThread</code>Â æ–¹æ³•ï¼Œdubug ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private void startThread() &#123;</span><br><span class="line">    if(state == ST_NOT_STARTED) &#123;</span><br><span class="line">        if(STATE_UPDATER.compareAndSet(this, ST_NOT_STARTED, ST_STARTED)) &#123;</span><br><span class="line">            try&#123;</span><br><span class="line">                doStartThread();</span><br><span class="line">            &#125; catch(Throwable cause) &#123;</span><br><span class="line">                STATE_UPDATER.set(this, ST_NOT_STARTED);</span><br><span class="line">                PlatformDependent.throwException(cause);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜:è¯¥æ–¹æ³•é¦–å…ˆåˆ¤æ–­æ˜¯å¦å¯åŠ¨è¿‡äº†ï¼Œä¿è¯Â <code>EventLoop</code>Â åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨è¿‡ï¼Œåˆ™å°è¯•ä½¿ç”¨Â <code>Cas</code>Â å°†Â <code>state</code>Â çŠ¶æ€æ”¹ä¸ºÂ <code>ST_STARTED</code>ï¼Œä¹Ÿå°±æ˜¯å·²å¯åŠ¨ã€‚ç„¶åè°ƒç”¨Â <code>doStartThread</code>Â æ–¹æ³•ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿›è¡Œå›æ»š</p><p>çœ‹ä¸‹Â <code>doStartThread</code>Â æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">private void doStartThread() &#123;</span><br><span class="line">    executor.execute(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            boolean success = false;</span><br><span class="line">            updateLastExecutionTime();</span><br><span class="line">            try&#123;</span><br><span class="line">                SingleThreadEventExecutor.this.run();</span><br><span class="line">                success=true;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                for( ; ; ) &#123;</span><br><span class="line">                    intoldState = state;</span><br><span class="line">                    if(oldState &gt;= ST_SHUTTING_DOWN || STATE_UPDATER.compareAndSet(SingleThreadEventExecutor.this, oldState, ST_SHUTTING_DOWN)) &#123;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                try &#123;</span><br><span class="line">                    for( ; ; ) &#123;</span><br><span class="line">                        if(confirmShutdown()) &#123;</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        cleanup();</span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line">                        STATE_UPDATER.set(SingleThreadEventExecutor.this,ST_TERMINATED);</span><br><span class="line">                        threadLock.release();</span><br><span class="line">                        terminationFuture.setSuccess(null);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š 1)é¦–å…ˆè°ƒç”¨Â <code>executor</code>Â çš„Â <code>execute</code>Â æ–¹æ³•ï¼Œè¿™ä¸ªÂ <code>executor</code>Â å°±æ˜¯åœ¨åˆ›å»ºÂ <code>EventLoopGroup</code>Â çš„æ—¶å€™åˆ›å»ºçš„Â <code>ThreadPerTaskExecutor</code>Â ç±»ã€‚è¯¥Â <code>execute</code>Â æ–¹æ³•ä¼šå°†Â <code>Runnable</code>Â åŒ…è£…æˆÂ <code>Netty</code>Â çš„Â <code>FastThreadLocalThread</code>ã€‚</p><p>2)ä»»åŠ¡ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­çº¿ç¨‹ä¸­æ–­çŠ¶æ€ï¼Œç„¶åè®¾ç½®æœ€åä¸€æ¬¡çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>3)æ‰§è¡Œå½“å‰Â <code>NioEventLoop</code>Â çš„Â <code>run</code>Â æ–¹æ³•ï¼Œæ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œæ˜¯æ•´ä¸ªÂ <code>EventLoop</code>Â çš„æ ¸å¿ƒ</p><p>4)åœ¨Â <code>finally</code>Â å—ä¸­ï¼Œä½¿ç”¨Â <code>CAS</code>Â ä¸æ–­ä¿®æ”¹Â <code>state</code>Â çŠ¶æ€ï¼Œæ”¹æˆÂ <code>ST_SHUTTING_DOWN</code>ã€‚ä¹Ÿå°±æ˜¯å½“çº¿ç¨‹Â <code>Loop</code>Â ç»“æŸçš„æ—¶å€™ã€‚å…³é—­çº¿ç¨‹ã€‚æœ€åè¿˜è¦æ­»å¾ªç¯ç¡®è®¤æ˜¯å¦å…³é—­ï¼Œå¦åˆ™ä¸ä¼šÂ <code>break</code>ã€‚ç„¶åï¼Œæ‰§è¡ŒÂ <code>cleanup</code>Â æ“ä½œï¼Œæ›´æ–°çŠ¶æ€ä¸º</p><p>5)<code>ST_TERMINATED</code>ï¼Œå¹¶é‡Šæ”¾å½“å‰çº¿ç¨‹é”ã€‚å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸æ˜¯ç©ºï¼Œåˆ™æ‰“å°é˜Ÿåˆ—ä¸­è¿˜æœ‰å¤šå°‘ä¸ªæœªå®Œæˆçš„ä»»åŠ¡ã€‚å¹¶å›è°ƒÂ <code>terminationFuture</code>Â æ–¹æ³•ã€‚</p><p>6)å…¶å®æœ€æ ¸å¿ƒçš„å°±æ˜¯Â <code>EventLoop</code>Â è‡ªèº«çš„Â <code>run</code>Â æ–¹æ³•ã€‚å†ç»§ç»­æ·±å…¥Â <code>run</code>Â æ–¹æ³•</p><p>4.<code>EventLoop</code>Â ä¸­çš„Â <code>Loop</code>Â æ˜¯é Â <code>run</code>Â å®ç°çš„ï¼Œæˆ‘ä»¬åˆ†æä¸‹Â <code>run</code>Â æ–¹æ³•(è¯¥æ–¹æ³•åœ¨Â <code>NioEventLoop</code>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void run() &#123;</span><br><span class="line">    for( ; ; ) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            switch(selectStrategy.calculateStrategy(selectNowSupplier,hasTasks())) &#123;</span><br><span class="line">                case SelectStrategy.CONTINUE:</span><br><span class="line">                    continue;</span><br><span class="line">                case SelectStrategy.SELECT:</span><br><span class="line">                    select(wakenUp.getAndSet(false));</span><br><span class="line">                    if(wakenUp.get()) &#123;</span><br><span class="line">                        selector.wakeup();</span><br><span class="line">                    &#125;</span><br><span class="line">                default:</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cancelledKeys = 0;</span><br><span class="line">            needsToSelectAgain = false;</span><br><span class="line">            final int ioRatio = this.ioRatio;</span><br><span class="line">            if(ioRatio == 100) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    processSelectedKeys();</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    //Ensure we always run tasks.</span><br><span class="line">                    runAllTasks();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                final long ioStartTime = System.nanoTime();</span><br><span class="line">                try &#123;</span><br><span class="line">                    processSelectedKeys();</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    //Ensure we always runtasks.</span><br><span class="line">                    final long ioTime = System.nanoTime() - ioStartTime;</span><br><span class="line">                    runAllTasks(ioTime * (100 - ioRatio) / ioRatio);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch(Throwable t) &#123;</span><br><span class="line">            handleLoopException(t);</span><br><span class="line">        &#125;</span><br><span class="line">        //Always handle shutdown even if the loop processing threw an exception.</span><br><span class="line">        try &#123;</span><br><span class="line">            if(isShuttingDown()) &#123;</span><br><span class="line">                closeAll();</span><br><span class="line">                if(confirmShutdown()) &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Throwable t) &#123;</span><br><span class="line">            handleLoopException(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜: 1)ä»ä¸Šé¢çš„æ­¥éª¤å¯ä»¥çœ‹å‡ºï¼Œæ•´ä¸ªÂ <code>run</code>Â æ–¹æ³•åšäº†Â <code>3</code>Â ä»¶äº‹æƒ…ï¼šÂ <code>select</code>Â è·å–æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚Â <code>processSelectedKeys</code>Â å¤„ç†äº‹ä»¶ã€‚Â <code>runAllTasks</code>Â æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p><p>2)ä¸Šé¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±è¿½ä¸€ä¸‹Â <code>select</code>Â æ–¹æ³•(ä½“ç°éé˜»å¡)æ ¸å¿ƒÂ <code>select</code>Â æ–¹æ³•è§£æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">private void select(boolean oldWakenUp) throws IOException &#123;</span><br><span class="line">    Selector selector = this.selector;</span><br><span class="line">    try &#123;</span><br><span class="line">        int selectCnt = 0;</span><br><span class="line">        long currentTimeNanos = System.nanoTime();</span><br><span class="line">        long selectDeadLineNanos = currentTimeNanos + delayNanos(currentTimeNanos);</span><br><span class="line">        for( ; ; ) &#123;</span><br><span class="line">            long timeoutMillis = (selectDeadLineNanos - currentTimeNanos + 500000L)/1000000L;</span><br><span class="line">            if(timeoutMillis &lt;= 0) &#123;</span><br><span class="line">                if(selectCnt == 0) &#123;</span><br><span class="line">                    selector.selectNow();</span><br><span class="line">                    selectCnt=1;</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            //If a task was submitted when wakenUp value was true, the task didn&#x27;t get a chance to call</span><br><span class="line">            //Selector#wakeup. So we need to check task queue again before executing select operation.</span><br><span class="line">            //If wedon&#x27;t, the task might be pended until select operation was timedout.</span><br><span class="line">            //It might be pended until idle timeout if IdleStateHandler existed inpipeline.</span><br><span class="line">            if(hasTasks() &amp;&amp; wakenUp.compareAndSet(false, true)) &#123;</span><br><span class="line">                selector.selectNow();</span><br><span class="line">                selectCnt = 1;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            int selectedKeys = selector.select(timeoutMillis);//å¦åˆ™é˜»å¡ç»™å®šæ—¶é—´ï¼Œé»˜è®¤ä¸€ç§’</span><br><span class="line">            selectCnt++;</span><br><span class="line">            //å¦‚æœ 1 ç§’åè¿”å›ï¼Œæœ‰è¿”å›å€¼||selectè¢«ç”¨æˆ·å”¤é†’||ä»»åŠ¡é˜Ÿåˆ—æœ‰ä»»åŠ¡||æœ‰å®šæ—¶ä»»åŠ¡å³å°†è¢«æ‰§è¡Œï¼›åˆ™è·³å‡ºå¾ªç¯</span><br><span class="line">            if(selectedKeys != 0 || oldWakenUp || wakenUp.get() || hasTasks() || hasScheduledTasks()) &#123;</span><br><span class="line">                //-Selected something,</span><br><span class="line">                //-waken up by user,or</span><br><span class="line">                //-the task queue has apending task.</span><br><span class="line">                //-a scheduled task is ready for processing</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if(Thread.interrupted()) &#123;</span><br><span class="line">                //Thread was interrupted so reset selected keys and break so we not run into a busy loop.</span><br><span class="line">                //As this is most likely a bug in the handler of the user or it&#x27;s client library we will</span><br><span class="line">                //also log it.</span><br><span class="line">                //</span><br><span class="line">                //See https://github.com/netty/netty/issues/2426</span><br><span class="line">                if(logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(&quot;Selector.select() returned prematurely because &quot; + &quot; Thread.currentThread().interrupt() was called. Use &quot; + &quot; NioEventLoop.shutdownGracefully() to shutdowntheNioEventLoop.&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                selectCnt = 1;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            long time = System.nanoTime();</span><br><span class="line">            if(time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) &gt;= currentTimeNanos) &#123;</span><br><span class="line">                //timeoutMillis elapsed without any thing selected.</span><br><span class="line">                selectCnt =1;</span><br><span class="line">            &#125; else if(SELECTOR_AUTO_REBUILD_THRESHOLD &gt; 0 &amp;&amp; selectCnt &gt;= SELECTOR_AUTO_REBUILD_THRESHOLD) &#123;</span><br><span class="line">                //The selector returned prematurely many times in a row.</span><br><span class="line">                //Rebuild the selector to work around the problem.</span><br><span class="line">                logger.warn(&quot;Selector.select() returned prematurely &#123;&#125; times in a row; rebuilding Selector &#123;&#125;.&quot;, selectCnt, selector);</span><br><span class="line">                rebuildSelector();</span><br><span class="line">                selector = this.selector;</span><br><span class="line">                //Select again to populate selectedKeys.</span><br><span class="line">                selector.selectNow();</span><br><span class="line">                selectCnt = 1;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            currentTimeNanos = time;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(selectCnt &gt; MIN_PREMATURE_SELECTOR_RETURNS) &#123;</span><br><span class="line">            if(logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(&quot;Selector.select()returned prematurely &#123;&#125; times in a row for Selector&#123;&#125;.&quot;, selectCnt - 1, selector);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (CancelledKeyException e) &#123;</span><br><span class="line">        if(logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(CancelledKeyException.class.getSimpleName() + &quot;raisedbyaSelector &#123;&#125; - JDKbug?&quot;, selector, e);</span><br><span class="line">        &#125;</span><br><span class="line">        //Harmless exception - log anyway</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šè°ƒç”¨Â <code>selector</code>Â çš„Â <code>select</code>Â æ–¹æ³•ï¼Œé»˜è®¤é˜»å¡ä¸€ç§’é’Ÿï¼Œå¦‚æœæœ‰å®šæ—¶ä»»åŠ¡ï¼Œåˆ™åœ¨å®šæ—¶ä»»åŠ¡å‰©ä½™æ—¶é—´çš„åŸºç¡€ä¸Šåœ¨åŠ ä¸ŠÂ <code>0.5</code>Â ç§’è¿›è¡Œé˜»å¡ã€‚å½“æ‰§è¡ŒÂ <code>execute</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æ·»åŠ ä»»åŠ¡çš„æ—¶å€™ï¼Œå”¤é†’Â <code>selector</code>ï¼Œé˜²æ­¢Â <code>selector</code>Â é˜»å¡æ—¶é—´è¿‡é•¿</p><p>5.<code>EventLoop</code>Â ä½œä¸ºÂ <code>Netty</code>Â çš„æ ¸å¿ƒçš„è¿è¡Œæœºåˆ¶å°ç»“</p><p>1)æ¯æ¬¡æ‰§è¡ŒÂ <code>execute</code>Â æ–¹æ³•éƒ½æ˜¯å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ã€‚å½“ç¬¬ä¸€æ¬¡æ·»åŠ æ—¶å°±å¯åŠ¨çº¿ç¨‹ï¼Œæ‰§è¡ŒÂ <code>run</code>Â æ–¹æ³•ï¼Œè€ŒÂ <code>run</code>Â æ–¹æ³•æ˜¯æ•´ä¸ªÂ <code>EventLoop</code>Â çš„æ ¸å¿ƒï¼Œå°±åƒÂ <code>EventLoop</code>Â çš„åå­—ä¸€æ ·ï¼Œ<code>LoopLoop</code>ï¼Œä¸åœçš„Â <code>Loop</code>ï¼Œ<code>Loop</code>Â åšä»€ä¹ˆå‘¢ï¼ŸåšÂ <code>3</code>Â ä»¶äº‹æƒ…ã€‚</p><p>è°ƒç”¨Â <code>selector</code>Â çš„Â <code>select</code>Â æ–¹æ³•ï¼Œé»˜è®¤é˜»å¡ä¸€ç§’é’Ÿï¼Œå¦‚æœæœ‰å®šæ—¶ä»»åŠ¡ï¼Œåˆ™åœ¨å®šæ—¶ä»»åŠ¡å‰©ä½™æ—¶é—´çš„åŸºç¡€ä¸Šåœ¨åŠ ä¸ŠÂ <code>0.5</code>Â ç§’è¿›è¡Œé˜»å¡ã€‚å½“æ‰§è¡ŒÂ <code>execute</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æ·»åŠ ä»»åŠ¡çš„æ—¶å€™ï¼Œå”¤é†’Â <code>selecor</code>ï¼Œé˜²æ­¢Â <code>selector</code>Â é˜»å¡æ—¶é—´è¿‡é•¿ã€‚</p><p>å½“Â <code>selector</code>Â è¿”å›çš„æ—¶å€™ï¼Œå›è°ƒç”¨Â <code>processSelectedKeys</code>Â æ–¹æ³•å¯¹Â <code>selectKey</code>Â è¿›è¡Œå¤„ç†ã€‚</p><p>å½“Â <code>processSelectedKeys</code>Â æ–¹æ³•æ‰§è¡Œç»“æŸåï¼Œåˆ™æŒ‰ç…§Â <code>ioRatio</code>Â çš„æ¯”ä¾‹æ‰§è¡ŒÂ <code>runAllTasks</code>Â æ–¹æ³•ï¼Œé»˜è®¤æ˜¯Â <code>IO</code>Â ä»»åŠ¡æ—¶é—´å’ŒéÂ <code>IO</code>Â ä»»åŠ¡æ—¶é—´æ˜¯ç›¸åŒçš„ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„åº”ç”¨ç‰¹ç‚¹è¿›è¡Œè°ƒä¼˜ã€‚æ¯”å¦‚éÂ <code>IO</code>Â ä»»åŠ¡æ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆä½ å°±å°†</p><p><code>ioRatio</code>Â è°ƒå°ä¸€ç‚¹ï¼Œè¿™æ ·éÂ <code>IO</code>Â ä»»åŠ¡å°±èƒ½æ‰§è¡Œçš„é•¿ä¸€ç‚¹ã€‚é˜²æ­¢é˜Ÿåˆ—ç§¯æ”’è¿‡å¤šçš„ä»»åŠ¡ã€‚</p><h2 id="10-8-handler-ä¸­åŠ å…¥çº¿ç¨‹æ± å’Œ-Context-ä¸­æ·»åŠ çº¿ç¨‹æ± çš„æºç å‰–æ"><strong>10.8 handler ä¸­åŠ å…¥çº¿ç¨‹æ± å’Œ Context ä¸­æ·»åŠ çº¿ç¨‹æ± çš„æºç å‰–æ</strong></h2><h3 id="10-8-1-æºç å‰–æç›®çš„"><strong>10.8.1 æºç å‰–æç›®çš„</strong></h3><ol><li>åœ¨Â <code>Netty</code>Â ä¸­åšè€—æ—¶çš„ï¼Œä¸å¯é¢„æ–™çš„æ“ä½œï¼Œæ¯”å¦‚æ•°æ®åº“ï¼Œç½‘ç»œè¯·æ±‚ï¼Œä¼šä¸¥é‡å½±å“Â <code>Netty</code>Â å¯¹Â <code>Socket</code>Â çš„å¤„ç†é€Ÿåº¦ã€‚</li><li>è€Œè§£å†³æ–¹æ³•å°±æ˜¯å°†è€—æ—¶ä»»åŠ¡æ·»åŠ åˆ°å¼‚æ­¥çº¿ç¨‹æ± ä¸­ã€‚ä½†å°±æ·»åŠ çº¿ç¨‹æ± è¿™æ­¥æ“ä½œæ¥è®²ï¼Œå¯ä»¥æœ‰Â <code>2</code>Â ç§æ–¹å¼ï¼Œè€Œä¸”è¿™Â <code>2</code>Â ç§æ–¹å¼å®ç°çš„åŒºåˆ«ä¹Ÿè›®å¤§çš„ã€‚</li><li>å¤„ç†è€—æ—¶ä¸šåŠ¡çš„ç¬¬ä¸€ç§æ–¹å¼ â€“Â <code>handler</code>Â ä¸­åŠ å…¥çº¿ç¨‹æ± </li><li>å¤„ç†è€—æ—¶ä¸šåŠ¡çš„ç¬¬äºŒç§æ–¹å¼ â€“Â <code>Context</code>Â ä¸­æ·»åŠ çº¿ç¨‹æ± </li><li>æˆ‘ä»¬å°±æ¥åˆ†æä¸‹ä¸¤ç§æ–¹å¼</li></ol><h3 id="10-8-2-æºç å‰–æ"><strong>10.8.2 æºç å‰–æ</strong></h3><p>è¯´æ˜ æ¼”ç¤ºä¸¤ç§æ–¹å¼çš„å®ç°ï¼Œä»¥åŠä»æºç æ¥è¿½è¸ªä¸¤ç§æ–¹å¼æ‰§è¡Œæµç¨‹</p><ol><li>å¤„ç†è€—æ—¶ä¸šåŠ¡çš„ç¬¬ä¸€ç§æ–¹å¼ â€“ handlerç§åŠ å…¥çº¿ç¨‹æ± </li><li>1å¯¹å‰é¢çš„Â <code>Netty</code>Â <code>demo</code>æºç è¿›è¡Œä¿®æ”¹ï¼Œåœ¨Â <code>EchoServerHandler</code>Â çš„Â <code>channelRead</code>Â æ–¹æ³•è¿›è¡Œå¼‚æ­¥</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">@Sharable</span><br><span class="line">public class EchoServerHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    static final EventExecutorGroup group = new DefaultEventExecutorGroup(16);</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) throws UnsupportedEncodingException, InterruptedException &#123;</span><br><span class="line">        final Object msgCop = msg;</span><br><span class="line">        final ChannelHandlerContext cxtCop = ctx;</span><br><span class="line">        group.submit(new Callable&lt;Object&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Object call() throws Exception &#123;</span><br><span class="line">                ByteBuf buf = (ByteBuf)msgCop;</span><br><span class="line">                byte[] req = new byte[buf.readableBytes()];</span><br><span class="line">                buf.readBytes(req);</span><br><span class="line">                String body = new String(req, &quot;UTF-8&quot;);</span><br><span class="line">                Thread.sleep(10 * 1000);</span><br><span class="line">                System.err.println(body + &quot; &quot; + Thread.currentThread().getName());</span><br><span class="line">                String reqString = &quot;Helloiamserver~~~&quot;;</span><br><span class="line">                ByteBuf resp = Unpooled.copiedBuffer(reqString.getBytes());</span><br><span class="line">                cxtCop.writeAndFlush(resp);</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(&quot;goon..&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelReadComplete(ChannelHandlerContext ctx) &#123;</span><br><span class="line">        ctx.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) &#123;</span><br><span class="line">        // Close the connection when an exception is raised.</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š 1)åœ¨Â <code>channelRead</code>Â æ–¹æ³•ï¼Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªè€—æ—¶Â <code>10</code>Â ç§’çš„æ“ä½œï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°†è¿™ä¸ªä»»åŠ¡æäº¤åˆ°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸šåŠ¡çº¿ç¨‹æ± ä¸­ï¼Œè¿™æ ·ï¼Œå°±ä¸ä¼šé˜»å¡Â <code>Netty</code>Â çš„Â <code>IO</code>Â çº¿ç¨‹ã€‚</p><p>11.2è¿™æ ·å¤„ç†ä¹‹åï¼Œæ•´ä¸ªç¨‹åºçš„é€»è¾‘å¦‚å›¾</p><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_19.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter10/chapter10_19.png"></p><p>è¯´æ˜ï¼š</p><p>1)è§£é‡Šä¸€ä¸‹ä¸Šå›¾ï¼Œå½“Â <code>IO</code>Â çº¿ç¨‹è½®è¯¢åˆ°ä¸€ä¸ªÂ <code>socket</code>Â äº‹ä»¶ï¼Œç„¶åï¼Œ<code>IO</code>Â çº¿ç¨‹å¼€å§‹å¤„ç†ï¼Œå½“èµ°åˆ°è€—æ—¶Â <code>handler</code>Â çš„æ—¶å€™ï¼Œå°†è€—æ—¶ä»»åŠ¡äº¤ç»™ä¸šåŠ¡çº¿ç¨‹æ± ã€‚</p><p>2)å½“è€—æ—¶ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†æ‰§è¡ŒÂ <code>pipeline write</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œ(ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯Â <code>context</code>Â çš„Â <code>write</code>Â æ–¹æ³•ï¼Œä¸Šå›¾ç”»çš„æ˜¯æ‰§è¡ŒÂ <code>pipeline</code>Â æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªæ„æ€)ä¼šå°†ä»»åŠ¡è¿™ä¸ªä»»åŠ¡äº¤ç»™Â <code>IO</code>Â çº¿ç¨‹</p><p>11.3Â <code>write</code>Â æ–¹æ³•çš„æºç (åœ¨Â <code>AbstractChannelHandlerContext</code>Â ç±»)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private void write(Object msg, boolean flush, ChannelPromise promise) &#123;</span><br><span class="line">    AbstractChannelHandlerContext next = findContextOutbound();</span><br><span class="line">    final Object m = pipeline.touch(msg, next);</span><br><span class="line">    EventExecutor executor = next.executor();</span><br><span class="line">    if(executor.inEventLoop()) &#123;</span><br><span class="line">        if(flush) &#123;</span><br><span class="line">            next.invokeWriteAndFlush(m, promise);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            next.invokeWrite(m, promise);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        AbstractWriteTask task;</span><br><span class="line">        if(flush) &#123;</span><br><span class="line">            task = WriteAndFlushTask.newInstance(next, m, promise);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            task = WriteTask.newInstance(next, m, promise);</span><br><span class="line">        &#125;</span><br><span class="line">        safeExecute(executor, task, promise, m);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜:</p><p>1)å½“åˆ¤å®šä¸‹ä¸ªÂ <code>outbound</code>Â çš„Â <code>executor</code>Â çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹çš„æ—¶å€™ï¼Œä¼šå°†å½“å‰çš„å·¥ä½œå°è£…æˆÂ <code>task</code>ï¼Œç„¶åæ”¾å…¥Â <code>mpsc</code>Â é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…Â <code>IO</code>Â ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p><p>2)è¿™é‡Œå¯ä»¥ Debug æ¥éªŒè¯(æé†’ï¼šDebug æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ Debug, å®¢æˆ·ç«¯Â <code>Run</code>Â çš„æ–¹å¼)ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äº†Â <code>group.submit(new Callable&lt;Object&gt; ()&#123;&#125;</code>Â åœ¨Â <code>handler</code>Â ä¸­åŠ å…¥çº¿ç¨‹æ± ï¼Œå°±ä¼šè¿›å…¥åˆ°Â <code>safeExecute(executor, task, promise, m);</code>Â å¦‚æœå»æ‰è¿™æ®µä»£ç ï¼Œè€Œä½¿ç”¨æ™®é€šæ–¹å¼æ¥æ‰§è¡Œè€—æ—¶çš„ä¸šåŠ¡ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè¿›å…¥åˆ°Â <code>safeExecute(executor, task, promise, m);</code>ï¼ˆè¯´æ˜ï¼šæ™®é€šæ–¹å¼æ‰§è¡Œè€—æ—¶ä»£ç ï¼Œçœ‹æˆ‘å‡†å¤‡å¥½çš„æ¡ˆä¾‹å³å¯ï¼‰</p><p>12.å¤„ç†è€—æ—¶ä¸šåŠ¡çš„ç¬¬äºŒç§æ–¹å¼ -<code>Context</code>Â ä¸­æ·»åŠ çº¿ç¨‹æ±  1.1åœ¨æ·»åŠ Â <code>pipeline</code>Â ä¸­çš„Â <code>handler</code>Â æ—¶å€™ï¼Œæ·»åŠ ä¸€ä¸ªçº¿ç¨‹æ± </p><p>//å±æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">static final EventExecutorGroup group = new DefaultEventExecutorGroup(16);</span><br><span class="line">ServerBootstrap b = new ServerBootstrap();</span><br><span class="line">                b.group(bossGroup, workerGroup)</span><br><span class="line">                 .channel(NioServerSocketChannel.class)</span><br><span class="line">                 .option(ChannelOption.SO_BACKLOG, 100)</span><br><span class="line">                 .handler(newLoggingHandler(LogLevel.INFO))</span><br><span class="line">                 .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                     @Override</span><br><span class="line">                     public void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                         ChannelPipeline p = ch.pipeline();</span><br><span class="line">                         if(sslCtx != null) &#123;</span><br><span class="line">                             p.addLast(sslCtx.newHandler(ch.alloc()));</span><br><span class="line">                         &#125;</span><br><span class="line">                         //p.addLast(new LoggingHandler(LogLevel.INFO));</span><br><span class="line">                         //p.addLast(new EchoServerHandler());</span><br><span class="line">                         p.addLast(group, new EchoServerHandler());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>1)<code>handler</code>Â ä¸­çš„ä»£ç å°±ä½¿ç”¨æ™®é€šçš„æ–¹å¼æ¥å¤„ç†è€—æ—¶ä¸šåŠ¡ã€‚</p><p>2)å½“æˆ‘ä»¬åœ¨è°ƒç”¨Â <code>addLast</code>Â æ–¹æ³•æ·»åŠ çº¿ç¨‹æ± åï¼Œ<code>handler</code>Â å°†ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªçº¿ç¨‹æ± ï¼Œå¦‚æœä¸æ·»åŠ ï¼Œå°†ä½¿ç”¨Â <code>IO</code>Â çº¿ç¨‹</p><p>3)å½“èµ°åˆ°Â <code>AbstractChannelHandlerContext</code>Â çš„Â <code>invokeChannelRead</code>Â æ–¹æ³•çš„æ—¶å€™ï¼Œ<code>executor.inEventLoop()</code>Â æ˜¯ä¸ä¼šé€šè¿‡çš„ï¼Œå› ä¸ºå½“å‰çº¿ç¨‹æ˜¯Â <code>IO</code>Â çº¿ç¨‹Â <code>Context</code>ï¼ˆä¹Ÿå°±æ˜¯Â <code>Handler</code>ï¼‰çš„Â <code>executor</code>Â æ˜¯ä¸šåŠ¡çº¿ç¨‹ï¼Œæ‰€ä»¥ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œdebug ä¸‹æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">static void invokeChannelRead(final AbstractChannelHandlerContext next, Object msg) &#123;</span><br><span class="line">    final Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, &quot;msg&quot;), next);</span><br><span class="line">    EventExecutor executor = next.executor();</span><br><span class="line">    if(executor.inEventLoop()) &#123;</span><br><span class="line">        next.invokeChannelRead(m);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        executor.execute(new Runnable() &#123;//æ‰§è¡Œrun</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                next.invokeChannelRead(m);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><p>4)éªŒè¯æ—¶ï¼Œæˆ‘ä»¬å¦‚æœå»æ‰Â <code>p.addLast(group,newEchoServerHandler());</code>Â æ”¹æˆÂ <code>p.addLastnewEchoServerHandler());</code>Â ä½ ä¼šå‘ç°ä»£ç ä¸ä¼šè¿›è¡Œå¼‚æ­¥æ‰§è¡Œã€‚</p><p>5)åé¢çš„æ•´ä¸ªæµç¨‹å°±å˜æˆå’Œç¬¬ä¸€ä¸ªæ–¹å¼ä¸€æ ·äº†</p><p>13.ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ</p><p>1)ç¬¬ä¸€ç§æ–¹å¼åœ¨Â <code>handler</code>Â ä¸­æ·»åŠ å¼‚æ­¥ï¼Œå¯èƒ½æ›´åŠ çš„è‡ªç”±ï¼Œæ¯”å¦‚å¦‚æœéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œé‚£æˆ‘å°±å¼‚æ­¥ï¼Œå¦‚æœä¸éœ€è¦ï¼Œå°±ä¸å¼‚æ­¥ï¼Œå¼‚æ­¥ä¼šæ‹–é•¿æ¥å£å“åº”æ—¶é—´ã€‚å› ä¸ºéœ€è¦å°†ä»»åŠ¡æ”¾è¿›Â <code>mpscTask</code>Â ä¸­ã€‚å¦‚æœÂ <code>IO</code>Â æ—¶é—´å¾ˆçŸ­ï¼Œ<code>task</code>Â å¾ˆå¤šï¼Œå¯èƒ½ä¸€ä¸ªå¾ªç¯ä¸‹æ¥ï¼Œéƒ½æ²¡æ—¶é—´æ‰§è¡Œæ•´ä¸ªÂ <code>task</code>ï¼Œå¯¼è‡´å“åº”æ—¶é—´è¾¾ä¸åˆ°æŒ‡æ ‡ã€‚</p><p>2)ç¬¬äºŒç§æ–¹å¼æ˜¯Â <code>Netty</code>Â æ ‡å‡†æ–¹å¼(å³åŠ å…¥åˆ°é˜Ÿåˆ—)ï¼Œä½†æ˜¯ï¼Œè¿™ä¹ˆåšä¼šå°†æ•´ä¸ªÂ <code>handler</code>Â éƒ½äº¤ç»™ä¸šåŠ¡çº¿ç¨‹æ± ã€‚ä¸è®ºè€—æ—¶ä¸è€—æ—¶ï¼Œéƒ½åŠ å…¥åˆ°é˜Ÿåˆ—é‡Œï¼Œä¸å¤Ÿçµæ´»ã€‚</p><p>3)å„æœ‰ä¼˜åŠ£ï¼Œä»çµæ´»æ€§è€ƒè™‘ï¼Œç¬¬ä¸€ç§è¾ƒå¥½ã€‚</p><h1><strong>ç¬¬ 11 ç«  ç”¨ Netty è‡ªå·±å®ç° Dubbo RPC</strong></h1><h2 id="11-1-RPC-åŸºæœ¬ä»‹ç»"><strong>11.1 RPC åŸºæœ¬ä»‹ç»</strong></h2><ol><li><code>RPCï¼ˆRemote Procedure Callï¼‰</code>â€”è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºçš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹</li><li>ä¸¤ä¸ªæˆ–å¤šä¸ªåº”ç”¨ç¨‹åºéƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨éƒ½åƒæ˜¯æœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·(å¦‚å›¾)</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_01.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_01.png"></p><ol><li>å¸¸è§çš„Â <code>RPC</code>Â æ¡†æ¶æœ‰ï¼šæ¯”è¾ƒçŸ¥åçš„å¦‚é˜¿é‡Œçš„Â <code>Dubbo</code>ã€<code>Google</code>Â çš„Â <code>gRPC</code>ã€<code>Go</code>Â è¯­è¨€çš„Â <code>rpcx</code>ã€<code>Apache</code>Â çš„Â <code>thrift</code>ï¼Œ<code>Spring</code>Â æ——ä¸‹çš„Â <code>SpringCloud</code>ã€‚</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_02.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_02.png"></p><h2 id="11-2-RPC-è°ƒç”¨æµç¨‹å›¾"><strong>11.2 RPC è°ƒç”¨æµç¨‹å›¾</strong></h2><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_03.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_03.png"></p><h2 id="11-3-PRC-è°ƒç”¨æµç¨‹è¯´æ˜"><strong>11.3 PRC è°ƒç”¨æµç¨‹è¯´æ˜</strong></h2><ol><li>æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆ<code>client</code>ï¼‰ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡</li><li><code>client stub</code>Â æ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰å°è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“</li><li><code>client stub</code>Â å°†æ¶ˆæ¯è¿›è¡Œç¼–ç å¹¶å‘é€åˆ°æœåŠ¡ç«¯</li><li><code>server stub</code>Â æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç </li><li><code>server stub</code>Â æ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡</li><li>æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™Â <code>server stub</code></li><li><code>server stub</code>Â å°†è¿”å›å¯¼å…¥ç»“æœè¿›è¡Œç¼–ç å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹</li><li><code>client stub</code>Â æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œè§£ç </li><li>æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆ<code>client</code>ï¼‰å¾—åˆ°ç»“æœ</li></ol><p>å°ç»“ï¼š<code>RPC</code>Â çš„ç›®æ ‡å°±æ˜¯å°†Â <code>2 - 8</code>Â è¿™äº›æ­¥éª¤éƒ½å°è£…èµ·æ¥ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒè¿™äº›ç»†èŠ‚ï¼Œå¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·å³å¯å®Œæˆè¿œç¨‹æœåŠ¡è°ƒç”¨</p><h2 id="11-4-è‡ªå·±å®ç°-Dubbo-RPCï¼ˆåŸºäº-Nettyï¼‰"><strong>11.4 è‡ªå·±å®ç° Dubbo RPCï¼ˆåŸºäº Nettyï¼‰</strong></h2><h3 id="11-4-1-éœ€æ±‚è¯´æ˜"><strong>11.4.1 éœ€æ±‚è¯´æ˜</strong></h3><ol><li><code>Dubbo</code>Â åº•å±‚ä½¿ç”¨äº†Â <code>Netty</code>Â ä½œä¸ºç½‘ç»œé€šè®¯æ¡†æ¶ï¼Œè¦æ±‚ç”¨Â <code>Netty</code>Â å®ç°ä¸€ä¸ªç®€å•çš„Â <code>RPC</code>Â æ¡†æ¶</li><li>æ¨¡ä»¿Â <code>Dubbo</code>ï¼Œæ¶ˆè´¹è€…å’Œæä¾›è€…çº¦å®šæ¥å£å’Œåè®®ï¼Œæ¶ˆè´¹è€…è¿œç¨‹è°ƒç”¨æä¾›è€…çš„æœåŠ¡ï¼Œæä¾›è€…è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¶ˆè´¹è€…æ‰“å°æä¾›è€…è¿”å›çš„æ•°æ®ã€‚åº•å±‚ç½‘ç»œé€šä¿¡ä½¿ç”¨Â <code>Netty 4.1.20</code></li></ol><h3 id="11-4-2-è®¾è®¡è¯´æ˜"><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter11?id=_1142-%e8%ae%be%e8%ae%a1%e8%af%b4%e6%98%8e"><strong>11.4.2 è®¾è®¡è¯´æ˜</strong></a></h3><ol><li>åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰æŠ½è±¡æ–¹æ³•ã€‚ç”¨äºæ¶ˆè´¹è€…å’Œæä¾›è€…ä¹‹é—´çš„çº¦å®šã€‚</li><li>åˆ›å»ºä¸€ä¸ªæä¾›è€…ï¼Œè¯¥ç±»éœ€è¦ç›‘å¬æ¶ˆè´¹è€…çš„è¯·æ±‚ï¼Œå¹¶æŒ‰ç…§çº¦å®šè¿”å›æ•°æ®ã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¯¥ç±»éœ€è¦é€æ˜çš„è°ƒç”¨è‡ªå·±ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå†…éƒ¨éœ€è¦ä½¿ç”¨Â <code>Netty</code>Â è¯·æ±‚æä¾›è€…è¿”å›æ•°æ®</li><li>å¼€å‘çš„åˆ†æå›¾</li></ol><p><img src="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_04.png" alt="https://dongzl.github.io/netty-handbook/_media/chapter11/chapter11_04.png"></p><h3 id="11-4-3-ä»£ç å®ç°"><strong>11.4.3 ä»£ç å®ç°</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.netty.dubborpc.publicinterface;</span><br><span class="line"></span><br><span class="line">//è¿™ä¸ªæ˜¯æ¥å£ï¼Œæ˜¯æœåŠ¡æä¾›æ–¹å’Œ æœåŠ¡æ¶ˆè´¹æ–¹éƒ½éœ€è¦</span><br><span class="line">public interface HelloService &#123;</span><br><span class="line"></span><br><span class="line">    String hello(String mes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.dubborpc.provider;</span><br><span class="line"></span><br><span class="line">import com.atguigu.netty.dubborpc.publicinterface.HelloService;</span><br><span class="line"></span><br><span class="line">public class HelloServiceImpl implements HelloService &#123;</span><br><span class="line"></span><br><span class="line">    private static int count = 0;</span><br><span class="line"></span><br><span class="line">    //å½“æœ‰æ¶ˆè´¹æ–¹è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œ å°±è¿”å›ä¸€ä¸ªç»“æœ</span><br><span class="line">    @Override</span><br><span class="line">    public String hello(String mes) &#123;</span><br><span class="line">        System.out.println(&quot;æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯=&quot; + mes);</span><br><span class="line">        //æ ¹æ®mes è¿”å›ä¸åŒçš„ç»“æœ</span><br><span class="line">        if (mes != null) &#123;</span><br><span class="line">            return &quot;ä½ å¥½å®¢æˆ·ç«¯, æˆ‘å·²ç»æ”¶åˆ°ä½ çš„æ¶ˆæ¯ [&quot; + mes + &quot;] ç¬¬&quot; + (++count) + &quot; æ¬¡&quot;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return &quot;ä½ å¥½å®¢æˆ·ç«¯, æˆ‘å·²ç»æ”¶åˆ°ä½ çš„æ¶ˆæ¯ &quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.dubborpc.provider;</span><br><span class="line"></span><br><span class="line">import com.atguigu.netty.dubborpc.netty.NettyServer;</span><br><span class="line"></span><br><span class="line">//ServerBootstrap ä¼šå¯åŠ¨ä¸€ä¸ªæœåŠ¡æä¾›è€…ï¼Œå°±æ˜¯ NettyServer</span><br><span class="line">public class ServerBootstrap &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        //ä»£ç ä»£å¡«..</span><br><span class="line">        NettyServer.startServer(&quot;127.0.0.1&quot;, 7000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.ServerBootstrap;</span><br><span class="line">import io.netty.channel.ChannelFuture;</span><br><span class="line">import io.netty.channel.ChannelInitializer;</span><br><span class="line">import io.netty.channel.ChannelPipeline;</span><br><span class="line">import io.netty.channel.EventLoopGroup;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line">import io.netty.handler.codec.string.StringDecoder;</span><br><span class="line">import io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line">public class NettyServer &#123;</span><br><span class="line"></span><br><span class="line">    public static void startServer(String hostName, int port) &#123;</span><br><span class="line">        startServer0(hostName, port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå®Œæˆå¯¹NettyServerçš„åˆå§‹åŒ–å’Œå¯åŠ¨</span><br><span class="line"></span><br><span class="line">    private static void startServer0(String hostname, int port) &#123;</span><br><span class="line"></span><br><span class="line">        EventLoopGroup bossGroup = new NioEventLoopGroup(1);</span><br><span class="line">        EventLoopGroup workerGroup = new NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            ServerBootstrap serverBootstrap = new ServerBootstrap();</span><br><span class="line"></span><br><span class="line">            serverBootstrap.group(bossGroup, workerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                                      @Override</span><br><span class="line">                                      protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                                          ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                                          pipeline.addLast(new StringDecoder());</span><br><span class="line">                                          pipeline.addLast(new StringEncoder());</span><br><span class="line">                                          pipeline.addLast(new NettyServerHandler()); //ä¸šåŠ¡å¤„ç†å™¨</span><br><span class="line"></span><br><span class="line">                                      &#125;</span><br><span class="line">                                  &#125;</span><br><span class="line"></span><br><span class="line">                    );</span><br><span class="line"></span><br><span class="line">            ChannelFuture channelFuture = serverBootstrap.bind(hostname, port).sync();</span><br><span class="line">            System.out.println(&quot;æœåŠ¡æä¾›æ–¹å¼€å§‹æä¾›æœåŠ¡~~&quot;);</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line">import com.atguigu.netty.dubborpc.customer.ClientBootstrap;</span><br><span class="line">import com.atguigu.netty.dubborpc.provider.HelloServiceImpl;</span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"></span><br><span class="line">//æœåŠ¡å™¨è¿™è¾¹handleræ¯”è¾ƒç®€å•</span><br><span class="line">public class NettyServerHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span><br><span class="line">        //è·å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶è°ƒç”¨æœåŠ¡</span><br><span class="line">        System.out.println(&quot;msg=&quot; + msg);</span><br><span class="line">        //å®¢æˆ·ç«¯åœ¨è°ƒç”¨æœåŠ¡å™¨çš„api æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåè®®</span><br><span class="line">        //æ¯”å¦‚æˆ‘ä»¬è¦æ±‚ æ¯æ¬¡å‘æ¶ˆæ¯æ˜¯éƒ½å¿…é¡»ä»¥æŸä¸ªå­—ç¬¦ä¸²å¼€å¤´ &quot;HelloService#hello#ä½ å¥½&quot;</span><br><span class="line">        if (msg.toString().startsWith(ClientBootstrap.providerName)) &#123;</span><br><span class="line"></span><br><span class="line">            String result = new HelloServiceImpl().hello(msg.toString().substring(msg.toString().lastIndexOf(&quot;#&quot;) + 1));</span><br><span class="line">            ctx.writeAndFlush(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line">import io.netty.channel.ChannelHandlerContext;</span><br><span class="line">import io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line">public class NettyClientHandler extends ChannelInboundHandlerAdapter implements Callable &#123;</span><br><span class="line"></span><br><span class="line">    private ChannelHandlerContext context;//ä¸Šä¸‹æ–‡</span><br><span class="line">    private String result; //è¿”å›çš„ç»“æœ</span><br><span class="line">    private String para; //å®¢æˆ·ç«¯è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼ å…¥çš„å‚æ•°</span><br><span class="line"></span><br><span class="line">    //ä¸æœåŠ¡å™¨çš„è¿æ¥åˆ›å»ºåï¼Œå°±ä¼šè¢«è°ƒç”¨, è¿™ä¸ªæ–¹æ³•æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨(1)</span><br><span class="line">    @Override</span><br><span class="line">    public void channelActive(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot; channelActive è¢«è°ƒç”¨  &quot;);</span><br><span class="line">        context = ctx; //å› ä¸ºæˆ‘ä»¬åœ¨å…¶å®ƒæ–¹æ³•ä¼šä½¿ç”¨åˆ° ctx</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æ”¶åˆ°æœåŠ¡å™¨çš„æ•°æ®åï¼Œè°ƒç”¨æ–¹æ³• (4)</span><br><span class="line">    //</span><br><span class="line">    @Override</span><br><span class="line">    public synchronized void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot; channelRead è¢«è°ƒç”¨  &quot;);</span><br><span class="line">        result = msg.toString();</span><br><span class="line">        notify(); //å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //è¢«ä»£ç†å¯¹è±¡è°ƒç”¨, å‘é€æ•°æ®ç»™æœåŠ¡å™¨ï¼Œ-&gt; wait -&gt; ç­‰å¾…è¢«å”¤é†’(channelRead) -&gt; è¿”å›ç»“æœ (3)-ã€‹5</span><br><span class="line">    @Override</span><br><span class="line">    public synchronized Object call() throws Exception &#123;</span><br><span class="line">        System.out.println(&quot; call1 è¢«è°ƒç”¨  &quot;);</span><br><span class="line">        context.writeAndFlush(para);</span><br><span class="line">        //è¿›è¡Œwait</span><br><span class="line">        wait(); //ç­‰å¾…channelRead æ–¹æ³•è·å–åˆ°æœåŠ¡å™¨çš„ç»“æœåï¼Œå”¤é†’</span><br><span class="line">        System.out.println(&quot; call2 è¢«è°ƒç”¨  &quot;);</span><br><span class="line">        return result; //æœåŠ¡æ–¹è¿”å›çš„ç»“æœ</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //(2)</span><br><span class="line">    void setPara(String para) &#123;</span><br><span class="line">        System.out.println(&quot; setPara  &quot;);</span><br><span class="line">        this.para = para;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.dubborpc.netty;</span><br><span class="line"></span><br><span class="line">import io.netty.bootstrap.Bootstrap;</span><br><span class="line">import io.netty.channel.ChannelInitializer;</span><br><span class="line">import io.netty.channel.ChannelOption;</span><br><span class="line">import io.netty.channel.ChannelPipeline;</span><br><span class="line">import io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line">import io.netty.channel.socket.SocketChannel;</span><br><span class="line">import io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line">import io.netty.handler.codec.string.StringDecoder;</span><br><span class="line">import io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.util.concurrent.Executor;</span><br><span class="line">import java.util.concurrent.ExecutorService;</span><br><span class="line">import java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line">public class NettyClient &#123;</span><br><span class="line"></span><br><span class="line">    //åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="line">    private static ExecutorService executor = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());</span><br><span class="line"></span><br><span class="line">    private static NettyClientHandler client;</span><br><span class="line">    private int count = 0;</span><br><span class="line"></span><br><span class="line">    //ç¼–å†™æ–¹æ³•ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œè·å–ä¸€ä¸ªä»£ç†å¯¹è±¡</span><br><span class="line"></span><br><span class="line">    public Object getBean(final Class&lt;?&gt; serivceClass, final String providerName) &#123;</span><br><span class="line"></span><br><span class="line">        return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</span><br><span class="line">                new Class&lt;?&gt;[]&#123;serivceClass&#125;, (proxy, method, args) -&gt; &#123;</span><br><span class="line"></span><br><span class="line">                    System.out.println(&quot;(proxy, method, args) è¿›å…¥....&quot; + (++count) + &quot; æ¬¡&quot;);</span><br><span class="line">                    //&#123;&#125;  éƒ¨åˆ†çš„ä»£ç ï¼Œå®¢æˆ·ç«¯æ¯è°ƒç”¨ä¸€æ¬¡ hello, å°±ä¼šè¿›å…¥åˆ°è¯¥ä»£ç </span><br><span class="line">                    if (client == null) &#123;</span><br><span class="line">                        initClient();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    //è®¾ç½®è¦å‘ç»™æœåŠ¡å™¨ç«¯çš„ä¿¡æ¯</span><br><span class="line">                    //providerName åè®®å¤´ args[0] å°±æ˜¯å®¢æˆ·ç«¯è°ƒç”¨api hello(???), å‚æ•°</span><br><span class="line">                    client.setPara(providerName + args[0]);</span><br><span class="line"></span><br><span class="line">                    //</span><br><span class="line">                    return executor.submit(client).get();</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //åˆå§‹åŒ–å®¢æˆ·ç«¯</span><br><span class="line">    private static void initClient() &#123;</span><br><span class="line">        client = new NettyClientHandler();</span><br><span class="line">        //åˆ›å»ºEventLoopGroup</span><br><span class="line">        NioEventLoopGroup group = new NioEventLoopGroup();</span><br><span class="line">        Bootstrap bootstrap = new Bootstrap();</span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .option(ChannelOption.TCP_NODELAY, true)</span><br><span class="line">                .handler(</span><br><span class="line">                        new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                            @Override</span><br><span class="line">                            protected void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">                                ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                                pipeline.addLast(new StringDecoder());</span><br><span class="line">                                pipeline.addLast(new StringEncoder());</span><br><span class="line">                                pipeline.addLast(client);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            bootstrap.connect(&quot;127.0.0.1&quot;, 7000).sync();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.atguigu.netty.dubborpc.customer;</span><br><span class="line"></span><br><span class="line">import com.atguigu.netty.dubborpc.netty.NettyClient;</span><br><span class="line">import com.atguigu.netty.dubborpc.publicinterface.HelloService;</span><br><span class="line"></span><br><span class="line">public class ClientBootstrap &#123;</span><br><span class="line"></span><br><span class="line">    //è¿™é‡Œå®šä¹‰åè®®å¤´</span><br><span class="line">    public static final String providerName = &quot;HelloService#hello#&quot;;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</span><br><span class="line">        NettyClient customer = new NettyClient();</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä»£ç†å¯¹è±¡</span><br><span class="line">        HelloService service = (HelloService) customer.getBean(HelloService.class, providerName);</span><br><span class="line"></span><br><span class="line">        for (; ; ) &#123;</span><br><span class="line">            Thread.sleep(2 * 1000);</span><br><span class="line">            //é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æœåŠ¡æä¾›è€…çš„æ–¹æ³•(æœåŠ¡)</span><br><span class="line">            String res = service.hello(&quot;ä½ å¥½ dubbo~&quot;);</span><br><span class="line">            System.out.println(&quot;è°ƒç”¨çš„ç»“æœ res= &quot; + res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>netty</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Data Jpa å­¦ä¹ ç¬”è®°</title>
    <link href="/2024/05/02/Spring%20Data%20Jpa%E5%AD%A6%E4%B9%A0%E5%BF%83%E5%BE%97/"/>
    <url>/2024/05/02/Spring%20Data%20Jpa%E5%AD%A6%E4%B9%A0%E5%BF%83%E5%BE%97/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å®˜ç½‘ ï¼›<a href="https://docs.spring.io/spring-data/jpa/reference/index.html">https://docs.spring.io/spring-data/jpa/reference/index.html</a></p></blockquote><p><img src="/img/spring-data-jpa-01.png" alt="å›¾01"></p><h1>ä¸€ã€spring Data Jpa ä»‹ç»</h1><blockquote><p><strong>Jpa</strong> : JPAï¼ˆJava Persistence APIï¼‰æ˜¯ç”¨äºåœ¨Javaåº”ç”¨ç¨‹åºä¸­è¿›è¡Œå¯¹è±¡æŒä¹…åŒ–çš„APIï¼Œç”¨äºæè¿°å¯¹è±¡-å…³ç³»æ˜ å°„ï¼ˆORMï¼‰è§„èŒƒï¼ˆå°±åƒjavaçš„JDBCè§„èŒƒï¼Œæ¯ä¸ªæ•°æ®åº“å‚å•†éƒ½æœ‰å¯¹åº”çš„å®ç°ï¼‰ã€‚</p><p><strong>Hibernate</strong> ï¼šHibernate æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºå¯¹è±¡-å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ¡†æ¶ï¼Œå®ƒå®ç°äº†JPAï¼ˆJava Persistence APIï¼‰è§„èŒƒï¼Œä¸ºJavaåº”ç”¨ç¨‹åºæä¾›äº†æ•°æ®æŒä¹…åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>Spring Data JPA</strong>ï¼šSpring Data JPA æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒç®€åŒ–äº†å¯¹äºåŸºäº JPA (Java Persistence API) çš„æ•°æ®è®¿é—®å±‚çš„å¼€å‘ã€‚JPA æ˜¯ Java EE ä¸­ç”¨äºå¯¹è±¡æŒä¹…åŒ–çš„æ ‡å‡†ï¼Œè€Œ Spring Data JPA åˆ™åœ¨å…¶åŸºç¡€ä¸Šæä¾›äº†ä¸€ç³»åˆ—ä¾¿æ·çš„åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…æ›´è½»æ¾åœ°ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚</p><p><strong>Spring Data:</strong> Spring Dataæ˜¯Springç”Ÿæ€ä¸­çš„ä¸€ä¸ªé¡¹ç›®ï¼Œç›®æ ‡å°±æ˜¯ç®€åŒ–å¯¹æ•°æ®è®¿é—®çš„å¼€å‘ï¼Œä¸ªäººè§‰å¾—springçš„é‡å¿ƒå¾ˆå¤§ï¼Œå®ƒå¹¶ä¸é™äºå…³ç³»å‹æ•°æ®åº“ï¼Œè¿˜æ”¯æŒæ–‡æ¡£å‹æ•°æ®åº“ï¼ŒNoSQLæ•°æ®åº“ã€‚</p></blockquote><p>ç®€å•æ¥è¯´ Spring Data Jpa æ˜¯springå¯¹Jpaè§„èŒƒçš„åœ¨ä¸€æ¬¡å°è£…ï¼Œç›®çš„å°±æ˜¯ç®€åŒ–æ•°æ®åº“æ“ä½œã€‚æœ€å¤§ç‰¹ç‚¹å°±æ˜¯</p><p><strong>Defining Query Methods</strong>å®šä¹‰æŸ¥è¯¢æ–¹æ³•ã€‚ç¬¬ä¸€æ¬¡æ¥è§¦çš„æ—¶å€™æ„Ÿè§‰å¾ˆç¥å¥‡ã€‚é€šè¿‡å¯¹æ–¹æ³•åçš„è§£æå°±èƒ½è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢è¯­å¥ã€‚</p><h1>äºŒã€å¿«é€Ÿå…¥é—¨</h1><ol><li>å¼•å…¥mavenåæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>åˆ›å»ºå®ä½“ç±» å’Œ repositoryæ¥å£ è¿˜æœ‰å¯åŠ¨ç±»çš„å¼€å¯Jpa ,ä»£ç ä¸­å¯¹åº”è§£é‡Š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chances.learn.jpa.entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//@Entityæ˜¯ç”¨æ¥æ ‡è¯†å®ä½“ç±»ï¼Œspringä¼šæŠŠæœ‰è¿™ä¸ªæ³¨è§£çš„ç±»</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(name=&quot;sc_person&quot;)</span>  <span class="comment">//å¯¹åº”æ•°æ®åº“è¡¨åï¼Œä¹Ÿå¯ä»¥æ ¹æ®nameç”Ÿæˆå±æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span>   <span class="comment">//æ ‡è¯†ä¸»é”®</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>  <span class="comment">//ä¸»é”®ç”Ÿæˆç­–ç•¥</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-- ------------------------------------------------------------------------</span><br><span class="line"><span class="comment">//Repositoryæ¥å£æ˜¯ Jpaä¸­æœ€æ ¸å¿ƒçš„æ¥å£ï¼Œ</span></span><br><span class="line"><span class="comment">// ç»§æ‰¿ä¹‹åä¾‹å¦‚ findByLastName(String lastName) å°†ä¼šè‡ªåŠ¨ç”Ÿæˆæ ¹æ® lastName æŸ¥è¯¢å®ä½“çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">package</span> chances.learn.jpa.repo;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PersonRepository</span> <span class="keyword">extends</span> <span class="title class_">Repository</span>&lt;Person, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">  Person <span class="title function_">save</span><span class="params">(Person person)</span>;</span><br><span class="line">  Optional&lt;Person&gt; <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-- ------------------------------------------------------------------------</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackages = &quot;chances.learn.jpa.repo&quot;)</span></span><br><span class="line"><span class="meta">@EntityScan(&quot;chances.learn.jpa.repo.entity&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaLearnApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(JpaLearnApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹çœ‹çœ‹ç»“æœ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JpaLearnApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    PersonRepository personRepository;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        person.setName(<span class="string">&quot;shichong_update&quot;</span>);</span><br><span class="line">        person.setAge(<span class="number">20</span>);</span><br><span class="line">        <span class="type">Person</span> <span class="variable">save</span> <span class="operator">=</span> personRepository.save(person);</span><br><span class="line">        log.info(<span class="string">&quot;sava resultï¼š&#123;&#125;&quot;</span>,save.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=MWQxMWVjMTFkZTcxYTJlMGMyZTkzNWZhZWIzNWE2ZmNfUDh1S0M4VWNZSURyc3dRYlVqd1V6QUx3NmhjSXJJN3pfVG9rZW46R2tFNWJQckhab0gxR1h4MlpiRmNtZGxwblpiXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDI2NTAzMDM3ZTRlMmZkZjY5YThhZTBiODk4YjE2ZDNfanpueGc0OTBhcWt0YjJpZXBTUnBMdm5hT1V2WWd5UkZfVG9rZW46V3ZTS2JEMVlEb2NJTnd4TW1VUWMyUFZXblllXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><h1>ä¸‰ã€æ ¸å¿ƒæ¥å£</h1><p>Spring DataæŠ½è±¡å‡ºæ¥çš„é¡¶å±‚æ¥å£æ˜¯<code> Repository</code>ã€‚ ç›´æ¥æˆ–é—´æ¥å®ç°è¿™ä¸ªæ¥å£æ‰æœ‰æ“ä½œæ•°æ®çš„èƒ½åŠ›ï¼Œä¸é™äºå…³ç³»å‹æ•°æ®åº“ï¼Œè¿˜æ”¯æŒRedis ï¼ŒMangoDBç­‰ã€‚</p><p>Spring data jpa é€šè¿‡è§£ææ–¹æ³•åè‡ªåŠ¨å»ç”ŸæˆæŸ¥è¯¢sqlã€‚ä¸ºäº†ç®€åŒ–å¼€å‘è€…å¼€å‘ï¼Œä¹Ÿæä¾›äº†ä¸€äº›å¸¦æœ‰å¸¸ç”¨æŸ¥è¯¢æ–¹æ³•çš„æ¥å£ï¼Œæˆ‘ä»¬åªéœ€è¦ç›´æ¥å®ç°å°±å¯ä»¥ä½¿ç”¨ã€‚ä¾‹å¦‚CrudRepository ï¼ŒListCrudRepository ,JpaRepository,PagingAndSortingRepositoryç­‰æ¥å£ï¼Œæ¯ä¸€ä¸ªæ¥å£éƒ½è¡¥å……äº†ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ä¸‹é¢æ˜¯æˆ‘åœ¨ideaä¸­æŸ¥çœ‹çš„å…³ç³»å›¾ï¼Œ</p><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDU1ZmY3MTZlNjYxZDI3ODkyMGQyZGZlZDYwZGE5ODhfdkNPOElZOWN5MFphajhZMnNyUkFNZzA4V3BxU3MwSUFfVG9rZW46WGZPSWI0dFMwb3EyYjd4eWdNNWNLOGp3blRmXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><h2 id="3-1-CrudRepositoryæ¥å£-å¢åˆ æ”¹æŸ¥æ¥å£">3.1 CrudRepositoryæ¥å£ å¢åˆ æ”¹æŸ¥æ¥å£</h2><p>å¯¹æ¯”å®ç°æ™®é€šRepositoryå’ŒCrudRepositoryï¼Œçœ‹ä¸€çœ‹UserRepositoryä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–</p><ul><li>å®ç°Repositoryã€‚</li></ul><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=MWFjODNhNTlhM2YwODU3OGRjNjVhNTUxZWIyYjFiNzhfYTlKNHN3S0xJT3lIMDF5eFdQVE5Qd2szS01nWllwT3BfVG9rZW46UTVVTWJxRUJEb2kyUm94UE5zR2NjOFZSbk5kXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><ul><li>å®ç°CrudRepository</li></ul><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=NTBiODk3M2M5NjRiNjM3ZGFiOTdiZTI0MjBhOThkMGJfNGFmNFdPaUdaZVhHMTBLR0d4TlppNlQyZHBDM3ZBQW5fVG9rZW46SUpKMmJERjJob2pkZjd4R3lEWWN0OEZ2bklnXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><ul><li>æ€»ç»“ï¼ŒCrudRepositoryå°±å’Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„repositoryæ˜¯ä¸€æ ·çš„åŸç†ï¼Œåªä¸è¿‡å£°æ˜å¥½äº†ä¸€äº›é€šç”¨çš„æ–¹æ³•ï¼Œæ­é…æ³›å‹å°±å¯ä»¥å¤ç”¨ä¸€äº›é€šç”¨çš„æ“ä½œ.çœ‹ä¸€ä¸‹æºç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.data.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NoRepositoryBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CrudRepository</span>&lt;T, ID&gt; <span class="keyword">extends</span> <span class="title class_">Repository</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    &lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; S <span class="title function_">save</span><span class="params">(S entity)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; Iterable&lt;S&gt; <span class="title function_">saveAll</span><span class="params">(Iterable&lt;S&gt; entities)</span>;</span><br><span class="line"></span><br><span class="line">    Optional&lt;T&gt; <span class="title function_">findById</span><span class="params">(ID id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsById</span><span class="params">(ID id)</span>;</span><br><span class="line"></span><br><span class="line">    Iterable&lt;T&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Iterable&lt;T&gt; <span class="title function_">findAllById</span><span class="params">(Iterable&lt;ID&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(ID id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(T entity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteAllById</span><span class="params">(Iterable&lt;? extends ID&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">(Iterable&lt;? extends T&gt; entities)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>@NoRepositoryBeanï¼š  å› ä¸ºç»§æ‰¿äº†repositoryæ¥å£springä¼šè®¤ä¸ºä»–ä¹Ÿæ˜¯ä¸€ä¸ªbeanï¼Œå®é™…å¹¶ä¸æ˜¯åªæ˜¯ä¸­é—´æ‰©å±•æ¥å£ï¼Œæ‰€ä»¥ä½¿ç”¨@NoRepositoryBeanæ ‡è¯†ä¸€ä¸‹ å°±ä¸ä¼šå½“ä½œBeanå¤„ç†äº†</li></ul><p>æ”¯æŒåˆ†é¡µæ¥å£</p><h2 id="3-2-PagingAndSortingRepository-åˆ†é¡µæ’åºæ¥å£">3.2 PagingAndSortingRepository åˆ†é¡µæ’åºæ¥å£</h2><ol><li>ä½¿ç”¨çš„æ—¶å€™ç›´æ¥ç»§æ‰¿è¿™ä¸ªæ¥å£å³å¯,å£°æ˜ä¸€ä¸ªæ–¹æ³•è¿”å›ç»“æœä¸º page å­—é¢æ„æ€ç†è§£å°±æ˜¯<ol><li><pre><code class="language-Java">package chances.learn.jpa.repo;import chances.learn.jpa.entity.Person;import org.springframework.data.domain.Page;import org.springframework.data.domain.Pageable;import org.springframework.data.repository.CrudRepository;import org.springframework.data.repository.PagingAndSortingRepository;import org.springframework.data.repository.Repository;import java.util.Optional;public interface PersonRepository extends CrudRepository&lt;Person, Long&gt;, PagingAndSortingRepository&lt;Person,Long&gt; &#123;  Person save(Person person);    Page&lt;Person&gt; findAll(String name, Pageable pageable);  Optional&lt;Person&gt; findById(long id);&#125;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2. å¼€å§‹unit test ï¼Œåˆ›å»ºåˆ†é¡µæŸ¥è¯¢æ¡ä»¶æ—¶å€™ ä½¿ç”¨PageRequest.ofæ–¹æ³• ã€‚çœ‹çœ‹æ•°æ®åº“å’Œç»“æœã€‚</span><br><span class="line">   1. ![img](https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=MTliOTRmNmQyMDA0ZDZlNGQ2NzFiNjMyYjQ2OWU5YjFfenZtMFJzTlg0R3hKNmlWTno4SWcxTWJBZ2xlUkQ3ZkNfVG9rZW46RDdlRmJsMUFOb0tuVlJ4eWxUS2N2YWRhbjJkXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA)</span><br><span class="line"></span><br><span class="line">   2. ![img](https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTI4YmM1NzA2ZGExMzMzYzE0ZDZhYTUyYTliYmM2YjBfUGhyOUMzUERzQU1XMFZKZk9vWVljM0Ezb3lpSWNiZFRfVG9rZW46TFVCamJmbWpZb3BnaTZ4MXFPcWNFa3hzbmNoXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA)</span><br><span class="line"></span><br><span class="line">   3. ```Java</span><br><span class="line">      @Test</span><br><span class="line">      void page() &#123;</span><br><span class="line">          //æ¯é¡µä¸¤æ¡ ç¬¬ä¸€é¡µ æŒ‰ç…§ageé™åº</span><br><span class="line">          Sort sort = Sort.by(Sort.Direction.DESC, &quot;age&quot;);</span><br><span class="line">          Page&lt;Person&gt; all = personRepository.findAll(PageRequest.of(0, 2));</span><br><span class="line">          log.info(&quot;page resultï¼š&#123;&#125;&quot;,all.toString());</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></code></pre></li></ol></li></ol><h2 id="3-3-JpaRepository-æ•´åˆäº†å¸¸ç”¨çš„æ•°æ®åº“æ“ä½œ">3.3 JpaRepository æ•´åˆäº†å¸¸ç”¨çš„æ•°æ®åº“æ“ä½œ</h2><p>é€šè¿‡æ‰©å±• <code>JpaRepository</code>ï¼Œç»§æ‰¿åŸºæœ¬çš„ CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ“ä½œï¼Œä»¥åŠä½¿ç”¨ Spring Data çš„æœ¬åœ°æŸ¥è¯¢è¿›è¡Œåˆ†é¡µã€æ’åºæ–¹æ³•ã€‚è¿™ä¸ªæ¥å£ç®€åŒ–äº† Spring åº”ç”¨ç¨‹åºä¸­æ•°æ®è®¿é—®å±‚çš„å¼€å‘ï¼Œå‡å°‘äº†ä¸æ•°æ®åº“æ“ä½œé€šå¸¸ç›¸å…³çš„æ ·æ¿ä»£ç ã€‚</p><p>åœ¨debugçš„æ—¶å€™å‘ç°ä¸€ä»¶äº‹æƒ…ï¼Œå‘ç°PersonRepositoryç»è¿‡åŠ¨æ€ä»£ç†ä¹‹åå·²ç»å˜æˆäº†SimpleJpaRepositoryç±»å‹ï¼Œ</p><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=MTRjZWU3ODZjMDIxNDEwNjJhNGU1ZjhjZjEzZGQxNzVfamFsRDNRU2VBNGtWMXFOZUY2V2ZOT0sySnhCVFU5N0hfVG9rZW46TlJyemJhUTFab0ZDbWt4YUdPRGM0NHZvbmhnXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><h1>å››ã€Defining Query Methods å®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼ˆJpaç‰¹è‰²ï¼‰</h1><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGI3MDM5ZDY3MzJhYzI1OGJiZGYzNjc3NDNjMGVjZjNfSXlEdG5YQmxGR3d6dmxRWHZ4VnQySjNLMG5LaFo2VXVfVG9rZW46VXlXT2JGS0ZSb3J1ZTl4UXRZMGNhQWt5bmhjXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><p>Defining Query Methodæ˜¯Jpaçš„ä¸€å¤§ç‰¹æ€§ã€‚å®šä¹‰æŸ¥è¯¢æ–¹æ³•æœ‰å®˜ç½‘è¯´æ˜<strong>æä¾›äº†ä¸¤ç§æ–¹å¼</strong>ã€‚ç¬¬ä¸€ç§ é€šè¿‡ç›´æ¥ä»æ–¹æ³•åç§°è§£æåæŸ¥è¯¢ï¼Œç¬¬äºŒç§ é€šè¿‡æ‰‹åŠ¨å®šä¹‰æ–¹å¼çš„æ¥æ‰§è¡Œã€‚</p><p>ç®€å•ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§ æ²¡æœ‰sqlç›´æ¥è§£ææ–¹æ³•å</span></span><br><span class="line">Optional&lt;LoginToken&gt; <span class="title function_">findByUserId</span><span class="params">(String userId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§</span></span><br><span class="line"><span class="meta">@Query(&quot;select e from SysUser e where e.userName = :userName and e.deleted = false&quot;)</span></span><br><span class="line">Optional&lt;SysUser&gt; <span class="title function_">findByUserName</span><span class="params">(<span class="meta">@Param(&quot;userName&quot;)</span> String userName)</span>;</span><br></pre></td></tr></table></figure><h2 id="4-1-Query-Lookup-StrategiesæŸ¥è¯¢æŸ¥æ‰¾ç­–ç•¥">4.1 Query Lookup StrategiesæŸ¥è¯¢æŸ¥æ‰¾ç­–ç•¥</h2><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGU4ZDI1MGFkNTRlNTU3ZjRmNmY1MDdmMGIwNmEyMTRfeld5UWpiQ0lPb2ZWOWlHVElLUVE2VUN3Z3V0NmtEQ1VfVG9rZW46Unk5S2JJTFE3b0lWZG14dDVFRGNPaWJwblFmXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p><p>åœ¨ Spring Data JPA ä¸­ï¼Œæœ‰ä¸¤ç§ä¸»è¦çš„æ–¹å¼æ¥å®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼šåŸºäºæ–¹æ³•åçš„å‘½åçº¦å®šå’Œä½¿ç”¨ <code>@Query</code> æ³¨è§£å®šä¹‰çš„è‡ªå®šä¹‰æŸ¥è¯¢ã€‚æŸ¥è¯¢æŸ¥æ‰¾ç­–ç•¥å†³å®šäº† Spring Data JPA åœ¨æ‰§è¡Œæ–¹æ³•æ—¶åº”è¯¥ä¼˜å…ˆè€ƒè™‘å“ªç§æ–¹å¼ã€‚å®˜ç½‘ä¸­å‘Šè¯‰æˆ‘ä»¬ä¸€å…±æœ‰ä¸‰ç§é€‰æ‹©ç­–ç•¥æ¨¡å¼ï¼Œå’Œå¦‚ä½•åˆ‡æ¢æŸ¥æ‰¾ç­–ç•¥ã€‚</p><ul><li><code>CREATE</code> ä»æ–¹æ³•åè§£æåˆ é™¤æŒ‡å®šçš„å‰ç¼€ ä¾‹å¦‚ find,findAllï¼Œç„¶åè§£ææ–¹æ³•åçš„å…¶ä½™éƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯ç›´æ¥æ ¹æ®æ–¹æ³•ååˆ›å»ºæŸ¥è¯¢ã€‚å¦‚æœæ–¹æ³•åä¸ç¬¦åˆè§„åˆ™å¯åŠ¨ä¼šæŠ¥å¼‚å¸¸ï¼ŒåŠæ—¶é…ç½®äº† <code>@query</code> æ³¨è§£</li><li><em><code>USE_DECLARED_QUERY</code></em> <em>ä½¿ç”¨å£°æ˜å¥½çš„æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨</em>*<code>@query</code>* <em>æ³¨è§£å£°æ˜çš„æŸ¥è¯¢ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</em></li><li><code>CREATE_IF_NOT_FOUND</code> è¿™æ˜¯é»˜è®¤çš„æŸ¥æ‰¾ç­–ç•¥ï¼Œå…ˆå»ä½¿ç”¨<code>@Quer</code>yå£°æ˜å¥½çš„æŸ¥è¯¢ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†å»ä½¿ç”¨é€šè¿‡æ–¹æ³•ååˆ›å»ºæŸ¥è¯¢ã€‚</li></ul><p>æ›´æ”¹é»˜è®¤çš„ç­–ç•¥ä¿®æ”¹<code>@EnableJpaRepositories</code>çš„queryLookupStrategyå±æ€§å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chances.learn.jpa;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackages=&quot;chances.learn.jpa.repo&quot;, queryLookupStrategy= QueryLookupStrategy.Key.CREATE)</span></span><br><span class="line"><span class="meta">@EntityScan(&quot;chances.learn.jpa.entity&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaLearnApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(JpaLearnApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-é€šè¿‡æ–¹æ³•åè§£ææŸ¥è¯¢">4.2 é€šè¿‡æ–¹æ³•åè§£ææŸ¥è¯¢</h2><p>ä¸‹é¢æ˜¯å®˜ç½‘ç»™å‡ºçš„ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹å‡ºæ–¹æ³•åæ˜¯é€šè¿‡<strong>å‰ç¼€+å­—æ®µå+å­—æ®µæè¿°ç¬¦</strong>+â€¦ç»„æˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">PersonRepository</span> <span class="keyword">extends</span> <span class="title class_">Repository</span>&lt;Person, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">  List&lt;Person&gt; <span class="title function_">findByEmailAddressAndLastname</span><span class="params">(EmailAddress emailAddress, String lastname)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Enables the distinct flag for the query</span></span><br><span class="line">  List&lt;Person&gt; <span class="title function_">findDistinctPeopleByLastnameOrFirstname</span><span class="params">(String lastname, String firstname)</span>;</span><br><span class="line">  List&lt;Person&gt; <span class="title function_">findPeopleDistinctByLastnameOrFirstname</span><span class="params">(String lastname, String firstname)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Enabling ignoring case for an individual property</span></span><br><span class="line">  List&lt;Person&gt; <span class="title function_">findByLastnameIgnoreCase</span><span class="params">(String lastname)</span>;</span><br><span class="line">  <span class="comment">// Enabling ignoring case for all suitable properties</span></span><br><span class="line">  List&lt;Person&gt; <span class="title function_">findByLastnameAndFirstnameAllIgnoreCase</span><span class="params">(String lastname, String firstname)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Enabling static ORDER BY for a query</span></span><br><span class="line">  List&lt;Person&gt; <span class="title function_">findByLastnameOrderByFirstnameAsc</span><span class="params">(String lastname)</span>;</span><br><span class="line">  List&lt;Person&gt; <span class="title function_">findByLastnameOrderByFirstnameDesc</span><span class="params">(String lastname)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ç¼€ä¸ä»…æœ‰findè¿˜æœ‰ countï¼Œdelete,removeç­‰å…¶ä»–çš„å‰ç¼€ã€‚æ¯ä¸ªç‰ˆæœ¬å¯èƒ½æ”¯æŒçš„éƒ½ä¸ä¸€æ ·å¯ä»¥çœ‹çœ‹Jpaçš„æŸ¥è¯¢è§£æè¯­æ³•æ ‘çœ‹çœ‹ã€‚ <code>org.springframework.data.repository.query.parser.PartTree</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.data.repository.query.parser.Part.Type</span><br></pre></td></tr></table></figure><p><img src="https://chances.feishu.cn/space/api/box/stream/download/asynccode/?code=YWJhNDAzMmM3ZTkyZjBjNzA5ZDBkNjNiZTRhNzJhZDRfeldSa1QzU0xySkNyVFd6cWtsc01kNE9GclpHOWFkWFhfVG9rZW46TlVWNGJsS09Eb0NlQ1p4T2VNb2NZY3FwbklnXzE3MTQ5MDIzMzg6MTcxNDkwNTkzOF9WNA" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>å¼€å‘æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Security</title>
    <link href="/2023/09/13/SpringSecurity%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/09/13/SpringSecurity%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>Spring Security</h1><p>SpringSecurity å®‰å…¨ç®¡ç†æ¡†æ¶ ( ä¹‹åç®€ç§° security ) æ˜¯åŸºäºè¿‡æ»¤å™¨å®ç°çš„æƒé™éªŒè¯åŠŸèƒ½ï¼Œä»–å¯ä»¥éªŒè¯ç”¨æˆ·çš„èº«ä»½ä»¥åŠæ‰€æ‹¥æœ‰çš„æƒé™æ¥åˆ¤æ–­ä½ æ˜¯å¦å…·æœ‰è®¿é—®ç›®æ ‡èµ„æºçš„æ¡ä»¶</p><p>å®‰å…¨ç®¡ç†æ¡†æ¶é™¤äº† security ä¹‹å¤–è¿˜æœ‰ shiro ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œç›¸æ¯”ä¹‹ä¸‹ security å°±ç¬¨é‡ä¸€äº›ï¼Œä½†æ˜¯ç›¸å¯¹çš„å¸¦æ¥çš„å¥½å¤„å°±æ˜¯ç›¸æ¯” shiroï¼Œsecurity å¯¹äºè®¿é—®æƒé™çš„æŠŠæ§ç»†ç²’åº¦æ¯”è¾ƒå¥½</p><p>ç¬”è®°åŸºäº Springboot 2.4.0 çš„ web ç¨‹åºé€šè¿‡ Java ä»£ç  + æ³¨è§£çš„æ–¹å¼è¿›è¡Œé…ç½® ( ä¸ä½¿ç”¨ xml é…ç½®æ–‡ä»¶ )</p><h2 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h2><p>åˆ›å»ºå¥½ boot ç¨‹åºä¹‹åï¼Œå¯¼å…¥é™æ€ç´ æé¡µé¢è‡³ templates ç›®å½•ä¸‹ï¼Œé…ç½®å¥½ä¸‰ä¸ª level çš„è§†å›¾ ( é¡µé¢æ¥è‡ªç‹‚ç¥è¯´ ) è·³è½¬å°±å¯ä»¥å¼€å§‹ç»ƒä¹ äº†</p><p><img src="/img/security-01.png" alt=""></p><p>boot é¡¹ç›®æ·»åŠ  security ç¯å¢ƒéœ€è¦åœ¨é¡¹ç›®åˆ›å»ºæ—¶å‹¾é€‰ security æ¨¡å—ï¼Œæˆ–è€…æ‰‹åŠ¨åœ¨ pom æ–‡ä»¶ä¸­æ·»åŠ åœºæ™¯å¯åŠ¨å™¨ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- securityåœºæ™¯å¯åŠ¨å™¨ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¼•ç”¨äº†webã€thymeleafã€testã€lombok... --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å°†ä¾èµ–å¼•å…¥åï¼Œæ— éœ€åšä»»ä½•çš„é…ç½®ï¼Œsecurity å°±å·²ç»å¼€å§‹å·¥ä½œäº†ï¼Œä»–é»˜è®¤ä¼šéªŒè¯æ‰€æœ‰è¯·æ±‚åªæœ‰ç™»å½•çš„æƒ…å†µä¸‹æ‰å¯ä»¥è®¿é—®ï¼Œå¹¶ä¸”ä¸ºæˆ‘ä»¬æä¾›äº†ç™»å½•é¡µé¢ï¼š</p><p><img src="/img/security-02.jpg" alt=""></p><p>security é»˜è®¤æä¾›çš„ç™»å½•ç”¨æˆ·åä¸º <code>user</code>ï¼Œç™»å½•å¯†ç æ˜¯éšæœºåˆ†é…çš„ï¼Œé€šè¿‡æŸ¥çœ‹ç¨‹åºå¯åŠ¨æ—¥å¿—å°±å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using generated security password: f20e3e53-b7fc-4a3b-9d53-f6cc57b9c586</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç”¨æˆ·åå¯†ç åæˆ‘ä»¬å°±å¯ä»¥ç™»å½•äº†ï¼Œsecurity éå¸¸çš„æ™ºèƒ½ï¼Œä»–ä¼šè®°å½•è¢«æ‹¦æˆªä¹‹å‰è®¿é—®çš„é¡µé¢ï¼Œç™»å½•å security ä¼šé‡æ–°è®¿é—®è¯¥é¡µé¢ä»¥æ–¹ä¾¿æ“ä½œï¼Œè¿™å°±æ˜¯ security æœ€ç®€å•çš„ç™»å½•éªŒè¯äº†</p><h2 id="è®¿é—®æƒé™è®¾ç½®-ä¸€">è®¿é—®æƒé™è®¾ç½®(ä¸€)</h2><blockquote><p>è¯·æ±‚çš„æˆæƒéªŒè¯å’Œæ”¾è¡Œ</p></blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œsecurity çš„é»˜è®¤é…ç½®è¿ index é¦–é¡µä¹Ÿè®¿é—®ä¸äº†ï¼Œè¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæˆ‘ä»¬è¦è°ƒæ•´ä¸€ä¸‹é¡µé¢çš„è®¿é—®æƒé™ï¼Œè¿™é‡Œéœ€è¦åˆ›å»º security çš„é…ç½®ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringSecurityçš„é…ç½®ç±»è¦æ±‚</span></span><br><span class="line"><span class="comment"> *   1.æ ‡æ³¨äº†<span class="doctag">@EnableWebSecurity</span>æ³¨è§£</span></span><br><span class="line"><span class="comment"> *   2.ç»§æ‰¿äº†WebSecurityConfigurerAdapteræŠ½è±¡ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ç±»åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦å¤å†™å…¶ä¸­çš„ <code>configure</code> æ–¹æ³•æ¥è‡ªå®šä¹‰è®¿é—®æƒé™ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯é‡å†™çš„æ–¹æ³•æ˜¯é‡è½½æ–¹æ³•ï¼Œå‚æ•°åˆ—è¡¨ä¸ºï¼š<code>HttpSecurity http</code> ä¸è¦é‡å†™é”™äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚æµç¨‹ï¼šè®¿é—®æ§åˆ¶å™¨ GetMapping(&quot;/&quot;) è·³è½¬åˆ°è§†å›¾ &quot;index.html&quot;</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// authorizeRequestsï¼šè¿™é‡Œè¦è®¾ç½®æ ¹æ®è¯·æ±‚è¿›è¡ŒæˆæƒéªŒè¯</span></span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                <span class="comment">// antMatchersï¼šå¦‚æœæ–¹æ³•è®¿é—®çš„æ˜¯è¿™äº›è¯·æ±‚åœ°å€</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>)</span><br><span class="line">                <span class="comment">// permitAllï¼šä¸è¿›è¡ŒéªŒè¯ï¼Œç›´æ¥æ”¾è¡Œå¯ç›´æ¥è¿›è¡Œè®¿é—®</span></span><br><span class="line">                .permitAll()</span><br><span class="line">                <span class="comment">// å‰©ä¸‹çš„æ‰€æœ‰è¯·æ±‚</span></span><br><span class="line">                .anyRequest()</span><br><span class="line">                <span class="comment">// éƒ½è¦è¿›è¡ŒæˆæƒéªŒè¯</span></span><br><span class="line">                .authenticated();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰€æœ‰å…³äºè¯·æ±‚éªŒè¯æ–¹é¢çš„æ“ä½œéƒ½éœ€è¦åœ¨ <strong>http.authorizeRequests()</strong> ä¸‹è¿›è¡Œ</li></ul><p>å¯¹å“ªäº›è¯·æ±‚æ“ä½œå¯ä»¥é€šè¿‡ <code>antMatchers</code> è¿›è¡Œæ·»åŠ ï¼Œä¾‹å¦‚å¯¹ / æˆ–è€…å¯¹ index.html è¯·æ±‚è¿›è¡Œæ“ä½œï¼Œ<code>anyRequest</code> ä»£è¡¨å‰©ä¸‹çš„æ‰€æœ‰è¯·æ±‚ï¼Œè€Œå…·ä½“æ‰§è¡Œä»€ä¹ˆæ“ä½œå¯ä»¥é€šè¿‡ <code>permitAll</code> å’Œ <code>authenticated</code> è¿›è¡Œè®¾ç½®</p><p>å¦‚ä¸Šè®¾ç½®åï¼Œå°±å¯ä»¥åœ¨æœªç™»å½•çš„æƒ…å†µä¸‹è®¿é—® index ç¨‹åºé¦–é¡µï¼Œè€Œè®¿é—® level1 2 3 ç­‰å°±éœ€è¦è¿›è¡Œç™»å½•ï¼Œç›´æ¥è®¿é—®ä¼šæç¤º 403 Forbidden æ²¡æœ‰æƒé™è®¿é—®</p><p><img src="/img/security-03.jpg" alt=""></p><h2 id="ç™»å½•è¡¨å•è®¾ç½®">ç™»å½•è¡¨å•è®¾ç½®</h2><h3 id="ç®€å•ç™»å½•æˆæƒ">ç®€å•ç™»å½•æˆæƒ</h3><p>ä¸Šé¢é€šè¿‡é‡å†™ <code>configure(HttpSecurity http)</code> æ–¹æ³•å®ç°äº†è¯·æ±‚çš„æˆæƒä¸æ”¾è¡Œï¼Œä»¥åŠæˆæƒå¤±è´¥åçš„ 403 é¡µé¢ï¼Œä½†æ˜¯ä¹‹å‰æˆ‘ä»¬æ²¡æœ‰è®¾ç½®çš„æ—¶å€™ä»–ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ·»åŠ ä¸€ä¸‹è¡¨å•çš„ç›¸å…³è®¾ç½®äº†</p><p>ä¹‹å‰è¯´è¿‡ <code>authorizeRequests</code> æ˜¯æ ¹æ®è¯·æ±‚è¿›è¡ŒæˆæƒéªŒè¯ï¼ŒéªŒè¯éƒ¨åˆ†ç»“æŸåå¼€å§‹è¿›è¡Œè¡¨å•æ–¹é¢è®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨ <code>formLogin</code> æ¥å¯¹è¡¨å•è¿›è¡Œæ“ä½œï¼Œ<strong>å½“è¿›è¡Œä¸¤ç§ä¸åŒæ“ä½œçš„æ—¶å€™ï¼Œä¸­é—´éœ€è¦ç”¨ <code>and()</code> è¿æ¥</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>).permitAll()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">            <span class="comment">// æ·»åŠ è¡¨å•æ–¹é¢çš„è®¾ç½®</span></span><br><span class="line">            .formLogin();  <span class="comment">// è¿™ä¸€å¥è¯å°±å¯ä»¥å¼€å¯ç™»å½•è¡¨å•äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ  <code>formLogin</code> ä¹‹åï¼Œè®¿é—® level 1 2 3 é¡µé¢å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ° security ä¸ºæˆ‘ä»¬æä¾›çš„ç™»å½•é¡µï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç åæ‰€æœ‰é¡µé¢å°±éƒ½å¯ä»¥è®¿é—®äº†</p><h3 id="è‡ªå®šä¹‰ç™»å½•è®¾ç½®">è‡ªå®šä¹‰ç™»å½•è®¾ç½®</h3><blockquote><p>ç™»å½•é¡µé¢è®¾ç½®</p></blockquote><p>security ä¸ºæˆ‘ä»¬æä¾›äº†ç™»å½•é¡µé¢å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æœ‰ç‚¹ä¸å¤ªå¥½çœ‹ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºä¸­è¦æ±‚æ¯ä¸ªé¡µé¢éƒ½è¦è´´åˆä¸»é¢˜çš„ï¼Œè¿™ä¸ªé¡µé¢æœªå…æœ‰äº›å¤ªçªå…€äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">                <span class="comment">// æ¶‰åŠåˆ°æ‰€æœ‰æœ‰å…³è¯·æ±‚çš„è·¯å¾„éƒ½éœ€è¦åœ¨è¿™é‡Œé…ç½®è¿‡æ»¤</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/toLogin&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;/views/login.html&quot;</span>, <span class="string">&quot;/login&quot;</span>)</span><br><span class="line">                .permitAll().anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/toLogin&quot;</span>);  <span class="comment">// è‡ªå®šä¹‰ç™»å½•é¡µä¸ºtoLoginåœ°å€</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•é…ç½® <code>loginPage</code> ä¹‹åï¼Œæˆ‘ä»¬çš„è‡ªå®šä¹‰ç™»å½•é¡µå°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¿®æ”¹ä¸€ä¸‹è¡¨å•çš„ name ä»¥åŠæäº¤åœ°å€</p><blockquote><p>ä¿®æ”¹è¡¨å•æäº¤åœ°å€ä»¥åŠè¡¨å•é¡¹</p></blockquote><p>security æä¾›çš„ç™»å½•é¡µè¡¨å•çš„ name å’Œæäº¤çš„ action åœ°å€éƒ½æ˜¯é¢„è®¾å¥½çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦å…ˆè·å–ä¸€ä¸‹ç„¶åæ”¾åˆ°è‡ªå·±çš„ç™»å½•é¡µé¢ä¸­</p><p><img src="/img/security-04.jpg" alt=""></p><p>å½“æˆ‘ä»¬é…ç½®å¥½è¦æ±‚åå»è¿›è¡Œç™»å½•ï¼Œç»“æœ <strong>è¯·æ±‚çš„åœ°å€ä¸å­˜åœ¨404</strong>ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨<strong>è‡ªå®šä¹‰ç™»å½•é¡µé¢çš„åŒæ—¶ä¹Ÿå½±å“åˆ°äº†è¡¨å•æäº¤åœ°å€</strong>ï¼Œ<em>è¡¨å•çš„æäº¤åœ°å€å’Œè‡ªå®šä¹‰çš„ç™»å½•åœ°å€ç›¸åŒ</em>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬é€šè¿‡ get è¯·æ±‚è®¿é—® toLogin è·³è½¬åˆ°äº†ç™»å½•é¡µé¢ï¼Œç„¶åéœ€è¦é€šè¿‡ post è¯·æ±‚è®¿é—® toLogin è¿›è¡Œç™»å½•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">        .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/toLogin&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;/views/login.html&quot;</span>, <span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">        .permitAll().anyRequest().authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/toLogin&quot;</span>)  <span class="comment">// è‡ªå®šä¹‰ç™»å½•é¡µ</span></span><br><span class="line">        .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>); <span class="comment">// è¡¨å•çš„POSTæäº¤åœ°å€æ¥å£ï¼Œæ— éœ€è‡ªå·±å®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬çš„ç™»å½•åå¹¶ä¸æ˜¯ username ä»¥åŠ passwordï¼Œå¯èƒ½æ˜¯ä¸€äº›å…¶ä»–çš„å€¼ï¼Œè€Œä¸”è¡¨å•çš„æäº¤åœ°å€ä¹Ÿä¸æƒ³å’Œé¡µé¢ä½¿ç”¨åŒä¸€ä¸ªåœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ“ä½œæ¥å®Œæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">        .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/toLogin&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;/views/login.html&quot;</span>, <span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">        .permitAll().anyRequest().authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/toLogin&quot;</span>)</span><br><span class="line">        .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">        .usernameParameter(<span class="string">&quot;name&quot;</span>)  <span class="comment">// è‡ªå®šä¹‰usernameè¡¨å•çš„nameå±æ€§å€¼</span></span><br><span class="line">        .passwordParameter(<span class="string">&quot;pwd&quot;</span>)  <span class="comment">// è‡ªå®šä¹‰passwordè¡¨å•ä¸­çš„nameå±æ€§å€¼</span></span><br><span class="line">        .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>);  <span class="comment">// è‡ªå®šä¹‰è¡¨å•è¯·æ±‚åœ°å€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç™»å½•æˆåŠŸåçš„è§†å›¾è·³è½¬">ç™»å½•æˆåŠŸåçš„è§†å›¾è·³è½¬</h3><p>è¿™é‡Œäº†è§£ä¸€ä¸‹ç™»å½•æˆåŠŸå’Œå¤±è´¥çš„é¡µé¢è·³è½¬å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/toLogin&quot;</span>,<span class="string">&quot;/views/login.html&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;/doLogin&quot;</span>, <span class="string">&quot;/toPage/success&quot;</span>)</span><br><span class="line">                .permitAll().anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/toLogin&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">                .usernameParameter(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">                <span class="comment">// ç™»å½•æˆåŠŸåé»˜è®¤è·³è½¬çš„é¡µé¢</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/toPage/success&quot;</span>)</span><br><span class="line">             <span class="comment">// ç™»å½•å¤±è´¥åè·³è½¬çš„é¡µé¢</span></span><br><span class="line">                .failureUrl(<span class="string">&quot;/toPage/error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>defaultSuccessUrl</code> è®¾ç½®çš„æ˜¯é»˜è®¤æˆåŠŸçš„é¡µé¢ï¼Œä½†å¦‚æœæ˜¯é€šè¿‡è®¿é—®å…¶ä»–é¡µé¢è¢«è¿‡æ»¤åè·³è½¬åˆ°ç™»å½•é¡µçš„è¯ï¼Œè¿™é¡¹è®¾ç½®å°±ä¸ä¼šèµ·ä½œç”¨</li></ul><h2 id="ç”¨æˆ·ç™»å½•è®¾ç½®">ç”¨æˆ·ç™»å½•è®¾ç½®</h2><p>ä¹‹å‰æˆ‘ä»¬ç™»å½•æ—¶éƒ½æ˜¯é€šè¿‡æ—¥å¿—æä¾›çš„ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨è‡ªå·±çš„ç”¨æˆ·è¿›è¡Œç™»å½•</p><p>æˆ‘ä»¬åœ¨å®ç°è¯·æ±‚éªŒè¯ä»¥åŠè¡¨å•æ“ä½œçš„æ—¶å€™éƒ½æ˜¯å¤å†™äº†çˆ¶ç±»çš„ <code>configure(HttpSecurity http)</code> å®Œæˆæ“ä½œçš„ï¼Œæ¥ä¸‹æ¥çš„ç”¨æˆ·ç™»å½•ç›¸å…³æ“ä½œéœ€è¦å¤å†™å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼š<code>configure(AuthenticationManagerBuilder auth)</code></p><h3 id="å†…å­˜æ¨¡æ‹Ÿç™»å½•">å†…å­˜æ¨¡æ‹Ÿç™»å½•</h3><p>é¦–å…ˆå¤å†™çˆ¶ç±»ä¸­çš„å‡½æ•°ï¼Œç„¶åé…ç½®å†…å­˜æ¨¡æ‹Ÿç™»é™†ï¼Œéœ€è¦æä¸€å˜´çš„æ˜¯é«˜ç‰ˆæœ¬çš„ security è¦æ±‚å¿…é¡»ä½¿ç”¨åŠ å¯†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">PasswordEncoder</span> <span class="variable">noEncrypt</span> <span class="operator">=</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    auth.inMemoryAuthentication()  <span class="comment">// åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿç”¨æˆ·</span></span><br><span class="line">        .passwordEncoder(noEncrypt) <span class="comment">// è®¾ç½®åŠ å¯†æ–¹å¼</span></span><br><span class="line">        .withUser(<span class="string">&quot;zhang&quot;</span>)    <span class="comment">// æ·»åŠ ç”¨æˆ·</span></span><br><span class="line">        .password(<span class="string">&quot;hanzhe&quot;</span>)</span><br><span class="line">        .authorities(<span class="string">&quot;ç”¨æˆ·åˆ—è¡¨:æŸ¥è¯¢&quot;</span>)</span><br><span class="line">        .and()  <span class="comment">// é€šè¿‡and()è¿æ¥æ— é™æ·»åŠ ç”¨æˆ·</span></span><br><span class="line">        .withUser(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">        .password(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">        .roles(<span class="string">&quot;ç®¡ç†å‘˜&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>inMemoryAuthentication</code>ï¼šä»£è¡¨ç”¨æˆ·ä¿¡æ¯åœ¨å†…å­˜ä¸­å–</li><li><code>passwordEncoder</code>ï¼š<strong>é«˜ç‰ˆæœ¬çš„ security è¦æ±‚å¿…é¡»å¯¹ç™»å½•å¯†ç è¿›è¡ŒåŠ å¯†</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬æµ‹è¯•æ—¶ä¸æƒ³ä½¿ç”¨åŠ å¯†ï¼Œæ‰€ä»¥å°±é€šè¿‡ <code>NoOpPasswordEncoder</code> è·å–äº†å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å¹¶ä¸ä¼šå¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œä»–ä½œç”¨å°±æ˜¯å ä¸ªä½ï¼Œä»è€Œå®ç°é…ç½®äº†åŠ å¯†çš„åŒæ—¶ä¸æ‰§è¡ŒåŠ å¯†æ“ä½œï¼ŒåŠ å¯†å…·ä½“åé¢ä¼šæ</li><li><code>withUser</code>ï¼šæ·»åŠ ç”¨æˆ·ï¼Œéœ€è¦ä¼ å…¥ç”¨æˆ·åè¿›è¡Œç™»å½•ï¼Œåé¢ç´§è·Ÿçš„å‡ ä¸ªæ–¹æ³•å°±æ˜¯å½“å‰ç”¨æˆ·çš„ <code>password</code> å¯†ç ï¼Œ<code>roles</code> è§’è‰²å’Œ <code>authorities</code> æƒé™ç­‰ï¼Œé€šè¿‡ <code>and</code> å¯ä»¥æ— é™é“¾æ¥æ·»åŠ ç”¨æˆ·</li><li>æ³¨æ„äº‹é¡¹ï¼š<ul><li>æ¯ä¸ªç”¨æˆ·åº”è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªè§’è‰²æˆ–è€…æƒé™ï¼Œå¦åˆ™ä¸å…è®¸ç™»å½•</li><li>è§’è‰²å’Œæƒé™çš„å‘½åéƒ½ä¸å…è®¸ä½¿ç”¨ â€œROLE_â€ å¼€å¤´</li></ul></li></ul><p>è¿™æ ·ä¸€æ¥å†…å­˜æ¨¡æ‹Ÿç™»å½•å°±ç®€å•å®Œæˆäº†ï¼Œå¯åŠ¨ç¨‹åºåæœ€æ˜æ˜¾çš„å°±æ˜¯æ—¥å¿—ä¸­ä¸ä¼šåœ¨æä¾› user ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå·±æ·»åŠ çš„ç”¨æˆ·è¿›è¡Œç™»å½•ã€‚</p><h3 id="è¿æ¥æ•°æ®åº“ç™»å½•">è¿æ¥æ•°æ®åº“ç™»å½•</h3><blockquote><p>å‰ç½®å‡†å¤‡ï¼šentity dao service</p></blockquote><p><i>è¿™é‡Œç®€å•å·ä¸ªæ‡’ï¼Œåœ¨Serviceä¸­å†™äº†å‡æ•°æ®æ²¡æœ‰ daoæ²¡è¿æ•°æ®åº“ï¼Œä¸è¿‡é“ç†æ˜¯ä¸€æ ·çš„</i></p><p>ä¸Šé¢æˆ‘ä»¬é€šè¿‡ <code>inMemoryAuthentication</code> æ¥æ¨¡æ‹Ÿå†…å­˜ç™»å½•ï¼Œæ¥ä¸‹æ¥é€šè¿‡ <strong><code>UserDetailsService</code></strong> æ¥è¿›è¡Œç™»å½•ï¼Œå‡†å¤‡å¥½å®ä½“ç±»ä»¥åŠ serviceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ä½“ç±»</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// serviceå±‚</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"> <span class="comment">// ç”¨äºå­˜å‚¨ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;UserEntity&gt; userList = <span class="literal">null</span>;</span><br><span class="line"> <span class="comment">// æ¨¡æ‹Ÿçš„ç”¨æˆ·å‡æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;zhang&quot;</span>, <span class="string">&quot;18D7044C8EAF484A1C498379BA770E1E&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;21232F297A57A5A743894A0E4A801FC3&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">// é€šè¿‡ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> UserEntity <span class="title function_">selectUserByUsername</span><span class="params">(String username)</span>&#123;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡è·å–ä¿¡æ¯ä¹‹å‰éƒ½è¦é‡ç½®ä¸€ä¸‹ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.initUserList();</span><br><span class="line">        List&lt;UserEntity&gt; collect = userList.stream()</span><br><span class="line">                .filter(item -&gt; item.getUsername().equals(username))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> collect.size() == <span class="number">1</span> ? collect.get(<span class="number">0</span>) : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®ç±»ä»£ç </p></blockquote><p>ä¹‹å‰é…ç½®åœ¨å†…å­˜ä¸­ç™»å½•æ—¶ä½¿ç”¨çš„æ˜¯ <code>auth.inMemoryAuthentication()</code> æ–¹æ³•ï¼Œè¿™å›é…ç½®æ•°æ®åº“ç™»å½•åä½¿ç”¨çš„æ˜¯ <code>auth.userDetailsService</code> æ–¹æ³•ï¼Œè¿™é‡Œéœ€è¦ä¼ å…¥ <code>UserDetailsService</code> çš„å®ä¾‹ï¼Œè€Œ<code>UserDetailsService</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œä¸”æ˜¯æ”¯æŒå‡½æ•°å¼çš„æ¥å£ï¼Œè¿™é‡Œå°±ä½¿ç”¨ lambda è¡¨è¾¾å¼è¿›è¡Œæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">PasswordEncoder</span> <span class="variable">noEncrypt</span> <span class="operator">=</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    <span class="comment">// å‡½æ•°æ¥æ”¶çš„usernameå°±æ˜¯ç™»å½•è¡¨å•æäº¤çš„username</span></span><br><span class="line">    auth.userDetailsService((String username)-&gt;&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * è¿™ä¸ªé›†åˆæ˜¯å¿…é¡»å¾—æœ‰çš„ï¼Œç”¨äºå­˜å‚¨è§’è‰²å’Œæƒé™çš„é›†åˆï¼Œå…¶ä¸­è§’è‰²ç”± &quot;ROLE_&quot; å¼€å¤´ï¼Œæƒé™æ­£å¸¸æ·»</span></span><br><span class="line"><span class="comment">         * åŠ å³å¯ï¼Œæ­£æ˜¯å› ä¸ºè¿™é‡Œéœ€è¦é€šè¿‡ ROLE_ å¼€å¤´æ¥åŒºåˆ†è§’è‰²å’Œæƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå·±åˆ›å»ºè§’è‰²æˆ–æƒé™</span></span><br><span class="line"><span class="comment">         * çš„æ—¶å€™ä¸å¯ä»¥ä½¿ç”¨ ROLE_ å¼€å¤´ï¼Œä¸ç„¶åœ¨è¿™ä¸ªåœ°æ–¹ä¼šå½±å“ç¨‹åºçš„è¿è¡Œ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// é€šè¿‡usernameæŸ¥è¯¢è¯¥ç”¨æˆ·çš„å®ä½“ä¿¡æ¯</span></span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">userEntity</span> <span class="operator">=</span> userService.selectUserByUsername(username);</span><br><span class="line">        <span class="comment">// é€šè¿‡ç”¨æˆ·æŸ¥è¯¢ä»–æ‰€æ‹¥æœ‰çš„æƒé™ä»¥åŠè§’è‰²ï¼Œç„¶åæ’å…¥åˆ°é›†åˆä¸­</span></span><br><span class="line">        <span class="keyword">if</span> ( <span class="string">&quot;admin&quot;</span>.equals(username) )    <span class="comment">// è§’è‰²è¦ä»¥ROLE_å¼€å¤´å­˜å‚¨</span></span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_ç®¡ç†å‘˜&quot;</span>));</span><br><span class="line">        <span class="keyword">else</span> authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ç”¨æˆ·åˆ—è¡¨:æŸ¥è¯¢&quot;</span>));</span><br><span class="line">        <span class="comment">// æœ€åå°†ç”¨æˆ·åï¼Œå¯†ç ï¼Œæƒé™ä¿¡æ¯ç­‰å°è£…ä¸ºä¸€ä¸ªUserå¯¹è±¡ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªUseræ˜¯securityåŒ…ä¸‹çš„ç±»</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(username, userEntity.getPassword(), authorities);</span><br><span class="line">    &#125;).passwordEncoder(noEncrypt); <span class="comment">// åŠ å¯†é…ç½®ä¸èƒ½å¿˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥å°±é…ç½®å®Œæˆäº†ï¼Œåªè¦è‡ªè¡Œè¿æ¥æ•°æ®åº“é€šè¿‡ service è°ƒç”¨ daoï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“çš„ç™»å½•</p><h3 id="å…³äºåŠ å¯†é…ç½®">å…³äºåŠ å¯†é…ç½®</h3><p>æ— è®ºæ˜¯å†…å­˜æ¨¡æ‹Ÿç™»å½• <code>inMemoryAuthentication</code> è¿˜æ˜¯æ•°æ®åº“ç™»å½• <code>userDetailsService</code>ï¼Œåœ¨ç”¨æˆ·ä¿¡æ¯é…ç½®å®Œæˆä¹‹åéƒ½ä¼šè°ƒç”¨ <code>passwordEncoder</code> ä¼ å…¥ä¸€ä¸ªåŠ å¯†å®ä¾‹è¿›è¡Œå¯†ç åŠ å¯†ï¼Œä¹‹å‰å›¾çœäº‹ç”¨äº† <code>NoOpPasswordEncoder</code> çš„å®ä¾‹ï¼Œä»–çš„ä½œç”¨æ˜¯ä¸å¯¹å¯†ç è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œå½“æˆ‘ä»¬åœ¨çœŸå®å¼€å‘ç¯å¢ƒä¸‹çš„æ—¶å€™æ•°æ®åº“æ˜¯ä¸å»ºè®®å­˜å‚¨æ˜æ–‡å¯†ç çš„ï¼Œæ‰€ä»¥åœ¨ security ä¸­åŠ å¯†æ˜¯å¿…é¡»é…ç½®çš„ï¼Œè¿™é‡Œå°±äº†è§£ä¸€ä¸‹å¦‚ä½•é…ç½®åŠ å¯†</p><h4 id="ä½¿ç”¨MD5åŠ å¯†">ä½¿ç”¨MD5åŠ å¯†</h4><blockquote><p>é¦–å…ˆå‡†å¤‡ MD5 çš„åŠ å¯†å·¥å…·ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MD5Util</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">toMD5</span><span class="params">(String source)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">md5</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] digest = md5.digest(source.getBytes());</span><br><span class="line">            target = <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, digest).toString(<span class="number">16</span>).toUpperCase();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºSecurityçš„å¯†ç åŠ å¯†é…ç½®ç±»</p></blockquote><p>ç‚¹è¿› <code>passwordEncoder</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–éœ€è¦çš„æ˜¯ <code>PasswordEncoder</code> çš„å®ä¾‹ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ªç±»æ¥å®ç°è¿™ä¸ª <code>PasswordEncoder</code> æ¥å£ç±»æ¥è‡ªå®šä¹‰åŠ å¯†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Securityçš„å¯†ç åŠ å¯†ç±»ï¼Œåªéœ€è¦å®ç°encodeå’Œmatchesæ–¹æ³•å³å¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PwdEncoderConfig</span> <span class="keyword">implements</span> <span class="title class_">PasswordEncoder</span> &#123;</span><br><span class="line"> <span class="comment">// ç”¨äºå¯†ç åŠ å¯†çš„æ–¹æ³•ï¼ŒrawPasswordä¸ºæˆ‘ä»¬åœ¨è¡¨å•æäº¤çš„æ˜æ–‡å¯†ç </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(CharSequence rawPassword)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MD5Util.toMD5(rawPassword.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯†ç æ˜¯å¦ç›¸åŒï¼ŒrawPasswordä¸ºè¡¨å•å¯†ç ï¼ŒencodedPasswordä¸ºæ•°æ®åº“å¯†ç </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MD5Util.toMD5(rawPassword.toString()).equals(encodedPassword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å›åˆ° Security é…ç½®ç±»é…ç½®ç±»ä¸­ä¼ å…¥åŠ å¯†å¯¹è±¡å³å¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// çœç•¥ä¸€å¤§æ»©ä»£ç </span></span><br><span class="line">    auth.userDetailsService((String username)-&gt;&#123;......&#125;)</span><br><span class="line">        <span class="comment">// è¿™é‡Œä¼ å…¥äº†è‡ªå®šä¹‰çš„MD5åŠ å¯†ç®—æ³•</span></span><br><span class="line">        .passwordEncoder(<span class="keyword">new</span> <span class="title class_">PwdEncoderConfig</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°† service ä¸­æµ‹è¯•çš„å¯†ç é€šè¿‡ md5 åŠ å¯†ä¸€ä¸‹å°±å¯ä»¥éªŒè¯æ•ˆæœäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;zhang&quot;</span>, <span class="string">&quot;18D7044C8EAF484A1C498379BA770E1E&quot;</span>));  <span class="comment">// hanzhe</span></span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;21232F297A57A5A743894A0E4A801FC3&quot;</span>));  <span class="comment">// admin</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ç›å€¼åŠ å¯†">ä½¿ç”¨ç›å€¼åŠ å¯†</h4><p>MD5 åŠ å¯†åªæ˜¯æˆ‘ä»¬ç”¨æ¥æµ‹è¯•è‡ªå®šä¹‰åŠ å¯†çš„è”ç³»ï¼ŒMD5 è™½ç„¶æ˜¯ä¸å¯é€†çš„ç®—æ³•ï¼Œä½†æ˜¯åŠ å¯†åçš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œæœ‰å¿ƒäººé€šè¿‡æš´åŠ›ç ´è§£è¿˜æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è¦ä½¿ç”¨ security æ¨èçš„ç›å€¼åŠ å¯†ï¼Œä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.userDetailsService((String username)-&gt;&#123;......&#125;)</span><br><span class="line">        <span class="comment">// æ¢ä¸€ä¸ªå®ä¾‹ç»™ä»–å°±è¡Œäº†.....</span></span><br><span class="line">        .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è·å–ç™»å½•äººä¿¡æ¯">è·å–ç™»å½•äººä¿¡æ¯</h3><h4 id="åœ¨æ§åˆ¶å™¨ä¸­è·å–">åœ¨æ§åˆ¶å™¨ä¸­è·å–</h4><p>æˆ‘ä»¬åœ¨å¹³æ—¶å¼€å‘ä¸­éƒ½æ˜¯è®²ç™»å½•ä¿¡æ¯å­˜å‚¨åˆ° session ä¸­çš„ï¼Œåœ¨æ§åˆ¶å™¨ä¸­é€šè¿‡ HttpSession è·å–åˆ°å½“å‰ç”¨æˆ·çš„æ˜µç§°ã€è´¦å·ç­‰å…¶ä»–ä¿¡æ¯ï¼Œsecurity çš„è¯æˆ‘ä»¬æƒ³è¦è·å–åˆ°ä¿¡æ¯éœ€è¦åœ¨å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ ä»¥ä¸‹å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toIndex</span><span class="params">(Principal principal)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ç™»å½•äººä¿¡æ¯===&gt;&gt;&quot;</span> + principal);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*  æ‰“å°åå¾—åˆ°ï¼š</span></span><br><span class="line"><span class="comment">UsernamePasswordAuthenticationToken[Principal=org.springframework.security.core.userdetails.User [Username=zhang, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, credentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ç”¨æˆ·åˆ—è¡¨:æŸ¥è¯¢]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=92FCFF1A0CAF7E8E74C886874D73049A], Granted Authorities=[ç”¨æˆ·åˆ—è¡¨:æŸ¥è¯¢]]  */</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰ username å’Œ password ä»¥åŠè§’è‰²æƒé™ä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è·å¾—æ›´å¤šä¾‹å¦‚æ˜µç§°ã€æ€§åˆ«ã€ç”Ÿæ—¥ä»¥åŠæ³¨å†Œä¿¡æ¯ç­‰ç­‰éƒ½æ²¡æœ‰æä¾›</p><p>ä»”ç»†ä¸€çœ‹æ‰“å°ç»“æœï¼Œå‘ç°ç”¨æˆ·ä¿¡æ¯éƒ½å°è£…åœ¨äº† <code>org.springframework.security.core.userdetails.User</code> ç±»ä¸­ï¼Œè¿™ä¸ªç±»åœ¨ç»ƒä¹ ã€ç™»å½•ç”¨æˆ·è®¾ç½® â†’ è¿æ¥æ•°æ®åº“ç™»å½•ã€‘æ—¶å°†ç”¨æˆ·ä¿¡æ¯ä»¥åŠè§’è‰²æƒé™å°è£…çš„ä½ç½®ç”¨è¿‡ï¼Œè¿™ä¹ˆè¯´æ¥æˆ‘ä»¬è·å–çš„å…¶å®æ˜¯è¿™ä¸ªç±»çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ä¹‹å‰çš„ä»£ç </p><blockquote><p>åˆ›å»ºæ–°çš„ç±»ç»§æ‰¿ security çš„ User ç±»</p></blockquote><p>åœ¨æ–°çš„ <code>UserSecurityEntity</code> ç±»ä¸­å£°æ˜ä¸€ä¸ª entity å±æ€§ï¼Œä»£è¡¨å½“å‰ç™»å½•äººçš„å®ä½“ï¼Œå¹¶å¯¹å¤–æä¾› get æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SpringSecurityå°è£…ç”¨æˆ·ç™»å½•ä¿¡æ¯çš„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSecurityEntity</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserEntity entity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserSecurityEntity</span><span class="params">(</span></span><br><span class="line"><span class="params">          UserEntity entity,</span></span><br><span class="line"><span class="params">          Collection&lt;GrantedAuthority&gt; authorities)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(entity.getUsername(), entity.getPassword(), authorities);</span><br><span class="line">        entity.setPassword(<span class="string">&quot;******&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.entity = entity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserEntity <span class="title function_">getEntity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.entity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹ä¹‹å‰çš„æ•°æ®åº“ç™»å½•ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.userDetailsService((String username)-&gt;&#123;  <span class="comment">// çœç•¥ä¸€æ»©ä»£ç .......</span></span><br><span class="line">        <span class="comment">// å°† new User æ›´æ¢ä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ç±»</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserSecurityEntity</span>(userEntity, authorities);</span><br><span class="line">    &#125;).passwordEncoder(<span class="keyword">new</span> <span class="title class_">PwdEncoderConfig</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å›åˆ°æ§åˆ¶å™¨ä¸­åœ¨æŸ¥çœ‹æ‰“å°å‡ºæ¥çš„ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•äººä¿¡æ¯===&gt;&gt;UsernamePasswordAuthenticationToken [Principal=site.hanzhe.security.UserSecurityEntity [Username=zhang...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œé‡Œé¢å·²ç»æœ‰æˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„é‚£ä¸ªç±»äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥é€šè¿‡ç±»å‹è½¬æ¢æ¥è·å–åˆ° entity å°±ä¸‡äº‹å¤§å‰å•¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toLevelX</span><span class="params">(Principal principal)</span>&#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">p</span> <span class="operator">=</span> ((UsernamePasswordAuthenticationToken) principal).getPrincipal();</span><br><span class="line">    <span class="type">UserEntity</span> <span class="variable">entity</span> <span class="operator">=</span> ((UserSecurityEntity) p).getEntity();</span><br><span class="line">    <span class="comment">// è·å–æˆåŠŸï¼ï¼ï¼ï¼ï¼</span></span><br><span class="line">    System.out.println(entity);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœ¨é¡µé¢ä¸Šè·å–">åœ¨é¡µé¢ä¸Šè·å–</h4><p>åœ¨é¡µé¢ä¸Šä½¿ç”¨ thymeleaf é™¤äº†åœºæ™¯å¯åŠ¨å™¨ä¹‹å¤–è¿˜éœ€è¦æ·»åŠ å¦ä¸€ä¸ªä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç‰ˆæœ¬å·å·²åœ¨çˆ¶å·¥ç¨‹ä¸­è®¾ç½®å¥½äº†ï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ å¥½ä¾èµ–åï¼Œè¿˜éœ€è¦åœ¨å¯¹åº”ä½¿ç”¨ security çš„é¡µé¢ä¸­æ·»åŠ  <code>sec</code> çš„å¼•ç”¨ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity5&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">secæ¨èä½¿ç”¨ä¸Šé¢çš„URLï¼Œå¦‚æœæ²¡æœ‰ä»£ç æç¤ºå¯ä»¥è€ƒè™‘æ¢ä¸ºï¼š</span></span><br><span class="line"><span class="comment">xmlns:sec=&quot;http://www.thymeleaf.org/extras/spring-security&quot;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨é¡µé¢ä¸­è·å–åˆ° entity ä¿¡æ¯ ( åŸºäºä¹‹å‰ä¿®æ”¹å¥½çš„ä»£ç æ‰å¯ä»¥è¿™ä¹ˆè·å– )ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;principal.entity&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è®°ä½æˆ‘ç™»å½•çŠ¶æ€">è®°ä½æˆ‘ç™»å½•çŠ¶æ€</h3><p>æˆ‘ä»¬ç™»å½•æˆåŠŸä¹‹åå¯ä»¥è®¿é—®æ‰€æœ‰é¡µé¢ï¼Œæ ¹æ®æ­£å¸¸æµç¨‹æ¥è¯´å½“æˆ‘é‡å¯æµè§ˆå™¨åå†æ¬¡è®¿é—®è¿™ä¸ªé¡µé¢æ—¶ï¼Œä»–ä¼šè®©æˆ‘ä»¬ä½ é‡æ–°ç™»å½•ï¼Œç°åœ¨æˆ‘ä»¬è¦å®ç°ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ï¼Œsecurity ä¸ºæˆ‘ä»¬æä¾›äº† <strong>è®°ä½æˆ‘</strong> åŠŸèƒ½ï¼Œé€šè¿‡ <code>Cookie</code> å®ç°äº†é‡å¯æµè§ˆå™¨ä¹Ÿå¯ä»¥ä¿æŒç™»å½•çŠ¶æ€ï¼Œè€Œå¼€å¯è¿™ä¸ªåŠŸèƒ½åªéœ€è¦ä¸€ä¸ªæ–¹æ³•å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">        ........</span><br><span class="line">        .rememberMe()  <span class="comment">// å¼€å¯&quot;è®°ä½æˆ‘&quot;åŠŸèƒ½</span></span><br><span class="line">        .rememberMeParameter(<span class="string">&quot;remember&quot;</span>); <span class="comment">// è¡¨å•checkboxçš„nameå±æ€§å€¼ï¼Œé»˜è®¤ä¸ºremember-me</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨é”€ç™»å½•çŠ¶æ€"><em>æ³¨é”€ç™»å½•çŠ¶æ€</em></h3><p>ä¹‹å‰æˆ‘ä»¬é€šè¿‡ç§»é™¤ session ä¸­çš„ç™»å½•ä¿¡æ¯æ¥å®ç°é€€å‡ºç™»å½•ï¼Œä½¿ç”¨ security åä¸€ç›´é€šè¿‡å…³é—­æµè§ˆå™¨çš„æ–¹å¼è¿›è¡Œç™»å½•æ³¨é”€ï¼Œåœ¨å­¦ä¹ äº† &quot; è®°ä½æˆ‘ &quot; ç™»å½•çŠ¶æ€ä¹‹åè¿å…³é—­æµè§ˆå™¨éƒ½å¯ä»¥ä¿æŒç™»å½•çŠ¶æ€äº†ï¼Œ æ‰€ä»¥è¿™é‡Œå­¦ä¹ ä¸€ä¸‹æ³¨é”€ç™»å½•</p><p>æ³¨é”€ç™»å½•çš„æ“ä½œä¹Ÿéå¸¸ç®€å•ï¼Œå’Œç™»é™†çš„è¡¨å•è®¾ç½®å·®ä¸å¤šï¼Œåªéœ€è¦å¼€å¯åŠŸèƒ½å¹¶æŒ‡å®šæ§åˆ¶å™¨çš„ URL å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">        ......</span><br><span class="line">        .rememberMe()  <span class="comment">// è®°ä½æˆ‘</span></span><br><span class="line">         .rememberMeParameter(<span class="string">&quot;remember&quot;</span>)</span><br><span class="line">         .and()</span><br><span class="line">        .logout()      <span class="comment">// å¼€å¯æ³¨é”€åŠŸèƒ½</span></span><br><span class="line">            .logoutUrl(<span class="string">&quot;/doLogout&quot;</span>)  <span class="comment">// æŒ‡å®šæ³¨é”€éœ€è¦è¯·æ±‚çš„æ§åˆ¶å™¨åœ°å€ï¼Œæ§åˆ¶å™¨ä»£ç ä¸éœ€è¦æˆ‘ä»¬å®ç°</span></span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;/&quot;</span>);  <span class="comment">// æ³¨é”€æˆåŠŸåè·³è½¬çš„ç›®æ ‡é¡µé¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ · security çš„é…ç½®å°±å®Œæˆäº†ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©å°†é€€å‡ºåŠŸèƒ½æ”¾åˆ° level1/1 çš„é¡µé¢ä¸­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¸»å®¹å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;index::nav-menu&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui segment&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Level-1-1<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span>&gt;</span>è¿”å›é¦–é¡µ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/doLogout&#125;&quot;</span>&gt;</span>é€€å‡ºç™»å½•<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨é”€çš„æ§åˆ¶å™¨å®Œæˆäº†ï¼Œç‚¹å‡»æ³¨é”€çš„è¶…é“¾æ¥ä¹Ÿå®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ç»“æœï¼š</p><p><img src="/img/security-05.jpg" alt=""></p><p>ç»“æœç‚¹å‡»é€€å‡ºç™»å½•ä¹‹åæç¤º 404 äº†ï¼Œè¿™æ˜¯å› ä¸º <em>security å‡ºäºå®‰å…¨è€ƒè™‘é…ç½®äº†é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€  ( CSRF )</em>ï¼Œä»–è¦æ±‚æˆ‘ä»¬çš„<strong>è¯·æ±‚å¿…é¡»æ˜¯ POST è¯·æ±‚ï¼Œä¸”éœ€è¦æºå¸¦å‚æ•° token å‚æ•°</strong>ï¼Œä¹‹å‰çš„ç™»å½•è¡¨å•è™½ç„¶æˆ‘ä»¬æ²¡æœ‰æ·»åŠ  token å‚æ•°ï¼Œä½†æ˜¯ä»”ç»†çœ‹è¯·æ±‚ä¿¡æ¯çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥çœ‹å‡º scurity è‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ äº†è¿™ä¸ªå‚æ•°ï¼š</p><p><img src="/img/security-06.jpg" alt=""></p><p>æˆ‘ä»¬çš„æ³¨é”€æ²¡æœ‰æºå¸¦ token å‚æ•°å¹¶ä¸”ä¸æ˜¯ POST è¯·æ±‚ï¼Œä¸ºäº†çœäº‹è¿™é‡Œé€‰æ‹©<em>å…³é—­ CSRF åŠŸèƒ½</em>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">        ......</span><br><span class="line">        .rememberMe()  <span class="comment">// è®°ä½æˆ‘</span></span><br><span class="line">         .rememberMeParameter(<span class="string">&quot;remember&quot;</span>)</span><br><span class="line">         .and()</span><br><span class="line">        .csrf().disable()  <span class="comment">// å…³é—­è·¨ç«™è¯·æ±‚ä¼ªé€ é˜²æŠ¤åŠŸèƒ½</span></span><br><span class="line">        .logout()      <span class="comment">// å¼€å¯æ³¨é”€åŠŸèƒ½</span></span><br><span class="line">            .logoutUrl(<span class="string">&quot;/doLogout&quot;</span>)  <span class="comment">// æŒ‡å®šæ³¨é”€éœ€è¦è¯·æ±‚çš„æ§åˆ¶å™¨åœ°å€ï¼Œæ§åˆ¶å™¨ä»£ç ä¸éœ€è¦æˆ‘ä»¬å®ç°</span></span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;/&quot;</span>);  <span class="comment">// æ³¨é”€æˆåŠŸåè·³è½¬çš„ç›®æ ‡é¡µé¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**æ‰©å±•ï¼š**æœ‰ä¸€ä¸ªå’Œ <code>csrf().disable()</code> é•¿å¾—éå¸¸åƒçš„ä¸€æ®µä»£ç éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š<code>.cors().disable()</code>ï¼Œè¿™ä¸ªé€šå¸¸åœ¨å‰åç«¯åˆ†ç¦»çš„æƒ…å†µä½¿ç”¨ï¼Œç”¨äºå…³é—­è·¨åŸŸè¯·æ±‚</p><h2 id="è®¿é—®æƒé™è®¾ç½®-äºŒ">è®¿é—®æƒé™è®¾ç½®(äºŒ)</h2><p>ä¹‹å‰ç®€å•å­¦ä¹ äº†ä¸€ä¸‹è®¿é—®æƒé™è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®å“ªäº›é¡µé¢å¯ä»¥ç›´æ¥è®¿é—®ã€å“ªäº›é¡µé¢éœ€è¦ç™»å½•åè®¿é—®ã€è¿˜å¯ä»¥è‡ªå®šä¹‰ç™»å½•é¡µé¢ã€å‚æ•°åç§°ä»¥åŠè¡¨å•è¯·æ±‚åœ°å€ã€ç™»å½•çš„æˆåŠŸå¤±è´¥åˆ†åˆ«è·³è½¬çš„è§†å›¾ï¼Œæ¥ä¸‹æ¥é…åˆè§’è‰²å’Œæƒé™å®ç°æƒé™æ§åˆ¶</p><h3 id="Javaä»£ç æ§åˆ¶æˆæƒ">Javaä»£ç æ§åˆ¶æˆæƒ</h3><blockquote><p>é€šè¿‡æƒé™æ§åˆ¶è®¿é—®æƒé™</p></blockquote><p>é¦–å…ˆè°ƒæ•´ä¸€ä¸‹æµ‹è¯•æ•°æ®ï¼Œä¸ºä»–ä»¬åˆ†é…åˆé€‚çš„è§’è‰²åŠæƒé™ï¼šzhang å…·æœ‰ vip æƒé™ï¼Œadmin å…·æœ‰æ‰€æœ‰æƒé™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¾‘å‡æ•°æ®</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.userDetailsService((String username)-&gt;&#123;</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">userEntity</span> <span class="operator">=</span> userService.selectUserByUsername(username);</span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// zhangåªæœ‰vip1æƒé™ï¼Œadminå…·æœ‰æ‰€æœ‰æƒé™</span></span><br><span class="line">        <span class="keyword">if</span> ( <span class="string">&quot;admin&quot;</span>.equals(username) )&#123;</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;vip1&quot;</span>));</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;vip2&quot;</span>));</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;vip3&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;vip1&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserSecurityEntity</span>(userEntity, authorities);</span><br><span class="line">    &#125;).passwordEncoder(<span class="keyword">new</span> <span class="title class_">PwdEncoderConfig</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†è¯·æ±‚èµ„æºè®¾ç½®æƒé™ï¼Œåªæœ‰åº”æœ‰çš„æƒé™æ‰èƒ½è®¿é—®å¯¹åº”çš„é¡µé¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹æƒé™éªŒè¯è§„åˆ™</span></span><br><span class="line">@<span class="title class_">Override</span></span><br><span class="line">protected <span class="keyword">void</span> <span class="title function_">configure</span>(<span class="title class_">HttpSecurity</span> http) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">    http.<span class="title function_">authorizeRequests</span>()</span><br><span class="line">            .<span class="title function_">antMatchers</span>(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/toLogin&quot;</span>,<span class="string">&quot;/views/login.html&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/doLogin&quot;</span>, <span class="string">&quot;/toPage/success&quot;</span>, <span class="string">&quot;/doLogout&quot;</span>)</span><br><span class="line">            .<span class="title function_">permitAll</span>()</span><br><span class="line">            <span class="comment">// laven1åªæœ‰vip1åŠä»¥ä¸Šæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">            .<span class="title function_">antMatchers</span>(<span class="string">&quot;/level1/*&quot;</span>)</span><br><span class="line">            .<span class="title function_">hasAnyAuthority</span>(<span class="string">&quot;vip1&quot;</span>)</span><br><span class="line">            <span class="comment">// laven2åªæœ‰vip2åŠä»¥ä¸Šæ‰å¯ä»¥è®¿é—®</span></span><br><span class="line">            .<span class="title function_">antMatchers</span>(<span class="string">&quot;/level2/*&quot;</span>)</span><br><span class="line">            .<span class="title function_">hasAnyAuthority</span>(<span class="string">&quot;vip2&quot;</span>)</span><br><span class="line">            <span class="comment">// lavel3åªæœ‰vip3åŠä»¥ä¸Šæ‰èƒ½è®¿é—®ï¼Œç”±äºéœ€è¦è®¾ç½®çš„æƒé™å¤ªå¤šè¿™é‡Œé€šè¿‡è§’è‰²æ¥è®¾ç½®</span></span><br><span class="line">            .<span class="title function_">antMatchers</span>(<span class="string">&quot;/level3/*&quot;</span>)</span><br><span class="line">            .<span class="title function_">hasAnyAuthority</span>(<span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">            <span class="comment">// å‰©ä¸‹çš„ç™»å½•å³å¯</span></span><br><span class="line">            .<span class="title function_">anyRequest</span>()</span><br><span class="line">            .<span class="title function_">authenticated</span>()</span><br><span class="line">        ........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>hasAuthority</td><td>å¿…é¡»æ‹¥æœ‰ç›®æ ‡æƒé™æ‰èƒ½è®¿é—®</td></tr><tr><td>hasAnyAuthority</td><td>å¿…é¡»æ‹¥æœ‰ç›®æ ‡æƒé™ ( å¯ä¼ å¤šä¸ªå‚æ•° ) æ‰èƒ½è®¿é—®</td></tr></tbody></table><blockquote><p>é€šè¿‡è§’è‰²æ§åˆ¶è®¿é—®æƒé™</p></blockquote><p>ä¹‹å‰é€šè¿‡æƒé™åˆ¤æ–­æ˜¯å¦æœ‰è®¿é—®èµ„æ ¼ï¼Œè¿™æ¬¡é€šè¿‡è§’è‰²åˆ¤æ–­ï¼Œä»£ç å®é™…ä¸Šå·®ä¸äº†å¤šå°‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹ä¸€ä¸‹å‡æ•°æ®</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.userDetailsService((String username)-&gt;&#123;</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">userEntity</span> <span class="operator">=</span> userService.selectUserByUsername(username);</span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> ( <span class="string">&quot;admin&quot;</span>.equals(username) )&#123;</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_æ™®é€šä¼šå‘˜&quot;</span>));</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_é«˜çº§ä¼šå‘˜&quot;</span>));</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_è¶…çº§ä¼šå‘˜&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_æ™®é€šä¼šå‘˜&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserSecurityEntity</span>(userEntity, authorities);</span><br><span class="line">    &#125;).passwordEncoder(<span class="keyword">new</span> <span class="title class_">PwdEncoderConfig</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹æƒé™éªŒè¯è§„åˆ™</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()  <span class="comment">// æ ¹æ®è¯·æ±‚è¯·æ±‚è¿›è¡ŒéªŒè¯</span></span><br><span class="line">        .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/toLogin&quot;</span>,<span class="string">&quot;/views/login.html&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/doLogin&quot;</span>, <span class="string">&quot;/toPage/success&quot;</span>, <span class="string">&quot;/doLogout&quot;</span>)</span><br><span class="line">        .permitAll()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/level1/*&quot;</span>)</span><br><span class="line">        .hasRole(<span class="string">&quot;æ™®é€šä¼šå‘˜&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/level2/*&quot;</span>)</span><br><span class="line">        .hasRole(<span class="string">&quot;é«˜çº§ä¼šå‘˜&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/level3/*&quot;</span>)</span><br><span class="line">        .hasRole(<span class="string">&quot;è¶…çº§ä¼šå‘˜&quot;</span>)</span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>hasRole</td><td>å¿…é¡»æ‹¥æœ‰ç›®æ ‡è§’è‰²æ‰èƒ½è®¿é—®</td></tr><tr><td>hasAnyRole</td><td>å¿…é¡»æ‹¥æœ‰ç›®æ ‡è§’è‰² ( å¯ä¼ å¤šä¸ªå‚æ•° ) æ‰èƒ½è®¿é—®</td></tr></tbody></table><blockquote><p>åŒæ—¶éªŒè¯æƒé™å’Œè§’è‰²</p></blockquote><p>å¯ä»¥é€šè¿‡æƒé™éªŒè¯ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡è§’è‰²éªŒè¯ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ä¸¤ä¸ªæ··ç”¨å‘¢ï¼Ÿå¯ä»¥çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†æ¬¡ä¿®æ”¹æµ‹è¯•æ•°æ®</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹æƒé™éªŒè¯è§„åˆ™</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Springå®¶æ—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerä½¿ç”¨è¯¦è§£</title>
    <link href="/2023/02/21/Docker%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/02/21/Docker%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://www.docker.com/get-started">https://www.docker.com/get-started</a></p><p>ä¸­æ–‡å‚è€ƒæ‰‹å†Œï¼š<a href="https://docker_practice.gitee.io/zh-cn/">https://docker_practice.gitee.io/zh-cn/</a></p><p>ç¬”è®°åŸä½œè€…ï¼šé™ˆè‰³ç”· <a href="https://space.bilibili.com/352224540/">Bç«™ä¸»é¡µ</a>ï¼Œ<a href="https://www.baizhiedu.xin/front/index#/main">æ›´å¤šç¬”è®°ä¸‹è½½</a></p><h2 id=""></h2><p>Dockeræ˜¯ä¸€æ¬¾å¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæˆ– Windowsæœºå™¨ä¸Šã€‚ä»–åŸºäºè™šæ‹ŸåŒ–æŠ€æœ¯ä¸ºæ¯ä¸ªé•œåƒåˆ›å»ºç‹¬ç«‹çš„å®¹å™¨ï¼Œç›¸äº’ä¹‹é—´ä¸å¹²æ‰°ï¼Œå¯ä»¥åšåˆ°ç§’çº§å¯åŠ¨ç¨‹åºã€‚</p><blockquote><p>æœ€æ–°å®˜ç½‘é¦–é¡µï¼š<a href="https://www.docker.com/">https://www.docker.com/</a></p></blockquote><p><img src="https://s2.loli.net/2023/11/26/GyIdrAsehtBv1ug.png" alt=""><br><img src="https://s2.loli.net/2023/11/26/nDFPC2Sv6J87fmU.png" alt=""></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.å®˜æ–¹ä»‹ç»</span></span><br><span class="line"><span class="bullet">-</span> We have a complete container solution for you - no matter who you are and where you are on your containerization journey.</span><br><span class="line"><span class="bullet">-</span> ç¿»è¯‘: æˆ‘ä»¬ä¸ºä½ æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å®¹å™¨è§£å†³æ–¹æ¡ˆ,ä¸ç®¡ä½ æ˜¯è°,ä¸ç®¡ä½ åœ¨å“ª,ä½ éƒ½å¯ä»¥å¼€å§‹å®¹å™¨çš„çš„æ—…ç¨‹ã€‚</span><br><span class="line"><span class="bullet">-</span> å®˜æ–¹å®šä¹‰: dockeræ˜¯ä¸€ä¸ªå®¹å™¨æŠ€æœ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨Docker">ä¸ºä»€ä¹ˆä½¿ç”¨Docker</h2><ul><li><p><strong>ä¼˜åŠ¿1:  ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ,æ›´è½»æ¾çš„è¿ç§»</strong></p><p>æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªç¨‹åºéœ€è¦å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚jdkã€tomcatã€mysqlç­‰è½¯ä»¶ç¯å¢ƒã€‚å½“å…¶ä¸­ä»»æ„ä¸€ç§ä¸ç¬¦åˆè¦æ±‚éƒ½å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥ï¼Dockeråˆ™å°†ç¨‹åºä»¥åŠä½¿ç”¨è½¯ä»¶ç¯å¢ƒç›´æ¥æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä¿è¯äº†è¿è¡Œç¯å¢ƒä¸€è‡´ã€‚</p><p><strong>ä¼˜åŠ¿2ï¼šå¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»,å®¹å™¨ä¸å®¹å™¨ä¹‹é—´äº’ä¸å½±å“,æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº</strong></p><p>å¦‚æœä½ çš„ç¨‹åºé‡è¦æ€§ä¸æ˜¯ç‰¹åˆ«é«˜çš„è¯ï¼Œå…¬å¸åŸºæœ¬ä¸Šä¸å¯èƒ½è®©ä½ çš„ç¨‹åºç‹¬äº«ä¸€å°æœåŠ¡å™¨çš„ï¼Œè¿™æ—¶å€™ä½ çš„æœåŠ¡å™¨å°±ä¼šè·Ÿå…¬å¸å…¶ä»–äººçš„ç¨‹åºå…±äº«ä¸€å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸å¯é¿å…åœ°å°±ä¼šå—åˆ°å…¶ä»–ç¨‹åºçš„å¹²æ‰°ï¼Œå¯¼è‡´è‡ªå·±çš„ç¨‹åºå‡ºç°é—®é¢˜ã€‚Dockerå°±å¾ˆå¥½è§£å†³äº†ç¯å¢ƒéš”ç¦»çš„é—®é¢˜ï¼Œåˆ«äººç¨‹åºä¸ä¼šå½±å“åˆ°è‡ªå·±çš„ç¨‹åºã€‚</p></li><li><p><strong>ä¼˜åŠ¿3: é€šè¿‡é•œåƒå¤åˆ¶Nå¤šä¸ªç¯å¢ƒä¸€è‡´å®¹å™¨</strong></p><p>åœ¨æ²¡æœ‰Dockerçš„æƒ…å†µä¸‹ï¼Œè¦åœ¨å‡ å¤©å†…éƒ¨ç½²å‡ åå°æœåŠ¡å™¨ï¼Œè¿™å¯¹è¿ç»´æ¥è¯´æ˜¯ä¸€ä»¶éå¸¸æŠ˜ç£¨äººçš„äº‹ï¼Œè€Œä¸”æ¯å°æœåŠ¡å™¨çš„ç¯å¢ƒè¿˜ä¸ä¸€å®šä¸€æ ·ï¼Œå°±ä¼šå‡ºç°å„ç§é—®é¢˜ï¼Œæœ€åéƒ¨ç½²åœ°å¤´çš®å‘éº»ã€‚ç”¨Dockerçš„è¯ï¼Œæˆ‘åªéœ€è¦å°†ç¨‹åºæ‰“åŒ…åˆ°é•œåƒï¼Œä½ è¦å¤šå°‘å°æœåŠ¡ï¼Œæˆ‘å°±ç»™åŠ›è·‘å¤šå°‘å®¹å™¨ï¼Œæå¤§åœ°æé«˜äº†éƒ¨ç½²æ•ˆç‡ã€‚</p></li></ul><h2 id="Dockerå’Œè™šæ‹ŸæœºåŒºåˆ«">Dockerå’Œè™šæ‹ŸæœºåŒºåˆ«</h2><blockquote><p>å…³äºDockerä¸è™šæ‹Ÿæœºçš„åŒºåˆ«ï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€å¼ å›¾ï¼Œéå¸¸ç›´è§‚å½¢è±¡åœ°å±•ç¤ºå‡ºæ¥ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›¾ã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/11/26/UHXtC2WqwbuN3k4.png" alt="image-20201220222456675"></p><p><code>æ¯”è¾ƒä¸Šé¢ä¸¤å¼ å›¾ï¼Œæˆ‘ä»¬å‘ç°è™šæ‹Ÿæœºæ˜¯æºå¸¦æ“ä½œç³»ç»Ÿï¼Œæœ¬èº«å¾ˆå°çš„åº”ç”¨ç¨‹åºå´å› ä¸ºæºå¸¦äº†æ“ä½œç³»ç»Ÿè€Œå˜å¾—éå¸¸å¤§ï¼Œå¾ˆç¬¨é‡</code>ã€‚Dockeræ˜¯ä¸æºå¸¦æ“ä½œç³»ç»Ÿçš„ï¼Œæ‰€ä»¥Dockerçš„åº”ç”¨å°±éå¸¸çš„è½»å·§ã€‚å¦å¤–åœ¨è°ƒç”¨å®¿ä¸»æœºçš„CPUã€ç£ç›˜ç­‰ç­‰è¿™äº›èµ„æºçš„æ—¶å€™ï¼Œæ‹¿å†…å­˜ä¸¾ä¾‹ï¼Œè™šæ‹Ÿæœºæ˜¯åˆ©ç”¨Hypervisorå»è™šæ‹ŸåŒ–å†…å­˜ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&gt;è™šæ‹Ÿç‰©ç†å†…å­˜-&gt;çœŸæ­£ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯Dockeræ˜¯åˆ©ç”¨Docker Engineå»è°ƒç”¨å®¿ä¸»çš„çš„èµ„æºï¼Œè¿™æ—¶å€™è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&gt;çœŸæ­£ç‰©ç†å†…å­˜ã€‚</p><table><thead><tr><th></th><th>ä¼ ç»Ÿè™šæ‹Ÿæœº</th><th>Dockerå®¹å™¨</th></tr></thead><tbody><tr><td>ç£ç›˜å ç”¨</td><td>å‡ GB~å‡ åä¸ªGBå·¦å³</td><td>å‡ åMB~å‡ ç™¾MBå·¦å³</td></tr><tr><td>CPUå†…å­˜å ç”¨</td><td>è™šæ‹Ÿæ“ä½œç³»ç»Ÿéå¸¸å ç”¨CPUå’Œå†…å­˜</td><td>Dockerå¼•æ“å ç”¨æä½</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>ï¼ˆä»å¼€æœºåˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ åˆ†é’Ÿ</td><td>ï¼ˆä»å¼€å¯å®¹å™¨åˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ ç§’</td></tr><tr><td>å®‰è£…ç®¡ç†</td><td>éœ€è¦ä¸“é—¨çš„è¿ç»´æŠ€æœ¯</td><td>å®‰è£…ã€ç®¡ç†æ–¹ä¾¿</td></tr><tr><td>åº”ç”¨éƒ¨ç½²</td><td>æ¯æ¬¡éƒ¨ç½²éƒ½è´¹æ—¶è´¹åŠ›</td><td>ä»ç¬¬äºŒæ¬¡éƒ¨ç½²å¼€å§‹è½»æ¾ç®€æ·</td></tr><tr><td>è€¦åˆæ€§</td><td>å¤šä¸ªåº”ç”¨æœåŠ¡å®‰è£…åˆ°ä¸€èµ·ï¼Œå®¹æ˜“äº’ç›¸å½±å“</td><td>æ¯ä¸ªåº”ç”¨æœåŠ¡ä¸€ä¸ªå®¹å™¨ï¼Œè¾¾æˆéš”ç¦»</td></tr><tr><td>ç³»ç»Ÿä¾èµ–</td><td>æ— </td><td>éœ€æ±‚ç›¸åŒæˆ–ç›¸ä¼¼çš„å†…æ ¸ï¼Œç›®å‰æ¨èæ˜¯Linux</td></tr></tbody></table><h2 id="Dockerçš„å®‰è£…é…ç½®-CentOS7">Dockerçš„å®‰è£…é…ç½®(CentOS7)</h2><blockquote><p>å®‰è£…æµç¨‹ï¼šæ ¹æ®å®˜æ–¹æ–‡æ¡£èµ°ä¸€é</p></blockquote><p><strong>1. å®‰è£…ä¹‹å‰è¦ä¿è¯ç³»ç»Ÿä¸­æ²¡æœ‰ç›¸å…³æ®‹ç•™å¯¼è‡´å®‰è£…å¤±è´¥ï¼Œè¿™é‡Œå…ˆåˆ é™¤ã€æ¸…ç†ä¾èµ–</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">    docker-client \</span><br><span class="line">    docker-client-latest \</span><br><span class="line">    docker-common \</span><br><span class="line">    docker-latest \</span><br><span class="line">    docker-latest-logrotate \</span><br><span class="line">    docker-logrotate \</span><br><span class="line">    docker-engine</span><br></pre></td></tr></table></figure><p><strong>2. æ¸…ç†ä¾èµ–ç»“æŸåï¼Œå°±éœ€è¦å®‰è£… docker æ‰€éœ€çš„ä¾èµ–äº†</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br></pre></td></tr></table></figure><p><strong>3. ä¾èµ–å®‰è£…å®Œæˆåéœ€è¦ä¸‹è½½ docker ç¨‹åºï¼Œå®˜æ–¹é»˜è®¤æä¾›çš„æ˜¯å›½å¤–çš„ä¸‹è½½åœ°å€ï¼Œè¿™é‡Œæ¢ç”¨é˜¿é‡Œäº‘çš„æ¯”è¾ƒå¿«</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p><strong>4. ä¸‹è½½åœ°å€æ›´æ¢å®Œæˆåå°±å¯ä»¥è¿›è¡Œä¸‹è½½äº†ï¼Œç¨ç­‰ç‰‡åˆ»å docker å°±ä¼šå®‰è£…æˆåŠŸ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure><p><strong>5. æ¥ä¸‹æ¥å°±å¯ä»¥å¯åŠ¨DockeræœåŠ¡äº†</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨dockeræœåŠ¡</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç›¸å¯¹åº”çš„ç»“æŸdockeræœåŠ¡</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl stop docker</span></span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</p></blockquote><p>åœ¨ä¸Šé¢å®‰è£…Dockerçš„æ—¶å€™ä½¿ç”¨äº†é˜¿é‡Œäº‘åœ°å€ä¸‹è½½ï¼Œæœ‰ç»éªŒçš„è‚¯å®šèƒ½æ„Ÿè§‰åˆ°ç›¸å¯¹äºå®˜ç½‘é€Ÿåº¦æé«˜äº†ä¸æ­¢ä¸€ç‚¹ï¼Œåé¢å¸Œæœ›æ‰€æœ‰é•œåƒéƒ½é€šè¿‡é˜¿é‡Œäº‘è¿›è¡Œä¸‹è½½ï¼Œè¿™é‡Œé…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿï¼š</p><ol><li>ç™»é™†/æ³¨å†Œ é˜¿é‡Œäº‘å®˜æ–¹ç½‘ç«™</li><li>ç‚¹è¿›æ§åˆ¶å°</li><li>æ‰“å¼€å·¦ä¾§ä¾§è¾¹æ æ‰¾åˆ°<code>å®¹å™¨é•œåƒæœåŠ¡</code>å¹¶ç‚¹å‡»</li><li>æ‰¾åˆ°å·¦ä¾§æœ€ä¸‹é¢çš„<code>é•œåƒåŠ é€Ÿå™¨</code></li><li>é€‰æ‹©ç¬¦åˆç¯å¢ƒçš„ä»£ç æ‰§è¡Œå³å¯ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯ä¸ªäººçš„åœ°å€éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘è¿™é‡Œçš„é•œåƒåŠ é€Ÿåœ°å€ä¸ºï¼š</span></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://lz2nib3q.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡<code>docker info</code>å‘½ä»¤æ¥æŸ¥çœ‹é•œåƒåŠ é€Ÿæ˜¯å¦é…ç½®æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker info</span><br><span class="line"><span class="meta prompt_">   # </span><span class="language-bash">çœç•¥ä¸€å¤§å †ï¼Œç›´æ¥çœ‹æœ€ä¸‹é¢..........</span></span><br><span class="line">   Registry Mirrors:</span><br><span class="line">    &#x27;https://lz2nib3q.mirror.aliyuncs.com/&#x27;</span><br><span class="line">   Live Restore Enabled: false</span><br><span class="line">   Product License: Community Engine</span><br></pre></td></tr></table></figure><h2 id="Dockerçš„æ ¸å¿ƒæ¶æ„">Dockerçš„æ ¸å¿ƒæ¶æ„</h2><blockquote><p>åŸºæœ¬æ¦‚å¿µäº†è§£</p></blockquote><p><img src="https://s2.loli.net/2023/11/26/so7t6n1mhCFvJQy.png" alt="docker-03"></p><ul><li><code>é•œåƒ:</code>ä¸€ä¸ªé•œåƒä»£è¡¨ä¸€ä¸ªåº”ç”¨ç¯å¢ƒ,ä»–æ˜¯ä¸€ä¸ªåªè¯»çš„æ–‡ä»¶,å¦‚ mysqlé•œåƒ,tomcaté•œåƒ,nginxé•œåƒç­‰</li><li><code>å®¹å™¨:</code>é•œåƒæ¯æ¬¡è¿è¡Œä¹‹åå°±æ˜¯äº§ç”Ÿä¸€ä¸ªå®¹å™¨,å°±æ˜¯æ­£åœ¨è¿è¡Œçš„é•œåƒ,ç‰¹ç‚¹å°±æ˜¯å¯è¯»å¯å†™</li><li><code>ä»“åº“:</code>ç”¨æ¥å­˜æ”¾é•œåƒçš„ä½ç½®,ç±»ä¼¼äºmavenä»“åº“,ä¹Ÿæ˜¯é•œåƒä¸‹è½½å’Œä¸Šä¼ çš„ä½ç½®</li><li><code>dockerFile:</code>dockerç”Ÿæˆé•œåƒé…ç½®æ–‡ä»¶,ç”¨æ¥ä¹¦å†™è‡ªå®šä¹‰é•œåƒçš„ä¸€äº›é…ç½®</li><li><code>tar:</code>ä¸€ä¸ªå¯¹é•œåƒæ‰“åŒ…çš„æ–‡ä»¶,æ—¥åå¯ä»¥è¿˜åŸæˆé•œåƒ</li></ul><blockquote><p>Dockerè¿è¡Œæµç¨‹ç¤ºæ„å›¾</p></blockquote><p><img src="https://s2.loli.net/2023/11/26/aHxivRoycmQAIJe.png" alt="docker-05"></p><h2 id="Dockeråˆä½“éªŒ">Dockeråˆä½“éªŒ</h2><blockquote><p>è¿è¡Œ hello-world é•œåƒ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run hello-world</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨æœ¬åœ°æ‰¾ä¸åˆ°hello-worldè¿™ä¸ªé•œåƒ(:latestä»£è¡¨æœ€æ–°ç‰ˆæœ¬é•œåƒ)</span></span><br><span class="line">Unable to find image &#x27;hello-world:latest&#x27; locally</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨æ‰¾ä¸åˆ°é•œåƒçš„æƒ…å†µä¸‹é»˜è®¤ä¼šå»åˆ°è¿œç¨‹ä»“åº“ä¸­è‡ªåŠ¨ä¸‹è½½</span></span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">0e03bdcc26d7: Already exists </span><br><span class="line">Digest: sha256:31b9c7d48790f0d8c50ab433d9c3b7e17666d6993084c002c2ff1ca09b96391d</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é•œåƒä¸‹è½½å®Œæˆåæ‰§è¡Œè¿è¡Œå‘½ä»¤ï¼Œè¿è¡Œçš„ç»“æœæ˜¯ï¼š</span></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta prompt_"> $ </span><span class="language-bash">docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure><h2 id="Dockerå¸¸ç”¨å‘½ä»¤">Dockerå¸¸ç”¨å‘½ä»¤</h2><blockquote><p>å¸®åŠ©ã€è¾…åŠ©å‘½ä»¤</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.å®‰è£…å®Œæˆè¾…åŠ©å‘½ä»¤</span></span><br><span class="line">docker version -------------------------- æŸ¥çœ‹dockerçš„ä¿¡æ¯</span><br><span class="line">docker info  -------------------------- æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯</span><br><span class="line">docker --help -------------------------- å¸®åŠ©å‘½ä»¤</span><br></pre></td></tr></table></figure><blockquote><p>Images é•œåƒå‘½ä»¤</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.æŸ¥çœ‹æœ¬æœºä¸­æ‰€æœ‰é•œåƒ</span></span><br><span class="line">docker images --------------------------  åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ</span><br><span class="line"> -a    åˆ—å‡ºæ‰€æœ‰é•œåƒï¼ˆåŒ…å«ä¸­é—´æ˜ åƒå±‚ï¼‰</span><br><span class="line">   -q    åªæ˜¾ç¤ºé•œåƒid</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.æœç´¢é•œåƒ</span></span><br><span class="line">docker search [options] é•œåƒå ------------  å»dockerhubä¸ŠæŸ¥è¯¢å½“å‰é•œåƒ</span><br><span class="line"> -s æŒ‡å®šå€¼     åˆ—å‡ºæ”¶è—æ•°ä¸å°‘äºæŒ‡å®šå€¼çš„é•œåƒ</span><br><span class="line">   --no-trunc   æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.ä»ä»“åº“ä¸‹è½½é•œåƒ</span></span><br><span class="line">docker pull é•œåƒå[:TAG|@DIGEST] --------  ä¸‹è½½é•œåƒ</span><br><span class="line"></span><br><span class="line"><span class="section"># 4.åˆ é™¤é•œåƒ</span></span><br><span class="line">docker rmi é•œåƒå ------------------------  åˆ é™¤é•œåƒ</span><br><span class="line"> -f           å¼ºåˆ¶åˆ é™¤</span><br></pre></td></tr></table></figure><blockquote><p>Contrainer å®¹å™¨å‘½ä»¤</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.è¿è¡Œå®¹å™¨</span></span><br><span class="line">docker run é•œåƒå -------------------------- é•œåƒåæ–°å»ºå¹¶å¯åŠ¨å®¹å™¨</span><br><span class="line"> --name      ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°</span><br><span class="line"> -d          åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID</span><br><span class="line"> -p          å°å†™-è®¾ç½®ç«¯å£æ˜ å°„ã€ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ã€‘</span><br><span class="line"> -P          å¤§å†™å­—æ¯Pï¼šéšæœºæŒ‡å®šç«¯å£</span><br><span class="line"> -i          ä»¥äº¤äº’æ¨¡å¼è¿è¡Œï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨</span><br><span class="line"> -t          ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨</span><br><span class="line"> -e          é€šå¸¸ç”¨äºå¯¹å®¹å™¨å†…çš„ç¯å¢ƒè¿›è¡Œä¸€äº›è®¾ç½®</span><br><span class="line"> -v          ç»‘å®šä¸€ä¸ªå·</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">docker ps         -------------------------- åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line"> -a          æ­£åœ¨è¿è¡Œçš„å’Œå†å²è¿è¡Œè¿‡çš„å®¹å™¨</span><br><span class="line"> -q          é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.åœæ­¢|å…³é—­|é‡å¯å®¹å™¨</span></span><br><span class="line">docker start   å®¹å™¨åå­—æˆ–è€…å®¹å™¨id  --------------- å¼€å¯å®¹å™¨</span><br><span class="line">docker restart å®¹å™¨åæˆ–è€…å®¹å™¨id    --------------- é‡å¯å®¹å™¨</span><br><span class="line">docker stop    å®¹å™¨åæˆ–è€…å®¹å™¨id  --------------- æ­£å¸¸åœæ­¢å®¹å™¨è¿è¡Œ</span><br><span class="line">docker kill    å®¹å™¨åæˆ–è€…å®¹å™¨id    --------------- ç«‹å³åœæ­¢å®¹å™¨è¿è¡Œ</span><br><span class="line"></span><br><span class="line"><span class="section"># 4.åˆ é™¤å®¹å™¨</span></span><br><span class="line">docker rm -f å®¹å™¨idå’Œå®¹å™¨å     </span><br><span class="line">docker rm -f $(docker ps -aq)   --------------- åˆ é™¤æ‰€æœ‰å®¹å™¨</span><br><span class="line"></span><br><span class="line"><span class="section"># 5.æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹</span></span><br><span class="line">docker top å®¹å™¨idæˆ–è€…å®¹å™¨å        --------------- æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹</span><br><span class="line"></span><br><span class="line"><span class="section"># 6.æŸ¥çœ‹æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</span></span><br><span class="line">docker inspect å®¹å™¨id      --------------- æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</span><br><span class="line"></span><br><span class="line"><span class="section"># 7.æŸ¥çœ‹å®¹å™¨çš„è¿è¡Œæ—¥å¿—</span></span><br><span class="line">docker logs [OPTIONS] å®¹å™¨idæˆ–å®¹å™¨å ------------ æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br><span class="line"><span class="code">    -t  åŠ å…¥æ—¶é—´æˆ³</span></span><br><span class="line"><span class="code">    -f  è·Ÿéšæœ€æ–°çš„æ—¥å¿—æ‰“å°</span></span><br><span class="line"><span class="code">    --tail  æ•°å­— æ˜¾ç¤ºæœ€åå¤šå°‘æ¡</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 8.è¿›å…¥å®¹å™¨å†…éƒ¨</span></span><br><span class="line">docker exec [options] å®¹å™¨id å®¹å™¨å†…å‘½ä»¤ ------------------ è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤</span><br><span class="line"><span class="code">    -i  ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸-tä¸€èµ·ä½¿ç”¨</span></span><br><span class="line"><span class="code">    -t  åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯    shellçª—å£   bash </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 9.å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line">docker cp æ–‡ä»¶|ç›®å½• å®¹å™¨id:å®¹å™¨è·¯å¾„           -----------------   å°†å®¿ä¸»æœºå¤åˆ¶åˆ°å®¹å™¨å†…éƒ¨</span><br><span class="line">docker cp å®¹å™¨id:å®¹å™¨å†…èµ„æºè·¯å¾„ å®¿ä¸»æœºç›®å½•è·¯å¾„  -----------------   å°†å®¹å™¨å†…èµ„æºæ‹·è´åˆ°ä¸»æœºä¸Š</span><br><span class="line"></span><br><span class="line"><span class="section"># 10.æ•°æ®å·(volum)å®ç°ä¸å®¿ä¸»æœºå…±äº«ç›®å½•</span></span><br><span class="line">docker run -v å®¿ä¸»æœºçš„è·¯å¾„|ä»»æ„åˆ«å:/å®¹å™¨å†…çš„è·¯å¾„ é•œåƒå</span><br><span class="line">  æ³¨æ„: </span><br><span class="line"><span class="code">     1.å¦‚æœæ˜¯å®¿ä¸»æœºè·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„,å®¿ä¸»æœºç›®å½•ä¼šè¦†ç›–å®¹å™¨å†…ç›®å½•å†…å®¹</span></span><br><span class="line"><span class="code">     2.å¦‚æœæ˜¯åˆ«ååˆ™ä¼šåœ¨dockerè¿è¡Œå®¹å™¨æ—¶è‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç›®å½•,å¹¶å°†å®¹å™¨ç›®å½•æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºä¸­</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 11.æ‰“åŒ…é•œåƒ</span></span><br><span class="line">docker save é•œåƒå -o åç§°.tar</span><br><span class="line"></span><br><span class="line"><span class="section"># 12.è½½å…¥é•œåƒ</span></span><br><span class="line">docker load -i åç§°.tar</span><br><span class="line"></span><br><span class="line"><span class="section"># 13.å®¹å™¨æ‰“åŒ…æˆæ–°çš„é•œåƒ</span></span><br><span class="line">docker commit -m &quot;æè¿°ä¿¡æ¯&quot; -a &quot;ä½œè€…ä¿¡æ¯&quot;   ï¼ˆå®¹å™¨idæˆ–è€…åç§°ï¼‰æ‰“åŒ…çš„é•œåƒåç§°:æ ‡ç­¾</span><br></pre></td></tr></table></figure><h2 id="Dockerçš„é•œåƒåŸç†">Dockerçš„é•œåƒåŸç†</h2><p>é•œåƒæ˜¯ä¸€ç§è½»é‡çº§çš„ï¼Œå¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„è½¯ä»¶ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶æ‰€éœ€çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆä¸€ä¸ªé•œåƒä¼šé‚£ä¹ˆå¤§ï¼Ÿ</p></blockquote><p><img src="https://s2.loli.net/2023/11/26/Ozftpb9Mm8hvNUE.png" alt="docker-06"><strong>UnionFS ( è”åˆæ–‡ä»¶ç³»ç»Ÿ )</strong>ï¼š</p><p>Unionæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ç§åˆ†å±‚ï¼Œè½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚Unionæ–‡ä»¶ç³»ç»Ÿæ˜¯Dockeré•œåƒçš„åŸºç¡€ã€‚è¿™ç§æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§:å°±æ˜¯ä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• ã€‚</p><blockquote><p>dockerçš„é•œåƒå®é™…æ˜¯ç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆã€‚</p></blockquote><ul><li><p>bootfsï¼ˆboot file systemï¼‰ä¸»è¦åŒ…å«bootloaderå’Œkernelï¼Œbootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½kernelï¼ŒLinuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿã€‚åœ¨dockeré•œåƒçš„æœ€åº•å±‚å°±æ˜¯bootfsã€‚è¿™ä¸€å±‚ä¸Linux/Unix ç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«bootåŠ è½½å™¨ï¼ˆbootloaderï¼‰å’Œå†…æ ¸ï¼ˆkernelï¼‰ã€‚å½“bootåŠ è½½å®Œ,åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±bootfsè½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ä¼šå¸è½½bootfsã€‚</p></li><li><p>rootfsï¼ˆroot file systemï¼‰ï¼Œåœ¨bootfsä¹‹ä¸Šï¼ŒåŒ…å«çš„å°±æ˜¯å…¸å‹çš„linuxç³»ç»Ÿä¸­çš„/devï¼Œ/procï¼Œ/binï¼Œ/etcç­‰æ ‡å‡†çš„ç›®å½•å’Œæ–‡ä»¶ã€‚rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntu/CentOSç­‰ç­‰ã€‚</p></li><li><p>æˆ‘ä»¬å¹³æ—¶å®‰è£…è¿›è™šæ‹Ÿæœºçš„centoséƒ½æœ‰1åˆ°å‡ ä¸ªGBï¼Œä¸ºä»€ä¹ˆdockerè¿™é‡Œæ‰200MBï¼Ÿå¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ï¼Œå·¥å…·ï¼Œå’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ä½¿ç”¨Hostçš„Kernalï¼Œè‡ªå·±åªéœ€è¦æä¾›rootfså°±è¡Œäº†ã€‚ç”±æ­¤å¯è§ä¸åŒçš„linuxå‘è¡Œç‰ˆï¼Œä»–ä»¬çš„bootfsæ˜¯ä¸€è‡´çš„ï¼Œrootfsä¼šæœ‰å·®åˆ«ã€‚å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…±ç”¨bootfsã€‚</p></li></ul><p><img src="D:%5C%E7%AC%94%E8%AE%B0%5CMarkdown-master%5CMarkdown-master%5Cimg%5Cdocker-01.jpg" alt="docker-01"></p><h2 id="Dockerå¸¸ç”¨æœåŠ¡å®‰è£…">Dockerå¸¸ç”¨æœåŠ¡å®‰è£…</h2><h3 id="ç®€å•ç¨‹åºå®‰è£…">ç®€å•ç¨‹åºå®‰è£…</h3><blockquote><p>å®‰è£…mysql</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.æ‹‰å–mysqlé•œåƒåˆ°æœ¬åœ°</span></span><br><span class="line"> docker pull mysql:tag (tagä¸åŠ é»˜è®¤æœ€æ–°ç‰ˆæœ¬)</span><br><span class="line"> </span><br><span class="line"><span class="section"># 2.è¿è¡ŒmysqlæœåŠ¡</span></span><br><span class="line"> docker run --name mysql -e MYSQL<span class="emphasis">_ROOT_</span>PASSWORD=root -p 3306:3306 -d  mysql:tag  --æ²¡æœ‰æš´éœ²å¤–éƒ¨ç«¯å£</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.è¿›å…¥mysqlå®¹å™¨</span></span><br><span class="line"> docker exec -it å®¹å™¨åç§°|å®¹å™¨id bash</span><br><span class="line"></span><br><span class="line"><span class="section"># 4.å¤–éƒ¨æŸ¥çœ‹mysqlæ—¥å¿—</span></span><br><span class="line"> docker logs å®¹å™¨åç§°|å®¹å™¨id</span><br><span class="line"></span><br><span class="line"><span class="section"># 5.ä½¿ç”¨è‡ªå®šä¹‰é…ç½®å‚æ•°</span></span><br><span class="line"> docker run --name mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e MYSQL<span class="emphasis">_ROOT_</span>PASSWORD=root -d mysql:tag</span><br><span class="line"></span><br><span class="line"><span class="section"># 6.å°†å®¹å™¨æ•°æ®ä½ç½®ä¸å®¿ä¸»æœºä½ç½®æŒ‚è½½ä¿è¯æ•°æ®å®‰å…¨</span></span><br><span class="line">docker run -d \</span><br><span class="line">--name mysql \</span><br><span class="line">-v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /root/mysql/conf:/etc/mysql \</span><br><span class="line">-e MYSQL<span class="emphasis">_ROOT_</span>PASSWORD=zhang \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">mysql:5.7.32</span><br><span class="line"></span><br><span class="line"><span class="section"># 7.é€šè¿‡å…¶ä»–å®¢æˆ·ç«¯è®¿é—® å¦‚åœ¨windowç³»ç»Ÿ|macosç³»ç»Ÿä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·è®¿é—®</span></span><br><span class="line"> </span><br><span class="line"><span class="section"># 8.å°†mysqlæ•°æ®åº“å¤‡ä»½ä¸ºsqlæ–‡ä»¶</span></span><br><span class="line"> docker exec mysql|å®¹å™¨id sh -c &#x27;exec mysqldump --all-databases -uroot -p&quot;$MYSQL<span class="emphasis">_ROOT_</span>PASSWORD&quot;&#x27; &gt; /root/all-databases.sql  --å¯¼å‡ºå…¨éƒ¨æ•°æ®</span><br><span class="line"> docker exec mysql sh -c &#x27;exec mysqldump --databases åº“è¡¨ -uroot -p&quot;$MYSQL<span class="emphasis">_ROOT_</span>PASSWORD&quot;&#x27; &gt; /root/all-databases.sql  --å¯¼å‡ºæŒ‡å®šåº“æ•°æ®</span><br><span class="line"> docker exec mysql sh -c &#x27;exec mysqldump --no-data --databases åº“è¡¨ -uroot -p&quot;$MYSQL<span class="emphasis">_ROOT_</span>PASSWORD&quot;&#x27; &gt; /root/all-databases.sql  --å¯¼å‡ºæŒ‡å®šåº“æ•°æ®ä¸è¦æ•°æ®</span><br><span class="line"></span><br><span class="line"><span class="section"># 9.æ‰§è¡Œsqlæ–‡ä»¶åˆ°mysqlä¸­</span></span><br><span class="line"> docker exec -i mysql sh -c &#x27;exec mysql -uroot -p&quot;$MYSQL<span class="emphasis">_ROOT_</span>PASSWORD&quot;&#x27; &lt; /root/xxx.sql</span><br></pre></td></tr></table></figure><blockquote><p>å®‰è£…RedisæœåŠ¡</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.åœ¨docker hubæœç´¢redisé•œåƒ</span></span><br><span class="line"> docker search redis</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.æ‹‰å–redisé•œåƒåˆ°æœ¬åœ°</span></span><br><span class="line"> docker pull redis</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.å¯åŠ¨redisæœåŠ¡è¿è¡Œå®¹å™¨</span></span><br><span class="line"> docker run --name redis -d redis:tag (æ²¡æœ‰æš´éœ²å¤–éƒ¨ç«¯å£)</span><br><span class="line"> docker run --name redis -p 6379:6379 -d redis:tag (æš´éœ²å¤–éƒ¨å®¿ä¸»æœºç«¯å£ä¸º6379è¿›è¡Œè¿æ¥) </span><br><span class="line"></span><br><span class="line"><span class="section"># 4.æŸ¥çœ‹å¯åŠ¨æ—¥å¿—</span></span><br><span class="line"> docker logs -t -f å®¹å™¨id|å®¹å™¨åç§°</span><br><span class="line"></span><br><span class="line"><span class="section"># 5.è¿›å…¥å®¹å™¨å†…éƒ¨æŸ¥çœ‹</span></span><br><span class="line"> docker exec -it å®¹å™¨id|åç§° bash  </span><br><span class="line"></span><br><span class="line"><span class="section"># 6.åŠ è½½å¤–éƒ¨è‡ªå®šä¹‰é…ç½®å¯åŠ¨rediså®¹å™¨</span></span><br><span class="line"> é»˜è®¤æƒ…å†µä¸‹rediså®˜æ–¹é•œåƒä¸­æ²¡æœ‰redis.confé…ç½®æ–‡ä»¶ éœ€è¦å»å®˜ç½‘ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶</span><br><span class="line"><span class="bullet"> 1.</span> wget http://download.redis.io/releases/redis-5.0.8.tar.gz  ä¸‹è½½å®˜æ–¹å®‰è£…åŒ…</span><br><span class="line"><span class="bullet"> 2.</span> å°†å®˜æ–¹å®‰è£…åŒ…ä¸­é…ç½®æ–‡ä»¶è¿›è¡Œå¤åˆ¶åˆ°å®¿ä¸»æœºæŒ‡å®šç›®å½•ä¸­å¦‚ /root/redis/redis.confæ–‡ä»¶</span><br><span class="line"><span class="bullet"> 3.</span> ä¿®æ”¹éœ€è¦è‡ªå®šä¹‰çš„é…ç½®</span><br><span class="line">   bind 0.0.0.0 å¼€å¯è¿œç¨‹æƒé™</span><br><span class="line">   appenonly yes å¼€å¯aofæŒä¹…åŒ–</span><br><span class="line"><span class="bullet"> 4.</span> åŠ è½½é…ç½®å¯åŠ¨</span><br><span class="line"> docker run --name redis -v /root/redis:/opt/conf -p 6379:6379 -d redis redis-server /usr/local/etc/redis/redis.conf  </span><br><span class="line"></span><br><span class="line"><span class="section"># 7.å°†æ•°æ®ç›®å½•æŒ‚åœ¨åˆ°æœ¬åœ°ä¿è¯æ•°æ®å®‰å…¨</span></span><br><span class="line">docker run -d \</span><br><span class="line">--name redis \</span><br><span class="line">-v /root/redis/data:/data \</span><br><span class="line">-v /root/redis/conf:/opt/conf \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">redis:5.0.10 redis-server /opt/conf/redis.conf</span><br></pre></td></tr></table></figure><blockquote><p>å®‰è£…Nginx</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.åœ¨docker hubæœç´¢nginx</span></span><br><span class="line"> docker search nginx</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.æ‹‰å–nginxé•œåƒåˆ°æœ¬åœ°</span></span><br><span class="line"> [root@localhost ~]# docker pull nginx</span><br><span class="line"><span class="code">    Using default tag: latest</span></span><br><span class="line"><span class="code">    latest: Pulling from library/nginx</span></span><br><span class="line"><span class="code">    afb6ec6fdc1c: Pull complete </span></span><br><span class="line"><span class="code">    b90c53a0b692: Pull complete </span></span><br><span class="line"><span class="code">    11fa52a0fdc0: Pull complete </span></span><br><span class="line"><span class="code">    Digest: sha256:30dfa439718a17baafefadf16c5e7c9d0a1cde97b4fd84f63b69e13513be7097</span></span><br><span class="line"><span class="code">    Status: Downloaded newer image for nginx:latest</span></span><br><span class="line"><span class="code">    docker.io/library/nginx:latest</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 3.å¯åŠ¨nginxå®¹å™¨</span></span><br><span class="line">  docker run -p 80:80 --name nginx01 -d nginx</span><br><span class="line"></span><br><span class="line"><span class="section"># 4.è¿›å…¥å®¹å™¨</span></span><br><span class="line">  docker exec -it nginx01 /bin/bash</span><br><span class="line">  æŸ¥æ‰¾ç›®å½•:  whereis nginx</span><br><span class="line">  é…ç½®æ–‡ä»¶:  /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="section"># 5.å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å®¿ä¸»æœº</span></span><br><span class="line">  docker cp nginx01(å®¹å™¨id|å®¹å™¨åç§°):/etc/nginx/nginx.conf å®¿ä¸»æœºåå½•</span><br><span class="line"></span><br><span class="line"><span class="section"># 6.æŒ‚åœ¨nginxé…ç½®ä»¥åŠhtmlåˆ°å®¿ä¸»æœºå¤–éƒ¨</span></span><br><span class="line">  docker run --name nginx02 -v /root/nginx/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/html:/usr/share/nginx/html -p 80:80 -d nginx  </span><br></pre></td></tr></table></figure><blockquote><p>å®‰è£…Tomcat</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.åœ¨docker hubæœç´¢tomcat</span></span><br><span class="line"> docker search tomcat</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.ä¸‹è½½tomcaté•œåƒ</span></span><br><span class="line"> docker pull tomcat</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.è¿è¡Œtomcaté•œåƒ</span></span><br><span class="line"> docker run -p 8080:8080 -d --name mytomcat tomcat</span><br><span class="line"></span><br><span class="line"><span class="section"># 4.è¿›å…¥tomcatå®¹å™¨</span></span><br><span class="line"> docker exec -it mytomcat /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="section"># 5.å°†webappsç›®å½•æŒ‚è½½åœ¨å¤–éƒ¨</span></span><br><span class="line"> docker run -p 8080:8080 -v /root/webapps:/usr/local/tomcat/webapps -d --name mytomcat tomcat</span><br></pre></td></tr></table></figure><blockquote><p>å®‰è£…MongoDBæ•°æ®åº“</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.è¿è¡ŒmongDB</span></span><br><span class="line"> docker run -d -p 27017:27017 --name mymongo mongo  ---æ— é¡»æƒé™</span><br><span class="line"> docker logs -f mymongo --æŸ¥çœ‹mongoè¿è¡Œæ—¥å¿—</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.è¿›å…¥mongodbå®¹å™¨</span></span><br><span class="line"> docker exec -it mymongo /bin/bash</span><br><span class="line">  ç›´æ¥æ‰§è¡Œmongoå‘½ä»¤è¿›è¡Œæ“ä½œ</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.å¸¸è§å…·æœ‰æƒé™çš„å®¹å™¨</span></span><br><span class="line"> docker run --name  mymongo  -p 27017:27017  -d mongo --auth</span><br><span class="line"></span><br><span class="line"><span class="section"># 4.è¿›å…¥å®¹å™¨é…ç½®ç”¨æˆ·åå¯†ç </span></span><br><span class="line"> mongo</span><br><span class="line"> use admin é€‰æ‹©adminåº“</span><br><span class="line"> db.createUser(&#123;user:&quot;root&quot;,pwd:&quot;root&quot;,roles:[&#123;role:&#x27;root&#x27;,db:&#x27;admin&#x27;&#125;]&#125;)   //åˆ›å»ºç”¨æˆ·,æ­¤ç”¨æˆ·åˆ›å»ºæˆåŠŸ,åˆ™åç»­æ“ä½œéƒ½éœ€è¦ç”¨æˆ·è®¤è¯</span><br><span class="line"> exit</span><br><span class="line"></span><br><span class="line"><span class="section"># 5.å°†mongoDBä¸­æ•°æ®ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºä¸­</span></span><br><span class="line"> docker run -d -p 27017:27017 -v /root/mongo/data:/data/db --name mymongo mongo </span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ElasticSearch">å®‰è£…ElasticSearch</h3><p><em>æ³¨æ„ï¼šè°ƒé«˜JVMçº¿ç¨‹æ•°é™åˆ¶æ•°é‡</em></p><h4 id="æ‹‰å–é•œåƒè¿è¡Œelasticsearch">æ‹‰å–é•œåƒè¿è¡Œelasticsearch</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.dockerhub æ‹‰å–é•œåƒ</span></span><br><span class="line"> docker pull elasticsearch:6.4.2</span><br><span class="line"><span class="section"># 2.æŸ¥çœ‹dockeré•œåƒ</span></span><br><span class="line"> docker images</span><br><span class="line"><span class="section"># 3.è¿è¡Œdockeré•œåƒ</span></span><br><span class="line"> docker run -p 9200:9200 -p 9300:9300 elasticsearch:6.4.2</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨å‡ºç°å¦‚ä¸‹é”™è¯¯</li><li><img src="/img/docker-10.png" alt="image-20200602184321790"></li></ul><h4 id="é¢„å…ˆé…ç½®">é¢„å…ˆé…ç½®</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.åœ¨centosè™šæ‹Ÿæœºä¸­ï¼Œä¿®æ”¹é…ç½®sysctl.conf</span></span><br><span class="line"> vim /etc/sysctl.conf</span><br><span class="line"><span class="section"># 2.åŠ å…¥å¦‚ä¸‹é…ç½®</span></span><br><span class="line"> vm.max<span class="emphasis">_map_</span>count=262144 </span><br><span class="line"><span class="section"># 3.å¯ç”¨é…ç½®</span></span><br><span class="line"> sysctl -p</span><br><span class="line"> æ³¨ï¼šè¿™ä¸€æ­¥æ˜¯ä¸ºäº†é˜²æ­¢å¯åŠ¨å®¹å™¨æ—¶ï¼ŒæŠ¥å‡ºå¦‚ä¸‹é”™è¯¯ï¼š</span><br><span class="line"> bootstrap checks failed max virtual memory areas vm.max<span class="emphasis">_map_</span>count [65530] likely too low, increase to at least [262144]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨EleasticSearchå®¹å™¨">å¯åŠ¨EleasticSearchå®¹å™¨</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 0.å¤åˆ¶å®¹å™¨ä¸­dataç›®å½•åˆ°å®¿ä¸»æœºä¸­</span></span><br><span class="line"> docker cp å®¹å™¨id:/usr/share/share/elasticsearch/data /root/es</span><br><span class="line"><span class="section"># 1.è¿è¡ŒESå®¹å™¨ æŒ‡å®šjvmå†…å­˜å¤§å°å¹¶æŒ‡å®šikåˆ†è¯å™¨ä½ç½®</span></span><br><span class="line"> docker run -d --name es -p 9200:9200 -p 9300:9300 -e ES<span class="emphasis">_JAVA_</span>OPTS=&quot;-Xms128m -Xmx128m&quot; -v /root/es/plugins:/usr/share/elasticsearch/plugins -v /root/es/data:/usr/share/elasticsearch/data elasticsearch:6.4.2</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…IKåˆ†è¯å™¨">å®‰è£…IKåˆ†è¯å™¨</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„IKåˆ†è¯å™¨</span></span><br><span class="line"> wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.4.2/elasticsearch-analysis-ik-6.4.2.zip</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.è§£å‹åˆ°pluginsæ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line"> yum install -y unzip</span><br><span class="line"> unzip -d ik elasticsearch-analysis-ik-6.4.2.zip</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.æ·»åŠ è‡ªå®šä¹‰æ‰©å±•è¯å’Œåœç”¨è¯</span></span><br><span class="line"> cd plugins/elasticsearch/config</span><br><span class="line"> vim IKAnalyzer.cfg.xml</span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">comment</span>&gt;</span></span>IK Analyzer æ‰©å±•é…ç½®<span class="language-xml"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span></span><br><span class="line">  &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_dict&quot;</span>&gt;</span></span>ext<span class="emphasis">_dict.dic<span class="language-xml"><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">  &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span></span><br><span class="line"><span class="emphasis">  <span class="language-xml"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_stopwords&quot;</span>&gt;</span></span>ext_</span>stopwords.dic<span class="language-xml"><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span></span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 4.åœ¨ikåˆ†è¯å™¨ç›®å½•ä¸‹configç›®å½•ä¸­åˆ›å»ºext<span class="emphasis">_dict.dicæ–‡ä»¶   ç¼–ç ä¸€å®šè¦ä¸ºUTF-8æ‰èƒ½ç”Ÿæ•ˆ</span></span></span><br><span class="line"><span class="emphasis"><span class="section"> vim ext_</span>dict.dic åŠ å…¥æ‰©å±•è¯å³å¯</span></span><br><span class="line"><span class="section"># 5. åœ¨ikåˆ†è¯å™¨ç›®å½•ä¸‹configç›®å½•ä¸­åˆ›å»ºext<span class="emphasis">_stopword.dicæ–‡ä»¶ </span></span></span><br><span class="line"><span class="emphasis"><span class="section"> vim ext_</span>stopwords.dic åŠ å…¥åœç”¨è¯å³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 6.é‡å¯å®¹å™¨ç”Ÿæ•ˆ</span></span><br><span class="line"> docker restart å®¹å™¨id</span><br><span class="line"><span class="section"># 7.å°†æ­¤å®¹å™¨æäº¤æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒ</span></span><br><span class="line"> docker commit -a=&quot;xiaochen&quot; -m=&quot;es with IKAnalyzer&quot; å®¹å™¨id xiaochen/elasticsearch:6.4.2</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Kibana">å®‰è£…Kibana</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.ä¸‹è½½kibanaé•œåƒåˆ°æœ¬åœ°</span></span><br><span class="line"> docker pull kibana:6.4.2</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.å¯åŠ¨kibanaå®¹å™¨</span></span><br><span class="line"> docker run -d --name kibana -e ELASTICSEARCH<span class="emphasis">_URL=http://10.15.0.3:9200 -p 5601:5601 kibana:6.4.2</span></span><br></pre></td></tr></table></figure><h2 id="Dockerfile">Dockerfile</h2><h3 id="ä»€ä¹ˆæ˜¯Dockerfile">ä»€ä¹ˆæ˜¯Dockerfile</h3><p>Dockerfileå¯ä»¥è®¤ä¸ºæ˜¯<strong>Dockeré•œåƒçš„æè¿°æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬</strong>ã€‚ä¸»è¦ä½œç”¨æ˜¯<strong>ç”¨æ¥æ„å»ºdockeré•œåƒçš„æ„å»ºæ–‡ä»¶</strong>ã€‚</p><p><img src="https://s2.loli.net/2023/11/26/so7t6n1mhCFvJQy.png" alt="docker-03"><strong>é€šè¿‡æ¶æ„å›¾å¯ä»¥çœ‹å‡ºé€šè¿‡DockerFileå¯ä»¥ç›´æ¥æ„å»ºé•œåƒ</strong></p><h3 id="Dockerfileè§£æè¿‡ç¨‹">Dockerfileè§£æè¿‡ç¨‹</h3><h3 id="docker-13Dockerfileçš„ä¿ç•™å‘½ä»¤"><img src="https://s2.loli.net/2023/11/26/pT5fWHrLRQmxIe8.png" alt="docker-13">Dockerfileçš„ä¿ç•™å‘½ä»¤</h3><p>å®˜æ–¹è¯´æ˜:<a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p><table><thead><tr><th>ä¿ç•™å­—</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>FROM</td><td>å½“å‰é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„<code>ç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯FROM</code></td></tr><tr><td>MAINTAINER</td><td>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</td></tr><tr><td>RUN</td><td>æ„å»ºé•œåƒæ—¶éœ€è¦è¿è¡Œçš„æŒ‡ä»¤</td></tr><tr><td>EXPOSE</td><td>å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£å·</td></tr><tr><td>WORKDIR</td><td>æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</td></tr><tr><td>ENV</td><td>ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</td></tr><tr><td>ADD</td><td>å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹taråŒ…</td></tr><tr><td>COPY</td><td>ç±»ä¼¼äºADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­<br/>å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­&lt;åŸè·¯å¾„&gt;çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„&lt;ç›®æ ‡è·¯å¾„&gt;ä½ç½®</td></tr><tr><td>VOLUME</td><td>å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</td></tr><tr><td>CMD</td><td>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤<br/>Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMDä¼šè¢«docker runä¹‹åçš„å‚æ•°æ›¿æ¢</td></tr><tr><td>ENTRYPOINT</td><td>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤<br/>ENTRYPOINTçš„ç›®çš„å’ŒCMDä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå…¶å‚æ•°</td></tr></tbody></table><blockquote><p>FROM å‘½ä»¤</p></blockquote><p>åŸºäºé‚£ä¸ªé•œåƒè¿›è¡Œæ„å»ºæ–°çš„é•œåƒ,åœ¨æ„å»ºæ—¶ä¼šè‡ªåŠ¨ä»docker hubæ‹‰å–baseé•œåƒ å¿…é¡»ä½œä¸ºDockerfileçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤å‡ºç°</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span>  &lt;image&gt;</span><br><span class="line"><span class="keyword">FROM</span>  &lt;image&gt;[:&lt;tag&gt;]     ä½¿ç”¨ç‰ˆæœ¬ä¸å†™ä¸ºlatest</span><br><span class="line"><span class="keyword">FROM</span>  &lt;image&gt;[@&lt;digest&gt;]  ä½¿ç”¨æ‘˜è¦</span><br></pre></td></tr></table></figure><blockquote><p>MAINTAINER  å‘½ä»¤</p></blockquote><p>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€[åºŸå¼ƒ]</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MAINTAINER</span> &lt;name&gt;</span><br></pre></td></tr></table></figure><blockquote><p>RUN å‘½ä»¤</p></blockquote><p>RUNæŒ‡ä»¤å°†åœ¨å½“å‰æ˜ åƒä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤å¹¶æäº¤ç»“æœã€‚ç”Ÿæˆçš„æäº¤æ˜ åƒå°†ç”¨äºDockerfileä¸­çš„ä¸‹ä¸€æ­¥</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &lt;<span class="built_in">command</span>&gt; (shell form, the <span class="built_in">command</span> is run <span class="keyword">in</span> a shell, <span class="built_in">which</span> by default is /bin/sh -c on Linux or cmd /S /C on Windows)</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> hello</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>] (<span class="built_in">exec</span> form)</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo hello&quot;</span>]</span></span><br></pre></td></tr></table></figure><blockquote><p>EXPOSE å‘½ä»¤</p></blockquote><p>ç”¨æ¥æŒ‡å®šæ„å»ºçš„é•œåƒåœ¨è¿è¡Œä¸ºå®¹å™¨æ—¶å¯¹å¤–æš´éœ²çš„ç«¯å£</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/tcp  å¦‚æœæ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šåˆ™é»˜è®¤æš´éœ²éƒ½æ˜¯tcp</span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/udp</span><br></pre></td></tr></table></figure><blockquote><p>CMD å‘½ä»¤</p></blockquote><p>ç”¨æ¥ä¸ºå¯åŠ¨çš„å®¹å™¨æŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤,åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€æ¡CMDæŒ‡ä»¤ã€‚å¦‚æœåˆ—å‡ºå¤šä¸ªå‘½ä»¤ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</p><p>æ³¨æ„: <strong>Dockerfileä¸­åªèƒ½æœ‰ä¸€æ¡CMDæŒ‡ä»¤ã€‚å¦‚æœåˆ—å‡ºå¤šä¸ªå‘½ä»¤ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>,<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] (<span class="built_in">exec</span> form, this is the preferred form)</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] (as default parameters to ENTRYPOINT)</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">command</span> param1 param2 (shell form)</span></span><br></pre></td></tr></table></figure><blockquote><p>WORKDIR å‘½ä»¤</p></blockquote><p>ç”¨æ¥ä¸ºDockerfileä¸­çš„ä»»ä½•RUNã€CMDã€ENTRYPOINTã€COPYå’ŒADDæŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚å¦‚æœWORKDIRä¸å­˜åœ¨ï¼Œå³ä½¿å®ƒæ²¡æœ‰åœ¨ä»»ä½•åç»­DockerfileæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œå®ƒä¹Ÿå°†è¢«åˆ›å»ºã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /path/to/workdir</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> c</span></span><br><span class="line">`æ³¨æ„:<span class="keyword">WORKDIR</span><span class="language-bash">æŒ‡ä»¤å¯ä»¥åœ¨Dockerfileä¸­å¤šæ¬¡ä½¿ç”¨ã€‚å¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„ï¼Œåˆ™è¯¥è·¯å¾„å°†ä¸å…ˆå‰WORKDIRæŒ‡ä»¤çš„è·¯å¾„ç›¸å¯¹`</span></span><br></pre></td></tr></table></figure><blockquote><p>ENV å‘½ä»¤</p></blockquote><p>ç”¨æ¥ä¸ºæ„å»ºé•œåƒè®¾ç½®ç¯å¢ƒå˜é‡ã€‚è¿™ä¸ªå€¼å°†å‡ºç°åœ¨æ„å»ºé˜¶æ®µä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...</span><br></pre></td></tr></table></figure><blockquote><p>ADD å‘½ä»¤</p></blockquote><p>ç”¨æ¥ä»contextä¸Šä¸‹æ–‡å¤åˆ¶æ–°æ–‡ä»¶ã€ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶urlï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ä½äºæŒ‡å®šè·¯å¾„çš„æ˜ åƒæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> hom* /mydir/       é€šé…ç¬¦æ·»åŠ å¤šä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> hom?.txt /mydir/   é€šé…ç¬¦æ·»åŠ </span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> test.txt relativeDir/  å¯ä»¥æŒ‡å®šç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> test.txt /absoluteDir/ ä¹Ÿå¯ä»¥æŒ‡å®šç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> url </span></span><br></pre></td></tr></table></figure><blockquote><p>COPY å‘½ä»¤</p></blockquote><p>ç”¨æ¥å°†contextç›®å½•ä¸­æŒ‡å®šæ–‡ä»¶å¤åˆ¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½•ä¸­</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> src dest</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [<span class="string">&quot;&lt;src&gt;&quot;</span>,... <span class="string">&quot;&lt;dest&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure><blockquote><p>VOLUME å‘½ä»¤</p></blockquote><p>ç”¨æ¥å®šä¹‰å®¹å™¨è¿è¡Œæ—¶å¯ä»¥æŒ‚åœ¨åˆ°å®¿ä¸»æœºçš„ç›®å½•</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/data&quot;</span>]</span></span><br></pre></td></tr></table></figure><blockquote><p>ENTRYPOINTå‘½ä»¤</p></blockquote><p>ç”¨æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œå‘½ä»¤å’ŒCMDç±»ä¼¼</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> <span class="built_in">command</span> param1 param2</span></span><br></pre></td></tr></table></figure><p>ENTRYPOINTæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨åçš„<strong>ç¬¬ä¸€ä¸ªå‘½ä»¤</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¾€å¾€æ˜¯å›ºå®šçš„ã€‚<br>CMDæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨çš„ç¬¬ä¸€ä¸ªå‘½ä»¤çš„<strong>é»˜è®¤å‚æ•°</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¯ä»¥æ˜¯å˜åŒ–çš„ã€‚</p><h2 id="é«˜çº§ç½‘ç»œé…ç½®">é«˜çº§ç½‘ç»œé…ç½®</h2><p>å½“ Docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª docker0`è™šæ‹Ÿç½‘æ¡¥ï¼Œå®é™…ä¸Šæ˜¯ Linux çš„ä¸€ä¸ª bridgeï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½¯ä»¶äº¤æ¢æœºã€‚å®ƒä¼šåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚</p><p>åŒæ—¶ï¼ŒDocker éšæœºåˆ†é…ä¸€ä¸ªæœ¬åœ°æœªå ç”¨çš„ç§æœ‰ç½‘æ®µï¼ˆåœ¨ <a href="https://tools.ietf.org/html/rfc1918">RFC1918</a> ä¸­å®šä¹‰ï¼‰ä¸­çš„ä¸€ä¸ªåœ°å€ç»™<code>docker0</code>æ¥å£ã€‚æ¯”å¦‚å…¸å‹çš„<code>172.17.42.1</code>ï¼Œæ©ç ä¸º<code>255.255.0.0</code>ã€‚æ­¤åå¯åŠ¨çš„å®¹å™¨å†…çš„ç½‘å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŒä¸€ç½‘æ®µï¼ˆ<code>172.17.0.0/16</code>ï¼‰çš„åœ°å€ã€‚</p><p>å½“åˆ›å»ºä¸€ä¸ª Docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºäº†ä¸€å¯¹<code>veth pair</code>æ¥å£ï¼ˆå½“æ•°æ®åŒ…å‘é€åˆ°ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥æ”¶åˆ°ç›¸åŒçš„æ•°æ®åŒ…ï¼‰ã€‚è¿™å¯¹æ¥å£ä¸€ç«¯åœ¨å®¹å™¨å†…ï¼Œå³<code>eth0</code>ï¼›å¦ä¸€ç«¯åœ¨æœ¬åœ°å¹¶è¢«æŒ‚è½½åˆ°<code>docker0</code>ç½‘æ¡¥ï¼Œåç§°ä»¥<code>veth</code>å¼€å¤´ï¼ˆä¾‹å¦‚<code>vethAQI2QT</code>ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’é€šä¿¡ã€‚Docker å°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚</p><blockquote><p><img src="https://s2.loli.net/2023/11/26/5VrBC3LuIGOAZDe.png" alt="docker-17">æŸ¥çœ‹ç½‘ç»œä¿¡æ¯</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># docker network ls</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºä¸€ä¸ªç½‘æ¡¥</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># docker network create -d bridge ç½‘æ¡¥åç§°</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤ä¸€ä¸ªç½‘æ¡¥</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># docker network rm ç½‘æ¡¥åç§°</span></span><br></pre></td></tr></table></figure><blockquote><p>å®¹å™¨ä¹‹å‰ä½¿ç”¨ç½‘ç»œé€šä¿¡</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.æŸ¥è¯¢å½“å‰ç½‘ç»œé…ç½®</span></span><br><span class="line"><span class="bullet">-</span> docker network ls</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">8e424e5936b7        bridge              bridge              local</span><br><span class="line">17d974db02da        docker_gwbridge     bridge              local</span><br><span class="line">d6c326e433f7        host                host                local</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 2.åˆ›å»ºæ¡¥æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="bullet">-</span> docker network create -d bridge info</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# docker network create -d bridge info</span><br><span class="line">6e4aaebff79b1df43a064e0e8fdab08f52d64ce34db78dd5184ce7aaaf550a2f</span><br><span class="line">[root@centos ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">8e424e5936b7        bridge              bridge              local</span><br><span class="line">17d974db02da        docker_gwbridge     bridge              local</span><br><span class="line">d6c326e433f7        host                host                local</span><br><span class="line">6e4aaebff79b        info                bridge              local</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 3.å¯åŠ¨å®¹å™¨æŒ‡å®šä½¿ç”¨ç½‘æ¡¥</span></span><br><span class="line"><span class="bullet">-</span> docker run -d -p 8890:80 --name nginx001 --network info nginx </span><br><span class="line"><span class="bullet">-</span> docker run -d -p 8891:80 --name nginx002 --network info nginx </span><br><span class="line"> <span class="code">`æ³¨æ„:ä¸€æ—¦æŒ‡å®šç½‘æ¡¥å--nameæŒ‡å®šåå­—å°±æ˜¯ä¸»æœºå,å¤šä¸ªå®¹å™¨æŒ‡å®šåœ¨åŒä¸€ä¸ªç½‘æ¡¥æ—¶,å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªå®¹å™¨ä¸­ä½¿ç”¨ä¸»æœºåä¸å®¹å™¨è¿›è¡Œäº’é€š`</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# docker run -d -p 8890:80 --name nginx001 --network info nginx </span><br><span class="line">c315bcc94e9ddaa36eb6c6f16ca51592b1ac8bf1ecfe9d8f01d892f3f10825fe</span><br><span class="line">[root@centos ~]# docker run -d -p 8891:80 --name nginx002 --network info nginx</span><br><span class="line">f8682db35dd7fb4395f90edb38df7cad71bbfaba71b6a4c6e2a3a525cb73c2a5</span><br><span class="line">[root@centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">f8682db35dd7        nginx               &quot;/docker-entrypoint.â€¦&quot;   3 seconds ago       Up 2 seconds        0.0.0.0:8891-&gt;80/tcp   nginx002</span><br><span class="line">c315bcc94e9d        nginx               &quot;/docker-entrypoint.â€¦&quot;   7 minutes ago       Up 7 minutes        0.0.0.0:8890-&gt;80/tcp   nginx001</span><br><span class="line">b63169d43792        mysql:5.7.19        &quot;docker-entrypoint.sâ€¦&quot;   7 minutes ago       Up 7 minutes        3306/tcp               mysql_mysql.1.s75qe5kkpwwttyf0wrjvd2cda</span><br><span class="line">[root@centos ~]# docker exec -it f8682db35dd7 /bin/bash</span><br><span class="line">root@f8682db35dd7:/# curl http://nginx001</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><h2 id="é«˜çº§æ•°æ®å·é…ç½®">é«˜çº§æ•°æ®å·é…ç½®</h2><p><strong>æ•°æ®å·</strong> æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š</p><ul><li>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨</li><li>å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ</li><li>å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ</li><li>æ•°æ®å·é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤</li></ul><p>æ³¨ï¼šæ•°æ®å·çš„ä½¿ç”¨ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountï¼Œé•œåƒä¸­çš„è¢«æŒ‡å®šä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ä¸­çš„æ–‡ä»¶ä¼šå¤åˆ¶åˆ°æ•°æ®å·ä¸­ï¼ˆä»…æ•°æ®å·ä¸ºç©ºæ—¶ä¼šå¤åˆ¶ï¼‰</p><blockquote><p>åˆ›å»ºæ•°æ®å·</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# docker volume create my-vol</span><br><span class="line">my-vol</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹æ•°æ®å·</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# docker volume inspect my-vol</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2020-11-25T11:43:56+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/my-vol/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;my-vol&quot;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>æŒ‚è½½æ•°æ®å·</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# docker run -d -P --name web  -v my-vol:/usr/share/nginx/html  nginx</span><br><span class="line">[root@centos ~]# docker inspect web</span><br><span class="line">    &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;my-vol&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/my-vol/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/usr/share/nginx/html&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;z&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤æ•°æ®å·</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume rm my-vol</span><br></pre></td></tr></table></figure><hr><h2 id="12-Docker-Compose">12.Docker Compose</h2><p><code>Compose</code>é¡¹ç›®æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹ Docker å®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚ä»åŠŸèƒ½ä¸Šçœ‹ï¼Œè·Ÿ<code>OpenStack</code>ä¸­çš„<code>Heat</code>ååˆ†ç±»ä¼¼ã€‚</p><p>å…¶ä»£ç ç›®å‰åœ¨ <a href="https://github.com/docker/compose">https://github.com/docker/compose</a> ä¸Šå¼€æºã€‚</p><p><code>Compose</code>å®šä½æ˜¯ ã€Œå®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨çš„åº”ç”¨ï¼ˆDefining and running multi-container Docker applicationsï¼‰ã€ï¼Œå…¶å‰èº«æ˜¯å¼€æºé¡¹ç›® Figã€‚</p><p>é€šè¿‡ç¬¬ä¸€éƒ¨åˆ†ä¸­çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä½¿ç”¨ä¸€ä¸ª<code>Dockerfile</code>æ¨¡æ¿æ–‡ä»¶ï¼Œå¯ä»¥è®©ç”¨æˆ·å¾ˆæ–¹ä¾¿çš„å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ã€‚ç„¶è€Œï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆæ¥å®ŒæˆæŸé¡¹ä»»åŠ¡çš„æƒ…å†µã€‚ä¾‹å¦‚è¦å®ç°ä¸€ä¸ª Web é¡¹ç›®ï¼Œé™¤äº† Web æœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ã€‚</p><p><code>Compose</code>æ°å¥½æ»¡è¶³äº†è¿™æ ·çš„éœ€æ±‚ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„<code>docker-compose.yml</code>æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰ã€‚</p><p><code>Compose</code>ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æœåŠ¡ (<code>service</code>)ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚</li><li>é¡¹ç›® (<code>project</code>)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨<code>docker-compose.yml</code>æ–‡ä»¶ä¸­å®šä¹‰ã€‚</li></ul><p><code>Compose</code>çš„é»˜è®¤ç®¡ç†å¯¹è±¡æ˜¯é¡¹ç›®ï¼Œé€šè¿‡å­å‘½ä»¤å¯¹é¡¹ç›®ä¸­çš„ä¸€ç»„å®¹å™¨è¿›è¡Œä¾¿æ·åœ°ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><p><code>Compose</code>é¡¹ç›®ç”± Python ç¼–å†™ï¼Œå®ç°ä¸Šè°ƒç”¨äº† Docker æœåŠ¡æä¾›çš„ API æ¥å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œåªè¦æ‰€æ“ä½œçš„å¹³å°æ”¯æŒ Docker APIï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šåˆ©ç”¨<code>Compose</code>æ¥è¿›è¡Œç¼–æ’ç®¡ç†ã€‚</p><h3 id="å®‰è£…ä¸å¸è½½">å®‰è£…ä¸å¸è½½</h3><blockquote><p>linux</p></blockquote><p>åœ¨ Linux ä¸Šçš„ä¹Ÿå®‰è£…ååˆ†ç®€å•ï¼Œä» å®˜æ–¹ GitHub Release å¤„ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ Linux 64 ä½ç³»ç»Ÿä¸Šç›´æ¥ä¸‹è½½å¯¹åº”çš„äºŒè¿›åˆ¶åŒ…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/1.25.5/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m`&gt; /usr/local/bin/docker-compose</span><br><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><blockquote><p>macosã€window</p></blockquote><p>Compose å¯ä»¥é€šè¿‡ Python çš„åŒ…ç®¡ç†å·¥å…· pip è¿›è¡Œå®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨ï¼Œç”šè‡³èƒ½å¤Ÿç›´æ¥åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œã€‚<code>Docker Desktop for Mac/Windows è‡ªå¸¦ docker-compose äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®‰è£… Docker ä¹‹åå¯ä»¥ç›´æ¥ä½¿ç”¨</code>ã€‚</p><blockquote><p>å¸è½½</p></blockquote><p>å¦‚æœæ˜¯äºŒè¿›åˆ¶åŒ…æ–¹å¼å®‰è£…çš„ï¼Œåˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å®‰è£…æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker-compose --version</span></span><br><span class="line"> docker-compose version 1.25.5, build 4667896b</span><br></pre></td></tr></table></figure><h3 id="docker-composeä½¿ç”¨">docker composeä½¿ç”¨</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.ç›¸å…³æ¦‚å¿µ</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆä»‹ç»å‡ ä¸ªæœ¯è¯­ã€‚</p><ul><li>æœåŠ¡ (<code>service</code>)ï¼šä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªç›¸åŒé•œåƒçš„å®ä¾‹ã€‚</li><li>é¡¹ç›® (<code>project</code>)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒã€‚âˆ‚ä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼Œ<code>Compose</code>é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ã€‚</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 2.åœºæ™¯</span></span><br></pre></td></tr></table></figure><p>æœ€å¸¸è§çš„é¡¹ç›®æ˜¯ web ç½‘ç«™ï¼Œè¯¥é¡¹ç›®åº”è¯¥åŒ…å« web åº”ç”¨å’Œç¼“å­˜ã€‚</p><ul><li>springbootåº”ç”¨</li><li>mysqlæœåŠ¡</li><li>redisæœåŠ¡</li><li>elasticsearchæœåŠ¡</li><li>â€¦</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 3.docker-composeæ¨¡æ¿</span></span><br><span class="line"><span class="bullet">-</span> å‚è€ƒæ–‡æ¡£:https://docker<span class="emphasis">_practice.gitee.io/zh-cn/compose/compose_</span>file.html</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysqldb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7.19</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/mysql/conf:/etc/mysql/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/mysql/logs:/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/mysql/data:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ems</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:4.0.14</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ems</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/redis/data:/data</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">ems:</span></span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 4.é€šè¿‡docker-composeè¿è¡Œä¸€ç»„å®¹å™¨</span></span><br><span class="line"><span class="bullet">-</span> å‚è€ƒæ–‡æ¡£:https://docker<span class="emphasis">_practice.gitee.io/zh-cn/compose/commands.html</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># docker-compose up           //å‰å°å¯åŠ¨ä¸€ç»„æœåŠ¡</span></span><br><span class="line">[root@centos ~]<span class="comment"># docker-compose up -d        //åå°å¯åŠ¨ä¸€ç»„æœåŠ¡</span></span><br></pre></td></tr></table></figure><hr><h3 id="docker-compose-æ¨¡æ¿æ–‡ä»¶">docker-compose æ¨¡æ¿æ–‡ä»¶</h3><p>æ¨¡æ¿æ–‡ä»¶æ˜¯ä½¿ç”¨<code>Compose</code>çš„æ ¸å¿ƒï¼Œæ¶‰åŠåˆ°çš„æŒ‡ä»¤å…³é”®å­—ä¹Ÿæ¯”è¾ƒå¤šã€‚ä½†å¤§å®¶ä¸ç”¨æ‹…å¿ƒï¼Œè¿™é‡Œé¢å¤§éƒ¨åˆ†æŒ‡ä»¤è·Ÿ<code>docker run</code>ç›¸å…³å‚æ•°çš„å«ä¹‰éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><p>é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶åç§°ä¸º<code>docker-compose.yml</code>ï¼Œæ ¼å¼ä¸º YAML æ ¼å¼ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webapp:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">examples/web</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/data&quot;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æ¯ä¸ªæœåŠ¡éƒ½å¿…é¡»é€šè¿‡<code>image</code>æŒ‡ä»¤æŒ‡å®šé•œåƒæˆ–<code>build</code>æŒ‡ä»¤ï¼ˆéœ€è¦ Dockerfileï¼‰ç­‰æ¥è‡ªåŠ¨æ„å»ºç”Ÿæˆé•œåƒã€‚</p><p>å¦‚æœä½¿ç”¨<code>build</code>æŒ‡ä»¤ï¼Œåœ¨<code>Dockerfile</code>ä¸­è®¾ç½®çš„é€‰é¡¹(ä¾‹å¦‚ï¼š<code>CMD</code>,<code>EXPOSE</code>,<code>VOLUME</code>,<code>ENV</code>ç­‰) å°†ä¼šè‡ªåŠ¨è¢«è·å–ï¼Œæ— éœ€åœ¨<code>docker-compose.yml</code>ä¸­é‡å¤è®¾ç½®ã€‚</p><p>ä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªæŒ‡ä»¤çš„ç”¨æ³•ã€‚</p><h4 id="build"><code>build</code></h4><p>æŒ‡å®š<code>Dockerfile</code>æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼ˆå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ç›¸å¯¹ docker-compose.yml æ–‡ä»¶çš„è·¯å¾„ï¼‰ã€‚<code>Compose</code>å°†ä¼šåˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»ºè¿™ä¸ªé•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">webapp:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./dir</span></span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>context</code>æŒ‡ä»¤æŒ‡å®š<code>Dockerfile</code>æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</p><p>ä½¿ç”¨<code>dockerfile</code>æŒ‡ä»¤æŒ‡å®š<code>Dockerfile</code>æ–‡ä»¶åã€‚</p><p>ä½¿ç”¨<code>arg</code>æŒ‡ä»¤æŒ‡å®šæ„å»ºé•œåƒæ—¶çš„å˜é‡ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">webapp:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./dir</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-alternate</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="attr">buildno:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="command"><code>command</code></h4><p>è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">command:</span> <span class="string">echo</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure><h4 id="container-name"><code>container_name</code></h4><p>æŒ‡å®šå®¹å™¨åç§°ã€‚é»˜è®¤å°†ä¼šä½¿ç”¨<code>é¡¹ç›®åç§°_æœåŠ¡åç§°_åºå·</code>è¿™æ ·çš„æ ¼å¼ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">container_name:</span> <span class="string">docker-web-container</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„: æŒ‡å®šå®¹å™¨åç§°åï¼Œè¯¥æœåŠ¡å°†æ— æ³•è¿›è¡Œæ‰©å±•ï¼ˆscaleï¼‰ï¼Œå› ä¸º Docker ä¸å…è®¸å¤šä¸ªå®¹å™¨å…·æœ‰ç›¸åŒçš„åç§°ã€‚</p></blockquote><h4 id="depends-on"><code>depends_on</code></h4><p>è§£å†³å®¹å™¨çš„ä¾èµ–ã€å¯åŠ¨å…ˆåçš„é—®é¢˜ã€‚ä»¥ä¸‹ä¾‹å­ä¸­ä¼šå…ˆå¯åŠ¨<code>redis``db</code>å†å¯åŠ¨<code>web</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">../../../æ–°å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<code>web</code>æœåŠ¡ä¸ä¼šç­‰å¾…<code>redis``db</code>ã€Œå®Œå…¨å¯åŠ¨ã€ä¹‹åæ‰å¯åŠ¨ã€‚</p></blockquote><h4 id="env-file"><code>env_file</code></h4><p>ä»æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºå•ç‹¬çš„æ–‡ä»¶è·¯å¾„æˆ–åˆ—è¡¨ã€‚</p><p>å¦‚æœé€šè¿‡<code>docker-compose -f FILE</code>æ–¹å¼æ¥æŒ‡å®š Compose æ¨¡æ¿æ–‡ä»¶ï¼Œåˆ™<code>env_file</code>ä¸­å˜é‡çš„è·¯å¾„ä¼šåŸºäºæ¨¡æ¿æ–‡ä»¶è·¯å¾„ã€‚</p><p>å¦‚æœæœ‰å˜é‡åç§°ä¸<code>environment</code>æŒ‡ä»¤å†²çªï¼Œåˆ™æŒ‰ç…§æƒ¯ä¾‹ï¼Œä»¥åè€…ä¸ºå‡†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">env_file: .<span class="built_in">env</span></span><br><span class="line"></span><br><span class="line">env_file:</span><br><span class="line">  - ./common.env</span><br><span class="line">  - ./apps/web.env</span><br><span class="line">  - /opt/secrets.env</span><br></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå¿…é¡»ç¬¦åˆæ ¼å¼ï¼Œæ”¯æŒ<code>#</code>å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># common.env: Set development environment</span></span><br><span class="line">PROG_ENV=development</span><br></pre></td></tr></table></figure><h4 id="environment"><code>environment</code></h4><p>è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ä¸¤ç§æ ¼å¼ã€‚</p><p>åªç»™å®šåç§°çš„å˜é‡ä¼šè‡ªåŠ¨è·å–è¿è¡Œ Compose ä¸»æœºä¸Šå¯¹åº”å˜é‡çš„å€¼ï¼Œå¯ä»¥ç”¨æ¥é˜²æ­¢æ³„éœ²ä¸å¿…è¦çš„æ•°æ®ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="attr">RACK_ENV:</span> <span class="string">development</span></span><br><span class="line">  <span class="attr">SESSION_SECRET:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RACK_ENV=development</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">SESSION_SECRET</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå˜é‡åç§°æˆ–è€…å€¼ä¸­ç”¨åˆ°<code>true|falseï¼Œyes|no</code>ç­‰è¡¨è¾¾ <a href="https://yaml.org/type/bool.html">å¸ƒå°”</a> å«ä¹‰çš„è¯æ±‡ï¼Œæœ€å¥½æ”¾åˆ°å¼•å·é‡Œï¼Œé¿å… YAML è‡ªåŠ¨è§£ææŸäº›å†…å®¹ä¸ºå¯¹åº”çš„å¸ƒå°”è¯­ä¹‰ã€‚è¿™äº›ç‰¹å®šè¯æ±‡ï¼ŒåŒ…æ‹¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y|Y|<span class="built_in">yes</span>|Yes|YES|n|N|no|No|NO|<span class="literal">true</span>|True|TRUE|<span class="literal">false</span>|False|FALSE|on|On|ON|off|Off|OFF</span><br></pre></td></tr></table></figure><h4 id="healthcheck"><code>healthcheck</code></h4><p>é€šè¿‡å‘½ä»¤æ£€æŸ¥å®¹å™¨æ˜¯å¦å¥åº·è¿è¡Œã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">healthcheck:</span></span><br><span class="line">  <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br><span class="line">  <span class="attr">interval:</span> <span class="string">1m30s</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="image"><code>image</code></h4><p>æŒ‡å®šä¸ºé•œåƒåç§°æˆ–é•œåƒ IDã€‚å¦‚æœé•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼Œ<code>Compose</code>å°†ä¼šå°è¯•æ‹‰å–è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">ubuntu</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">orchardup/postgresql</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">a4bc65fd</span></span><br></pre></td></tr></table></figure><h4 id="networks"><code>networks</code></h4><p>é…ç½®å®¹å™¨è¿æ¥çš„ç½‘ç»œã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">some-service:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">some-network</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">other-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">some-network:</span></span><br><span class="line">  <span class="attr">other-network:</span></span><br></pre></td></tr></table></figure><h4 id="ports"><code>ports</code></h4><p>æš´éœ²ç«¯å£ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨å®¿ä¸»ç«¯å£ï¼šå®¹å™¨ç«¯å£<code>(HOST:CONTAINER)</code>æ ¼å¼ï¼Œæˆ–è€…ä»…ä»…æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå®¿ä¸»å°†ä¼šéšæœºé€‰æ‹©ç«¯å£ï¼‰éƒ½å¯ä»¥ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ports:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;3000&quot;</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;49100:22&quot;</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:8001:8001&quot;</span></span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šå½“ä½¿ç”¨<code>HOST:CONTAINER</code>æ ¼å¼æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œå¦‚æœä½ ä½¿ç”¨çš„å®¹å™¨ç«¯å£å°äº 60 å¹¶ä¸”æ²¡æ”¾åˆ°å¼•å·é‡Œï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯ç»“æœï¼Œå› ä¸º<code>YAML</code>ä¼šè‡ªåŠ¨è§£æ<code>xx:yy</code>è¿™ç§æ•°å­—æ ¼å¼ä¸º 60 è¿›åˆ¶ã€‚ä¸ºé¿å…å‡ºç°è¿™ç§é—®é¢˜ï¼Œå»ºè®®æ•°å­—ä¸²éƒ½é‡‡ç”¨å¼•å·åŒ…æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚</em></p><h4 id="sysctls"><code>sysctls</code></h4><p>é…ç½®å®¹å™¨å†…æ ¸å‚æ•°ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sysctls:</span></span><br><span class="line">  <span class="attr">net.core.somaxconn:</span> <span class="number">1024</span></span><br><span class="line">  <span class="attr">net.ipv4.tcp_syncookies:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sysctls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">net.core.somaxconn=1024</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">net.ipv4.tcp_syncookies=0</span></span><br></pre></td></tr></table></figure><h4 id="ulimits"><code>ulimits</code></h4><p>æŒ‡å®šå®¹å™¨çš„ ulimits é™åˆ¶å€¼ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŒ‡å®šæœ€å¤§è¿›ç¨‹æ•°ä¸º 65535ï¼ŒæŒ‡å®šæ–‡ä»¶å¥æŸ„æ•°ä¸º 20000ï¼ˆè½¯é™åˆ¶ï¼Œåº”ç”¨å¯ä»¥éšæ—¶ä¿®æ”¹ï¼Œä¸èƒ½è¶…è¿‡ç¡¬é™åˆ¶ï¼‰ å’Œ 40000ï¼ˆç³»ç»Ÿç¡¬é™åˆ¶ï¼Œåªèƒ½ root ç”¨æˆ·æé«˜ï¼‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ulimits:</span></span><br><span class="line">  <span class="attr">nproc:</span> <span class="number">65535</span></span><br><span class="line">  <span class="attr">nofile:</span></span><br><span class="line">    <span class="attr">soft:</span> <span class="number">20000</span></span><br><span class="line">    <span class="attr">hard:</span> <span class="number">40000</span></span><br></pre></td></tr></table></figure><h4 id="volumes"><code>volumes</code></h4><p>æ•°æ®å·æ‰€æŒ‚è½½è·¯å¾„è®¾ç½®ã€‚å¯ä»¥è®¾ç½®ä¸ºå®¿ä¸»æœºè·¯å¾„(<code>HOST:CONTAINER</code>)æˆ–è€…æ•°æ®å·åç§°(<code>VOLUME:CONTAINER</code>)ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®è®¿é—®æ¨¡å¼ ï¼ˆ<code>HOST:CONTAINER:ro</code>ï¼‰ã€‚</p><p>è¯¥æŒ‡ä»¤ä¸­è·¯å¾„æ”¯æŒç›¸å¯¹è·¯å¾„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">/var/lib/mysql</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cache/:/tmp/cache</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">~/configs:/etc/configs/:ro</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè·¯å¾„ä¸ºæ•°æ®å·åç§°ï¼Œå¿…é¡»åœ¨æ–‡ä»¶ä¸­é…ç½®æ•°æ®å·ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">my_src:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql_data:/var/lib/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">mysql_data:</span></span><br></pre></td></tr></table></figure><hr><blockquote><p>docker-compose å¸¸ç”¨å‘½ä»¤</p></blockquote><h5 id="1-å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼">1. å‘½ä»¤å¯¹è±¡ä¸æ ¼å¼</h5><p>å¯¹äº Compose æ¥è¯´ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤çš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯é¡¹ç›®æœ¬èº«ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºé¡¹ç›®ä¸­çš„æœåŠ¡æˆ–è€…å®¹å™¨ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„è¯´æ˜ï¼Œå‘½ä»¤å¯¹è±¡å°†æ˜¯é¡¹ç›®ï¼Œè¿™æ„å‘³ç€é¡¹ç›®ä¸­æ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šå—åˆ°å‘½ä»¤å½±å“ã€‚</p><p>æ‰§è¡Œ<code>docker-compose [COMMAND] --help</code>æˆ–è€…<code>docker-compose help [COMMAND]</code>å¯ä»¥æŸ¥çœ‹å…·ä½“æŸä¸ªå‘½ä»¤çš„ä½¿ç”¨æ ¼å¼ã€‚</p><p><code>docker-compose</code>å‘½ä»¤çš„åŸºæœ¬çš„ä½¿ç”¨æ ¼å¼æ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose [-f=&lt;arg&gt;...] [options] [COMMAND] [ARGS...]</span><br></pre></td></tr></table></figure><h5 id="2-å‘½ä»¤é€‰é¡¹">2. å‘½ä»¤é€‰é¡¹</h5><ul><li><code>-f, --file FILE</code>æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º<code>docker-compose.yml</code>ï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚</li><li><code>-p, --project-name NAME</code>æŒ‡å®šé¡¹ç›®åç§°ï¼Œé»˜è®¤å°†ä½¿ç”¨æ‰€åœ¨ç›®å½•åç§°ä½œä¸ºé¡¹ç›®åã€‚</li><li><code>--x-networking</code>ä½¿ç”¨ Docker çš„å¯æ‹”æ’ç½‘ç»œåç«¯ç‰¹æ€§</li><li><code>--x-network-driver DRIVER</code>æŒ‡å®šç½‘ç»œåç«¯çš„é©±åŠ¨ï¼Œé»˜è®¤ä¸º<code>bridge</code></li><li><code>--verbose</code>è¾“å‡ºæ›´å¤šè°ƒè¯•ä¿¡æ¯ã€‚</li><li><code>-v, --version</code>æ‰“å°ç‰ˆæœ¬å¹¶é€€å‡ºã€‚</li></ul><h5 id="3-å‘½ä»¤ä½¿ç”¨è¯´æ˜">3.å‘½ä»¤ä½¿ç”¨è¯´æ˜</h5><h5 id="up"><code>up</code></h5><p>æ ¼å¼ä¸º<code>docker-compose up [options] [SERVICE...]</code>ã€‚</p><ul><li><p>è¯¥å‘½ä»¤ååˆ†å¼ºå¤§ï¼Œå®ƒå°†å°è¯•è‡ªåŠ¨å®ŒæˆåŒ…æ‹¬æ„å»ºé•œåƒï¼Œï¼ˆé‡æ–°ï¼‰åˆ›å»ºæœåŠ¡ï¼Œå¯åŠ¨æœåŠ¡ï¼Œå¹¶å…³è”æœåŠ¡ç›¸å…³å®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œã€‚</p></li><li><p>é“¾æ¥çš„æœåŠ¡éƒ½å°†ä¼šè¢«è‡ªåŠ¨å¯åŠ¨ï¼Œé™¤éå·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p></li><li><p>å¯ä»¥è¯´ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½å¯ä»¥ç›´æ¥é€šè¿‡è¯¥å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªé¡¹ç›®ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µï¼Œ<code>docker-compose up</code>å¯åŠ¨çš„å®¹å™¨éƒ½åœ¨å‰å°ï¼Œæ§åˆ¶å°å°†ä¼šåŒæ—¶æ‰“å°æ‰€æœ‰å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡Œè°ƒè¯•ã€‚</p></li><li><p>å½“é€šè¿‡<code>Ctrl-C</code>åœæ­¢å‘½ä»¤æ—¶ï¼Œæ‰€æœ‰å®¹å™¨å°†ä¼šåœæ­¢ã€‚</p></li><li><p>å¦‚æœä½¿ç”¨<code>docker-compose up -d</code>ï¼Œå°†ä¼šåœ¨åå°å¯åŠ¨å¹¶è¿è¡Œæ‰€æœ‰çš„å®¹å™¨ã€‚ä¸€èˆ¬æ¨èç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µï¼Œå¦‚æœæœåŠ¡å®¹å™¨å·²ç»å­˜åœ¨ï¼Œ<code>docker-compose up</code>å°†ä¼šå°è¯•åœæ­¢å®¹å™¨ï¼Œç„¶åé‡æ–°åˆ›å»ºï¼ˆä¿æŒä½¿ç”¨<code>volumes-from</code>æŒ‚è½½çš„å·ï¼‰ï¼Œä»¥ä¿è¯æ–°å¯åŠ¨çš„æœåŠ¡åŒ¹é…<code>docker-compose.yml</code>æ–‡ä»¶çš„æœ€æ–°å†…å®¹</p></li></ul><hr><h5 id="down"><code>down</code></h5><ul><li>æ­¤å‘½ä»¤å°†ä¼šåœæ­¢<code>up</code>å‘½ä»¤æ‰€å¯åŠ¨çš„å®¹å™¨ï¼Œå¹¶ç§»é™¤ç½‘ç»œ</li></ul><hr><h5 id="exec"><code>exec</code></h5><ul><li>è¿›å…¥æŒ‡å®šçš„å®¹å™¨ã€‚</li></ul><hr><h5 id="ps"><code>ps</code></h5><p>æ ¼å¼ä¸º<code>docker-compose ps [options] [SERVICE...]</code>ã€‚</p><p>åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-q</code>åªæ‰“å°å®¹å™¨çš„ ID ä¿¡æ¯ã€‚</li></ul><hr><h5 id="restart"><code>restart</code></h5><p>æ ¼å¼ä¸º<code>docker-compose restart [options] [SERVICE...]</code>ã€‚</p><p>é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-t, --timeout TIMEOUT</code>æŒ‡å®šé‡å¯å‰åœæ­¢å®¹å™¨çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚</li></ul><hr><h5 id="rm"><code>rm</code></h5><p>æ ¼å¼ä¸º<code>docker-compose rm [options] [SERVICE...]</code>ã€‚</p><p>åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨ã€‚æ¨èå…ˆæ‰§è¡Œ<code>docker-compose stop</code>å‘½ä»¤æ¥åœæ­¢å®¹å™¨ã€‚</p><p>é€‰é¡¹ï¼š</p><ul><li><code>-f, --force</code>å¼ºåˆ¶ç›´æ¥åˆ é™¤ï¼ŒåŒ…æ‹¬éåœæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¸€èˆ¬å°½é‡ä¸è¦ä½¿ç”¨</li></ul>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¯å¢ƒéƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Node.JSç®€å•äº†è§£</title>
    <link href="/2022/11/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/Node.JS%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3/"/>
    <url>/2022/11/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/Node.JS%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1>Node.JSç®€å•äº†è§£</h1><p>node.js æ˜¯åŸºäºChrome JavaScript è¿è¡Œæ—¶å»ºç«‹çš„ä¸€ä¸ªå¹³å°ï¼Œç®€å•è¯´å°±æ˜¯ä¸éœ€è¦æµè§ˆå™¨å°±å¯ä»¥æ‰§è¡Œ javascript ä»£ç </p><h2 id="å®‰è£…åŠé…ç½®">å®‰è£…åŠé…ç½®</h2><h3 id="ä¸‹è½½å®‰è£…-Node-js">ä¸‹è½½å®‰è£… Node.js</h3><p>è®¿é—®å®˜ç½‘ä¸‹è½½å®‰è£…åˆé€‚çš„ node.jsï¼š<a href="https://nodejs.org/zh-cn/%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%A5%BD%E5%90%8E%E5%8F%8C%E5%87%BB%E5%AE%89%E8%A3%85%EF%BC%8C%E5%85%A8%E7%A8%8B%E4%B8%8B%E4%B8%80%E6%AD%A5%E5%8D%B3%E5%8F%AF">https://nodejs.org/zh-cn/ï¼Œä¸‹è½½å¥½ååŒå‡»å®‰è£…ï¼Œå…¨ç¨‹ä¸‹ä¸€æ­¥å³å¯</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨cmdæ£€æµ‹nodeæ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">C:\Users\Administrator&gt;node -v   # æŸ¥çœ‹nodeç‰ˆæœ¬</span><br><span class="line">v10.16.3</span><br><span class="line">C:\Users\Administrator&gt;npm -v    # æŸ¥çœ‹npmç‰ˆæœ¬</span><br><span class="line">6.9.0</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å®‰è£…åŠç¼“å­˜è·¯å¾„">ä¿®æ”¹å®‰è£…åŠç¼“å­˜è·¯å¾„</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å®‰è£…äº†æŸä¸ªå…¨å±€åŒ…çš„æ—¶å€™ï¼Œæ˜¯å­˜æ”¾åœ¨Cç›˜çš„ï¼Œå…·ä½“å­˜æ”¾è·¯å¾„å¯åœ¨æ§åˆ¶å°è¾“å…¥<code>npm root -g</code>æŸ¥çœ‹ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦å°†ç›®å½•ä¿®æ”¹ä¸ºè‡ªå·±çš„ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>**1.**åœ¨ node çš„å®‰è£…ç›®å½•æ–°å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹   å…¨å±€åŒ…ä¸‹è½½ <code>node_global</code>ï¼Œnodeç¼“å­˜ <code>node_cache</code></p><p><img src="..//img/node-01.jpg" alt=""></p><p>**2.**æ‰§è¡Œå‘½ä»¤ä¿®æ”¹ä¸¤ä¸ªç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set prefix &quot;node_globalç›®å½•&quot;</span><br><span class="line">npm config set cache &quot;node_cacheç›®å½•&quot;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç¯å¢ƒå˜é‡">ä¿®æ”¹ç¯å¢ƒå˜é‡</h3><p>å½“æˆ‘ä»¬ä¿®æ”¹äº†å…¨å±€å®‰è£…è·¯å¾„åŠç¼“å­˜åï¼Œç¯å¢ƒå˜é‡è¿˜æ˜¯æ²¡æœ‰ä¿®æ”¹çš„ï¼Œéœ€è¦å»ä¿®æ”¹ç¯å¢ƒå˜é‡</p><p>**1.**åœ¨ç”¨æˆ·å˜é‡ <code>path</code> ä¸­æ·»åŠ è‡ªå·±åˆ›å»ºçš„ <code>node_global</code> ç›®å½•</p><p>**2.**ç³»ç»Ÿå˜é‡ä¸­æ–°å»º <code>NODE_PATH</code> ä¸º node å®‰è£…ç›®å½•ä¸‹çš„ <code>modules</code> ç›®å½•</p><p>**3.**åœ¨ç³»ç»Ÿå˜é‡ä¸­çš„ <code>path</code> ä¸­æ·»åŠ  node çš„å®‰è£…ç›®å½•ï¼Œè¿™ä¸ªä¸€èˆ¬åœ¨å®‰è£…çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ·»åŠ ï¼Œå¦‚æœæ²¡æœ‰å°±æ‰‹åŠ¨æ·»åŠ </p><h2 id="NPM-ç®€å•ä»‹ç»">NPM ç®€å•ä»‹ç»</h2><h3 id="NPM-ç®€å•äº†è§£">NPM ç®€å•äº†è§£</h3><p>npm æ˜¯ç”¨æ¥è¾…åŠ© node.js çš„åŒ…ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼ maven ä¸€æ ·å¯ä»¥ä¸‹è½½å„ç§åŒ…/ä¾èµ–ï¼Œç›®å‰çš„ node åŸºæœ¬åœ¨å®‰è£…çš„æ—¶å€™å°±å°† npm ä¸€å¹¶å®‰è£…å¥½äº†</p><blockquote><p>npm çš„ç®€å•å‘½ä»¤</p></blockquote><table><thead><tr><th>å‘½ä»¤è¯­æ³•</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>npm -v</td><td>æŸ¥çœ‹å½“å‰å®‰è£…çš„ npm çš„ç‰ˆæœ¬</td></tr><tr><td>npm install npm -g</td><td>å‡çº§ npm ç‰ˆæœ¬å·</td></tr><tr><td>npm config set proxy [location]</td><td>è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼Œnull ä»£è¡¨å…³é—­ä»£ç†</td></tr></tbody></table><blockquote><p>å…¨å±€å®‰è£…ä¸æœ¬åœ°å®‰è£…</p></blockquote><p><strong>æœ¬åœ°å®‰è£…</strong> æ˜¯å®‰è£…åœ¨å½“å‰ç›®å½•ä¸‹çš„ <code>node_modules</code> ç›®å½•ä¸­ï¼Œå¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨çš„è¯ä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œè¯­æ³•ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @vue/cli</span><br></pre></td></tr></table></figure><p><strong>å…¨å±€å®‰è£…</strong> æ˜¯å®‰è£…åœ¨ä¹‹å‰é…ç½®çš„ä¸¤ä¸ªç›®å½•ä¸­ï¼Œ<code>-g</code> ä»£è¡¨ global å…¨å±€çš„æ„æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šå‘½ä»¤</p></blockquote><table><thead><tr><th>å‘½ä»¤è¯­æ³•</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>npm init</td><td>åˆå§‹åŒ–ç®€å•çš„ package.json æ–‡ä»¶</td></tr><tr><td>npm init --yes|-y</td><td>åˆå§‹åŒ–ç®€å•çš„ package.json æ–‡ä»¶ï¼Œå·æ‡’ä¸ç”¨ä¸€ç›´æŒ‰enter</td></tr><tr><td>npm inistall åŒ…å</td><td>æœ¬åœ°å®‰è£…ï¼Œå®‰è£…åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œä¸åœ¨ package.json ä¸­å†™å…¥ä¾èµ–</td></tr><tr><td>npm inistall åŒ…å -g</td><td>å…¨å±€å®‰è£…ï¼Œå®‰è£…åœ¨ Node å®‰è£…ç›®å½•ä¸‹çš„ node_modules ä¸‹</td></tr><tr><td>npm inistall åŒ…å -s</td><td>æœ¬åœ°å®‰è£…ï¼Œå¹¶åœ¨ package.json æ–‡ä»¶çš„ dependencies ä¸­å†™å…¥ä¾èµ–</td></tr><tr><td>npm inistall åŒ…å -D</td><td>æœ¬åœ°å®‰è£…ï¼Œç­‰ä»·äºâ€“save -dev</td></tr><tr><td>npm uninstall åŒ…å</td><td>æœ¬åœ°å¸è½½</td></tr><tr><td>npm uninstall åŒ…å -g</td><td>å…¨å±€å¸è½½</td></tr><tr><td>npm info åŒ…å</td><td>å¯ä»¥æŸ¥çœ‹æŒ‡å®šåŒ…çš„å†å²ç‰ˆæœ¬</td></tr><tr><td>npm inistall åŒ…å@x.x.x</td><td>åœ¨å®‰è£…æŒ‡å®šåŒ…çš„æ—¶å€™ä½¿ç”¨@å¯ä»¥æŒ‡å®šå®‰è£…çš„ç‰ˆæœ¬</td></tr></tbody></table><h3 id="å®‰è£…æ·˜å®é•œåƒ">å®‰è£…æ·˜å®é•œåƒ</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ npm å®‰è£…æŸäº›ä¾èµ–çš„æ—¶å€™ï¼Œä¼šå‘ç°å®‰è£…éå¸¸çš„æ…¢ï¼Œå› ä¸º npm é»˜è®¤çš„å›½å¤–çš„ä¸‹è½½åœ°å€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å®‰è£…æ·˜å®é•œåƒæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ·˜å®é•œåƒå¯¹åº”çš„æ˜¯ <code>cnpm</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…¨å±€å®‰è£…æ·˜å®é•œåƒ</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä¹‹åç®€å•ä½¿ç”¨ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€èˆ¬å®‰è£…vue</span></span><br><span class="line">npm install -g @vue/cli</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·˜å®é•œåƒå®‰è£…vue</span></span><br><span class="line">cnpm install -g @vue/cli</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-NRM-æºç®¡ç†å™¨">å®‰è£… NRM æºç®¡ç†å™¨</h3><p>é™¤äº†å®‰è£… cnpm æ·˜å®é•œåƒä¹‹å¤–è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å®‰è£…æ·˜å®é•œåƒï¼Œé‚£å°±æ˜¯ nrm æºç®¡ç†å™¨ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥å®‰è£… nrm æºç®¡ç†å™¨ï¼š</p><blockquote><p>å…¨å±€å®‰è£… nrm æºç®¡ç†å™¨</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i nrm -g    # è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨cnpmå®‰è£…ï¼Œå½“å‰å‰æå¾—å®‰è£…æ·˜å®é•œåƒ</span><br></pre></td></tr></table></figure><p>ç­‰å¾…å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ç‰ˆæœ¬å·æ¥æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">çœ‹åˆ°ç‰ˆæœ¬å·ï¼Œå®‰è£…æˆåŠŸ</span></span><br><span class="line">C:\Users\Administrator&gt;nrm -V</span><br><span class="line">1.2.1</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡æºç®¡ç†å™¨æ¥æ›´ç®¡ npm çš„æºè®¾ç½® <code>nrm use taobao</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">useä»£è¡¨é€‰æ‹©ï¼Œé€‰æ‹©ä½¿ç”¨æ·˜å®çš„é•œåƒ</span></span><br><span class="line">C:\Users\Administrator&gt;nrm use taobao</span><br><span class="line">   Registry has been set to: https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ npm è¿›è¡Œä¸‹è½½çš„æ—¶å€™ï¼Œä½¿ç”¨çš„å°±æ˜¯æ·˜å®çš„æºäº†ï¼Œé™¤å¼€æ·˜å®ä¹‹å¤–è¿˜å¯ä»¥åˆ‡æ¢ä¸€äº›å…¶ä»–çš„æºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">taobao å‰é¢å¸¦æœ‰*å°±è¡¨ç¤ºå½“å‰é€‰æ‹©æ˜¯æ·˜å®é•œåƒï¼Œç¬¬ä¸€ä¸ªnpmå°±æ˜¯é»˜è®¤çš„å›½å¤–é•œåƒ</span></span><br><span class="line">C:\Users\Administrator&gt;nrm ls</span><br><span class="line"></span><br><span class="line">  npm -------- https://registry.npmjs.org/</span><br><span class="line">  yarn ------- https://registry.yarnpkg.com/</span><br><span class="line">  cnpm ------- http://r.cnpmjs.org/</span><br><span class="line">* taobao ----- https://registry.npm.taobao.org/</span><br><span class="line">  nj --------- https://registry.nodejitsu.com/</span><br><span class="line">  npmMirror -- https://skimdb.npmjs.com/registry/</span><br><span class="line">  edunpm ----- http://registry.enpmjs.org/</span><br></pre></td></tr></table></figure><h2 id="Node-JS-ä½“éªŒ">Node.JS ä½“éªŒ</h2><blockquote><p>å†™ä¸€ä¸ª helloword ç¨‹åº</p></blockquote><p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ª  <code>hello.js</code> æ–‡ä»¶ï¼Œåœ¨é‡Œé¢ä¹¦å†™ js çš„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello Node.js!&quot;</span>);</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥è¿è¡Œåˆšåˆšåˆ›å»ºå¥½çš„ç¨‹åºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¨‹åºæˆåŠŸæ‰§è¡Œäº†ï¼</span></span><br><span class="line">PS D:\Workspase\VScode\Node&gt; node hello.js</span><br><span class="line">Hello Node.js!</span><br></pre></td></tr></table></figure><blockquote><p>å†™ä¸€ä¸ª helloword çš„æ¥å£</p></blockquote><p>è¿˜æ˜¯å’Œåˆšæ‰ä¸€æ ·åˆ›å»ºä¸€ä¸ª <code>http1.js</code> æ–‡ä»¶ï¼Œä¹¦å†™ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);  <span class="comment">// å¼•å…¥HTTPæ¨¡å—</span></span><br><span class="line"><span class="keyword">let</span> port = <span class="number">8000</span>;   <span class="comment">// è®¾ç½®å¯åŠ¨ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡</span></span><br><span class="line">http.<span class="title function_">createServer</span>( <span class="function">(<span class="params">req, resp</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”å¤´ã€çŠ¶æ€ç ï¼Œå“åº”ç±»å‹ç­‰ç­‰ã€‘</span></span><br><span class="line">    resp.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line">    <span class="comment">// å‘é€å“åº”æ•°æ® &quot;HelloWorld, Http&quot;</span></span><br><span class="line">    resp.<span class="title function_">end</span>(<span class="string">&#x27;HelloWorld, Http&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(port); <span class="comment">// åœ¨ç›®æ ‡ç«¯å£å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ä¸€ä¸ªå¯åŠ¨æˆåŠŸçš„æç¤ºï¼Œä¸ç„¶ä»€ä¹ˆæç¤ºéƒ½æ²¡æœ‰å¾ˆå°´å°¬</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Http server runing! at port &quot;</span> + port);</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥æ‰§è¡Œå¹¶è®¿é—®ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Workspase\VScode\Node&gt; node http1.js</span><br><span class="line">Http server runing! at port 8000</span><br></pre></td></tr></table></figure><p><img src="..//img/node-02.jpg" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>node.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Json &amp; Ajax ç¬”è®°</title>
    <link href="/2022/11/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/Json&amp;Ajax/"/>
    <url>/2022/11/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/Json&amp;Ajax/</url>
    
    <content type="html"><![CDATA[<h1>Json &amp; Ajax ç¬”è®°</h1><h2 id="Json-æ•°æ®å¯¹è±¡">Json æ•°æ®å¯¹è±¡</h2><h3 id="1-äº†è§£-Json">1. äº†è§£ Json</h3><p>Jsonæ˜¯åŸºäºJavaScriptè¯­è¨€ç”¨æ¥<font color="red">ä¼ è¾“æ•°æ®</font>çš„ä¸€ç§æ‰‹æ®µï¼Œç›¸æ¯”æ›¾ç»çš„xmlä¼ è¾“æ•°æ®çš„æ‰‹æ®µï¼ŒJsonæ›´é«˜æ•ˆï¼Œæ›´è½»ä¾¿ï¼Œæ›´çµæ´»ï¼Œä»–æ˜¯ä»¥<font color="red">é”®å€¼å¯¹</font>çš„å½¢å¼å‡ºç°çš„ï¼Œ<font color="red">ä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueï¼Œä¸­é—´ç”¨ <strong>:</strong> è¿æ¥</font>ï¼Œå…¶ä¸­æ‰€æœ‰çš„æ•°æ®ä¸çš„keyå¿…é¡»éƒ½æ˜¯åŒå¼•å·çš„å­—ç¬¦ä¸²å½¢å¼ï¼Œè€Œvalueçš„å€¼å¯ä»¥æ˜¯ï¼š</p><p>ã€æ•°å€¼ã€‘ã€å­—ç¬¦ä¸²ã€‘ã€å¸ƒå°”ã€‘ã€æ•°ç»„ã€‘ã€å¯¹è±¡ã€‘ã€Jsonã€‘ã€nullã€‘</p><p>Jsonçš„ä»£ç è¡¨ç°ï¼š</p><ol><li><p>ä½¿ç”¨å¤§æ‹¬å·å°è£… { }  ( ä»£è¡¨ Json å¯¹è±¡ )</p></li><li><p>ä½¿ç”¨ä¸­æ‹¬å·å°è£… [ ]ï¼ˆ ä»£è¡¨ Json æ•°ç»„ ï¼‰</p></li></ol><h3 id="2-å£°æ˜-Json-å¯¹è±¡">2. å£°æ˜ Json å¯¹è±¡</h3><p>å£°æ˜ä¸€ä¸ªJsonå¯¹è±¡ï¼Œå…¶ä¸­ a ä¸º Object ç±»å‹çš„ Json å¯¹è±¡ï¼Œé€šè¿‡ alert è¯­å¥å¯ä»¥è®¿é—®åˆ°æŒ‡å®š key çš„å…ƒç´ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a =&#123; <span class="string">&quot;a&quot;</span>:<span class="number">1</span> , <span class="string">&quot;b&quot;</span>:<span class="number">2</span> , <span class="string">&quot;c&quot;</span>:<span class="number">3</span> &#125;</span><br><span class="line"><span class="title function_">alert</span>(a.<span class="property">a</span>)ï¼›</span><br></pre></td></tr></table></figure><p>Json ä¸­çš„ value ä¸­è¿˜å¯ä»¥å¥—ç”¨ Json</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line"> <span class="string">&quot;aa&quot;</span> : &#123; <span class="string">&quot;bb&quot;</span>:&#123; <span class="string">&quot;cc&quot;</span>:<span class="string">&quot;ä¸€ä¸ªåµŒå¥—çš„Jsonçš„å€¼&quot;</span> &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">alert</span>(a.<span class="property">aa</span>.<span class="property">bb</span>.<span class="property">cc</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ for-in æ¥éå†è¯¥ Json å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> json = &#123;</span><br><span class="line">    <span class="string">&quot;a&quot;</span>: <span class="string">&quot;å­—ç¬¦ä¸²a&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;å­—ç¬¦ä¸²b&quot;</span>,</span><br><span class="line">    <span class="string">&quot;c&quot;</span>: <span class="string">&quot;å­—ç¬¦ä¸²c&quot;</span>, <span class="string">&quot;d&quot;</span>: <span class="string">&quot;å­—ç¬¦ä¸²d&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> a <span class="keyword">in</span> json )&#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(json.<span class="property">a</span> + <span class="string">&quot;&lt;br /&gt;&quot;</span>)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨è¿™ç§éå†çš„æ–¹æ³•æ˜¯é”™è¯¯çš„</span></span><br><span class="line"><span class="comment">     * json.aè¿™é‡Œçš„.aå¹¶æ²¡æœ‰å½“ä½œå˜é‡æ¥ç”¨ï¼Œè€Œæ˜¯ä½œä¸ºå±æ€§æ¥ç”¨çš„</span></span><br><span class="line"><span class="comment">     * ä»–ä»£è¡¨çš„æ˜¯è®¿é—®jsonä¸‹keyä¸ºaçš„value</span></span><br><span class="line"><span class="comment">     * æƒ³æŠŠaä½œä¸ºå˜é‡æ¥ç”¨éœ€è¦ä½¿ç”¨[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>( json[a] + <span class="string">&quot;&lt;br /&gt;&quot;</span> )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Json-æ•°ç»„æ“ä½œ">3. Json æ•°ç»„æ“ä½œ</h3><p>ä½¿ç”¨ [ ] å£°æ˜çš„ Json æ˜¯ Object ç±»å‹çš„æ•°ç»„ï¼Œé‡Œé¢å¯ä»¥å­˜æ”¾ â‰¥1 æ•°é‡çš„ Jsonï¼Œé€šè¿‡ä¸‹æ ‡å¯ä»¥è®¿é—®åˆ° Json ä»¥åŠ Json ä¸­æŸä¸ª key å…·ä½“çš„å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> json[</span><br><span class="line">    &#123; <span class="string">&quot;è¯¾ç¨‹&quot;</span>:<span class="string">&quot;Java&quot;</span> , <span class="string">&quot;ä»·æ ¼&quot;</span>:<span class="string">&quot;21300.00ï¿¥&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;è¯¾ç¨‹&quot;</span>:<span class="string">&quot;PHP&quot;</span> , <span class="string">&quot;ä»·æ ¼&quot;</span> : <span class="string">&quot;16300.00ï¿¥&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;è¯¾ç¨‹&quot;</span>:<span class="string">&quot;Python&quot;</span> , <span class="string">&quot;ä»·æ ¼&quot;</span> : <span class="string">&quot;23100.00ï¿¥&quot;</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ•°ç»„ä¸­è¿½åŠ å…ƒç´ </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json.<span class="title function_">push</span>(&#123;<span class="string">&quot;è¯¾ç¨‹&quot;</span>: <span class="string">&quot;Webpack&quot;</span>, <span class="string">&quot;ä»·æ ¼&quot;</span>: <span class="string">&quot;18000ï¿¥&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢ï¼Œåˆ é™¤æŸä¸ªå…ƒç´ </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// indexOf æŸ¥è¯¢å½“å‰å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨è¿”å›è¯¥å¯¹è±¡æ‰€åœ¨çš„ä¸‹æ ‡ï¼Œä¸å­˜åœ¨åˆ™è¿”å›-1</span></span><br><span class="line"><span class="keyword">if</span>( json.<span class="title function_">indexOf</span>(json[<span class="number">0</span>])!=-<span class="number">1</span> )</span><br><span class="line">    <span class="comment">// ä»å½“å‰ä½ç½®å¼€å§‹ï¼Œåˆ é™¤1ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä»–æœ¬èº«</span></span><br><span class="line">    json.<span class="title function_">splice</span>(json.<span class="title function_">indexOf</span>(json[<span class="number">0</span>]), <span class="number">1</span>)</span><br></pre></td></tr></table></figure><blockquote><p>éå†è¯¥ Json æ•°ç»„</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for( var a in json )<span class="punctuation">&#123;</span></span><br><span class="line">    for( var b in json<span class="punctuation">[</span>a<span class="punctuation">]</span> )</span><br><span class="line">     document.write( b + <span class="string">&quot;ï¼š&quot;</span> + json<span class="punctuation">[</span>a<span class="punctuation">]</span><span class="punctuation">[</span>b<span class="punctuation">]</span> + <span class="string">&quot; ï¼Œ &quot;</span> )</span><br><span class="line"> document.write(<span class="string">&quot;&lt;br /&gt;&quot;</span>)</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-Jsonçš„æ•°æ®è½¬æ¢">4.  Jsonçš„æ•°æ®è½¬æ¢</h3><h4 id="js-ä¸­äº’ç›¸è½¬æ¢">js ä¸­äº’ç›¸è½¬æ¢</h4><blockquote><p>åœ¨ js ä¸­æœ‰ä¸€ä¸ª JSON å¯¹è±¡ï¼Œé‡Œé¢å°è£…äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œé’ˆå¯¹äº Json ä¸ JS çš„æ ¼å¼è½¬æ¢</p></blockquote><h5 id="Json-â†’-JS">Json â†’ JS</h5><p>ä½¿ç”¨ JSON å¯¹è±¡ä¸­æä¾›çš„ stringify( json ) æ–¹æ³•å°† Json ç±»å‹çš„å¯¹è±¡è£…æ¢ä¸º js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªJsonå¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> json1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ æ¶µå“²&quot;</span>,<span class="string">&quot;age&quot;</span>: <span class="string">&quot;20&quot;</span>,<span class="string">&quot;sex&quot;</span>: <span class="string">&quot;ç”·&quot;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> json2 = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(json1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(json2);</span><br></pre></td></tr></table></figure><h5 id="JS-â†’-Json">JS â†’ Json</h5><p>ä½¿ç”¨ JSON ä¸­æä¾›çš„ parse ( str ) æ–¹æ³•å°† Json ç±»å‹çš„å¯¹è±¡è£…æ¢ä¸º js</p><blockquote><p>å­—ç¬¦ä¸²ç±»å‹çš„Jsonå¿…é¡»æ—¶å•å¼•å·æ‰©ç€åŒå¼•å·</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªJså¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> js1 = <span class="string">&#x27;&#123;&quot;name&quot;:&quot;å¼ &quot;,&quot;age&quot;:&quot;20&quot; &#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// JSè½¬æ¢ä¸ºJSON</span></span><br><span class="line"><span class="keyword">var</span> js2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(js1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(js2)</span><br></pre></td></tr></table></figure><h4 id="Java-ä¸­ç›¸äº’è½¬æ¢">Java ä¸­ç›¸äº’è½¬æ¢</h4><blockquote><p>è€Œå¦‚æœæƒ³åœ¨ <strong>Java</strong> ä¸­å®ç° Json å’Œå¯¹è±¡ä¹‹é—´çš„è½¬æ¢ï¼Œéœ€è¦å€ŸåŠ©ä¸€ä¸ªä¾èµ– jar åŒ…ï¼Œé€šè¿‡ ObjectMapper çš„å®ä¾‹å¯¹è±¡ om è¿›è¡Œæ“ä½œ</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="Java-â†’-Json">Java â†’ Json</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;å¼ æ¶µå“²&quot;</span>,<span class="number">20</span>,<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;  msg = om.writeValueAsString(user); &#125; </span><br><span class="line"><span class="keyword">catch</span> (JsonProcessingException e) &#123;  System.out.println(<span class="string">&quot;è§£æå¤±è´¥ï¼&quot;</span>); &#125;</span><br><span class="line">System.out.pringln( msg )</span><br></pre></td></tr></table></figure><h5 id="Json-â†’-Java">Json â†’ Java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œæ²¡æœ‰ç°æˆçš„Jsonå¯¹è±¡ï¼Œå°±ç”¨Stringæ‹¼æ¥ä¸€ä¸ªå‡ºæ¥</span></span><br><span class="line"><span class="type">String</span> <span class="variable">json2</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;å¼ æ¶µå“²\&quot;,\&quot;age\&quot;:20,\&quot;sex\&quot;:\&quot;ç”·\&quot;&#125;&quot;</span>;</span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> om.readValue(json2, User.class);</span><br><span class="line">System.out.println(user2);</span><br></pre></td></tr></table></figure><h5 id="List-â†’-Json">List â†’ Json</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">list.add(<span class="string">&quot;å•Šå•Š&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;å˜¿å˜¿&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">json3</span> <span class="operator">=</span> om.writeValueAsString(list);</span><br><span class="line">System.out.println(json3);</span><br></pre></td></tr></table></figure><h5 id="Map-â†’-Json">Map â†’ Json</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,String&gt; hm = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,String&gt;();</span><br><span class="line">hm.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line">hm.put(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;22&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">json4</span> <span class="operator">=</span> om.writeValueAsString(hm);</span><br><span class="line">System.out.println(json4);</span><br></pre></td></tr></table></figure><h3 id="5-MVC-ä¸­-Json-ä¸­æ–‡ä¹±ç è§£å†³">5. MVC ä¸­ Json ä¸­æ–‡ä¹±ç è§£å†³</h3><p>åœ¨å‘å®¢æˆ·ç«¯è¿”å›Jsonæ•°æ®çš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿä¸­æ–‡ä¹±ç çš„æƒ…å†µï¼Œéœ€è¦ä½¿ç”¨@RequestMappingä¸­çš„produceså±æ€§è§£å†³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody()</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/json1&quot; , produces = &quot;application/json;charset=utf-8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">json1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;å¼ æ¶µå“²&quot;</span>,<span class="number">20</span>,<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        msg = om.writeValueAsString(user);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è§£æå¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ajax-å¼‚æ­¥å¤„ç†">Ajax å¼‚æ­¥å¤„ç†</h2><p>ajax æ˜¯åŸºäºJavaScript è¯­è¨€ï¼Œå®ƒå®ç°åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè¾¾åˆ°å¼‚æ­¥äº¤äº’ï¼Œä¸»è¦ä¾é çš„æ ¸å¿ƒå¯¹è±¡æ˜¯ <strong>XMLHttpRequest</strong></p><h3 id="ajax-å¯¹è±¡å¸¸ç”¨å±æ€§">ajax å¯¹è±¡å¸¸ç”¨å±æ€§</h3><ol><li><p><strong>onreadystatechange</strong></p><p>è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå½“å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šå¤„ç†è¯·æ±‚ï¼Œåœ¨å¤„ç†ç»“æŸåä¼šè¿”å›ä¸€ä¸ªä¿¡å·ï¼Œç´§æ¥ç€è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œä»–æ˜¯åœ¨æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åæ‰§è¡Œçš„ä¸€ä¸ªå‡½æ•°</p></li><li><p><strong>readyState</strong>ï¼Œä»£è¡¨ç€ä¸æœåŠ¡å™¨äº¤äº’çš„è¿‡ç¨‹çš„å˜åŒ–ï¼Œé€šè¿‡ 0-4 äº”ä¸ªæ•°å­—æ¥è¡¨ç¤º</p><table><thead><tr><th style="text-align:center">æ•°å­—</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td>åˆšåˆšåˆ›å»ºäº†XMLHttpRequestå¯¹è±¡</td></tr><tr><td style="text-align:center">1</td><td>æ‰“å¼€äº†ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼ˆè°ƒç”¨äº†openæ–¹æ³•ï¼‰</td></tr><tr><td style="text-align:center">2</td><td>å‘æœåŠ¡å™¨å‘å‡ºäº†è¯·æ±‚ï¼ˆè°ƒç”¨äº†sendæ–¹æ³•ï¼‰</td></tr><tr><td style="text-align:center">3</td><td>æœåŠ¡å™¨å°†è¯·æ±‚å¤„ç†å®Œæ¯•</td></tr><tr><td style="text-align:center">4</td><td>äº¤äº’æ­£å¸¸ç»“æŸ</td></tr></tbody></table></li><li><p><strong>status</strong>ï¼ŒæœåŠ¡å™¨ç›¸åº”çš„çŠ¶æ€ç ï¼Œç­‰åŒäºhttpåè®®çš„çŠ¶æ€ç </p><table><thead><tr><th>çŠ¶æ€å—</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>200</td><td>è¡¨ç¤ºæœåŠ¡å™¨æ­£å¸¸å·¥ä½œ</td></tr><tr><td>303</td><td>è¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨å‡ºç°äº†é”™è¯¯</td></tr><tr><td>404</td><td>æ‰¾ä¸åˆ°è¯·æ±‚çš„ç›®æ ‡èµ„æº</td></tr><tr><td>500</td><td>å‘ç”Ÿäº†é‡å®šå‘</td></tr></tbody></table></li><li><p><strong>responseText</strong>ï¼Œå°è£…æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯å“åº”çš„æ–‡æœ¬æ•°æ®</p></li><li><p><strong>responseXML</strong>ï¼Œå°è£…æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯ç›¸åº”çš„xmlæ–‡ä»¶ç±»å‹æ•°æ®</p></li></ol><h3 id="ajax-çš„æ–¹æ³•å‡½æ•°">ajax çš„æ–¹æ³•å‡½æ•°</h3><ol><li><p>open( string str1 , string str2 , boolean b )ï¼Œæ‰“å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼Œopenæ–¹æ³•ä¸­çš„ä¸‰ä¸ªå±æ€§</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>string str1</td><td>è¯·æ±‚çš„æ–¹å¼ï¼Œget-postç­‰</td></tr><tr><td>string str2</td><td>è¯·æ±‚çš„èµ„æºè·¯å¾„</td></tr><tr><td>boolean b</td><td>æ˜¯å¦å¼€å¯å¼‚æ­¥å¤„ç†ï¼Œtrueä¸ºå¼€å¯ï¼Œfalseä¸ºä¸å¼€å¯</td></tr></tbody></table></li><li><p>send( string str )ï¼Œå‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåœ¨æ‰§è¡Œopenæ–¹æ³•åè¿è¡Œï¼Œæœ‰ä¸€ä¸ªå±æ€§</p><p>strï¼šå¦‚æœè¯·æ±‚æ–¹å¼ä¸ºpostï¼Œå¯ä»¥ä¼ å…¥ key=value&amp;key=value çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°</p><p>å¦‚æœä¸º get è¯·æ±‚ï¼Œå‚æ•°å¯ä»¥ç•™ç©ºæˆ– nullï¼Œget è¯·æ±‚ä¼ å‚åœ¨æ‰“å¼€è¿æ¥æ—¶æ‹¼æ¥å­—ç¬¦ä¸²å³å¯</p></li><li><p>setRequestHeader( str1 , str2 )</p><p>â€‹ ä¿®æ”¹è¯·æ±‚å¤´ä¿¡æ¯ï¼Œ==åªæœ‰postè¯·æ±‚éœ€è¦ä¿®æ”¹==ï¼Œgetå¯ä»¥å¿½ç•¥ï¼Œåº”åœ¨æ‰“å¼€è¿æ¥åï¼Œå‘å‡ºè¯·æ±‚å‰è®¾ç½®</p><p>â€‹    str1ï¼šè¢«ä¿®æ”¹çš„è¯·æ±‚å¤´ã€â€Content-typeâ€ã€‘</p><p>â€‹    str2ï¼šä¿®æ”¹åçš„å€¼ï¼šã€â€application/x-www-form-urlencodedâ€ã€‘</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>json</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue ç¬”è®°</title>
    <link href="/2022/11/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/vue%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/11/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/vue%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>Vue ç¬”è®°</h1><h2 id="åŸºæœ¬-vue-é¡µé¢">åŸºæœ¬ vue é¡µé¢</h2><p>åŸºæœ¬çš„ vue é¡µé¢ï¼Œéœ€è¦å¼•ç”¨ vue.js æ‰å¯ä»¥è¿è¡Œï¼Œå¼•ç”¨åœ°å€å¦‚ä¸‹ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½åå¼•ç”¨æœ¬åœ°æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cdn.staticfile.org/vue/2.2.2/vue.min.js</span><br></pre></td></tr></table></figure><h3 id="ELæŒ‚è½½ç‚¹">ELæŒ‚è½½ç‚¹</h3><p>el æŒ‚è½½ç‚¹ï¼Œæ˜¯ ELementï¼ˆå…ƒç´ ï¼‰å•è¯çš„ç¼©å†™ï¼Œåœ¨new Vueå¯¹è±¡çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸€ä¸ªæ ‡ç­¾ä¸ºæŒ‚è½½ç‚¹ï¼ŒåŸºäºè¿™ä¸ªæŒ‚è½½ç‚¹å±•å¼€æ“ä½œ</p><p>æŒ‚è½½ç‚¹æœ‰ä¸‰ç§ï¼š</p><ol><li>id æŒ‚è½½ç‚¹</li><li>class æŒ‚è½½ç‚¹</li><li>å…ƒç´ æŒ‚è½½ç‚¹</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;one&quot;</span> <span class="attr">class</span>=<span class="string">&quot;two&quot;</span>&gt;</span> è¿™ä¸ªæ ‡ç­¾å·²ç»è¢«vueæ¥ç®¡ <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#one&quot;</span> <span class="comment">// idæŒ‚è½½ç‚¹</span></span></span><br><span class="line"><span class="language-javascript">   <span class="comment">// el: &quot;.two&quot; // classæŒ‚è½½ç‚¹</span></span></span><br><span class="line"><span class="language-javascript">   <span class="comment">// el: &quot;div&quot; ,  // å…ƒç´ æŒ‚è½½ç‚¹</span></span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æŒ‚è½½ç‚¹ä¹Ÿå¯ä»¥ç†è§£ä¸ºä½œç”¨åŸŸï¼Œè¢«æŒ‚è½½çš„æ ‡ç­¾è¿åŒä»–çš„å­æ ‡ç­¾éƒ½æ˜¯ä½œç”¨åŸŸå†…æœ‰æ•ˆï¼ŒæŒ‚è½½ç‚¹ä¹‹å¤–Vueä¸èµ·ä½œç”¨</p><p>æŒ‚è½½ç‚¹å¯ä»¥ä¹¦å†™åœ¨HTMLä»»ä½•æ ‡ç­¾ä¸Šï¼Œä½†å”¯ç‹¬<strong>ä¸å¯ä»¥å†™åœ¨ html å’Œ body æ ‡ç­¾ä¸Š</strong></p><h3 id="data-æ•°æ®å¯¹è±¡">data æ•°æ®å¯¹è±¡</h3><p>åœ¨ç»‘å®šæŒ‚è½½ç‚¹ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ data æ•°æ®å¯¹è±¡ï¼Œéœ€è¦åœ¨ vue å®ä¾‹ä¸­å£°æ˜ data æ•°æ®å¯¹è±¡ï¼Œç„¶ååœ¨ data ä¸­å£°æ˜å˜é‡ååŠå¯¹åº”çš„å€¼ï¼Œå£°æ˜è§„åˆ™ä»¥ JSON ä¸ºåŸºå‡†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#good&quot;</span> ,<span class="comment">// idæŒ‚è½½ç‚¹</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;vueä¸­çš„æ•°æ®&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æƒ³è¦è°ƒç”¨å¹¶ä½¿ç”¨ data æ•°æ®éœ€è¦ä½¿ç”¨ <strong>å·®å€¼è¡¨è¾¾å¼ { {  } }</strong> ï¼Œä»–çš„æ•ˆæœç±»ä¼¼ java ä¸­çš„ print æ–¹æ³•ï¼Œè´Ÿè´£æ‰“å°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;good&quot;</span>&gt;</span> &#123;&#123; message &#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#good&quot;</span> ,<span class="comment">// idæŒ‚è½½ç‚¹</span></span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">message</span>: <span class="string">&quot;vueä¸­çš„æ•°æ®&quot;</span></span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>data æ•°æ®å¯¹è±¡ä¸­å¯ä»¥å°è£…ç®€å•ç±»å‹åŠå¤æ‚ç±»å‹çš„å¯¹è±¡ï¼Œä½†æ˜¯è¦éµå®ˆ JS çš„è¯­æ³•è§„åˆ™</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">font</span> <span class="attr">id</span>=<span class="string">&quot;fon&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æ™®é€šæ•°æ®å¯¹è±¡å¯ä»¥ç›´æ¥ç”¨åŒå¤§æ‹¬å·å–å€¼ --&gt;</span></span><br><span class="line">   1.<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- åµŒå¥—Jsonå¯¹è±¡éœ€è¦ä½¿ç”¨.æ¥æŒ‡å®šæŸä¸ªå±æ€§ --&gt;</span></span><br><span class="line">   2.<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>&#123;&#123; person.name&#125;&#125; , &#123;&#123; person.age &#125;&#125;<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- å¦‚æœæ—¶æ•°ç»„çš„è¯éœ€è¦ä½¿ç”¨ [ ] æ¥æŒ‡å®šè¦å–æŒ‡å®šä¸‹æ ‡ä¸Šå¯¹åº”çš„å€¼ --&gt;</span></span><br><span class="line">   3.<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>&#123;&#123; tel[0] &#125;&#125;-&#123;&#123; tel[1] &#125;&#125;-&#123;&#123; tel[2] &#125;&#125;<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- å¯¹è±¡ä¸­ä¹Ÿå¯ä»¥åµŒå¥—æ•°ç»„ --&gt;</span> </span><br><span class="line">   4.<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>&#123;&#123; test.demo1.arr[0] &#125;&#125;&#123;&#123; test.demo1.arr[1] &#125;&#125;ï¼Œ</span><br><span class="line">    &#123;&#123; test.demo2.arr[0] &#125;&#125;&#123;&#123; test.demo2.arr[1] &#125;&#125;<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æ•°ç»„å†…ä¹Ÿå¯ä»¥åµŒå¥—Jsonå¯¹è±¡ --&gt;</span></span><br><span class="line">   5.<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>&#123;&#123; test.demo3.arr[0].name &#125;&#125;ï¼Œ&#123;&#123; test.demo3.arr[1].name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#fon&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;æäº‘é¾™&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">person</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;çˆ±æ–°è§‰ç½—Â·æº¥ä»ª&quot;</span> , <span class="attr">age</span>: <span class="number">88</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">tel</span>: [ <span class="number">155</span> , <span class="number">8555</span> , <span class="number">7724</span> ],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">test</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">name</span>: <span class="string">&quot;æµ‹è¯•å¯¹è±¡&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">demo1</span>: &#123; <span class="attr">arr</span>: [<span class="string">&quot;ä¸­å›½&quot;</span>,<span class="string">&quot;ç”·è¶³&quot;</span>] &#125;,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">demo2</span>: &#123; <span class="attr">arr</span>: [<span class="string">&quot;ä¸­å›½&quot;</span>,<span class="string">&quot;å¥³ä¹’&quot;</span>] &#125;,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">demo3</span>: &#123; <span class="attr">arr</span>: [ &#123;<span class="attr">name</span>:<span class="string">&quot;ç¬¬ä¸€ä¸ªå…ƒç´ &quot;</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">&quot;ç¬¬äºŒä¸ªå…ƒç´ &quot;</span>&#125; ] &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="methods-æ–¹æ³•">methods æ–¹æ³•</h3><p>Vue å®ä¾‹ä¸­å¯ä»¥å†™ el æŒ‚è½½ç‚¹ï¼Œä¹Ÿå¯ä»¥å†™ data æ•°æ®å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å†™ methodsï¼Œç­‰åŒäº js çš„å‡½æ•°ï¼Œå®šä¹‰æ–¹æ³•çš„æ ¼å¼ä¸ºï¼š<code>name: function()&#123;&#125;</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¼©å†™ <code>name()&#123;&#125;</code>ï¼Œæ•ˆæœæ˜¯ä¸€è‡´çš„</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">   &#123;&#123; func1() &#125;&#125;  <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   &#123;&#123; func1 &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;div&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          func1 : <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="keyword">return</span> <span class="string">&quot;å‡½æ•°çš„è¿”å›å€¼&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// ç­‰åŒäº func1()&#123; return &quot;å‡½æ•°çš„è¿”å›å€¼&quot;; &#125;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨é¡µé¢è°ƒç”¨ func1() çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å¹¶æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°ï¼Œè€Œè°ƒç”¨ func1 çš„æ—¶å€™ï¼Œä»…ä»…è°ƒç”¨çš„æ˜¯ä»–çš„å†…å­˜åœ°å€</li></ul><h3 id="Vue-åŸºç¡€æ³¨æ„äº‹é¡¹">Vue åŸºç¡€æ³¨æ„äº‹é¡¹</h3><h4 id="data-ä¸-methods-ä¹‹é—´çš„è°ƒç”¨é—®é¢˜">data ä¸ methods ä¹‹é—´çš„è°ƒç”¨é—®é¢˜</h4><p>åœ¨ vue ä¸­ï¼Œdata å°±ç›¸å½“äº java ä¸­çš„ä¸€ä¸ªå˜é‡ï¼Œå˜é‡æœ‰è‡ªå·±çš„å€¼ï¼Œä¸”èƒ½å¤Ÿåœ¨å‡½æ•°ä¸­è¢«ä½¿ç”¨ï¼Œåœ¨ vue ä¸­ä¹Ÿè¦ç•™æ„è°ƒç”¨é—®é¢˜</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;func1()&quot;</span>&gt;</span>å¼¹çª—æµ‹è¯•1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;func2()&quot;</span>&gt;</span>å¼¹çª—æµ‹è¯•2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   &#123;&#123; text &#125;&#125; , &#123;&#123; value1 &#125;&#125; , &#123;&#123; value2 &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">func1</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="title function_">alert</span>(<span class="string">&quot;func1: &quot;</span> + <span class="variable language_">this</span>.<span class="title function_">func2</span>())</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">func2</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="title function_">alert</span>(<span class="string">&quot;func2: &quot;</span> + <span class="variable language_">this</span>.<span class="property">text</span>)</span></span><br><span class="line"><span class="language-javascript">     <span class="keyword">return</span> <span class="string">&quot;æ–¹æ³•2çš„è¿”å›å€¼&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">text</span>: <span class="string">&quot;dataæ•°æ®&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">value1</span>: <span class="variable language_">this</span>.<span class="property">text</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">value2</span>: <span class="variable language_">this</span>.<span class="property">func1</span></span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç»æµ‹è¯•å¯ä»¥å¾—å‡ºç»“è®º</p><ul><li>data ä¸­å£°æ˜çš„å˜é‡å¯ä»¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨ <code>this.å˜é‡å</code> è°ƒç”¨</li><li>data ä¸­ä¸å¯ä»¥è°ƒç”¨å‡½æ•°è·å¾—è¿”å›å€¼</li><li>data ä¸­åå£°æ˜çš„å˜é‡å¹¶ä¸èƒ½è°ƒç”¨å…ˆå£°æ˜çš„å˜é‡</li><li>methods ä¸­å£°æ˜çš„å‡½æ•°å¯ä»¥äº’ç›¸è°ƒç”¨ï¼Œä¸åˆ†å£°æ˜çš„é¡ºåº</li><li>data å’Œ methds çš„è°ƒç”¨ä¹‹å‰ä¸åˆ†å£°æ˜çš„é¡ºåº</li></ul><h2 id="Vue-æŒ‡ä»¤å­¦ä¹ ">Vue æŒ‡ä»¤å­¦ä¹ </h2><h3 id="ä¸€èˆ¬æŒ‡ä»¤">ä¸€èˆ¬æŒ‡ä»¤</h3><h4 id="v-text-æŒ‡ä»¤">v-text æŒ‡ä»¤</h4><p>è®¾ç½®æ ‡ç­¾å†…å®¹çš„æŒ‡ä»¤ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;ul&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-text</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; zuoyong &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;  &quot;æ’å€¼è¡¨è¾¾å¼ä¸­å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼š&quot; + date &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-text</span>=<span class="string">&quot;text1&quot;</span>&gt;</span>åŸæœ‰å†…å®¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; text2 &#125;&#125;åŸæœ‰å†…å®¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-text</span>=<span class="string">&quot;text3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; text3 &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-text</span>=<span class="string">&quot;text4 + text5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>: <span class="string">&quot;#ul&quot;</span>,</span><br><span class="line"> <span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&quot;é€šè¿‡v-textæŒ‡ä»¤&quot;</span>,</span><br><span class="line">  <span class="attr">zuoyong</span>: <span class="string">&quot;é€šè¿‡å·®å€¼è¡¨è¾¾å¼&quot;</span>,</span><br><span class="line">  <span class="attr">date</span>: <span class="string">&quot;2019-11-27&quot;</span>,</span><br><span class="line">  <span class="attr">text1</span>: <span class="string">&quot;v-textè¦†ç›–åŸæœ‰å†…å®¹&quot;</span>,</span><br><span class="line">  <span class="attr">text2</span>: <span class="string">&quot;å·®å€¼è¡¨è¾¾å¼ä¸ä¼šè¦†ç›–&quot;</span>,</span><br><span class="line">  <span class="attr">text3</span>: <span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;æˆ‘ä¼šå˜çº¢å˜›&lt;/font&gt;&quot;</span>,</span><br><span class="line">  <span class="attr">text4</span>: <span class="string">&quot;ä¸¤ä¸ªv-text&quot;</span>,</span><br><span class="line">  <span class="attr">text5</span>: <span class="string">&quot;çš„å­—ç¬¦ä¸²æ‹¼æ¥&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="v-html-æŒ‡ä»¤">v-html æŒ‡ä»¤</h4><p>æ— è®ºæ˜¯å·®å€¼è¡¨è¾¾å¼è¿˜æ˜¯v-textï¼Œè¾“å‡ºè§£æçš„éƒ½åªæ˜¯æ™®é€šæ–‡æœ¬ï¼Œå¦‚æœæƒ³è®©æ–‡æœ¬å¯ä»¥è§£æä¸ºhtmlæ ‡ç­¾ï¼Œå°±éœ€è¦v-htmlæŒ‡ä»¤</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;ul1&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-text</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-html</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>: <span class="string">&quot;#ul1&quot;</span>,</span><br><span class="line"> <span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;fontæ ‡ç­¾çš„çº¢è‰²å­—ä½“&lt;/font&gt;&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="v-on-æŒ‡ä»¤">v-on æŒ‡ä»¤</h4><p>v-onä¸ºäº‹ä»¶æŒ‡ä»¤ï¼Œåƒç»‘å®šJSäº‹ä»¶ä¸€æ ·æ¥ç»‘å®šVueçš„äº‹ä»¶ï¼Œä¾‹å¦‚ã€å•å‡»äº‹ä»¶ã€‘ã€åŒå‡»äº‹ä»¶ã€‘ã€é¼ æ ‡æ»‘è¿‡ã€‘ç­‰ç­‰</p><ol><li><p>è¢«ç»‘å®šçš„äº‹ä»¶å…³é”®å­—åˆ é™¤å‰ç½®çš„onå­—æ¯ï¼Œä½¿ç”¨v-on:ä»£æ›¿ï¼Œä¾‹å¦‚ï¼šonclick â†’ v-on:click</p></li><li><p>è¿˜æœ‰ä¸€ç§ç®€åŒ–çš„å†™æ³•ï¼ŒåŒæ ·åˆ é™¤äº‹ä»¶å…³é”®å­—å‰ç½®çš„onå…³é”®å­—ï¼Œç”¨@ç¬¦å·ä»£æ›¿</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;func1&quot;</span>&gt;</span>ä¸€èˆ¬v-onå•å‡»äº‹ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;func1&quot;</span>&gt;</span>ç®€åŒ–v-onå•å‡»äº‹ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">dblclick</span>=<span class="string">&quot;func1&quot;</span>&gt;</span>ç®€åŒ–v-onåŒå‡»äº‹ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line"> <span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">text1</span>: <span class="string">&quot;v-onäº‹ä»¶&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">methods</span>: &#123;</span><br><span class="line">  func1 : <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">text1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="v-show-æŒ‡ä»¤">v-show æŒ‡ä»¤</h4><p>v-showé€šè¿‡æ“ä½œæ ·å¼æ¥æ§åˆ¶å…ƒç´ æ˜¯å¦æ˜¾ç¤ºçš„æŒ‡ä»¤ï¼Œé‡Œé¢å¯ä»¥å†™booleanå€¼ï¼Œtrueä¸ºæ˜¾ç¤ºï¼Œfalseä¸ºä¸æ˜¾ç¤ºï¼Œä¹Ÿå¯ä»¥å†™è¡¨è¾¾å¼ï¼Œæœ€ç»ˆä¼šè®¡ç®—ä¸ºboolean</p><p>æœªæ»¡åå…«å‘¨å²ç¦æ­¢æ³¨å†Œçš„å°ä¾‹å­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d1&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">h3</span>&gt;</span>æœªæ»¡åå…«å‘¨å²ç¦æ­¢æ³¨å†Œ<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"> æ‚¨å½“å‰çš„å¹´é¾„ï¼š</span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sub()&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">&quot;age&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add()&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-show</span>=<span class="string">&quot;age&gt;=18&quot;</span>&gt;</span>ç‚¹å‡»æ³¨å†Œ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>: <span class="string">&quot;#d1&quot;</span> ,</span><br><span class="line"> <span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">15</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">age</span>++; &#125;,</span><br><span class="line">  <span class="attr">sub</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>.<span class="property">age</span>--; &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ“ä½œå…ƒç´ çš„displayå±æ€§æ¥æ§åˆ¶å…ƒç´ æ˜¯å¦æ˜¾ç¤º</p><p>&lt;/img src=â€œ.//img/vue-03.pngâ€ style=â€œfloat: leftâ€ /&gt;</p><h4 id="v-if-æŒ‡ä»¤">v-if æŒ‡ä»¤</h4><p>v-ifé€šè¿‡æ“ä½œDomæ¥æ§åˆ¶å…ƒç´ æ˜¯å¦å­˜åœ¨è¾¾åˆ°æ˜¾ç¤ºå’Œéšè—çš„æ•ˆæœï¼Œæ•ˆæœç±»ä¼¼ä¸v-showï¼Œä½†æ˜¯æœ¬è´¨ä¸Šæœ‰ç€åŒºåˆ«ï¼Œv-showæ˜¯æ“ä½œå…ƒç´ çš„displayå±æ€§ï¼Œè€Œv-ifæ“ä½œçš„æ˜¯å½“å‰æ ‡ç­¾æ˜¯å¦å­˜åœ¨</p><p>è¿˜æ˜¯æœªæ»¡18å‘¨å²ç¦æ­¢æ³¨å†Œçš„ä¾‹å­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">new Vue(&#123;</span><br><span class="line"> el: &quot;#d1&quot; ,</span><br><span class="line"> data: &#123;</span><br><span class="line">  age: 15</span><br><span class="line"> &#125;,</span><br><span class="line"> methods: &#123;</span><br><span class="line">  add: function() &#123; this.age++; &#125;,</span><br><span class="line">  sub: function() &#123; this.age--; &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d1&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">h3</span>&gt;</span>æœªæ»¡åå…«å‘¨å²ç¦æ­¢æ³¨å†Œ<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"> æ‚¨å½“å‰çš„å¹´é¾„ï¼š</span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sub()&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">&quot;age&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add()&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-if</span>=<span class="string">&quot;age&gt;=18&quot;</span>&gt;</span>ç‚¹å‡»æ³¨å†Œ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡æ“ä½œDomæ§åˆ¶å…ƒç´ æ˜¯å¦å­˜åœ¨æ¥è¾¾åˆ°æ˜¾ç¤ºæ•ˆæœï¼Œå¦‚æœæŸä¸€ä¸ªå…ƒç´ éœ€è¦é¢‘ç¹çš„éšè—æˆ–åˆ‡æ¢çš„è¯ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨v-showï¼Œç›¸å¯¹v-ifæ¥è¯´ï¼Œé¢‘ç¹åˆ‡æ¢çš„æƒ…å†µä¸‹v-showçš„æ•ˆç‡æ›´é«˜ä¸€äº›</p><p>&lt;/img src=â€œ.//img/vue-04.pngâ€ /&gt;</p><h4 id="v-bind-æŒ‡ä»¤">v-bind æŒ‡ä»¤</h4><p>å…ƒç´ ç»‘å®šå±æ€§ï¼Œå¯ä»¥æ§åˆ¶æŸä¸ªå…ƒç´ çš„å±æ€§çš„å€¼ï¼Œå½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶è§†å›¾å¯¹åº”çš„ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ï¼Œä½†è§†å›¾å‘ç”Ÿæ”¹å˜æ—¶æ•°æ®ä¸ä¼šå‘ç”Ÿæ”¹å˜</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><p>â€‹    1. ç›´æ¥ç»‘å®šå…ƒç´  v-bind:width=â€œâ€</p><p>â€‹    2. ç®€å•ç»‘å®šå…ƒç´  :width=â€œâ€</p><p>ä»£ç æ¼”ç¤ºï¼šä¸ºdivå¡«è‰²</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#div</span> &#123;</span><br><span class="line"> <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line"> <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line"> <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.d1</span> &#123;</span><br><span class="line"> <span class="attribute">background-color</span>: bisque;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é€šè¿‡ä¸‰å…ƒè¡¨è¾¾å¼æ¥æ§åˆ¶classå±æ€§æ˜¯å¦æ˜¾ç¤º --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot; bool ? &#x27;d1&#x27; : &#x27; &#x27; &quot;</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;setClass()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼šçš„ç¼©å†™è¿›è¡Œç»‘å®š --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot; bool ? &#x27;d1&#x27; : &#x27; &#x27; &quot;</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;setClass()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>: <span class="string">&quot;#div&quot;</span>,</span><br><span class="line"> <span class="attr">data</span>: &#123;</span><br><span class="line">  bool : <span class="literal">false</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="attr">setClass</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">bool</span> = !<span class="variable language_">this</span>.<span class="property">bool</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="v-model-æŒ‡ä»¤">v-model æŒ‡ä»¤</h4><ul><li><strong>åŒå‘ç»‘å®šæ›´æ–°æ•°æ®</strong></li></ul><p>åŒå‘ç»‘å®šï¼Œä¸»è¦ç”¨äºè¡¨å•æ•°æ®å’Œ vue æ•°æ®äº’ç›¸ç»‘å®šï¼Œæ›´æ”¹ data çš„å€¼çš„æ—¶å€™ï¼Œdata æ‰€å¯¹åº”çš„è§†å›¾ä¹Ÿä¼šæ›´æ”¹ï¼Œè€Œè§†å›¾è¿›è¡Œæ›´æ”¹æ—¶ï¼Œå¯¹åº”çš„ data ä¹Ÿä¼šå‘ç”Ÿæ›´æ”¹</p><p>ä»£ç æ¼”ç¤º-åŠ¨æ€éªŒè¯å¯†ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;message&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;1&quot;</span>&gt;</span>&#123;&#123; message == password ? &#x27;è¾“å…¥æ­£ç¡®&#x27; : &#x27;è¾“å…¥é”™è¯¯&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>: <span class="string">&quot;#div&quot;</span>,</span><br><span class="line"> <span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&quot;11223344&quot;</span>,</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&quot;&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><font color="red"><strong># ç›‘å¬è¡¨å•çŠ¶æ€</strong></font></li></ul><p>v-model æŒ‡ä»¤æœ€å¼ºå¤§çš„åŠŸèƒ½æ˜¯å¯ä»¥ç›‘å¬é¡µé¢ä¸­è¡¨å•çš„æ•°æ®çŠ¶æ€</p><blockquote><p>åˆ†åˆ«ç›‘å¬ æ–‡æœ¬æ¡† å•é€‰æ¡† å¤é€‰æ¡† ä¸‹æ‹‰æ¡† æ—¥æœŸ æ—¶é—´ çš„å°æ¡ˆä¾‹</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.color</span> &#123;  <span class="attribute">color</span>: red;  &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.size</span> &#123;  <span class="attribute">font-size</span>: <span class="number">50px</span>;  &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.italic</span> &#123;  <span class="attribute">font-style</span>: italic;  &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;text&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span>vueç›‘å¬: &#123;&#123; text &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç”·&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;gender&quot;</span> /&gt;</span>ç”·</span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;gender&quot;</span> /&gt;</span>å¥³</span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span>vueç›‘å¬: &#123;&#123; gender &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ¸¸æ³³&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;likes&quot;</span> /&gt;</span>æ¸¸æ³³</span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥èº«&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;likes&quot;</span> /&gt;</span>å¥èº«</span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;éŸ³ä¹&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;likes&quot;</span> /&gt;</span>éŸ³ä¹</span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ‰“æ¸¸æˆ&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;likes&quot;</span> /&gt;</span>æ‰“æ¸¸æˆ</span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span>vueç›‘å¬: &#123;&#123; likes &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;address&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>åŒ—äº¬<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>ä¸Šæµ·<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>å¹¿ä¸œ<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>æ·±åœ³<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span>vueç›‘å¬: &#123;&#123; address &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;data&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span>vueç›‘å¬: &#123;&#123; data &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;time&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;time&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span>vueç›‘å¬: &#123;&#123; time &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">text</span>: <span class="string">&quot;textæ–‡æœ¬æ¡†&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">gender</span>: <span class="string">&quot;ç”·&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">likes</span>: [<span class="string">&quot;å¥èº«&quot;</span>,<span class="string">&quot;æ‰“æ¸¸æˆ&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">address</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="string">&quot;2020-02-02&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">time</span>: <span class="string">&quot;12:20&quot;</span></span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="v-for-æŒ‡ä»¤">v-for æŒ‡ä»¤</h4><p>å¾ªç¯å½“å‰æ ‡ç­¾åŠå­æ ‡ç­¾ï¼Œå¾ªç¯çš„æ¬¡æ•°æ˜¯æŒ‡å®šæ•°ç»„çš„é•¿åº¦</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><p>â€‹    1. ã€(ä»£è¡¨æ•°ç»„å†…çš„æ¯ä¸ªå€¼/å¯¹è±¡ , ä¸‹æ ‡ ) in æ•°ç»„å)ã€‘</p><p>â€‹    2.  ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä¸‹æ ‡ã€ä»£è¡¨æ•°ç»„å†…çš„æ¯ä¸ªå€¼/å¯¹è±¡ in æ•°ç»„åã€‘</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;add()&quot;</span>&gt;</span>ç‚¹å‡»æ·»åŠ &quot;ç¥èˆŸç”µè„‘&quot;å•†å“<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;del()&quot;</span>&gt;</span>ç‚¹å‡»åˆ é™¤ç¬¬ä¸€ä¸ªå•†å“<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1px&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0px&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;5px&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in arr&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">td</span>&gt;</span>ç¬¬ &#123;&#123; index+1 &#125;&#125; ä¸ªå•†å“<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>: <span class="string">&quot;#div&quot;</span>,</span><br><span class="line"> <span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">arr</span>: [</span><br><span class="line">   &#123;<span class="attr">name</span>: <span class="string">&quot;iPhone 11&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="attr">name</span>: <span class="string">&quot;Xiaomi cc9 pro&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="attr">name</span>: <span class="string">&quot;Redmi Note4X&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="attr">name</span>: <span class="string">&quot;VIVO X30&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="attr">name</span>: <span class="string">&quot;OPPO Reno Ace&quot;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="comment">// å‘arr(æ•°ç»„)å°¾éƒ¨è¿½åŠ å…ƒç´ </span></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">push</span>( &#123;<span class="attr">name</span>:<span class="string">&quot;ç¥èˆŸç”µè„‘&quot;</span>&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">del</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="comment">// åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">shift</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="v-bind-é«˜çº§ç»‘å®š">v-bind é«˜çº§ç»‘å®š</h4><p>å¯ä»¥ç»‘å®šè‡³classåå¯ä»¥ç›´æ¥è¾“å…¥æ•°ç»„ï¼Œæ•°ç»„å†…å­˜æ”¾éœ€è¦ä½¿ç”¨çš„classï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥å¯¹è±¡ï¼Œå¯¹è±¡çš„keyä¸ºclassï¼Œvalueä¸ºBooleanå€¼ï¼Œä¸ºtrueåˆ™ç”Ÿæ•ˆï¼Œfalseåˆ™ä¸ç”Ÿæ•ˆ</p><p>ç»‘å®šè‡³styleåï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†å¯¹è±¡è¾“å…¥è¿›å»ï¼Œä¹Ÿå¯ä»¥å°†å¯¹è±¡æ”¾è¿›æ•°ç»„ä¸­ç„¶åè¾“å…¥æ•°ç»„ï¼ŒåŒæ ·ç”Ÿæ•ˆ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.color</span> &#123;  <span class="attribute">color</span>: red;  &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.size</span> &#123;  <span class="attribute">font-size</span>: <span class="number">50px</span>;  &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.italic</span> &#123;  <span class="attribute">font-style</span>: italic;  &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">font</span> <span class="attr">:class</span>=<span class="string">&quot;msg1&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªfontæ ‡ç­¾<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">font</span> <span class="attr">:class</span>=<span class="string">&quot;msg2&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªfontæ ‡ç­¾<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">font</span> <span class="attr">:style</span>=<span class="string">&quot;sty&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªfontæ ‡ç­¾<span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">msg1</span>: [ <span class="string">&quot;size&quot;</span> , <span class="string">&quot;italic&quot;</span> ],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">msg2</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="string">&quot;color&quot;</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">     <span class="string">&quot;size&quot;</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">     <span class="string">&quot;italic&quot;</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">sty</span>: &#123; <span class="string">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span> , <span class="string">&quot;font-size&quot;</span>: <span class="string">&quot;20px&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å†…éƒ¨æŒ‡ä»¤">å†…éƒ¨æŒ‡ä»¤</h3><h4 id="v-pre-æŒ‡ä»¤">v-pre æŒ‡ä»¤</h4><p>v-pre æŒ‡ä»¤çš„ä½œç”¨æ˜¯å°†ä»£ç åŸæ ·è¾“å‡ºï¼Œä¾‹å¦‚ä»¥ä¸‹æƒ…å†µ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    æˆ‘ä»¬åœ¨å­¦ä¹ vueçš„æ—¶å€™å¯ä»¥ä½¿ç”¨å·®å€¼è¡¨è¾¾å¼æ¥æ˜¾ç¤ºå€¼ï¼Œ</span><br><span class="line">    ä½¿ç”¨æ–¹æ³•æ˜¯<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-pre</span>&gt;</span>&#123;&#123;good&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>ï¼Œæ˜¾ç¤ºå‡ºæ¥çš„å€¼å°±æ˜¯&#123;&#123;good&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="string">&quot;good&quot;</span>: <span class="number">123</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="v-cloak-æŒ‡ä»¤">v-cloak æŒ‡ä»¤</h4><p>ä½¿ç”¨å·®å€¼è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå¦‚æœåœ¨ç½‘é€Ÿè¾ƒæ…¢çš„æƒ…å†µä¸‹ï¼Œä¼šçœ‹åˆ°åœ¨ vue ç»‘å®šçš„å€¼å‡ºç°ä¹‹å‰ä¼šæŠŠå·®å€¼è¡¨è¾¾å¼çš„ <code>&#123;&#123; &#125;&#125;</code> å±•ç°å‡ºæ¥ï¼Œç­‰å¾…åŠ è½½å‡ºæ¥åæ‰ä¼šæŠŠå€¼æ›¿æ¢è¿‡æ¥ï¼Œé’ˆå¯¹è¿™ç§å¯ä»¥ä½¿ç”¨ v-cloak æŒ‡ä»¤é…åˆ css æ¥è§£å†³</p><blockquote><p>v-cloak ç‰¹ç‚¹ï¼šåœ¨é¡µé¢è¯·æ±‚çš„è¿‡ç¨‹ä¸­å­˜åœ¨ï¼Œè¯·æ±‚ç»“æŸå¹¶æ”¶åˆ°å“åº”åæ¶ˆå¤±ï¼Œé…åˆ display æ ·å¼å¯ä»¥è¾¾åˆ°æœ€ç»ˆæ•ˆæœ</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[v-cloak]</span>&#123;</span><br><span class="line"> <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">id</span>=<span class="string">&quot;fon&quot;</span> <span class="attr">v-cloak</span>&gt;</span>&#123;&#123;aaa&#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> <span class="attr">el</span>:<span class="string">&quot;#fon&quot;</span>,</span><br><span class="line"> <span class="attr">data</span>:&#123; <span class="attr">aaa</span>: <span class="string">&quot;123&quot;</span> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¯ä»¥è®¾ç½®ç½‘ç»œé€Ÿåº¦ï¼Œç”¨æ¥æµ‹è¯•</p><p>&lt;/img src=â€œ.//img/vue-02.pngâ€ /&gt;</p><h4 id="v-once-æŒ‡ä»¤">v-once æŒ‡ä»¤</h4><p>v-once æŒ‡ä»¤å†…çš„å˜é‡åªä¼šæ¸²æŸ“ä¸€æ¬¡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-once</span>&gt;</span>ç¬¬ä¸€æ¬¡ç»‘å®šçš„å€¼ï¼š&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Vue-è‡ªå®šä¹‰æŒ‡ä»¤">Vue è‡ªå®šä¹‰æŒ‡ä»¤</h3><p>åœ¨ vue ä¸­ï¼Œé™¤å¼€å®˜æ–¹æä¾›çš„å‡ ä¸ªæŒ‡ä»¤ ( v-if , v-for ç­‰ )ï¼Œè¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æŒ‡ä»¤è¾¾åˆ°æŸç§æ•ˆæœï¼Œè‡ªå®šä¹‰æŒ‡ä»¤åˆ†åˆ«æœ‰ã€å…¨å±€æŒ‡ä»¤ã€‘ã€å±€éƒ¨æŒ‡ä»¤ã€‘ä¸¤ç§ï¼Œ<font color='red'>è‡ªå®šä¹‰æŒ‡ä»¤ä¸èƒ½åŒ…å«å¤§å†™å­—æ¯ï¼Œå¯èƒ½ä¼šå¤±æ•ˆ</font></p><p>å®šä¹‰æŒ‡ä»¤éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>ç¬¬ä¸€ä¸ª æŒ‡ä»¤åç§°ï¼Œå­—ç¬¦ä¸²ä½“ç°ï¼Œä¹¦å†™æŒ‡ä»¤åç§°çš„æ—¶å€™è¦çœç•¥æ‰ v- æ ‡è¯†ç¬¦ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™è¦åŠ ä¸Š v- æ ‡è¯†ç¬¦</li><li>ç¬¬äºŒä¸ª æŒ‡ä»¤å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨åŒ¿åå¯¹è±¡ï¼Œæœ‰ä¸¤ä¸ª<ul><li>ç¬¬ä¸€ä¸ª el å›ºå®šå‚æ•°ï¼Œä»£è¡¨å½“å‰æŒ‡ä»¤æ‰€åœ¨æ ‡ç­¾çš„ DOM å¯¹è±¡</li><li>ç¬¬äºŒä¸ª binding ä¼ å…¥å‚æ•°ï¼Œå½“ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤æ—¶ä¼ å…¥äº†å‚æ•°ï¼Œbinding å°±æ˜¯ä¼ å…¥å‚æ•°çš„å¯¹è±¡ï¼Œå¸¸ç”¨å±æ€§æœ‰<ul><li>nameï¼šä»£è¡¨å½“å‰æŒ‡ä»¤åç§°</li><li>valueï¼šè·å–æ¥æ”¶å‚æ•°çš„è¡¨è¾¾å¼çš„å€¼ ( ä¾‹å¦‚ä¼ å…¥è¡¨è¾¾å¼ 2+3ï¼Œå¾—åˆ°çš„å°±æ˜¯ 5 )</li><li>oldValueï¼šæŒ‡ä»¤ç»‘å®šçš„ä¸Šä¸€ä¸ªå€¼ï¼Œä»…åœ¨ update å’Œ componentUpdated é’©å­ä¸­å¯ç”¨</li><li>expressionï¼šè·å–å½“å‰å‚æ•°çš„å­—ç¬¦ä¸²è¡¨è¾¾å½¢å¼ ( ä¾‹å¦‚ä¼ å…¥è¡¨è¾¾å¼ 2+3ï¼Œå¾—åˆ°çš„å°±æ˜¯ 2+3 )</li></ul></li></ul></li></ul><p>ä¼ å…¥å‚æ•°æ˜¯éœ€è¦æ³¨æ„ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯</p><blockquote><p>è‡ªå®šä¹‰ å…¨å±€æŒ‡ä»¤åŠä½¿ç”¨</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">font</span> <span class="attr">v-setcolor</span>=<span class="string">&quot;&#x27;blue&#x27;&quot;</span>&gt;</span>æµ‹è¯•æ•°æ®<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;setcolor&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">bind</span>: <span class="keyword">function</span>(<span class="params"> el, binding </span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name=&quot;</span> + binding.<span class="property">name</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;value=&quot;</span> + binding.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;oldValue=&quot;</span> + binding.<span class="property">oldValue</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;expression=&quot;</span> + binding.<span class="property">expression</span>);</span></span><br><span class="line"><span class="language-javascript">    el.<span class="property">style</span>.<span class="property">color</span> = binding.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123; <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span> &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è‡ªå®šä¹‰ å±€éƒ¨æŒ‡ä»¤åŠä½¿ç”¨</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-fontcolor</span>&gt;</span>æµ‹è¯•å±€éƒ¨æŒ‡ä»¤<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123; </span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">directives</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;fontcolor&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">bind</span>: <span class="keyword">function</span>(<span class="params">el</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      el.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;blue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">     &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>é’©å­å‡½æ•°</strong></p><ul><li>bindï¼šæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ï¼Œåªè°ƒç”¨ä¸€æ¬¡<ul><li>å‡½æ•°è¿è¡Œæ—¶æŒ‡ä»¤åˆšåˆšä¸ DOM èŠ‚ç‚¹ç»‘å®šï¼Œè¿™æ˜¯åªèƒ½ä½¿ç”¨ä¸€äº› DOM çš„å±æ€§æ“ä½œï¼Œä¾‹å¦‚å­—ä½“é¢œè‰²ç­‰</li></ul></li><li>insertedï¼šå½“å‰ DOM å¯¹è±¡æ”¾å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨<ul><li>å‡½æ•°è¿è¡Œæ—¶å½“å‰ DOM å·²ç»æ’å…¥åˆ° DOM æ ‘ä¸­ï¼Œå¯ä»¥è¿›è¡Œä¾‹å¦‚ è·å–ç„¦ç‚¹ ç­‰</li></ul></li><li>updateï¼šè¢«ç»‘å®šå…ƒç´ æ‰€åœ¨çš„æ¨¡æ¿æ›´æ–°æ—¶è°ƒç”¨ï¼Œè€Œä¸è®ºç»‘å®šå€¼æ˜¯å¦å˜åŒ–ã€‚é€šè¿‡æ¯”è¾ƒæ›´æ–°å‰åçš„ç»‘å®šå€¼ï¼Œå¯ä»¥å¿½ç•¥ä¸å¿…è¦çš„æ¨¡æ¿æ›´æ–°</li></ul><p><strong>ç¼©å†™æŒ‡ä»¤</strong></p><p>å½“è‡ªå®šä¹‰ä¸€ä¸ªæŒ‡ä»¤çš„æ—¶å€™éœ€è¦æŒ‡å®šå…¶ä¸­çš„ bind æˆ– inserted ç­‰ç­‰çš„é’©å­å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¹ˆå†™æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ç¼©å†™</p><p><font color="red">ç¼©å†™çš„ä»£ç åŒæ—¶ä½œç”¨åœ¨ ==bind== å’Œ ==updated== ä¸¤ä¸ªé’©å­å‡½æ•°ä¸­</font></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>ã€</span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-fontweight</span>=<span class="string">&quot;900&quot;</span>&gt;</span>ç¼©å†™æŒ‡ä»¤æµ‹è¯•<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åˆ›å»ºå±€éƒ¨å‘½ä»¤</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;fontweight&quot;</span>, <span class="keyword">function</span>(<span class="params">el, binding</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">   el.<span class="property">style</span>.<span class="property">fontWeight</span> = binding.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span> &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Vue-çš„ç”Ÿå‘½å‘¨æœŸ">Vue çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>vue çš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆè¢«ç§°ä¸ºé’©å­å‡½æ•°ï¼Œæ˜¯æŒ‡ vue å®ä¾‹ä»å¼€å§‹åˆ°é”€æ¯çš„è¿‡ç¨‹ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­å¯ä»¥è¿è¡Œä¸€äº›é€»è¾‘ä»£ç ï¼Œå¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°éœ€è¦çŸ¥é“ä»¥ä¸‹ 8 ç§å³å¯</p><p>æŒ‰ç…§åŠ è½½çš„å…ˆåé¡ºåºæ’åˆ—ï¼š</p><ol><li>==åˆå§‹åŒ–==çš„ç”Ÿå‘½å‘¨æœŸ</li></ol><ul><li>beforeCreateï¼Œè¿™ä¸ªæ—¶å€™çš„ vue åªæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œelï¼Œdataï¼Œmethods ç­‰ä¸å¯ç”¨</li><li>createdï¼Œvue åˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥ä½¿ç”¨ elï¼Œdataï¼Œmethods ç­‰ç­‰</li></ul><ol start="2"><li>==æŒ‚è½½é¡µé¢==çš„ç”Ÿå‘½å‘¨æœŸ<ul><li>beforeMountï¼Œvue å·²ç»åœ¨å†…å­˜ä¸­åŠ è½½å®Œæˆï¼Œä½†å¹¶æ²¡æœ‰æŒ‚è½½åˆ°é¡µé¢ä¸­ï¼Œæ— æ³•åœ¨é¡µé¢ä¸Šä½¿ç”¨ vue</li><li>mountedï¼Œå½“ mounted è¿è¡Œåï¼Œvueå°±å·²ç»å®Œå…¨åˆ›å»ºå¥½ä¸”å·²ç»æŒ‚åœ¨åˆ°é¡µé¢ä¸­äº†ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨</li></ul></li><li>==æ›´æ–°é¡µé¢==çš„ç”Ÿå‘½å‘¨æœŸ<ul><li>beforeUpdateï¼Œæ­¤æ—¶ vue ä¸­çš„æ•°æ®è¢«æ›´æ”¹ï¼Œä½†æ˜¯é¡µé¢ä¸Šçš„æ•°æ®è¿˜æ²¡æœ‰åŒæ­¥</li><li>updatedï¼Œvueä¸­çš„æ•°æ®è¢«æ›´æ”¹ï¼Œé¡µé¢ä¸Šå·²åŒæ­¥å®Œæˆ</li></ul></li><li>==é¡µé¢é”€æ¯==çš„ç”Ÿå‘½å‘¨æœŸ<ul><li>beforeDestroyï¼Œå½“å‰ vue å®ä¾‹å°†è¢«é”€æ¯ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«é”€æ¯ï¼Œdataï¼Œmethods ç­‰å¯ä»¥ç»§ç»­ä½¿ç”¨</li><li>destroyedï¼Œå½“å‰ vue å®ä¾‹å·²è¢«é”€æ¯ï¼Œdataï¼Œmethods ç­‰å°†ä¸å¯ç”¨</li></ul></li></ol><p>ä»£ç æ¼”ç¤ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;msg = &#x27;å˜¿å˜¿&#x27;&quot;</span>&gt;</span>ä¿®æ”¹ä¸º å˜¿å˜¿<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dd&quot;</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">msg</span>: <span class="string">&quot;å“ˆå“ˆå“ˆå“ˆ&quot;</span></span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">beforeCreate</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeCreate: &quot;</span> + <span class="variable language_">this</span>.<span class="property">msg</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;cerated: &quot;</span> + <span class="variable language_">this</span>.<span class="property">msg</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">beforeMount</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeMount: &quot;</span> +  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;dd&quot;</span>).<span class="property">innerText</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeMount: &quot;</span> +  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;dd&quot;</span>).<span class="property">innerText</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">beforeUpdate</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeUpdate: vueçš„msgå·²ç»æ”¹ä¸º &quot;</span> + <span class="variable language_">this</span>.<span class="property">msg</span> + <span class="string">&quot;ï¼Œé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ &quot;</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;dd&quot;</span>).<span class="property">innerText</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">updated</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeUpdate: vueçš„msgå·²ç»æ”¹ä¸º &quot;</span> + <span class="variable language_">this</span>.<span class="property">msg</span> + <span class="string">&quot;ï¼Œé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ &quot;</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;dd&quot;</span>).<span class="property">innerText</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// æ²¡æ³•æ¼”ç¤ºï¼Œï¼Œï¼Œ</span></span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">beforeDestroy</span>(<span class="params"></span>)&#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">destroyed</span>(<span class="params"></span>)&#123;&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°å›¾ç¤ºï¼š</p><p>&lt;/img src=â€œ.//img/vue-11.pngâ€ /&gt;</p><h2 id="Vue-çš„ç»„ä»¶">Vue çš„ç»„ä»¶</h2><p>vue çš„ç»„ä»¶å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé€šç”¨çš„æ¨¡æ¿ï¼Œå½“ä¸€æ®µé‡å¤çš„ html ä»£ç åå¤çš„å‡ºç°åœ¨é¡µé¢ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å°†è¿™äº›é‡å¤çš„ä»£ç å°è£…æˆä¸ºä¸€ä¸ªç»„ä»¶ï¼Œé€šè¿‡è°ƒç”¨ç»„ä»¶æ¥å®ç°ä»£ç çš„å¤ç”¨</p><h3 id="åˆ›å»ºä¸€ä¸ªç»„ä»¶">åˆ›å»ºä¸€ä¸ªç»„ä»¶</h3><p>vue çš„ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢æœ‰æœ‰å‡ ä¸ªå¸¸ç”¨çš„å±æ€§ï¼Œä¾‹å¦‚ template å±æ€§æ˜¯æ§åˆ¶ç»„ä»¶å†…çš„å…ƒç´ çš„ï¼Œ<font color="red" >åœ¨templateä¸­æœ‰ä¸”åªèƒ½ç”±ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œå¦‚æœ‰å¤šä¸ªå…ƒç´ éœ€è¦æ”¾åœ¨ä¸€ä¸ªæ ‡ç­¾ ( ä¾‹å¦‚ div ) å†…</font></p><blockquote><p>åˆ›å»ºä¸€ä¸ªç»„ä»¶</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> com1 = &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;123&lt;/h1&gt;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­ template çš„æ ‡ç­¾å¯ä»¥æ”¾åœ¨HTMLä¸­ä¹¦å†™ï¼Œè€Œåé€šè¿‡ id è°ƒç”¨</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;temp1&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h1</span>&gt;</span>123<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">zhe</span>&gt;</span><span class="tag">&lt;/<span class="name">zhe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> zhe = &#123;  <span class="attr">template</span>: <span class="string">&quot;#temp1&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>: &#123;  <span class="string">&quot;zhe&quot;</span>: zhe  &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å…¨å±€ç»„ä»¶ä¸å±€éƒ¨ç»„ä»¶">å…¨å±€ç»„ä»¶ä¸å±€éƒ¨ç»„ä»¶</h3><p>vue çš„ç»„ä»¶åˆ†ä¸ºå…¨å±€ç»„ä»¶å’Œå±€éƒ¨ç»„ä»¶ä¸¤ç§ï¼Œå…¨å±€ç»„ä»¶åœ¨æ‰€æœ‰ vue å®ä¾‹ä¸­éƒ½å¯ä»¥ä½¿ç”¨ï¼Œè€Œå±€éƒ¨ç»„ä»¶åªèƒ½åœ¨æŒ‡å®šçš„ vue å®ä¾‹ä¸­ä½¿ç”¨</p><ol><li><p>å£°æ˜å…¨å±€ç»„ä»¶ï¼šç»„ä»¶æ³¨å†Œåˆ° component ä¹‹åå°±ä¼šç§°ä¸ºå…¨å±€ç»„ä»¶ï¼Œå…¨å±€ç»„ä»¶æœ‰ä¸¤ç§è°ƒç”¨çš„æ–¹æ³•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 1. å°†ç»„ä»¶åä»¥æ ‡ç­¾çš„å½¢å¼å‘æ”¾åœ¨htmlä¸­ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">com1</span>&gt;</span><span class="tag">&lt;/<span class="name">com1</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 2. ä½¿ç”¨componentæ ‡ç­¾ï¼Œisçš„å±æ€§ä¸ºç»„ä»¶çš„åç§° --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">component</span> <span class="attr">is</span>=<span class="string">&quot;com1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// åˆ›å»ºä¸€ä¸ªç»„ä»¶</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> zhe = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;font color=&#x27;green&#x27;&gt;ç»¿è‰²-ç»„ä»¶&lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// å°†ç»„ä»¶æ³¨å†Œåˆ°componentç§°ä¸ºäº†å…¨å±€ç»„ä»¶</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&quot;com1&quot;</span>, zhe)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å£°æ˜å±€éƒ¨ç»„ä»¶ï¼šæ”¾åœ¨ vue å®ä¾‹ä¸­å°±æ˜¯æŒ‡å®šå®ä¾‹çš„å±€éƒ¨ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> zhe = &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç»„ä»¶</span></span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;çº¢è‰²-å±€éƒ¨ç»„ä»¶&lt;/font&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">components</span>: &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨componensæ³¨å†Œç»„ä»¶ï¼Œå·¦ä¾§ä¸ºç»„ä»¶åç§°ï¼Œå³ä¾§ä¸ºç»„ä»¶å¯¹è±¡</span></span><br><span class="line">        <span class="string">&quot;com2&quot;</span>: zhe</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app1&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">com1</span>&gt;</span><span class="tag">&lt;/<span class="name">com1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">com2</span>&gt;</span><span class="tag">&lt;/<span class="name">com2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app2&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">com1</span>&gt;</span><span class="tag">&lt;/<span class="name">com1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">com2</span>&gt;</span><span class="tag">&lt;/<span class="name">com2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;çº¢è‰²-å±€éƒ¨ç»„ä»¶&lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&quot;com1&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;font color=&#x27;green&#x27;&gt;ç»¿è‰²-å…¨å±€ç»„ä»¶&lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app1&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;com2&quot;</span>: a</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app2&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>è¦åœ¨ç»„ä»¶åˆ›å»ºå®Œæˆåæ‰å¯ä»¥åˆ›å»ºVueå¯¹è±¡è®¾ç½®æŒ‚è½½ç‚¹</li></ul><h3 id="åŠ¨æ€ç»„ä»¶åˆ‡æ¢">åŠ¨æ€ç»„ä»¶åˆ‡æ¢</h3><p>åœ¨é¡µé¢ä¸­æ˜¾ç¤ºç»„ä»¶çš„æ–¹æ³•ï¼Œé™¤å¼€ä½¿ç”¨ç»„ä»¶åç§°ä½œä¸ºæ ‡ç­¾åï¼Œè¿˜å¯ä»¥ä½¿ç”¨åŠ¨æ€æ ‡ç­¾è¿›è¡Œç»„ä»¶çš„å¼•ç”¨</p><blockquote><p>ä½¿ç”¨ component æ ‡ç­¾æ¥æ˜¾ç¤ºç»„ä»¶ï¼Œç„¶åä½¿ç”¨æ ‡ç­¾å†…çš„ is å±æ€§å¼•ç”¨ç»„ä»¶åï¼Œis å¯ä»¥è¢«ç»‘å®šå®ç°åŠ¨æ€æ˜¾ç¤º</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../static/js/vue.min.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>åŠ¨æ€ç»„ä»¶æ ‡ç­¾<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag = !flag&quot;</span>&gt;</span>åˆ‡æ¢ç»„ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;flag?&#x27;com1&#x27;:&#x27;com2&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com1 = &#123; <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;æˆ‘æ˜¯com1ç»„ä»¶&lt;/h1&gt;&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com2 = &#123; <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;æˆ‘æ˜¯com2ç»„ä»¶&lt;/h1&gt;&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: &#123; <span class="attr">flag</span>: <span class="literal">true</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&quot;com1&quot;</span>: com1,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&quot;com2&quot;</span>: com2</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶ä¸­çš„-data">ç»„ä»¶ä¸­çš„ data</h3><p>åœ¨ç»„ä»¶ä¸­åŒæ ·æ‹¥æœ‰ data ï¼Œåªä¸è¿‡å’Œ vue ä¸­çš„ data ä¸åŒï¼Œç»„ä»¶ä¸­çš„ data å¿…é¡»æ˜¯ä¸ªå‡½æ•°ï¼Œä¸”å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼ç±»å‹å¿…é¡»æ˜¯key: valueçš„ { } å¯¹è±¡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">zhe</span>&gt;</span><span class="tag">&lt;/<span class="name">zhe</span>&gt;</span> <span class="tag">&lt;<span class="name">zhe</span>&gt;</span><span class="tag">&lt;/<span class="name">zhe</span>&gt;</span> <span class="tag">&lt;<span class="name">zhe</span>&gt;</span><span class="tag">&lt;/<span class="name">zhe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  Vue.component(&quot;zhe&quot;, &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   template: &quot;<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">font</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">a</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;a++&#x27;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>&quot;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   data: function()&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    return &#123; a: 0 &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  var v = new Vue(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   el: &quot;#app&quot;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"> </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>vue ä¸­çš„ data ä¸ç»„ä»¶ä¸­çš„ data çš„åŒºåˆ«</p><ul><li><p>vue ä¸­çš„ dataï¼šå½“ä½ é‡å¤ä½¿ç”¨è¯¥ç»„ä»¶æ—¶ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªdata çš„å€¼ï¼Œå…¶ä»–ä½¿ç”¨è¿™ä¸ªå˜é‡çš„ç»„ä»¶éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œç±»ä¼¼ java ä¸­çš„ static å…¬å…±å˜é‡</p></li><li><p>ç»„ä»¶ä¸­çš„ dataï¼šå½“ä½ é‡å¤ä½¿ç”¨è¯¥ç»„ä»¶æ—¶ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ª data çš„å€¼ï¼Œå…¶ä»–ä½¿ç”¨è¿™ä¸ªå˜é‡çš„ç»„ä»¶éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ¯ç»„ä»¶ä¸­éƒ½æœ‰è‡ªå·±çš„ dataï¼Œäº’ä¸å½±å“</p></li></ul><h3 id="ç»„ä»¶é€šä¿¡">ç»„ä»¶é€šä¿¡</h3><h4 id="çˆ¶ä¼ å­-å±æ€§">çˆ¶ä¼ å­-å±æ€§</h4><p>åœ¨å­ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡ props å®šä¹‰å˜é‡åï¼Œç„¶åé€šè¿‡æ ‡ç­¾çš„å±æ€§å¯¹å­ç»„ä»¶è¿›è¡Œä¼ å€¼ï¼Œå±æ€§åå°±æ˜¯å­ç»„ä»¶ props çš„å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">zhe</span> <span class="attr">:ha</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">zhe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&quot;zhe&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">props</span>: [<span class="string">&quot;ha&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;font&gt;æ¥æ”¶åˆ°ä¼ æ¥çš„å€¼ä¸º: &#123;&#123;ha&#125;&#125;&lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123; </span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">msg</span>: <span class="string">&quot;å“ˆå“ˆå“ˆå“ˆ&quot;</span></span></span><br><span class="line"><span class="language-javascript">         &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å½“å­ç»„ä»¶å†… data ä¸­å®šä¹‰çš„å€¼ä¸ prop æ¥å—çš„å€¼å¾— key é‡å¤çš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨  ä¼šä¼˜å…ˆè°ƒç”¨ prop ä¸­çš„</li><li>å½“çˆ¶ç»„ä»¶ä¸­çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå­ç»„ä»¶åŒæ—¶ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œä½†æ˜¯å­ç»„ä»¶å†…ä¿®æ”¹å´ä¸ä¼šå½±å“çˆ¶ç»„ä»¶</li><li>åœ¨å‘å­ç»„ä»¶ä¼ å€¼æ—¶åªèƒ½ä½¿ç”¨å•å‘ç»‘å®šã€‚</li></ul><p>å­ç»„ä»¶ä¸­ä¿®æ”¹æ¥å—åˆ°çš„å€¼åªå¯¹å­ç»„ä»¶æœ‰å½±å“ï¼Œè€Œä¸ä¼šå¯¹çˆ¶ç»„ä»¶äº§ç”Ÿå½±å“ï¼Œå¦‚æœæƒ³è¦å®ç°çˆ¶å­åŒæ­¥çš„è¯ï¼Œå¯ä»¥å°†ä¼ å…¥çš„å€¼å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨å¯¹è±¡å†…çš„å€¼ï¼Œè¿™æ ·çˆ¶å­å°±å¯ä»¥åŒæ­¥äº†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../static/js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>å­ç»„ä»¶ä¿®æ”¹propå€¼<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;tmp1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      ä»çˆ¶ç»„ä»¶ä¸­è·å–åˆ°çš„å€¼ï¼š&#123;&#123; msg.a &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      ä¿®æ”¹çˆ¶ç»„ä»¶çš„å€¼ä¸ºï¼š</span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg.a&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    çˆ¶ç»„ä»¶ä¸­çš„msgï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg.a&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">com</span> <span class="attr">:msg</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">com</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>: [<span class="string">&quot;msg&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">template</span>: <span class="string">&quot;#tmp1&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">msg</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;a&quot;</span>: <span class="number">1</span>, <span class="string">&quot;b&quot;</span>: <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&quot;com&quot;</span>: com</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="çˆ¶ä¼ å­-æ–¹æ³•">çˆ¶ä¼ å­-æ–¹æ³•</h4><p>çˆ¶ç»„ä»¶åœ¨å‘å­ç»„ä»¶ä¼ å€¼çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡å±æ€§ï¼Œé‚£ä¹ˆ<font color="red">ä¼ é€’æ–¹æ³•éœ€è¦é€šè¿‡äº‹ä»¶</font>ï¼Œäº‹ä»¶çš„åç§°è‡ªå®šä¹‰å³å¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">com1</span> @<span class="attr">abc</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">com1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com1 = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;button @click=&#x27;good()&#x27;&gt;ç‚¹å‡»è§¦å‘çˆ¶ç»„ä»¶æ–¹æ³•&lt;/button&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">good</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="variable language_">this</span>.$emit(<span class="string">&quot;abc&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">test</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="title function_">alert</span>(<span class="string">&quot;æˆ‘æ˜¯çˆ¶ç»„ä»¶çš„æ–¹æ³•&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;com1&quot;</span>: com1</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>@äº‹ä»¶å æ˜¯è‡ªå®šä¹‰çš„ï¼Œä¹‹åéœ€è¦åœ¨å­ç»„ä»¶ä¸­çš„ $emit() ä¸­ä½¿ç”¨äº‹ä»¶çš„åå­—æ¥è·å–å¼•ç”¨</li><li>åœ¨äº‹ä»¶å†…å¦‚æœä½¿ç”¨ func() åˆ™æ˜¯è°ƒç”¨æ–¹æ³•ï¼Œä½†å¦‚æœæ˜¯ func åˆ™æ˜¯ä¼ é€’è¯¥æ–¹æ³•çš„å¼•ç”¨åœ°å€ï¼Œé€šè¿‡è¿™ç‚¹æ¥ä¼ é€’æ–¹æ³•</li><li>è·å–çˆ¶ç»„ä»¶æ–¹æ³•å¹¶ä¸ä¼šä½¿åŸæ–¹æ³•æœ‰å˜åŒ–ï¼Œè¯¥æ‰§è¡Œç…§æ ·æ‰§è¡Œ</li><li>åœ¨è°ƒç”¨çˆ¶ç»„ä»¶çš„å‡½æ•°æ—¶å¦‚æœéœ€è¦å‚æ•°ï¼Œé‚£ä¹ˆè¿½åŠ åœ¨ $emit() çš„å‚æ•°åˆ—è¡¨ä¸­</li></ul><h4 id="å­ä¼ çˆ¶-å±æ€§">å­ä¼ çˆ¶-å±æ€§</h4><p>å­ç»„ä»¶ä¸­çš„ data ä¼ é€’ç»™çˆ¶ç»„ä»¶ï¼Œéœ€è¦ä½¿ç”¨åˆ°çˆ¶ä¼ å­æ–¹æ³•ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰ä¸€ä¸ª data å±æ€§å’Œä¸€ä¸ªæ–¹æ³•ï¼Œå°†æ–¹æ³•ä¼ é€’ç»™å­ç»„ä»¶ï¼Œä½†æ˜¯å­ç»„ä»¶ä½¿ç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œå°†å‚æ•°æ”¾å…¥åå°±ä¼ ç»™çˆ¶ç»„ä»¶äº†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   çˆ¶äº²çš„é’±åŒ…ä½™é¢ï¼š&#123;&#123;rmb&#125;&#125;å…ƒ</span><br><span class="line">   <span class="tag">&lt;<span class="name">com1</span> @<span class="attr">func</span>=<span class="string">&quot;getRmb&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">com1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com1 = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;button @click=&#x27;toSuper()&#x27;&gt;ç»™çˆ¶äº²100å…ƒé’±&lt;/button&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">toSuper</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="variable language_">this</span>.$emit(<span class="string">&quot;func&quot;</span>, <span class="number">100</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123; <span class="attr">rmb</span>: <span class="number">0</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getRmb</span>(<span class="params"> rmb </span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="variable language_">this</span>.<span class="property">rmb</span> += rmb;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>: &#123; <span class="string">&quot;com1&quot;</span>: com1 &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å­ä¼ çˆ¶-æ–¹æ³•">å­ä¼ çˆ¶-æ–¹æ³•</h4><p>å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ æ–¹æ³•ï¼Œéœ€è¦åœ¨å­ç»„ä»¶æ‰€åœ¨çš„æ ‡ç­¾ä¸­ä½¿ç”¨ <code>ref</code> å±æ€§æ¥ä¸ºå½“å‰ç»„ä»¶èµ·ä¸ªåˆ«åï¼Œç„¶åä½¿ç”¨ <code>$refs</code> æ¥è°ƒç”¨å­ç»„ä»¶ä¸­çš„æ–¹æ³•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">com1</span> <span class="attr">ref</span>=<span class="string">&quot;com1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">com1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getAndroid()&quot;</span>&gt;</span>ç‚¹å‡»æŸ¥çœ‹å„¿å­æ‰‹æœº<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com1 = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;h2&gt;è€çˆ¸ï¼Œæˆ‘åœ¨è¿™&lt;/h2&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">android</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="title function_">alert</span>(<span class="string">&quot;å°é»„ç‰‡å„¿&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">rmb</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getAndroid</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">com1</span>.<span class="title function_">android</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;com1&quot;</span>: com1</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç»„ä»¶ä¼ å€¼æ³¨æ„äº‹é¡¹">ç»„ä»¶ä¼ å€¼æ³¨æ„äº‹é¡¹</h4><p>æ— è®ºæ˜¯ä¼  data æ•°æ®è¿˜æ˜¯ä¼  methods æ–¹æ³•ï¼Œéƒ½ä¸æ˜¯çœŸæ­£çš„ä¼ ç»™äº†å­ç»„ä»¶ï¼Œè€Œæ˜¯å€ŸåŠ©çˆ¶ç»„ä»¶çš„å¼•ç”¨æ¥å®ç°è°ƒç”¨</p><blockquote><p>ä¾‹å¦‚ï¼šåœ¨çˆ¶ç»„ä»¶ä¸­ä¿®æ”¹ data çš„å€¼ï¼Œå¯¹åº”çš„å­ç»„ä»¶ä¹Ÿä¼šè¢«ä¿®æ”¹</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;good&quot;</span>&gt;</span></span><br><span class="line">   ä¿®æ”¹çˆ¶ç»„ä»¶ä¸­çš„msg: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">zhe</span> <span class="attr">:msg</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">zhe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#good&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;  <span class="attr">msg</span>: <span class="string">&quot;å“ˆå“ˆå“ˆå“ˆ&quot;</span>  &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">func1</span>(<span class="params"></span>)&#123;  <span class="title function_">alert</span>( <span class="variable language_">this</span>.<span class="property">msg</span> )  &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;zhe&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">template</span>: <span class="string">&quot;&lt;div&gt;å­ç»„ä»¶ä¸­çš„msgï¼š&#123;&#123;msg&#125;&#125;&lt;/div&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">props</span>:[<span class="string">&quot;msg&quot;</span>]</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¾‹å¦‚ï¼šåœ¨å­ç»„ä»¶ä¸­è°ƒç”¨çˆ¶ç»„ä»¶ä¼ æ¥çš„æ–¹æ³•ï¼Œæ–¹æ³•ä¸­è°ƒç”¨çˆ¶å’Œå­ä¸­åŒåçš„ dataï¼Œè¢«è°ƒç”¨çš„ä¸€å®šæ˜¯çˆ¶ä¸­çš„ data</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;good&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">zhe</span> @<span class="attr">func1</span>=<span class="string">&quot;func1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">zhe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#good&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;  <span class="attr">msg</span>: <span class="string">&quot;çˆ¶ç»„ä»¶ä¸­çš„msg&quot;</span>  &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">func1</span>(<span class="params"></span>)&#123;  <span class="title function_">alert</span>( <span class="variable language_">this</span>.<span class="property">msg</span> )  &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;zhe&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">template</span>: <span class="string">&quot;&lt;button @click=&#x27;func1&#x27;&gt; ç‚¹å‡»æµ‹è¯• &lt;/button&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;  <span class="attr">msg</span>: <span class="string">&quot;å­ç»„ä»¶çš„msg&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">     &#125;,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">func1</span>(<span class="params"></span>)&#123;  <span class="variable language_">this</span>.$emit(<span class="string">&quot;func1&quot;</span>)  &#125;</span></span><br><span class="line"><span class="language-javascript">     &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Vue-å…¨å±€-API">Vue å…¨å±€ API</h2><h3 id="mixins-æ··å…¥">mixins æ··å…¥</h3><p>å¦‚æœå½“å‰é¡¹ç›®å·²ç»å¼€å‘å®Œæ¯•ï¼Œè¿™æ—¶çªç„¶è¦æ±‚è¦æ–°å¢ä¸€ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯ä½ å·²ç»ä¸æƒ³åœ¨æºä»£ç çš„åŸºç¡€ä¸Šåœ¨å»ä¹±æ”¹äº†ï¼Œè¿™æ˜¯å¯ä»¥ä½¿ç”¨åˆ°æ··å…¥çš„åŠŸèƒ½ï¼Œ<font color="red">æ··å…¥ï¼Œæ·»åŠ å…¶ä»–å¯¹è±¡åˆ°å½“å‰ vue å®ä¾‹ä¸­ ( æŒ‰ç…§ vue çš„è§„èŒƒä¹¦å†™ )</font></p><blockquote><p>mixins æ··å…¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥æ··å…¥å¤šä¸ªå¯¹è±¡ï¼Œå¯ä»¥æ··å…¥æ™®é€šå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ··å…¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç­‰ç­‰ï¼Œ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add()&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mixins1 = &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">good</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ–°å¢åŠ çš„åŠŸèƒ½&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;é¡¹ç›®åˆå§‹åŒ–ï¼&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è°ƒç”¨äº†addæ–¹æ³•&quot;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">good</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mixins</span>: [mixins1]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>æ··å…¥çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œæœ¬èº«çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç›¸æ¯”ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œä½†å¦‚æœå½“å‰å®ä¾‹ä¸­å·²ç»å­˜åœ¨äº†æ··å…¥çš„åŒåæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šé»˜è®¤è°ƒç”¨æœ¬èº«çš„è€Œä¸è°ƒç”¨æ··å…¥çš„</li></ul><h3 id="extends-æ‰©å±•">extends æ‰©å±•</h3><p>extend æ‰©å±•ï¼Œå’Œæ··å…¥å‡ ä¹ä¸€æ¨¡ä¸€æ ·</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add()&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> extend1 = &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">good</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ–°å¢åŠ çš„åŠŸèƒ½&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;é¡¹ç›®åˆå§‹åŒ–ï¼&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è°ƒç”¨äº†addæ–¹æ³•&quot;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">good</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">extends</span>: extend1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>æ··å…¥çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œæœ¬èº«çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç›¸æ¯”ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œä½†å¦‚æœå½“å‰å®ä¾‹ä¸­å·²ç»å­˜åœ¨äº†æ··å…¥çš„åŒåæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šé»˜è®¤è°ƒç”¨æœ¬èº«çš„è€Œä¸è°ƒç”¨æ··å…¥çš„</li></ul><h3 id="ä¿®æ”¹å·®å€¼è¡¨è¾¾å¼ç¬¦å·">ä¿®æ”¹å·®å€¼è¡¨è¾¾å¼ç¬¦å·</h3><p>åœ¨ vue ä¸­ä½¿ç”¨æ’å€¼è¡¨è¾¾å¼ <code>&#123;&#123; &#125;&#125;</code> å¯ä»¥ç›´æ¥è¾“å…¥å®ä¾‹ä¸­çš„ data æ•°æ®ï¼Œä½†æ˜¯å½“ vue æ¡†æ¶çš„å·®å€¼è¡¨è¾¾å¼å’Œå…¶ä»–æ¡†æ¶çš„è¡¨è¾¾å¼å‘æˆå†²çªï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ <code>delimiters</code> ä¿®æ”¹æ’å€¼è¡¨è¾¾å¼çš„ä½¿ç”¨è§„åˆ™</p><blockquote><p><code>delimiters</code> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦ä¸¤ä¸ªå‚æ•°åšä¸ºå¤´å°¾ï¼Œä½¿ç”¨ *[ åšä¸ºå¼€å§‹æ ‡è®°ï¼Œ] åšä¸ºç»“æŸæ ‡è®°</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span> *[msg] <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;æµ‹è¯•æ•°æ®&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">delimiters</span>: [<span class="string">&quot;*[&quot;</span>, <span class="string">&quot;]&quot;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="computed-è®¡ç®—å±æ€§">computed è®¡ç®—å±æ€§</h3><p>è®¡ç®—å±æ€§ï¼Œå°±åƒåå­—ä¸€æ ·ï¼Œå¯ä»¥å’Œ data ä¸­çš„æ•°æ®ä¸€æ ·ä½œä¸ºå±æ€§ç›´æ¥è°ƒç”¨ï¼Œä½†æ˜¯ä¸ data ä¸åŒçš„æ˜¯ï¼Œè®¡ç®—å±æ€§å‘æ–¹æ³•ä¸€æ ·ï¼Œå¯ä»¥å°†å€¼æå‰è®¡ç®—å¥½ï¼Œåœ¨ä½¿ç”¨æ—¶ç›´æ¥è°ƒç”¨è®¡ç®—å¥½çš„å€¼</p><p>methodså®Œå…¨å¯ä»¥ä»£æ›¿ computedï¼Œä½†æ˜¯ computed å’Œ methods ä¸åŒçš„æ˜¯ï¼Œcomputed æ˜¯ä¾èµ–äºç¼“å­˜ï¼Œåªè¦ç¼“å­˜æ•°æ®ä¸å˜ï¼Œé‚£ä¹ˆå°±ä¸å·¥ä½œ</p><p>ç›¸æ¯”æ¥è¯´ computed æ€§èƒ½æ›´é«˜ï¼Œä½†æ˜¯å¦‚æœæƒ³é¿å…ç¼“å­˜é—®é¢˜è¿˜æ˜¯è¦ä½¿ç”¨ methods</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">message</span>: <span class="string">&quot;å“ˆå“ˆå“ˆ&quot;</span></span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">msgFunc</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">message</span>;</span></span><br><span class="line"><span class="language-javascript">     &#125;,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params"> value </span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">message</span> = value;</span></span><br><span class="line"><span class="language-javascript">     &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;setå‰ï¼š&quot;</span> + v.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// æ‰§è¡Œsetæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">  v.<span class="property">msgFunc</span> = <span class="string">&quot;å˜¿å˜¿å˜¿&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;&lt;br /&gt;setåï¼š&quot;</span> + v.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="watch-ç›‘å¬å±æ€§">watch ç›‘å¬å±æ€§</h3><p>åœ¨ vue ä¸­å¯ä»¥ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹æ³•ç›‘å¬</p><ol><li><p>vue å¯¹è±¡å†…çš„ watch å±æ€§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">s</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">watch</span>: &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡watchè¿›è¡Œç›‘å¬</span></span><br><span class="line">        <span class="attr">s</span>: <span class="keyword">function</span>(<span class="params"> value </span>)&#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;s ä¿®æ”¹åçš„å€¼ä¸ºï¼š&quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡ vue å¯¹è±¡è°ƒç”¨ç›‘å¬å®ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">s</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«ç›‘å¬çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°åœ¨ç›‘å¬åˆ°æ•°æ®è¢«ä¿®æ”¹çš„ä¸€ç¬é—´æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¿®æ”¹åçš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¿®æ”¹å‰çš„å€¼ï¼Œå˜é‡åéšä¾¿èµ·</span></span><br><span class="line">v.$watch(<span class="string">&quot;s&quot;</span>, <span class="keyword">function</span>(<span class="params">end, begin</span>)&#123;</span><br><span class="line">    <span class="title function_">alert</span>( begin + <span class="string">&quot;â†’&quot;</span> + end );</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><p>å°ç»ƒä¹ ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"> <span class="selector-tag">input</span>&#123;<span class="attribute">width</span>: <span class="number">100px</span>;&#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   åƒç±³ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;km&quot;</span> /&gt;</span></span><br><span class="line">   ç±³ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;m&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;info&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">km</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">m</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// é€šè¿‡watchè¿›è¡Œç›‘å¬</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">km</span>: <span class="keyword">function</span>(<span class="params"> value </span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="variable language_">this</span>.<span class="property">m</span> = value * <span class="number">1000</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">m</span>: <span class="keyword">function</span>(<span class="params"> value </span>)&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="variable language_">this</span>.<span class="property">km</span> = value / <span class="number">1000</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// è°ƒç”¨ç›‘å¬çš„å®ä¾‹æ–¹æ³•ï¼Œå›è°ƒå‡½æ•°åœ¨ç›‘å¬åˆ°æ•°æ®è¢«ä¿®æ”¹çš„ä¸€ç¬é—´æ‰§è¡Œ</span></span></span><br><span class="line"><span class="language-javascript">  v.$watch(<span class="string">&quot;km&quot;</span>, <span class="keyword">function</span>(<span class="params">end, begin</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;info&quot;</span>).<span class="property">innerText</span> = </span></span><br><span class="line"><span class="language-javascript">     <span class="string">&quot;åƒç±³ä»&quot;</span> + begin + <span class="string">&quot;å˜æˆäº†&quot;</span> + end;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Vue-åŠ¨ç”»">Vue åŠ¨ç”»</h2><p>åœ¨ vue ä¸­å¯ä»¥é€šè¿‡ v-if æˆ–è€… v-show æŒ‡ä»¤ï¼Œæ¥å¯¹å…ƒç´ è¿›è¡Œæ˜¾ç¤ºå’Œéšè—çš„æ•ˆæœï¼Œä½†æ˜¯è¡¨ç°å¤ªè¿‡ç”Ÿç¡¬ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°vue ä¸­çš„åŠ¨ç”»</p><h3 id="è¿›åœºå’Œç¦»åœºè¿‡æ¸¡">è¿›åœºå’Œç¦»åœºè¿‡æ¸¡</h3><p>åœ¨å…ƒç´ æ˜¾ç¤ºå’Œéšè—çš„è¿‡ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªé€æ˜åº¦çš„è¿‡æ¸¡ï¼Œé’ˆå¯¹è¿›åœºå’Œç¦»åœºï¼ŒVue æä¾›äº†å››ä¸ªæ ·å¼</p><table><thead><tr><th style="text-align:center">classæ ·å¼</th><th style="text-align:center">å¯¹åº”æ—¶é—´ç‚¹</th></tr></thead><tbody><tr><td style="text-align:center">.v-enter</td><td style="text-align:center">è¿›åœº é¦–éƒ¨æ—¶é—´ç‚¹</td></tr><tr><td style="text-align:center">.v-enter-to</td><td style="text-align:center">è¿›åœº å°¾éƒ¨æ—¶é—´ç‚¹</td></tr><tr><td style="text-align:center">.v-leave</td><td style="text-align:center">ç¦»åœº é¦–éƒ¨æ—¶é—´ç‚¹</td></tr><tr><td style="text-align:center">.v-leave-to</td><td style="text-align:center">ç¦»åœº å°¾éƒ¨æ—¶é—´ç‚¹</td></tr></tbody></table><p>è¿›åœºçš„ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„è¿‡ç¨‹å«åš <code>v-enter-active</code>ï¼Œç¦»åœºçš„ä¸¤ä¸ªæ—¶é—´ç‚¹çš„è¿‡ç¨‹å« <code>v-leave-active</code></p><p>é€šè¿‡å››ä¸ªæ ·å¼å¯¹åº”çš„æ—¶é—´ç‚¹ï¼Œé…åˆ css çš„ transition æ ·å¼æ¥å®Œæˆè¿›åœºå’Œç¦»åœºçš„è¿‡æ¸¡æ•ˆæœï¼Œ<font color="red">è¢« vue æ§åˆ¶çš„åŠ¨ç”»å¿…é¡»è¦åœ¨ transition æ ‡ç­¾å†…æ‰æœ‰æ•ˆæœ</font></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100px</span>);</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-leave-to</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100px</span>);</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter-active</span> &#123; <span class="attribute">transition</span>: all <span class="number">0.5s</span> ease; &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-leave-active</span> &#123; <span class="attribute">transition</span>: all <span class="number">1.0s</span> ease; &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">center</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag=!flag&quot;</span>&gt;</span>æ˜¾ç¤º/éšè—<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">transition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-show</span>=<span class="string">&quot;flag&quot;</span>&gt;</span>å“ˆå“ˆå“ˆå“ˆ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123; <span class="attr">flag</span>: <span class="literal">false</span> &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŒºåˆ†å¤šä¸ªåŠ¨ç”»">åŒºåˆ†å¤šä¸ªåŠ¨ç”»</h3><p>å½“æˆ‘ä»¬å®šä¹‰å¤šä¸ªæ ‡ç­¾è¿›è¡Œè¿›åœºå’Œå…¥åœºæ—¶ï¼Œä»–ä»¬ä¼šå…±ç”¨åŒä¸€ä¸ªè¿‡æ¸¡åŠ¨ç”»ï¼Œéœ€è¦åŒºåˆ†è¿‡æ¸¡åŠ¨ç”»</p><p>å¯ä»¥å‘ç°æ— è®ºæ—¶è¿›åœºçš„æ ·å¼è¿˜æ˜¯ç¦»åœºçš„æ ·å¼éƒ½æœ‰ä¸€ä¸ª v- ä½œä¸ºå‰ç¼€ï¼Œv- å‰ç¼€æ˜¯ vue çš„é»˜è®¤å…¨å±€æ ·å¼ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„æ ·å¼æ¥åŒºåˆ†ä¸åŒçš„åŠ¨ç”»</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter</span>, <span class="selector-class">.v-leave-to</span>&#123;  <span class="attribute">opacity</span>: <span class="number">0</span>;  &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter-active</span>, <span class="selector-class">.v-leave-active</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: opacity <span class="number">0.5s</span> ease;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.a-enter</span>, <span class="selector-class">.a-leave-to</span>&#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.a-enter-active</span>, <span class="selector-class">.a-leave-active</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: all <span class="number">1.0s</span> ease;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag1=!flag1&quot;</span>&gt;</span>æ˜¾ç¤º/éšè—<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">transition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-show</span>=<span class="string">&quot;flag1&quot;</span>&gt;</span>å“ˆå“ˆå“ˆå“ˆ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag2=!flag2&quot;</span>&gt;</span>æ˜¾ç¤º/éšè—<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-show</span>=<span class="string">&quot;flag2&quot;</span>&gt;</span>å“ˆå“ˆå“ˆå“ˆ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">flag1</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">flag2</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="red">ä½¿ç”¨ä¸åŒçš„å‰ç¼€ï¼Œåœ¨ transition æ ‡ç­¾ä¸­çš„ name å±æ€§è®¾ç½®å‰ç¼€ï¼Œå¦‚ä¸è®¾ç½® name åˆ™é»˜è®¤ -v</font></p><h3 id="åˆ‡æ¢æ•ˆæœ">åˆ‡æ¢æ•ˆæœ</h3><p>åœ¨ä½¿ç”¨ vue åŠ¨ç”»è®¾ç½®è¿›åœºå’Œç¦»åœºçš„è¿‡æ¸¡æ—¶èå…¥ç»„ä»¶çš„åˆ‡æ¢ï¼Œå®ç° <font color="red">å…ˆç¦»åœºï¼Œå†è¿›åœº</font> çš„æ·¡å…¥æ·¡å‡º</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">40px</span>);</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-leave-to</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">40px</span>);</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter-active</span>, <span class="selector-class">.v-leave-active</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag=!flag&quot;</span>&gt;</span>åˆ‡æ¢ç»„ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">transition</span> <span class="attr">mode</span>=<span class="string">&quot;out-in&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;flag?&#x27;com1&#x27;:&#x27;com2&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  var zhe1 = &#123; template: &quot;<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&#x27;4&#x27;</span> <span class="attr">color</span>=<span class="string">&#x27;green&#x27;</span>&gt;</span>ç»¿è‰²-ç»„ä»¶<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>&quot; &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  var zhe2 = &#123; template: &quot;<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&#x27;4&#x27;</span> <span class="attr">color</span>=<span class="string">&#x27;red&#x27;</span>&gt;</span>çº¢è‰²-ç»„ä»¶<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>&quot; &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  Vue.component(&quot;com1&quot;, zhe1)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  Vue.component(&quot;com2&quot;, zhe2)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  var v = new Vue(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      el: &quot;#app&quot;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">   data: &#123; flag: true &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"> </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="router-è·¯ç”±">router è·¯ç”±</h2><p>vue çš„è·¯ç”±éœ€è¦å¼•ç”¨ä»–çš„ js æ–‡ä»¶æ‰å¯ä»¥ä½¿ç”¨ï¼Œæ–‡ä»¶ä½ç½®ï¼š<a href="https://unpkg.com/vue-router/dist/vue-router.min.js">https://unpkg.com/vue-router/dist/vue-router.min.js</a></p><h3 id="è·¯ç”±çš„å¼•ä¸ä½¿ç”¨">è·¯ç”±çš„å¼•ä¸ä½¿ç”¨</h3><p>vue-router è¢«ç§°ä¸ºå‰ç«¯è·¯ç”±ï¼Œä»–è´Ÿè´£åœ¨å‰ç«¯ç»„ä»¶ä¹‹é—´æ¥å›åˆ‡æ¢å®ç°è·³è½¬çš„åŠŸèƒ½ï¼Œä½¿ç”¨å‰ç«¯è·¯ç”±åç½‘é¡µçš„åœ°å€æ ä¼šæœ‰ <code>#/</code> çš„æ ‡è¯†ï¼Œè¿™å°±ä»£è¡¨è¿™è·¯ç”±å¼•ç”¨æˆåŠŸäº†ï¼Œ<font color="red">ä¸€å®šè¦ä¼˜å…ˆå¼•ç”¨ vue.jsï¼Œç„¶ååœ¨å¼•ç”¨ vue-router æ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨</font></p><blockquote><p>æ¨¡æ‹Ÿç™»é™†å’Œæ³¨å†Œ</p></blockquote><p>&lt;/img src=â€œ.//img/vue-09.pngâ€ /&gt;</p><ul><li>å½“å¤šä¸ªç»„ä»¶åŒ¹é…äº†åŒä¸€ä¸ª path æ—¶ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„ç”Ÿæ•ˆï¼Œåé¢çš„å°†è¢«è¦†ç›–</li></ul><h3 id="ç½‘é¡µè·³è½¬å®ç°">ç½‘é¡µè·³è½¬å®ç°</h3><p>ä¸Šé¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„è·¯ç”±çš„å®ä¾‹ï¼Œé€šè¿‡ä¿®æ”¹åœ°å€æ è¾¾åˆ°è®¿é—®ä¸åŒç»„ä»¶çš„è·³è½¬ï¼Œä¸‹é¢å°†ä½¿ç”¨è¶…é“¾æ¥å®ç°è·³è½¬ï¼Œå› ä¸ºæ—¶åŸºäºè·¯ç”±å®ç°è·³è½¬ï¼Œæ‰€ä»¥è¦åœ¨ /login å‰é¢åŠ ä¸Š # ä»£è¡¨è®¿é—®çš„æ˜¯è·¯ç”±</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/login&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>ç™»é™†<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/regis&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>æ³¨å†Œ<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é’ˆå¯¹é“¾æ¥è·³è½¬ï¼Œvue-router æä¾›äº†ä¸“å±çš„ router-link æ ‡ç­¾ï¼š</p><ul><li>to: å±æ€§ä»£è¡¨è·³è½¬çš„ç›®æ ‡åœ°å€ï¼Œä¸éœ€è¦æºå¸¦ #</li><li>tag: ä»£è¡¨ä»–åœ¨ç½‘é¡µçš„è¡¨ç°å½¢å¼ï¼Œé»˜è®¤ä¼šè¢«æ¸²æŸ“ä¸º a æ ‡ç­¾</li><li>toï¼Œtag å±æ€§éƒ½å¯ä»¥è¢« vue è¿›è¡Œç»‘å®šä¼ å€¼</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;button&quot;</span>&gt;</span>ç™»é™†<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/regis&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;button&quot;</span>&gt;</span>æ³¨å†Œ<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®é¦–é¡µ-é»˜è®¤æ˜¾ç¤ºç»„ä»¶">è®¾ç½®é¦–é¡µ-é»˜è®¤æ˜¾ç¤ºç»„ä»¶</h3><p>é»˜è®¤æƒ…å†µä¸‹å½“æˆ‘ä»¬è®¿é—®é¦–é¡µçš„æ—¶å€™åº”è¯¥æ˜¯æç¤ºæˆ‘ä»¬ç™»é™†ï¼Œç„¶åæˆ‘ä»¬æ‰‹åŠ¨çš„åˆ‡æ¢ç™»é™†å’Œæ³¨å†Œï¼Œè€Œä¸æ˜¯è®¿é—®é¦–é¡µæ—¶æ˜¾ç¤ºç©ºç™½ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®é»˜è®¤æ˜¾ç¤ºçš„ç»„ä»¶</p><blockquote><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼šå½“è®¿é—®æ ¹ç›®å½•æ—¶ä¹Ÿè·³è½¬åˆ° login ç»„ä»¶</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var router = new VueRouter(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">        &#123; path: &quot;/&quot;, component: login &#125;,</span><br><span class="line">        &#123; path: &quot;/login&quot;, component: login &#125;,</span><br><span class="line">        &#123; path: &quot;/regis&quot;, component: regis &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬äºŒç§æ–¹æ³•ï¼šä½¿ç”¨é‡å®šå‘çš„æ–¹æ³•è¿›è¡Œè·³è½¬</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: login &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/regis&quot;</span>, <span class="attr">component</span>: regis &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®è·¯ç”±è®¿é—®é«˜äº®">è®¾ç½®è·¯ç”±è®¿é—®é«˜äº®</h3><p>å½“ä¸€ä¸ªé¡µé¢æœ‰å¤šä¸ªè·¯ç”±è·³è½¬é“¾æ¥æ—¶ï¼Œä¾‹å¦‚å¯¼èˆªæ ï¼Œè¿™ä¸ªæ—¶å€™å¸Œæœ›è¢«é€‰æ‹©çš„é“¾æ¥æœ‰é«˜äº®æ˜¾ç¤ºï¼š</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶å°å‘ç°ï¼Œå½“æœ‰å¤šä¸ªè¶…é“¾æ¥è·¯ç”±æ—¶ï¼Œè¢«é€‰ä¸­çš„é‚£ä¸ªè¶…é“¾æ¥ä¼šåŠ¨æ€çš„ç»‘å®šä¸€ä¸ªclasså±æ€§ï¼š</p><p>&lt;/img src=â€œ.//img/vue-10.pngâ€ /&gt;</p><blockquote><p>å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹æ¥å¯¹è¢«ç‚¹å‡»çš„é“¾æ¥è¿›è¡Œä¿®é¥°ï¼šâ†“ â†“ â†“</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue-router.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-tag">a</span> &#123;  <span class="attribute">text-decoration</span>: none;  &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.router-link-active</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/list1&quot;</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/list2&quot;</span>&gt;</span>è´¦æˆ·<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/list3&quot;</span>&gt;</span>ä¸ªäººä¿¡æ¯<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/list4&quot;</span>&gt;</span>å…³äºæˆ‘ä»¬<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">hr</span> /&gt;</span> <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> list1 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;è¿™ä¸ªæ˜¯é¦–é¡µçš„ç»„ä»¶&lt;/h1&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> list2 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;è¿™ä¸ªæ˜¯è´¦æˆ·çš„ç»„ä»¶&lt;/h1&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> list3 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;è¿™ä¸ªæ˜¯ä¸ªäººä¿¡æ¯çš„ç»„ä»¶&lt;/h1&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> list4 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;è¿™ä¸ªæ˜¯å…³äºæˆ‘ä»¬çš„ç»„ä»¶&lt;/h1&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">routes</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/list1&quot;</span> &#125;, <span class="comment">// é»˜è®¤æ˜¯é¦–é¡µ</span></span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/list1&quot;</span>, <span class="attr">component</span>: list1 &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/list2&quot;</span>, <span class="attr">component</span>: list2 &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/list3&quot;</span>, <span class="attr">component</span>: list3 &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/list4&quot;</span>, <span class="attr">component</span>: list4 &#125;</span></span><br><span class="line"><span class="language-javascript">   ]</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">router</span>: router</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ <code>router-link-active</code> æ˜¯ vue-router æä¾›çš„æ ·å¼åç§°ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¿®æ”¹ä»–çš„é»˜è®¤ class åç§°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/list1&quot;</span> &#125;, <span class="comment">// é»˜è®¤æ˜¯é¦–é¡µ</span></span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/list1&quot;</span>, <span class="attr">component</span>: list1 &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/list2&quot;</span>, <span class="attr">component</span>: list2 &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/list3&quot;</span>, <span class="attr">component</span>: list3 &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/list4&quot;</span>, <span class="attr">component</span>: list4 &#125;</span><br><span class="line">    ],</span><br><span class="line"> <span class="comment">// åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¿®æ”¹ä»–çš„é»˜è®¤ class åç§°ï¼Œè¿™é‡Œå¯ä»¥é…åˆBootstrapä½¿ç”¨</span></span><br><span class="line">    <span class="attr">linkActiveClass</span>: <span class="string">&quot;zhe-active&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶åˆ‡æ¢åŠ¨ç”»æ•ˆæœ">ç»„ä»¶åˆ‡æ¢åŠ¨ç”»æ•ˆæœ</h3><p>ç»“åˆ vue å››ä¸ªæ—¶é—´æ®µçš„åŠ¨ç”»å’Œç»„ä»¶åˆ‡æ¢çš„çŸ¥è¯†ç‚¹ï¼Œå®ç°ç»„ä»¶åˆ‡æ¢æ·¡å…¥æ·¡å‡ºçš„æ•ˆæœ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue-router.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-tag">a</span> &#123;  <span class="attribute">text-decoration</span>: none;  &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.router-link-active</span>, <span class="selector-class">.zhe-active</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter</span>, <span class="selector-class">.v-leave-to</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100px</span>);</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.v-enter-active</span>, <span class="selector-class">.v-leave-active</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: opacity <span class="number">0.5s</span> ease, transform <span class="number">0.5s</span> ease;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/list1&quot;</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/list2&quot;</span>&gt;</span>è´¦æˆ·<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">transition</span> <span class="attr">mode</span>=<span class="string">&quot;out-in&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> list1 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;è¿™ä¸ªæ˜¯é¦–é¡µçš„ç»„ä»¶&lt;/h1&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> list2 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h1&gt;è¿™ä¸ªæ˜¯è´¦æˆ·çš„ç»„ä»¶&lt;/h1&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">routes</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/list1&quot;</span> &#125;, <span class="comment">// é»˜è®¤æ˜¯é¦–é¡µ</span></span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/list1&quot;</span>, <span class="attr">component</span>: list1 &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/list2&quot;</span>, <span class="attr">component</span>: list2 &#125;</span></span><br><span class="line"><span class="language-javascript">   ],</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">linkActiveClass</span>: <span class="string">&quot;zhe-active&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">router</span>: router</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="route-è·¯ç”±ä¼ å‚">$route è·¯ç”±ä¼ å‚</h3><p>$router æ˜¯ VueRouter çš„ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨è·³è½¬è‡³ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™å¦‚æœæºå¸¦äº†ä¸€äº›å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ä»–è·å–åˆ°ä¼ é€’çš„å‚æ•°ï¼Œè·å–ä¼ é€’å‚æ•°æœ‰ä¸¤ç§æ–¹æ³•</p><h4 id="é€šè¿‡-query-è·å–å‚æ•°">é€šè¿‡ query è·å–å‚æ•°</h4><p>$router å¯¹è±¡ä¸­çš„ query å±æ€§å¯ä»¥æ¥å—è¿™ç§æ‹¼æ¥å­—ç¬¦ä¸²çš„ä¼ å‚</p><blockquote><p>å½“å‰è¯·æ±‚ #/login?user=admin æ—¶</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue-router.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login?user=å“ˆå“ˆ&quot;</span>&gt;</span>ç™»é™†<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> login = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;div&gt;ç™»é™†æˆåŠŸï¼&#123;&#123;$route.query.user&#125;&#125;&lt;/div&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$route</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">routes</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>:login &#125;</span></span><br><span class="line"><span class="language-javascript">   ]</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">router</span>: router</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>&lt;/img src=â€œ.//img/vue-12.pngâ€ /&gt;</p><h4 id="é€šè¿‡-params-å±æ€§è·å–">é€šè¿‡ params å±æ€§è·å–</h4><p>ä½¿ç”¨ query å¯ä»¥è·å–åˆ°ä»¥ ? &amp; æ‹¼æ¥å­—ç¬¦ä¸²å½¢å¼çš„å‚æ•°ï¼Œé™¤å¼€è¿™ç§æ–¹å¼è¿˜å¯ä»¥ä½¿ç”¨ params å±æ€§è·å–ï¼Œä½¿ç”¨ params è·å–çš„å‚æ•°éœ€è¦ä»¥ :å ä½ç¬¦ çš„å½¢å¼æ¥è¿›è¡Œä¼ å‚</p><blockquote><p>å½“è®¿é—® #/login/:id/:name æ—¶</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue-router.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login/001/å¼ æ¶µå“²&quot;</span>&gt;</span>ç™»é™†<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> login = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;div&gt;ç™»é™†æˆåŠŸï¼&#123;&#123;$route.params.id&#125;&#125;--&#123;&#123;$route.params.name&#125;&#125;&lt;/div&gt;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$route</span>)</span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">routes</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login/:id/:name&quot;</span>, <span class="attr">component</span>:login &#125;</span></span><br><span class="line"><span class="language-javascript">   ]</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">router</span>: router</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±åµŒå¥—">è·¯ç”±åµŒå¥—</h3><p>ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­ï¼Œä¸ä¼šåªä½¿ç”¨ä¸€å±‚è·¯ç”±ï¼Œå¾€å¾€ä¼šæœ‰å¥½å‡ å±‚è·¯ç”±åµŒå¥—ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>é¦–é¡µ</code> æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œï¼Œç„¶åé¦–é¡µä¸­åˆæœ‰ <code>ç™»é™†</code> å’Œ <code>æ³¨å†Œ</code> ä¸¤ä¸ªç»„ä»¶ï¼Œè¿™æ—¶çš„ <code>ç™»é™†</code> å’Œ <code>æ³¨å†Œ</code>å°±æ˜¯é¦–é¡µçš„ <font color='red'>å­è·¯ç”±</font></p><p>å®ç° <strong>å­è·¯ç”±</strong> éœ€è¦åœ¨å®ä¾‹åŒ–è·¯ç”±å¯¹è±¡ä¸­ä½¿ç”¨ <strong>children</strong> å®ç°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue-router.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>è¿™é‡Œæ˜¯é¦–é¡µï¼Œæœ‰ç™»é™†å’Œæ³¨å†Œä¸¤ä¸ªåŠŸèƒ½<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/index/login&quot;</span>&gt;</span>ç™»é™†<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/index/regis&quot;</span>&gt;</span>æ³¨å†Œ<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;roor&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/index&quot;</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> index = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;#index&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> login = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;ç™»é™†çš„ç»„ä»¶&lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> regis = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;æ³¨å†Œçš„ç»„ä»¶&lt;/font&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">routes</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123; </span></span><br><span class="line"><span class="language-javascript">     <span class="attr">path</span>: <span class="string">&quot;/index&quot;</span>, <span class="attr">component</span>: index,</span></span><br><span class="line"><span class="language-javascript">     <span class="attr">children</span>: [</span></span><br><span class="line"><span class="language-javascript">      &#123; <span class="attr">path</span>: <span class="string">&quot;login&quot;</span>, <span class="attr">component</span>:login &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#123; <span class="attr">path</span>: <span class="string">&quot;regis&quot;</span>, <span class="attr">component</span>:regis &#125;</span></span><br><span class="line"><span class="language-javascript">     ]</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   ]</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#roor&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">router</span>: router</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨è·¯ç”±åµŒå¥—æ—¶éœ€è¦æ³¨æ„ï¼š</p><ul><li>children ä¸­çš„å­è·¯ç”±çš„ä¸­çš„ path ä¸èƒ½ä»¥ / å¼€å¤´ï¼Œä»¥ / å¼€å¤´é»˜è®¤åŒ¹é…çš„æ ¹ç›®å½•</li></ul><h3 id="è§†å›¾å‘½å">è§†å›¾å‘½å</h3><p>åœ¨ vue çš„è·¯ç”±ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªç»„ä»¶æ˜¾ç¤ºåœ¨æŸä¸€ä¸ªé¡µé¢ä¸Šï¼Œå¦‚æœä¸¤ä¸ªç»„ä»¶åŒ¹é…äº†åŒä¸€ä¸ªè·¯å¾„ï¼ŒåŒæ—¶å½“å‰è·¯å¾„ä¸­æœ‰ä¸¤ä¸ª router-viewï¼Œé‚£ä¹ˆå¤„ç†æ–¹æ³•å°±æ˜¯ï¼š</p><ol><li>å°†ç›¸åŒè·¯å¾„çš„ç»„ä»¶æ”¾åœ¨ components ä¸­ï¼Œä¸ºæ¯ä¸ªç»„ä»¶å‘½å</li><li>é€šè¿‡è§†å›¾ä¸­çš„ name  å±æ€§æ¥åŒºåˆ†æ˜¾ç¤ºçš„ç»„ä»¶</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue-router.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å¦‚æœä¸æŒ‡å®šnameï¼Œé‚£ä¹ˆé»˜è®¤æ˜¾ç¤ºdefault --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">name</span>=<span class="string">&quot;com2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com1 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h2 style=&#x27;color: red&#x27;&gt;ç»„ä»¶ 1&lt;h2&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> com2 = &#123;  <span class="attr">template</span>: <span class="string">&quot;&lt;h2 style=&#x27;color: red&#x27;&gt;ç»„ä»¶ 2&lt;h2&gt;&quot;</span>  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">routes</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123; </span></span><br><span class="line"><span class="language-javascript">     <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// å·¦ä¾§ä¸ºç»„ä»¶å‘½åï¼Œåœ¨å³ä¾§æŒ‡å®šç›®æ ‡ç»„ä»¶ï¼Œdefaultè¡¨ç¤ºé»˜è®¤å€¼</span></span></span><br><span class="line"><span class="language-javascript">      <span class="string">&quot;default&quot;</span>: com1,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&quot;/&quot;</span>: com2</span></span><br><span class="line"><span class="language-javascript">     &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   ]</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">router</span>: router</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç¼–ç¨‹å¼å¯¼èˆª">ç¼–ç¨‹å¼å¯¼èˆª</h3><p>ä¸€èˆ¬åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½å®Œå…¨ä¾é  <code>&lt;router-link /&gt;</code> æ ‡ç­¾è¿›è¡Œè·¯ç”±è·³è½¬çš„ï¼Œå½“é€»è¾‘ä»£ç æ‰§è¡Œå®Œæˆåå¯èƒ½ä¼šæœ‰ä¸€ä¸ªè·³è½¬åŠŸèƒ½ï¼Œä¾‹å¦‚ç™»é™†æˆåŠŸåä¼šè·³è½¬åˆ°ç½‘ç«™é¦–é¡µï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°ç¼–ç¨‹å¼å¯¼èˆªäº†</p><p>ç¼–ç¨‹å¼å¯¼èˆªæœ‰ä¸‰ä¸ªæ“ä½œç‚¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„ ä¸Šä¸€é¡µ</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>(-<span class="number">1</span>)</span><br><span class="line"><span class="comment">// ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„ ä¸‹ä¸€é¡µ</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// å°†é¡µé¢è·³è½¬åˆ°æŒ‡å®šå¯¼èˆªé¡µé¢</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="ç›‘å¬è·¯ç”±åœ°å€å˜åŒ–">ç›‘å¬è·¯ç”±åœ°å€å˜åŒ–</h3><p>ç›‘å¬å™¨æœ€å¼ºå¤§çš„åœ°æ–¹ä¸æ˜¯ç›‘å¬ data æ•°æ®ï¼Œè€Œæ˜¯ vue ä¸­ä»»ä½•æ•°æ®éƒ½å¯ä»¥è¢«ä»–ç›‘å¬ï¼Œä¾‹å¦‚è·¯ç”±ä¸­çš„åœ°å€</p><blockquote><p>$route ä¸­çš„ path å±æ€§å¯¹åº”çš„å°±æ˜¯è¯·æ±‚åœ°å€</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue-router.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;button&quot;</span>&gt;</span>ç™»é™†<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/regis&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;button&quot;</span>&gt;</span>æ³¨å†Œ<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> login = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;h2&gt;è¿™ä¸ªæ˜¯ç™»é™†çš„ç»„ä»¶&lt;/h2&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> regis = &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">template</span>: <span class="string">&quot;&lt;h2&gt;è¿™ä¸ªæ˜¯æ³¨å†Œçš„ç»„ä»¶&lt;/h2&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">routes</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: login &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123; <span class="attr">path</span>: <span class="string">&quot;/regis&quot;</span>, <span class="attr">component</span>: regis &#125;</span></span><br><span class="line"><span class="language-javascript">   ]</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> v = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">el</span>: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">router</span>: router,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;$route.path&quot;</span>( newVal, oldVal )&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="variable language_">console</span>.<span class="title function_">log</span>( oldVal + <span class="string">&quot; â†’ &quot;</span> + newVal )</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">   &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨ç›‘å¬ path å±æ€§çš„æ—¶å€™ï¼Œç”±äºæœ‰ä¸€ä¸ªç‚¹ <strong>.</strong> ä¸ºç‰¹æ®Šç¬¦å·ï¼Œæ‰€ä»¥è¦ç”¨å¼•å·å°†å…¶å¼•èµ·æ¥è§„é¿è¯­æ³•é”™è¯¯</li></ul><h2 id="vue-å¼‚æ­¥è¯·æ±‚">vue å¼‚æ­¥è¯·æ±‚</h2><p>å¼‚æ­¥è¯·æ±‚åˆå« Ajaxï¼Œæ˜¯æŒ‡åœ¨ä¸åˆ·æ–°ç½‘é¡µçš„å‰æä¸‹å‘åå°å‘é€è¯·æ±‚å¹¶è·å–åˆ°å“åº”æ•°æ®ï¼Œä»¥æ­¤æ¥åŠ å¼ºç”¨æˆ·ä½“éªŒ</p><h3 id="resource-è¯·æ±‚">resource è¯·æ±‚</h3><p>vue-resource çš„äº’è”ç½‘åœ°å€å¦‚ä¸‹ï¼Œå¯ä»¥ä¸‹è½½è‡³æœ¬åœ°å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js</span><br></pre></td></tr></table></figure><p>å‘èµ· get è¯·æ±‚çš„æ­¥éª¤ï¼Œæºå¸¦å‚æ•°ç›´æ¥åœ¨ url åé¢è·Ÿä¸Š ?key=value&amp;key=value å³å¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">get</span>(<span class="string">&#x27;URL&#x27;</span>).<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‘èµ· post è¯·æ±‚çš„æ­¥éª¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">post</span>(<span class="string">&#x27;URL&#x27;</span>, &#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">body</span>)</span><br><span class="line"> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="Vue-Cli-2-x-è„šæ‰‹æ¶">Vue-Cli 2.x è„šæ‰‹æ¶</h2><h3 id="å®‰è£…-vue-cli"><strong>å®‰è£… vue-cli</strong></h3><p>åœ¨æ§åˆ¶å°å…¨å±€å®‰è£… vue-cliï¼Œè¿™é‡Œéœ€è¦è¯´ä¸€ç‚¹å…³äºå®‰è£… vue æ—¶çš„ç‰ˆæœ¬é—®é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ä¸‹é¢è¿™æ®µä»£ç å®‰è£… vue-cli çš„ç‰ˆæœ¬æœ€é«˜ä¸ä¼šè¶…è¿‡ 3</span></span><br><span class="line">npm install vue-cli -g</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœæƒ³è¦ä½¿ç”¨ 3 ä»¥ä¸Šçš„ç‰ˆæœ¬è¯·æŒ‰ç…§ä¸‹é¢è¿™æ®µä»£ç è¿›è¡Œå®‰è£…</span></span><br><span class="line">npm install @vue/cli -g</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸåå¯ä»¥ä½¿ç”¨ <code>vue -V</code> æ¥æŸ¥è¯¢ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œ -V çš„ V ä¸€å®šè¦æ˜¯å¤§å†™å­—æ¯</p><h3 id="é¡¹ç›®åˆ›å»ºæµç¨‹">é¡¹ç›®åˆ›å»ºæµç¨‹</h3><p>åˆ›å»ºé¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨ cmd æ‰“å¼€å½“å‰ç›®å½•ï¼Œè¾“å…¥ <font color="red">vue init webpack é¡¹ç›®å</font> å¼€å§‹åˆ›å»º</p><blockquote><p>ä¸Šè¿°æŒ‡ä»¤ä¸­é¡¹ç›®åå¯ä»¥çœç•¥ä¸å†™ï¼Œé»˜è®¤ä»¥å½“å‰æ‰€åœ¨çš„æ–‡ä»¶å¤¹çš„åç§°ä½œä¸ºé¡¹ç›®å</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦åœ¨åœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆé¡¹ç›®ï¼Ÿ</span></span><br><span class="line">? Generate project in current directory? (Y/n)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¡¹ç›®åç§°ï¼Œæœ€å¥½ä¸è¦æœ‰å¤§å†™å­—æ¯ï¼Œä¸ç„¶ä¼šæŠ¥é”™</span></span><br><span class="line">? Project name (vuecli1)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¡¹ç›®æè¿°</span></span><br><span class="line">? Project description (A Vue.js project)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½œè€…</span></span><br><span class="line">? Author</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªé€‰æ‹©ç¬¬ä¸€ä¸ªé»˜è®¤ï¼Œæ˜¾ç¤ºstandaloneå³å¯</span></span><br><span class="line">? Vue build </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦å®‰è£…vueè·¯ç”±ï¼Œå¦</span></span><br><span class="line">? Install vue-router? (Y/n)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦ä½¿ç”¨ESLintå¯¹ä»£ç è¿›è¡Œlint  å¦</span></span><br><span class="line">? Use ESLint to lint your code? (Y/n)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦è®¾ç½®å•å…ƒæµ‹è¯•  å¦</span></span><br><span class="line">? Set up unit tests (Y/n)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦å®‰è£…e2e  å¦</span></span><br><span class="line">? Setup e2e tests with Nightwatch?</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦ä¸ºæ‚¨è¿è¡Œ<span class="string">&quot;npm install&quot;</span>å‘½ä»¤å®‰è£…ä¾èµ– æ˜¯</span></span><br><span class="line">Should we run `npm install` for you after the project has been created?</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºå®Œæˆåè¿è¡Œé¡¹ç›®ï¼šnpm run devï¼Œç¼–è¯‘è¿è¡Œåä¾¿å¯ä»¥åœ¨ localhost:8080 è®¿é—®å½“å‰é¡¹ç›®äº†</p></blockquote><h3 id="é¡¹ç›®é…ç½®ä¿®æ”¹">é¡¹ç›®é…ç½®ä¿®æ”¹</h3><ul><li><p>ä¿®æ”¹é¡¹ç›®è¿è¡Œç«¯å£å·ï¼š</p><p>åœ¨å½“å‰é¡¹ç›®ä¸‹çš„ config ç›®å½•ä¸‹çš„ index.js æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ° port ä¿®æ”¹ä¸ºæŒ‡å®šçš„ç«¯å£å·</p></li></ul><h3 id="ä½¿ç”¨è·¯ç”±ç»„ä»¶">ä½¿ç”¨è·¯ç”±ç»„ä»¶</h3><p>åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œæ˜¯å¦ä½¿ç”¨è·¯ç”±çš„é€‰é¡¹é€‰æ‹©æ˜¯ï¼Œè¿™æ · vue å°±ä¼šè‡ªåŠ¨å°†è·¯ç”±å®‰è£…å¹¶é…ç½®å®Œæˆäº†ï¼Œå¦‚æœæ²¡æœ‰é€‰æ‹©å®‰è£…ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼Œåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ§åˆ¶å°è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¯ä»¥å®‰è£…è·¯ç”±</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router --save</span><br></pre></td></tr></table></figure><p>åœ¨è·¯ç”±å®‰è£…å®Œæˆä¹‹åï¼Œæ–°å»ºä¸€ä¸ª js æ–‡ä»¶ä½œä¸ºè·¯ç”±çš„é…ç½®æ–‡ä»¶ï¼Œæš‚ä¸”å‘½åä¸º router.jsï¼Œåœ¨é‡Œé¢è¿›è¡Œç¯å¢ƒæ­å»º</p><blockquote><p>éœ€è¦ä½¿ç”¨ import å¼•ç”¨ vue å’Œ vue-router ç»„ä»¶å¹¶ä½¿ç”¨æ‰æ˜¯è·¯ç”±é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">&#x27;@/components/hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/hello&quot;</span>, <span class="attr">component</span>: hello &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å°†æ–‡ä»¶é…ç½®å®Œæˆä¹‹ååœ¨ main.js ä¸­å°†è·¯ç”±é…ç½®è¿›æ¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./coms/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="string">&quot;app&quot;</span>: <span class="title class_">App</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">router</span>: router,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&quot;&lt;app&gt;&lt;/app&gt;&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é¡µé¢é»˜è®¤æ˜¾ç¤ºçš„ä½ç½®æ·»åŠ ä¸Š <code>&lt;router-view /&gt;</code> æ ‡ç­¾å³å¯</p><h3 id="Axios-è¯·æ±‚">Axios è¯·æ±‚</h3><p>resource åœ¨ vue 2.0 ä¹‹åå°±åœæ­¢æ›´æ–°å’Œç»´æŠ¤äº†ï¼Œæ‰€ä»¥æ‰æœ‰äº† Axiosï¼Œå®ƒçš„äº’è”ç½‘åœ°å€å¦‚ä¸‹ï¼Œå¯ä»¥ä¸‹è½½æœ¬åœ°å¼•ç”¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://unpkg.com/axios@0.19.2/dist/axios.min.js</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ axiox è°ƒç”¨ get æˆ– post æ–¹æ³•å‘èµ·ç›¸åº”çš„è¯·æ±‚ï¼Œå…¶ä¸­ï¼š</p><ul><li>.then æ˜¯å›è°ƒå‡½æ•°ï¼Œresult æ˜¯è¯·æ±‚åçš„ç›¸åº”æ•°æ®ï¼Œåœ¨å‡½æ•°ä½“å†…å¯¹æ•°æ®è¿›è¡Œæ“ä½œ</li><li>.catch æ˜¯å¼‚å¸¸å‡½æ•°ï¼Œå½“è¯·æ±‚å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™å›è°ƒç”¨è¯¥å‡½æ•°è¿›è¡Œå–„åå·¥ä½œ</li></ul><p>GET è¯·æ±‚æ“ä½œï¼š</p><blockquote><p>get è¯·æ±‚ä¼ è¾“å‚æ•°çš„æ—¶å€™ç›´æ¥åœ¨ url åé¢è·Ÿä¸Š ?key=value&amp;key=value å³å¯</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;URL&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">response</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å‡ºéŒ¯äº†ï¼Œï¼Œï¼Œ&quot;</span>)</span><br><span class="line"> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>POST è¯·æ±‚æ“ä½œï¼š</p><blockquote><p>post è¯·æ±‚æºå¸¦å‚æ•°éœ€è¦åœ¨å‚æ•°åˆ—è¡¨ä¼ å…¥ä¸€ä¸ª jsonï¼Œé€šè¿‡ json æºå¸¦å‚æ•°</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">post</span>(<span class="string">&#x27;URL&#x27;</span>, &#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>,<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"> result </span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"> &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params"> error </span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line"> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="vue-æ‰©å±•ç¨‹åº">vue æ‰©å±•ç¨‹åº</h2><p>ç™¾åº¦ä¸‹è½½è°·æ­Œæ‰©å±•ç¨‹åº <code>vue-devtools</code>ä¸‹è½½ï¼Œç„¶åå°†æ‰©å±•åæ”¹æˆ <code>.zip</code> çš„å‹ç¼©æ–‡ä»¶å¹¶å°†å…¶è§£å‹ï¼Œå¾—åˆ°æ–‡ä»¶ï¼š</p><p>&lt;/img src=â€œ.//img/vue-05.pngâ€ /&gt;</p><p>å°†æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªä¸ä¼šè¢«æ”¹å˜çš„ä½ç½®ï¼Œç„¶åæ‰“å¼€ Google æµè§ˆå™¨å³ä¸Šè§’çš„è®¾ç½®ï¼Œæ›´å¤šå·¥å…·ï¼Œæ‰©å±•ç¨‹åº</p><p>&lt;/img src=â€œ.//img/vue-06.pngâ€ /&gt;</p><p>ç´§æ¥ç€ç‚¹å‡»å¼€å¯æ‰©å±•ç¨‹åºé¡µé¢å³ä¸Šè§’çš„ <code>å¼€å‘è€…æ¨¡å¼</code> ï¼Œç„¶åå¤šå‡ºæ¥ä¸‰ä¸ªé€‰é¡¹ï¼Œç‚¹å‡» <code>åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº</code>ï¼Œæ‰¾åˆ°ä¹‹å‰å­˜æ”¾æ‰©å±•ç¨‹åºçš„ä½ç½®å³å¯æ·»åŠ æˆåŠŸ</p><p><font color="red">æƒ³ä½¿ç”¨vueå¢å¼ºå·¥å…·éœ€è¦ç¼–è¾‘vue.jsæ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„ <code>devtools:Â !1</code>Â ä¸­çš„ ï¼åˆ é™¤ï¼Œå¦åˆ™å·¥å…·å¯èƒ½ä¼šå¤±æ•ˆ</font></p><p>&lt;/img src=â€œ.//img/vue-07.pngâ€ /&gt;</p><p>vue-devtools çš„æ­£å¸¸å·¥ä½œæˆªå›¾ <strong>â†“</strong></p><p>&lt;/img src=â€œ.//img/vue-08.pngâ€ /&gt;</p><h3 id="vuexçŠ¶æ€ç®¡ç†">vuexçŠ¶æ€ç®¡ç†</h3><p>ä¸€èˆ¬æˆ‘ä»¬åœ¨å†™ç™»é™†é¡µé¢çš„æ—¶å€™ï¼Œç™»é™†æˆåŠŸä¼šå°†ç›¸å…³å…¨å±€ä¿¡æ¯æ”¾åœ¨ session ä¸­è¿›è¡Œä¿ç®¡ï¼Œvuex å°±æ˜¯ç›¸å½“äº session çš„ä¸€ä¸ªæŠ€æœ¯ï¼Œç”¨æ¥å­˜æ”¾å…¨å±€çš„å˜é‡</p><h4 id="vuex-ç®€å•å®ä¾‹">vuex ç®€å•å®ä¾‹</h4><ol><li>å®‰è£… vuex çŠ¶æ€ç®¡ç†ï¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex --save</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨å®‰è£…å®Œæˆä¹‹åï¼Œåœ¨é¡¹ç›®ä¸­åˆ›å»º vuex çš„ js æ–‡ä»¶å¹¶é…ç½®ï¼š</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;vuexä¸­çš„æ•°æ®&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ä¸è¦å¿˜è®°å°†æ–‡ä»¶å¼•å…¥åˆ° main.js ä¸­</p></blockquote><ol start="3"><li>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ vuex ä¸­å®šä¹‰çš„æ•°æ®</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¸éœ€è¦å†ç»„ä»¶ä¸­è¿›è¡Œå¤šä½™æ“ä½œï¼Œç›´æ¥é€šè¿‡$storeå¼•ç”¨å°±å¯ä»¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;$store.state.msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="state-çŠ¶æ€å¯¹è±¡">state çŠ¶æ€å¯¹è±¡</h4><p>åœ¨ store.js ä¸­å®šä¹‰å…¨å±€å˜é‡çš„æ—¶å€™å¯ä»¥å‘ç°ï¼Œå˜é‡éƒ½æ˜¯å®šä¹‰åœ¨ state ä¸­çš„ï¼Œstate æ˜¯çŠ¶æ€å¯¹è±¡ï¼Œæ‰€æœ‰å˜é‡éƒ½ä¼šæ”¾åœ¨state ä¸­è¿›è¡Œå­˜æ”¾</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;vuexä¸­çš„æ•°æ®&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å°† store.js å¼•ç”¨åˆ° mainj.js åï¼Œvuex å°±å¯ä»¥å…¨å±€ä½¿ç”¨äº†ï¼Œè·å– vuex ä¸­æ•°æ®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨é¡µé¢ä¸­è·å–æ•°æ®</span></span><br><span class="line">&#123;&#123;$store.<span class="property">state</span>.<span class="property">msg</span>&#125;&#125;</span><br><span class="line"><span class="comment">// åœ¨ç»„ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">msg</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>store.state.name</code> å¯ä»¥è·å–åˆ° state ä¸­å­˜æ”¾çš„æ•°æ®ï¼Œä½†æ˜¯è¿™æ ·ä¸€æ¥å‰ç¼€æœ‰ç‚¹å¤ªå¤šäº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è®¡ç®—å±æ€§å°† state æ¥å­˜å‚¨èµ·æ¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="title function_">state</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä»¥åæƒ³è¦è°ƒç”¨ vuex ä¸­çš„ msg å°±ç›´æ¥ä½¿ç”¨ <code>state.msg</code> å°±å¯ä»¥äº†</p><h4 id="mutations-ä¿®æ”¹çŠ¶æ€">mutations ä¿®æ”¹çŠ¶æ€</h4><p>åœ¨ state ä¸­å¯ä»¥å­˜æ”¾å˜é‡ï¼Œé‚£ä¹ˆé’ˆå¯¹å˜é‡è¿›è¡Œä¿®æ”¹ä¹Ÿä¸€å®šæ˜¯å¯ä»¥çš„ï¼Œvuex ä¸­é™¤äº†æœ‰ state ä¹‹å¤–è¿˜æœ‰ mutationsï¼Œä»–ç”¨æ¥å­˜å‚¨å…¬å…±çš„å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨å‡½æ•°æ¥å¯¹ state ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹</p><p>åœ¨ mutations ä¸­å®šä¹‰æ–¹æ³•ï¼Œå°† state ä½œä¸ºå‚æ•°ç©¿è¿›å»ï¼Œé€šè¿‡ state æ¥å¯¹å˜é‡è¿›è¡Œä¿®æ”¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">setCount</span>(<span class="params"> state </span>)&#123;</span><br><span class="line">            state.<span class="property">count</span> ++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ–¹æ³•å®šä¹‰å®Œæˆä¹‹åéœ€è¦åœ¨é¡µé¢ä¸­å¼•ç”¨ï¼Œåœ¨ç»„ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œåˆ›å»ºäº‹ä»¶è°ƒç”¨è¯¥æ–¹æ³•</p><blockquote><p>$store ä¸­çš„ commit ä»£è¡¨è¦è°ƒç”¨æ–¹æ³•ï¼Œç„¶åå°†æƒ³è¦è°ƒç”¨çš„æ–¹æ³•çš„åç§°ä½œä¸ºå‚æ•°ä¼ è¿‡å»å³å¯</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;&#123;state.msg&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;setCount&#x27;)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœåœ¨å®šä¹‰æ–¹æ³•çš„æ—¶å€™éœ€è¦æ¥å—å‚æ•°ï¼Œä¾‹å¦‚ <code>setCount( state, number )</code>ï¼Œå‚æ•°éœ€è¦è·Ÿåœ¨æ–¹æ³•åçš„åé¢</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;&#123;state.msg&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;setCount&#x27;, 123)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="axios-å¼‚æ­¥è¯·æ±‚">axios å¼‚æ­¥è¯·æ±‚</h3><p>åœ¨è„šæ‰‹æ¶ä¸­ä½¿ç”¨ axios å¼‚æ­¥è¯·æ±‚ï¼Œé¦–å…ˆè¦åœ¨å½“å‰é¡¹ç›®ä¸‹å®‰è£…è¯·æ±‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios --save</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é¡¹ç›®ä¸­åŠ ä»¥ä½¿ç”¨ï¼Œæ³¨æ„åœ¨ä½¿ç”¨çš„æ—¶å€™æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ mian.js ä¸­</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// æŒ‚åœ¨åˆ°vueå®ä¾‹åŸå‹</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">axios</span> = axios</span><br></pre></td></tr></table></figure><p>å½“æŠŠ axios æŒ‚è½½åˆ°å®ä¾‹åŸå‹åï¼Œå°±å¯ä»¥åœ¨å®ä¾‹ä¸­ç›´æ¥ä½¿ç”¨ <code>this.axios</code> è¿›è¡Œè°ƒç”¨ä½¿ç”¨äº†</p><p><font color="red"><strong># æ³¨æ„ï¼</strong></font>åœ¨ vue-cli å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„ä¼šäº§ç”Ÿè·¨åŸŸè¯·æ±‚ï¼Œä½†æ˜¯è·¨åŸŸè¯·æ±‚åœ¨ post è¯·æ±‚æºå¸¦å‚æ•°æ—¶ä¼šå‡ºé—®é¢˜ï¼Œè¿™æ—¶å€™éœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªä¾èµ–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install qs --save</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$qs</span> = qs;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ä¼ å…¥å‚æ•°æ—¶ä½¿ç”¨ qs å¯¹å‚æ•°è¿›è¡Œè§£æ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">post</span>( (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">server_url</span>+<span class="string">&quot;user/login&quot;</span>),</span><br><span class="line"> <span class="variable language_">this</span>.<span class="property">$qs</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">  <span class="string">&#x27;userId&#x27;</span>: this_.<span class="property">login</span>.<span class="property">username</span>,</span><br><span class="line">  <span class="string">&#x27;userPwd&#x27;</span>: this_.<span class="property">login</span>.<span class="property">password</span></span><br><span class="line"> &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis ç¬”è®°</title>
    <link href="/2022/10/19/Redis%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/10/19/Redis%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>Redis ç¬”è®°</h1><p>redis æ˜¯ä¸€æ¬¾ NoSQL æ•°æ®åº“ï¼Œæ˜¯æœ€å¸¸è§çš„ä¸€æ¬¾éå…³ç³»å‹æ•°æ®åº“ï¼Œä¸»è¦ä½¿ç”¨ key - value çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œå’Œ mysql ä¸åŒï¼Œredis å¹¶ä¸ä¼šç›´æ¥æŠŠæ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿæ­£æ˜¯è¿™æ ·çš„è®¾å®šè®© redis çš„å­˜å–æ“ä½œç‰¹åˆ«çš„å¿«ã€‚</p><h2 id="Redis-çš„ä¸‹è½½åŠå®‰è£…">Redis çš„ä¸‹è½½åŠå®‰è£…</h2><blockquote><p>redis çš„ä¸‹è½½</p></blockquote><p>é¦–å…ˆè¦å» redis çš„å®˜ç½‘ä¸‹è½½ä»–çš„å‹ç¼©åŒ…ï¼Œå®˜ç½‘ [ ä¸­æ–‡ ] ç›´è¿åœ°å€å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.redis.cn/</span><br></pre></td></tr></table></figure><p>è¿›å…¥å®˜ç½‘åç›´æ¥ä¸‹è½½å³å¯ï¼Œç„¶åè¿œç¨‹è¿æ¥ æœåŠ¡å™¨/è™šæ‹Ÿæœº å°†ä¸‹è½½å¥½çš„æ–‡ä»¶ä¸Šä¼ è‡³ <code>/usr/local</code> ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥åˆ°usr/localç›®å½•</span></span><br><span class="line">cd /usr/local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šä¼ æ–‡ä»¶åï¼Œæ‰§è¡Œè§£å‹å‘½ä»¤</span></span><br><span class="line">tar -zxvf redis-5.0.5.tar.gz</span><br></pre></td></tr></table></figure><blockquote><p>redis çš„å®‰è£…</p></blockquote><p>åœ¨æ‰§è¡Œå®‰è£…å‘½ä»¤ä¹‹å‰ï¼Œé¦–é€‰éœ€è¦å®‰è£… gcc çš„ä¾èµ–ï¼Œå¦‚å·²å®‰è£…è¯·å¿½ç•¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ‡æ¢åˆ° redis ç›®å½•ä¸‹å¼€å§‹æ‰§è¡Œå®‰è£…å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢ç›®å½•åˆ°redisä¸‹</span></span><br><span class="line">cd redis-5.0.5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡Œå®‰è£…å‘½ä»¤</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œå®‰è£…å°±é¡ºåˆ©ç»“æŸäº†ï¼Œå¦‚æœæç¤º -bash: make: command not found åˆ™ä»£è¡¨ gcc æ²¡æœ‰è£…ï¼Œéœ€è¦é‡æ–°å®‰è£… gcc ç¯å¢ƒ</p><blockquote><p>redis çš„é…ç½®</p></blockquote><p>å®é™…ä¸Šè¿™ä¸ªæ—¶å€™ redis å·²ç»å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œè¿è¡Œ redis çš„å‘½ä»¤ä¸º <code>redis-server</code>ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¿è¡Œçš„æ—¶å€™ä¼šå‘ç°ï¼Œredis ç›´æ¥å°†çª—å£é”å®šäº†ï¼Œæˆ‘ä»¬ä¸èƒ½è¿›è¡Œä»»ä½•çš„æ“ä½œï¼Œä¸€æ—¦è§£é”ä¹Ÿå°±æ„å‘³ç€ redis åœæ­¢å·¥ä½œäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">19196:C 15 Jun 2020 22:13:31.574 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">19196:C 15 Jun 2020 22:13:31.574 <span class="comment"># Redis version=5.0.8, bits=64, commit=0000</span></span><br><span class="line">0000, modified=0, pid=19196, just started</span><br><span class="line">19196:C 15 Jun 2020 22:13:31.574 <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span></span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ <span class="string">&#x27;&#x27;</span>-._                                             </span><br><span class="line">      _.-``    `.  `_.  <span class="string">&#x27;&#x27;</span>-._           Redis 5.0.8 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">&#x27;&#x27;</span>-._                                   </span><br><span class="line"> (    <span class="string">&#x27;      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="string">&#x27;|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 19196</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |           http://redis.io        </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |                                  </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line">      `-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>                                       </span><br><span class="line">          `-._        _.-<span class="string">&#x27;                                           </span></span><br><span class="line"><span class="string">              `-.__.-&#x27;</span>                                               </span><br><span class="line"></span><br><span class="line">19196:M 15 Jun 2020 22:13:31.575 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">19196:M 15 Jun 2020 22:13:31.575 <span class="comment"># Server initialized</span></span><br><span class="line">..................</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬éœ€è¦å¯¹é…ç½®æ–‡ä»¶åšä¸€äº›æ‰‹è„š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># å»ºè®®å¼„ä¸ªå¤‡ä»½ï¼Œç©å„¿å¤‡ä»½å°±å¥½ï¼Œredis çš„é…ç½®æ–‡ä»¶è¿˜æ˜¯å¾ˆé‡è¦çš„</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line">cp redis.conf /root/redis.conf</span><br><span class="line">cd /root</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘é…ç½®æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">vim redis.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ä¸ºdaemonizeä¸º<span class="built_in">yes</span>ï¼Œå¯ä»¥åå°è¿è¡Œ redisï¼Œå¦åˆ™ä¼šé”å®šå‘½ä»¤è¡Œ</span></span><br><span class="line">daemonize yes</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œ redis å¹¶åˆ›å»ºè¿æ¥</p></blockquote><p>é¦–å…ˆæˆ‘ä»¬æ¥è¿è¡ŒæœåŠ¡ç«¯ <code>redis-sever</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œè¦æŒ‡å®šé…ç½®æ–‡ä»¶è¿›è¡Œå¯åŠ¨ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šä»¥é»˜è®¤é…ç½®æ‰§è¡Œï¼Œè¿˜æ˜¯ä¼šé”å®šå½“å‰çª—å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æ‰§è¡Œï¼Œä¼šé”å®šçª—å£</span></span><br><span class="line">redis-server</span><br><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶æ‰§è¡Œï¼Œå’±ä»¬é…ç½®äº†åå°è¿è¡Œï¼Œä¸ä¼šé”å®šçª—å£</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"><span class="comment">## å‡ºç°ä¸‹é¢è¿™å †ä¸œè¥¿å°±ä»£è¡¨æ‰§è¡ŒæˆåŠŸäº† ##</span></span><br><span class="line">19203:C 15 Jun 2020 22:15:09.851 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">19203:C 15 Jun 2020 22:15:09.851 <span class="comment"># Redis version=5.0.8, bits=64, commit=00000000, modified=0, pid=19203, just started</span></span><br><span class="line">19203:C 15 Jun 2020 22:15:09.851 <span class="comment"># Configuration loaded</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å¯åŠ¨å®¢æˆ·ç«¯ <code>redis-cli</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœç›´æ¥è¾“å…¥åˆ™é»˜è®¤è¿æ¥æœ¬åœ°çš„6379ç«¯å£</span></span><br><span class="line">redis-cli</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°æ¥æŒ‡å®šç›®æ ‡IPåœ°å€æˆ–ç«¯å£å·</span></span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>å°è¯•è¾“å…¥ä¸€ä¸ª ping å‘½ä»¤ï¼Œæµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœè¿”å› PONG å°±è¯æ˜ä¸€åˆ‡æ­£å¸¸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; PING</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><blockquote><p>å…³é—­ redis</p></blockquote><p>å¦‚æœä¸æ—¶ç”¨ä»»ä½•é…ç½®è®©ä»–é»˜è®¤å¯åŠ¨çš„è¯ï¼Œç›´æ¥ Ctrl + C å°±å¯ä»¥å…³é—­ redisï¼Œé‚£ä¹ˆåå°è¿è¡Œåº”è¯¥æ€ä¹ˆå…³ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡åï¼Œæ‰§è¡Œå…³é—­å‘½ä»¤å³å¯</span></span><br><span class="line">127.0.0.1:6379&gt; shutdown</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥åœ¨ä¸è¿æ¥çš„æƒ…å†µä¸‹ç›´æ¥é€šè¿‡redis-cliæ‰§è¡Œå…³é—­å‘½ä»¤</span></span><br><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®è®¿é—®å¯†ç ">è®¾ç½®è®¿é—®å¯†ç </h2><p>æˆ‘ä»¬åˆšåˆšæˆåŠŸè¿æ¥åˆ°äº† redis æœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä»…ä»…æ˜¯æœ¬åœ°çš„ï¼Œæˆ‘ä»¬ç›®å‰å¹¶ä¸èƒ½å¤Ÿè¿œç¨‹ ip åœ°å€ç›´æ¥è®¿é—®ï¼Œå› ä¸ºæˆ‘ä»¬çš„ redis é»˜è®¤å¼€å¯äº†ä¿æŠ¤æ¨¡å¼ï¼Œå°†æ¥æˆ‘ä»¬çš„é¡¹ç›®æ˜¯è¦è·‘åœ¨ç½‘ç»œä¸Šè¦ç”¨ java ä»£ç æ“ä½œçš„ï¼Œæƒ³è¦è¿œç¨‹è¿æ¥å¿…é¡»è¦å…ˆè®¾ç½®å¯†ç ï¼</p><blockquote><p>ä¸´æ—¶è®¾ç½®å¯†ç </p></blockquote><p>ä¸ºäº†å¯ä»¥è¿œç¨‹æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªä¸´æ—¶çš„å¯†ç ï¼Œè¿æ¥ä¸Š redis å®¢æˆ·ç«¯ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å¯†ç </span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> requirepass 123456</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># è®¾ç½®å¯†ç æ˜¯å®æ—¶çš„ï¼Œéœ€è¦ç™»å½•æ‰å¯ä»¥è¿›è¡Œæ“ä½œ</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line"><span class="comment"># éªŒè¯rediså¯†ç </span></span><br><span class="line">127.0.0.1:6379&gt; auth 123456</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># è·å–å¯†ç </span></span><br><span class="line">127.0.0.1:6379&gt; config get requirepass</span><br><span class="line">1) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line">2) <span class="string">&quot;zhang&quot;</span></span><br><span class="line"><span class="comment"># å–æ¶ˆä¹‹å‰è®¾ç½®çš„å¯†ç ï¼Œç•™ç©ºå³å¯</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> requirepass <span class="string">&#x27;&#x27;</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªä¸´æ—¶çš„å¯†ç å°±è®¾ç½®æˆåŠŸäº†ï¼Œåªè¦ redis å§‹ç»ˆä¿æŒæ­£å¸¸è¿è¡Œï¼Œç§˜å¯†æ˜¯ä¸ä¼šå¤±æ•ˆçš„</p><blockquote><p>è®¾ç½®æ°¸ä¹…æ€§å¯†ç </p></blockquote><p>å¦‚æœè§‰å¾—ä¸´æ—¶å¯†ç å¹¶ä¸èƒ½å¤Ÿæ»¡è¶³ä½ çš„å®‰å…¨æ„Ÿï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è®¾ç½®å¯†ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨redis.confä¸­æ‰¾åˆ°requirepassç„¶ååœ¨åé¢è¿½åŠ å¯†ç ï¼Œé‡å¯rediså³å¯</span></span><br><span class="line">requirepass ä½ çš„å¯†ç </span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶è®²è§£">é…ç½®æ–‡ä»¶è®²è§£</h2><p>å­¦ä¹  redis æœ€å¥½æ˜¯è·Ÿç€å®˜æ–¹æ–‡æ¡£èµ°ï¼Œè®°ç¬”è®°åªæ˜¯ä¸ºäº†è®©è‡ªå·±æ›´åŠ ç†Ÿç»ƒï¼Œæ¨è redis ä¸­æ–‡ç½‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.redis.net.cn/order/</span><br></pre></td></tr></table></figure><p>åˆšåˆšåœ¨å®‰è£… redis çš„æ—¶å€™ç®€å•ä¿®æ”¹äº†ä¸€ä¸‹ daemonize å±æ€§çš„å€¼ï¼Œè®©ä»–å¯ä»¥ä¸é”å®šå½“å‰å‘½ä»¤è¡Œä¸”åå°è¿è¡Œï¼Œredis æœ‰å¾ˆå¤šéœ€è¦äº†è§£çš„å¸¸è§„æ€§é…ç½®ï¼Œè¿™é‡Œå¤§æ¦‚è®°ä¸ªç¬”è®°ï¼š</p><p>redis çš„é…ç½®æ–‡ä»¶ä¸­æ³¨é‡Šéå¸¸å¤šï¼Œå®˜æ–¹å¾ˆå‹å¥½çš„å°†æ¨¡å—åˆ’åˆ†å¼€æ¥ï¼Œè¿™é‡Œå°±è®°å‡ ä¸ªæˆ‘ä¸ªäººè§‰å¾—å¸¸ç”¨çš„é…ç½®</p><blockquote><p>######################## NETWORK ######################## ç½‘ç»œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### ç»‘å®šå®¢æˆ·ç«¯IP</span></span><br><span class="line"><span class="comment"># å¦‚æœéœ€è¦è¿œç¨‹è¿æ¥redisçš„è¯ï¼Œè¦ä¹ˆåœ¨è¿™é‡Œæ·»åŠ ä½ çš„IPåœ°å€ï¼Œè¦ä¹ˆå°†è¿™å¥è¯æ³¨é‡Šæ‰</span></span><br><span class="line"><span class="comment"># æ³¨é‡Šæ‰ä¹‹åï¼Œæ‰€æœ‰çš„IPå°±éƒ½å¯ä»¥è®¿é—®äº†</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### ä¿æŠ¤æ¨¡å¼</span></span><br><span class="line"><span class="comment"># redisæ²¡æœ‰è®¾ç½®è®¿é—®å¯†ç çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå¼€å¯äº†ä¿æŠ¤æ¨¡å¼å°±ä¸èƒ½è¿œç¨‹è¿æ¥äº†</span></span><br><span class="line">protected-mode <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### å¯åŠ¨ç«¯å£å·ï¼Œä¸å¤šèµ˜è¿°</span></span><br><span class="line">port 6379</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´/s</span></span><br><span class="line"><span class="comment"># å½“å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯çš„æ—¶å€™ï¼Œè¶…å‡º n ç§’æ²¡æœ‰ä»»ä½•æ“ä½œå°±è‡ªåŠ¨åˆ‡æ–­è¿æ¥</span></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸º 0 ä»£è¡¨æ— è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="built_in">timeout</span> 0</span><br></pre></td></tr></table></figure><blockquote><p>######################## GENERAL ######################## å¸¸ç”¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªå°±æ˜¯ä¹‹å‰è®¾ç½®çš„åå°è¿è¡Œ</span></span><br><span class="line"><span class="comment"># å®ˆæŠ¤è¿›ç¨‹å°±æ˜¯Windowsç³»ç»Ÿä¸­çš„æœåŠ¡ï¼Œå°†redisä»¥æœåŠ¡çš„å½¢å¼è¿è¡Œ</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### PIDæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å¦‚æœå¼€å¯äº†å®ˆæŠ¤è¿›ç¨‹åå°è¿è¡Œredisï¼Œé‚£ä¹ˆè¿™ä¸ªå°±ä¸€å®šè¦æœ‰</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### æ—¥å¿—çº§åˆ«</span></span><br><span class="line"><span class="comment"># è®°å½•æ‰§è¡Œæ—¥å¿—æ—¶å¯é€‰æ‹©çš„è®°å½•çº§åˆ«ï¼Œé€‰é¡¹åˆ†åˆ«æœ‰ï¼š</span></span><br><span class="line"><span class="comment"># debugï¼Œverboseï¼Œnoticeï¼Œwarningï¼Œå…·ä½“æè¿°é…ç½®æ–‡ä»¶ä¸­æœ‰ï¼Œä¸€èˆ¬ä¸ç”¨è®¾ç½®è¿™ä¸ª</span></span><br><span class="line">loglevel notice</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### æ—¥å¿—æ–‡ä»¶åç§°</span></span><br><span class="line">logfile <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### é»˜è®¤æ•°æ®åº“ä¸ªæ•°</span></span><br><span class="line"><span class="comment"># å¯ä»¥åœ¨è¿™é‡Œæ‰‹åŠ¨å¯¹æ•°æ®åº“æ•°é‡è¿›è¡Œè®¾ç½®ï¼Œæˆ‘å°±æ”¹æˆ5ä¸ªå•¦ï¼Œé—²çš„æ²¡äº‹å„¿</span></span><br><span class="line">databases 16</span><br></pre></td></tr></table></figure><blockquote><p>######################## SECURITY ######################## å®‰å…¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### å¯†ç </span></span><br><span class="line"><span class="comment"># å®‰å…¨ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯å¯†ç è®¾ç½®äº†ï¼Œè®¿é—®æ•°æ®åº“å¿…é¡»è¦å¯†ç ï¼Œä¸ç„¶å°±ä¹±å¥—äº†</span></span><br><span class="line"><span class="comment"># é»˜è®¤æ˜¯æ³¨é‡Šçš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å¯†ç </span></span><br><span class="line">requirepass foobared</span><br></pre></td></tr></table></figure><h2 id="Redis-åŸºç¡€å‘½ä»¤">Redis åŸºç¡€å‘½ä»¤</h2><p>redis ä¸­ä¹Ÿæœ‰åº“çš„æ¦‚å¿µï¼Œåˆå§‹æ•°é‡ä¸º 16 ä¸ªï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼Œä»–æ˜¯æŒ‰ç…§ä» 0 å¼€å§‹çš„é€’å¢é¡ºåºå‘½åçš„ï¼Œå’Œ mysql ä¸åŒï¼Œredis ä¸æ”¯æŒä¸ºæŸä¸ªæ•°æ®åº“å•ç‹¬å‘½åï¼Œä¹Ÿä¸æ”¯æŒä¸ºæ¯ä¸ªæ•°æ®åº“è®¾ç½®å•ç‹¬çš„è®¿é—®å¯†ç ï¼Œé»˜è®¤æˆ‘ä»¬å¯åŠ¨ redis æ—¶ä½¿ç”¨çš„æ˜¯ç¬¬ 0 ä¸ªæ•°æ®åº“ã€‚</p><p>==åˆ‡æ¢æ•°æ®åº“==åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿåªéœ€è¦æ‰§è¡Œ select å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“æˆ‘ä»¬ä½¿ç”¨selectåˆ‡æ¢åˆ°å…¶ä»–æ•°æ®åº“çš„æ—¶å€™ï¼Œç«¯å£å·åé¢ä¼šæç¤ºå½“å‰ä½¿ç”¨æ•°æ®åº“ [1]ï¼Œé»˜è®¤åº“å°±ä¸ä¼šæç¤º</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="keyword">select</span> 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬å­¦ä¹  mysql çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ä½¿ç”¨ sql è¯­å¥å¯¹æ•°æ®è¿›è¡Œ CRUDï¼Œè€Œåœ¨ redis æˆ‘ä»¬éœ€è¦è®°çš„æ˜¯å‘½ä»¤</p><blockquote><p>éªŒè¯ç™»å½•å¯†ç </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; auth 123456</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><blockquote><p>æ•°æ®çš„ç®€å• CRUD</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setå‘½ä»¤ï¼Œå› ä¸ºkeyæ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥setæ—¢æ˜¯æ·»åŠ ï¼Œä¹Ÿæ˜¯ä¿®æ”¹ï¼Œå¦‚æœæœ‰ç©ºæ ¼éœ€è¦ç”¨åŒå¼•å·å¼•èµ·æ¥</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> user zhang</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># getå‘½ä»¤ï¼Œå°±æ˜¯æŸ¥è¯¢å–½</span></span><br><span class="line">127.0.0.1:6379&gt; get user</span><br><span class="line"><span class="string">&quot;zhang&quot;</span></span><br><span class="line"><span class="comment"># delå‘½ä»¤ï¼Œå°±æ˜¯åˆ é™¤å–½</span></span><br><span class="line">127.0.0.1:6379&gt; del user</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># åˆ é™¤ä¹‹åæŸ¥ä¸åˆ°äº†</span></span><br><span class="line">127.0.0.1:6379&gt; get user</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹å½“å‰åº“æ•°æ®æ€»è®¡æ•°</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰çš„ keyï¼Œ* ä»£è¡¨é€šé…ç¬¦</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">1) <span class="string">&quot;user&quot;</span></span><br><span class="line">2) <span class="string">&quot;sex&quot;</span></span><br><span class="line">3) <span class="string">&quot;name&quot;</span></span><br><span class="line">4) <span class="string">&quot;age&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ¸…ç©ºå½“å‰æ•°æ®åº“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; flushdb</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><blockquote><p>æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; flushall</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹å½“å‰åº“æ˜¯å¦å­˜åœ¨è¯¥ keyï¼Œåªè¦ä¸è¿”å› 0 å°±ä»£è¡¨å­˜åœ¨ï¼Œexists æ˜¯å¦å­˜åœ¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><blockquote><p>å°†å½“å‰åº“çš„æ•°æ®ç§»åŠ¨åˆ°å…¶ä»–åº“ move ç§»åŠ¨ï¼Œname ä¸º keyï¼Œ1 ä¸ºç›®æ ‡æ•°æ®åº“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; move name 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><blockquote><p>è®¾ç½®æ¶ˆäº¡æ—¶é—´ ( è¿‡æœŸæ—¶é—´ )ï¼Œexpire å•ä½/ç§’ï¼Œttl æŸ¥è¯¢</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®user</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> user zhanghanzhe</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># è®¾ç½®userçš„æ¶ˆäº¡æ—¶é—´ä¸º10ç§’</span></span><br><span class="line">127.0.0.1:6379&gt; expire user 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># ä¸€å¼€å§‹çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥è·å–çš„ </span></span><br><span class="line">127.0.0.1:6379&gt; get user</span><br><span class="line"><span class="string">&quot;zhanghanzhe&quot;</span></span><br><span class="line"><span class="comment"># æŸ¥è¯¢è¿‡æœŸæ—¶é—´ï¼Œè¿˜å‰©3ç§’</span></span><br><span class="line">127.0.0.1:6379&gt; tll user</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"><span class="comment"># è¿™ä¼šå˜-2äº†</span></span><br><span class="line">127.0.0.1:6379&gt; tll user</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line"><span class="comment"># è·å–ä¸åˆ°äº†</span></span><br><span class="line">127.0.0.1:6379&gt; get user</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ key çš„æ•°æ®ç±»å‹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; type name</span><br><span class="line">string</span><br></pre></td></tr></table></figure><h2 id="äº”å¤§åŸºæœ¬ç±»å‹">äº”å¤§åŸºæœ¬ç±»å‹</h2><p>åœ¨ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†æœ€åä¸€ä¸ªå‘½ä»¤ï¼Œæ˜¯ä¸€ä¸ª <code>type</code> å‘½ä»¤ï¼Œä½¿ç”¨å®ƒå¯ä»¥æŸ¥çœ‹æŒ‡å®š key çš„æ•°æ®ç±»å‹ï¼Œè¿™é‡Œæ¥è§¦äº†ä¸€ä¸ªæ–°çš„çŸ¥è¯†ï¼Œå°±æ˜¯æ•°æ®ç±»å‹ï¼Œredis ä¸­æœ‰æœ‰å¤šå°‘æ•°æ®ç±»å‹å‘¢ï¼Ÿ</p><h3 id="String-å­—ç¬¦ä¸²">String å­—ç¬¦ä¸²</h3><p>string å°±æ˜¯å­—ç¬¦ä¸²å•¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ç®€å•çš„ set å‘½ä»¤è®¾ç½®çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤å°±æ˜¯ string ç±»å‹çš„ï¼Œå°±åƒ java çš„ api ä¸€æ ·ï¼Œstring ç±»å‹æœ‰è‡ªå·±ä¸“å±çš„å‘½ä»¤</p><p><em>string ç±»å‹çš„å‘½ä»¤å¤§å¤šæ˜¯éƒ½æ˜¯ä»¥ str å¼€å¤´çš„</em></p><p>å­—ç¬¦ä¸²æ“ä½œå°±æ˜¯ä¹‹å‰å­¦ä¹ çš„ get set å‘½ä»¤ï¼Œå°±ä¸å¤šèµ˜è¿°äº†</p><blockquote><p>ç»„åˆå‘½ä»¤ è¿”å›å¹¶ä¿®æ”¹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»„åˆå‘½ä»¤ï¼Œä¿®æ”¹æ–°çš„valueåŒæ—¶è¿”å›ä¿®æ”¹å‰çš„value</span></span><br><span class="line">getset name hanzhe</span><br></pre></td></tr></table></figure><blockquote><p>æ•°æ®çš„æ‰¹é‡æ“ä½œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mset user zhang name hanzhe age 21</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget user name age</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;hanzhe&quot;</span></span><br><span class="line">3) <span class="string">&quot;21&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¸¦æœ‰éªŒè¯çš„ setnx</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒæ ·æ˜¯è®¾ç½®å€¼ï¼Œå› ä¸ºkeyæ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä»–åœ¨è®¾ç½®ä¹‹å‰ä¼šæœ‰ä¸€ä¸ªæ•ˆéªŒï¼Œå¦‚æœå·²å­˜åœ¨å°±ä¸ä¿®æ”¹</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name zhang</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; setnx name hanzhe</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"><span class="comment"># æ‰¹é‡æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ï¼Œå› ä¸ºåŸå­æ€§çš„åŸå› ï¼Œä»–ä»¬è¦ä¹ˆå…¨éƒ½æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ½å¤±è´¥ã€‚</span></span><br><span class="line">127.0.0.1:6379&gt; msetnx view 123 name hanzhe</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><blockquote><p>è¿½åŠ å­—ç¬¦ append</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name zhang</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; append name <span class="string">&quot; &quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">127.0.0.1:6379&gt; append name hanzhe</span><br><span class="line">(<span class="built_in">integer</span>) 12</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;zhang hanzhe&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿”å›å­—ç¬¦ä¸²é•¿åº¦ strlen</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; strlen name</span><br><span class="line">(<span class="built_in">integer</span>) 12</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªå¢ï¼Œè‡ªå‡ incr decr</p></blockquote><p>åœ¨ java ä¸­ï¼Œå¦‚æœæƒ³è¦å¯¹å­—ç¬¦ä¸² +1 éœ€è¦è½¬æ¢ç±»å‹ï¼Œè€Œåœ¨ redis ä¸­ä»–ä»¬è‡ªåŠ¨ä¸ºæˆ‘ä»¬è¿›è¡Œäº†å¤„ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> view 1</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># è‡ªå¢ +1</span></span><br><span class="line">127.0.0.1:6379&gt; incr view</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment"># è‡ªå‡ -1</span></span><br><span class="line">127.0.0.1:6379&gt; decr view</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># è‡ªå¢ï¼ŒæŒ‡å®šæ­¥é•¿ä¸º3</span></span><br><span class="line">127.0.0.1:6379&gt; incrby view 3</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"><span class="comment"># è‡ªå‡ï¼ŒæŒ‡å®šæ­¥é•¿ä¸º2</span></span><br><span class="line">127.0.0.1:6379&gt; decrby view 2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><blockquote><p>æˆªå–å­—ç¬¦ä¸² getrangeï¼Œ==æˆªå–æ˜¯å°†è·å–çš„ç»“æœè¿›è¡Œæˆªå–ï¼Œå¹¶ä¸ä¼šå¯¹ key æœ¬èº«é€ æˆæ”¹å˜==</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name zhanghanzhe</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># ä»ä¸‹æ ‡0å¼€å§‹ï¼Œæˆªå–åˆ°4ï¼Œå…±æˆªå–äº†5ä½ï¼ŒåŒ…å¤´åŒ…å°¾ï¼Œå¦‚æœæ˜¯0åˆ°-1åˆ™ä»£è¡¨è·å–å…¨éƒ¨çš„å­—ç¬¦ä¸²</span></span><br><span class="line">127.0.0.1:6379&gt; getrange name 0 4</span><br><span class="line"><span class="string">&quot;zhang&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ›¿æ¢å­—ç¬¦ä¸² setrange</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»ä¸‹æ ‡5å¼€å§‹æ›¿æ¢ï¼Œç›´è‡³æ›¿æ¢ç»“æŸï¼Œè¿™ä¸ªä¼šå¯¹nameè¿›è¡Œä¿®æ”¹ã€‚</span></span><br><span class="line">127.0.0.1:6379&gt; setrange name 5 chunde</span><br><span class="line">(<span class="built_in">integer</span>) 11</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;zhangchunde&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è®¾ç½®æ¶ˆäº¡æ—¶é—´ ( è¿‡æœŸæ—¶é—´ ) setex å•ä½/ç§’</p></blockquote><p>ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨è¿‡ä¸€ä¸ªå« <code>expire</code> çš„å‘½ä»¤ï¼Œä¹Ÿæ˜¯ç”¨æ¥è®¾ç½®æ¶ˆäº¡æ—¶é—´çš„ï¼Œä½†æ˜¯ä»–æ‰§è¡Œè®¾ç½®å·²å­˜åœ¨çš„ keyï¼Œè€Œè¿™ä¸ªå‘½ä»¤å¯ä»¥åœ¨è®¾ç½®å˜é‡çš„åŒæ—¶è®¾ç½®æ¶ˆäº¡æ—¶é—´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setex name 10 zhang</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h3 id="List-åˆ—è¡¨é›†åˆ">List åˆ—è¡¨é›†åˆ</h3><p>list æ˜¯ç”¨æ¥å­˜å‚¨ string çš„ä¸€ä¸ªåˆ—è¡¨, ==redis çš„åˆ—è¡¨æ˜¯åŒå‘çš„==ï¼Œlist é»˜è®¤ä»å³å‘å·¦å»¶ä¼¸ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æ·»åŠ å…ƒç´ éƒ½ä¼šæ·»åŠ åœ¨å·¦é¢ï¼Œ==list åˆ—è¡¨å…è®¸é‡å¤å…ƒç´ çš„å‡ºç°==</p><p><em>listä¸­çš„å‘½ä»¤ï¼Œå¤§å¤šæ•°éƒ½æ˜¯ä»¥å°å†™å­—æ¯ L å¼€å¤´çš„</em></p><blockquote><p>åˆ›å»º-æ·»åŠ å…ƒç´  lpushï¼Œrpush</p></blockquote><p>lpush é»˜è®¤ä»å·¦ä¾§æ·»åŠ ï¼Œå¦‚éœ€ä»å³ä¾§æ·»åŠ å¯ä»¥ä½¿ç”¨ <code>r</code> å¼€å¤´å£°æ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush name han</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; lpush name zhang</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush name zhe</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹åˆ—è¡¨ lrange</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ä¹‹å‰åˆ›å»ºçš„listï¼Œä»…æ”¯æŒä»å·¦ä¾§æŸ¥çœ‹</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhe&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ ï¼Œè¿½åŠ å…ƒç´  2</p></blockquote><p>ä¹‹å‰ä»‹ç»äº† <code>push</code> å‘½ä»¤å¯ä»¥æ·»åŠ å…ƒç´ ï¼Œé€šè¿‡ l å¼€å¤´æˆ–è€… r å¼€å¤´å¯ä»¥æ§åˆ¶å·¦ä¾§æ·»åŠ è¿˜æ˜¯å³ä¾§æ·»åŠ ï¼Œå…¶å®æ·»åŠ å…ƒç´ è¿˜å¯ä»¥ä½¿ç”¨ <code>linsert</code> å‘½ä»¤ï¼Œå’Œ <code>push</code> ä¸åŒçš„æ˜¯ï¼Œ <code>push</code> æ˜¯åœ¨é¦–ä½æ·»åŠ ï¼Œè€Œ <code>linsert</code> æ˜¯ä» <strong>å·¦é¢å¼€å§‹åœ¨ç¬¬ä¸€ä¸ªç›®æ ‡ key çš„å‰åæ·»åŠ </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush name han</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># åœ¨nameä¸­çš„hanå‰é¢æ·»åŠ zhang</span></span><br><span class="line">127.0.0.1:6379&gt; linsert name before han zhang</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment"># åœ¨nameä¸­çš„hanåé¢æ·»åŠ zhe</span></span><br><span class="line">127.0.0.1:6379&gt; linsert name after han zhe</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhe&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹æŒ‡å®šä¸‹æ ‡çš„ value</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;zhe&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhe&quot;</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸‹æ ‡0çš„å€¼ä¸ºzhang</span></span><br><span class="line">127.0.0.1:6379&gt; lset name 0 zhang</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhe&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç§»é™¤é¦–å°¾ popï¼Œç§»é™¤å¤šä¸ª lrem</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç§»é™¤å·¦ä¾§ç¬¬ä¸€ä¸ªï¼Œè¿”å›è¢«ç§»é™¤çš„æ•°æ®</span></span><br><span class="line">127.0.0.1:6379&gt; lpop name</span><br><span class="line"><span class="string">&quot;zhang&quot;</span></span><br><span class="line"><span class="comment"># ç§»é™¤å³ä¾§ç¬¬ä¸€ä¸ªï¼Œè¿”å›è¢«ç§»é™¤çš„æ•°æ®</span></span><br><span class="line">127.0.0.1:6379&gt; rpop name</span><br><span class="line"><span class="string">&quot;zhe&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lpush name one</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; rpush name one one</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line"><span class="comment"># ç§»é™¤å¤šä¸ªå…ƒç´ ï¼Œä»…æ”¯æŒä»å·¦ä¾§ç§»é™¤ï¼Œ2æ•°é‡ï¼Œoneä¸ºå…·ä½“è¦ç§»é™¤çš„å€¼ï¼Œç²¾ç¡®åŒ¹é…ï¼Œä¸æ”¯æŒé€šé…ç¬¦</span></span><br><span class="line">127.0.0.1:6379&gt; lrem name 2 one</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><blockquote><p>è¿”å›é•¿åº¦ llen</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush name han zhang</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush name zhe</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"><span class="comment"># è·å–é›†åˆé•¿åº¦</span></span><br><span class="line">127.0.0.1:6379&gt; llen name</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><blockquote><p>è·å–æŒ‡å®šä¸‹æ ‡çš„value</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhe&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lindex name 0</span><br><span class="line"><span class="string">&quot;zhang&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>æˆªå–åˆ—è¡¨ ltrim</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;five&quot;</span></span><br><span class="line">2) <span class="string">&quot;four&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">4) <span class="string">&quot;two&quot;</span></span><br><span class="line">5) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="comment"># ä»ä¸‹æ ‡1å¼€å§‹æˆªå–åˆ°2ï¼Œä¼šä¿®æ”¹å˜é‡ä¸­çš„å€¼</span></span><br><span class="line">127.0.0.1:6379&gt; ltrim list 1 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;four&quot;</span></span><br><span class="line">2) <span class="string">&quot;three&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è·å–æ’åºç»“æœ sortï¼Œä¸ä¼šå½±å“æœ¬ä½“ï¼Œ<code>å­—æ¯æ’åº/alpha</code>ï¼Œ<code>å€’åºæ’åº/desc</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush num 10 30 20 40</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"><span class="comment"># é»˜è®¤ä»å°åˆ°å¤§</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">sort</span> num</span><br><span class="line">1) <span class="string">&quot;10&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br><span class="line">3) <span class="string">&quot;30&quot;</span></span><br><span class="line">4) <span class="string">&quot;40&quot;</span></span><br><span class="line"><span class="comment"># å¯ä»¥ä»å¤§åˆ°å°</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">sort</span> num desc</span><br><span class="line">1) <span class="string">&quot;40&quot;</span></span><br><span class="line">2) <span class="string">&quot;30&quot;</span></span><br><span class="line">3) <span class="string">&quot;20&quot;</span></span><br><span class="line">4) <span class="string">&quot;10&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­—æ¯æ’åº</span></span><br><span class="line">127.0.0.1:6379&gt; lpush En python java switch</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">sort</span> En alpha</span><br><span class="line">1) <span class="string">&quot;java&quot;</span></span><br><span class="line">2) <span class="string">&quot;python&quot;</span></span><br><span class="line">3) <span class="string">&quot;switch&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç»„åˆå‘½ä»¤ï¼šç§»åŠ¨å…ƒç´ </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;han&quot;</span></span><br><span class="line">2) <span class="string">&quot;zhe&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhang&quot;</span></span><br><span class="line"><span class="comment"># ç§»é™¤ç›®æ ‡å…ƒç´ å¹¶æ·»åŠ åˆ°ç›®æ ‡ä½ç½®</span></span><br><span class="line">127.0.0.1:6379&gt; rpoplpush name name</span><br><span class="line"><span class="string">&quot;zhang&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange name 0 -1</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhe&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Set-æ— åºé›†åˆ">Set æ— åºé›†åˆ</h3><p>set é›†åˆæ˜¯ string ç±»å‹çš„ ==æ— åºé›†åˆ==ï¼Œä¸”==ä¸å…è®¸å­˜å…¥é‡å¤æ•°æ®==ï¼Œå¦‚æœé‡å¤å­˜å…¥ç›¸åŒçš„å€¼ä¼šæŠ¥é”™</p><p><em>è¿˜æ˜¯è€è§„çŸ©ï¼Œset é›†åˆçš„å‘½ä»¤ç‰¹ç‚¹ï¼Œå°±æ˜¯ä»¥ s å¼€å¤´</em></p><blockquote><p>set é›†åˆçš„ CRUD</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  sadd</span></span><br><span class="line">127.0.0.1:6379&gt; sadd code java</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd code python switch</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ smembersï¼Œè¿™é‡Œå°±å¯ä»¥çœ‹å‡ºï¼Œseté›†åˆæ˜¯æ— åºçš„</span></span><br><span class="line">127.0.0.1:6379&gt; smembers code</span><br><span class="line">1) <span class="string">&quot;python&quot;</span></span><br><span class="line">2) <span class="string">&quot;java&quot;</span></span><br><span class="line">3) <span class="string">&quot;switch&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; srem code switch</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç›®æ ‡ set é›†åˆé•¿åº¦ scard</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scard code</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><blockquote><p>æ£€æŸ¥ set é›†åˆä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„å€¼ sismemberï¼Œå­˜åœ¨è¿”å› 1ï¼Œä¸å­˜åœ¨è¿”å› 0</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sismember code java</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><blockquote><p>éšæœºæ€§çš„è·å–å’Œç§»é™¤</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd num 1 2 3 4 5 6 7 8 9</span><br><span class="line">(<span class="built_in">integer</span>) 9</span><br><span class="line"><span class="comment"># éšæœºè·å–ä¸€ä¸ªå€¼</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember num 1</span><br><span class="line">1) <span class="string">&quot;7&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember num 1</span><br><span class="line">1) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="comment"># éšæœºç§»é™¤ä¸€ä¸ªå€¼</span></span><br><span class="line">127.0.0.1:6379&gt; spop num 1</span><br><span class="line">1) <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è·å–å¤šä¸ªé›†åˆä¸­çš„ ==å·®é›†==ï¼Œ==äº¤é›†==ï¼Œ==å¹¶é›†==</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å‰ç½®æ¡ä»¶--æ‹¥æœ‰ä¸‰ä¸ªseté›†åˆ</span></span><br><span class="line">127.0.0.1:6379&gt; sadd key1 1 2 3 4</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd key2 3 4 5 6</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; sadd key3 1 6 7 8</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure><p>å·®é›† <code>sdiff</code>ï¼Œå–å‡ºä¸¤ä¸ªé›†åˆä¸­ä¸åŒçš„å…ƒç´ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥ç¬¬ä¸€ä¸ªkeyä¸ºä¸»ï¼Œä¾æ¬¡ä¸æ¯ä¸ªkeyå–å·®é›†</span></span><br><span class="line">127.0.0.1:6379&gt; sdiff key1 key2</span><br><span class="line">1) <span class="string">&quot;1&quot;</span></span><br><span class="line">2) <span class="string">&quot;2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sdiff key1 key2 key3</span><br><span class="line">1) <span class="string">&quot;2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sdiff key2 key1 key3</span><br><span class="line">1) <span class="string">&quot;5&quot;</span></span><br></pre></td></tr></table></figure><p>äº¤é›† <code>sinter</code>ï¼Œå–å‡ºä¸¤ä¸ªé›†åˆä¸­ç›¸åŒçš„å…ƒç´ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥ç¬¬ä¸€ä¸ªkeyä¸ºä¸»ï¼Œä¾æ¬¡ä¸æ¯ä¸ªkeyå–äº¤é›†</span></span><br><span class="line">127.0.0.1:6379&gt; sinter key1 key2</span><br><span class="line">1) <span class="string">&quot;3&quot;</span></span><br><span class="line">2) <span class="string">&quot;4&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sinter key1 key3</span><br><span class="line">1) <span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sinter key1 key2 key3</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br></pre></td></tr></table></figure><p>å¹¶é›† <code>sunion</code>ï¼Œå–å‡ºä¸¤ä¸ªé›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥ç¬¬ä¸€ä¸ªkeyä¸ºä¸»ï¼Œä¾æ¬¡ä¸æ¯ä¸ªkeyå–å¹¶é›†</span></span><br><span class="line">127.0.0.1:6379&gt; sunion key1 key2</span><br><span class="line">1) <span class="string">&quot;1&quot;</span></span><br><span class="line">2) <span class="string">&quot;2&quot;</span></span><br><span class="line">3) <span class="string">&quot;3&quot;</span></span><br><span class="line">4) <span class="string">&quot;4&quot;</span></span><br><span class="line">5) <span class="string">&quot;5&quot;</span></span><br><span class="line">6) <span class="string">&quot;6&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sunion key1 key2 key3</span><br><span class="line">1) <span class="string">&quot;1&quot;</span></span><br><span class="line">2) <span class="string">&quot;2&quot;</span></span><br><span class="line">3) <span class="string">&quot;3&quot;</span></span><br><span class="line">4) <span class="string">&quot;4&quot;</span></span><br><span class="line">5) <span class="string">&quot;5&quot;</span></span><br><span class="line">6) <span class="string">&quot;6&quot;</span></span><br><span class="line">7) <span class="string">&quot;7&quot;</span></span><br><span class="line">8) <span class="string">&quot;8&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Hash-æ•£åˆ—é›†åˆ">Hash æ•£åˆ—é›†åˆ</h3><p>hash ç±»å‹å°±åƒ mapï¼Œæ˜¯ç”±ä¸€ä¸ªä¸ªçš„ key-value ç»„æˆçš„å¯¹è±¡ï¼Œè€Œä¸” ==key ä¸èƒ½é‡å¤==ï¼Œ<strong>å­˜å…¥ç›¸åŒçš„ key å’Œ value åï¼Œæœ€åä¸€ä¸ªå­˜å…¥çš„ä¼šè¦†ç›–ä¹‹å‰å­˜å…¥çš„ç»“æœ</strong></p><p><em>è€è§„çŸ©ï¼Œå‡ ä¹æ‰€æœ‰ hash çš„æŒ‡ä»¤éƒ½ä»¥ h å¼€å¤´</em></p><blockquote><p>æ·»åŠ ï¼Œæ‰¹é‡æ·»åŠ ï¼Œhash æ²¡æœ‰ä¿®æ”¹ï¼Œè¦†ç›–å°±æ˜¯ä¿®æ”¹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset user name zhanghanzhe</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hmset user sex nan age 21</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><blockquote><p>è·å–ï¼Œæ‰¹é‡è·å–</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡keyè·å–value</span></span><br><span class="line">127.0.0.1:6379&gt; hget user name</span><br><span class="line"><span class="string">&quot;zhanghanzhe&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hmget user name sex age</span><br><span class="line">1) <span class="string">&quot;zhanghanzhe&quot;</span></span><br><span class="line">2) <span class="string">&quot;nan&quot;</span></span><br><span class="line">3) <span class="string">&quot;21&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰key</span></span><br><span class="line">127.0.0.1:6379&gt; hkeys user</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;sex&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰value</span></span><br><span class="line">127.0.0.1:6379&gt; hvals user</span><br><span class="line">1) <span class="string">&quot;zhanghanzhe&quot;</span></span><br><span class="line">2) <span class="string">&quot;nan&quot;</span></span><br><span class="line">3) <span class="string">&quot;21&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰çš„keyå’Œvalue</span></span><br><span class="line">127.0.0.1:6379&gt; hgetall user</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;zhanghanzhe&quot;</span></span><br><span class="line">3) <span class="string">&quot;sex&quot;</span></span><br><span class="line">4) <span class="string">&quot;nan&quot;</span></span><br><span class="line">5) <span class="string">&quot;age&quot;</span></span><br><span class="line">6) <span class="string">&quot;21&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤æŒ‡ä»¤</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hdel user name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hdel user sex age</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªå¢å’Œè‡ªå‡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset map key1 5</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hincrby map key1 2</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">127.0.0.1:6379&gt; hincrby map key1 -3</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure><blockquote><p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å› 1ï¼Œä¸å­˜åœ¨è¿”å› 2</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hexists map key1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h3 id="Zset-æœ‰åºé›†åˆ">Zset æœ‰åºé›†åˆ</h3><p>zset æœ‰åºé›†åˆå’Œ set é›†åˆç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸å…è®¸é‡å¤çš„å€¼å‡ºç°ï¼Œåªä¸è¿‡ç›¸æ¯”äº set é›†åˆï¼Œzset å¤šäº†ä¸€ä¸ªæ’åºçš„åŠŸèƒ½ï¼Œåœ¨æ·»åŠ å€¼å¾—æ—¶å€™éœ€è¦ç»™ä»–ä¸€ä¸ª <code>åˆ†å€¼</code>ï¼Œ<font color="red"><code>åˆ†å€¼</code> å¯ä»¥é‡å¤ä½† <code>value</code> ä¸å…è®¸é‡å¤</font>ï¼Œé»˜è®¤æŒ‰ç…§åˆ†å€¼ä»å°åˆ°å¤§æ’åº</p><p><em>è€è§„çŸ©ï¼Œå‡ ä¹æ‰€æœ‰ zset çš„æŒ‡ä»¤éƒ½ä»¥ zå¼€å¤´</em></p><blockquote><p>æ·»åŠ å…ƒç´  zaddï¼Œç¬¬ä¸€ä¸ªæ˜¯åˆ†å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯ value</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd user 1 zhang</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd user 2 han 3 zhe</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤å…ƒç´ </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrem user zhang han zhe</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹é›†åˆ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­£å¸¸æŸ¥çœ‹é›†åˆ</span></span><br><span class="line">127.0.0.1:6379&gt; zrange user 0 -1</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhe&quot;</span></span><br><span class="line"><span class="comment"># å€’åºæŸ¥çœ‹é›†åˆ</span></span><br><span class="line">127.0.0.1:6379&gt; zrevrange user 0 -1</span><br><span class="line">1) <span class="string">&quot;zhe&quot;</span></span><br><span class="line">2) <span class="string">&quot;han&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhang&quot;</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¸¦æœ‰åˆ†å€¼çš„é›†åˆ</span></span><br><span class="line">127.0.0.1:6379&gt; zrange user 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">3) <span class="string">&quot;han&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">5) <span class="string">&quot;zhe&quot;</span></span><br><span class="line">6) <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è·å–é›†åˆå†…å…ƒç´ çš„æ•°é‡ zcard zcount</p></blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼š==- inf ä»£è¡¨æ— ç©·å°ï¼Œ+ inf ä»£è¡¨æ— ç©·å¤§==</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd user 10 zhang 12 wang 18 li 20 zhao 28 bai 30 guo</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line"><span class="comment"># è·å–å½“å‰é›†åˆæ•°é‡</span></span><br><span class="line">127.0.0.1:6379&gt; zcard user</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line"><span class="comment"># è·å–å½“å‰é›†åˆåˆ†å€¼ç¬¦åˆåŒºé—´å†…çš„æ•°é‡</span></span><br><span class="line">127.0.0.1:6379&gt; zcount user -inf +inf</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">127.0.0.1:6379&gt; zcount user 10 20</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure><h2 id="ä¸‰å¤§ç‰¹æ®Šç±»å‹">ä¸‰å¤§ç‰¹æ®Šç±»å‹</h2><h3 id="åœ°ç†ä½ç½®">åœ°ç†ä½ç½®</h3><p><code>Geospatial</code> ç±»å‹ç”¨æ¥å­˜å‚¨æœ‰å…³ç»çº¬åº¦çš„åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œé»˜è®¤ç»åº¦ç¬¬ä¸€ä½ï¼Œç»´åº¦ç¬¬äºŒä½ï¼Œredis ä¸­é’ˆå¯¹ç»çº¬åº¦çš„å­˜å‚¨èŒƒå›´æœ‰ä¸€å®šçš„é™åˆ¶ï¼š</p><ul><li>ç»åº¦æœ‰æ•ˆèŒƒå›´ï¼š-180 ~ 180</li><li>ç»´åº¦æœ‰æ•ˆèŒƒå›´ï¼š-85.05112878 ~ 85.05112878</li></ul><p><em>è€è§„çŸ©ï¼Œå‡ ä¹æ‰€æœ‰æŒ‡ä»¤éƒ½æ˜¯ä»¥ geoå¼€å¤´çš„</em></p><blockquote><p>æ·»åŠ åœ°ç†ä½ç½®ä¿¡æ¯ geoadd</p></blockquote><p>åœ¨æ·»åŠ ç»çº¬åº¦çš„æ—¶å€™å¦‚æœè¶…å‡ºäº†èŒƒå›´ä¼šæŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd point 126.64 45.75 hei</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd point 125.32 43.88 ji 123.42 41.79 liao</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹æŒ‡å®šåœ°åŒºçš„ç»çº¬åº¦ ( å·²å­˜å…¥çš„ )ï¼ŒåŒç†ï¼Œæ·»åŠ ä¹Ÿæ˜¯ä¿®æ”¹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos point ji</span><br><span class="line">1) 1) <span class="string">&quot;125.32000154256820679&quot;</span></span><br><span class="line">   2) <span class="string">&quot;43.87999897829567431&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; geopos point hei ji liao</span><br><span class="line">1) 1) <span class="string">&quot;126.64000242948532104&quot;</span></span><br><span class="line">   2) <span class="string">&quot;45.74999965248261447&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;125.32000154256820679&quot;</span></span><br><span class="line">   2) <span class="string">&quot;43.87999897829567431&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;123.41999977827072144&quot;</span></span><br><span class="line">   2) <span class="string">&quot;41.78999971580505246&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è®¡ç®—ä¸¤åœ°çš„è·ç¦» geodist</p></blockquote><p>ä½¿ç”¨ <code>geodist</code> è·å–è·ç¦»æ˜¯é€šè¿‡ç»çº¬åº¦è®¡ç®—å‡ºæ¥çš„ <strong>ç›´çº¿è·ç¦»</strong>ï¼Œå¹¶ä¸æ˜¯è·¯é€”è·ç¦»ï¼Œé»˜è®¤è·å–å•ä½æ˜¯ç±³ï¼Œå¯ä»¥é€šè¿‡åˆ¶å®šåç¼€æ¥è®¾ç½®è·å–çš„å•ä½ï¼š <code>m/ç±³</code>ï¼Œ<code>km/åƒç±³</code>ï¼Œ<code>miè‹±é‡Œ</code>ï¼Œ<code>ftè‹±å°º</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å‰æ—åˆ°é»‘é¾™æ±Ÿçš„ç›´çº¿è·ç¦»</span></span><br><span class="line">127.0.0.1:6379&gt; geodist point hei ji</span><br><span class="line"><span class="string">&quot;232604.0065&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; geodist point hei ji km</span><br><span class="line"><span class="string">&quot;232.6040&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>é›·è¾¾æ–¹å¼è·å–ç›®æ ‡ç»çº¬åº¦é™„è¿‘çš„åœ°ç†ä½ç½® georadius</p></blockquote><p>é›·è¾¾æ–¹å¼ï¼Œä»¥ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œè·ç¦»ä¸ºåŠå¾„æŒ‰ç…§åœ†å½¢æ‰«æï¼Œç±»ä¼¼å¾®ä¿¡é™„è¿‘çš„äººåŠŸèƒ½</p><p><code>withdistè·ç¦»km</code>ï¼Œ<code>withdistç»çº¬åº¦</code>ï¼Œ<code>count 1 æ˜¾ç¤ºç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿”å›ç»åº¦125ç»´åº¦43é™„è¿‘300kmçš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">127.0.0.1:6379&gt; georadius point 125 43 300 km</span><br><span class="line">1) <span class="string">&quot;ji&quot;</span></span><br><span class="line">2) <span class="string">&quot;liao&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤šè¦æ±‚è·å–</span></span><br><span class="line">127.0.0.1:6379&gt; georadius point 125 43 300 km withdist withcoord count 1</span><br><span class="line">1) 1) <span class="string">&quot;ji&quot;</span></span><br><span class="line">   2) <span class="string">&quot;101.2331&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;125.32000154256820679&quot;</span></span><br><span class="line">      2) <span class="string">&quot;43.87999897829567431&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨å·²å­˜åœ¨çš„åœ°ç†ä½ç½®è¿›è¡Œè·å–</span></span><br><span class="line">127.0.0.1:6379&gt; georadiusbymember point ji 250 km</span><br><span class="line">1) <span class="string">&quot;ji&quot;</span></span><br><span class="line">2) <span class="string">&quot;hei&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç§»é™¤å…ƒç´ </p></blockquote><p><code>Geospatial</code> ç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œä»–æ²¡æœ‰ç»™å’±ä»¬æä¾›ç§»é™¤çš„æŒ‡ä»¤ï¼Œä½†æ˜¯ <code>Geospatial</code> çš„åº•å±‚æ˜¯åŸºäº <code>zset</code> å®ç°çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>zset</code> æ¥ç§»é™¤æŒ‡å®šçš„ key å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange point 0 -1</span><br><span class="line">1) <span class="string">&quot;liao&quot;</span></span><br><span class="line">2) <span class="string">&quot;ji&quot;</span></span><br><span class="line">3) <span class="string">&quot;hei&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrem point hei</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geopos point hei</span><br><span class="line">1) (nil)</span><br></pre></td></tr></table></figure><h3 id="åŸºæ•°ç»Ÿè®¡">åŸºæ•°ç»Ÿè®¡</h3><p><code>hyperloglog</code> ä»–æ˜¯ä¸€ç§ä¸“é—¨ç”¨æ¥ç»Ÿè®¡åŠåŸºæ•°çš„ç±»å‹ï¼Œå½“ç„¶å…¶ä¸­çš„å…ƒç´ ä¸å…è®¸é‡å¤ï¼Œç›¸æ¯”äº set é›†åˆï¼Œä¾‹å¦‚è®¡ç®—ç½‘ç«™è®¿é—®é‡æ—¶ï¼Œå¯ä»¥äº¤ç»™ <code>hyperloglog</code> è¿›è¡Œå¤„ç†ï¼Œä»–çš„å†…å­˜å ç”¨æ˜¯å›ºå®šçš„ 12KBã€‚</p><p>ä½†æ˜¯å› ä¸ºä»–ä»…ä»…æ˜¯è®¡ç®—åŸºæ•°çš„ç±»å‹ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½åƒ set é›†åˆä¸€æ ·ï¼Œè·å–åˆ°å…ƒç´ çš„å…·ä½“çš„å€¼ï¼Œè€Œä¸”è¯¥ç±»å‹æœ‰ä¸€å®šçš„è¯¯å·®ï¼Œå¦‚æœå¯¹ç²¾å‡†åº¦æ²¡æœ‰å¤ªå¤§è¦æ±‚ï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨ <code>hyperloglog</code></p><p><em>è€è§„çŸ©ï¼Œå‡ ä¹æ‰€æœ‰æŒ‡ä»¤éƒ½æ˜¯ä»¥ pfå¼€å¤´çš„</em></p><blockquote><p>æ·»åŠ å…ƒç´  pfadd</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfadd num1 1 2 3 4 5</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd num2 3 4 5 6 7</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹å…ƒç´ ä¸ªæ•°</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfcount num1</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure><blockquote><p>å°†ä¸¤ä¸ªé›†åˆåˆå¹¶ä¸ºä¸€ä¸ªé›†åˆ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; pfmerge num3 num1 num2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfcount num3</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br></pre></td></tr></table></figure><h3 id="è¿›åˆ¶å­˜å‚¨">è¿›åˆ¶å­˜å‚¨</h3><p><code>bitmap</code> æ˜¯åŸºäºäºŒè¿›åˆ¶è¿›è¡Œå­˜å‚¨çš„ï¼ŒäºŒè¿›åˆ¶åªæœ‰ 0 å’Œ 1 ä¸¤ä¸ªå€¼ï¼Œå¯ä»¥åˆ†åˆ«ç”¨æ¥ä»£è¡¨ä¸¤ç§ç›¸å¯¹ä¸åŒçš„çŠ¶æ€ï¼Œä¾‹å¦‚ æ‰“å¡ &lt;=&gt; æœªæ‰“å¡ï¼Œå¯ä»¥æŠ½è±¡çš„ç†è§£ä¸º boolean ç±»å‹ä¸­çš„ true å’Œ false çš„æ„Ÿè§‰ã€‚</p><p><em>å‘½ä»¤å‡ ä¹éƒ½ä»¥ bit ç»“å°¾</em></p><blockquote><p>æ·»åŠ å…ƒç´  [ 0 ä»£è¡¨æœªæ‰“å¡ï¼Œ1 ä»£è¡¨æ‰“å¡ ]</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setbit sign 0 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 1 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 0</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 3 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹æŸä¸ªçŠ¶æ€ â€“ è¿”å› 1 ä»£è¡¨æ‰“å¡ï¼Œ0 ä»£è¡¨æœªæ‰“å¡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; getbit sign 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹å¤šå°‘äººç¬¦åˆæ¡ä»¶</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bitcount sign</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><h2 id="Redis-çš„äº‹åŠ¡">Redis çš„äº‹åŠ¡</h2><p>äº‹åŠ¡å°±æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œå°†å¹³æ—¶å¤šæ¬¡æ‰§è¡Œçš„å‘½ä»¤æ”¾åœ¨ä¸€èµ·ï¼Œç„¶åæŒ‰ç…§å‘½ä»¤é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œè€Œä¸”æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å¹²æ‰°ï¼Œäº‹åŠ¡æ‰§è¡Œç»“æŸåä¸ä¼šä¿ç•™ï¼Œä¹Ÿå°±æ„å‘³ç€æ¯æ¬¡æ‰§è¡Œäº‹åŠ¡éƒ½éœ€è¦é‡æ–°åˆ›å»ºï¼Œå¯å¾—å‡º redis äº‹åŠ¡çš„ä¸‰ä¸ªç‰¹ç‚¹ï¼š<font color="red">é¡ºåºæ€§</font>ï¼Œ<font color="red">æ’ä»–æ€§</font>ï¼Œ<font color="red">ä¸€æ¬¡æ€§</font>ã€‚</p><p>è¿˜æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š==redis çš„äº‹åŠ¡ä¸­ï¼Œæ²¡æœ‰åŸå­æ€§å’Œéš”ç¦»æ€§çš„æ¦‚å¿µï¼Œä¹Ÿä¸åŒ…å«å›æ»š==ï¼Œæ‰€æœ‰å‘½ä»¤åœ¨åŠ å…¥äº‹åŠ¡çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åœ¨äº†æ‰§è¡Œçš„é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿå°±ä¸å­˜åœ¨éš”ç¦»æ€§ã€‚</p><p>äº‹åŠ¡æ¶‰åŠåˆ°çš„å…³é”®å­—ï¼š<code>å¼€å¯/multi</code>ï¼Œ<code>æ‰§è¡Œ/exec</code>ï¼Œ<code>æ”¾å¼ƒ/discard</code>ï¼Œ<code>ç›‘è§†/watch</code>ï¼Œ<code>å…³é—­ç›‘è§†/unwatch</code></p><h3 id="ä½¿ç”¨äº‹åŠ¡">ä½¿ç”¨äº‹åŠ¡</h3><blockquote><p>äº‹åŠ¡çš„æ‰§è¡Œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“è¾“å…¥multiçš„æ—¶å€™å°±è¡¨ç¤ºäº‹åŠ¡å¼€å§‹äº†ï¼Œå½“ä½¿ç”¨execçš„æ—¶å€™ï¼Œå°±è¡¨ç¤ºè¦æ‰§è¡Œäº†</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; mset k2 v2 k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3</span><br><span class="line">1) <span class="string">&quot;v1&quot;</span></span><br><span class="line">2) <span class="string">&quot;v2&quot;</span></span><br><span class="line">3) <span class="string">&quot;v3&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“æˆ‘äº‹åŠ¡æ·»åŠ ä¸­é€”ï¼Œä¸æƒ³æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨discardå‘½ä»¤æ¥æ”¾å¼ƒå½“å‰äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 zhang</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; discard</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>äº‹åŠ¡çš„å¼‚å¸¸å¤„ç†æœºåˆ¶</p></blockquote><p>å’Œ java æœ‰ç‚¹ç±»ä¼¼ï¼Œredis é’ˆå¯¹äº‹åŠ¡ä¹Ÿåˆ†æ‰€è°“çš„ <code>ç¼–è¯‘æ—¶å¼‚å¸¸</code> å’Œ <code>è¿è¡Œæ—¶å¼‚å¸¸</code>ï¼Œåªä¸è¿‡è¿™é‡Œçš„ <code>ç¼–è¯‘æ—¶å¼‚å¸¸</code> æŒ‡çš„æ˜¯å‘½ä»¤æ˜¯å¦æ­£ç¡®ï¼Œé’ˆå¯¹ä¸åŒçš„å¼‚å¸¸ï¼Œredis äº‹åŠ¡å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€è‡´</p><ul><li>å‘½ä»¤é”™è¯¯çš„å¤„ç†æ–¹å¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“æˆ‘åœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œå‘½ä»¤è¾“å…¥æœ‰è¯¯ï¼Œè¿™æ—¶æ•´ä¸ªäº‹åŠ¡éƒ½ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> user zhang</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; sett name hanzhe</span><br><span class="line">(error) ERR unknown <span class="built_in">command</span> `sett`, with args beginning with: `name`, `hanzhe`, </span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line"><span class="comment"># å› ä¸ºäº‹åŠ¡æŠ¥é”™ï¼Œæ‰€ä»¥userå¹¶æ²¡æœ‰å­˜è¿›å»ï¼Œå“ªæ€•ä»–æ˜¯ç¬¬ä¸€æ¡å‘½ä»¤</span></span><br><span class="line">127.0.0.1:6379&gt; get user</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><ul><li>é€»è¾‘é”™è¯¯çš„å¤„ç†æ–¹å¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªå¢çš„å˜é‡æ˜¯å­—ç¬¦è€Œä¸æ˜¯æ•°å­—</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money zhang</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># ç„¶åæˆ‘ä»¬å†æ¥æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incrby money 3000</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; decrby money 188</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> user zhang</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> <span class="comment"># ä»–ä¼šç›´æ¥æç¤ºå‰ä¸¤å¥æ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯ç¬¬ä¸‰å¥æ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">1) (error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line">2) (error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line">3) OK</span><br><span class="line"><span class="comment"># è¿™é‡Œä¹Ÿæ˜¯å¯ä»¥è·å–åˆ°çš„ï¼Œå“ªæ€•ä»–æ˜¯æœ€åä¸€æ¡ï¼Œä¸ç¬¦åˆåŸå­æ€§</span></span><br><span class="line">127.0.0.1:6379&gt; get user</span><br><span class="line"><span class="string">&quot;zhang&quot;</span></span><br></pre></td></tr></table></figure><p>å› ä¸º redis çš„äº‹åŠ¡ç®¡ç†å¹¶ä¸ä¸¥æ ¼ï¼Œæ‰€ä»¥ redis çš„äº‹åŠ¡åˆè¢«äººæˆç§° <strong>ä¼ªäº‹åŠ¡</strong></p><h3 id="ä¹è§‚é”">ä¹è§‚é”</h3><p>åœ¨æˆ‘ä»¬æ‰§è¡Œäº‹åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯å¤„åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæˆ‘é€šè¿‡äº‹åŠ¡å¯¹æŸä¸ªæ•°æ®è¿›è¡Œæ”¹å˜ï¼Œä½†æ˜¯åœ¨æˆ‘å‘½ä»¤ç¼“å­˜å®Œæˆè¿˜æ²¡æœ‰æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦ä¸€æ¡çº¿ç¨‹è¿›æ¥å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿéš¾ä»¥æƒ³è±¡çš„æ”¹å˜ã€‚</p><blockquote><p>æ¨¡æ‹Ÿä¸¾ä¾‹è¯´æ˜ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## çº¿ç¨‹1 å¯åŠ¨äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incrby money 3000</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; decrby money 188 </span><br><span class="line">QUEUED</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## çº¿ç¨‹2 ä¸­é€”æ’å…¥</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 200000</span><br><span class="line">(<span class="built_in">integer</span>) 200100</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## çº¿ç¨‹1 è¿™æ—¶åˆšåˆšæäº¤äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 203000</span><br><span class="line">2) (<span class="built_in">integer</span>) 202812</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ•°æ®è¢«æ”¹å˜äº†ï¼Œç»“æœä¹Ÿé€ æˆå½±å“äº†</p><blockquote><p>ä»€ä¹ˆæ˜¯ä¹è§‚é”ï¼Ÿ</p></blockquote><p>å…³äºé”ï¼Œæœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯ <code>æ‚²è§‚é”</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ <code>ä¹è§‚é”</code>ï¼Œæ‚²è§‚é”ç±»ä¼¼ java ä¸­çš„å¤šçº¿ç¨‹é” <code>synchronized</code>ï¼Œå°†æ•´ä¸ªæ–¹æ³•ä¸Šé”ï¼Œæ— è®ºæ˜¯å¦æœ‰å¤šæ¡çº¿ç¨‹è®¿é—®éƒ½ä¼šå·¥ä½œï¼Œåœ¨å®‰å…¨çš„å‰æä¸‹å½±å“äº†æ€§èƒ½ï¼Œè€Œ <code>ä¹è§‚é”</code> æ˜¯åœ¨æŒ‡ä»¤æ·»åŠ å‰å°†è¢«æ“ä½œçš„é‚£ä¸ª key ç›‘è§†èµ·æ¥ï¼Œå¦‚æœåœ¨æ‰§è¡Œçš„æ—¶å€™å‘ç°ç›®æ ‡ key å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆå°±å°†å½“å‰äº‹åŠ¡å–æ¶ˆä¸æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## çº¿ç¨‹1</span></span><br><span class="line"><span class="comment"># åœ¨å¯åŠ¨äº‹åŠ¡ä¹‹å‰ï¼Œç›‘è§†ç›®æ ‡key</span></span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># å¯åŠ¨äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incrby money 3000</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; decrby money 188</span><br><span class="line">QUEUED</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## çº¿ç¨‹2 ä¸­é€”æ’å…¥</span></span><br><span class="line">127.0.0.1:6379&gt; incrby money 200000</span><br><span class="line">(<span class="built_in">integer</span>) 200100</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## çº¿ç¨‹1 è¿™æ—¶åˆšåˆšæäº¤äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œè¢«ç›‘è§†çš„ key å‘ç”Ÿæ”¹å˜åï¼Œäº‹åŠ¡æ‰§è¡Œå°±è¢«ä¸­æ–­äº†ï¼Œé‚£ä¹ˆä¹‹ååº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><blockquote><p>ä¹è§‚é”å–„å</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å…³é—­å½“å‰äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; discard</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># å…³é—­ç›‘æ§</span></span><br><span class="line">127.0.0.1:6379&gt; unwatch</span><br><span class="line">OK</span><br><span class="line"><span class="comment">## é‡æ–°ç›‘æ§ï¼Œå†èµ°ä¸€éäº‹åŠ¡é€»è¾‘.....</span></span><br><span class="line"><span class="comment">## åœ¨æ‰§è¡Œå‰åœ¨è¿›è¡Œæ¯”å¯¹....</span></span><br></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–ä¿å­˜ç­–ç•¥">æŒä¹…åŒ–ä¿å­˜ç­–ç•¥</h2><p>æˆ‘ä»¬éƒ½æ˜¯åˆ°ï¼Œredis æ˜¯æ“ä½œå†…å­˜çš„æ•°æ®åº“ï¼Œæ­£å› ä¸ºè¿™æ ·çš„ç‰¹ç‚¹æ‰è®©ä»–çš„å­˜å–é€Ÿåº¦ç‰¹åˆ«å¿«ï¼Œä½†æ˜¯åœ¨å†…å­˜ä¸­å­˜æ”¾çš„æ•°æ®ï¼Œå½“æˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡å™¨çš„æ—¶å€™å°±ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ¥è§¦åˆ° <code>æŒä¹…åŒ–</code> è¿™ä¸ªæŠ€æœ¯äº†ï¼ŒæŒä¹…åŒ–å°±æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹ã€‚</p><p>redis çš„æŒä¹…åŒ–æ“ä½œåˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«ä¸º <code>RDB</code> å’Œ <code>AOF</code>ï¼Œä¸¤ç§æ–¹å¼åªèƒ½åŒæ—¶ä½¿ç”¨ä¸€ç§ï¼Œredis ä½¿ç”¨çš„ <strong>é»˜è®¤æŒä¹…åŒ–æ–¹å¼ä¸º RDB</strong>ï¼Œ</p><h3 id="RDB-æ–¹å¼">RDB æ–¹å¼</h3><p>RDB ( Redis DataBase ) æŒä¹…æ–¹å¼ï¼Œä¼šå•èµ·ä¸€æ¡çº¿ç¨‹ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼å†™å…¥ã€ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå†™å…¥æˆåŠŸåé»˜è®¤å­˜æ”¾åˆ° redis çš„å®‰è£…ç›®å½•ä¸‹çš„ <code>dump.rdb</code> æ–‡ä»¶ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨è‡ªå·±çš„é…ç½®å¯åŠ¨çš„ redisï¼Œé‚£ä¹ˆ <code>dump.rdb</code> ä¼šå’Œä½ çš„é…ç½®æ–‡ä»¶åŒçº§ã€‚</p><p>RDB çš„æŒä¹…åŒ–æœ‰ä¸¤ç§è§¦å‘æœºåˆ¶ï¼Œä¸€ç§æ˜¯æ‰‹åŠ¨å‘½ä»¤æŒä¹…åŒ–ï¼Œä¸€ç§æ˜¯è‡ªåŠ¨æŒä¹…åŒ–ã€‚</p><blockquote><p>æ‰‹åŠ¨æŒä¹…åŒ– <code>save</code>ï¼Œ<code>bgsave</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; save</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; bgsave</span><br><span class="line">Background saving started</span><br></pre></td></tr></table></figure><ul><li><code>save</code> å‘½ä»¤ä¼šé˜»å¡å½“å‰ redis æœåŠ¡å™¨ï¼ŒæœŸé—´ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œè¿™ä¸€ç°è±¡ç›´è‡³æ•°æ®ä¿å­˜å®Œæ¯•åæ¢å¤æ­£å¸¸ã€‚</li><li><code>bgsave</code> ä¼šæ‰§è¡Œ fork å­è¿›ç¨‹è´Ÿè´£æŒä¹…åŒ–æ“ä½œï¼Œåœ¨åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™ä¼šæœ‰çŸ­æš‚çš„é˜»å¡ï¼Œæ—¶é—´å¾ˆçŸ­ã€‚</li></ul><p>é™¤å¼€è¿™ç§ä¸»åŠ¨çš„æŒä¹…åŒ–ä¹‹å¤–ï¼Œä¸€äº›å…¶ä»–çš„å‘½ä»¤ä¹Ÿä¼šå®ŒæˆæŒä¹…åŒ–çš„æ“ä½œï¼Œä¾‹å¦‚ï¼š<code>flushall</code>ï¼Œ<code>shutdown</code> ç­‰ç­‰ã€‚</p><blockquote><p>è‡ªåŠ¨æŒä¹…åŒ–</p></blockquote><p>é…ç½®æ–‡ä»¶ä¸­çš„ SNAPSHOTTING æ¨¡å—å°±æ˜¯ç”¨æ¥åš RDB æŒä¹…åŒ–çš„ï¼Œé‡Œé¢æœ‰è¿™æ ·å‡ å¥é…ç½®å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################ SNAPSHOTTING  ################################ å¿«ç…§</span></span><br><span class="line"><span class="comment"># save æ—¶é—´/s æ•°æ®ä¿®æ”¹æ¬¡æ•°</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚ save 900 1ï¼Œå¦‚æœæ•°æ®åªä¿®æ”¹äº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆå°±900ç§’æŒä¹…åŒ–ä¸€æ¬¡</span></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"><span class="comment"># å½“RDBæœ€åä¸€æ¬¡ä¿å­˜å¤±è´¥åï¼Œæ˜¯å¦åœæ­¢æ¥å—æ•°æ®ï¼Œé»˜è®¤yes (å¦åˆ™æ²¡äººçŸ¥é“å®ƒåäº†)</span></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># æ˜¯å¦ä»¥å‹ç¼©å½¢å¼ä¿å­˜ï¼Œé»˜è®¤ä¸ºyes</span></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># æ˜¯å¦æ•ˆéªŒæ•°æ®å®Œæ•´æ€§ï¼Œé»˜è®¤ä¸ºyes</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># æŒä¹…åŒ–ä¿å­˜æ–‡ä»¶å</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="comment"># æŒä¹…åŒ–æ–‡ä»¶ä¿å­˜è·¯å¾„</span></span><br><span class="line"><span class="built_in">dir</span> ./</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æˆ‘ä»¬ä¸éœ€è¦è¯¥ä»–çš„é…ç½®æ–‡ä»¶ï¼Œé¢„è®¾çš„å°±å¤Ÿç”¨äº†ã€‚</p><h3 id="AOF-æ–¹å¼">#####AOF æ–¹å¼#####</h3><p>åŒæ ·è¿˜æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼ŒAPPEND ONLY MODE æ¨¡å—å°±æ˜¯è´Ÿè´£ AOF æŒä¹…åŒ–çš„ï¼Œå’Œ RDB ä¸åŒï¼Œ AOF çš„åŸç†æ˜¯å°†æ‰€æœ‰æ›¾ç»ä½¿ç”¨è¿‡çš„å­˜å…¥æ“ä½œçš„å‘½ä»¤éƒ½è®°å½•ä¸‹æ¥ï¼Œå­˜æ”¾åˆ° <code>appendonly.aof</code> æ–‡ä»¶ä¸­ï¼Œæ˜¯å¯ä»¥çœ‹ä¸ªæ¨¡ç³Šçš„å¤§æ¦‚çš„ã€‚</p><blockquote><p>AOF æŒä¹…åŒ–é…ç½®</p></blockquote><p>AOF ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼Œåªéœ€è¦æ‰§è¡Œ <code>bgrewriteaof</code> å‘½ä»¤å³å¯ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½ç”¨é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œé…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################## APPEND ONLY MODE ############################### ä»…é™„åŠ æ¨¡å¼</span></span><br><span class="line"><span class="comment"># æ˜¯å¦å¼€å¯AOFï¼Œé»˜è®¤ä¸ºno</span></span><br><span class="line">appendonly no</span><br><span class="line"><span class="comment"># æŒ‡å®šæ›´æ–°æ¡ä»¶ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ä¸ªå€¼ï¼š</span></span><br><span class="line"> <span class="comment"># noï¼šæ¯æ¬¡ä¿®æ”¹éƒ½åŒæ­¥ï¼Œæ•°æ®å®Œæ•´æ€§å¼ºï¼Œæ€§èƒ½åä½</span></span><br><span class="line"> <span class="comment"># alwaysï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œæ•°æ®å®Œæ•´æ€§è¾ƒå¥½</span></span><br><span class="line"> <span class="comment"># everysecï¼šè®©æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œæ¶ˆè€—èµ„æºæœ€ä½</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="comment"># ç™¾åˆ†æ¯”ï¼Œå¦‚æœæ•°æ®æ–‡ä»¶å¤§å°å æ®äº†æŒ‡å®šç™¾åˆ†æ¯”ï¼Œä¼šè§¦å‘é‡å†™ã€‚</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"><span class="comment"># å¿…é¡»æ»¡è¶³æœ€å°å¤§å°æ‰å¯ä»¥é‡å†™</span></span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure><blockquote><p>AOF é‡å†™</p></blockquote><ul><li>##########################################################################</li></ul><p>æœ‰å…³äºæŒä¹…åŒ–ç­–ç•¥ï¼Œä»¥åå†ç»†å­¦</p><h3 id="æ¯”è¾ƒRDBå’ŒAOF">æ¯”è¾ƒRDBå’ŒAOF</h3><p><code>RDB</code>ï¼šRDB æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒæŒ‰ç…§æ—¶é—´è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ¯æ¬¡åŒæ­¥éƒ½ä¼šæ‰§è¡Œ fork æ“ä½œï¼Œå¦‚æœä¸ºäº†è¿½æ±‚æ•°æ®æ•°æ®å®Œæ•´æ€§ä¸åœçš„åŒæ­¥ï¼Œä¼šæå¤§çš„å½±å“ redis å·¥ä½œæ•ˆç‡ï¼Œæ›´==é€‚åˆåšå®šæœŸå¤‡ä»½ï¼Œç”¨äºç¾éš¾æ¢å¤==</p><p><code>AOF</code>ï¼šAOF é€šè¿‡è®°å½•å‘½ä»¤å®ç°æŒä¹…åŒ–ï¼Œé€šè¿‡æ§åˆ¶å‚æ•°å¯ä»¥ç²¾ç¡®åˆ°ç§’çº§ã€‚</p><ul><li>##########################################################################</li></ul><p>æœ‰å…³äºæŒä¹…åŒ–ç­–ç•¥ï¼Œä»¥åå†ç»†å­¦</p><h3 id="æ–‡ä»¶æŸåä¿®å¤">æ–‡ä»¶æŸåä¿®å¤</h3><p>å½“æˆ‘ä»¬çš„æ•°æ®æ–‡ä»¶æŸåå¯¼è‡´ redis æ— æ³•å¯åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è¿è¡Œ redis çš„ä¿®å¤å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix é…ç½®æ–‡ä»¶</span><br><span class="line">redis-check-rdb --fix é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>##########################################################################</li></ul><p>æœ‰å…³äºæŒä¹…åŒ–ç­–ç•¥ï¼Œä»¥åå†ç»†å­¦</p><h2 id="Redis-æ•´åˆ">Redis æ•´åˆ</h2><p>æ‰€æœ‰ç¨‹åºå‡æ˜¯ä»¥ maven ä¸ºåŸºç¡€æ­å»ºçš„</p><h3 id="åŸç”Ÿ-Java-æ•´åˆ">åŸç”Ÿ Java æ•´åˆ</h3><p>ä½¿ç”¨ java é¡¹ç›®æ•´åˆ redis è¿›è¡Œæ“ä½œï¼Œé¦–å…ˆè¦æ·»åŠ  maven ä¾èµ–</p><blockquote><p>æ­£å¸¸æ“ä½œ redis</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¾èµ–å®Œæˆåï¼Œä¾¿å¯ä»¥ç›´æ¥é€šè¿‡ java ä»£ç åˆ›å»ºè¿æ¥å¹¶æ“ä½œæ•°æ®åº“äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">redis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;IPåœ°å€&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// éªŒè¯è¿æ¥å¯†ç </span></span><br><span class="line">        redis.auth(<span class="string">&quot;ä½ çš„å¯†ç &quot;</span>);</span><br><span class="line">        <span class="comment">// æ¸…ç©ºå½“å‰æ•°æ®åº“</span></span><br><span class="line">        redis.flushDB();</span><br><span class="line">        <span class="comment">// æ­£å¸¸çš„å¢åˆ æ”¹æŸ¥</span></span><br><span class="line">        System.out.println(redis.ping());</span><br><span class="line">        System.out.println(redis.set(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;zhang&quot;</span>));</span><br><span class="line">        System.out.println(redis.get(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">        <span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">        redis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥åˆ›å»º jedis å¯¹è±¡å°±å¯ä»¥åˆ›å»ºè¿œç¨‹è¿æ¥ï¼Œè€Œä¸”å®ä¾‹å†…çš„æ–¹æ³•å’Œ redis çš„æŒ‡ä»¤ç”¨æ³•ç­‰ç­‰å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œéå¸¸å¥½ç”¨ã€‚</p><blockquote><p>redis è¿æ¥æ± </p></blockquote><p>ä¸€èˆ¬æ¥è¯´ jedis å·²ç»å¯ä»¥å¾ˆå¥½çš„æ“ä½œ redis æ•°æ®åº“äº†ï¼Œä½†æ˜¯åœ¨é¡¹ç›®ä¸­å¦‚æœé¢‘ç¹çš„åˆ›å»ºå’Œå…³é—­è¿æ¥ï¼Œæ˜¯å¾ˆè€—è´¹æœåŠ¡å™¨èµ„æºçš„ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä½¿ç”¨ jedis çš„è¿æ¥æ± è¿›è¡Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨é»˜è®¤çš„è¿æ¥æ± æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisPoolDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºjedisè¿æ¥æ± å¯¹è±¡</span></span><br><span class="line">        <span class="type">JedisPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPool</span>(<span class="string">&quot;IPåœ°å€&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//  ä»è¿æ¥æ± ä¸­è·å–è¿æ¥</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">redis</span> <span class="operator">=</span> pool.getResource();</span><br><span class="line">        <span class="comment">// æ­£å¸¸æ“ä½œjedis</span></span><br><span class="line">        redis.auth(<span class="string">&quot;å¯†ç &quot;</span>);</span><br><span class="line">        redis.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;hanzhe&quot;</span>);</span><br><span class="line">        System.out.println(redis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">        redis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨è‡ªå®šä¹‰é…ç½®çš„è¿æ¥æ± </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisPoolDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥æ± é…ç½®å¯¹è±¡</span></span><br><span class="line">        <span class="type">JedisPoolConfig</span> <span class="variable">poolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½®æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">        poolConfig.setMaxTotal(<span class="number">50</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></span><br><span class="line">        poolConfig.setMaxIdle(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// æŒ‰ç…§æŒ‡å®šçš„é…ç½®åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="type">JedisPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPool</span>(poolConfig, <span class="string">&quot;IPåœ°å€&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// è·å–è¿æ¥åé¢çš„æ“ä½œå°±æ˜¯ä¸€æ ·çš„äº†</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">redis</span> <span class="operator">=</span> pool.getResource();</span><br><span class="line">        <span class="comment">// ........</span></span><br><span class="line">        <span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line">        redis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ£€æŸ¥ redis æ•°æ®åº“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;user&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; mget user name</span><br><span class="line">1) <span class="string">&quot;zhang&quot;</span></span><br><span class="line">2) <span class="string">&quot;hanzhe&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure><p>ç»è¿‡æ£€æŸ¥å‘ç°ï¼Œjava æ“ä½œ redis ä¸å­˜åœ¨å…¶ä»–çš„é—®é¢˜ï¼Œæ•´åˆåŸºæœ¬å®Œæˆã€‚</p><blockquote><p>æ§åˆ¶å°æ‰“å°è­¦å‘Šé—®é¢˜</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SLF4J: Failed to load class <span class="string">&quot;org.slf4j.impl.StaticLoggerBinder&quot;</span>.</span><br><span class="line">SLF4J: Defaulting to no-operation (NOP) logger implementation</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html<span class="comment">#StaticLoggerBinder for further details.</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ§åˆ¶å°æ‰“å°å¦‚ä¸Šçš„è­¦æŠ¥ä¿¡æ¯ï¼Œå¯ä»¥å¼•å…¥ slf4j çš„ maven ä¾èµ–è¿›è¡Œè§£å†³</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Springboot-æ•´åˆ">Springboot æ•´åˆ</h3><p>springboot æ•´åˆåŒæ ·éœ€è¦å¼•å…¥å¯¹åº”çš„ maven ä¾èµ–ï¼Œå’Œ jedis æœ‰äº›è®¸çš„ä¸åŒï¼Œspringboot ä¸­å°è£…çš„ç±»å¹¶ä¸å¯ä»¥ç›´æ¥è°ƒç”¨ç±»ä¼¼å‘½ä»¤çš„å‡½æ•°ï¼Œè€Œæ˜¯å¯¹ä»–ä»¬è¿›è¡Œäº†äºŒæ¬¡å°è£…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># IPåœ°å€</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">IPåœ°å€</span></span><br><span class="line"><span class="comment"># ç«¯å£</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment"># è®¿é—®å¯†ç </span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">å¯†ç </span></span><br><span class="line"><span class="comment"># æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="attr">spring.redis.pool.max-active</span>=<span class="string">50</span></span><br><span class="line"><span class="comment"># æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></span><br><span class="line"><span class="attr">spring.redis.pool.max-idle</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure><blockquote><p>ç®€å•æ“ä½œæ•°æ®åº“</p></blockquote><p>æ“ä½œæ•°æ®åº“ï¼Œéœ€è¦æ³¨å…¥ <code>RedisTemplate</code> å¯¹è±¡è¿›è¡Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Redis2SpringbootApplicationTests</span> &#123;</span><br><span class="line">    <span class="comment">// è‡ªåŠ¨æ³¨å…¥å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯ä»¥æ­£å¸¸è¯»å–å­˜å…¥çš„ user ä¿¡æ¯</span></span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>RedisTemplate</code> å°†æ•°æ®ç±»å‹å¯¹åº”çš„æŒ‡ä»¤å‡½æ•°åˆ†åˆ«å‘½åä¸º <code>opsForValue()</code>ï¼Œ<code>opsForList()</code>ï¼Œ<code>opsForSet()</code>ï¼Œ<code>opsForHash()</code>ï¼Œ<code>opsForHyperLogLog()</code> ï¼Œ<code>opsForZSet()</code></p><blockquote><p>é«˜çº§æ“ä½œæ•°æ®åº“</p></blockquote><p>ä¸Šé¢çš„æ–¹æ³•å°è£…äº†å„ç§æ•°æ®ç±»å‹çš„ç®€å•æ“ä½œï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸€äº›é«˜çº§çš„æ“ä½œäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Redis2SpringbootApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰è¿æ¥</span></span><br><span class="line">        <span class="type">RedisConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> redisTemplate.getConnectionFactory();</span><br><span class="line">        <span class="type">RedisConnection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.getConnection();</span><br><span class="line">        <span class="comment">// pingæµ‹è¯•ï¼Œæ¸…ç©ºåº“ï¼Œåœæ­¢æœåŠ¡ï¼Œå…³é—­è¿æ¥ç­‰ç­‰é«˜çº§æ“ä½œ</span></span><br><span class="line">        System.out.println(connection.ping());</span><br><span class="line">        connection.flushDb();</span><br><span class="line">        connection.flushAll();</span><br><span class="line">        connection.shutdown();</span><br><span class="line">        connection.close();</span><br><span class="line">        <span class="comment">// å¼€å¯äº‹åŠ¡ç­‰ç­‰ç›¸å…³è®¾ç½®ä¹Ÿåœ¨è¿™é‡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¹±ç é—®é¢˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java ä»£ç </span></span><br><span class="line">redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>));</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis æ•°æ®åº“</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;\xac\xed\x00\x05t\x00\x04name&quot;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡ springboot å‘ redis ä¸­æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå‘ç°å­˜è¿›å»çš„å­—ç¬¦ä¸²å­˜åœ¨ä¹±ç é—®é¢˜ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>RedisTemplate</code> çš„å­ç±» <code>StringRedisTemplate</code> è¿›è¡Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Redis2SpringbootApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate string;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        string.opsForValue().set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        System.out.println(string.opsForValue().get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># name ä¹Ÿå¯ä»¥æ­£å¸¸å­˜å–</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;\xac\xed\x00\x05t\x00\x04name&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;zhang&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è‡ªå®šä¹‰ RedisTemplate</p></blockquote><p>å­—ç¬¦ä¸²å¯ä»¥é€šè¿‡ <code>StringRedisTemplate</code> æ¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å­˜å…¥å…¶ä»–ç±»å‹çš„è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜ï¼Œè¿™æ—¶å¯è‡ªå·±åˆ›å»ºä¸€ä¸ª <code>RedisTemplate</code> æ¥ä»£æ›¿åŸæœ¬çš„ç±»å·¥ä½œã€‚<em>ä»£ç æ¥è‡ªäº’è”ç½‘</em></p><p>1.é¦–å…ˆè¦å¼•å…¥ maven ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.åˆ›å»ºé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtil</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="type">StringRedisSerializer</span> <span class="variable">stringRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="comment">// keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™è‡ªå®šä¹‰çš„  å°±å·²ç»å®Œæˆäº†ï¼Œç°åœ¨å†æ¥æµ‹è¯•ä¸€éæ˜¯å¦ä¹±ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Redis2SpringbootApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¹±ç é—®é¢˜å·²ç»è§£å†³ï¼Œè¿™ä¸ªç‰¹æ®Šç¬¦å·æ˜¯å­—ç¬¦ä¸²çš„è½¬ä¹‰</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;\&quot;zhang\&quot;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡åºåˆ—åŒ–å°†å¯¹è±¡å­˜å‚¨åˆ° redis ä¸­</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// implements Serializable åºåˆ—åŒ–æ¥å£ä¸€å®šè¦å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/* çœç•¥get-set-toStringæ–¹æ³• */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Redis2SpringbootApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        p.setUsername(<span class="string">&quot;å¼ æ¶µå“²&quot;</span>);</span><br><span class="line">        p.setPassword(<span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;user&quot;</span>, p);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> å¯ä»¥æ­£å¸¸è¯»å–</span></span><br><span class="line"><span class="comment"> Person&#123;username=&#x27;å¼ æ¶µå“²&#x27;, password=&#x27;zhang&#x27;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="è®¢é˜…ä¸å‘å¸ƒ">è®¢é˜…ä¸å‘å¸ƒ</h2><p>redis çš„è®¢é˜…å‘å¸ƒæ˜¯ä¸€ç§é€šè®¯æ¨¡å¼ï¼Œåˆ†åˆ«ä¸º <code>å‘é€è€…/sub</code> å’Œ <code>è®¢é˜…è€…/pub</code> ä¸¤ç§èº«ä»½ï¼Œå‘å¸ƒè€…è´Ÿè´£å‘é€ä¸€äº›ä¿¡æ¯ï¼Œç„¶åç”±è®¢é˜…è€…æ¥æ”¶ï¼Œæ¶‰åŠåˆ°çš„å‘½ä»¤ä¹Ÿéå¸¸å°‘</p><blockquote><p>æœ€å¸¸ç”¨ï¼šç®€å•ä½¿ç”¨è®¢é˜…å’Œå‘å¸ƒå®Œæˆäº¤äº’ <code>subscribe</code>ï¼Œ<code>publish</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¢é˜…è€… å½“æˆ‘è®¢é˜…s1é¢‘é“çš„æ—¶å€™ï¼Œå‘½ä»¤è¡Œå°±ä¼šè¢«é”å®šï¼Œé™ç­‰s1é¢‘é“å‘é€ä¿¡æ¯</span></span><br><span class="line">127.0.0.1:6379&gt; subscribe s1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;s1&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘å¸ƒè€… åªéœ€è¦åœ¨å›ºå®šçš„é¢‘é“å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸ç”¨è€ƒè™‘è®¢é˜…è€…çŠ¶æ€</span></span><br><span class="line">127.0.0.1:6379&gt; publish s1 haha</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¢é˜…è€… å‘½ä»¤è¡ŒçŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼š</span></span><br><span class="line">1) <span class="string">&quot;message&quot;</span>  <span class="comment"># æç¤ºæ¥å—åˆ°äº†æ¶ˆæ¯</span></span><br><span class="line">2) <span class="string">&quot;s1&quot;</span>     <span class="comment"># å¦‚æœè®¢é˜…äº†å¤šä¸ªï¼Œåœ¨è¿™é‡ŒåŒºåˆ†å‘å¸ƒè€…é¢‘é“</span></span><br><span class="line">3) <span class="string">&quot;haha&quot;</span>    <span class="comment"># é¢‘é“å‘é€çš„æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><h2 id="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</h2><p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®è¶Šåšè¶Šå¤§çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ª redis æœåŠ¡å¯èƒ½å·²ç»ä¸æ”¯æŒæˆ‘ä»¬çš„è¯»å†™æ•ˆç‡äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦é…ç½®å¤šä¸ªæœåŠ¡å™¨ï¼Œåœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šéƒ½é…ç½® redis çš„ç¯å¢ƒï¼Œè®©ä»–ä»¬åˆ†åˆ«ä¸ºä¸€ä¸ªç¨‹åºæä¾›æœåŠ¡ï¼Œè¿™ç§å·¥ä½œæ–¹å¼è¢«ç§°ä¹‹ä¸ºé›†ç¾¤</p><p>åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸­é€‰ä¸­ä¸€å°æœåŠ¡å™¨ä¸ºä¸»æœº ( Master )ï¼Œå…¶ä»–ä¸ºä»æœº ( Slave )ï¼Œä¸»æœºè´Ÿè´£å†™å…¥æ•°æ® ( setâ€¦ )ï¼Œè€Œä»æœºè´Ÿè´£è¯»å–æ•°æ® ( get )ï¼Œä¸ºäº†å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´æ•°æ®åŒæ­¥çš„é—®é¢˜ï¼Œæ‰€ä»¥æœ‰äº†ä¸»ä»å¤åˆ¶çš„æŠ€æœ¯ã€‚</p><p>è¿™é‡Œå¯ä»¥é€šè¿‡å¤åˆ¶å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ç«¯å£å·æ¥å®ç° <code>ä¼ªé›†ç¾¤</code>ï¼Œè®¾ç½® 6379 ä¸ºä¸»æœºï¼Œ6380 ä¸ºä»æœºï¼Œåé¢ç®€ç§°ä¸º 79 å’Œ 80</p><h3 id="é€šè¿‡å‘½ä»¤å®ç°">é€šè¿‡å‘½ä»¤å®ç°</h3><p>é€‰æ‹© 79 ä¸ºä¸»æœºï¼Œè¿æ¥ä¸»æœºè¾“å…¥ <code>info replication</code> å‘½ä»¤å³å¯æŸ¥çœ‹å½“å‰æœºå™¨é…ç½®çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:49e04dfecc70d4b55f17798d80b1d77ac4289c12</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒè¡Œä½ç½®æ˜¾ç¤º role:masterï¼Œä»£è¡¨å½“å‰ç«¯å£æ˜¯ä¸»æœºï¼Œ==redis é»˜è®¤æ¯å°æœºå™¨éƒ½æ˜¯ä¸»æœº==ï¼Œé…ç½®ä¸»ä»å¤åˆ¶åªéœ€è¦é…ç½®ä»æœºå°±å¯ä»¥äº†ã€‚</p><p>é…ç½®ä»æœº <code>slaveof</code> è®¤ä¸»ï¼Œåªéœ€è¦æ‰¾åˆ°ç›®æ ‡ Redis æœåŠ¡å™¨ä½œä¸ºè‡ªå·±çš„ä¸»äººå°±å¯ä»¥äº†ï¼Œè¿™æ ·ä¸€æ¥ä»æœºå°±å¯ä»¥è·å–åˆ°ä¸»æœºçš„æ•°æ®äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 80ï¼Œ81 ç«¯å£</span></span><br><span class="line">127.0.0.1:6380&gt; slaveof localhost 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:7</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:434</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:5ec4f58da9447b03e682d76edb61cbf5e4cf89a2</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:434</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:434</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring ç¬”è®°</title>
    <link href="/2022/08/21/Spring%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/08/21/Spring%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>Spring ç¬”è®°</h1><p>spring æ˜¯åŸºäº java è¯­è¨€çš„è½»é‡çº§çš„ IOC å’Œ AOP å®¹å™¨æ¡†æ¶ï¼Œä½¿ç”¨ spring å¯ä»¥ç®€æ˜“å¼€å‘æµç¨‹ï¼Œé™ä½ä»£ç è€¦åˆåº¦</p><blockquote><p>å®ƒä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ¨¡å—</p></blockquote><table><thead><tr><th>æ¨¡å—</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>core</td><td>æ ¸å¿ƒç±»åº“ï¼Œæä¾› spring çš„ ioc å®¹å™¨æœåŠ¡ï¼Œæ˜¯ spring æ¡†æ¶è¿è¡Œçš„åŸºç¡€</td></tr><tr><td>context</td><td>æä¾›äº† bean çš„è·å–åŠŸèƒ½å’Œè§£æé…ç½®æ–‡ä»¶çš„æœåŠ¡</td></tr><tr><td>aop</td><td>æä¾›äº† aop é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æœåŠ¡</td></tr><tr><td>dao</td><td>æä¾›äº†ç®€å•çš„ JDBC åŠŸèƒ½</td></tr><tr><td>orm</td><td>å¯¹ ORM æ¡†æ¶æä¾›äº†å¾ˆå¥½çš„æ•´åˆæœåŠ¡</td></tr><tr><td>web</td><td>æä¾› web æ–¹é¢çš„æœåŠ¡</td></tr></tbody></table><img src="/img/5.jpg" title="Spring çš„æ¿å—" /><h2 id="ç®€å•Springç¨‹åºå®ä¾‹">ç®€å•Springç¨‹åºå®ä¾‹</h2><h3 id="spring-ç¯å¢ƒæ­å»º">spring ç¯å¢ƒæ­å»º</h3><p>ä½¿ç”¨ Spring éœ€è¦å¯¼å…¥ä»–çš„ maven ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æƒ³è¦ä½¿ç”¨Springæ¡†æ¶éœ€è¦æ·»åŠ ä¸€ä¸ªcontextä¾èµ–ï¼Œä»–ä¼šåŠ è½½springæœ‰å…³çš„å¤šä¸ªjaråŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶çš„ç¼–å†™">é…ç½®æ–‡ä»¶çš„ç¼–å†™</h3><p>åœ¨ IDEA ç¯å¢ƒä¸‹ï¼Œåœ¨é¡¹ç›® resources ç›®å½•ä¸‹æ–°å»º spring config é…ç½®æ–‡ä»¶ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªç®€å•çš„å®ä½“ç±»ï¼Œåœ¨é…ç½®æ–‡ä»¶ä½¿ç”¨ <code>bean</code> æ ‡ç­¾è£…é…è¿™ä¸ª bean (å®ä½“ç±»)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æµ‹è¯•ç±»ä¸­è·å–åˆ°è¿™ä¸ª Bean å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line">    <span class="type">Dog</span> <span class="variable">dog01</span> <span class="operator">=</span> (Dog)ioc.getBean(<span class="string">&quot;dog01&quot;</span>);</span><br><span class="line">    System.out.println(dog01);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring-IOC-å®¹å™¨">Spring IOC å®¹å™¨</h2><p>IOCï¼ˆInver se of Controlï¼‰å¯ç†è§£ä¸ºå®¹å™¨ï¼Œæ˜¯ Spring æ¡†æ¶çš„å’Œæ ¸å¿ƒï¼Œä»–ç®¡ç†ç€ Spring çš„ç»„ä»¶ï¼Œå®ç°äº†æ§åˆ¶åè½¬çš„åŠŸèƒ½ï¼Œä¹‹å‰ç»ƒä¹ é…ç½®çš„ dog å°±æ˜¯æ”¾åœ¨äº† IOC å®¹å™¨ä¸­æ‰å¯ä»¥è·å–å¾—åˆ°</p><h3 id="Bean-å·¥å‚">Bean å·¥å‚</h3><p>Bean å·¥å‚å¯ä»¥ç†è§£ä¸º IOC å®¹å™¨ ï¼Œç”±å®ƒæ¥ä¸ºæˆ‘ä»¬åˆ›å»º Bean çš„å®ä¾‹å¯¹è±¡ï¼Œé€šè¿‡ Bean å·¥å‚çš„å®ä¾‹å¯ä»¥è·å–åˆ°è£…é…åœ¨ IOC ä¸­çš„ Bean çš„å®ä¾‹</p><p>1ã€BeanFactory æ¥å£ï¼šSpringæœ€æ ¸å¿ƒçš„æ¥å£ï¼Œæä¾›äº† IOC é…ç½®æœºåˆ¶ï¼Œé€šå¸¸è¢«ç§°ä¸º IOC å®¹å™¨</p><p>2ã€ApplicationContext æ¥å£ï¼šåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå»ºç«‹åœ¨ Bean å·¥å‚çš„åŸºç¡€ä¸Šï¼Œä»–ä¸‹é¢æœ‰ä¸¤ä¸ªå®ç°ç±»:</p><ol><li>ClassPathXmlApplicationï¼š ä»ç±»è·¯å¾„ ( classpath ) ä¸‹åŠ è½½é…ç½®æ–‡ä»¶</li><li>FileSystemXmlApplicationContextï¼š  ä»æ–‡ä»¶ç³»ç»Ÿ ( urlè·¯å¾„ ) ä¸­åŠ è½½é…ç½®æ–‡ä»¶</li></ol><p><strong>BeanFactory å’Œ ApplicationContextçš„åŒºåˆ«</strong></p><ol><li>BeanFactory ä¼šåœ¨æœ¬èº«å®ä¾‹åŒ–å®Œæˆåï¼Œåœ¨è°ƒç”¨æŸä¸ª getBean çš„æ—¶å€™æ‰ä¼šå®ä¾‹åŒ–é‚£ä¸ªå¯¹åº”çš„ beanï¼Œè€ŒApplicationContext æ˜¯åœ¨åŠ è½½é…ç½®æ–‡ä»¶çš„æ—¶å€™å°±å°†æ‰€æœ‰å•ä¾‹æ¨¡å¼çš„ bean å®ä¾‹åŒ–</li><li>ApplicationContext åœ¨å¯åŠ¨æ—¶å°±ä¼šæ£€æŸ¥ XML æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼Œè€Œ BeanFactory åˆ™æ˜¯åœ¨è·å– Bean æ—¶æ‰ä¼šæ£€æŸ¥</li></ol><h3 id="XML-é…ç½®-Bean">XML é…ç½® Bean</h3><h4 id="Bean-çš„è£…é…ä¸è·å–">Bean çš„è£…é…ä¸è·å–</h4><p>è£…é… Bean éœ€è¦ä½¿ç”¨ <code>bean</code> æ ‡ç­¾è¿›è¡Œè£…é…ï¼Œclass å±æ€§æ¥æŒ‡å®šè¢«è£…é…çš„ç±»ï¼Œid ä½œä¸ºç±»çš„åå­—ä¸å¯é‡å¤</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é€šè¿‡ç±»çš„å…¨é™å®šåï¼ˆåŒ…å+ç±»åï¼‰å‘ŠçŸ¥SpringIOCå®¹å™¨è¦ç®¡ç†å’Œåˆ›å»ºbeanå¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®å¥½XMLåå†ç±»ä¸­è·å–beanå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡ç›®æ ‡é…ç½®æ–‡ä»¶åˆ›å»ºIOCå®¹å™¨å®ä¾‹</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line">    <span class="comment">// é€šè¿‡IOCå®ä¾‹è·å–å…¶ä¸­å·²è£…é…çš„bean(é»˜è®¤è·å–åˆ°çš„æ˜¯Objectç±»å‹çš„å¯¹è±¡ï¼Œéœ€è¦è¿›è¡Œå‘ä¸‹è½¬å‹)</span></span><br><span class="line">    <span class="type">Dog</span> <span class="variable">dog01</span> <span class="operator">=</span> (Dog)ioc.getBean(<span class="string">&quot;dog01&quot;</span>);</span><br><span class="line">    <span class="comment">// æ‰“å°æµ‹è¯•</span></span><br><span class="line">    System.out.println(dog01);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ xml è£…é… bean çš„æ—¶å€™ï¼Œå¯ä»¥å‘ bean ä¸­æ³¨å…¥å‚æ•°ï¼Œæ³¨å…¥å‚æ•°çš„è¿‡ç¨‹å°±å« ==DI ( ä¾èµ–æ³¨å…¥ )==</p><h4 id="é…ç½®æ–‡ä»¶çš„ä¾èµ–æ³¨å…¥">é…ç½®æ–‡ä»¶çš„ä¾èµ–æ³¨å…¥</h4><p>æˆ‘ä»¬å°†ä¸€å¼€å§‹çš„ dog ç±»ä¸­çš„å€¼è®¾ç½®ä¸º nullï¼Œç„¶åé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹æ³•å¯¹å®ä¾‹è¿›è¡Œèµ‹å€¼</p><p>æ­£å¸¸çš„ä¾èµ–æ³¨å…¥æ˜¯ä¾é å±æ€§å†…çš„ ==set æ–¹æ³•ä¾èµ–æ³¨å…¥==çš„ï¼Œå¦‚æœ set æ–¹æ³•ä¸å­˜åœ¨æˆ–å‘½åé”™è¯¯åˆ™ä¼šå½±å“æ­£å¸¸è¿è¡Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog01&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å“ˆå“ˆ&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é™¤å¼€ set ä¾èµ–æ³¨å…¥è¿˜å¯ä»¥é€šè¿‡==æ„é€ æ–¹æ³•ä¾èµ–æ³¨å…¥==ï¼Œåœ¨å®ä½“ç±»ä¸­åˆ›å»ºæ„é€ å™¨ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog01&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å˜¿å˜¿&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¢«æ³¨å…¥çš„ä¸æ˜¯ä¸€èˆ¬ç±»å‹è€Œæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¾‹å¦‚ä¸€ä¸ªäººå…»äº†ç‹—ï¼Œperson ç±»å†…æœ‰ä¸€ä¸ªå±æ€§æ˜¯ dog</p><blockquote><p>==å¼•ç”¨ç±»å‹æ³¨å…¥1==ï¼šä½¿ç”¨ ref å±æ€§æ¥å¼•ç”¨å®šä¹‰è¿‡çš„ bean ( å®šä¹‰çš„Beanä¸åˆ†å…ˆåé¡ºåº )</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog01&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å˜¿å˜¿&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Person&quot;</span> <span class="attr">id</span>=<span class="string">&quot;person1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ææ±Ÿ&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dog01&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>é™¤å¼€è‡ªå®šä¹‰çš„å¼•ç”¨ç±»å‹ä¹‹å¤–ï¼Œjava æœ‰å¾ˆå¤šå¼•ç”¨ç±»å‹ï¼Œä¾‹å¦‚é›†åˆæ•°ç»„</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.pojo.Good&quot;</span> <span class="attr">id</span>=<span class="string">&quot;good&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">value</span>&gt;</span>Goodæµ‹è¯•ç±»<span class="tag">&lt;/<span class="name">value</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span> <span class="tag">&lt;<span class="name">value</span>&gt;</span>listç¬¬ä¸€ä¸ªå…ƒç´ <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>listç¬¬äºŒä¸ªå…ƒç´ <span class="tag">&lt;/<span class="name">value</span>&gt;</span> <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span> <span class="tag">&lt;<span class="name">value</span>&gt;</span>setç¬¬ä¸€ä¸ªå…ƒç´ <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>setç¬¬äºŒä¸ªå…ƒç´ <span class="tag">&lt;/<span class="name">value</span>&gt;</span> <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;key1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;key2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value2&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;arr&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>20<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;user2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æ³¨å…¥ list é›†åˆéœ€è¦åœ¨ <code>property</code> æ ‡ç­¾ä¸‹ä½¿ç”¨ <code>list</code> ä¸‹çš„ <code>value</code> æ¥è¿›è¡Œæ³¨å…¥</li><li>æ³¨å…¥ set é›†åˆåŒ list ä¸€ä¸ªåŸç†ï¼Œåªä¸è¿‡å°† list  è½¬æ¢ä¸º set</li><li>æ³¨å…¥ map é›†åˆéœ€è¦åœ¨ <code>property</code> æ ‡ç­¾ä¸‹ï¼š<ul><li>ä½¿ç”¨ <code>entry</code> ä½œä¸º keyï¼Œè€Œåç”¨ <code>entry</code> çš„å­æ ‡ç­¾ <code>value</code> ä½œä¸º value</li><li>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ <code>entry</code> æ ‡ç­¾ä¸Šä»¥å±æ€§çš„æ–¹å¼ä¼ å…¥ key=â€œâ€ value=â€œâ€</li></ul></li><li>æ³¨å…¥æ•°ç»„åŒ list å’Œ setï¼Œå°†ä¸­é—´æ ‡ç­¾æ¢ä¸º <code>array</code> å³å¯ï¼Œç”¨ <code>value</code> å­æ ‡ç­¾æ¥ä¼ å€¼</li></ul><p>æ‰©å±•ï¼š==åç§°ç©ºé—´æ³¨å…¥==ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  p çš„å‘½åç©ºé—´ï¼Œç„¶åé€šè¿‡å±æ€§çš„æ–¹å¼è¿›è¡Œæ³¨å…¥</p><blockquote><p>p å‘½åç©ºé—´åé¢è·Ÿä¸Šæ³¨å…¥çš„å±æ€§åç§°ï¼Œç„¶åå°†å€¼å¡«å…¥å³å¯ï¼Œéœ€è¦ç•™æ„çš„æ˜¯ p æ ‡ç­¾ä¹Ÿæ˜¯ä¾èµ– set æ–¹æ³•çš„</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">p:value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>p å‘½åç©ºé—´æ˜¯é’ˆå¯¹å±æ€§çš„ set æ–¹æ³•çš„ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±æœ‰é’ˆå¯¹æ„é€ æ–¹æ³•çš„ c å‘½åç©ºé—´</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é€šè¿‡cå‘½åç©ºé—´æ“ä½œæ„é€ æ–¹æ³•å†…çš„æŒ‡å®šå‚æ•°åç§°è¿›è¡Œæ³¨å…¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">c:value</span>=<span class="string">&quot;456&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•å‚æ•°çš„ä¸‹æ ‡é¡ºåºè¿›è¡Œæ³¨å…¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">c:_0</span>=<span class="string">&quot;456&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Bean-åˆ«åé…ç½®">Bean åˆ«åé…ç½®</h4><p>åœ¨ xml ä¸­è£…é…äº†æŸä¸ª bean åï¼Œéœ€è¦é€šè¿‡æ ‡ç­¾çš„ id æˆ–è€… name å€¼ä» IOC å®¹å™¨ä¸­è·å–åˆ°è¯¥ç±»çš„å®ä¾‹ï¼Œé™¤ idï¼Œname å±æ€§ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡åˆ«åæ¥è·å–æŒ‡å®šçš„ beanï¼Œä¸ºè£…é…çš„ bean èµ·åˆ«åéœ€è¦ä½¿ç”¨åˆ° <code>alias</code> æ ‡ç­¾</p><blockquote><p>å°†åä¸º dog çš„ bean èµ·åˆ«åä¸º abcï¼Œè¿™æ ·å‡ºæ¥ dog å¯ä»¥è·å–åˆ°ä¹‹å¤–ï¼Œä½¿ç”¨ abc ä¹Ÿå¯ä»¥è·å–å¾—åˆ°</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å˜¿å˜¿&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;abc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ³¨è§£è£…é…-Bean">æ³¨è§£è£…é… Bean</h3><h4 id="æ­å»º-Junit-æµ‹è¯•ç¯å¢ƒ">æ­å»º Junit æµ‹è¯•ç¯å¢ƒ</h4><p>å› ä¸ºæ³¨è§£æ“ä½œ Bean ä¸ä¼šæ‰‹åŠ¨åˆ›å»º IOC å®¹å™¨ï¼Œæ‰€ä»¥å°±è¦å‡çº§ä¸€ä¸‹ Junit æµ‹è¯•ï¼Œè®©ä»–è‡ªè¡Œåˆ›å»º IOC</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Bean-çš„è£…é…ä¸è·å–-v2">Bean çš„è£…é…ä¸è·å–</h4><p>åœ¨å®ä½“ç±»ä¸Šä½¿ç”¨ <code>@Component</code> æ³¨è§£å°†ä»–è£…é…åˆ° IOC ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;é˜¿æ±ª&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> <span class="string">&quot;é›„æ€§&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰“å¼€æ³¨è§£é…ç½® Bean çš„åŠŸèƒ½ï¼Œå¹¶æ‰«ææ³¨è§£å­˜åœ¨çš„åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;site.hanzhe&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æ³¨è§£è·å– bean</p><blockquote><p>@ContextConfiguration æ³¨è§£æŒ‡å®šé…ç½®æ–‡ä»¶æ¥ç”Ÿæˆ IOC å®¹å™¨</p><p>@RunWith æ³¨è§£æ¥æŒ‡å®šä½¿ç”¨ spring é›†æˆçš„æ³¨è§£ï¼Œå¯ä»¥ä½¿ç”¨ IOC</p><p>@Autowired æ³¨è§£ç”¨äºè‡ªåŠ¨è£…é… IOC å†…ç¬¦åˆæ¡ä»¶çš„ Bean</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:spring.xml&quot;)</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestForAnnotation</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> Dog d;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(d.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ³¨è§£è£…é…çš„ä¾èµ–æ³¨å…¥">æ³¨è§£è£…é…çš„ä¾èµ–æ³¨å…¥</h4><p>==ç®€å•ç±»å‹ä¾èµ–æ³¨å…¥== ( åŒ…æ‹¬ String ) åªéœ€è¦åœ¨è¯¥å˜é‡ä¸Šæ ‡æ³¨ @Valueï¼Œåœ¨æ³¨è§£æ—¶ä¼ å…¥æ³¨å…¥çš„å€¼å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;12&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==å¼•ç”¨ç±»å‹ä¾èµ–æ³¨å…¥==ç›´æ¥ä½¿ç”¨ @Autowired æ³¨è§£è¿›è¡Œæ³¨å…¥å³å¯</p><h4 id="Spring-çš„è‡ªåŠ¨è£…é…">@Spring çš„è‡ªåŠ¨è£…é…</h4><p>AutoWired æ³¨è§£ï¼Œä»–çš„ä½œç”¨æ˜¯è‡ªåŠ¨æ£€æµ‹ IOC å®¹å™¨ä¸­ç¬¦åˆè¢«è£…é…çš„æ¡ä»¶çš„ Bean ç„¶åå°†å…¶è£…é…è¿›æ¥ï¼Œä»–é»˜è®¤æŸ¥æ‰¾ç¬¦åˆçš„æ¡ä»¶æ˜¯ Bean çš„ç±»å‹</p><p>é‚£ä¹ˆä¸€ä¸ªæ–°çš„é—®é¢˜å°±è¯ç”Ÿäº†ï¼Œå¦‚æœ IOC ä¸­æœ‰ä¸¤ä¸ªç±»å‹ä¸€æ ·çš„ Beanï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°å¦ä¸€ä¸ªæ³¨è§£ ==@Qualifier==</p><blockquote><p>åœ¨å‘ IOC ä¸­è£…é… Bean çš„æ—¶å€™ï¼Œç»™ä»–ä¸€ä¸ªåå­—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(value=&quot;dog01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;é˜¿æ±ª&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> <span class="string">&quot;é›„æ€§&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ä½¿ç”¨ @AutoWired è¿›è¡Œè‡ªåŠ¨è£…é…çš„æ—¶å€™é…åˆ @Qualifier ä½¿ç”¨ï¼ŒæŒ‡å®šè¢«è£…é…çš„ bean çš„åç§°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;dog01&quot;)</span></span><br><span class="line">Dog dog;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(dog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="font-color-red-åˆ†å±‚æ³¨è§£â€“è¯­ä¹‰åŒ–-font"><font color="red"><strong>åˆ†å±‚æ³¨è§£â€“è¯­ä¹‰åŒ–</strong></font></h4><table><thead><tr><th>æ³¨è§£</th><th>è¯­ä¹‰åŒ–</th></tr></thead><tbody><tr><td>@Component</td><td>æ³¨è§£è¡¨æ˜å½“å‰ç±»ä¸º Bean , åŒæ—¶å½“æœ‰å…¶ä»–æ— æ³•å½’ç±»çš„ä¹Ÿå¯ä»¥ä½¿ç”¨å½“å‰æ³¨è§£</td></tr><tr><td>@Controller</td><td>é€‚ç”¨äº web å±‚,  ç”¨æ¥æ ‡è¯†å½“å‰ç±»æ˜¯æ§åˆ¶å™¨ç±»</td></tr><tr><td>@Service</td><td>é€‚ç”¨äº service å±‚çš„æ³¨è§£,  ç”¨æ¥ä¹¦å†™é€»è¾‘å¤„ç†</td></tr><tr><td>@Repository</td><td>é€‚ç”¨äº dao å±‚çš„ç±»</td></tr></tbody></table><h3 id="Java-ç±»é…ç½®-Bean">Java ç±»é…ç½® Bean</h3><p>åœ¨ Spring ä¸­å¯ä»¥é€šè¿‡ Java ç±»æ¥é…ç½® beanï¼Œä½†æ˜¯è¿™ç§åšæ³•å¹¶ä¸å¸¸ç”¨ï¼Œäº†è§£å³å¯</p><h4 id="Bean-çš„è£…é…ä¸è·å–-v3">Bean çš„è£…é…ä¸è·å–</h4><p>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨æ¥ä¸“é—¨è£…é… beanï¼Œä½¿ç”¨ ==@Configuration== æ³¨è§£æ ‡è¯†è¯¥ç±»ï¼Œåœ¨é…ç½®ç±»ä¸­ä½¿ç”¨å‡½æ•°æ¥è¿”å›å®ä¾‹å¯¹è±¡ï¼Œåœ¨å‡½æ•°ä¸Šæ·»åŠ  @Bean æ³¨è§£å³å¯å®Œæˆè£…é…ï¼Œ@Bean è¿˜å¯ä»¥ä¼ å…¥å‚æ•°åšä¸º bean çš„åç§°</p><blockquote><p>éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰«æé…ç½®ç±»æ‰å¯ä»¥è¢«ä½¿ç”¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">config</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;dog01&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">getDog01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;dog01&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è£…é…å®Œæˆåè·å–è¯¥ç±»å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;SpringConfig.xml&quot;</span>);</span><br><span class="line">    <span class="type">Dog</span> <span class="variable">dog01</span> <span class="operator">=</span> (Dog)ioc.getBean(<span class="string">&quot;dog01&quot;</span>);</span><br><span class="line">    System.out.println(dog01);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Beançš„ä½œç”¨åŸŸ">Beançš„ä½œç”¨åŸŸ</h3><p>Bean çš„ä½œç”¨åŸŸæœ‰å¸¸è§çš„å‡ ç§ï¼šå•ä¾‹ï¼Œå¤šä¾‹ï¼Œrequestã€session, globalï¼Œbean çš„ä½œç”¨åŸŸçš„é…ç½®æ–¹æ³•æ˜¯åœ¨ Spring ä¸­é…ç½® bean çš„æ—¶å€™åœ¨ bean æ ‡ç­¾ä¸Šæ·»åŠ çš„ scope å±æ€§</p><table><thead><tr><th>ä½œç”¨åŸŸ</th><th>æ•ˆæœåŠä½œç”¨</th></tr></thead><tbody><tr><td>singleton</td><td>å•ä¾‹æ¨¡å¼ï¼Œé»˜è®¤ä½œç”¨åŸŸ,å•ä¾‹æ¨¡å¼ä¸‹çš„æ‰€æœ‰ç»„ä»¶éƒ½åœ¨iocå¯åŠ¨å®Œæ¯•ä¹‹å‰å®Œæˆæ³¨å†Œ,è¡¨ç¤ºspring IOCä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ªBeanå®ä¾‹</td></tr><tr><td>prototype</td><td>åŸå‹æ¨¡å¼ï¼Œiocå®¹å™¨å¯åŠ¨æ—¶ä¸ä¼šæ³¨å†Œç»„ä»¶ï¼Œä»€ä¹ˆæ—¶å€™è·å–beanï¼Œä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œæ¯æ¬¡è·å–beanæ—¶éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹</td></tr><tr><td>request</td><td>æ¯æ¬¡Httpè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanï¼Œåˆ‡è¿™ä¸ªBeanåªåœ¨å½“å‰requestå†…æœ‰æ•ˆ</td></tr><tr><td>session</td><td>åŒä¸€ä¸ªSessionä¸­å…±äº«Beanå®ä¾‹ï¼Œä¸åŒçš„Sessionè¯·æ±‚ä¼šåˆ›å»ºæ–°çš„Beanå®</td></tr><tr><td>globalSession</td><td>åœ¨ä¸€ä¸ªå…¨å±€Sessionä¸­ï¼Œå®¹å™¨ä¼šè¿”å›è¯¥Beançš„åŒä¸€ä¸ªå®ä¾‹ï¼Œä»…é€‚ç”¨äºPortletåº”ç”¨ç¯å¢ƒ</td></tr></tbody></table><h3 id="Beançš„ç”Ÿå‘½å‘¨æœŸ">Beançš„ç”Ÿå‘½å‘¨æœŸ</h3><p>Beançš„ç”Ÿå‘½å‘¨æœŸæ˜¯æŒ‡Beanä»åˆ›å»ºåˆ°é”€æ¯çš„è¿‡ç¨‹ï¼Œåœ¨Springä¸­é…ç½®Beanä¹‹åï¼Œåœ¨åŠ è½½Springæ ¸å¿ƒé…ç½®æ–‡ä»¶çš„æ—¶å€™åˆå§‹åŒ–ï¼Œè°ƒç”¨ close æ–¹æ³•çš„æ—¶å€™é”€æ¯ï¼Œå¯ä»¥åœ¨xmlä¸­é…ç½®Beançš„æ—¶å€™,é€šè¿‡Beanæ ‡ç­¾ä¸­çš„å±æ€§æ§åˆ¶è®©ä»–åœ¨åˆå§‹åŒ–å’Œé”€æ¯çš„æ—¶å€™å¯ä»¥æ‰§è¡Œä»€ä¹ˆæ–¹æ³•</p><p>å½“ä½¿ç”¨ XML é…ç½® Bean çš„æ—¶å€™</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.pojo.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®Beançš„æ—¶å€™æŒ‡å®šäº†init-methodå’Œdestroy-methodä¸¤ä¸ªå±æ€§,  ä»–ä»¬åˆ†åˆ«ä»£è¡¨ç€:</p><ol><li><p>init-method=â€œinitâ€   åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œå½“å‰ Bean ä¸­åç§°ä¸º init çš„æ–¹æ³•</p></li><li><p>destroy-method=â€œdestroyâ€   åœ¨é”€æ¯çš„æ—¶å€™æ‰§è¡Œå½“å‰ Bean ä¸­åç§°ä¸º destroy çš„æ–¹æ³•</p></li></ol><blockquote><p>æ³¨æ„: åˆå§‹åŒ–æ–¹æ³•çš„æ‰§è¡Œä¼˜å…ˆçº§ä½äºæ„é€ æ–¹æ³•</p></blockquote><h3 id="Spring-çš„æ‡’åŠ è½½">Spring çš„æ‡’åŠ è½½</h3><p>åœ¨ Spring ä¸­çš„ ClassPathXmlApplicationContext ä¸­ï¼Œé»˜è®¤åªè¦å°† bean è£…é…è¿›å»ï¼Œæ— è®ºæ˜¯å¦ä½¿ç”¨äº†ä»–ï¼Œéƒ½ä¼šå¯¹ Bean è¿›è¡Œå®ä¾‹åŒ– ( è¿™ä¸€ç‚¹é€šè¿‡æ„é€ å‡½æ•°å¯ä»¥ä½“ç° )ï¼Œä½†æ˜¯é…ç½® Bean çš„æ—¶å€™å¯ä»¥ä¸ºä»–æ‰‹åŠ¨è®¾ç½®ä¸€ä¸ªå±æ€§ï¼Œè®© IOC ä¸å¯¹å®ƒè¿›è¡Œè‡ªåŠ¨å®ä¾‹åŒ–ï¼Œè¿™ä¸ªå«åš ==bean çš„æ‡’åŠ è½½==ï¼Œé€šè¿‡è£…é… bean æ—¶çš„ lazy-init å±æ€§æ¥æ§åˆ¶</p><blockquote><p>dog01 æ­£å¸¸è£…é…ï¼Œåœ¨åˆ›å»º IOC å®¹å™¨çš„æ—¶å€™ä¼šè‡ªåŠ¨å®ä¾‹åŒ–ï¼Œè€Œ dog02 åˆ™ä¼šåœ¨ä½¿ç”¨ getBean åæ‰ä¼šå®ä¾‹åŒ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dog01&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog02&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.bean.Dog&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dog02&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ•´åˆå¤šä¸ªé…ç½®æ–‡ä»¶">æ•´åˆå¤šä¸ªé…ç½®æ–‡ä»¶</h3><p>æˆ‘ä»¬åœ¨å†™ç¨‹åºçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå°†é…ç½®ä¿¡æ¯åˆ†å¼€ä¸º n å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ spring æœ¬èº«çš„é…ç½®æ–‡ä»¶ï¼Œæ•´åˆ mybatis ä»¥åŠ mvc ç­‰ç­‰ï¼Œå½“æˆ‘ä»¬ä¹¦å†™äº†å¤šä¸ªé…ç½®æ–‡ä»¶çš„æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å°†ä»–ä»¬æ•´åˆèµ·æ¥ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å°†æŒ‡å®šçš„xmlæ–‡ä»¶æ•´åˆåˆ°å½“å‰æ–‡ä»¶ä¸­--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-mybatis.xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="AOP-é¢å‘åˆ‡é¢ç¼–ç¨‹">AOP é¢å‘åˆ‡é¢ç¼–ç¨‹</h2><p>åœ¨ Spring ä¸­ä½¿ç”¨ AOP éœ€è¦å¼•å…¥ aspect çš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="AOP-çŸ¥è¯†æ¢³ç†">AOP çŸ¥è¯†æ¢³ç†</h3><p>AOP æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹æ€æƒ³ï¼Œåº•å±‚åŸºäºåŠ¨æ€ä»£ç†æŠ€æœ¯ ( JDK OR CGLIB ) å®ç°çš„é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œåœ¨ä¸å½±å“æºä»£ç çš„æƒ…å†µä¸‹åŠ¨æ€å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ <strong>äº‹åŠ¡æ§åˆ¶</strong>ï¼Œ<strong>æ—¥å¿—è®°å½•</strong> ç­‰ç­‰ï¼ŒSpring ( 5.1.5 ) æ¡†æ¶é»˜è®¤é€‰ç”¨çš„æ˜¯ JDKåŠ¨æ€ä»£ç†æŠ€æœ¯</p><blockquote><p>AOP ä¸“ä¸šåè¯æ¢³ç†</p></blockquote><p>å­¦ä¹  AOP ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹å…³äº AOP çš„ä¸€äº›ä¸“ä¸šåè¯ï¼Œä¸å¿…æ­»è®°ç¡¬èƒŒï¼Œäº†è§£å³å¯ï¼š</p><table><thead><tr><th>AOP</th><th>æ–‡å­—è§£é‡Š</th></tr></thead><tbody><tr><td>aspect åˆ‡é¢</td><td>ä»–æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥å¤„ç†AOPçš„ç±»ï¼Œé‡Œé¢å°è£…ç€åˆ‡é¢éœ€è¦æ‰§è¡Œçš„æ–¹æ³•</td></tr><tr><td>advice é€šçŸ¥</td><td>ä»£ç å¢å¼ºåéƒ½å¹²äº†äº›ä»€ä¹ˆï¼ŒæŒ‡é€šçŸ¥çš„å†…å®¹ï¼Œåˆ‡é¢ç±»ä¸­å…·ä½“æ‰§è¡Œçš„æ–¹æ³•</td></tr><tr><td>joinpoint è¿æ¥ç‚¹</td><td>ä»£è¡¨æ‰€æœ‰å¯ä»¥è¢«å¢å¼ºçš„æ–¹æ³•</td></tr><tr><td>pointcut åˆ‡å…¥ç‚¹</td><td>å¯å¢å¼ºçš„æ–¹æ³•æœªå¿…ä¼šå»å¢å¼ºï¼Œè€ŒçœŸæ­£è¢«å¢å¼ºçš„æ–¹æ³•å°±æ˜¯åˆ‡å…¥ç‚¹</td></tr></tbody></table><p>ä¸Šé¢æåˆ°é€šçŸ¥å°±æ˜¯å…·ä½“å¢å¼ºçš„æ–¹æ³•ï¼ŒAOP ä¸­çš„é€šçŸ¥ç±»å‹å…±æœ‰äº”ç§:</p><table><thead><tr><th>AOP</th><th>æ–‡å­—è§£é‡Š</th></tr></thead><tbody><tr><td>Before å‰ç½®é€šçŸ¥</td><td>ç›®æ ‡æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰æ‰§è¡Œ</td></tr><tr><td>AfterReturning è¿”å›é€šçŸ¥</td><td>ç›®æ ‡æ–¹æ³•<strong>æ­£å¸¸è¿è¡Œ</strong>ç»“æŸåæ‰§è¡Œ</td></tr><tr><td>AfterThrowing å¼‚å¸¸é€šçŸ¥</td><td>ç›®æ ‡æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æ‰§è¡Œ</td></tr><tr><td>After åç½®é€šçŸ¥</td><td>æ— è®ºç›®æ ‡æ–¹æ³•æ˜¯å¦æ­£å¸¸ç»“æŸéƒ½ä¼šæ‰§è¡Œ</td></tr><tr><td>Around ç¯ç»•é€šçŸ¥</td><td>é€šçŸ¥åŒ…è£¹äº†ç›®æ ‡æ–¹æ³•ï¼Œåˆ†åˆ«åœ¨è°ƒç”¨å‰åæ‰§è¡Œçš„é€šçŸ¥åŠŸèƒ½</td></tr></tbody></table><blockquote><p>é€šè¿‡å¼‚å¸¸æ•è·æœºåˆ¶å½¢è±¡çš„ç†è§£AOP</p></blockquote><p>AOP æ˜¯åœ¨ä¸å½±å“æºä»£ç çš„æƒ…å†µä¸‹å¢å¼ºåŠŸèƒ½ï¼Œé‚£ä¹ˆæ—¢ç„¶æ˜¯å¢å¼ºåŠŸèƒ½å°±ä¸€å®šè¦æ³¨æ„æ‰§è¡Œçš„æ—¶æœºï¼Œä¸Šé¢çš„äº”ç§é€šçŸ¥ç±»å‹å°±å¯¹åº”ç€å„ç§æ‰§è¡Œçš„æ—¶æœºï¼Œæˆ‘ä»¬æ¥é€šè¿‡å¼‚å¸¸æ•è·æœºåˆ¶æ¥å…·ä½“äº†è§£ä¸€ä¸‹ï¼š</p><img src="/img/spring-01.jpg" style="float: left" /><h3 id="Execution-è¡¨è¾¾å¼">Execution è¡¨è¾¾å¼</h3><p><code>execution</code> è¡¨è¾¾å¼æ˜¯ç”¨æ¥åœ¨è¿æ¥ç‚¹ä¸­åŒ¹é…åˆ‡ç‚¹ä½¿ç”¨çš„ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ä½¿ç”¨æ–¹æ³•ï¼Œåé¢ä¼šç”¨åˆ°</p><blockquote><p>executionè¡¨è¾¾å¼è¯­æ³• <strong>ï¼ˆ&lt;ä¿®é¥°ç¬¦&gt;?&lt;è¿”å›å€¼ç±»å‹&gt;ç©ºæ ¼&lt;å…¨é™å®šç±»å&gt;&lt;æ–¹æ³•å&gt;(å‚æ•°åˆ—è¡¨)&lt;å¼‚å¸¸&gt;ï¼‰</strong></p></blockquote><p>é€šé…ç¬¦è§£é‡Šï¼š</p><ul><li><p>ã€*ã€‘åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œå¯ä»¥ä»£æ›¿è¿”å›å€¼ç±»å‹ï¼Œæ–¹æ³•åï¼ŒåŒ…åï¼Œå‚æ•°åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š</p><ul><li>execution(public <em>*</em> site.hanzhe.service.**<em>Service.</em>**User(String, <em>*</em>))</li><li>åŒ¹é… public ä¿®é¥°ç¬¦ï¼Œä»»æ„è¿”å›å€¼ç±»å‹ï¼Œsite.hanzhe.service åŒ…ä¸‹æ‰€æœ‰ Service ç»“å°¾çš„ç±»ä¸­çš„æ‰€æœ‰ User ç»“å°¾çš„æ–¹æ³•ï¼Œå…¶ä¸­è¦æ±‚æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Stringï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä»»æ„ç±»å‹å‚æ•°</li></ul></li><li><p>ã€â€¦ã€‘* åŒ¹é…çš„æ˜¯å­—ç¬¦å•ä½ï¼Œâ€¦ åŒ¹é…çš„æ˜¯æ•°é‡å•ä½ï¼Œå¯ä»¥ä½¿ç”¨åœ¨åŒ…åï¼Œå‚æ•°åˆ—è¡¨ä¸­ï¼Œä¾‹å¦‚ï¼š</p><ul><li>execution(* site*â€¦<em>*Service.*User(</em>â€¦*))</li><li>public ä¿®é¥°ç¬¦å¯ä»¥çœç•¥ä¸å†™ï¼ŒåŒ¹é…ä»»æ„è¿”å›å€¼ç±»å‹çš„ site ä¸‹çš„æ‰€æœ‰åŒ…ä»¥åŠå­åŒ…ä»¥ Service ç»“å°¾çš„æ‰€æœ‰ç±»ä¸­ä»¥ User ç»“å°¾çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ–¹æ³•ä¸­å¯ä»¥æœ‰ä»»æ„æ•°é‡åŠç±»å‹çš„å‚æ•°åˆ—è¡¨</li></ul></li></ul><h3 id="XMLé…ç½®AOP">XMLé…ç½®AOP</h3><p>æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªåŸºæœ¬ç±»ï¼Œä¸€ä¸ªåˆ‡é¢ç±»ç”¨æ¥å­˜æ”¾é€šçŸ¥æ–¹æ³•ï¼Œä¸€ä¸ª service ç±»ç”¨æ¥å­˜æ”¾è¢«å¢å¼ºçš„ç›®æ ‡ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ—¥å¿—åˆ‡é¢ç±»ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€å‰ç½®é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€è¿”å›é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€åç½®é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€å¼‚å¸¸é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº Spring ( 5.1.5 ) é»˜è®¤é€‰ç”¨ JDKåŠ¨æ€ä»£ç†å®ç° AOPï¼Œæ‰€ä»¥å¯¹äºè¢«å¢å¼ºçš„ç±»éœ€è¦å®ç°ä¸€ä¸ªæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Serviceæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String name, String addr)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsUser</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Serviecå®ç°ç±»ï¼Œä¹Ÿå°±æ˜¯è¢«å¢å¼ºçš„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String name, String addr)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;ç”¨æˆ·æ·»åŠ æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">existsUser</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·å·²å­˜åœ¨&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬çš„ç±»æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä¹¦å†™ Spring çš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- AOPçš„åç§°ç©ºé—´ï¼š http://www.springframework.org/schema/aop --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å°†åˆ‡é¢ç±»ä»¥åŠè¢«å¢å¼ºçš„ç±»éƒ½äº¤ç»™IOCå®¹å™¨ç®¡ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;logAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.aspect.LogAspect&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.hanzhe.service.impl.UserServiceImpl&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®AOPæ¨ªåˆ‡é€»è¾‘ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;toInsertUserGlobal&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">   execution(* site.hanzhe.service.impl.UserServiceImpl.insertUser(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logAspect&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;toInserUser&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">            execution(* site.hanzhe.service.impl.UserServiceImpl.insertUser(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;toInserUser&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturning&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;toInserUser&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">pointcut-ref</span>=<span class="string">&quot;toInsertUserGlobal&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">            execution(* site.hanzhe.service.impl.UserServiceImpl.insertUser(..))&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¹¦å†™å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æµ‹è¯•ç±»è·å–å¯¹è±¡æµ‹è¯•äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span></span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;classpath:spring.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService)ioc.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.insertUser(<span class="string">&quot;Jerry&quot;</span>, <span class="string">&quot;111222333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•ç±»åå‘ç°ï¼Œå¢å¼ºä»£ç æˆåŠŸè¿è¡Œï¼<em>é€šçŸ¥æ‰§è¡Œé¡ºåºä¸ºï¼šå‰ç½®â†’ç›®æ ‡ä»£ç â†’è¿”å›â†’åç½®</em>ï¼Œæˆ‘ä»¬åœ¨ Service å®ç°ç±»ä¸­æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªå¼‚å¸¸åå†æ¥æµ‹è¯•ï¼š<em>é€šçŸ¥æ‰§è¡Œé¡ºåºä¸ºï¼šå‰ç½®â†’ç›®æ ‡ä»£ç â†’å¼‚å¸¸â†’åç½®</em></p><p>è¿™é‡Œä¸»è¦æ¢³ç†ä¸€ä¸‹ <code>aop:config</code> æ ‡ç­¾çš„å†…å®¹ï¼š</p><ul><li>aop:config æ‰€æœ‰æ¨ªåˆ‡é…ç½®éƒ½åœ¨è¿™ä¸ªæ ‡ç­¾ä¸­å®ç°<ul><li>aop:pointcut å…¨å±€åˆ‡å…¥ç‚¹ï¼Œå¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªåˆ‡é¢ä¸­å¼•ç”¨</li><li>aop:aspect åˆ‡é¢ï¼Œå¯ä»¥é…ç½®é€šçŸ¥å’Œåˆ‡å…¥ç‚¹çš„ç»“åˆ<ul><li>aop:pointcut å±€éƒ¨åˆ‡å…¥ç‚¹</li><li>aop:beforeâ€¦ é€šçŸ¥ï¼Œé…åˆåˆ‡é¢ç±»çš„æ–¹æ³•å’Œåˆ‡å…¥ç‚¹è¿›è¡Œç»“åˆ</li></ul></li></ul></li></ul><p>XML é…ç½® AOP éœ€è¦æ³¨æ„ï¼šé€šçŸ¥æ‰§è¡Œçš„é¡ºåºæ˜¯ä¾é åœ¨ XML é…ç½®çš„å…ˆåé¡ºåºæ‰§è¡Œçš„ï¼Œæ¯”å¦‚æ­£å¸¸çš„æ‰§è¡Œé¡ºåºæ˜¯ã€å‰ç½®â†’ç›®æ ‡ä»£ç â†’è¿”å›â†’åç½®ã€‘ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å°†åç½®å’Œè¿”å›çš„é¡ºåºè°ƒæ¢ä¸€ä¸‹å°±ä¼šå‘ç°ï¼Œæ‰§è¡Œçš„é¡ºåºä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><h3 id="æ³¨è§£é…ç½®-AOP">æ³¨è§£é…ç½® AOP</h3><p>æš‚æ—¶ä¿æŒåˆ‡é¢ç±»å’Œ service ä¸å˜ï¼Œå…ˆä¿®æ”¹é…ç½®æ–‡ä»¶ä¸ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼€å¯Springæ³¨è§£å¼€å‘ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯AOPæ³¨è§£å¼€å‘ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®æ‰«æåŒ…è·¯å¾„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;site.hanzhe.service.impl, site.hanzhe.aspect&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰¾åˆ°åˆ‡é¢ç±»ï¼Œæ·»åŠ å¯¹åº”çš„æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span>     <span class="comment">// å£°æ˜è¿™æ˜¯ä¸ªåˆ‡é¢ç±»</span></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">// å°†åˆ‡é¢ç±»æ·»åŠ åˆ°IOCå®¹å™¨ä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="comment">// ç±»ä¼¼ aop:pointcut æ ‡ç­¾</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* site.hanzhe.service.impl.UserServiceImpl.insertUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">// é€šçŸ¥ä¸æ³¨è§£éƒ½æ˜¯äº’ç›¸å¯¹åº”çš„</span></span><br><span class="line">    <span class="meta">@Before(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€å‰ç½®é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€è¿”å›é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€åç½®é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€å¼‚å¸¸é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å°†å®ç°ç±»æ·»åŠ åˆ° IOC å®¹å™¨ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123; ...... &#125;</span><br></pre></td></tr></table></figure><p>æœ€åæ¥è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        userService.insertUser(<span class="string">&quot;Jerry&quot;</span>, <span class="string">&quot;111222333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç æ­£å¸¸æ‰§è¡Œï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ³¨è§£å¼€å‘AOPæ—¶é€šçŸ¥æ‰§è¡Œçš„é¡ºåºå¹¶ä¸ä¼šè¢«æ–¹æ³•å£°æ˜çš„é¡ºåºæ‰€å½±å“ï¼Œ<em>æ³¨è§£é€šçŸ¥çš„é¡ºåºä¸ºï¼šå‰ç½®â†’ç›®æ ‡ä»£ç â†’åç½®â†’è¿”å›</em></p><h3 id="JoinPoint-å¯¹è±¡">JoinPoint å¯¹è±¡</h3><p>åœ¨ä½¿ç”¨ AOP çš„æ—¶å€™ï¼Œé’ˆå¯¹æŸä¸ªæ–¹æ³•è¿›è¡Œå‰ç½®æˆ–è€…åç½®é€šçŸ¥ï¼Œä¸ä¼šåªæœ‰æ‰“å°è¯­å¥è¿™ä¹ˆç®€å•ï¼Œåº”è¯¥å¯¹ç›®æ ‡æ–¹æ³•è·å–ä¸€äº›æœ‰ä»·å€¼çš„ä¿¡æ¯è¿›è¡Œæ“ä½œæ‰å¯¹ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨åˆ° <code>JoinPoint</code> å¯¹è±¡æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè·å–</p><p>å¯ä»¥é€šè¿‡ <code>JoinPoint</code> è·å–åˆ°ç›®æ ‡ <strong>æ–¹æ³•å</strong> åŠ <strong>å‚æ•°åˆ—è¡¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="comment">// å½“å‰åˆ‡é¢ç±»ä¸­å…¬ç”¨çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* site.hanzhe.service.impl.UserServiceImpl.insertUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">point</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Before(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint point)</span>&#123;</span><br><span class="line">        System.out.println(</span><br><span class="line">            <span class="string">&quot;========&gt;ã€å‰ç½®é€šçŸ¥ã€‘&quot;</span></span><br><span class="line">            + point.getSignature().getName() </span><br><span class="line">            + <span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†ï¼Œæºå¸¦çš„å‚æ•°æœ‰ï¼š&quot;</span> </span><br><span class="line">            + Arrays.asList(point.getArgs())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤å¼€è·å–è¿™ä¸¤ç§ä¿¡æ¯ä¹‹å¤–ï¼Œå½“æ–¹æ³•å¤„ç†å®Œæˆæ—¶æ‰€å¾—åˆ°çš„==è¿”å›å€¼==ä¹Ÿå¯ä»¥è·å–å¾—åˆ°</p><blockquote><p>åœ¨åˆ‡é¢å‚æ•°åˆ—è¡¨ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡ç”¨æ¥æ¥å—è¿”å›å€¼ï¼Œç„¶åé€šè¿‡æ³¨è§£ä¸­çš„ returning</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* site.hanzhe.service.impl.UserServiceImpl.insertUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;pointcut()&quot;, returning = &quot;r&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object r)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€è¿”å›é€šçŸ¥ã€‘è¿”å›çš„ç»“æœä¸ºï¼š&quot;</span> + r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶èƒ½è·å–åˆ°è¿”å›å€¼ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºæŠ›å‡ºå¼‚å¸¸æ—¶ä¹Ÿå¯ä»¥è·å–==å¼‚å¸¸ä¿¡æ¯==</p><blockquote><p>åŒè¿”å›å€¼ä¸€ä¸ªåŸç†ï¼Œé€šè¿‡åœ¨æ³¨è§£ä¸­ä½¿ç”¨å±æ€§æ¥è·å–åˆ°å¼‚å¸¸ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;pointcut()&quot;, throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">( Exception e )</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========&gt;ã€å¼‚å¸¸é€šçŸ¥ã€‘å¼‚å¸¸ä¿¡æ¯ä¸ºï¼š&quot;</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼ºå¤§çš„ç¯ç»•é€šçŸ¥">å¼ºå¤§çš„ç¯ç»•é€šçŸ¥</h3><p>åœ¨ spring çš„ aop ä¸­ï¼Œæ‰€æœ‰é€šçŸ¥çš„ä½¿ç”¨æ–¹æ³•å‡ ä¹éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œåœ¨ xml æˆ–è€…ä½¿ç”¨æ³¨è§£è¿›è¡Œé…ç½®ï¼ŒåŒ¹é…åˆé€‚çš„æ—¶æœºè¿›è¡Œåˆ‡å…¥å³å¯ï¼Œæˆ‘ä»¬å­¦è¿‡çš„é€šçŸ¥æœ‰ <strong>å‰ç½®é€šçŸ¥ï¼Œåç½®é€šçŸ¥ï¼Œè¿”å›é€šçŸ¥ï¼Œå¼‚å¸¸é€šçŸ¥</strong> ï¼Œå››ç§é€šçŸ¥åˆ†åˆ«å¯¹åº”ä¸åŒçš„æ—¶æœºè¿›è¡Œåˆ‡å…¥ï¼Œè€Œç¯ç»•é€šçŸ¥ä¸€ä¸ªå°±å¯ä»¥ä»£æ›¿ä¸Šé¢å››ä¸ªé€šçŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* site.hanzhe.service.impl.UserServiceImpl.insertUser(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="meta">@Around(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point)</span>&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">r</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(</span><br><span class="line">                <span class="string">&quot;========&gt;ã€ç¯ç»•-å‰ç½®é€šçŸ¥ã€‘&quot;</span> + point.getSignature().getName()</span><br><span class="line">                + <span class="string">&quot;æ–¹æ³•æ‰§è¡Œäº†ï¼Œæºå¸¦çš„å‚æ•°æœ‰ï¼š&quot;</span></span><br><span class="line">                + Arrays.asList(point.getArgs())</span><br><span class="line">            );</span><br><span class="line">            r = point.proceed(point.getArgs());</span><br><span class="line">            System.out.println(<span class="string">&quot;========&gt;ã€ç¯ç»•-è¿”å›é€šçŸ¥ã€‘è¿”å›çš„ç»“æœä¸ºï¼š&quot;</span> + r);</span><br><span class="line">        &#125; <span class="keyword">catch</span> ( Throwable e ) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;========&gt;ã€ç¯ç»•-å¼‚å¸¸é€šçŸ¥ã€‘å¼‚å¸¸ä¿¡æ¯ä¸ºï¼š&quot;</span> + e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;========&gt;ã€ç¯ç»•-åç½®é€šçŸ¥ã€‘é€šçŸ¥æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¯ç»•é€šçŸ¥éœ€è¦ <code>ProceedingJoinPoint</code> ä½œä¸ºå‚æ•°åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>ProceedingJoinPoint</code> å®ä¾‹æ¥è‡ªå·±æŒæ§æ–¹æ³•çš„è°ƒç”¨æ—¶æœºï¼Œ<em>æ–¹æ³•å¿…é¡»è¦è°ƒç”¨ï¼Œè€Œä¸”è°ƒç”¨åçš„ç»“æœå¿…é¡»è¿”å›</em></p><p>ç»“åˆç¯ç»•é€šçŸ¥åçš„æ‰§è¡Œé¡ºåº ( æ³¨è§£é…ç½® )ï¼š</p><ul><li>æ­£å¸¸æ‰§è¡Œï¼šç¯ç»•å‰ç½®â†’å‰ç½®â†’ç›®æ ‡ä»£ç â†’ç¯ç»•è¿”å›â†’ç¯ç»•åç½®â†’åç½®â†’è¿”å›</li><li>æŠ›å‡ºå¼‚å¸¸ï¼šç¯ç»•å‰ç½®â†’å‰ç½®â†’ç›®æ ‡ä»£ç â†’ç¯ç»•å¼‚å¸¸â†’ç¯ç»•åç½®â†’åç½®â†’è¿”å›<ul><li>è¿™é‡Œå› ä¸ºç¯ç»•æ‰§è¡Œä¼˜å…ˆçº§è¾ƒé«˜ï¼Œåœ¨ç¯ç»•å¼‚å¸¸ä¸­å¤„ç†ä¹‹åæ™®é€šå¼‚å¸¸é€šçŸ¥å°±æ£€æµ‹ä¸åˆ°äº†ï¼Œæ‰€ä»¥æ‰§è¡Œè¿”å›é€šçŸ¥</li></ul></li></ul><h2 id="Spring-æ•´åˆ-Mybatis">Spring æ•´åˆ Mybatis</h2><h3 id="Spring-ç¯å¢ƒæ­å»º">Spring ç¯å¢ƒæ­å»º</h3><p>Spring æ•´åˆ mybatisï¼Œåˆ©ç”¨ Spring çš„æ§åˆ¶åè½¬ï¼Œå°† mybatis å®ä¾‹åŒ–è¿‡ç¨‹äº¤ç»™ IOCï¼Œé¦–å…ˆå°±éœ€è¦é…ç½® Spring ç¯å¢ƒ</p><blockquote><p>å¯¼å…¥Springéœ€è¦çš„mavenä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>é…ç½® Spring æ³¨è§£å¼€å‘ç¯å¢ƒï¼Œåˆ›å»º <code>SpringConfig.xml</code> é…ç½®æ–‡ä»¶ï¼Œå¼€å¯æ³¨è§£å¼€å‘åŠŸèƒ½ï¼Œå¹¶æ‰«ææ‰€æœ‰è¢«æ³¨è§£æ ‡æ³¨çš„ç±»æ‰€åœ¨çš„åŒ…ï¼Œå¯ä»¥è‡ªè¡Œåˆ›å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œç”¨æµ‹è¯•ç±»æ¥æµ‹è¯•ç¯å¢ƒæ˜¯å¦æ­å»ºæˆåŠŸ</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;site.hanzhe&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Mybatis-ç¯å¢ƒæ­å»º">Mybatis ç¯å¢ƒæ­å»º</h3><p>å¯¼å…¥æ‰€éœ€çš„ maven ä¾èµ–ï¼Œä¾èµ–å¼•å…¥å®Œæ¯•åï¼Œå»ä¹¦å†™ <code>bean</code> <code>dao</code> <code>mapper</code>ï¼Œé…ç½®æ–‡ä»¶ç¨ååœ¨å†™</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.48<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ•´åˆå…³é”®é…ç½®">æ•´åˆå…³é”®é…ç½®</h3><p>Spring æ•´åˆ mybatis éœ€è¦é¢å¤–å¯¼å…¥å‡ ä¸ª maven ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>spring-jdbc</code> æ˜¯ Spring æ“ä½œæ•°æ®åº“å¿…é¡»çš„ jar åŒ…</li><li><code>mybatis-spring</code> æ˜¯ 2.0.3 ç‰ˆæœ¬çš„æ¡¥æ¢æ¡†æ¶ï¼Œå®é™…å¼€å‘ä¸­éœ€è¦å‚è€ƒå„ç§å› ç´ æ¥å†³å®šæ¡¥æ¢ jar åŒ…çš„ç‰ˆæœ¬</li></ul><table><thead><tr><th style="text-align:left">MyBatis-Spring</th><th style="text-align:left">MyBatis</th><th style="text-align:left">Spring æ¡†æ¶</th><th style="text-align:left">Spring Batch</th><th style="text-align:left">Java</th></tr></thead><tbody><tr><td style="text-align:left">2.0</td><td style="text-align:left">3.5+</td><td style="text-align:left">5.0+</td><td style="text-align:left">4.0+</td><td style="text-align:left">Java 8+</td></tr><tr><td style="text-align:left">1.3</td><td style="text-align:left">3.4+</td><td style="text-align:left">3.2.2+</td><td style="text-align:left">2.1+</td><td style="text-align:left">Java 6+</td></tr></tbody></table><hr />è¿™ä¸ªæ—¶å¼€å§‹ä¹¦å†™ Spring æ•´åˆ mybatis çš„é…ç½®æ–‡ä»¶ï¼Œæ–°å»º Spring çš„é…ç½®æ–‡ä»¶ï¼Œèµ·åä¸º `SpringMybatis.xml`<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span><span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///test&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhang&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é…ç½®mybatisåŠ¨æ€ä»£ç†çš„æ¥å£--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;site.hanzhe.dao&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å°†mybatisæ•´åˆåˆ°Springä¸­--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å°†æ•°æ®æºé…ç½®åˆ°mybatisä¸­ï¼Œåœ¨é…ç½®æ˜ å°„æ–‡ä»¶è·¯å¾„--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mappers/*Mapper.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å‰©ä¸‹çš„äº¤ç»™mybatisé…ç½®æ–‡ä»¶æ¥å¤„ç†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨ Spring æ•´åˆ Mybatis é…ç½®æ–‡ä»¶ä¸­å…±é…ç½®äº†ä¸€ä¸‹å‡ ç‚¹ï¼š<ul><li>é…ç½®äº†æ•°æ®æºï¼šè¿æ¥æ•°æ®åº“çš„ä¿¡æ¯ï¼Œdriverï¼Œurl ç­‰ç­‰</li><li>é…ç½®äº† mybatis åŠ¨æ€ä»£ç†çš„æ¥å£ä½ç½®</li><li>é…ç½®äº† SQLSessionFactoryBean ç±»ï¼Œè¯¥ç±»æ˜¯ mybatis-spring åŒ…ä¸‹çš„ç±»ï¼Œåœ¨ä»–ä¸‹é¢é…ç½®äº†<ul><li>å°†æ•°æ®æºæ•´åˆè¿›äº† mybatis ä¸­</li><li>é…ç½®äº† mapper æ˜ å°„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</li><li>å…³è” mybatis æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå°†å…¶ä»–é…ç½®äº¤ç»™é…ç½®æ–‡ä»¶å¤„ç†</li></ul></li></ul></li></ul><p><font color="red">éœ€è¦æ³¨æ„ï¼</font>éœ€è¦ä½¿ç”¨ <code>import</code> æ ‡ç­¾å°† <code>SpringMybatis.xml</code> å¯¼å…¥åˆ° <code>SpringConfig.xml</code> ä¸­è¿›è¡Œæ•´åˆï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€å¼€å§‹å°†ä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å†…å®¹æ”¾åœ¨ä¸€èµ·</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;SpringMybatis.xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><hr />åˆ›å»º `mybatis-config.xml` æ ¸å¿ƒé…ç½®æ–‡ä»¶<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;site.hanzhe.bean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçš„é…ç½®å‡ ä¹éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶éƒ½å¯ä»¥çœç•¥ä¸å†™</li></ul><h3 id="æ•´åˆåŸºæœ¬å®Œæˆ">æ•´åˆåŸºæœ¬å®Œæˆ</h3><p>å› ä¸ºä½¿ç”¨äº† spring æ•´åˆäº† mybatisï¼Œä¹‹å‰ mybatis ä¸­çš„å¤æ‚æ­¥éª¤æ­¤æ—¶å…¨éƒ¨çœç•¥æ‰äº†ï¼Œç›´æ¥è°ƒç”¨æ¥å£å°±å¯ä»¥è¿è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:SpringConfig.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTest1</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> DeptDao dd;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(dd.findDept());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ äº‹åŠ¡ç®¡ç†">æ·»åŠ äº‹åŠ¡ç®¡ç†</h3><h4 id="åœºæ™¯æ¨¡æ‹Ÿ">åœºæ™¯æ¨¡æ‹Ÿ</h4><p>æ¨¡ä»¿ä¸€æ®µè½¬è´¦çš„åœºæ™¯ï¼ŒA å‘ B è½¬è´¦ 100 å…ƒé’±ï¼Œä¼šç»å†å¤§æ¦‚å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>å…ˆæŸ¥è¯¢ A çš„ä½™é¢æ˜¯å¦ &gt;= 100</li><li>ç¬¦åˆæ¡ä»¶ååœ¨æ•°æ®åº“ä¸­å°† A çš„ä½™é¢ - 100</li><li>( è¿™é‡Œå¤„ç†ä¸€å †è½¬è´¦ä¸­é€”æ“ä½œçš„é€»è¾‘ï¼Œçœç•¥â€¦ )</li><li>æœ€ååœ¨æ•°æ®åº“ä¸­å°† B çš„ä½™é¢ + 100</li></ul><p>ä¸Šè¿°æ¨¡æ‹Ÿçš„è½¬è´¦åœºæ™¯ï¼Œä»»ä½•ä¸€ä¸ªç¯èŠ‚å‡ºé”™éƒ½ä¼šç»ˆæ­¢è½¬è´¦è¡Œä¸ºï¼Œä½†æ˜¯å¯èƒ½ä¼šå‘ç”Ÿä¸€ç§æƒ…å†µï¼Œå¦‚æœåœ¨ç¬¬ä¸‰æ­¥å‘ç”Ÿäº†é”™è¯¯ï¼Œç¨‹åºæŠ›å‡ºå¼‚å¸¸ä¹‹åçš„ä»»åŠ¡ä¸åœ¨æ‰§è¡Œï¼Œä½†æ˜¯åœ¨å¼‚å¸¸æŠ›å‡ºä¹‹å‰çš„ç¬¬äºŒæ­¥å·²ç»å®Œæˆäº†æ‰£æ¬¾ï¼Œè¿™å°±å¯¼è‡´äº†è½¬è´¦ç¨‹åºå‡ºç°äº† BUG</p><h4 id="äº‹åŠ¡æ§åˆ¶å›é¡¾">äº‹åŠ¡æ§åˆ¶å›é¡¾</h4><p>äº‹åŠ¡æ§åˆ¶çš„å››ä¸ª ACID ç‰¹æ€§ï¼š</p><ul><li>åŸå­æ€§<ul><li>ä¸€ç»„ sql åœ¨ä¸€èµ·æ‰§è¡Œï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥ï¼</li></ul></li><li>ä¸€è‡´æ€§<ul><li>ä¾‹å¦‚è½¬è´¦ï¼ŒA å‘ B è½¬äº†100å…ƒæˆ–è€…å…¶ä»–è½¬è´¦ï¼Œæ— è®º A å’Œ B æ€ä¹ˆè½¬ä»–ä¿©çš„é‡‘é¢å§‹ç»ˆæ˜¯é‚£äº›</li></ul></li><li>éš”ç¦»æ€§<ul><li>å¤šä¸ª sql åŒæ—¶æ“ä½œä¸€ä¸ªèµ„æºï¼Œå¿…é¡»ç­‰ç¬¬ä¸€ä¸ªå…ˆæ“ä½œå®Œåç»­çš„æ‰èƒ½ç»§ç»­æ“ä½œ</li></ul></li><li>æŒä¹…æ€§<ul><li>å°†æ•°æ®æ°¸ä¹…å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œä¸æ˜¯ä¸´æ—¶å­˜å‚¨ (é€€å‡ºç¨‹åºå°±æ¶ˆå¤±)</li></ul></li></ul><h4 id="åœ¨æ•´åˆä¸­æ·»åŠ äº‹åŠ¡">åœ¨æ•´åˆä¸­æ·»åŠ äº‹åŠ¡</h4><p>åœ¨ spring æ•´åˆ mybatis çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tx&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;tx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span><span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Exception&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®aopï¼Œå°†ä¸Šé¢é…ç½®çš„äº‹åŠ¡ç®¡ç†å™¨ä»¥æ¨ªåˆ‡çš„é€»è¾‘æ·»åŠ è¿›å»--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution( public * site.hanzhe.service.UserService.*(..) )&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨ bean æ ‡ç­¾å°† DataSourceTransactionManager äº‹åŠ¡ç®¡ç†å™¨è£…é…åˆ° IOC å®¹å™¨ä¸­</p><ul><li>é…ç½®äº‹åŠ¡ç®¡ç†å™¨ä¸­çš„ dataSource å±æ€§æ¥è®¾ç½®è¢«ä»–ç®¡ç†çš„æ•°æ®æº</li></ul></li><li><p>tx æ˜¯äº‹åŠ¡æ§åˆ¶çš„åç§°ç©ºé—´ï¼Œä½¿ç”¨ <code>tx:advice</code> æ ‡ç­¾æ¥å¯¹ç¬¦åˆæ¡ä»¶çš„æ–¹æ³•è¿›è¡Œäº‹åŠ¡ç®¡ç†</p><ul><li>åœ¨æ ‡ç­¾ä¸Šé€šè¿‡ id å±æ€§æ¥ä¸ºè¯¥é…ç½®èµ·åå­—ï¼Œç„¶åé€šè¿‡ transaction-manager å±æ€§æ¥é€‰æ‹©äº‹åŠ¡ç®¡ç†å™¨</li><li>ä½¿ç”¨ <code>tx:advice</code> ä¸‹çš„ <code>tx:attributes</code> ä¸‹çš„ <code>tx:method</code> æ ‡ç­¾æ¥è¿›è¡Œæ–¹æ³•ç­›é€‰<ul><li><font color="red">name å±æ€§</font>æ˜¯è¢«äº‹åŠ¡ç®¡ç†çš„æ–¹æ³•åï¼Œå¯ä»¥ä½¿ç”¨ * é€šé…ç¬¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…</li><li><font color="red">propagation å±æ€§</font>æ˜¯äº‹åŠ¡çš„ä¼ æ’­ç±»å‹ï¼Œæ˜¯ä¸ªæšä¸¾ï¼Œå¸¸ç”¨é€‰é¡¹æœ‰ï¼š<ul><li>REQUIREDï¼š æ–¹æ³•å¿…é¡»åœ¨äº‹åŠ¡ç¯å¢ƒä¸­è¿è¡Œï¼Œå½“å‰è‹¥æœ‰äº‹åŠ¡ç¯å¢ƒå°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»ºï¼Œ==æ˜¯é»˜è®¤å€¼==</li><li>SUPPORTSï¼š è‹¥æœ‰äº‹åŠ¡ç¯å¢ƒå°±åŠ å…¥è¿è¡Œï¼Œæ²¡æœ‰å°±ä»¥éäº‹åŠ¡ç¯å¢ƒè¿è¡Œ</li><li>MANDATORYï¼š å¿…é¡»åœ¨äº‹åŠ¡ä¸­è¿è¡Œï¼Œè‹¥æ²¡æœ‰äº‹åŠ¡ç¯å¢ƒå°±ä¼šæŠ›å‡ºå¼‚å¸¸</li></ul></li><li><font color="red">isolation å±æ€§</font>æ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«</li><li><font color="red">read-only å±æ€§</font>æ˜¯åªè¯»è®¾ç½®ï¼Œtrue ä¸ºåªè¯»</li><li><font color="red">rollback-for å±æ€§</font>ç”¨æ¥è®¾ç½®å›æ»šçš„å¼‚å¸¸ï¼Œå¦‚æœå‘ç”Ÿçš„å¼‚å¸¸å¹¶ä¸æ˜¯æŒ‡å®šçš„å¼‚å¸¸ä¸ä¼šå›æ»š</li></ul></li></ul></li><li><p>å°†äº‹åŠ¡ç®¡ç†é…ç½®å¥½åï¼Œéœ€è¦é€šè¿‡ aop æŠ€æœ¯å°†äº‹åŠ¡é€»è¾‘æ¨ªåˆ‡è¿›å»ï¼Œåˆ‡é¢å°±æ˜¯ <code>tx-advice</code> çš„id</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºå­¦ä¹ ç¬”è®°</title>
    <link href="/2022/08/21/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/08/21/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>å¾®ä¿¡å°ç¨‹åºå­¦ä¹ ç¬”è®°</h1><p>ç¬”è®°å¼€å§‹äº<code>2021-04-21</code>ï¼Œå¼€å‘è€…å·¥å…·ç‰ˆæœ¬å·ä¸º<code>1.05.2103200</code></p><p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/">https://developers.weixin.qq.com/miniprogram/dev/framework/</a></p><h2 id="å…¥é—¨å°ç¨‹åºå¼€å‘">å…¥é—¨å°ç¨‹åºå¼€å‘</h2><blockquote><p>å‰ç½®å‡†å¤‡</p></blockquote><p>é¦–å…ˆè¦<a href="https://mp.weixin.qq.com/wxopen/waregister?action=step1">æ³¨å†Œå¼€å‘è€…è´¦å·</a>ï¼Œä¹‹å‰æ³¨å†Œè¿‡æœåŠ¡å·ä¹‹ç±»ä¹Ÿè¦å†æ¬¡æ³¨å†Œï¼Œå°ç¨‹åºä¸åŒäºæœåŠ¡å·éœ€è¦å•ç‹¬æ³¨å†Œ</p><p>æ³¨å†Œäº†å°ç¨‹åºçš„å¼€å‘è€…è´¦å·ä¹‹åï¼Œ<a href="https://mp.weixin.qq.com/">æ‰«ç ç™»å½•å°ç¨‹åºåå°</a>ï¼ˆæ‰«ç ç™»å½•æ—¶é€‰æ‹©å°ç¨‹åºæµ‹è¯•å·ï¼‰æ‰¾åˆ°<code>AppID</code>ï¼Œåé¢ä¼šç”¨åˆ°</p><p>ä¹‹å<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">ä¸‹è½½å¾®ä¿¡å¼€å‘è€…å·¥å…·</a>è¿›è¡Œå°ç¨‹åºçš„å¼€å‘å°±å¯ä»¥äº†</p><blockquote><p>Hello world</p></blockquote><p>åœ¨å°ç¨‹åºå¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»åŠ å·åˆ›å»ºå°ç¨‹åºï¼Œå¡«å†™é¡¹ç›®åç§°ã€é¡¹ç›®ç›®å½•ä»¥åŠå‰é¢çš„<code>AppID</code>å³å¯</p><img src="/img/wx-app-01.png" style="zoom:70%;" /><p>ç‚¹å‡»æ–°å»ºåä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªHelloWorldçš„å°ç¨‹åºï¼Œæˆ‘ä»¬é€šè¿‡æ“ä½œå¼€å‘è€…å·¥å…·å¯ä»¥ç›´æ¥è¿›è¡Œé¢„è§ˆ</p><blockquote><p>å¾®ä¿¡å¼€å‘è€…å·¥å…·ç®€å•ä½¿ç”¨</p></blockquote><p>å¼€å‘è€…å·¥å…·ä½¿ç”¨è¯¦ç»†æ•™ç¨‹å¯ä»¥å‚<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html">å®˜æ–¹æ–‡æ¡£</a></p><p><strong>1.</strong> åœ¨å·¦ä¸Šè§’ç”¨æˆ·å¤´åƒçš„å³ä¾§æœ‰è¿™æ ·å››ä¸ªæŒ‰é’®å¼€å…³ï¼Œä»–ä»¬å¯¹åº”ç€é¡µé¢æ˜¾ç¤ºå†…å®¹ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/img/wx-app-02.png" /><ul><li>æ¨¡æ‹Ÿå™¨ï¼šå·¦ä¾§å°ç¨‹åºé¢„è§ˆç•Œé¢</li><li>ç¼–è¾‘å™¨ï¼šå³ä¾§ä»£ç ç¼–å†™åŒºåŸŸ</li><li>è°ƒè¯•å™¨ï¼šå³ä¸‹è§’æµè§ˆå™¨æ§åˆ¶å°</li><li>å¯è§†åŒ–ï¼šé€šè¿‡é¼ æ ‡æ‹–æ‹½å®Œæˆå°ç¨‹åºé¡µé¢çš„ç»˜åˆ¶ï¼ŒåŸºæœ¬ç”¨ä¸åˆ°â€¦</li></ul><p><strong>2.</strong> åœ¨å››ä¸ªå¼€å…³æŒ‰é’®å³ä¾§æœ‰è¿™æ ·ä¸€æ ï¼Œå…·ä½“ä½œç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/img/wx-app-03.png" /><ul><li>é¢„è§ˆï¼šç‚¹å‡»é¢„è§ˆåç¨ç­‰ä¼šç”ŸæˆäºŒç»´ç ï¼Œå¯ä»¥ç›´æ¥åœ¨æ‰‹æœºå¾®ä¿¡ä¸Šæ‰«ç æŸ¥çœ‹æ•ˆæœ</li><li>çœŸæœºè°ƒè¯•ï¼šé™¤äº†æ‰‹æœºç«¯æ‰«ç é¢„è§ˆä¹‹å¤–è¿˜ä¼šåœ¨PCç”Ÿæˆè°ƒè¯•å™¨ï¼Œå¯ä»¥å®æ—¶è§‚æµ‹æ‰‹æœºä¸Šçš„å°ç¨‹åºï¼Œèµ·åˆ°è°ƒè¯•ä½œç”¨</li><li>æ¸…ç¼“å­˜ï¼šè¿™ä¸ªæ²¡å¿…è¦è¯´äº†ï¼Œï¼Œï¼Œ</li></ul><h2 id="å°ç¨‹åºç›®å½•ç»“æ„">å°ç¨‹åºç›®å½•ç»“æ„</h2><p>è¿™é‡Œå…ˆäº†è§£ä¸€ä¸‹å°ç¨‹åºé¡¹ç›®ç›®å½•ç»“æ„ï¼Œäº†è§£ä¸€ä¸‹æ¯ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯å¹²ä»€ä¹ˆçš„</p><img src="/img/wx-app-04.png" /><p>é¦–å…ˆä»<strong>æ ¹ç›®å½•</strong>å¼€å§‹äº†è§£ï¼Œå°†æ ¹ç›®å½•è¿™å‡ ä¸ªæ–‡ä»¶åˆ’åˆ†ä¸ºä¸‰å—</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å¯è‡ªå®šä¹‰å‘½åï¼Œæ²¡æœ‰å¼ºåˆ¶è¦æ±‚ï¼Œutilså¯ä»¥åˆ é™¤ä¸è¦ */</span></span><br><span class="line">|-pages   <span class="comment">// è¿™æ˜¯é¡µé¢æ–‡ä»¶å¤¹ï¼Œå°ç¨‹åºä¸­æ‰€æœ‰çš„é¡µé¢éƒ½ä¼šæ”¾åœ¨è¯¥ç›®å½•ä¸‹</span></span><br><span class="line">|-utils   <span class="comment">// ä¸€äº›å¯å¤ç”¨çš„å‡½æ•°å¯ä»¥æŠ½å–ä¸ºå•ç‹¬çš„JSæ–‡ä»¶æ”¾åœ¨è¯¥ç›®å½•ä¸‹ï¼Œç„¶ååœ¨å…¶ä»–é¡µé¢ä¸­é€šè¿‡requireå¼•ç”¨</span></span><br><span class="line">  |-util.<span class="property">js</span>  <span class="comment">// ç›®å½•ä¸‹åªæœ‰ä¸€ä¸ªä¸ªçš„JSæ–‡ä»¶ï¼Œè¿™é‡Œå°±ä¸å•ç‹¬è¯´äº†</span></span><br><span class="line">  |-abc.<span class="property">js</span> ...</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å°ç¨‹åºçš„ä¸»ä½“æ–‡ä»¶ï¼Œå¿…é¡»å­˜åœ¨ä¸”æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½• */</span></span><br><span class="line">|-app.<span class="property">js</span>    <span class="comment">// JSé€»è¾‘ä»£ç </span></span><br><span class="line">|-app.<span class="property">json</span>  <span class="comment">// å°ç¨‹åºçš„å…¨å±€é…ç½®ï¼Œä¾‹å¦‚å°ç¨‹åºæ ‡é¢˜æ˜¯ä»€ä¹ˆï¼ŒèƒŒæ™¯é¢œè‰²æ˜¯ä»€ä¹ˆï¼Œæœ‰å¤šå°‘ä¸ªpageé¡µé¢...</span></span><br><span class="line">|-app.<span class="property">wxss</span>  <span class="comment">// å…¨å±€ç”Ÿæ•ˆçš„CSSæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œå¯æœ‰å¯æ—  */</span></span><br><span class="line">|-project.<span class="property">config</span>.<span class="property">json</span> <span class="comment">// ä½¿ç”¨å¼€å‘è€…å·¥å…·æ¯ä¸ªäººéƒ½æœ‰è‡ªå®šä¹‰çš„é…ç½®ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥å­˜å‚¨ä¸ªæ€§é…ç½®çš„æ–‡ä»¶ï¼Œä¸é¡¹ç›®æ— å…³</span></span><br><span class="line">|-sitemap.<span class="property">json</span>        <span class="comment">// å¾®ä¿¡æœç´¢å¼•æ“çš„ç›¸å…³é…ç½®ï¼Œå…·ä½“å‚è€ƒå®˜ç½‘</span></span><br></pre></td></tr></table></figure><p><code>utils</code>ç›®å½•åœ¨ä¸Šé¢å·²ç»è§£é‡Šè¿‡äº†ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹<code>pages</code>ç›®å½•</p><img src="/img/wx-app-05.png" /><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>pages</code>ä¸‹æœ‰<code>indexã€logs</code>ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸‹åˆ†ä¸ºå­˜æ”¾<code>jsã€jsonã€wxmlã€wxss</code>å››ç§ç±»å‹çš„åŒåæ–‡ä»¶ï¼Œè¿™å››ç§ç±»å‹çš„åŒåæ–‡ä»¶è¢«ç§°ä¸ºä¸€ä¸ª<em>Pageé¡µé¢</em>ï¼Œå°†å››ä¸ªæ–‡ä»¶æ”¾åœ¨æŸä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å°±å¯ä»¥çœ‹æˆä¸€ä¸ª<code>Pageé¡µé¢</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å†™æ³•ä¸Angularæœ‰äº›ç±»ä¼¼ï¼Œä»–å°†ä¸€ä¸ªHTMLé¡µé¢æ‹†åˆ†ä¸ºå››ä¸ªæ–‡ä»¶åˆ†åˆ«å†™ä¸åŒçš„ä»£ç  */</span></span><br><span class="line">|-abc.<span class="property">js</span>    <span class="comment">// ä¸»è¦å†™JSä»£ç ï¼Œå¤„ç†é¡µé¢å–å€¼ç­‰ç­‰ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">|-abc.<span class="property">wxml</span>  <span class="comment">// ä¸»è¦å†™HTMLä»£ç ï¼Œæ§åˆ¶é¡µé¢å¸ƒå±€ç­‰ç­‰</span></span><br><span class="line">|-abc.<span class="property">wxss</span>  <span class="comment">// ä¸»è¦å†™CSSä»£ç ï¼Œç”¨æ¥ç¾åŒ–é¡µé¢å¸ƒå±€</span></span><br><span class="line">|-abc.<span class="property">json</span>  <span class="comment">// å½“å‰é¡µé¢çš„é…ç½®æ–‡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºå…¨å±€é…ç½®æ–‡ä»¶app.json</span></span><br></pre></td></tr></table></figure><h2 id="é¡µé¢ç›¸å…³çŸ¥è¯†">é¡µé¢ç›¸å…³çŸ¥è¯†</h2><h3 id="å¸¸ç”¨æ§ä»¶ä½¿ç”¨">å¸¸ç”¨æ§ä»¶ä½¿ç”¨</h3><h3 id="JSæ–‡ä»¶ä»‹ç»">JSæ–‡ä»¶ä»‹ç»</h3><h3 id="å£°æ˜å‘¨æœŸå‡½æ•°">å£°æ˜å‘¨æœŸå‡½æ•°</h3><h3 id="é¡µé¢ç›¸å…³äº‹ä»¶">é¡µé¢ç›¸å…³äº‹ä»¶</h3><p>å•å‡»äº‹ä»¶ï¼ˆæ”¯æŒå†’æ³¡ï¼‰ï¼šbindtap</p><p>å•æœºäº‹ä»¶ï¼ˆç¦æ­¢å†’æ³¡ï¼‰ï¼šcatchtap</p><h2 id="é¡µé¢è¡¨å•æ“ä½œ">é¡µé¢è¡¨å•æ“ä½œ</h2><h2 id="è·¯ç”±é¡µé¢è·³è½¬">è·¯ç”±é¡µé¢è·³è½¬</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿ç•™å½“å‰é¡µé¢è·³è½¬ï¼Œè·³è½¬åˆ°ä¸‹ä¸€é¡µåä¼šåœ¨å·¦ä¸Šè§’è‡ªåŠ¨ç”Ÿæˆè¿”å›æŒ‰é’®</span></span><br><span class="line">wx.<span class="title function_">navigateTo</span>()</span><br><span class="line"><span class="comment">// é”€æ¯å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°ä¸‹ä¸€é¡µ</span></span><br><span class="line">wx.<span class="title function_">redirectTo</span>()</span><br><span class="line"><span class="comment">// é”€æ¯æ‰€æœ‰é¡µé¢ï¼Œç„¶åæ‰“å¼€æŒ‡å®šé¡µé¢</span></span><br><span class="line">wx.<span class="title function_">reLaunch</span>()</span><br></pre></td></tr></table></figure><h2 id="å‘èµ·ç½‘ç»œè¯·æ±‚">å‘èµ·ç½‘ç»œè¯·æ±‚</h2><h2 id="å¸¸ç”¨å°ç¨‹åºAPI">å¸¸ç”¨å°ç¨‹åºAPI</h2>]]></content>
    
    
    <categories>
      
      <category>å°ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å°ç¨‹åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Swaggerç¬”è®°</title>
    <link href="/2022/07/13/Swagger%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/07/13/Swagger%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>Swaggerç¬”è®°</h1><p>ç°åœ¨å¸‚é¢ä¸Šå¤§å¤šæ•°å…¬å¸éƒ½æ‘’å¼ƒäº†ä¼ ç»Ÿ jsp å¼€å‘ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»å¼çš„å¼€å‘è§„åˆ™ï¼Œå‰ç«¯ä½¿ç”¨ Vueï¼ŒAngularï¼ŒReact ç­‰ç­‰å®Œæˆé¡µé¢ï¼Œåç«¯çœæ‰äº†è§†å›¾è·³è½¬çš„è¿‡ç¨‹ï¼Œç›´æ¥ä¹¦å†™æ¥å£è¿”å› json æ•°æ®ä¾›å‰ç«¯è°ƒç”¨å³å¯</p><p>è¿™æ ·ä¸€æ¥å°±è¯ç”Ÿäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œåç«¯ç¨‹åºå‘˜éœ€è¦å†™ä¸€ä¸ªæ¥å£æ–‡æ¡£æ¥å‘Šè¯‰å‰ç«¯å¼€å‘äººå‘˜éƒ½æœ‰é‚£äº›æ¥å£ï¼Œæ¯ä¸ªæ¥å£éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œéœ€è¦é‚£äº›å‚æ•°ç­‰ç­‰ã€‚</p><p>ä¹¦å†™æ¥å£æ–‡æ¡£æ˜¯ä¸€ä»¶è´¹æ—¶è´¹åŠ›çš„æ´»ï¼Œè€Œ Swagger å¯ä»¥æ ¹æ®ç¨‹åºä»£ç è‡ªåŠ¨ç”Ÿæˆåœ¨çº¿æ¥å£æ–‡æ¡£ï¼Œ==Swagger æ˜¯æ¥å£æ–‡æ¡£ç”Ÿæˆå·¥å…·==</p><h2 id="æ•´åˆSwagger">æ•´åˆSwagger</h2><h3 id="å¯¼å…¥ä¾èµ–">å¯¼å…¥ä¾èµ–</h3><p>æƒ³è¦æ•´åˆä½¿ç”¨ Swagger ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å¼•ç”¨ Swagger çš„ maven ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Swaggerä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ’é™¤ä¸‹é¢ä¸¤ä¸ªä¾èµ–ï¼Œè§£å†³ For input string: &quot;&quot; å¼‚å¸¸ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å•ç‹¬å¼•ç”¨ç‰ˆæœ¬åä½çš„ä¸¤ä¸ªä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- UIé¡µé¢å±•ç¤º --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¯ç”¨Swagger">å¯ç”¨Swagger</h3><p>åœ¨å¼•ç”¨ Swagger çš„ä¾èµ–åï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡æ³¨è§£å¼€å¯ Swagge æ‰å¯ä»¥å®ç°æ¥å£æ–‡æ¡£</p><blockquote><p>æ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œé€šè¿‡ <code>@EnableSwagger2</code> æ³¨è§£å¯ç”¨ Swaggerï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span>   <span class="comment">// å¼€å¯Swagger</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="äº†è§£æ¥å£æ–‡æ¡£">äº†è§£æ¥å£æ–‡æ¡£</h3><p>Swagger æ¥å£æ–‡æ¡£ä¸»è¦æœ‰å››éƒ¨åˆ†ç»„æˆï¼š</p><p>ã€åˆ†ç»„ä¿¡æ¯ã€‘ï¼Œã€åˆ†ç»„æè¿°ä¿¡æ¯ã€‘ï¼Œã€æ¥å£æè¿°ä¿¡æ¯ã€‘ï¼Œã€å®ä½“ç±»ä¿¡æ¯ã€‘</p><p><img src="/img/swagger-01.jpg" alt=""></p><p>æˆ‘ä»¬ç›®å‰ä»…ä»…æ˜¯å¼•å…¥äº† Swagger çš„ä¾èµ–ï¼Œå¼€å¯ Swagger åŠŸèƒ½ä¹‹åå¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œé»˜è®¤ä¼šä½¿ç”¨ swagger åˆå§‹åŒ–çš„é…ç½®</p><h2 id="åˆå§‹åŒ–åˆ†ç»„">åˆå§‹åŒ–åˆ†ç»„</h2><p>æˆ‘ä»¬æƒ³è¦ä½¿ç”¨è‡ªå®šä¹‰çš„åˆ†ç»„ä¿¡æ¯ï¼Œè¦åœ¨é…ç½®ç±»æä¾›ä¸€ä¸ª Docket å®ä¾‹åˆ° IOC å®¹å™¨ä¸­ï¼Œé€šè¿‡ Docket å®ä¾‹è®¾ç½®åˆ†ç»„åç§°ï¼ŒSwagger ä¼šæ ¹æ®å®ä¾‹è¿›è¡Œè‡ªå®šä¹‰è®¾ç½®ã€‚</p><blockquote><p>åˆ›å»ºä¸€ä¸ªåˆ†ç»„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿˜æ˜¯ä¹‹å‰çš„é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;å¼ æ¶µå“²çš„åˆ†ç»„&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä½¿ç”¨ Swagger2 é»˜è®¤è§„åˆ™åˆ›å»ºäº†ä¸€ä¸ª Docket å¯¹è±¡ï¼Œå®šä¹‰åˆ†ç»„åç§°ä¸º <code>å¼ æ¶µå“²çš„åˆ†ç»„</code>ï¼Œæ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/swagger-02.jpg" alt=""></p><blockquote><p>å¤šåˆ†ç»„é…ç½®</p></blockquote><p>å¦‚æœæƒ³è¦åˆ›å»ºå¤šä¸ªåˆ†ç»„ï¼Œé‚£ä¹ˆå°±åœ¨ IOC å®¹å™¨ä¸­å¤šæä¾›å‡ ä¸ª docket å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;å¼ æ¶µå“²çš„åˆ†ç»„&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;***çš„åˆ†ç»„&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/swagger-03.jpg" alt=""></p><h2 id="é…ç½®åˆ†ç»„è¯¦æƒ…">é…ç½®åˆ†ç»„è¯¦æƒ…</h2><blockquote><p>é…ç½®åˆ†ç»„æè¿°</p></blockquote><p>æˆ‘ä»¬å·²ç»å¯ä»¥åˆ›å»ºå¤šä¸ªåˆ†ç»„äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ¯ä¸ªåˆ†ç»„ä¸­éƒ½æœ‰ä¸€æ®µæè¿°ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªåˆ†ç»„ä¸‹æ˜¾ç¤ºä¸åŒçš„æè¿°ä¿¡æ¯ï¼Œéœ€è¦è°ƒç”¨ Docket çš„ <code>apiInfo()</code> å‡½æ•°ä¼ å…¥è‡ªå®šä¹‰çš„é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;å¼ æ¶µå“²çš„åˆ†ç»„&quot;</span>)</span><br><span class="line">                .apiInfo(apiInfo());</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">// åˆ›å»ºä¸€ä¸ªå‡½æ•°ç”¨æ¥è¿”å› ApiInfo å®ä¾‹</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæˆ‘åªæ˜¾ç¤ºäº†éƒ¨åˆ†ä¿¡æ¯ï¼Œå¡«å†™nullçš„éƒ½æ˜¯ä¸æ˜¾ç¤ºçš„ï¼Œå¦‚æœæƒ³è¦å…¨éƒ¨æ˜¾ç¤ºå¯ä»¥å¡«å†™æ‰€æœ‰çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">public</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Contact</span> <span class="variable">contact</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;å¼ æ¶µå“²&quot;</span>, <span class="string">&quot;http://blog.hanzhe.club&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfo</span>(</span><br><span class="line">                <span class="string">&quot;åŸºäºSwagger2.0ç»ƒä¹ &quot;</span>,</span><br><span class="line">                <span class="string">&quot;åŸºäºç¨‹åºä¸­æ‰€æœ‰çš„æ¥å£æä¾›å¸®åŠ©æ–‡æ¡£&quot;</span>,</span><br><span class="line">                <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">                <span class="literal">null</span>,</span><br><span class="line">                contact,</span><br><span class="line">                <span class="literal">null</span>,</span><br><span class="line">                <span class="literal">null</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ArrayList</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸º <code>å¼ æ¶µå“²çš„åˆ†ç»„</code> é…ç½®äº†ä¸€æ®µæè¿°ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ•ˆæœï¼š</p><p><img src="/img/swagger-04.png" alt="image-20200812131813648"></p><p>å¯ä»¥çœ‹åˆ°åˆ†ç»„çš„æè¿°ä¿¡æ¯å·²ç»æ˜¾ç¤ºå‡ºæ¥äº†ã€‚</p><blockquote><p>é…ç½®æ‰«æèŒƒå›´</p></blockquote><p>å½“æˆ‘ä»¬å¤šä¸ªäººåŒæ—¶å¼€å‘ä¸€ä¸ªç¨‹åºæ—¶ï¼Œå°±ä¼šä½¿ç”¨å¤šä¸ªåˆ†ç»„ï¼Œæ¯ä¸ªäººå¯¹åº”è¿™ä¸€ä¸ªåˆ†ç»„ï¼Œå…¶ä¸­æ¯ä¸ªåˆ†ç»„éƒ½æœ‰è‡ªå·±çš„æ¥å£æ–‡æ¡£ï¼Œè¿™é‡Œéœ€è¦é…ç½®åˆ†ç»„æ¥å£æ˜¾ç¤º</p><p>ä¾‹ï¼šå¼ æ¶µå“²è´Ÿè´£å¼€å‘ç”¨æˆ·ç›¸å…³çš„æ¥å£ <code>åŒ…ä½ç½®ï¼šclub.hanzhe.controller.user.UserController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">        .groupName(<span class="string">&quot;å¼ æ¶µå“²çš„åˆ†ç»„&quot;</span>)</span><br><span class="line">        .apiInfo(apiInfo())</span><br><span class="line">        <span class="comment">// selectå¼€å§‹ï¼Œbuildç»“æŸï¼Œapisç”¨æ¥è¿‡æ»¤</span></span><br><span class="line">        .select()</span><br><span class="line">        .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;club.hanzhe.controller.user&quot;</span>))</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥è¯¥åˆ†ç»„ä¸‹å°±åªä¼šæ˜¾ç¤ºå›ºå®šçš„æ¥å£ä¿¡æ¯äº†ï¼Œé™¤å¼€é€šè¿‡åŒ…æ‰«æçš„æ–¹æ³•ä¹‹å¤–è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•è¿›è¡Œç­›é€‰ï¼š</p><p><code>RequestHandlerSelectors</code> ç±»ä¸­å…¶ä»–çš„é™æ€å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>any()</td><td>æ‰«æå…¨éƒ¨æ¥å£</td></tr><tr><td>none()</td><td>ä¸æ‰«æ</td></tr><tr><td>basePackage(String package)</td><td>æ ¹æ®ç»™å®šçš„åŒ…çš„ä½ç½®è¿›è¡Œæ‰«æ</td></tr><tr><td>withClassAnnotation(Class annotation)</td><td>ç±»ä¸Šæœ‰å¯¹åº”æ³¨è§£ä¼šè¢«æ‰«æ</td></tr><tr><td>withMethodAnnotation(Class annotation)</td><td>å‡½æ•°ä¸Šæœ‰å¯¹åº”æ³¨è§£çš„ä¼šè¢«æ‰«æ</td></tr></tbody></table><p>è¿˜å¯ä»¥é€šè¿‡è·¯å¾„è¿›è¡Œè¿‡æ»¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">        .groupName(<span class="string">&quot;å¼ æ¶µå“²çš„åˆ†ç»„&quot;</span>)</span><br><span class="line">        .apiInfo(apiInfo())</span><br><span class="line">        <span class="comment">// selectå¼€å§‹ï¼Œbuildç»“æŸï¼Œpathsç”¨æ¥è¿‡æ»¤</span></span><br><span class="line">        .select()</span><br><span class="line">        .paths(PathSelectors.ant(<span class="string">&quot;/user/**&quot;</span>))</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>PathSelectors</code> ç±»ä¸­å…¶ä»–çš„é™æ€å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>any()</td><td>æ‰«æå…¨éƒ¨æ¥å£</td></tr><tr><td>none()</td><td>ä¸æ‰«æ</td></tr><tr><td>ant(String path)</td><td>æ‰«ææŒ‡å®šè·¯å¾„</td></tr><tr><td>regex(String regex)</td><td>æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤</td></tr></tbody></table><h2 id="æ¥å£ä¿¡æ¯é…ç½®">æ¥å£ä¿¡æ¯é…ç½®</h2><blockquote><p>ç®€å•æ¥å£æ˜¾ç¤º</p></blockquote><p><img src="/img/swagger-05.jpg" alt=""></p><p>ä¸Šé¢çš„å›¾ç‰‡æ˜¯æ‰«æåˆ°æ¥å£åé»˜è®¤ç”Ÿæˆçš„æ¥å£æ–‡æ¡£ï¼ŒSwagger æ˜¯ä»¥ <code>Controller</code> ä¸ºå•ä½ï¼Œå¯¹æ¥å£è¿›è¡Œåˆ†ç»„ç®¡ç†çš„ï¼Œè¿™ä¸ªåˆ†ç»„çš„å…ƒç´ åœ¨ Swagger ä¸­ç§°ä¸º <code>Tag</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨è§£æ¥ä¿®æ”¹ä¸€ä¸‹æ¥å£æ–‡æ¡£ï¼Œè®©ä»–æ›´äººæ€§åŒ–ï¼š</p><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>@Api(tags = â€œâ€)</td><td><strong>æ ‡æ³¨åœ¨ç±»ä¸Š</strong> ç”¨æ¥è¡¨æ˜æ¥å£ç»„ï¼Œtags=ç»„å</td></tr><tr><td>@ApiOperation(value = â€œâ€, notes = â€œâ€, tags=â€œâ€)</td><td><strong>æ ‡æ³¨åœ¨å‡½æ•°ä¸Š</strong> value=æ ‡é¢˜ï¼Œnotes=æè¿°ï¼Œtags=åˆ†ç»„</td></tr><tr><td>@ApiParam(â€œâ€)</td><td><strong>æ ‡æ³¨åœ¨å‚æ•°åˆ—è¡¨ä¸­</strong> è¡¨ç¤ºå½“å‰å‚æ•°ä»£è¡¨çš„å«ä¹‰ä»¥åŠç”¨æ³•</td></tr></tbody></table><p>ä¾‹å¦‚ä¸‹é¢æˆ‘ä»¬ç¼–è¾‘ä¸€ä¸‹å½“å‰çš„ UserControllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;Useræ¥å£æ–‡æ¡£&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢æ‰€æœ‰user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">getList</span><span class="params">()</span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;æ·»åŠ æ–°çš„userä¿¡æ¯&quot;, notes = &quot;ä¼ å…¥ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå°è£…userè¿›è¡Œæ·»åŠ &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">addUser</span><span class="params">(<span class="meta">@RequestBody</span> UserBean user)</span>&#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;é€šè¿‡IDæ›´æ–°userä¿¡æ¯&quot;, notes = &quot;è·¯å¾„ä¼ å…¥IDï¼Œjsonä¼ è¾“ä¿®æ”¹ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id, <span class="meta">@RequestBody</span> UserBean user)</span>&#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;é€šè¿‡IDåˆ é™¤userä¿¡æ¯&quot;, notes = &quot;è·¯å¾„ä¼ å…¥IDè¿›è¡Œåˆ é™¤&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@ApiParam(&quot;åˆ é™¤çš„ç›®æ ‡ID&quot;)</span><span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/swagger-06.jpg" alt=""></p><blockquote><p>è·¨ç»„æ˜¾ç¤ºæ¥å£</p></blockquote><p>ä¹‹å‰æœ‰è¯´è¿‡ï¼ŒSwagger é»˜è®¤æ˜¯æŒ‰ç…§æ¯ä¸ª Controller ä¸ºä¸€ä¸ªåˆ†ç»„æ˜¾ç¤ºæ¥å£çš„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å…¶ä¸­ä¸€ä¸ª Controlle æ‰§è¡Œæ—¶éœ€è¦å¦ä¸ª Controller çš„æŸä¸ªæ¥å£é…åˆï¼Œè¿™æ—¶æˆ‘ä»¬å½“å‰åˆ†ç»„å°±è¦æ”¯æŒæ˜¾ç¤ºå…¶ä»–åˆ†ç»„ä¿¡æ¯ã€‚</p><p>**1.**å‘˜å·¥çš„åˆ†ç»„æ¥å£é™¤äº†æœ¬èº«çš„å¢åˆ æ”¹æŸ¥ä¹‹å¤–è¿˜è¦æŸ¥è¯¢æºå¸¦æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;éƒ¨é—¨æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/dept&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span>    <span class="comment">// tags æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥åˆ¶å®šå¤šä¸ªåˆ†ç»„åŒæ—¶æ˜¾ç¤º</span></span><br><span class="line">    <span class="meta">@ApiOperation( value = &quot;æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨&quot;, tags = &#123;&quot;éƒ¨é—¨æ¥å£&quot;, &quot;å‘˜å·¥æ¥å£&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getList</span><span class="params">()</span>&#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// .... çœç•¥å…¶ä»–æ¥å£</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/swagger-07.jpg" alt=""></p><blockquote><p>é€šè¿‡å·²æœ‰çš„æ¥å£æ–°å»ºä¸€ä¸ªåˆ†ç»„</p></blockquote><p>é™¤äº†æ¥å£è·¨åˆ†ç»„æ˜¾ç¤ºä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„æ¥å£ä¸­æŒ‡å‘åŒä¸€ä¸ªä¸å­˜åœ¨çš„åˆ†ç»„ï¼ŒSwagger ä¼šæ–°å»ºä¸€ä¸ªåˆ†ç»„æ¥å±•ç¤ºè¿™äº›æ¥å£ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;å‘˜å·¥æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;é€šè¿‡IDåˆ é™¤userä¿¡æ¯&quot;, </span></span><br><span class="line"><span class="meta">                  notes = &quot;è·¯å¾„ä¼ å…¥IDè¿›è¡Œåˆ é™¤&quot;, tags = &quot;åˆ é™¤æ“ä½œç›¸å…³æ¥å£&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@ApiParam(&quot;åˆ é™¤çš„ç›®æ ‡ID&quot;)</span><span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;éƒ¨é—¨æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/dept&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;</span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;é€šè¿‡IDåˆ é™¤éƒ¨é—¨&quot;, tags = &quot;åˆ é™¤æ“ä½œç›¸å…³æ¥å£&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@ApiParam(&quot;åˆ é™¤çš„ç›®æ ‡ID&quot;)</span><span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/swagger-08.jpg" alt=""></p><h2 id="å®ä½“ç±»ä¿¡æ¯é…ç½®">å®ä½“ç±»ä¿¡æ¯é…ç½®</h2><p>æˆ‘ä»¬åœ¨å¼€å§‹çš„æ—¶å€™å°± Swagger æ¥å£æ–‡æ¡£ç”± <code>åˆ†ç»„</code>ï¼Œ<code>åˆ†ç»„æè¿°ä¿¡æ¯</code>ï¼Œ<code>æ¥å£ä¿¡æ¯</code>ï¼Œ<code>å®ä½“ç±»ä¿¡æ¯</code> å››éƒ¨åˆ†ç»„æˆï¼Œå‰ä¸‰ç§æˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å­¦ä¹ ä½¿ç”¨é…ç½®ç±»ä¿¡æ¯</p><p>å½“æˆ‘ä»¬éœ€è¦å®Œæˆç±»ä¼¼æ·»åŠ æ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦çš„å‚æ•°è¿‡å¤šï¼Œä½¿ç”¨ @ApiParam æ³¨è§£å°±ä¼šå¤ªè¿‡è‡ƒè‚¿ï¼Œç›´æ¥å°è£…ä¸ºå®ä½“ç±»åˆè¦è§£é‡Šæ¯ä¸ªå­—æ®µéƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œæ˜¯ä»€ä¹ˆç±»å‹ï¼Œæ¥å£æ˜¾ç¤ºä¹Ÿè¿‡äºç¹çï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ä½“ç±»ç›´æ¥æ˜¾ç¤ºåœ¨æ–‡æ¡£ä¸­ï¼Œå½“æ—¶ç”¨åˆ°è¯¥å®ä½“ç±»æ—¶åœ¨åº•éƒ¨ç¿»æ‰¾å±æ€§å¯¹åº”å‚æ•°å³å¯ï¼Œä¸€ä¸ªå®ä½“ç±»å¯ä»¥å¯¹åº” N å¤šä¸ªæ¥å£ï¼Œä¸€åŠ³æ°¸é€¸</p><blockquote><p>å®ä½“ç±»çš„é…ç½®</p></blockquote><p>é…ç½®å®ä½“ç±»ååˆ†çš„ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ä¸¤ä¸ªæ³¨è§£å°±å¯ä»¥å®ŒæˆåŸºæœ¬æ“ä½œï¼š</p><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>@ApiModel()</td><td>å®ä½“ç±»åç§°</td></tr><tr><td>@ApiModelProperty()</td><td>å®ä½“ç±»ä¸­æ¯ä¸ªå­—æ®µä»£è¡¨çš„å«ä¹‰è§£é‡Š</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;å‘˜å·¥å®ä½“ç±»&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;å‘˜å·¥IDï¼Œç”¨æ¥è¯†åˆ«å‘˜å·¥çš„å”¯ä¸€è¡¨ç¤ºï¼Œä¸å¯é‡å¤ã€‚&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;å‘˜å·¥å§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;å‘˜å·¥å¹´é¾„&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/swagger-09.jpg" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>apiæ–‡æ¡£</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Swagger</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CentOS8 éƒ¨ç½²æœåŠ¡å™¨ç¯å¢ƒ</title>
    <link href="/2022/07/13/CentOS8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83/"/>
    <url>/2022/07/13/CentOS8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h1>CentOS8 éƒ¨ç½²æœåŠ¡å™¨ç¯å¢ƒ</h1><h2 id="è¿œç¨‹è¿æ¥æœåŠ¡å™¨">è¿œç¨‹è¿æ¥æœåŠ¡å™¨</h2><p>è¿æ¥æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯ xshell å·¥å…·ï¼Œç™¾åº¦ä¸‹è½½å³å¯</p><p>å¦‚æœä½ çš„æœåŠ¡å™¨æ˜¯è´­ä¹°çš„ ( ä¾‹å¦‚é˜¿é‡Œ )ï¼Œéœ€è¦å»ä½ æœåŠ¡å™¨çš„å®‰å…¨ç»„è¿›è¡Œç«¯å£æ”¾è¡Œæ‰å¯ä»¥ä½¿ç”¨ï¼Œè¯¦æƒ…ç™¾åº¦ï¼Œæˆ‘è¿™é‡Œæ˜¯æ–°å»ºçš„ centos 8 çš„è™šæ‹Ÿæœºï¼Œé€šè¿‡è™šæ‹Ÿæœºæ¨¡æ‹ŸçœŸå®çš„æœåŠ¡å™¨ï¼Œæƒ³è¦è¿æ¥è™šæ‹Ÿæœºéœ€è¦ä½¿ç”¨æŒ‡å®šå‘½ä»¤è·å– ip åœ°å€</p><h3 id="è·å–-IP-åœ°å€">è·å– IP åœ°å€</h3><p>( å·²è´­ä¹°æœåŠ¡å™¨ç”¨æˆ·å¯ä»¥è·³è¿‡ï¼Œå¯ä»¥çœ‹çœ‹å¦‚ä½•è®¾ç½®å®‰å…¨ç»„å¼€æ”¾ç«¯å£ )</p><p>å› ä¸ºè´­ä¹°æœåŠ¡å™¨ä¼šç»™ä¸€æ¡å¤–ç½‘ ip åœ°å€ï¼Œä½†è™šæ‹Ÿæœºåˆ›å»ºæ˜¯ä¸ä¼šå‘Šè¯‰ä½  ip åœ°å€çš„ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±æ‰‹åŠ¨è¿è¡Œè™šæ‹Ÿæœºè¿›è¡Œè·å–ï¼Œä½¿ç”¨å‘½ä»¤ <code>ifconfig</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># ifconfig</span></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.0.105  netmask 255.255.255.0  broadcast 192.168.0.255</span><br><span class="line">        inet6 fe80::a234:dff6:40db:cb50  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:5f:11:17  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 17256  bytes 20130010 (19.1 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 4184  bytes 360390 (351.9 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 52  bytes 4320 (4.2 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 52  bytes 4320 (4.2 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255</span><br><span class="line">        ether 52:54:00:da:e0:e9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä½¿ç”¨äº† <code>ifconfig</code> å‘½ä»¤åï¼Œä¸‹é¢åˆ—å‡ºäº†ä¸‰ä¸ª ip åœ°å€ï¼Œåˆ†åˆ«æ˜¯ <code>192.168.0.105</code>ï¼Œ<code>127.0.0.1</code>ï¼Œ<code>192.168.122.1</code>ï¼Œç­›é€‰åå¾—å‡ºæˆ‘çš„ ip åœ°å€ä¸º <code>192.168.0.105</code></p><p>åŒå‡»æ‰“å¼€ shellï¼Œä¾æ¬¡ç‚¹å‡»ã€æ–‡ä»¶ã€‘ã€æ–°å»ºã€‘ï¼Œç„¶ååœ¨å¼¹å‡ºçš„é¡µé¢å·¦ä¾§é€‰æ‹©ã€è¿æ¥ã€‘ï¼Œå³ä¾§å¡«å†™æœåŠ¡å™¨ä¿¡æ¯å³å¯</p><p><img src="https://s2.loli.net/2024/01/06/JoNdYBrKv7O1PcD.png" alt="WindTerm"><br>ç‚¹å‡»ç¡®å®šåï¼Œå·¦ä¾§å°±ä¼šå‡ºç°ä½ åˆšåˆšæ–°å»ºçš„å›è¯ï¼ŒåŒå‡»è¿æ¥ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç å°±å¯ä»¥æ“ä½œæœåŠ¡å™¨äº†ï¼Œå»ºè®®ç”¨ root ç”¨æˆ·ç™»å½•é˜²æ­¢å‡ºç°æƒé™é—®é¢˜ç­‰ç­‰ã€‚</p><blockquote><p>CentOS 7 æ³¨æ„äº‹é¡¹</p></blockquote><p>å¦‚æœä½¿ç”¨çš„æ˜¯ centos7 çš„è¯æŸ¥çœ‹ ip åœ°å€çš„å‘½ä»¤ä¸º <code>ip addr</code>ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#ip addr</span><br><span class="line">1: lnk/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: enp2s1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:17:08:49:9d:c5 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>2: åé¢è·Ÿç€çš„ <code>ens33</code> å°±æ˜¯ç½‘å¡åç§°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>ifup ens33</code> æ¥å¼€å¯ç½‘å¡ï¼Œå°±å¯ä»¥è®¿é—®ç½‘ç»œï¼Œä½†æ˜¯æ¯æ¬¡å¼€æœºéƒ½éœ€è¦æ‰‹åŠ¨å¼€å¯ç½‘å¡æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾ç½®ç½‘å¡å¼€æœºè‡ªå¯ï¼š</p><p>åœ¨ centos7 çš„<code>/etc/sysconfig/network-scripts</code> ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ª <code>ifcfg-ç½‘å¡åç§°</code> çš„æ–‡ä»¶ï¼Œä½¿ç”¨ vim æ‰“å¼€è¯¥æ–‡ä»¶å°† <code>ONBOOT=no</code> æ”¹ä¸º <code>yes</code>ï¼Œç½‘å¡å°±å¯ä»¥å¼€æœºè‡ªå¯åŠ¨äº†</p><h3 id="é˜²ç«å¢™è®¾ç½®">é˜²ç«å¢™è®¾ç½®</h3><p>å¦‚æœ IP åœ°å€è¾“å…¥æ­£ç¡®ï¼Œç”¨æˆ·åå¯†ç ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†è¿˜æ˜¯è¿ä¸ä¸Šï¼Œé‚£ä¹ˆå¯èƒ½å°±æ˜¯é˜²ç«å¢™ç»™æ‹¦æˆªäº†ï¼Œæ‰“å¼€è™šæ‹Ÿæœºä¿®æ”¹é˜²ç«å¢™é…ç½®</p><blockquote><p>CentOS æ“ä½œé˜²ç«å¢™å¸¸ç”¨å‘½ä»¤</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ï¼Œrunningæ˜¯è¿è¡Œä¸­ï¼Œnot runningæ˜¯åœæ­¢ä¸­</span></span><br><span class="line">firewall-cmd --state</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å¼€é˜²ç«å¢™</span></span><br><span class="line">systemctl start firewalld.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰å¼€æ”¾çš„ç«¯å£-ports</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥è¯¢æŒ‡å®šç«¯å£å¼€æ”¾çŠ¶æ€ <span class="built_in">yes</span>å¼€å¯ï¼Œnoå…³é—­</span></span><br><span class="line">firewall-cmd --query-port=22/tcp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€æ”¾/å…³é—­ æŒ‡å®šç«¯å£ -- premanentä»£è¡¨æ°¸è¿œç”Ÿæ•ˆï¼Œå¦‚æœä¸æºå¸¦è¯¥å‚æ•°åˆ™ä»…æœ¬æ¬¡æœ‰æ•ˆ</span></span><br><span class="line">firewall-cmd --add-port=22/tcp --permanent</span><br><span class="line">firewall-cmd --remove-port=22/tcp --permanent</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯é˜²ç«å¢™æœåŠ¡ -- ç«¯å£çŠ¶æ€ä¿®æ”¹åé‡å¯ç”Ÿæ•ˆ</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>äº†è§£äº†ä»¥ä¸Šå‘½ä»¤åï¼Œå°±å¯ä»¥å°†ç«¯å£å¼€æ”¾äº†ï¼Œè¿™é‡Œåªå¼€æ”¾ 22 å‰©ä¸‹éšç”¨éšå¼€å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=22/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-JDK-8">éƒ¨ç½² JDK 8</h2><p>ç™¾åº¦ Oracle ä¸‹è½½ jdk8 Linux ç‰ˆæœ¬ï¼Œåœ¨ Oracle å®˜ç½‘é’ˆå¯¹ Linux ç‰ˆæœ¬çš„ jdk æä¾›äº†å››ç§æ–‡ä»¶åŒ…ï¼Œé™¤äº†å’±ä»¬ç†Ÿæ‚‰çš„ x86 å’Œ x64 ä¹‹å¤–ï¼Œè¿˜æœ‰ rpm å’Œ tar.gz çš„æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº† tar.gz å‹ç¼©æ–‡ä»¶è¿›è¡Œå®‰è£…é…ç½®</p><p>é¦–å…ˆå°† tar.gz æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶ååœ¨ä¸‹è½½å¦ä¸€ä¸ªè¿œç¨‹æ“ä½œè½¯ä»¶ xftpï¼Œå®ƒçš„åŠŸèƒ½ç±»ä¼¼ xshellï¼Œä¸è¿‡ xshell æ˜¯ç”¨æ¥æ¨¡æ‹Ÿç»ˆç«¯çš„ï¼Œè€Œ xftp æ˜¯ç”¨æ¥ä¼ è¾“æ–‡ä»¶çš„ï¼Œä¸‹è½½å¥½ xftp ååŒå‡»æ‰“å¼€</p><p>ä¾æ¬¡æŒ‰ç…§é¡ºåºç‚¹å‡»å·¦ä¸Šè§’çš„ã€æ–‡ä»¶ã€‘ã€æ–°å»ºã€‘ï¼Œå¡«å†™ä¿¡æ¯äº xshell åŸºæœ¬ä¸€è‡´ï¼Œåè®®çš„ä½ç½®é€‰æ‹© <code>SFTP</code> ï¼Œç„¶ååœ¨ä¸‹é¢å°†ç”¨æˆ·åå’Œå¯†ç ç›´æ¥å¡«å…¥å³å¯</p><p>ç„¶åè¿æ¥æœåŠ¡å™¨ï¼Œå°†ä¹‹å‰ä¸‹è½½å¥½çš„ tar.gz æ–‡ä»¶æ‹–æ‹½åˆ°æœåŠ¡å™¨ ( å³ä¾§çª—å£ ) ä¸Šä¼ è‡³å¦‚ä¸‹ç›®å½•ï¼Œç„¶åè§£å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–‡ä»¶ä¸Šä¼ ç›®å½•</span></span><br><span class="line">/usr/local</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œè¡¥å……ä¸€ä¸ªå°æŠ€å·§ï¼Œå¦‚æœ xftp æ˜¾ç¤ºä¸­æ–‡æ–‡ä»¶åä¹±ç çš„è¯ï¼ŒæŒ‰ç…§å¦‚ä¸‹é¡ºåºèµ°ä¸€éå³å¯<ul><li>é€‰ä¸­å½“å‰è¿æ¥ã€æ–‡ä»¶ã€‘ã€å±æ€§ã€‘ä¸Šæ–¹é€‰é¡¹å¡ã€é€‰é¡¹ã€‘å‹¾é€‰ã€ä½¿ç”¨ UTF-8 ç¼–ç ã€‘| å®Œæˆ</li></ul></li></ul><blockquote><p>Xshell ä¸‹æ“ä½œ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»åŠ¨ä½ç½®åˆ°å½“å‰ç›®å½•</span></span><br><span class="line">cd /usr/local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹æ–‡ä»¶</span></span><br><span class="line">tar -zxvf jdk-8u181-linux-x64.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†æ–‡ä»¶é‡å‘½åä¸ºç®€å•çš„åç§°</span></span><br><span class="line">mv jdk1.8.0_181 jdk8</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æ‰æ— ç”¨çš„ tar.gz æ–‡ä»¶</span></span><br><span class="line">rm -rf jdk-8u181-linux-x64.tar.gz</span><br></pre></td></tr></table></figure><p>æˆªæ­¢åˆ°ç›®å‰ï¼ŒJava å·²ç»å®‰è£…å®Œæ¯•äº†ï¼Œè¿™ä¸ªæ²¡æœ‰å®‰è£…è¿‡ç¨‹ï¼Œè§£å‹ä»–çš„è¿‡ç¨‹å°±æ˜¯å®‰è£…ï¼Œæ¥ä¸‹æ¥æ˜¯é…ç½®ç¯å¢ƒå˜é‡ï¼Œåˆ‡æ¢ç›®å½•åˆ° <code>etc</code> ä¸‹ä½¿ç”¨ xshell æ“ä½œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢ç›®å½•</span></span><br><span class="line">cd /etc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨vimç¼–è¾‘å™¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ç¯å¢ƒå˜é‡</span></span><br><span class="line">vim profile</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä»¥ä¸Šå‘½ä»¤åï¼Œå°±ä¼šçœ‹åˆ°é…ç½®æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œç¿»åˆ°æ–‡ä»¶æœ€åº•éƒ¨æ•²å‡»å­—æ¯ iï¼Œä¸‹æ–¹ä¼šæç¤ºæ’å…¥æ¨¡å¼ï¼Œç„¶ååœ¨æœ€åº•ä¸‹ç¼–å†™ä»£ç ï¼Œæ·»åŠ  jdk çš„ç¯å¢ƒå˜é‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="variable constant_">JAVA_HOME</span>=<span class="regexp">/usr/</span>local/jdk8</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">PATH</span>=<span class="attr">$PATH</span>:$JAVA_HOME/bin</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">CLASSPATH</span>=.:$JAVA_HOME/lib/dt.<span class="property">jar</span>:$JAVA_HOME/lib/tools.<span class="property">jar</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">JRE_HOME</span>=$JAVA_HOME/jre</span><br></pre></td></tr></table></figure><ul><li>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¾“å…¥ jdk8 çš„æ—¶å€™ï¼Œå°é”®ç›˜æ•°å­—é”®æ˜¯ä¸èƒ½ç”¨çš„</li></ul><p>ç¼–å†™å®Œæˆåï¼Œæ•²å‡»é”®ç›˜å·¦ä¸Šè§’çš„ <code>esc</code> é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œæ­¤æ—¶ä½ å¤„äºå‘½ä»¤æ¨¡å¼ï¼Œç„¶åæ•²å‡» <code>:wq</code> ( ä¿å­˜å¹¶é€€å‡º ) ç„¶åå›è½¦å³å¯ã€‚é…ç½®æ–‡ä»¶å°±æå®šäº†ï¼Œç„¶åè¾“å…¥å‘½ä»¤åˆ·æ–°ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ›´æ–°èµ„æºæ–‡ä»¶</span></span><br><span class="line">source profile</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±åƒåœ¨ Windows ä¸­ä¸€æ ·è¾“å…¥ <code>javac</code>ï¼Œ<code>java</code>ï¼Œ<code>java -version</code> æ¥æµ‹è¯• jdk æœ‰æ²¡æœ‰å®‰è£…æˆåŠŸå§</p><blockquote><p>â€“ è¡¥å……</p></blockquote><p>å½“æˆ‘ä»¬åœ¨ Windows ä¸­å°†æ‰“åŒ…å¥½çš„ springboot çš„ jar åŒ…æ”¾åœ¨ centos ä¸­è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå‘ç°ä»–å¯åŠ¨çš„ç‰¹åˆ«æ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ›´æ”¹ä¸€äº›é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘JDKä¸‹çš„æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line">vim /usr/local/jdk8/jre/lib/security/java.security</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ securerandom.source çš„å€¼ä¸ºå¦‚ä¸‹æ‰€ç¤º</span></span><br><span class="line">securerandom.source=file:/dev/urandom</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-Tomcat-8-5">éƒ¨ç½² Tomcat 8.5</h2><p>å®‰è£… tomcat åŒ jdk ä¸€æ ·ï¼Œé¦–å…ˆæ˜¯å»å®˜ç½‘ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„ tomcat çš„å‹ç¼©åŒ…ï¼Œç„¶åä¸Šä¼ è‡³æœåŠ¡å™¨ç­‰ç­‰æ“ä½œ</p><blockquote><p>tomcat 8.5 ä¸‹è½½åœ°å€ï¼Œè®°ç€é€‰æ‹© tar.gz çš„ Linux ç‰ˆæœ¬</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://tomcat.apache.org/download-80.cgi</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåï¼Œä½¿ç”¨ XFTP å·¥å…·å°†å‹ç¼©åŒ…ä¸Šä¼ è‡³æœåŠ¡å™¨çš„ <code>/usr/local</code> ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ xshell  ä¸­æ“ä½œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹tomcatåŒ…</span></span><br><span class="line">tar -zxvf apache-tomcat-8.5.55.tar.gz</span><br></pre></td></tr></table></figure><p>è§£å‹ä¹‹åå°±å·²ç»ç®—æ˜¯å®‰è£…å®Œæˆäº†ï¼Œå¯ä»¥ cd åˆ° tomcat ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨tomcatæœåŠ¡</span></span><br><span class="line">startup.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­tomcatæœåŠ¡</span></span><br><span class="line">shutdown.sh</span><br></pre></td></tr></table></figure><p>å¯åŠ¨åé€šè¿‡ ip åœ°å€ + 8080 ç«¯å£å·æ˜¯å¯ä»¥è®¿é—®åˆ°ç½‘ç«™çš„ï¼Œå¦‚æœè®¿é—®å¤±è´¥å¯ä»¥å°è¯•å¼€æ”¾é˜²ç«å¢™ 8080 ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><blockquote><p>ç¯å¢ƒå˜é‡é…ç½®</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /etc</span><br><span class="line">vim profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨insertæ¨¡å¼ä¸‹è¿½åŠ æ®µä»£ç </span></span><br><span class="line">export CATALINA_HOME=/usr/local/tomcat/apache-tomcat-8.5.31</span><br><span class="line">export PATH=$PATH:$CATALINA_HOME/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç„¶åä¿å­˜åˆ·æ–°å³å¯</span></span><br><span class="line">source profile</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-MySQL">éƒ¨ç½² MySQL</h2><h3 id="ä¸‹è½½åŠå®‰è£…">ä¸‹è½½åŠå®‰è£…</h3><p>ä¹‹å‰çš„ç¯å¢ƒéƒ½æ˜¯ä¸‹è½½å¥½ç„¶åè¿›è¡Œç¦»çº¿å®‰è£…çš„ï¼Œä¸è¿‡è¿™æ¬¡çš„ mysql çš„å®‰è£…æ˜¯éœ€è¦è”ç½‘çš„ï¼Œç ”ç©¶äº†ä¸€ä¸‹åˆç¦»çº¿å®‰è£…æ²¡æœ‰æˆåŠŸâ€¦å¦¥åäº† ( &gt;_&lt; )ï¼Œæ¯•ç«Ÿæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡</p><p>é¦–å…ˆå» mysql å®˜ç½‘ä¸‹è½½å®‰è£…æ‰€éœ€è¦çš„ rpm åŒ…ï¼Œå®˜ç½‘ç›´è¿åœ°å€ï¼š</p><blockquote><p>æˆ‘å®‰è£…çš„æ˜¯ 5.7.30 ä¸‹çš„ Red Hat ä¸‹çš„ Linux 7ï¼Œåœ¨ä¸‹é¢é€‰æ‹©ç¬¬ä¸€ä¸ª RPM Bundle ä¸‹è½½åˆ°æœ¬åœ°å³å¯ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dev.mysql.com/downloads/mysql/</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåè¿œç¨‹è¿æ¥ä½ çš„ æœåŠ¡å™¨ / è™šæ‹Ÿæœºï¼Œcd è‡³ <code>usr/local/</code> ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†ä½ ä¸‹è½½å¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æ–°å»ºæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åå¼€å§‹è§£å‹ï¼Œå‘½ä»¤å¦‚ä¸‹</p><blockquote><p>å› ä¸ºä»–æ²¡æœ‰ç»™æ–‡ä»¶åŒ…ä¸€å±‚ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘é€‰æ‹©äº†æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™æ ·è§£å‹åæ–‡ä»¶å°±ä¸ä¼šä¹±</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–°å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">mkdir /usr/local/abc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»åŠ¨åˆ°ç›®æ ‡æ–‡ä»¶å¤¹</span></span><br><span class="line">cd /usr/local/abc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šä¼ æ–‡ä»¶åï¼Œè¿›è¡Œè§£å‹</span></span><br><span class="line">tar -xvf mysql-5.7.30-1.el7.x86_64.rpm-bundle.tar</span><br></pre></td></tr></table></figure><hr />> æ¥ä¸‹æ¥å‡†å¤‡å®‰è£…ç¯å¢ƒï¼Œä¾æ¬¡è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…ä¸‰ä¸ªä¾èµ–</span></span><br><span class="line">yum -y install libaio perl net-tools</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¾èµ–æ£€æµ‹å¤±è´¥ï¼šlibncurses.so.5()(64bit) è¢« ... éœ€è¦</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªå¯ä»¥å…ˆä¸æ‰§è¡Œï¼Œç­‰å®‰è£…æŠ¥é”™åœ¨å®‰è£…ä¹Ÿå¯ä»¥</span></span><br><span class="line">dnf install ncurses-compat-libs</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦äº†mariadbï¼Œå¦‚æœ‰å°±å¸è½½ï¼Œä¼šå½±å“å®‰è£…</span></span><br><span class="line">rpm -qa|grep mariadb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¸è½½å‘½ä»¤</span></span><br><span class="line">rpm -e --nodeps mariadb-libs-5.5.56-2.el7.x86_64</span><br></pre></td></tr></table></figure><blockquote><p>ä¾èµ–å®‰è£…å®Œæˆåï¼Œåœ¨è§£å‹å¥½çš„ç›®å½•ä¸‹ï¼Œå¼€å§‹å®‰è£… rpm åŒ…ï¼š</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh mysql-community-common-5.7.30-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-5.7.30-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-client-5.7.30-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-server-5.7.30-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><p>ä¾æ¬¡å®‰è£…å®Œæˆåå¯åŠ¨ mysql æœåŠ¡ï¼Œæ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœæç¤º avive (running) å³ä¸ºå®‰è£…æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨mysqlæœåŠ¡</span></span><br><span class="line">service mysqld start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥mysqlå¯åŠ¨çŠ¶æ€</span></span><br><span class="line">service mysqld status</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœæç¤º avive (running) å³ä¸ºå®‰è£…æˆåŠŸ</span></span><br><span class="line">[root@localhost mysql-cache]# service mysqld start</span><br><span class="line">Redirecting to /bin/systemctl start mysqld.service</span><br><span class="line">[root@localhost mysql-cache]# service mysqld status</span><br><span class="line">Redirecting to /bin/systemctl status mysqld.service</span><br><span class="line">â— mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Wed 2020-06-03 02:03:49 CST; 5s ago</span><br><span class="line">     Docs: man:mysqld(8)</span><br><span class="line">           http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">  Process: 14149 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $M&gt;</span><br><span class="line">  Process: 14123 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 14152 (mysqld)</span><br><span class="line">    Tasks: 27 (limit: 11362)</span><br><span class="line">   Memory: 248.5M</span><br><span class="line">   CGroup: /system.slice/mysqld.service</span><br><span class="line">           â””â”€14152 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br></pre></td></tr></table></figure><blockquote><p>centos ä¸‹å¯¹ mysql æœåŠ¡çš„æ“ä½œå‘½ä»¤ ( å…¶å®åœ¨ linux ä¸­ï¼ŒæœåŠ¡ä¸å«æœåŠ¡ï¼Œå«åšå®ˆæŠ¤è¿›ç¨‹ )ï¼š</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨ mysql æœåŠ¡</span></span><br><span class="line">service mysqld start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­ mysql æœåŠ¡</span></span><br><span class="line">service mysqld stop</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯ mysql æœåŠ¡</span></span><br><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-MySQL">é…ç½® MySQL</h3><p>åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»æˆåŠŸçš„å®‰è£…äº† mysql 5.7.30ï¼Œæ¥ä¸‹æ¥åªéœ€è¦è¿›è¡Œä¸€äº›åç»­çš„å¤„ç†ï¼Œè¿™ä¸ª mysql æ•°æ®åº“å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚</p><blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p></blockquote><p>ç”± rpm å‘½ä»¤å®‰è£…çš„ mysqlï¼Œä»–çš„é…ç½®æ–‡ä»¶ä½äº <code>/etc/my.cnf</code> å¤„ï¼Œåœ¨å°¾éƒ¨åŠ ä¸Šè¿™æ ·ä¸¤å¥å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ä¸ªäººé…ç½®ï¼Œå¯é€‰æ‹©æ€§è·³è¿‡ ##</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­å¯†ç å®‰å…¨ç­–ç•¥éªŒè¯</span></span><br><span class="line">validate-password=OFF</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­è¡¨ååŒºåˆ†å¤§å°å†™ 0ä¸ºåŒºåˆ†ï¼Œ1ä¸ºä¸åŒºåˆ†</span></span><br><span class="line">lower_case_table_names=1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®å­—ç¬¦é›†</span></span><br><span class="line">character-set-server=utf8</span><br></pre></td></tr></table></figure><ul><li>æ³¨ï¼šæ¯æ¬¡ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åéƒ½è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ</li></ul><blockquote><p>è®¾ç½® root å¯†ç </p></blockquote><p>æƒ³è¦è®¾ç½® root å¯†ç ï¼Œé¦–å…ˆè¦å…ˆç™»å½• mysql æ•°æ®åº“ï¼Œä½†æ˜¯æ²¡æœ‰å¯†ç æ€ä¹ˆç™»å½•ï¼Ÿå…¶å®åœ¨æˆ‘ä»¬å®‰è£… mysql çš„æ—¶å€™å·²ç»ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªä¸´æ—¶çš„å¯†ç ï¼ŒæŸ¥çœ‹å¯†ç çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœ€åçš„ä¸€ä¸²åƒä¹±ç ä¸€æ ·çš„ä¸œè¥¿å°±æ˜¯ä¸´æ—¶å¯†ç </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ–è€…ä½¿ç”¨ <span class="built_in">cat</span> /var/log/mysqld.log å‘½ä»¤çœ‹å‰å‡ è¡Œç¬¬ä¸€ä¸ª [Note] çš„ä½ç½®</span></span><br><span class="line">grep password /var/log/mysqld.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2020-06-02T20:37:30.623479Z 1 [Note] A temporary password is generated <span class="keyword">for</span> root@localhost: ,mhLlwzx&gt;5g!</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªä¸´æ—¶çš„å¯†ç ç™»å½• mysql çš„ root ç”¨æˆ·åï¼Œç¬¬ä¸€ä»¶äº‹å„¿å°±æ˜¯ä¿®æ”¹ä»–çš„å¯†ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¦‚æœä½ ä¹‹å‰æ²¡æœ‰å–æ¶ˆå¯†ç å®‰å…¨ç­–ç•¥ï¼Œé‚£ä¹ˆè¿™é‡Œå°±è¦æƒ³ä¸€ä¸ªç»å¦™çš„å¯†ç </span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> password <span class="operator">=</span> password(&quot;ä½ çš„å¯†ç &quot;);</span><br></pre></td></tr></table></figure><p>å¯†ç ä¿®æ”¹å®Œæˆåï¼Œä½ å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ä½ çš„æ•°æ®åº“å•¦ï¼Œä½†æ˜¯è¿˜æœ‰ç‚¹æ”¶å°¾å·¥ä½œè¦åš â†“ â†“ â†“</p><blockquote><p>å¼€æ”¾é˜²ç«å¢™ 3306 ç«¯å£ï¼Œé…ç½®è¿œç¨‹è¿æ¥æ•°æ®åº“</p></blockquote><p>ç°åœ¨çš„æ•°æ®åº“ä»…ä»…åœ¨æœ¬åœ°èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè¿œç¨‹æ“ä½œæ•°æ®åº“ï¼Œè¿˜éœ€è¦è¿›è¡Œä¸€äº›é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€æ”¾é˜²ç«å¢™ 3306 ç«¯å£</span></span><br><span class="line">firewall-cmd --add-port=3306/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯é˜²ç«å¢™æœåŠ¡</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>å¼€æ”¾ 3306 ç«¯å£åï¼Œä½ ä¼šå‘ç°è¿˜æ˜¯ä¸èƒ½è¿œç¨‹è®¿é—®ä½ çš„æ•°æ®åº“ï¼Œå› ä¸ºä½ è¿˜éœ€è¦æœ€åä¸€æ­¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿›å…¥mysqlä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ ( åœ¨è¿™é‡Œä¹Ÿæ˜¯éœ€è¦éªŒè¯å¯†ç å®‰å…¨ç­–ç•¥çš„ )</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;ä½ çš„å¯†ç &#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼mysql ç®—æ˜¯å®‰è£…é…ç½®å®Œæˆäº†ï¼Œå½“ç„¶è¿™ä¸ªå¾ˆç®€é™‹ï¼ŒçœŸå®æœåŠ¡å™¨ç¯å¢ƒä¸Šé…ç½®çš„æ•°æ®åº“æ¯”è¿™ä¸ªè¿˜è¦å¤æ‚ï¼Œæ¶‰åŠåˆ°ç”¨æˆ·ç»„å’Œæƒé™ç®¡ç†çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œåªæ˜¯ç»ƒä¹ ç”¨ï¼Œå°±ä¸å†™é‚£ä¹ˆå¤šäº†ã€‚</p><h2 id="éƒ¨ç½²-Redis">éƒ¨ç½² Redis</h2><blockquote><p>redis çš„ä¸‹è½½</p></blockquote><p>é¦–å…ˆè¦å» redis çš„å®˜ç½‘ä¸‹è½½ä»–çš„å‹ç¼©åŒ…ï¼Œå®˜ç½‘ [ ä¸­æ–‡ ] ç›´è¿åœ°å€å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.redis.cn/</span><br></pre></td></tr></table></figure><p>è¿›å…¥å®˜ç½‘åç›´æ¥ä¸‹è½½å³å¯ï¼Œç„¶åè¿œç¨‹è¿æ¥ æœåŠ¡å™¨/è™šæ‹Ÿæœº å°†ä¸‹è½½å¥½çš„æ–‡ä»¶ä¸Šä¼ è‡³ <code>/usr/local</code> ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥åˆ°usr/localç›®å½•</span></span><br><span class="line">cd /usr/local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šä¼ æ–‡ä»¶åï¼Œæ‰§è¡Œè§£å‹å‘½ä»¤</span></span><br><span class="line">tar -zxvf redis-5.0.5.tar.gz</span><br></pre></td></tr></table></figure><blockquote><p>redis çš„å®‰è£…</p></blockquote><p>åœ¨æ‰§è¡Œå®‰è£…å‘½ä»¤ä¹‹å‰ï¼Œé¦–é€‰éœ€è¦å®‰è£… gcc çš„ä¾èµ–ï¼Œå¦‚å·²å®‰è£…è¯·å¿½ç•¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ‡æ¢åˆ° redis ç›®å½•ä¸‹å¼€å§‹æ‰§è¡Œå®‰è£…å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢ç›®å½•åˆ°redisä¸‹</span></span><br><span class="line">cd redis-5.0.5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡Œå®‰è£…å‘½ä»¤</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œå®‰è£…å°±é¡ºåˆ©ç»“æŸäº†ï¼Œå¦‚æœæç¤º -bash: make: command not found åˆ™ä»£è¡¨ gcc æ²¡æœ‰è£…ï¼Œéœ€è¦é‡æ–°å®‰è£… gcc ç¯å¢ƒ</p><blockquote><p>redis çš„é…ç½®</p></blockquote><p>å®é™…ä¸Šè¿™ä¸ªæ—¶å€™ redis å·²ç»å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œä½†æ˜¯ç›´æ¥æ‰§è¡Œè¿è¡Œçš„æ˜¯é»˜è®¤çš„é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€å¥—è‡ªå·±çš„é…ç½®ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå»ºè®®å¤åˆ¶ä¸€ä¸ªä½œä¸ºå¤‡ä»½ï¼Œç„¶ååœ¨ä¿®æ”¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–°å»ºç›®å½•å¹¶è¿›å…¥</span></span><br><span class="line">mkdir my_config</span><br><span class="line">cd my_config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line">cp ../redis.conf redis.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘é…ç½®æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">vim redis.conf</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ä»¥ä¸‹ä¸¤è¡Œå³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨é‡Šæ‰<span class="built_in">bind</span>ï¼Œå–æ¶ˆè®¿é—®redisçš„ipåœ°å€é™åˆ¶ï¼Œå¦åˆ™åªæœ‰æœ¬æœºæ‰èƒ½è®¿é—®</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">bind</span> 127.0.0.1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ä¸º <span class="built_in">yes</span>ï¼Œå¯ä»¥åå°è¿è¡Œredisï¼Œå¦åˆ™ä¼šé”å®šå‘½ä»¤è¡Œ</span></span><br><span class="line">daemonize yes</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œ redis å¹¶åˆ›å»ºè¿æ¥</p></blockquote><p>å¥½äº†ï¼Œredis çš„å®‰è£…åŸºæœ¬å®Œæˆäº†ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæœ‰äº†å±äºè‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹ redisï¼Œåœ¨è¿è¡Œ redis ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œredis æœ‰ä¸¤ä¸ªå¯ä»¥å¯åŠ¨çš„ç¨‹åºï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯ï¼Œä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯</p><p>é¦–å…ˆæˆ‘ä»¬æ¥è¿è¡ŒæœåŠ¡ç«¯ <code>redis-sever</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœç›´æ¥è¾“å…¥åˆ™ä½¿ç”¨é»˜è®¤é…ç½®</span></span><br><span class="line">redis-server</span><br><span class="line"><span class="comment"># å¯ä»¥åœ¨åé¢è¿½åŠ é…ç½®æ–‡ä»¶åç§°ï¼Œè®©ä»–æŒ‰ç…§æŒ‡å®šçš„é…ç½®å¯åŠ¨ï¼Œè¿™é‡Œå°±è®©ä»–ä»¥å’±è‡ªå®šä¹‰çš„é…ç½®å¯åŠ¨</span></span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å¯åŠ¨å®¢æˆ·ç«¯ <code>redis-cli</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœç›´æ¥è¾“å…¥åˆ™é»˜è®¤è¿æ¥æœ¬åœ°çš„6379ç«¯å£</span></span><br><span class="line">redis-cli</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°æ¥æŒ‡å®šç›®æ ‡IPåœ°å€æˆ–ç«¯å£å·</span></span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure><p>å°è¯•è¾“å…¥ä¸€ä¸ª ping å‘½ä»¤ï¼Œæµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¦‚æœè¿”å› PONG å°±è¯æ˜ä¸€åˆ‡æ­£å¸¸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><blockquote><p>å…³é—­ redis</p></blockquote><p>å¦‚æœä¸æ—¶ç”¨ä»»ä½•é…ç½®è®©ä»–é»˜è®¤å¯åŠ¨çš„è¯ï¼Œç›´æ¥ Ctrl + C å°±å¯ä»¥å…³é—­ redisï¼Œé‚£ä¹ˆåå°è¿è¡Œåº”è¯¥æ€ä¹ˆå…³ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡åï¼Œæ‰§è¡Œå…³é—­å‘½ä»¤å³å¯</span></span><br><span class="line">redis-cli</span><br><span class="line">shutdown</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç›´æ¥å…³é—­ï¼Œæˆ–è€…æŒ‡å®šIP,ç«¯å£å…³é—­</span></span><br><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¯å¢ƒéƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxç®€å•ä½¿ç”¨</title>
    <link href="/2022/07/13/Nginx%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/07/13/Nginx%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>Nginx ç¬”è®°</h1><p>Nginx æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„ web åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¸¸ç”¨ä¸é…ç½®é›†ç¾¤ä»¥åŠè´Ÿè½½å‡è¡¡</p><h2 id="å®‰è£…é…ç½®-Nginx">å®‰è£…é…ç½® Nginx</h2><blockquote><p>ä¸‹è½½å®‰è£…</p></blockquote><p><strong>1.</strong> éœ€è¦è®¿é—® <a href="http://nginx.org/">nginxå®˜ç½‘</a>ä¸‹è½½æœ€æ–°å‹ç¼©åŒ…ï¼Œä¹Ÿå¯ä»¥åˆ°<a href="http://nginx.org/download/">å†å²ç‰ˆæœ¬</a>ä¸­é€‰æ‹©ä¸‹è½½ï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯<code>nginx-1.19.0.tar.gz</code></p><p><strong>2.</strong> æƒ³è¦å®‰è£… nginx éœ€è¦ä¸€äº›ä¾èµ–ï¼Œè¿œç¨‹è¿æ¥ä½ çš„æœåŠ¡å™¨åï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… nginx çš„ä¾èµ–</span></span><br><span class="line">yum -y install pcre-devel zlib-devel</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä½ çš„æœåŠ¡å™¨å·²å®‰è£… gcc ç¯å¢ƒï¼Œé‚£ä¹ˆè¿™æ­¥å°±å¯ä»¥çœç•¥</span></span><br><span class="line">yum -y install gcc automake autoconf libtool make</span><br></pre></td></tr></table></figure><p><strong>3.</strong> ç¯å¢ƒåˆ°è¿™é‡Œå°±å‡†å¤‡å®Œæ¯•äº†ï¼Œæ¥ä¸‹æ¥å‡†å¤‡å®‰è£… nginxï¼Œå°†ä¹‹å‰ä¸‹è½½å¥½çš„å‹ç¼©æ–‡ä»¶ä¸Šä¼ è‡³æœåŠ¡å™¨ä¸­ï¼Œç„¶åè§£å‹ï¼Œä¸Šä¼ æ­¥éª¤è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œç›´æ¥å¼€å§‹è§£å‹å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»åŠ¨ç›®å½•è‡³<span class="built_in">local</span>ä¸‹ï¼Œç„¶åä¸Šä¼ nginxå®‰è£…åŒ…</span></span><br><span class="line">cd /usr/local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹ä¸Šä¼ çš„å‹ç¼©æ–‡ä»¶</span></span><br><span class="line">tar -zxvf nginx-1.19.0.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»åŠ¨ç›®å½•åˆ°è§£å‹å¥½çš„æ–‡ä»¶ä¸­</span></span><br><span class="line">cd nginx-1.19.0</span><br></pre></td></tr></table></figure><p><strong>4.</strong> æ¥ä¸‹æ¥å‡†å¤‡ç¼–è¯‘å®‰è£…ï¼Œåœ¨è§£å‹å¥½çš„<code>nginx-1.19.0</code>ç›®å½•ä¸­æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥å‹ç¼©åŒ…ï¼Œç”ŸæˆMakefileæ–‡ä»¶</span></span><br><span class="line">./configure</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡Œå®‰è£…æ–¹æ³•</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p><strong>5.</strong> æ‰§è¡Œç»“æŸåç§»åŠ¨ç›®å½•åˆ°<code>/usr/local</code>ä¼šå‘ç°ç›®å½•ä¸­å¤šäº†ä¸€ä¸ª<code>nginx</code>æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹å†…æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZbp1abebnnglcdjsmbh8tZ /]# cd /usr/local/nginx</span><br><span class="line">[root@iZbp1abebnnglcdjsmbh8tZ nginx]# ls</span><br><span class="line">conf  html  logs  sbin</span><br></pre></td></tr></table></figure><p>è¿™æ · nginx å°±å®‰è£…å°±å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° nginx ç›®å½•ä¸‹æœ‰å››ä¸ªæ–‡ä»¶å¤¹ï¼š</p><ul><li><code>conf</code>ï¼šå­˜æ”¾ nginx çš„é…ç½®æ–‡ä»¶</li><li><code>html</code>ï¼šåŸºæœ¬çš„ html é¡µé¢ï¼Œæ¯”å¦‚ nginx çš„æ¬¢è¿é¡µ <code>index.html</code> å°±åœ¨è¿™ä¸ªç›®å½•ä¸‹</li><li><code>logs</code>ï¼šçœ‹åå­—å°±çŸ¥é“æ˜¯å­˜æ”¾è¿è¡Œæ—¥å¿—çš„æ–‡ä»¶å¤¹äº†</li><li><code>sbin</code>ï¼šè¯¥ç›®å½•ä¸‹åªæœ‰ä¸€ä¸ª<code>nginx</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å‘½ä»¤éƒ½æ˜¯é è¿™ä¸ªæ–‡ä»¶è¿è¡Œçš„</li></ul><blockquote><p>è¿è¡Œ nginx</p></blockquote><p>è¿è¡Œ nginx éœ€è¦è¿›å…¥åˆ° sbin ç›®å½•ä¸‹æ‰§è¡Œ nginx å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥sbinç›®å½•</span></span><br><span class="line">[root@iZbp1abebnnglcdjsmbh8tZ nginx]# cd sbin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨ nginx</span></span><br><span class="line">[root@iZbp1abebnnglcdjsmbh8tZ sbin]# ./nginx</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰ä»»ä½•è¿”å›å°±ä»£è¡¨è¿è¡ŒæˆåŠŸäº†ï¼Œnginx é»˜è®¤åœ¨ 80 ç«¯å£è¿è¡Œï¼Œè®¿é—®ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†</p><blockquote><p>é…ç½®ç¯å¢ƒå˜é‡</p></blockquote><p>æˆ‘ä»¬æ¯æ¬¡æ“ä½œ nginx éƒ½è¦ç§»åŠ¨åˆ° sbin ç›®å½•ä¸‹ç„¶åè¿˜è¦åŠ <code>./</code>æ‰èƒ½è°ƒç”¨å‘½ä»¤ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œå°† nginx é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­æ–¹ä¾¿æ—¥åæ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘profileé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@iZbp1abebnnglcdjsmbh8tZ sbin]# vim /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨æ–‡ä»¶çš„æœ€ä¸‹é¢æ·»åŠ Nginxçš„ç¯å¢ƒå˜é‡ï¼Œæ·»åŠ å®Œæˆå :wq é€€å‡ºå³å¯</span></span><br><span class="line">export PATH=$PATH:/usr/local/nginx/sbin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ·æ–°ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@iZbp1abebnnglcdjsmbh8tZ sbin]# souece /etc/profile</span><br></pre></td></tr></table></figure><p>æ“ä½œå®Œæˆåå°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è°ƒç”¨ nginx å‘½ä»¤äº†</p><blockquote><p>Nginx å¸¸ç”¨å‘½ä»¤</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨nginx</span></span><br><span class="line">nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¿«é€Ÿåœæ­¢nginx</span></span><br><span class="line">nginx -s stop</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®Œæ•´æœ‰åºçš„åœæ­¢nginx</span></span><br><span class="line">nginx -s quit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹nginxæ˜¯å¦è¿è¡Œ</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ nginx ç‰ˆæœ¬</span></span><br><span class="line">nginx -v</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">nginx -t</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡æ–°è½½å…¥é…ç½®</span></span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶é¢„è§ˆ">é…ç½®æ–‡ä»¶é¢„è§ˆ</h2><p>åœ¨ nginx ç›®å½•ä¸‹çš„ conf ç›®å½•ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>nginx.conf</code>æ–‡ä»¶ï¼Œå®ƒå°±æ˜¯ nginx çš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…¨å±€é…ç½®æ¨¡å—</span></span><br><span class="line">user nobody;        # é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody</span><br><span class="line">worker_processes 1; # å…è®¸ç”Ÿæˆçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pid /nginx/pid/nginx.pid;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚å…¨å±€ã€httpã€serveréƒ½å¯ä»¥ä½¿ç”¨ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼š</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">debug|info|notice|warn|error|crit|alert|emerg</span></span><br><span class="line">error_log log/error.log debug;</span><br><span class="line">events &#123;</span><br><span class="line">    # eventsæ¨¡å—</span><br><span class="line">    #use epoll;  # äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventport</span><br><span class="line">    accept_mutex on;  # è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon</span><br><span class="line">    multi_accept on;  # è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff</span><br><span class="line">    worker_connections 1024;  # æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;   #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨</span><br><span class="line">    default_type  application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain</span><br><span class="line">    #access_log off; #å–æ¶ˆæœåŠ¡æ—¥å¿—    </span><br><span class="line">    log_format myFormat &#x27;$remote_addrâ€“$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&#x27;; #è‡ªå®šä¹‰æ ¼å¼</span><br><span class="line">    access_log log/access.log myFormat;  #combinedä¸ºæ—¥å¿—æ ¼å¼çš„é»˜è®¤å€¼</span><br><span class="line">    sendfile on;   #å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚</span><br><span class="line">    sendfile_max_chunk 100k;  #æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚</span><br><span class="line">    keepalive_timeout 65;  #è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚</span><br><span class="line"></span><br><span class="line">    upstream mysvr &#123;   </span><br><span class="line">      server 127.0.0.1:7878;</span><br><span class="line">      server 192.168.10.121:3333 backup;  #çƒ­å¤‡</span><br><span class="line">    &#125;</span><br><span class="line">    error_page 404 https://www.baidu.com; #é”™è¯¯é¡µ</span><br><span class="line">    server &#123;</span><br><span class="line">        keepalive_requests 120; #å•è¿æ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚</span><br><span class="line">        listen       4545;   #ç›‘å¬ç«¯å£</span><br><span class="line">        server_name  127.0.0.1;   #ç›‘å¬åœ°å€       </span><br><span class="line">        location  ~*^.+$ &#123;       #è¯·æ±‚çš„urlè¿‡æ»¤ï¼Œæ­£åˆ™åŒ¹é…ï¼Œ~ä¸ºåŒºåˆ†å¤§å°å†™ï¼Œ~*ä¸ºä¸åŒºåˆ†å¤§å°å†™ã€‚</span><br><span class="line">           #root path;  #æ ¹ç›®å½•</span><br><span class="line">           #index vv.txt;  #è®¾ç½®é»˜è®¤é¡µ</span><br><span class="line">           proxy_pass  http://mysvr;  #è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line">           deny 127.0.0.1;  #æ‹’ç»çš„ip</span><br><span class="line">           allow 172.18.5.54; #å…è®¸çš„ip           </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åå‘ä»£ç†">åå‘ä»£ç†</h2><p>åœ¨äº†è§£åå‘ä»£ç†ä¹‹å‰ï¼Œé¦–å…ˆè¦äº†è§£ä»£ç†æ¨¡å¼ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ç§‘å­¦ä¸Šç½‘ï¼Œè¿™é‡Œç”¨ä¸¤å¼ å›¾è¯´æ˜ï¼š</p><p><img src="/img/nginx-01.jpg" alt=""></p><p>ç±»ä¼¼ä¸Šé¢å°±æ˜¯æˆ‘ä»¬æ­£å¸¸è®¿é—®ä¸€ä¸ªç½‘ç«™çš„è¯·æ±‚ï¼Œå¦‚å›¾è®¿é—® Google è‚¯å®šæ˜¯è®¿é—®ä¸äº†çš„ï¼Œæˆ‘ä»¬å°±éœ€è¦æŒ‚ä»£ç†ï¼š</p><p><img src="/img/nginx-02.jpg" alt=""></p><p>è¿™ç§ä»£ç†æœåŠ¡å™¨æ˜¯å®‰æ”¾åœ¨æˆ‘ä»¬å®¢æˆ·ç«¯è¿™ä¸€æ–¹çš„ï¼ŒæœåŠ¡å™¨å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„è¯·æ±‚ç»è¿‡äº†ä»£ç†ï¼Œåå‘ä»£ç†åˆ™åˆšå¥½ç›¸åï¼š</p><p><img src="/img/nginx-03.jpg" alt=""></p><p>åå‘ä»£ç†æˆ‘ä»¬è¯·æ±‚çš„ä»…ä»…æ˜¯ä»£ç†æœåŠ¡å™¨ï¼Œè‡³äºè¯·æ±‚æœ€åç©¶ç«Ÿå‘é€åˆ°å“ªé‡Œå®¢æˆ·ç«¯ä¸çŸ¥é“</p><blockquote><p>å¦‚ä½•ä½¿ç”¨åå‘ä»£ç†</p></blockquote><p>åœ¨ nginx çš„å®‰è£…ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ª<code>conf</code>ç›®å½•ï¼Œæ”¹ç›®å½•ä¸‹çš„<code>nginx.conf</code>é…ç½®æ–‡ä»¶ä¸­çš„ http æ¨¡å—ä¸‹ï¼Œå¯ä»¥é€šè¿‡ server è®¾ç½®åå‘ä»£ç†ï¼Œä»–çš„æ ‡å‡†å†™æ³•æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen       80;</span><br><span class="line">server_name  www.baidu.com;</span><br><span class="line">location / &#123;</span><br><span class="line">    proxy_pass  http://220.181.38.148/;</span><br><span class="line">    index       index.html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>server è¡¨ç¤ºä¸€ä¸ªç›‘å¬çš„ç›®æ ‡</p><ul><li>listen [ ç›‘å¬æ¡ä»¶1 ] å¯ä»¥æ˜¯ç«¯å£å·ï¼Œå¯ä»¥æ˜¯ ip åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯ ip åœ°å€+ç«¯å£å·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *</li><li>server_name [ ç›‘å¬æ¡ä»¶2 ] å¯ä»¥æ˜¯ä¸€ä¸ªåŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªåŸŸå ( é€—å·åˆ†éš” )ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *</li><li>location [ ç›‘å¬æ¡ä»¶3 ] åé¢è·Ÿç€ä¸€ä¸ªç©ºæ ¼ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªurlï¼Œä¾‹å¦‚ /blog/ï¼Œ/shop/ ç­‰ç­‰åŒºåˆ†é¡¹ç›®è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼<ul><li>proxy_pass [ ç›®æ ‡åœ°å€ ]  ç¬¦åˆç›‘å¬æ¡ä»¶åè·³è½¬çš„ç›®æ ‡åœ°å€</li><li>index [ é»˜è®¤é¦–é¡µ ] è·³è½¬çš„ç›®æ ‡é¡¹ç›®è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡è¿™é‡Œè®¾ç½®é»˜è®¤é¦–é¡µï¼Œä¸€èˆ¬ä¸å¸¸ç”¨</li></ul></li></ul></li><li><p>å…³äºé…ç½®å…·ä½“å‚è€ƒç½‘ç«™ï¼š<code>https://www.cnblogs.com/ysocean/p/9392908.html</code></p></li></ul><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥æœ‰å¤šä¸ª server å‡ºç°ï¼Œnginx ä¼šä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ç›‘å¬ï¼Œå½“ç¬¦åˆæŸä¸€ä¸ªçš„æ—¶å€™å°±ä¸ä¼šç»§ç»­å¾€ä¸‹èµ°ã€‚</p><blockquote><p>åå‘ä»£ç†å¯ä»¥å¹²äº›ä»€ä¹ˆ</p></blockquote><p>æˆ‘åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†ä¸¤ä¸ªåº”ç”¨è¦æ±‚å¿…é¡»éƒ½é€šè¿‡ 80 ç«¯å£ç›´æ¥è®¿é—®ï¼Œå¯æ˜¯ 80 ç«¯å£åªæœ‰ä¸€ä¸ªï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡åå‘ä»£ç†æ¥é…ç½®ï¼Œä¾‹å¦‚</p><p>blog.hanzhe.site -&gt; è®¿é—®åšå®¢ç½‘ç«™ ( åšå®¢ç½‘ç«™åœ¨æœ¬åœ°çš„8081ç«¯å£ )</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen       localhost:80;</span><br><span class="line">server_name  blog.hanzhe.site;</span><br><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://localhost:8081/;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>zhang.hanzhe.site -&gt; è®¿é—®ä¸ªäººç½‘ç«™ ( ä¸ªäººç½‘ç«™åœ¨æœ¬åœ°çš„8082ç«¯å£ )</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen       localhost:80;</span><br><span class="line">server_name  zhang.hanzhe.site;</span><br><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://localhost:8082/;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œå½“æˆ‘è®¿é—® blog.hanzhe.site çš„æ—¶å€™ï¼Œè®¿é—®çš„æ˜¯åšå®¢ç½‘ç«™ï¼Œè®¿é—® zhang.hanzhe.site çš„æ—¶å€™è®¿é—®çš„æ˜¯ä¸ªäººç½‘ç«™ï¼Œéƒ½æ˜¯ 80 ç«¯å£ï¼Œä½†æ˜¯å¯¹åº”æœ¬åœ°ç¡®å®ä¸¤ä¸ªä¸ä¸€æ ·çš„ç«¯å£</p><h2 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h2><h3 id="è´Ÿè½½å‡è¡¡çš„å®ç°">è´Ÿè½½å‡è¡¡çš„å®ç°</h3><blockquote><p>ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡</p></blockquote><p>åå‘ä»£ç†æŠ€æœ¯æ˜¯ nginx çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼Œé‚£ä¹ˆ<code>è´Ÿè½½å‡è¡¡</code>å°±æ˜¯ç¬¬äºŒå¤§ç‰¹ç‚¹ï¼Œä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿé¡¾åæ€ä¹‰ï¼Œè´Ÿè½½å‡è¡¡å°±æ˜¯è®²æœåŠ¡å™¨æ¥æ”¶çš„è¯·æ±‚åˆ†æ•£å¼€æ¥ï¼Œä»è€Œè¾¾åˆ°å‡ç¼“æœåŠ¡å™¨å‹åŠ›çš„ä¸€é—¨æŠ€æœ¯</p><p>æ—¢ç„¶å°†è¯·æ±‚åˆ†æ•£å¼€æ¥ï¼Œé‚£ä¹ˆå°±è‚¯å®šè¿˜è¦æœ‰æœåŠ¡å™¨æ¥æ¥å—è¿™äº›åˆ†æ•£å‡ºå»çš„è¯·æ±‚ï¼Œæ‰€ä»¥å°±éœ€è¦å¤šå°æœåŠ¡å™¨è¿›è¡Œé…åˆï¼ŒæŒ‰ç…§è¦æ±‚è½®æµæ¥è´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œé‚£ä¹ˆå°†è¿™äº›è¯·æ±‚åˆç†çš„åˆ†å‘å‡ºå»çš„æŠ€æœ¯å°±å«åš è´Ÿè½½å‡è¡¡</p><blockquote><p>å®ç°è´Ÿè½½å‡è¡¡</p></blockquote><p>è¿˜æ˜¯è€ä½ç½®ï¼Œnginx çš„å®‰è£…ç›®å½•ä¸‹çš„ conf ç›®å½•ä¸‹çš„ nginx.conf é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ upstream æ¥å®Œæˆè´Ÿè½½å‡è¡¡</p><p>upstream åé¢è·Ÿç€æ ‡è¯†ç¬¦ä½œä¸ºåç§°ï¼Œç„¶åä¸‹é¢å¯ä¹¦å†™ n å¤šä¸ª server æŒ‡å‘ç›®æ ‡åœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream blog &#123;</span><br><span class="line">server 127.0.0.1:8080;</span><br><span class="line">server 127.0.0.1:8081;</span><br><span class="line">server 127.0.0.1:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŒ¹é…åˆ° <a href="http://blog.hanzhe.com:80">blog.hanzhe.com:80</a> åŸŸåä¹‹åï¼Œç›´æ¥ç§»äº¤ç»™ä¸Šé¢ blog å¯¹åº”çš„è´Ÿè½½å‡è¡¡è¿›è¡Œå¤„ç†ï¼Œä¼šæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™æ¥åˆ†å‘è¯·æ±‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen      80;</span><br><span class="line">server_name blog.hanzhe.com;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass  http://blog;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é›†ä¸­æ–¹å¼è¯´æ˜">é›†ä¸­æ–¹å¼è¯´æ˜</h3><p>åœ¨ä¸Šé¢æåˆ°äº†è´Ÿè½½å‡è¡¡ä¼šæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™æ¥å‘å„ä¸ªæœåŠ¡å™¨ä¸­åˆ†å‘è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªè§„åˆ™ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œç°åœ¨å°±æ¥ç®€å•äº†è§£ä¸€ä¸‹ã€‚</p><blockquote><p>1 - è½®è¯¢è§„åˆ™</p></blockquote><p>è½®è¯¢è§„åˆ™æ˜¯ nginx é»˜è®¤çš„è´Ÿè½½è§„åˆ™ï¼Œå½“æˆ‘ä»¬ä¹¦å†™çš„æ ¼å¼åƒä¸Šé¢çš„ä»£ç ä¸€æ ·ï¼Œæ²¡æœ‰å¤šä½™çš„ä¿®é¥°ï¼Œé‚£ä¹ˆä»–é»˜è®¤å°±æ˜¯è½®è¯¢è§„åˆ™</p><p>è½®è¯¢è§„åˆ™ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ‰€æœ‰è¯·æ±‚éƒ½æŒ‰ç…§æ—¶é—´é¡ºåºåˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼ŒæœŸé—´å¦‚æœæœ‰æœåŠ¡å™¨çªç„¶æ­»æœºï¼Œé‚£ä¹ˆå°±ä¼šè¢«è¸¢å‡ºè½®è¯¢é˜Ÿä¼ä¸­ã€‚</p><blockquote><p>2 - æƒé‡è§„åˆ™ ( weight )</p></blockquote><p>è½®è¯¢è§„åˆ™æ˜¯æŒ‰ç…§æ—¶é—´æ¥ä¾æ¬¡åˆ†å‘è¯·æ±‚çš„ï¼Œè€Œæƒé‡è§„åˆ™æ˜¯æŒ‰ç…§æœåŠ¡å™¨çš„æƒé‡æ¯”ä¾‹æ¥è¿›è¡Œè¯·æ±‚åˆ†å‘çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®ä¾‹é…ç½®</span></span><br><span class="line">upstream blog &#123;</span><br><span class="line">server  localhost:8080 weight=2;</span><br><span class="line">server  localhost:8081 weight=6;</span><br><span class="line">server  localhost:8082 weight=3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç›®æ ‡æœåŠ¡å™¨åœ°å€åé¢è·Ÿä¸Šç©ºæ ¼ï¼Œè¿½åŠ 1weight`å…³é”®å­—å°±å¯ä»¥è®¾ç½®æƒé‡æ¯”ä¾‹äº†ï¼Œå¯¹åº”çš„æ•°å­—è¶Šå¤§ï¼Œè¢«è®¿é—®çš„é¢‘ç‡ä¹Ÿå°±è¶Šé«˜ï¼Œä¾‹å¦‚ä¸Šé¢çš„é…ç½®ï¼Œå¦‚æœè®¿é—®é‡è¾ƒé«˜çš„è¯ï¼Œ8080 å’Œ 8082 ä¸¤ä¸ªç«¯å£åŠ ä¸€èµ·çš„è®¿é—®é‡å¯èƒ½è¿˜æ²¡æœ‰ä¸€ä¸ª 8081 å¤šï¼Œå¯ä»¥è®©é«˜æ€§èƒ½æœåŠ¡å™¨æ‹¿åˆ°è¾ƒé«˜çš„å€¼ï¼Œé€‚åˆå¤šä¸ªæœåŠ¡å™¨é…ç½®ä¸ä¸€è‡´æ—¶èµ·åˆ°çš„å‡è¡¡ä½œç”¨ï¼Œè¿™å°±æ˜¯æƒé‡è§„åˆ™ã€‚</p><blockquote><p>3 - å“ˆå¸Œè§„åˆ™ ( ip_hash )</p></blockquote><p>è¯¥è§„åˆ™ä¼šæ ¹æ®å®¢æˆ·ç«¯çš„ ip åœ°å€è¿›è¡Œ hash è®¡ç®—åçš„ç»“æœè¿›è¡Œåˆ†ç±»ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥è®©å®¢æˆ·ç«¯è‡ªå§‹è‡³ç»ˆè®¿é—®çš„éƒ½æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³ session çš„é—®é¢˜ã€‚</p><p>é…ç½®æ–¹æ³•ä¹Ÿååˆ†ç®€å•ï¼Œåœ¨ upstream ä¸­æ·»åŠ å…³é”®å­—å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®ä¾‹é…ç½®</span></span><br><span class="line">upstream blog &#123;</span><br><span class="line">ip_hash;</span><br><span class="line">server  localhost:8080;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ip_hash è¿˜å¯ä»¥é…åˆ weight æƒé‡ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><blockquote><p>4 - æœ€å°‘è§„åˆ™ ( least_conn )</p></blockquote><p>çœ‹åå­—å°±å¯ä»¥è½»æ¾çš„çœ‹å‡ºæ¥ï¼Œè¯¥è§„åˆ™çš„ç‰¹ç‚¹å°±æ˜¯å°†è¯·æ±‚äº¤ç»™è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å‡æ‘Šã€‚</p><p>ä»£ç å°±ä¸ç²˜äº†ï¼Œä½¿ç”¨æ–¹æ³•åŒä¸Šé¢ä¸€è‡´ï¼Œå°†å…³é”®å­—æ•²ä¸Šå³å¯ã€‚</p><blockquote><p>5 - å»¶è¿Ÿè§„åˆ™ ( fair )</p></blockquote><p>æŒ‰ç…§æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…ï¼Œä¸¤å°æœåŠ¡å™¨ç­‰å¾…çš„æƒ…å†µä¸‹ï¼Œå»¶è¿Ÿä½çš„æœåŠ¡å™¨ä¼˜å…ˆåˆ†é…ï¼Œä½¿ç”¨æ–¹æ³•åŒä¸Š</p><hr><p><em>è¿™é‡Œéœ€è¦æ³¨æ„æ— è®ºæ˜¯ server è¿˜æ˜¯ upstream éƒ½æ˜¯åœ¨ http æ¨¡å—ä¸‹çš„ï¼Œè€Œä¸” upstream è¦åœ¨ server çš„å‰é¢ï¼Œä¸ç„¶ä¸èµ·ä½œç”¨</em></p><h2 id="åŠ¨é™åˆ†ç¦»">åŠ¨é™åˆ†ç¦»</h2><h2 id="é«˜å¯ç”¨">é«˜å¯ç”¨</h2>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¯å¢ƒéƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javawebç¬”è®°</title>
    <link href="/2022/07/13/Java%E7%AC%94%E8%AE%B0/JavaWeb%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/07/13/Java%E7%AC%94%E8%AE%B0/JavaWeb%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>JavaWeb ç¬”è®°</h1><p>æ¸©æ•…è€ŒçŸ¥æ–°ï¼javaweb ç¬”è®°ã€‚</p><h2 id="HttpServlet-ç±»">HttpServlet ç±»</h2><h3 id="ç®€å•ä½¿ç”¨-Servlet">ç®€å•ä½¿ç”¨ Servlet</h3><p>åœ¨ä¼ ç»Ÿçš„ javaweb æ— æ¡†æ¶å¼€å‘çš„æ—¶å€™ï¼Œæ‰€è°“çš„æ§åˆ¶æœºå°±æ˜¯ servletï¼Œåˆ›å»ºä¸€ä¸ªæ™®é€šçš„ java ç±»ä¹‹åï¼Œç»§æ‰¿ HttpServlet ç±»ä¹‹åï¼Œè¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ª servlet ç±»äº†ï¼Œåœ¨åˆ›å»ºå¥½ä¸€ä¸ª servlet ä¹‹åï¼Œåªéœ€è¦é…ç½®ä»–çš„è®¿é—®è·¯å¾„ï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚</p><blockquote><p>åˆ›å»ºä¸€ä¸ª servlet ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ get å’Œ post ä¸¤ç§è¯·æ±‚æ–¹å¼</span></span><br><span class="line"><span class="comment">     * åœ¨ servlet ä¸­åˆ†åˆ«å¯¹ç€ä¸¤ç§æ–¹å¼è¿›è¡Œè§£æï¼Œä½†æ— è®ºæ˜¯ä»€ä¹ˆè¯·æ±‚ï¼Œä»–ä»¬çš„æœ€ç»ˆå¤„ç†è¿‡ç¨‹éƒ½æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥è¿™é‡Œåªéœ€è¦å†™ä¸€ä¸ªå¤„ç†é€»è¾‘å³å¯ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">         <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç»è¿‡äº†Servlet1æ§åˆ¶å™¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">         <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»ä¹¦å†™å¥½äº†ä¸€ä¸ª servlet ç±»ï¼Œä½†æ˜¯è¿™ä¸ª servlet è¿˜ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæƒ³è¦æ­£å¸¸å·¥ä½œï¼Œéœ€è¦æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ï¼Œè¿™æ ·ä¸€æ¥å°±éœ€è¦é…ç½®ä»–çš„è®¿é—®è·¯å¾„</p><blockquote><p>åœ¨ web.xml ä¸­è£…è½½ servlet å¹¶é…ç½®è®¿é—®è·¯å¾„</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®ä¸€ä¸ªç®€å•çš„Servletæ§åˆ¶å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>club.hanzhe.web.Servlet1<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Servlet-çš„ç”Ÿå‘½å‘¨æœŸ">Servlet çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>ä»€ä¹ˆæ˜¯ servlet çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿservlet çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°±æ˜¯ servlet ä»åˆå§‹åŒ–å·¥ä½œåˆ°æœ€ç»ˆé”€æ¯çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ servlet åœ¨æŸä¸ªæŒ‡å®šçš„è¿‡ç¨‹ä¸­å¤„ç†ä¸€äº›é€»è¾‘ã€‚</p><p>å°±åƒä¸Šé¢è¯´çš„ä¸€æ ·ï¼Œservlet å…±æœ‰ä¸‰ä¸ªå£°æ˜å‘¨æœŸï¼Œåˆ†åˆ«æ˜¯ <code>åˆå§‹åŒ–</code>ï¼Œ<code>å·¥ä½œ</code>ï¼Œ<code>é”€æ¯</code>ï¼Œä»–ä»¬åˆ†åˆ«å¯¹åº”çš„å‡½æ•°è¢«ç§°ä¹‹ä¸ºç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><blockquote><p>servlet çš„å£°æ˜å‘¨æœŸå‡½æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">         <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¿é—®äº†Servlet2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;servlet2 init&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">         <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;servlet2 service&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.service(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;servlet2 destroy&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>[ init ] ä¸ºåˆå§‹åŒ–æ–¹æ³•ï¼Œå½“è¯¥ servlet é¦–æ¬¡è¢«è®¿é—®çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åå°±ä¸åœ¨æ‰§è¡Œã€‚</li><li>[ service ] ä¸ºå½“å‰ servlet æä¾›æœåŠ¡ï¼Œæ¯å½“è¯·æ±‚è®¿é—®åˆ° servlet æ—¶ï¼Œä¼šé¦–å…ˆç»è¿‡ serviceï¼Œç„¶åç”± service åˆ¤æ–­è¯·æ±‚ç±»å‹ï¼Œæœ€ç»ˆè°ƒç”¨åˆé€‚çš„ doGet æˆ–è€… doPost ç­‰ç­‰ï¼Œï¼Œï¼Œï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šæ‰§è¡Œï¼Œä¸”ä¼˜å…ˆçº§åœ¨ doGet doPost ä¹‹å‰ã€‚</li><li>[ destroy ] ä¸ºé”€æ¯æ–¹æ³•ï¼Œå½“ servlet é”€æ¯æ—¶æ‰§è¡Œçš„å–„åæ–¹æ³•ï¼Œåœ¨æˆ‘ä»¬å…³é—­æœåŠ¡å™¨çš„æ—¶å€™ä¼šçœ‹åˆ°è¿™ä¸ªå‡½æ•°æ‰§è¡Œï¼Œå¤šæ•°ç”¨æ¥é‡Šæ”¾èµ„æºã€‚åœ¨ servlet é”€æ¯ä¹‹å‰æ‰§è¡Œï¼Œä¸”åªæ‰§è¡Œä¸€æ¬¡ã€‚</li></ul><h2 id="HttpServletRequest">HttpServletRequest</h2><p>request ä»£è¡¨è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ä»£è¡¨çš„å°±æ˜¯åŸºäº HTTP åè®®çš„ servlet è¯·æ±‚å°è£…ç±»ï¼Œå…³äºå®¢æˆ·ç«¯è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯éƒ½å°è£…åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»è·å¾—åˆ°å¾ˆå¤šå…·ä½“ä¿¡æ¯ã€‚</p><h3 id="è·å–è¯·æ±‚å‚æ•°">è·å–è¯·æ±‚å‚æ•°</h3><p>ä¹‹å‰æˆ‘ä»¬å·²ç»å®ç°äº† servlet æ¥å—è¯·æ±‚ï¼Œå¹¶ä¸”å¤„ç†ä¸€äº›é€»è¾‘ï¼Œä½†æ˜¯ä»…ä»…æ˜¯è¿™äº›æ˜¯ä¸å¤Ÿçš„ï¼Œå¦‚æœæˆ‘ä»¬å†™ä¸€ä¸ªå¸¦æœ‰ç™»å½•åŠŸèƒ½çš„ servletï¼Œåº”è¯¥è¦è·å–å‰ç«¯å‘æ¥çš„å‚æ•°ï¼Œç„¶ååœ¨è¿›è¡Œé€»è¾‘å¤„ç†ã€‚</p><p>ä¾‹å¦‚æƒ³è¦è·å–å‰ç«¯è¡¨å•æäº¤çš„å‚æ•°ï¼Œéœ€è¦ä½¿ç”¨ <code>HttpServletRequest</code> å¯¹è±¡ä¸­çš„ <code>getParameter</code> æ–¹æ³•</p><blockquote><p>ç®€å•çš„å‚æ•°è¡¨å•æäº¤ä»¥åŠè·å–å‚æ•°</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å‰ç«¯ä»£ç fromè¡¨å•æäº¤ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0px auto;&quot;</span>&gt;</span></span><br><span class="line">        è´¦æˆ·ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        å¯†ç ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// servletæ¥å¤„ç†é€»è¾‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">         <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°ï¼Œå¯¹åº” form è¡¨å•ä¸­çš„ name å±æ€§</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="comment">// å› ä¸ºè¿™é‡Œæ˜¯ç»ƒä¹ ï¼Œæˆ‘å°±ç”¨æ‰“å°ä»£æ›¿äº†ä¸€åˆ‡é€»è¾‘å¤„ç†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;username: &quot;</span> + username);</span><br><span class="line">        System.out.println(<span class="string">&quot;password: &quot;</span> + password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é…ç½® web.xml çš„ä»£ç æˆ‘å°±ä¸å†™äº†ï¼Œï¼Œï¼Œï¼Œ</li></ul><blockquote><p>æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p></blockquote><img src="..//img/JavaWeb1.png"><p>å‰ç«¯å‘èµ·è¯·æ±‚ï¼Œå·²ç»è¢« servlet å®Œå…¨æ¥æ”¶ï¼Œå‚æ•°å·²ç»å¤„ç†å®Œæˆã€‚è¿™é‡Œæš‚æ—¶å…ˆä¸è€ƒè™‘ä¹±ç çš„é—®é¢˜ï¼Œåé¢ä¼šæåˆ°ã€‚</p><h3 id="å…¶ä»–è·å–æ–¹æ³•">å…¶ä»–è·å–æ–¹æ³•</h3><p>æˆ‘ä»¬å·²ç»ç®€å•çš„é€šè¿‡ servlet è·å–åˆ°äº†è¯·æ±‚ä¸­åŒ…å«çš„å‚æ•°ï¼Œå…¶å®çœŸå®çš„è¯·æ±‚ä¸­åŒ…å«çš„ä¿¡æ¯éå¸¸å¤šï¼Œè€Œå…¶ä¸­è·å–è¯·æ±‚æºå¸¦çš„è¡¨å•å‚æ•°æœ€ä¸ºå¸¸ç”¨ï¼Œé‚£ä¹ˆé™¤å¼€è¿™ä¸ªæ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è·å–åˆ°å¾ˆå¤šçš„ä¿¡æ¯</p><blockquote><p>è·å–è¯·æ±‚æºå¸¦å‚æ•°ä¿¡æ¯</p></blockquote><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>getParameter( String name)</td><td>è¯·æ±‚ä¸­ name å±æ€§å¯¹åº”çš„å€¼ã€‚</td></tr><tr><td>getParameterNames()</td><td>è·å–è¯·æ±‚ä¸­æ‰€æœ‰æºå¸¦çš„å‚æ•°çš„ nameï¼Œè¿”å› Enumeration é›†åˆ</td></tr></tbody></table><blockquote><p>è·å–æ›´å¤šè¯·æ±‚ä¿¡æ¯</p></blockquote><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>getRequestURL()</td><td>å®Œæ•´çš„è¯·æ±‚URL</td></tr><tr><td>getRequestURI()</td><td>è¯·æ±‚ç›¸å¯¹è·¯å¾„åœ°å€ï¼Œæ˜¯åœ¨URLçš„åŸŸåä¸å‚æ•°ä¹‹é—´çš„è·¯å¾„ä¿¡æ¯ã€‚</td></tr><tr><td>getQueryString()</td><td>URLåé¢çš„å‚æ•°ä¿¡æ¯ï¼Œæˆªæ­¢ ? åé¢çš„éƒ½ä¼šè·å– ( postä¸‹è·å–ä¸åˆ° )ã€‚</td></tr><tr><td>getRemoteHost()</td><td>å®¢æˆ·ç«¯è¯·æ±‚æ—¶çš„ IP åœ°å€</td></tr><tr><td>getRemoteAddr()</td><td>å®¢æˆ·ç«¯è¯·æ±‚æ—¶çš„ IP åœ°å€</td></tr><tr><td>getRemotePort()</td><td>å®¢æˆ·ç«¯è¯·æ±‚æ—¶ä½¿ç”¨çš„ç«¯å£å·</td></tr><tr><td>getLocalAddr()</td><td>æœåŠ¡ç«¯ IP åœ°å€</td></tr><tr><td>getLocalName()</td><td>æœåŠ¡ç«¯ä¸»æœºå</td></tr></tbody></table><blockquote><p>è·å–è¯·æ±‚å¤´çš„ä¿¡æ¯</p></blockquote><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>getHeader(String name)</td><td>è·å–ç›®æ ‡è¯·æ±‚å¤´ä¿¡æ¯ï¼Œå¦‚æœä¸åŒ…å«å¤´åˆ™ä¸º nullï¼ŒåŒ…å«å¤šä¸ªåˆ™è¿”å›ç¬¬ä¸€ä¸ª</td></tr><tr><td>getHeaders(String name)</td><td>è¿”å›ç›®æ ‡è¯·æ±‚å¤´çš„æ‰€æœ‰ä¿¡æ¯ã€‚</td></tr><tr><td>getHeaderNames()</td><td>è¿”å›æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹</td></tr></tbody></table><p>æ›´å¤šå…³äº HttpServletRequest çš„å‡½æ•°è¯´æ˜ï¼Œç›´è¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/wwq0813/article/details/90256058</span><br></pre></td></tr></table></figure><h2 id="HttpServletResponse">HttpServletResponse</h2><p>æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯äº¤äº’ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œè¯·æ±‚æ•°æ®è¢«å°è£…åˆ° <code>HttpServletRequest</code> å¯¹è±¡ä¸­ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯è¿”å›çš„ä¿¡æ¯ä¹Ÿè¢«å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå°±æ˜¯ <code>HttpServletResponse</code>ã€‚</p><h3 id="è®¾ç½®å“åº”æ•°æ®">è®¾ç½®å“åº”æ•°æ®</h3><blockquote><p>å“åº”æ•°æ®å¯¹åº”çš„æ–¹æ³•</p></blockquote><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>getOutputStream()</td><td>è·å–å­—èŠ‚è¾“å‡ºæµï¼Œä»¥å­—èŠ‚å½¢å¼å‘å®¢æˆ·ç«¯å“åº”æ•°æ®</td></tr><tr><td>getWriter()</td><td>è·å–å­—ç¬¦è¾“å‡ºæµï¼Œä»¥å­—ç¬¦å½¢å¼å‘å®¢æˆ·ç«¯å“åº”æ•°æ®</td></tr></tbody></table><ul><li>å¦‚æœå­—èŠ‚è¾“å‡ºæµè¾“å‡ºå­—ç¬¦çš„è¯ï¼Œä¼šçˆ†å‡ºå¼‚å¸¸</li><li>åœ¨åŒä¸€æ¬¡å“åº”çš„è¿‡ç¨‹ä¸­ï¼Œå­—èŠ‚æµå’Œå­—ç¬¦æµåªèƒ½ä½¿ç”¨ä¸€ç§ï¼ŒäºŒè€…ç›¸äº’æ’æ–¥</li></ul><p>åƒä¹‹å‰çš„ä¾‹å­ï¼Œåç«¯æˆåŠŸæ¥æ”¶åˆ°äº†å‰ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¹¶ä¸”æˆåŠŸæ‰“å°åœ¨äº†æ§åˆ¶å°ä¸­ï¼Œä½†æ˜¯è¿™ä»…ä»…æ˜¯åå°çŸ¥é“ï¼Œè¦ç»™å‰ç«¯ä¸€ä¸ªæç¤ºæ‰è¡Œï¼Œè¿™é‡Œè¦å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸäº†ï¼Œåœ¨é¡µé¢ä¸Šç»™ä¸€ä¸ªæˆåŠŸçš„æç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> resp.getOutputStream();</span><br><span class="line">    outputStream.println(<span class="string">&quot;success !&quot;</span>);</span><br><span class="line">    Enumeration&lt;String&gt; names = req.getParameterNames();</span><br><span class="line">    <span class="keyword">while</span> ( names.hasMoreElements() )&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> names.nextElement();</span><br><span class="line">        System.out.println(str + <span class="string">&quot;: &quot;</span> + req.getParameter(str));</span><br><span class="line">        outputStream.println(str + <span class="string">&quot;: &quot;</span> + req.getParameter(str));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å“åº”å¤´">è®¾ç½®å“åº”å¤´</h3><blockquote><p>è®¾ç½®å“åº”å¤´å¯¹åº”çš„æ–¹æ³•</p></blockquote><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>addHeader(String name, String value)</td><td>åœ¨ç›®æ ‡è¯·æ±‚å¤´ä¸­è¿½åŠ å­—ç¬¦ä¸²å€¼</td></tr><tr><td>addIntHeader(String name, int value)</td><td>åœ¨ç›®æ ‡è¯·æ±‚å¤´ä¸­è¿½åŠ æ•´æ•°ç±»å‹çš„å€¼</td></tr><tr><td>addDateHeader(String name, long value)</td><td>åœ¨ç›®æ ‡è¯·æ±‚å¤´ä¸­è¿½åŠ é•¿æ•´å½¢ç±»å‹çš„å€¼</td></tr><tr><td>setHeader(String name, String value)</td><td>ä¿®æ”¹ç›®æ ‡è¯·æ±‚å¤´ä¸­å­—ç¬¦ä¸²å€¼</td></tr><tr><td>setIntHeader(String name, int value)</td><td>ä¿®æ”¹ç›®æ ‡è¯·æ±‚å¤´ä¸­æ•´æ•°ç±»å‹çš„å€¼</td></tr><tr><td>setDateHeader(String name, long value)</td><td>ä¿®æ”¹åœ¨ç›®æ ‡è¯·æ±‚å¤´ä¸­é•¿æ•´å½¢ç±»å‹çš„å€¼</td></tr><tr><td>setStatus(int value)</td><td>è®¾ç½®å“åº”ç»“æœçŠ¶æ€ç </td></tr></tbody></table><ul><li>add å¼€å¤´çš„æ˜¯åœ¨åŸåŸºç¡€ä¸Šè¿½åŠ ï¼Œé€‚åˆæœ‰å¤šä¸ªå€¼å¾—è¯·æ±‚å¤´</li><li>set å¼€å¤´çš„æ˜¯ä¿®æ”¹ï¼Œå¯¹åº”çš„æ˜¯åªæœ‰ä¸€ä¸ªå€¼çš„è¯·æ±‚å¤´</li></ul><p>å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹ç›¸åº”çš„æ•°æ®è¿›è¡Œä¸€äº›è®¾ç½®äº†ï¼Œä¾‹å¦‚ä¹‹å‰çš„ä¸­æ–‡ä¹±ç ï¼Œç°åœ¨å°±å¯ä»¥è§£å†³äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®å“åº”ç±»å‹å­—ç¬¦é›†ä¸ºutf-8</span></span><br><span class="line">resp.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ›´å¤šå…³äº HttpServletResponse çš„å‡½æ•°è¯´æ˜ï¼Œç›´è¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.jianshu.com/p/8bc6b82403c5</span><br></pre></td></tr></table></figure><h2 id="è½¬å‘ä¸é‡å®šå‘">è½¬å‘ä¸é‡å®šå‘</h2><p>æˆ‘ä»¬å·²ç»å­¦ä¹ äº† <code>è¯·æ±‚</code> å’Œ <code>å“åº”</code>ï¼Œå¯ä»¥é€šè¿‡ html  æˆ–è€… jsp é¡µé¢å‘é€è¯·æ±‚ï¼Œåå°æ¥å—è¯·æ±‚åè¿›è¡Œå¤„ç†ï¼Œç„¶åå“åº”ç»™å‰ç«¯é¡µé¢è¿”å›å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¸å¯ä»¥åœ¨åç«¯å°±æ§åˆ¶é¡µé¢çš„è·³è½¬å‘¢ï¼Ÿ</p><blockquote><p>è½¬å‘å’Œé‡å®šå‘å®ç°ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¬å‘å®ç°é¡µé¢è·³è½¬</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/servlet3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">          <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;login.html&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡å®šå‘å®ç°é¡µé¢è·³è½¬</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/servlet4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet4</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">          <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;login.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒè€…éƒ½å¯ä»¥å®ç°é¡µé¢çš„è·³è½¬ï¼Œä½†æ˜¯æœ‰ç€æœ¬è´¨çš„åŒºåˆ«</p><ol><li>é€šè¿‡ä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œè½¬å‘æ˜¯é€šè¿‡ request æ“ä½œçš„ï¼Œä½†æ˜¯é‡å®šå‘æ˜¯é€šè¿‡ response æ“ä½œçš„</li><li>åœ¨è½¬å‘ä¹‹åï¼Œè¿˜éœ€è¦è°ƒç”¨ forward æ–¹æ³•ï¼Œå°†å½“å‰çš„è¯·æ±‚ï¼Œå“åº”å¯¹è±¡ä¼ é€’ä¸‹å»ï¼Œä¹Ÿå°±æ„å‘³ç€å³ä½¿ç›®æ ‡å˜äº†ï¼Œä½†æ˜¯è¯·æ±‚å’Œç›¸åº”è¿˜æ˜¯åŸæœ¬çš„è¯·æ±‚å’Œç›¸åº”ï¼Œåœ°å€æ ä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„å˜åŒ–</li><li>é‡å®šå‘åˆ™æ˜¯æŠ›å¼ƒäº†å½“å‰çš„è¯·æ±‚è¿‡ç¨‹ï¼Œå¦å¤–å‘èµ·äº†ä¸€ä¸ªæ–°çš„è¯·æ±‚å»è®¿é—®ç›®æ ‡åœ°å€ï¼Œæµè§ˆå™¨åœ°å€æ ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¸”çŠ¶æ€ç ä¼šå˜æˆ 304</li></ol><h2 id="ä¼šè¯è·Ÿè¸ªæŠ€æœ¯">ä¼šè¯è·Ÿè¸ªæŠ€æœ¯</h2><h2 id="è¯·æ±‚å¤„ç†æŠ€æœ¯">è¯·æ±‚å¤„ç†æŠ€æœ¯</h2><h3 id="è¿‡æ»¤å™¨">è¿‡æ»¤å™¨</h3><h3 id="ç›‘å¬å™¨">ç›‘å¬å™¨</h3>]]></content>
    
    
    <categories>
      
      <category>JavaEE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JavaWeb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŠ¨æ€ä»£ç†</title>
    <link href="/2022/07/13/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
    <url>/2022/07/13/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1>ä»£ç†æ¨¡å¼</h1><p>ä»£ç†æ¨¡å¼é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä»¥ä½ çš„åä¹‰å¸®ä½ å¤„ç†ä¸€äº›çäº‹ï¼Œä¾‹å¦‚ï¼šç”¨æˆ·A è¿‘æœŸå‡†å¤‡ç»“å©šï¼Œä»–éœ€è¦é¢„å®šé¥­åº—ï¼Œå¸ƒç½®ä¼šåœºï¼Œé‚€è¯·äº²æœ‹ï¼Œåˆ¶å®šèœå•ç­‰ç­‰ç­‰ç­‰â€¦ è¿™æ ·å¤„ç†äº‹æƒ…å°±æ¯”è¾ƒéº»çƒ¦ï¼Œé’ˆå¯¹è¿™äº›çäº‹å°±å¯ä»¥æ‰¾ <em>å©šåº†å…¬å¸</em> æ¥å¤„ç†ï¼Œä»–ä»¬å¯ä»¥è§£å†³å©šç¤¼è¿‡ç¨‹ä¸­çš„å¤§éƒ¨åˆ†äº‹æƒ…ï¼Œè¿™æ ·ç”¨æˆ·A åªéœ€è¦é¢å¯¹ç»“å©šè¿™ä»¶äº‹å„¿æœ¬èº«å°±å¯ä»¥ï¼Œè€Œä¸éœ€è¦è€ƒè™‘å…¶ä»–çš„äº‹æƒ…ã€‚</p><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ <em>å©šåº†å…¬å¸çš„å®šä½å°±æ˜¯ä»£ç†</em>ï¼ŒJava ä¸­æœ‰äº›åœ°æ–¹ä¹Ÿéœ€è¦ä½¿ç”¨ä»£ç†æ¨¡å¼è¿›è¡Œè§£å†³ï¼Œä¾‹å¦‚äº‹åŠ¡ï¼Œæ—¥å¿—ç­‰ç­‰ï¼Œæˆ‘ä»¬å¸Œæœ› service ä¸­åªéœ€è¦è´Ÿè´£ä¸šåŠ¡é€»è¾‘æœ¬èº«è€Œä¸è¦æºæ‚å…¶ä»–çš„ä»£ç ï¼Œè¿™é‡Œå°±å¯ä»¥ç”¨åˆ°ä»£ç†æ¨¡å¼</p><p><strong>åŠ¨æ€ä»£ç†æ¨¡å¼æ€»ç»“èµ·æ¥ä¸€å¥è¯ï¼šå¯ä»¥åšåˆ°åœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½å‰æä¸‹,å¯¹ç›®æ ‡åŠŸèƒ½æ‰©å±•</strong></p><p>æˆ‘ä»¬éœ€è¦äº†è§£æŒæ¡ä¸‰ç§ä»£ç†æ¨¡å¼ï¼šé™æ€ä»£ç†ï¼ŒJDK åŠ¨æ€ä»£ç†ï¼ŒCGLIB åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬é€šè¿‡æ—¥å¿—çš„æ–¹å¼è¿›è¡Œäº†è§£</p><h2 id="é™æ€ä»£ç†æ¨¡å¼">é™æ€ä»£ç†æ¨¡å¼</h2><p>æˆ‘ä»¬éœ€è¦å‡†å¤‡ service æ¥å£ä»¥åŠä»£ç†ç±»å’Œè¢«ä»£ç†ç±»ï¼š</p><blockquote><p>æ­£å¸¸æ‰§è¡Œæ·»åŠ æ—¥å¿—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// serviceæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ ç”¨æˆ·çš„æ–¹æ³•</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String username, String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å‡è£…æœ‰DAOå±‚</span></span><br><span class="line">        <span class="comment">// count = userDao.insertUser(username, password);</span></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppTest</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">us</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        System.out.println(us.insertUser(<span class="string">&quot;è€å…«&quot;</span>, <span class="string">&quot;ç§˜åˆ¶å°æ±‰å ¡&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è¿è¡Œæµ‹è¯•ç±»çš„ main æ–¹æ³•åå‘ç°æ§åˆ¶å°åªè¾“å‡ºäº†æ•°å­— 1ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°æ—¥å¿—åŠŸèƒ½çš„è¯ï¼Œéœ€è¦åœ¨å®ç°ç±»ä¸­æ·»åŠ æ‰“å°è¯­å¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ã€æ”¹ã€‘å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å‡è£…æœ‰DAOå±‚</span></span><br><span class="line">        <span class="comment">// count = userDao.insertUser(username, password);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·ã€&quot;</span> + username + <span class="string">&quot;ã€‘æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¥å¿—æ·»åŠ å®Œæˆï¼</p><blockquote><p>ä½¿ç”¨ä»£ç†æ¨¡å¼æ·»åŠ æ—¥å¿—</p></blockquote><p>ä½†æ˜¯æŒ‰ç…§ä¹‹å‰çš„è¯´æ³•ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›åœ¨ service ä¸­æºæ‚å…¶ä»–çš„ä»£ç ï¼Œå®ƒä»…ä»…è´Ÿè´£é€»è¾‘å³å¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç§»é™¤æ‰å®ç°ç±»ä¸­çš„è¾“å‡ºè¯­å¥ï¼Œæ–°å»ºä¸€ä¸ªä»£ç†ç±»æ¥å®Œæˆè¿™éƒ¨åˆ†åŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserService us;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceProxy</span><span class="params">( UserService us )</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.us = us;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.us.insertUser(username, password);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·ã€&quot;</span> + username + <span class="string">&quot;ã€‘æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppTest</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">us</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceProxy</span>( <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>() );</span><br><span class="line">        System.out.println(us.insertUser(<span class="string">&quot;è€å…«&quot;</span>, <span class="string">&quot;ç§˜åˆ¶å°æ±‰å ¡&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä»£ç†ç±»çš„å¯¹è±¡ï¼Œå°†è¢«ä»£ç†çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ è¿‡å»ï¼Œè®©ä»£ç†ç±»ä»¥è‡ªå·±çš„åä¹‰å¸®è‡ªå·±å®ç°æ—¥å¿—åŠŸèƒ½ï¼Œè¿™æ ·å®ç°ç±»ä¸­åªéœ€è¦è´Ÿè´£ä¹¦å†™ä¸šåŠ¡é€»è¾‘å°±å¯ä»¥äº†ã€‚è¿™å°±æ˜¯ ==é™æ€ä»£ç†æ¨¡å¼==</p><h2 id="JDKåŠ¨æ€ä»£ç†">JDKåŠ¨æ€ä»£ç†</h2><p>é™æ€ä»£ç†å¯ä»¥åšåˆ°åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¦‚æœ service æ¯”è¾ƒå¤šçš„è¯é™æ€ä»£ç†çš„å¼Šç«¯å°±å‡ºæ¥äº†ï¼Œæ¯ä¸ª service éƒ½å¯¹åº”ä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™æ ·ä»£ç é‡å°±å¤§å¤§å¢åŠ ï¼Œè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨ JDKåŠ¨æ€ä»£ç†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><blockquote><p>ä»£ç å®ç°</p></blockquote><p>JDKåŠ¨æ€ä»£ç†ä¾é  <code>java.lang.reflect.Proxy</code> å®ç°ï¼Œä¿æŒæ¥å£å’Œå®ç°ç±»ä¸åŠ¨ï¼Œæ–°å»ºä»£ç†ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getInstance</span><span class="params">( Object obj)</span>&#123;</span><br><span class="line">        <span class="comment">// è·å–è¢«ä»£ç†ç±»çš„ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> obj.getClass().getClassLoader();</span><br><span class="line">        <span class="comment">// è·å–è¢«ä»£ç†çš„ç±»å®ç°çš„æ‰€æœ‰æ¥å£</span></span><br><span class="line">        Class&lt;?&gt;[] classes = obj.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œæ¥ç®¡ç›®æ ‡å¯¹è±¡æ‰§è¡Œå‡½æ•°çš„è¿‡ç¨‹</span></span><br><span class="line">        <span class="comment">// proxyä¸ç”¨ç®¡ï¼Œmethodï¼šè¢«æ‰§è¡Œçš„å‡½æ•°ï¼Œargsï¼šä¼ é€’çš„å‚æ•°</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> </span><br><span class="line">            (Object proxy, Method method, Object[] args)-&gt;&#123;</span><br><span class="line">             <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(obj, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;ç”¨æˆ·ã€&quot;</span> + Arrays.asList(args) + <span class="string">&quot;ã€‘æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> Proxy.newProxyInstance(classLoader, classes, invocationHandler);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ <code>LogProxy.getInstance</code> ä¼ å…¥è¢«ä»£ç†çš„å¯¹è±¡ï¼Œé€šè¿‡ <code>Proxy.newProxyInstance</code> æ¥è·å–åˆ°ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>ã€classLoaderã€‘è¢«ä»£ç†çš„ç±»çš„ç±»åŠ è½½å™¨</li><li>ã€classesã€‘è¢«ä»£ç†çš„ç±»æ‰€å®ç°çš„æ‰€æœ‰æ¥å£</li><li>ã€invocationHandlerã€‘æ˜¯ä¸€ä¸ªæ”¯æŒå‡½æ•°å¼çš„æ¥å£ï¼Œç›´æ¥åˆ›å»ºå¯¹è±¡å³å¯ï¼Œå½“è¢«ä»£ç†çš„ç±»è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ä¼šåœ¨è¿™é‡Œè¿›è¡Œæ‰§è¡Œï¼Œé€šè¿‡ lambda åˆ›å»ºè¯¥ç±»çš„å®ä¾‹éœ€è¦æ¥å—ä¸‰ä¸ªå½¢å‚ï¼š<ul><li>ã€proxyã€‘æš‚æ—¶ä¸ç”¨ç®¡â€¦</li><li>ã€methodã€‘è¢«ä»£ç†çš„ç±»æ‰§è¡Œçš„æ–¹æ³•ä¼šåœ¨è¿™é‡Œè¿›è¡Œå¤„ç†</li><li>ã€argsã€‘è¢«ä»£ç†ç±»æ‰§è¡Œæ–¹æ³•æ—¶ä¼ å…¥çš„å‚æ•°</li><li>æœ€åè®°å¾—å°† invoke æ‰§è¡Œå‡½æ•°åçš„ç»“æœè¿”å›ï¼Œä¸ç„¶è°ƒç”¨è€…é‚£è¾¹ä¼šæ”¶ä¸åˆ°è¿”å›ç»“æœ</li></ul></li></ul><blockquote><p>JDKåŠ¨æ€ä»£ç†çš„ç¼ºç‚¹</p></blockquote><p>æˆ‘ä»¬é€šè¿‡ <code>Proxy.newProxyInstance</code> ä¼ å‚æˆåŠŸè¿”å›äº†ä»£ç†å¯¹è±¡ ï¼Œç„¶ååœ¨æµ‹è¯•ç±»ä¸­æˆåŠŸè½¬æ¢ä¸º <code>UserService</code> å®ä¾‹è¿›è¡Œæ—¥å¿—å¢å¼ºï¼Œç°åœ¨æˆ‘ä»¬å°è¯•æ‰“å°ä¸€ä¸‹è½¬æ¢ä¹‹å‰çš„ä»£ç†å¯¹è±¡çš„ class æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getInstance</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="comment">// çœç•¥å¤šä½™ä»£ç </span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> obj.getClass().getClassLoader();</span><br><span class="line">        Class&lt;?&gt;[] classes = obj.getClass().getInterfaces();</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> </span><br><span class="line">            (Object proxy, Method method, Object[] args) -&gt; method.invoke(obj, args);</span><br><span class="line">        <span class="comment">// è·å–ä»£ç†å¯¹è±¡å¹¶è¿›è¡Œæ‰“å°</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> </span><br><span class="line">            Proxy.newProxyInstance(classLoader, classes, invocationHandler);</span><br><span class="line">        System.out.println(proxy.getClass());</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœä¸ºï¼š<code>class com.sun.proxy.$Proxy0</code>ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ç±»å‹ï¼Œé‚£ä¸ºä»€ä¹ˆä»–å¯ä»¥è½¬æ¢ä¸º <code>UserService</code> ç±»å‹å‘¢ï¼Ÿå› ä¸ºä»–è·å–äº†è¢«ä»£ç†ç›®æ ‡ç±»å®ç°çš„æ‰€æœ‰æ¥å£ï¼š<code>obj.getClass().getInterfaces()</code>ï¼Œè®©æˆ‘ä»¬æ‰“å°ä¸€ä¸‹ä»£ç†å¯¹è±¡å®ç°çš„æ¥å£æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getInstance</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="comment">// çœç•¥å¤šä½™ä»£ç </span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> obj.getClass().getClassLoader();</span><br><span class="line">        Class&lt;?&gt;[] classes = obj.getClass().getInterfaces();</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> </span><br><span class="line">            (Object proxy, Method method, Object[] args) -&gt; method.invoke(obj, args);</span><br><span class="line">        <span class="comment">// è·å–ä»£ç†å¯¹è±¡å¹¶è¿›è¡Œæ‰“å°</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> </span><br><span class="line">            Proxy.newProxyInstance(classLoader, classes, invocationHandler);</span><br><span class="line">        System.out.println(Arrays.asList(proxy.getClass().getInterfaces()));</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœä¸ºï¼š<code>[interface site.hanzhe.proxy.jdkProxy.UserService]</code>ï¼Œä»£ç†å¯¹è±¡å®ç°äº†å’Œè¢«ä»£ç†å¯¹è±¡ä¸€æ¨¡ä¸€æ ·çš„æ¥å£ï¼Œæ‰€ä»¥ä»–å¯ä»¥è½¬æ¢ä¸º <code>UserService</code>ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹è¢«ä»£ç†çš„ç±»ï¼Œè®©ä»–ä¸å®ç°ä»»ä½•æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="comment">/* implements UserService */</span> &#123;</span><br><span class="line">    <span class="comment">// @Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å‡è£…æœ‰DAOå±‚</span></span><br><span class="line">        <span class="comment">// count = userDao.insertUser(username, password);</span></span><br><span class="line">        System.out.println(username + <span class="string">&quot;--&quot;</span> + password);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¢«ä»£ç†ç±»ä¿®æ”¹å®Œæˆäº†ï¼Œä»£ç†ç±»ä¿æŒä¸å˜ï¼Œåœ¨æµ‹è¯•ç±»ä¸­ä¿®æ”¹å¼ºåˆ¶è½¬æ¢ç±»å‹ï¼Œç„¶åè¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppTest</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserServiceImpl</span> <span class="variable">us</span> <span class="operator">=</span></span><br><span class="line">             (UserServiceImpl)LogProxy.getInstance(<span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>());</span><br><span class="line">        us.insertUser(<span class="string">&quot;è€å…«&quot;</span>, <span class="string">&quot;ç§˜åˆ¶å°æ±‰å ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç³»ç»ŸæŠ›å‡ºäº† <code>java.lang.ClassCastException</code> å¼‚å¸¸ï¼Œè¯¦ç»†ä¿¡æ¯ä¸º <code>com.sun.proxy.$Proxy0 cannot be cast to site.hanzhe.proxy.jdkProxy.UserServiceImpl</code>ï¼Œå‘Šè¯‰æˆ‘ä»¬æ— æ³•å¼ºåˆ¶è½¬æ¢ä¸º <code>UserServiceImpl</code> ç±»å‹çš„å¯¹è±¡ï¼Œè¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±æµ‹å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼ŒJDKåŠ¨æ€ä»£ç†è¦æ±‚ <em>è¢«ä»£ç†çš„å¯¹è±¡å¿…é¡»å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£</em></p><h2 id="CGLIBåŠ¨æ€ä»£ç†">CGLIBåŠ¨æ€ä»£ç†</h2><p>åœ¨ä¹‹å‰çš„é™æ€ä»£ç†ä¸­ï¼Œä»£ç†ç±»ä¸è¢«ä»£ç†ç±»å®ç°äº†åŒä¸€ä¸ªæ¥å£ï¼Œä»è€Œè¾¾åˆ°å¯¹æ¯ä¸ªå‡½æ•°è¿›è¡Œä»£ç†çš„ç›®çš„ï¼Œè€Œåœ¨ JDKåŠ¨æ€ä»£ç†ä¸­è¦æ±‚è¢«ä»£ç†çš„ç±»å¿…é¡»å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°æ¥å£çš„è¯å¦‚ä½•ä»£ç†ï¼Ÿ</p><p>CGLIBåŠ¨æ€ä»£ç†æ¨¡å¼ï¼Œä»¥è¢«ä»£ç†å¯¹è±¡ä½œä¸ºçˆ¶ç±»ï¼ŒåŠ¨æ€åˆ›å»ºä¸€ä¸ªå­ç±»ä½œä¸ºä»£ç†å¯¹è±¡å¹¶è¿”å›ï¼ŒCGLIBåŠ¨æ€ä»£ç†åº•å±‚ä½¿ç”¨äº† ASMå­—èŠ‚ç æ¡†æ¶æ¥ç”Ÿæˆå­ç±»ï¼Œç›¸æ¯”è¾ƒæ¯” Javaåå°„æ•ˆç‡è¦é«˜</p><p>æƒ³è¦ä½¿ç”¨ CGLIBåŠ¨æ€ä»£ç†éœ€è¦å¼•å…¥ CGLIB å’Œ ASM çš„ jar åŒ…ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ä¸¤ä¸ª jar åŒ…æ‰€å¯¹åº”çš„ maven åæ ‡ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.ow2.asm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä»£ç å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªæ²¡æœ‰å®ç°ä»»ä½•æ¥å£çš„ service ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ ç”¨æˆ·çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å‡è£…æœ‰DAOå±‚</span></span><br><span class="line">        <span class="comment">// count = userDao.insertUser(username, password);</span></span><br><span class="line">        System.out.println(username + <span class="string">&quot;--&quot;</span> + password);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç†ç±»ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getInstance</span><span class="params">(Object obj)</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºCGLIBçš„å·¥å…·ç±»</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        enhancer.setSuperclass(obj.getClass());</span><br><span class="line">        enhancer.setCallback(</span><br><span class="line">            (InvocationHandler)(Object proxy, Method method, Object[] args)-&gt;&#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(obj, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;ç”¨æˆ·ã€&quot;</span> + Arrays.asList(args) + <span class="string">&quot;ã€‘æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç†ç±»ä»£ç è¯´æ˜ï¼š</p><ul><li>ã€Enhancerã€‘CGLIBä¸­çš„å·¥å…·ç±»ï¼Œé€šè¿‡å·¥å…·ç±»æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹<ul><li>ã€setSuperclassã€‘è®¾ç½®å¯¹è±¡ç»§æ‰¿çš„çˆ¶ç±»ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¼ å…¥è¢«ä»£ç†ç±»çš„ class å¯¹è±¡</li><li>ã€setCallbackã€‘é€šè¿‡å›è°ƒçš„æ–¹å¼å®ç°ä»£ç†åŠŸèƒ½ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª <code>Callback</code> å¯¹è±¡ï¼Œ è¿™é‡Œä½¿ç”¨ä»–ä¸‹é¢å­æ¥å£ <code>InvocationHandler</code>ï¼Œä¹Ÿå°±æ˜¯ JDKåŠ¨æ€ä»£ç†æ—¶æ‰‹åŠ¨åˆ›å»ºçš„é‚£ä¸ªå¯¹è±¡ï¼Œç”±äºç±»å‹åŸå› åœ¨ä½¿ç”¨çš„æ—¶å€™ä½¿ç”¨äº†å¼ºåˆ¶ç±»å‹è½¬æ¢<ul><li>ã€InvocationHandlerã€‘å‡½æ•°å¼æ¥å£çš„ä¸‰ä¸ªå‚æ•°è¿™é‡Œå°±ä¸è§£é‡Šäº†ï¼Œè®°å¾—å°† invoke ç»“æœè¿”å›å³å¯</li></ul></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLç¬”è®°</title>
    <link href="/2022/06/02/MySQL%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/06/02/MySQL%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>mysql ç”±è¡Œå’Œåˆ—ä¹‹é—´å»ºç«‹æŸç§å…³ç³»å­˜å‚¨æ•°æ®ä¿¡æ¯ï¼Œæ˜¯æœ€å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿæ˜¯å½“ä¸‹æœ€æµè¡Œçš„ï¼Œå¼€æºçš„ï¼Œå…è´¹çš„æ•°æ®åº“</p><h1>å®‰è£…åŠé…ç½®</h1><p>æˆ‘ä¹ æƒ¯ä¸‹è½½è½¯ä»¶éƒ½ä¼šå»å®˜ç½‘è¿›è¡Œä¸‹è½½ï¼Œç›´æ¥ç™¾åº¦æœç´¢ mysql å³å¯ï¼Œmysql çš„å®˜ç½‘åœ°å€å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.mysql.com/</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å»ä»–çš„ä¸‹è½½åœ°å€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dev.mysql.com/downloads/mysql/</span><br></pre></td></tr></table></figure><blockquote><p>MySQLçš„ä¸‹è½½é¡µé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p></blockquote><p><img src="https://s2.loli.net/2024/01/07/y67UJA9B8tRzZ1v.png" alt=""></p><p>è¿™é‡Œæˆ‘é€‰æ‹©ä¸‹è½½çš„æ˜¯ Windows x64 ç¯å¢ƒä¸‹çš„ MySQL 5.7.30ï¼Œä¸‹è½½å®Œæˆåæ˜¯ä¸€ä¸ªå‹ç¼©åŒ…æ–‡ä»¶ï¼Œå°†ä»–è§£å‹åˆ°å¹³æ—¶å®‰è£…è½¯ä»¶çš„ä½ç½®å°±è¡Œäº†ï¼Œè§£å‹å°±ç›¸å½“äºæ˜¯ä¸€ç§å®‰è£…</p><h2 id="MySQL-é…ç½®æ–‡ä»¶">MySQL é…ç½®æ–‡ä»¶</h2><p>åœ¨ mysql è§£å‹å®Œæˆåï¼Œè¿›å…¥ mysql ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª mysql çš„é…ç½®æ–‡ä»¶ï¼Œå‘½åè¦æ±‚åŠæ ¼å¼ä¸º<code>my.ini</code>ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„ ini æ˜¯æ–‡ä»¶çš„æ ¼å¼æ‰©å±•åï¼Œè€Œä¸æ˜¯æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†</p><p>ç„¶åå³é”®ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹çš„ä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®MySQLç«¯å£ä¸º3306</span></span><br><span class="line">port=3306</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®mysqlçš„å®‰è£…ç›®å½•</span></span><br><span class="line">basedir=D:\Files\MySQL_5.7.30</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ä½ç½®ç›®å½•</span></span><br><span class="line">datadir=D:\Files\MySQL_5.7.30\database</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®æ•°æ®åº“å­—ç¬¦é›†</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">init_connect=&#x27;SET collation_connection = utf8_general_ci&#x27;</span><br><span class="line">init_connect=&#x27;SET NAMES utf8&#x27;</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®è¡¨ååŒºåˆ†å¤§å°å†™ï¼Œ1ä¸ºä¸åŒºåˆ†ï¼Œ2ä¸ºåŒºåˆ†</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lower_case_table_names=2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®æ— éœ€å¯†ç ç™»å½•</span></span><br><span class="line">skip-grant-tables</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é˜²æ­¢æŸäº›æŸ¥è¯¢è¯­å¥æŠ¥é”™</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼“å­˜ç´¢å¼•å’Œæ•°æ®çš„å¤§å°</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">innodb_buffer_pool_size=1G</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">max_connections=521</span></span><br></pre></td></tr></table></figure><p><code>datadir</code>æ˜¯è‡ªå·±éšä¾¿å†™çš„ä½ç½®ï¼Œç›®å½•åç§°ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ï¼Œä½†æ˜¯æœ€å¥½æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œè¿™æ ·åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šä¸ºä½ è‡ªåŠ¨åˆ›å»ºè¯¥ç›®å½•ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå·²å­˜åœ¨çš„ç›®å½•å¯èƒ½ä¼šå‡ºé”™</p><p>å› ä¸ºæˆ‘ä»¬ä¸æ˜¯é€šè¿‡ MSI è¿›è¡Œå®‰è£…çš„ï¼Œå¹¶ä¸èƒ½é€šè¿‡å®‰è£…åˆå§‹åŒ– root å¯†ç ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰å¯†ç çš„çŠ¶å†µä¸‹éœ€è¦è¿›è®¾ç½®æ— éœ€å¯†ç ç™»å½•ï¼Œç­‰æ‰€æœ‰è®¾ç½®éƒ½å®Œæˆä¹‹åå°±å¯ä»¥æ³¨é‡Šæ‰äº†</p><p>é…ç½®æ–‡ä»¶å°±æå®šäº†ï¼Œè¿™ä¸ªæ˜¯æœ€ç®€å•çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œmysql é…ç½®ä¿¡æ¯è¿œè¿œä¸æ­¢è¿™ç‚¹ï¼Œæƒ³è¦é…ç½®å¤šå»ç™¾åº¦æŸ¥è¯¢<code>my.ini</code>å…·ä½“é…ç½®å³å¯</p><h2 id="é…ç½®ç¯å¢ƒå˜é‡">é…ç½®ç¯å¢ƒå˜é‡</h2><p>é…ç½®ç¯å¢ƒå˜é‡åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰äº†</p><ul><li>å³é”®<code>è®¡ç®—æœº</code>ï¼Œç‚¹å‡»<code>å±æ€§</code></li><li>æ‰¾åˆ°å·¦ä¾§çš„<code>é«˜çº§ç³»ç»Ÿè®¾ç½®</code>ï¼Œç‚¹å‡»è¿›å…¥</li><li>åœ¨<code>é«˜çº§</code>é€‰é¡¹å¡ä¸‹ï¼Œç‚¹å‡»ä¸‹æ–¹çš„<code>ç¯å¢ƒå˜é‡</code></li><li>åœ¨ä¸‹é¢çš„<code>ç³»ç»Ÿå˜é‡</code>åŒºåŸŸä¸­æ‰¾åˆ°<code>PATH</code>ï¼ŒåŒå‡»è¿›å…¥</li><li>æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡åˆ° mysql å®‰è£…ç›®å½•ä¸‹çš„<code>bin</code>ç›®å½•ä¸­</li><li>è‡³æ­¤ï¼Œç¯å¢ƒå˜é‡é…ç½®å®Œæˆ</li></ul><h2 id="åˆå§‹åŒ–æœåŠ¡">åˆå§‹åŒ–æœåŠ¡</h2><p>è¿™ä¸€æ­¥éœ€è¦æ‰§è¡Œçš„åªæœ‰ä¸¤è¡Œä»£ç ï¼Œéœ€è¦ç¯å¢ƒé…ç½®æ²¡æœ‰ä»»ä½•é—®é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆå§‹åŒ–MySQLæœåŠ¡</span></span><br><span class="line">mysqld -install</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°æç¤º<code>Service successfully installed</code>è¡¨ç¤ºæœåŠ¡åˆ›å»ºæˆåŠŸäº†ï¼Œå¦‚æœæ²¡æœ‰æç¤ºè¿™ä¸ªå¯èƒ½ç¨‹åºå‡ºç°äº†é—®é¢˜ï¼Œæˆ–è€…ä¹‹å‰å®‰è£…è¿‡ mysql æ²¡æœ‰å¸è½½å¹²å‡€ï¼Œè‡ªè¡Œç™¾åº¦è§£å†³</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆå§‹åŒ–æœ¬åœ°æ•°æ®åº“</span></span><br><span class="line">mysqld --initialize-insecure --user=mysql</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æœ¬åœ°æ•°æ®åº“åï¼Œä¼šåœ¨ä½ ä¹‹å‰è®¾ç½®çš„é‚£ä¸ªç›®å½•çš„ä½ç½®åˆ›å»ºä¸€ä¸ªä½ æŒ‡å®šåç§°çš„ç›®å½•ï¼Œç›®å½•ä¸‹ä¼šå­˜æ”¾ç€æ•°æ®åº“å­˜å‚¨çš„æ–‡ä»¶ï¼Œåˆå§‹åŒ–å‘½ä»¤æ‰§è¡Œä¼šæœ‰å‡ ç§’é’Ÿçš„å»¶è¿Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æç¤ºå°±è¯æ˜åˆå§‹åŒ–æˆåŠŸäº†</p><h2 id="è®¾ç½®-ROOT-å¯†ç ">è®¾ç½® ROOT å¯†ç </h2><p>å¯åŠ¨ mysql æœåŠ¡ï¼Œæ‰“å¼€æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨MySQLæœåŠ¡</span><br><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> mysql</span><br><span class="line"># å¯¹åº”çš„å…³é—­</span><br><span class="line"># <span class="built_in">net</span> stop mysql</span><br></pre></td></tr></table></figure><p>æœåŠ¡å¼€å¯æˆåŠŸåï¼Œè¿›å…¥mysqlï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä»¥ä¸Šå‘½ä»¤åï¼Œä¼šæç¤ºè®©ä½ è¾“å…¥å¯†ç ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®äº†æ— éœ€å¯†ç ç™»å½•ï¼Œæ‰€ä»¥è¿™é‡Œä¸è¾“å…¥ä»»ä½•å­—ç¬¦ç›´æ¥å›è½¦ï¼Œå°±å¯ä»¥è¿›å…¥ mysqlï¼ˆ æ—¥åè‹¥å¿˜è®°äº†å¯†ç ä¹Ÿå¯ä»¥è¿™ä¹ˆæ‰¾å› ï¼‰ï¼Œè¿›å…¥ mysql åå¼€å§‹ä¿®æ”¹å¯†ç ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é€‰æ‹©æ•°æ®åº“</span></span><br><span class="line">use mysql;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œä¿®æ”¹æ“ä½œ</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> authentication_string<span class="operator">=</span>password(<span class="string">&#x27;å¯†ç &#x27;</span>) <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span> <span class="keyword">and</span> Host<span class="operator">=</span><span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="comment">-- åˆ·æ–°æƒé™</span></span><br><span class="line">flush privileges;</span><br><span class="line"><span class="comment">-- é€€å‡ºMySQL</span></span><br><span class="line">exit;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€å¥—è¡Œäº‘æµæ°´ä¸‹æ¥ï¼Œroot çš„å¯†ç ä¹Ÿè®¾ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥å»é…ç½®æ–‡ä»¶åˆ æ‰æœ€åä¸€é¡¹ï¼Œç„¶åé‡å¯æœåŠ¡å³å¯</p><p><font color="red"><strong>æ³¨ï¼š</strong></font>ä¸Šé¢æ¶‰åŠåˆ°ä¿®æ”¹å¯†ç çš„ update è¯­å¥ï¼Œæ˜¯åŸºäº<code>mysql5.7.30</code>ç‰ˆæœ¬ä½¿ç”¨çš„ï¼Œå¦‚æœç‰ˆæœ¬ä½ä¸€äº›ï¼Œè¯·ä½¿ç”¨ä¸‹é¢è¿™è¡Œä»£ç æ›¿æ¢ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update user <span class="built_in">set</span> password=password(&#x27;abc&#x27;) WHERE User=&#x27;root&#x27;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ä½ çš„ mysql å°±å·²ç»é…ç½®å®Œæˆå•¦ï¼å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†</p><h2 id="MIS-å®‰è£…ç‰ˆå¿˜è®°å¯†ç ">MIS å®‰è£…ç‰ˆå¿˜è®°å¯†ç </h2><p>ä¹‹å‰åœ¨ä¸Šé¢æˆ‘ä»¬æè¿‡ï¼Œå¦‚æœæˆ‘ä»¬å¿˜è®°äº†å¯†ç å¯ä»¥å›æº¯åˆ°æœ€å¼€å§‹ï¼Œåœ¨<code>my.ini</code>é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨<code>skip-grant-tables</code>å³å¯æ— éœ€å¯†ç ç™»å½•ï¼Œç„¶ååœ¨é‡ç½®å¯†ç </p><p>ä½†æ˜¯å¦‚æœæ˜¯é€šè¿‡ MIS å®‰è£…çš„ mysqlï¼Œå®ƒçš„ç›®å½•ä¸‹æ˜¯æ²¡æœ‰<code>my.ini</code>é…ç½®æ–‡ä»¶çš„ï¼Œæ‰€ä»¥æƒ³è¦é‡ç½®å¯†ç éœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><p>å…³é—­ mysql çš„æœåŠ¡</p></li><li><p>åœ¨ cmd ä¸‹è¾“å…¥<code>mysqld --skip-grant-tables</code>å¯åŠ¨æœåŠ¡å™¨ å…‰æ ‡ä¸åŠ¨ ï¼ˆä¸è¦å…³é—­è¯¥çª—å£ï¼‰</p></li><li><p>é‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°çš„ cmdï¼Œé”®å…¥å‘½ä»¤<code>mysql -u root -p</code>ï¼Œè¾“å…¥å¯†ç çš„æ—¶å€™ç›´æ¥å›è½¦ï¼Œæ²¡æœ‰æ ¡éªŒ</p></li><li><p>åˆ°è¿™é‡Œå°±å·²ç»å¯ä»¥è¿›å…¥æ•°æ®åº“äº†ï¼Œåœ¨ä¿®æ”¹è‡ªå·±çš„å¯†ç å³å¯ï¼š</p><ul><li><code>use mysql;</code></li><li><code>update user set authentication_string=password('å¯†ç ') where user='root' and Host='localhost';</code></li></ul></li><li><p>å¯†ç ä¿®æ”¹å®Œæˆåï¼Œå…³é—­ä¸¤ä¸ª cmd çª—å£ åœ¨ä»»åŠ¡ç®¡ç†å™¨ç»“æŸ mysqld è¿›ç¨‹ï¼Œé‡å¯ mysql è¿›ç¨‹å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†</p></li></ol><h1>ç»“æ„åŒ–è¯­è¨€</h1><p>å­¦ä¹  mysql å¤§å¤šæ•°éƒ½æ˜¯åœ¨å­¦ä¹  sql è¿™é—¨è¯­è¨€ï¼Œsql è¯­è¨€ä¸­åˆ’åˆ†äº†è¯­å¥çš„ç±»å‹ï¼Œç§°ä¹‹ä¸ºç»“æ„åŒ–è¯­è¨€ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>DDL æ•°æ®å®šä¹‰è¯­è¨€</td><td>æ“ä½œçš„æ˜¯è¡¨ç»“æ„ç›¸å…³ï¼Œä¾‹å¦‚<code>CREATEã€ALTERã€MODIFYã€DROP</code></td></tr><tr><td>DML æ•°æ®æ“çºµè¯­è¨€</td><td>æ“ä½œè¡¨ä¸­å…·ä½“çš„æ•°æ®ï¼Œä¾‹å¦‚<code>INSERã€DELETEã€UPDATEã€TRUNCATE</code></td></tr><tr><td>DQL æ•°æ®æŸ¥è¯¢è¯­è¨€</td><td>è´Ÿè´£æŸ¥è¯¢ç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚<code>SELECTã€SHOW</code></td></tr><tr><td>DPL äº‹åŠ¡å¤„ç†è¯­è¨€</td><td>æ“ä½œäº‹åŠ¡ç›¸å…³å‘½ä»¤ï¼Œä¾‹å¦‚<code>BIGINã€ROLLBACKã€COMMIT</code></td></tr><tr><td>DCL æ•°æ®æ§åˆ¶è¯­è¨€</td><td>ç”¨äºä¸ºç”¨æˆ·è®¾ç½®æƒé™çš„å‘½ä»¤ï¼Œä¾‹å¦‚<code>GRANTã€REVOKE</code></td></tr></tbody></table><h1>åº“çº§ç›¸å…³å‘½ä»¤</h1><p>å‘½ä»¤ä¸ç”¨æ­»è®°ç¡¬èƒŒï¼Œç”¨æ—¶è¿‡æ¥æ‰¾ï¼Œéšæ—¶ä½œè¡¥å……ï¼Œç†Ÿèƒ½ç”Ÿå·§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ›å»ºæ•°æ®åº“ï¼Œå¯é€‰æ‹©çš„æŒ‡å®šå­—ç¬¦é›†</span><br><span class="line">CREATE DATABASE [IF NOT EXISTS] `TEST` [CHARACTER SET utf8];</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤æ•°æ®åº“</span><br><span class="line">DROP DATABASE [IF EXISTS] `TEST`;</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢æ‰€æœ‰å·²åˆ›å»ºçš„æ•°æ®åº“</span><br><span class="line">SHOW DATABASES;</span><br><span class="line"></span><br><span class="line">-- æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“åˆ›å»ºå‘½ä»¤</span><br><span class="line">SHOW CREATE DATABASE `TEST`;</span><br><span class="line"></span><br><span class="line">-- ä¿®æ”¹æ•°æ®åº“ä¿¡æ¯ ( åº“åä¸å¯ä¿®æ”¹ )</span><br><span class="line">ALTER DATABASE `TEST` [CHARACTER SET utf8];</span><br><span class="line"></span><br><span class="line">-- é€‰æ‹©æ•°æ®åº“</span><br><span class="line">USE `TEST`; </span><br></pre></td></tr></table></figure><p><code>TEST</code>ä»£è¡¨åº“åç§°ï¼Œ<em>`</em> è¢«å«åš â€œé£˜å·â€ï¼Œå®ƒé€‚ç”¨äºæˆ‘ä»¬ä¹¦å†™çš„æ ‡è¯†ç¬¦é˜²æ­¢è¢«è¯†åˆ«ä¸ºå…³é”®å­—</p><p>[ ] ä¸­æ‹¬å·å†…çš„å…³é”®å­—ä¸ºå¯é€‰é¡¹ï¼š</p><ul><li><code>CREATE DATABASE</code>ä¸­çš„<code>IF NOT EXISTS</code>çš„ä½œç”¨æ˜¯åˆ›å»ºå·²å­˜åœ¨çš„åº“æ—¶ä¼šé˜²æ­¢æŠ¥é”™</li><li><code>DROP DATABASE</code>ä¸­çš„<code>IF EXISTS</code>çš„ä½œç”¨æ˜¯åˆ é™¤ä¸å­˜åœ¨çš„åº“æ—¶ä¼šé˜²æ­¢æŠ¥é”™</li><li><code>CHARACTER SET</code>è¡¨ç¤ºçš„å°±æ˜¯å­—ç¬¦é›†äº†</li></ul><h1>è¡¨çº§ç›¸å…³å‘½ä»¤</h1><p>å…³äºè¡¨çš„å‡ ä¸ªç®€å•å‘½ä»¤è¿™é‡Œè®°ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ›å»ºè¡¨</span><br><span class="line">CREATE TABLE è¡¨åç§°(...);</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤è¡¨</span><br><span class="line">DROP TABLE è¡¨åç§°;</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢è¡¨ç»“æ„</span><br><span class="line">SHOW CREATE TABLE è¡¨åç§°;</span><br><span class="line"></span><br><span class="line">-- å¤åˆ¶ä¸€å¼ è¡¨ï¼ˆä»…æ•°æ®ï¼‰</span><br><span class="line">CREATE TABLE æºè¡¨ SELECT * FROM æ–°è¡¨</span><br><span class="line"></span><br><span class="line">-- å¤åˆ¶ä¸€å¼ è¡¨ï¼ˆè¿åŒè¡¨ç»“æ„ï¼ŒåŒ…æ‹¬ä¸»é”®ï¼Œçº¦æŸç­‰ç­‰ï¼‰</span><br><span class="line">CREATE TABLE æºè¡¨ LIKE æ–°è¡¨</span><br><span class="line"></span><br><span class="line">-- æ¸…ç©ºè¡¨ä¸­çš„æ•°æ®</span><br><span class="line">TRUNCATE TABLE è¡¨åç§°;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºç®€å•è¡¨</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `EMP` (</span><br><span class="line"> `ID` INT(5),</span><br><span class="line"> `NAME` VARCHAR(20)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="å„ç§æ•°æ®ç±»å‹">å„ç§æ•°æ®ç±»å‹</h2><p>ä¸Šé¢å°±æ˜¯åˆ›å»ºä¸€å¼ ç®€å•çš„æ•°æ®è¡¨çš„ SQL è¯­å¥ï¼Œ<code>ID</code>å’Œ<code>NAME</code>éƒ½æ˜¯åˆ—çš„åç§°ï¼Œåé¢è·Ÿç€çš„<code>INTã€VARCHAR</code>å°±æ˜¯æ•°æ®ç±»å‹ï¼Œæ•°æ®ç±»å‹åé¢çš„æ‹¬å·ä»£è¡¨çš„æ˜¯é•¿åº¦ï¼Œæ•°æ®ç±»å‹ä¸»è¦åˆ†ä¸º <strong>æ•°å€¼</strong> <strong>å­—ç¬¦ä¸²</strong> <strong>æ—¥æœŸæ—¶é—´</strong> <strong>æšä¸¾</strong> ä¸‰ç§</p><blockquote><p>æ•°å€¼ç±»å‹</p></blockquote><table><thead><tr><th style="text-align:left">ç±»å‹</th><th>å¤§å°</th><th style="text-align:left">æœ€å¤§æ•°é‡ / é•¿åº¦</th><th style="text-align:left">ä½¿ç”¨åœºæ™¯ / æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">BIT</td><td>ä½æ•°æ®</td><td style="text-align:left">1~64</td><td style="text-align:left">å°æ•´æ•°å€¼</td></tr><tr><td style="text-align:left">TINYINT</td><td>1 å­—èŠ‚</td><td style="text-align:left">255</td><td style="text-align:left">å°æ•´æ•°å€¼</td></tr><tr><td style="text-align:left">SMALLINT</td><td>2 å­—èŠ‚</td><td style="text-align:left">65535</td><td style="text-align:left">å¤§æ•´æ•°å€¼</td></tr><tr><td style="text-align:left">MEDIUMINT</td><td>3 å­—èŠ‚</td><td style="text-align:left">16777215</td><td style="text-align:left">å¤§æ•´æ•°å€¼</td></tr><tr><td style="text-align:left">INT æˆ– INTEGER</td><td>4 å­—èŠ‚</td><td style="text-align:left">2147483647</td><td style="text-align:left">å¤§æ•´æ•°å€¼</td></tr><tr><td style="text-align:left">BIGINT</td><td>8 å­—èŠ‚</td><td style="text-align:left">18446744073709551615</td><td style="text-align:left">æå¤§æ•´æ•°å€¼</td></tr><tr><td style="text-align:left">FLOAT</td><td>4 å­—èŠ‚</td><td style="text-align:left"></td><td style="text-align:left">å•ç²¾åº¦ æµ®ç‚¹æ•°å€¼</td></tr><tr><td style="text-align:left">DOUBLE</td><td>8 å­—èŠ‚</td><td style="text-align:left"></td><td style="text-align:left">åŒç²¾åº¦ æµ®ç‚¹æ•°å€¼</td></tr><tr><td style="text-align:left">DECIMAL</td><td>(M, D)</td><td style="text-align:left">ä¾èµ–äº M å’Œ D çš„å€¼</td><td style="text-align:left">å°æ•°ï¼Œé€‚åˆé‡‘èè®¡ç®—</td></tr></tbody></table><blockquote><p>å­—ç¬¦ä¸²ç±»å‹</p></blockquote><table><thead><tr><th style="text-align:left">ç±»å‹</th><th style="text-align:left">å¤§å°</th><th style="text-align:left">ç”¨é€”</th></tr></thead><tbody><tr><td style="text-align:left">CHAR</td><td style="text-align:left">255 å­—èŠ‚</td><td style="text-align:left">å®šé•¿å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">VARCHAR</td><td style="text-align:left">65535 å­—èŠ‚</td><td style="text-align:left">å˜é•¿å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">TINYBLOB</td><td style="text-align:left">255 å­—èŠ‚</td><td style="text-align:left">ä¸è¶…è¿‡ 255 ä¸ªå­—ç¬¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">TINYTEXT</td><td style="text-align:left">255 å­—èŠ‚</td><td style="text-align:left">çŸ­æ–‡æœ¬å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">BLOB</td><td style="text-align:left">65535 å­—èŠ‚</td><td style="text-align:left">äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ®</td></tr><tr><td style="text-align:left">TEXT</td><td style="text-align:left">65535 å­—èŠ‚</td><td style="text-align:left">é•¿æ–‡æœ¬æ•°æ®</td></tr><tr><td style="text-align:left">MEDIUMBLOB</td><td style="text-align:left">16777215 å­—èŠ‚</td><td style="text-align:left">äºŒè¿›åˆ¶å½¢å¼çš„ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ®</td></tr><tr><td style="text-align:left">MEDIUMTEXT</td><td style="text-align:left">16777215 å­—èŠ‚</td><td style="text-align:left">ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ®</td></tr><tr><td style="text-align:left">LONGBLOB</td><td style="text-align:left">4294967295 å­—èŠ‚</td><td style="text-align:left">äºŒè¿›åˆ¶å½¢å¼çš„æå¤§æ–‡æœ¬æ•°æ®</td></tr><tr><td style="text-align:left">LONGTEXT</td><td style="text-align:left">4294967295 å­—èŠ‚</td><td style="text-align:left">æå¤§æ–‡æœ¬æ•°æ®</td></tr></tbody></table><blockquote><p>æ—¥æœŸæ—¶é—´ç±»å‹</p></blockquote><table><thead><tr><th style="text-align:left">ç±»å‹</th><th style="text-align:left">å¤§å°</th><th style="text-align:left">æ ¼å¼</th><th style="text-align:left">ç”¨é€”</th></tr></thead><tbody><tr><td style="text-align:left">DATE</td><td style="text-align:left">3 å­—èŠ‚</td><td style="text-align:left">YYYY-MM-DD</td><td style="text-align:left">æ—¥æœŸå€¼</td></tr><tr><td style="text-align:left">TIME</td><td style="text-align:left">3 å­—èŠ‚</td><td style="text-align:left">HH:MM:SS</td><td style="text-align:left">æ—¶é—´å€¼æˆ–æŒç»­æ—¶é—´</td></tr><tr><td style="text-align:left">YEAR</td><td style="text-align:left">1 å­—èŠ‚</td><td style="text-align:left">YYYY</td><td style="text-align:left">å¹´ä»½å€¼</td></tr><tr><td style="text-align:left">DATETIME</td><td style="text-align:left">8 å­—èŠ‚</td><td style="text-align:left">YYYY-MM-DD HH:MM:SS</td><td style="text-align:left">æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼</td></tr><tr><td style="text-align:left">TIMESTAMP</td><td style="text-align:left">4 å­—èŠ‚</td><td style="text-align:left">YYYYMMDD HHMMSS</td><td style="text-align:left">æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼ï¼Œæ—¶é—´æˆ³</td></tr></tbody></table><blockquote><p>é€‰æ‹©ç±»å‹</p></blockquote><table><thead><tr><th>ç±»å‹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>ENUM</td><td>åªèƒ½ä½¿ç”¨ä¸€äº›ç‰¹å®šçš„å€¼ï¼Œä¾‹å¦‚ ENUM(â€˜ç”·â€™, â€˜å¥³â€™)</td></tr><tr><td>SET</td><td>å¦‚æœè¯´ ENUM æ˜¯å•é€‰ï¼Œé‚£ä¹ˆ SET å°±æ˜¯å¤šé€‰</td></tr></tbody></table><blockquote><p>æ ¹æ®äº†è§£åˆ°çš„æ•°æ®ç±»å‹å®Œå–„ä¸€ä¸‹è¡¨çš„ç»“æ„</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `EMP` (</span><br><span class="line"> `ID` INT(5),</span><br><span class="line"> `DEPT_ID` INT(3),</span><br><span class="line"> `NAME` VARCHAR(20),</span><br><span class="line"> `AGE` INT(3),</span><br><span class="line"> `IDENTITY` VARCHAR(18),</span><br><span class="line"> `GENDER` ENUM(&#x27;ç”·&#x27;, &#x27;å¥³&#x27;),</span><br><span class="line"> `CREATE_DATE` DATETIME,</span><br><span class="line"> `MODIFY_DATE` DATETIME,</span><br><span class="line"> `MONEY` DECIMAL(14, 2),</span><br><span class="line"> `DESCRIPTION` TEXT</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="çº¦æŸ-Constraint">çº¦æŸ Constraint</h2><p>è¡¨çš„æ•°æ®è‚¯å®šä¸æ˜¯æƒ³äº›ä»€ä¹ˆå°±å†™ä»€ä¹ˆï¼Œä¸ç„¶æ•°æ®ä¹±äº†è¡¨å°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ï¼Œè¦è®©è¡¨å˜å¾—æœ‰æ„ä¹‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘è¡¨ä¸­æ·»åŠ æ•°æ®çš„æ—¶å€™è®¾è®¡ä¸€äº›è§„åˆ™ï¼Œä¾‹å¦‚ä¸èƒ½ç•™ç©ºï¼Œæˆ–è€…ä¸èƒ½é‡å¤ä¹‹ç±»çš„ï¼Œè¿™ä¸ªå«åš <strong>çº¦æŸ</strong></p><blockquote><p>çº¦æŸå¤§è‡´åˆ†ä¸ºäº”ç§</p></blockquote><ul><li><p>ä¸»é”®çº¦æŸ<code>PRIMARY KEY</code></p><ul><li>åœ¨è¡¨ä¸­æ˜¯å”¯ä¸€çš„æ ‡è¯†ï¼Œé€šè¿‡ä¸»é”®åˆ—å¯ä»¥æ‰¾åˆ°ä»»ä½•ä¸€è¡Œè®°å½•ï¼Œ<strong>è‡ªå¸¦å”¯ä¸€å’Œéç©º</strong></li></ul></li><li><p>å¤–é”®çº¦æŸ<code>FOREIGN KEY</code></p><ul><li>æŒ‡æœ¬è¡¨ä¸­çš„æŸä¸€åˆ—å…³è”å…¶ä»–è¡¨ä¸­çš„æŸä¸€åˆ—ï¼Œæ‰€å–çš„å€¼å¿…é¡»åœ¨è¢«çº¦æŸçš„åˆ—ä¸­å­˜åœ¨ï¼Œçº¦æŸä¸è¢«çº¦æŸçš„åˆ—çš„ç±»å‹ä»¥åŠé•¿åº¦å¿…é¡»ç›¸åŒ ( é˜¿é‡Œæ‰‹å†Œç¦ç”¨å¤–é”®çº¦æŸ )</li></ul></li><li><p>å”¯ä¸€çº¦æŸ<code>UNIQUE</code></p><ul><li>è¯¥åˆ—ä¸å…è®¸å‡ºç°é‡å¤çš„æ•°æ®ï¼ŒNULLå€¼é™¤å¤–</li></ul></li><li><p>éç©º<code>NOT NULL</code></p><ul><li>è¯¥åˆ—ä¸å…è®¸å‡ºç°ç©ºå€¼ NULLï¼Œç©ºå­—ç¬¦ä¸² â€œâ€ ä¸å±äºç©ºå€¼</li></ul></li><li><p>æ£€æŸ¥<code>CHECK</code></p><ul><li>é€šè¿‡è¡¨è¾¾å¼åˆ¤æ–­æ¥æ£€æŸ¥å½“å‰åˆ—æ˜¯å¦ç¬¦åˆè¦æ±‚çš„è§„åˆ™ï¼Œè¯¥çº¦æŸç›®å‰åœ¨ MySQL ä¸­æ— æ•ˆ</li></ul></li></ul><blockquote><p>çº¦æŸçš„æ·»åŠ ä¸æŸ¥çœ‹</p></blockquote><p>çº¦æŸå¯ä»¥ç›´æ¥ä¹¦å†™åœ¨ç±»å‹çš„åé¢ï¼Œå«åš <strong>è¡Œçº§çº¦æŸ</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `EMP` (</span><br><span class="line"> `USER_ID` INT(5) PRIMARY KEY</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨è¡¨åˆ›å»ºå®Œæˆä¹‹åä¹¦å†™åœ¨æœ€åé¢ï¼Œå«åš <strong>è¡¨çº§çº¦æŸ</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `EMP` (</span><br><span class="line"> `USER_ID` INT(5),</span><br><span class="line">   PRIMARY KEY(`USER_ID`)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¡¨ç»“æ„åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬æƒ³çŸ¥é“è‡ªå·±ç©¶ç«Ÿè®¾ç½®äº†é‚£äº›çº¦æŸï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM `EMP`</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>çº¦æŸå…±æœ‰äº”ç§ç±»å‹ï¼Œåˆ†ä¸ºè¡¨çº§çº¦æŸå’Œåˆ—çº§çº¦æŸä¸¤ç§ä¹¦å†™æ–¹å¼</li><li>è¡¨çº§çº¦æŸä¸æ”¯æŒ<code>NOT NULL</code>ï¼Œåˆ—çº§çº¦æŸä¸æ”¯æŒ<code>FOREIGN KEY</code>å’Œ<code>CHECK</code></li><li>ä¸ªäººå»ºè®®ä½¿ç”¨ <em>è¡¨çº§çº¦æŸ</em>ï¼Œä½¿ç”¨è¡¨çº§çº¦æŸçš„æƒ…å†µä¸‹æŸ¥çœ‹æ‰€æœ‰å…³äºçº¦æŸçš„åˆ—å¯ä»¥ç›´æ¥çœ‹æœ€åå‡ è¡Œå°±ä¸€ç›®äº†ç„¶äº†</li></ul><blockquote><p>æœ‰äº†è¿™å‡ ä¸ªçº¦æŸï¼Œæˆ‘ä»¬åœ¨é‡æ–°è®¾è®¡ä¸€ä¸‹è¡¨ç»“æ„</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- æ–°å»ºä¸€å¼ è¡¨ç”¨æ¥æµ‹è¯•å¤–é”®çº¦æŸï¼ˆè¡Œçº§çº¦æŸï¼‰</span><br><span class="line">CREATE TABLE `DEPT` (</span><br><span class="line"> `ID` INT(3) PRIMARY KEY,</span><br><span class="line"> `NAME` VARCHAR(10) NOT NULL,</span><br><span class="line"> `CREATE_TIME` DATETIME,</span><br><span class="line"> `PHONE` VARCHAR(20) NOT NULL</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">-- é‡æ–°è®¾ç½®è¡¨æ·»åŠ çº¦æŸï¼ˆè¡¨çº§çº¦æŸï¼‰</span><br><span class="line">CREATE TABLE `EMP` (</span><br><span class="line"> `ID` INT(5),</span><br><span class="line"> `DEPT_ID` INT(3),</span><br><span class="line"> `NAME` VARCHAR(20) NOT NULL,</span><br><span class="line"> `AGE` INT(3) NOT NULL,</span><br><span class="line"> `IDENTITY` VARCHAR(18),</span><br><span class="line"> `GENDER` ENUM(&#x27;ç”·&#x27;, &#x27;å¥³&#x27;),</span><br><span class="line"> `CREATE_DATE` DATETIME,</span><br><span class="line"> `MODIFY_DATE` DATETIME,</span><br><span class="line"> `MONEY` DECIMAL(14, 2),</span><br><span class="line"> `DESCRIPTION` TEXT,</span><br><span class="line">  PRIMARY KEY(`ID`),</span><br><span class="line">  UNIQUE(`IDENTITY`),</span><br><span class="line">  FOREIGN KEY(`DEPT_ID`) REFERENCES`DEPT`(`ID`)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="åˆ—çš„å„ç§å±æ€§">åˆ—çš„å„ç§å±æ€§</h2><p>æˆ‘ä»¬åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œå…ˆæ˜¯å†™åˆ—åç§°ï¼Œç„¶åæ˜¯æ•°æ®ç±»å‹ï¼Œç„¶åæ˜¯è¡Œçº§çº¦æŸï¼Œæœ€åå†™è¡¨çº§çº¦æŸï¼Œåˆ—ä¸­é™¤å¼€è¿™äº›ä¹‹å¤–ï¼Œè¿˜æœ‰ä»–æœ¬èº«è‡ªå¸¦çš„å±æ€§ï¼š</p><ul><li>é»˜è®¤<code>DEFAULT</code><ul><li>å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æä¾›è¯¥åˆ—çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±æ˜¯ç”¨è¿™ä¸ªé»˜è®¤å€¼</li></ul></li><li>æ³¨é‡Š<code>COMMENT</code><ul><li>æ³¨é‡Šæ˜¯é¢å‘å¼€å‘äººå‘˜çš„ï¼Œç”¨æ¥å‘Šè¯‰å¼€å‘äººå‘˜è¿™åˆ—ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Œå–å€¼ç­‰ç­‰ï¼Œè¡¨å’Œåˆ—éƒ½å¯ä»¥ä½¿ç”¨</li></ul></li><li>è‡ªå¢<code>AUTO_INCREMENT</code><ul><li>æˆ‘ä»¬è¡¨ä¸­çš„ä¸»é”®åˆ—ï¼Œå½“è¡¨ä¸­æ•°æ®ä¸å¤šçš„æ—¶å€™å¯ä»¥é€‰æ‹©ä½¿ç”¨è‡ªå¢ï¼Œä»–ä¼šè‡ªåŠ¨ç”Ÿæˆ 1, 2, 3â€¦ çš„é€’å¢ä¸»é”®</li></ul></li><li>æ›´æ–°<code>ON UPDATE</code><ul><li>è¡¨ä¸­æœ€å¸¸è§çš„ä¸¤ä¸ªå­—æ®µå°±æ˜¯åˆ›å»ºæ—¶é—´ä»¥åŠä¿®æ”¹æ—¶é—´ï¼Œå…¶ä¸­ä¿®æ”¹æ—¶é—´æ˜¯éšç€æ¯æ¬¡ä¿®æ”¹éƒ½æ›´æ–°çš„ï¼Œè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨è¯¥å±æ€§æ¥å®Œæˆè¿™ä¸ªæ“ä½œ</li></ul></li><li>å¡«å……<code>ZEROFILL</code><ul><li>å¦‚æœå½“å‰å­—æ®µé•¿åº¦ä¸º10ï¼Œä½†æ˜¯å€¼å¾—é•¿åº¦å¹¶ä¸å¤Ÿ10ä½ï¼Œæƒ³è¦è¡¥å…¨10ä¸ºå°±å¯ä»¥ç”¨è¯¥å±æ€§</li></ul></li><li>æ— ç¬¦å·<code>UNSIGNED</code><ul><li>é€‚ç”¨äºæ•°å€¼ç±»å‹ï¼Œåªèƒ½å­˜å‚¨å¤§äºç­‰äº 0 çš„å€¼ï¼Œç®€å•ç†è§£ æ— ç¬¦å· â‰ˆ æ— è´Ÿå·</li></ul></li></ul><p><strong>å…³äºè‡ªå¢çš„æè¿°ï¼š</strong></p><ol><li><em>è‡ªå¢é€‚ç”¨äºæ•°å€¼ç±»å‹ä¸”å¿…é¡»æ˜¯ä¸»é”®çš„åˆ—ï¼Œä¸”ä¸€å¼ è¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªè‡ªå¢åˆ—</em></li><li>åœ¨ mysql 5.7 ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè‡ªå¢æ•°æ®æ˜¯æš‚å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œå½“é‡å¯ mysql æ‰“å¼€è¡¨åä»–ä¼šæ‰¾åˆ°å½“å‰è‡ªå¢åˆ—çš„æœ€å¤§å€¼å¼€å§‹ç»§ç»­è‡ªå¢ï¼Œè€Œ mysql 8 ä¹‹åè¿™ä¸ªè‡ªå¢åšäº†æŒä¹…åŒ–</li><li>å½“æˆ‘ä»¬å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œåªæœ‰åœ¨æœªæŒ‡å®šè‡ªå¢åˆ—çš„å€¼æˆ–è€…ä¼ çš„å€¼ä¸º NULL å€¼å¾—æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘è‡ªå¢</li><li>æˆ‘ä»¬æ’å…¥æ•°æ®æ—¶ä¸ºè‡ªå¢åˆ— ( y ) ä¼ äº†å€¼ ( x ) çš„æƒ…å†µä¸‹ï¼Œå¦‚æœ x &gt; y é‚£ä¹ˆ x å°±ä¼šä½œä¸ºæ–°çš„è‡ªå¢å€¼ï¼Œå¦åˆ™ä¸ä¼šå˜åŒ–</li><li>å½“å‰è‡ªå¢å€¼ä¸º 1ï¼Œæ‰§è¡Œäº†ä¸€æ¬¡æ’å…¥å¤±è´¥ä¹‹åï¼Œåœ¨æ‰§è¡Œä¸€æ¬¡ä¼šå‘ç°å€¼æ˜¯ 3ï¼Œåœ¨å¤±è´¥çš„æ—¶å€™è‡ªå¢åˆ—è¿˜æ˜¯ä¼šå˜åŒ–çš„</li><li>è‡ªå¢å…³äºå€¼å¾—æ“ä½œä¼šåœ¨åé¢æåˆ°</li></ol><blockquote><p>æ ¹æ®æŒæ¡çš„å±æ€§åœ¨é‡æ–°è®¾è®¡ä¸€æ¬¡è¡¨ç»“æ„</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- æ·»åŠ ä¸Šä¸€äº›å±æ€§ç”¨æ¥æµ‹è¯•</span><br><span class="line">CREATE TABLE `DEPT` (</span><br><span class="line"> `ID` INT(3) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT &#x27;éƒ¨é—¨ID&#x27;,</span><br><span class="line"> `NAME` VARCHAR(10) NOT NULL COMMENT &#x27;éƒ¨é—¨åç§°&#x27;,</span><br><span class="line"> `CREATE_TIME` DATETIME DEFAULT NOW() COMMENT &#x27;éƒ¨é—¨æˆç«‹æ—¶é—´&#x27;,</span><br><span class="line"> `PHONE` VARCHAR(20) NOT NULL COMMENT &#x27;éƒ¨é—¨è”ç³»ç”µè¯&#x27;</span><br><span class="line">) COMMENT &#x27;éƒ¨é—¨è¡¨&#x27;;</span><br><span class="line"></span><br><span class="line">-- æ·»åŠ ä¸Šä¸€äº›å±æ€§ç”¨æ¥æµ‹è¯•</span><br><span class="line">CREATE TABLE `EMP` (</span><br><span class="line"> `ID` INT(5) UNSIGNED AUTO_INCREMENT COMMENT &#x27;å‘˜å·¥ID&#x27;,</span><br><span class="line"> `DEPT_ID` INT(3) UNSIGNED COMMENT &#x27;æ‰€åœ¨çš„éƒ¨é—¨ID&#x27;,</span><br><span class="line"> `NAME` VARCHAR(20) NOT NULL COMMENT &#x27;å§“å&#x27;,</span><br><span class="line"> `AGE` INT(3) NOT NULL COMMENT &#x27;å‘˜å·¥å¹´é¾„&#x27;,</span><br><span class="line"> `IDENTITY` VARCHAR(18) COMMENT &#x27;èº«ä»½è¯å·ç &#x27;,</span><br><span class="line"> `GENDER` ENUM(&#x27;ç”·&#x27;, &#x27;å¥³&#x27;) DEFAULT &#x27;ç”·&#x27; COMMENT &#x27;æ€§åˆ«&#x27;,</span><br><span class="line"> `CREATE_DATE` DATETIME DEFAULT NOW() COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line"> `MODIFY_DATE` DATETIME DEFAULT NOW() ON UPDATE NOW() COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,</span><br><span class="line"> `MONEY` DECIMAL(14, 2) COMMENT &#x27;æœˆè–ª&#x27;,</span><br><span class="line"> `DESCRIPTION` TEXT COMMENT &#x27;ä¸ªäººæè¿°&#x27;,</span><br><span class="line">  PRIMARY KEY(`ID`),</span><br><span class="line">  UNIQUE(`IDENTITY`),</span><br><span class="line">  FOREIGN KEY(`DEPT_ID`) REFERENCES `DEPT` (`ID`)</span><br><span class="line">) COMMENT &#x27;å‘˜å·¥è¡¨&#x27;;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹å·²åˆ›å»ºçš„è¡¨">ä¿®æ”¹å·²åˆ›å»ºçš„è¡¨</h2><p>ä¸Šé¢æ¯æ¬¡åšä¸€å†™æ›´æ–°éƒ½ä¼šé‡æ–°æ’°å†™å»ºè¡¨è¯­å¥ï¼Œå¦‚æœåœ¨é¡¹ç›®å·²ç»ä¸Šçº¿çš„æƒ…å†µä¸‹ï¼Œè¡¨ä¸­ä¼šæœ‰å¤§é‡çš„æ•°æ®ï¼Œé¢‘ç¹çš„é‡å»ºå¾ˆæµªè´¹äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å­¦ä¹ ä¿®æ”¹å·²åˆ›å»ºçš„è¡¨</p><p>é‡æ–°åˆ›å»ºä¸€ä¸ªæµ‹è¯•è¡¨ç”¨æ¥ç»ƒä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `USER` (</span><br><span class="line"> `ID` INT(3) AUTO_INCREMENT COMMENT &#x27;ç”¨æˆ·ID&#x27;,</span><br><span class="line"> `NAME` VARCHAR(10) NOT NULL COMMENT &#x27;æ˜µç§°&#x27;,</span><br><span class="line"> `USER_ID` VARCHAR(20) COMMENT &#x27;è´¦å·&#x27;,</span><br><span class="line"> `PASSWORD` VARCHAR(20) COMMENT &#x27;å¯†ç &#x27;</span><br><span class="line">) COMMENT &#x27;ç”¨æˆ·è¡¨&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>è¡¨çº§ä¿®æ”¹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- ä¿®æ”¹è¡¨çš„åç§°</span><br><span class="line">rename table `USER` TO `T_EMP`;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ—çº§ä¿®æ”¹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- ADDï¼šæ–°å¢ä¸€ä¸ªåˆ—</span><br><span class="line">ALTER TABLE `T_EMP` ADD `SEX `ENUM (&#x27;ç”·&#x27;, &#x27;å¥³&#x27;);</span><br><span class="line"></span><br><span class="line">-- MODIFYï¼šä¿®æ”¹åˆ—çš„ä¿¡æ¯ï¼Œæ–°çš„åˆ—ä¼šç›´æ¥è¦†ç›–æ—§çš„åˆ—ï¼Œæ‰€ä»¥è¯·å°†å±æ€§å†™å…¨ä¸ç„¶ä¼šä¸¢å¤±</span><br><span class="line">ALTER TABLE `T_EMP` MODIFY `SEX` ENUM (&#x27;ç”·&#x27;, &#x27;å¥³&#x27;) DEFAULT &#x27;ç”·&#x27;;</span><br><span class="line"></span><br><span class="line">-- CHANGEï¼šä¿®æ”¹åˆ—ä»¥åŠåˆ—åï¼Œæ–°çš„åˆ—ä¼šç›´æ¥è¦†ç›–æ—§çš„åˆ—ï¼Œæ‰€ä»¥è¯·å°†å±æ€§å†™å…¨ä¸ç„¶ä¼šä¸¢å¤±</span><br><span class="line">ALTER TABLE `T_EMP` CHANGE `SEX` `GENDER` ENUM (&#x27;ç”·&#x27;, &#x27;å¥³&#x27;) COMMENT &#x27;æ€§åˆ«&#x27;;</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤æŸä¸ªåˆ—</span><br><span class="line">ALTER TABLE `T_EMP` DROP `GENDER`;</span><br></pre></td></tr></table></figure><blockquote><p>çº¦æŸä¿®æ”¹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- æ–°å»ºè¡¨ç”¨æ¥æµ‹è¯•çº¦æŸ</span><br><span class="line">CREATE TABLE `TEST` (</span><br><span class="line"> `ID` INT(5),</span><br><span class="line"> `UUID` INT(3) UNSIGNED,</span><br><span class="line"> `NAME` VARCHAR(10)</span><br><span class="line">) COMMENT &#x27;æµ‹è¯•çº¦æŸ&#x27;</span><br><span class="line"></span><br><span class="line">-- åœ¨åˆ—ä¸Šæ·»åŠ çº¦æŸ</span><br><span class="line">ALTER TABLE `TEST` ADD PRIMARY KEY(`ID`)</span><br><span class="line">ALTER TABLE `TEST` ADD FOREIGN KEY(`UUID`) REFERENCES`DEPT`(`ID`)  -- æ— æ„ä¹‰ ä¸ºäº†æµ‹è¯•</span><br><span class="line">ALTER TABLE `TEST` ADD UNIQUE(`NAME`)</span><br><span class="line"></span><br><span class="line"># åœ¨åˆ—ä¸Šç§»é™¤æŸä¸ªçº¦æŸ</span><br><span class="line">#   æƒ³è¦åˆ é™¤çº¦æŸï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çº¦æŸåç§°ï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¡¨ç»“æ„ï¼šSHOW CREATE TABLE`TEST`</span><br><span class="line">#   åœ¨è¡¨ç»“æ„ä¸­å¯ä»¥çœ‹åˆ°çº¦æŸå¯¹åº”çš„åç§°ï¼Œç„¶åé€šè¿‡åç§°å®Œæˆåˆ é™¤çº¦æŸ</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤å¤–é”®çº¦æŸï¼ŒFOREIGN KEY åé¢è·Ÿä¸Šçº¦æŸåç§°</span><br><span class="line">ALTER TABLE `TEST` DROP FOREIGN KEY `test_ibfk_1`;</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤å”¯ä¸€çº¦æŸï¼ŒINDEX åé¢è·Ÿä¸Šçº¦æŸåç§°</span><br><span class="line">ALTER TABLE `TEST` DROP INDEX `NAME`;</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤ä¸»é”®çº¦æŸï¼Œä¼šåˆ é™¤è¡¨ä¸­æ‰€æœ‰ä¸»é”®(å¿…é¡»)ï¼Œæ— éœ€åç§°</span><br><span class="line">ALTER TABLE `TEST` DROP PRIMARY KEY;</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªå¢ä¿®æ”¹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- é‡ç½®è‡ªå¢å€¼ï¼šè¦æ±‚å½“å‰è¡¨ä¸­æ•°æ®ä¸ºç©ºæˆ–è€…å½“å‰è¡¨çš„è‡ªå¢åˆ—çš„æœ€å¤§å€¼å°äºä½ è¦è®¾ç½®çš„å€¼</span><br><span class="line">ALTER TABLE `123` AUTO_INCREMENT = 1;</span><br><span class="line">-- ä¿®æ”¹è‡ªå¢çš„æ­¥é•¿ï¼Œå±äºå…¨å±€ä¿®æ”¹ï¼Œä¼šåœ¨æ‰€æœ‰åº“æ‰€æœ‰è¡¨ä¸­ç”Ÿæ•ˆ</span><br><span class="line">SET @@auto_increment_increment=2;</span><br></pre></td></tr></table></figure><p>å¯¹äºå·²åˆ›å»ºçš„è¡¨çš„ä¿®æ”¹ï¼Œè‡ªå§‹è‡³ç»ˆè¿˜æ˜¯æœ‰äº›æ‰æ‘¸ä¸é€ï¼Œå»ºè®®è¿˜æ˜¯é€šè¿‡å¯è§†åŒ–å·¥å…·è¿›è¡Œæ“ä½œ</p><h2 id="æ‰©å±•ï¼šä¸‰å¤§èŒƒå¼">æ‰©å±•ï¼šä¸‰å¤§èŒƒå¼</h2><p>æˆ‘ä»¬åœ¨ä¹¦å†™ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œè®¾è®¡æ•°æ®åº“å¾€å¾€æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œä¸€ä¸ªç¨‹åºä¸­çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯å›´ç»•ç€æ•°æ®è¿›è¡Œæ“ä½œçš„ï¼Œè¡¨ç»“æ„è®¾è®¡çš„å¥½ç¨‹åºå†™èµ·æ¥å°±çœåŠ›ä¸€äº›ï¼Œç›¸åè¡¨ç»“æ„è®¾è®¡çš„ä¸å¥½ï¼Œç¨‹åºå†™èµ·æ¥å°±æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å»ºè®®æˆ‘ä»¬åœ¨è®¾è®¡æ•°æ®åº“çš„æ—¶å€™å‚ç…§ä¸€ä¸‹æ•°æ®åº“è®¾è®¡<strong>ä¸‰å¤§èŒƒå¼</strong></p><blockquote><p>ç¬¬ä¸€èŒƒå¼ï¼šåŸå­æ€§</p></blockquote><table><thead><tr><th style="text-align:center">å‘˜å·¥ID</th><th style="text-align:center">å‘˜å·¥å§“å</th><th style="text-align:center">éƒ¨é—¨èŒä½</th><th style="text-align:center">å‘˜å·¥è–ªèµ„</th></tr></thead><tbody><tr><td style="text-align:center">4163545354</td><td style="text-align:center">ç‹å¯Œè´µ</td><td style="text-align:center">æŠ€æœ¯éƒ¨å¼€å‘</td><td style="text-align:center">8000</td></tr></tbody></table><p>ç¬¬ä¸€èŒƒå¼é€šä¿—æ¥è¯´å°±æ˜¯è¡¨ä¸­çš„<em>æ¯åˆ—éƒ½ä¸å¯å†åˆ†</em>ï¼Œç±»ä¼¼ä¸Šé¢è¿™å¼ å‘˜å·¥è¡¨ï¼Œå…¶ä¸­çš„<code>éƒ¨é—¨èŒä½</code>å¯ä»¥è¿›è¡Œæ‹†åˆ†ä¸º<code>éƒ¨é—¨</code>å’Œ<code>èŒä½</code>ä¸¤åˆ—ï¼Œè¿åäº†ç¬¬ä¸€èŒƒå¼ï¼Œåº”è¯¥æŒ‰ç…§ä¸‹é¢çš„æ ¼å¼è¿›è¡Œè®¾è®¡ï¼š</p><table><thead><tr><th style="text-align:center">å‘˜å·¥ID ( ä¸»é”® )</th><th style="text-align:center">å‘˜å·¥å§“å</th><th style="text-align:center">éƒ¨é—¨</th><th style="text-align:center">èŒä½</th><th style="text-align:center">å‘˜å·¥è–ªèµ„</th></tr></thead><tbody><tr><td style="text-align:center">4163545354</td><td style="text-align:center">ç‹å¯Œè´µ</td><td style="text-align:center">æŠ€æœ¯éƒ¨</td><td style="text-align:center">å¼€å‘</td><td style="text-align:center">8000</td></tr></tbody></table><blockquote><p>ç¬¬äºŒèŒƒå¼ï¼šå®Œæ•´æ€§</p></blockquote><p>ä¸€å¼ è¡¨ä¸€èˆ¬åªæœ‰ä¸€ä¸ªä¸»é”®åˆ—ç”¨æ¥åŒºåˆ†æ¯ä¸€è¡Œï¼Œä½†æ˜¯æœ‰çš„è¡¨ä¼šä½¿ç”¨åˆ°è”åˆä¸»é”®ï¼Œç¬¬äºŒèŒƒå¼å°±æ˜¯è¦æ±‚<em>æ‰€æœ‰åˆ—éƒ½è¦ä¸ä¸»é”®åˆ—ç›¸å…³è€Œä¸æ˜¯å’Œéƒ¨åˆ†ä¸»é”®ç›¸å…³</em>ï¼Œä¾‹å¦‚ä¸‹é¢å¼ æˆç»©è¡¨ï¼š</p><table><thead><tr><th style="text-align:center">å­¦ç”Ÿ ID ( ä¸»é”®1 )</th><th style="text-align:center">è¯¾ç¨‹ ID ( ä¸»é”®2 )</th><th style="text-align:center">è¯¾ç¨‹åç§°</th><th style="text-align:center">åˆ†æ•°</th></tr></thead><tbody><tr><td style="text-align:center">31718040101</td><td style="text-align:center">82001</td><td style="text-align:center">ã€ŠJavaé«˜çº§ä»å…¥é—¨åˆ°å…¥åŸã€‹</td><td style="text-align:center">82</td></tr></tbody></table><p>è¯¾ç¨‹åç§°ä»…ä»…å’Œè¯¾ç¨‹ ID æœ‰å…³ç³»ï¼Œä¸å­¦ç”Ÿ ID æ²¡æœ‰å…³ç³»ï¼Œè¿™å°±è¿åäº†ç¬¬äºŒèŒƒå¼ï¼Œåº”è¯¥å°†è¯¾ç¨‹åç§°æ”¾åˆ°è¯¾ç¨‹è¡¨ä¸­ã€‚</p><blockquote><p>ç¬¬ä¸‰èŒƒå¼ï¼šç›´æ¥å…³ç³»</p></blockquote><p>ç¬¬ä¸‰èŒƒå¼å¯ä»¥ç†è§£ä¸º*è¡¨ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½åº”è¯¥ä¸ä¸»é”®æœ‰ç›´æ¥å…³ç³»ï¼Œè€Œä¸æ˜¯é—´æ¥å…³ç³»ï¼Œ*ä¾‹å¦‚è¿™å¼ åšå®¢è¡¨ä¸­çš„åˆ†ç±»åç§°å°±è¿åäº†ç¬¬ä¸‰èŒƒå¼ï¼Œä»–åº”è¯¥æ˜¯é€šè¿‡åˆ†ç±» ID æŸ¥å‡ºæ¥çš„ä¿¡æ¯ï¼Œä¸åº”è¯¥ç›´æ¥å†™åˆ°åšå®¢è¡¨ä¸­ï¼Œåº”è¯¥å†™åˆ°åˆ†ç±»è¡¨ä¸­</p><table><thead><tr><th style="text-align:center">åšå®¢ ID ( ä¸»é”® )</th><th style="text-align:center">åˆ†ç±» ID</th><th style="text-align:center">åˆ†ç±»åç§°</th><th style="text-align:center">åšå®¢æ ‡é¢˜</th><th style="text-align:left">åšå®¢å†…å®¹</th></tr></thead><tbody><tr><td style="text-align:center">B348500012</td><td style="text-align:center">2</td><td style="text-align:center">çŸ¥è¯†</td><td style="text-align:center">Javaå…¥é—¨æ•™ç¨‹</td><td style="text-align:left">Javaæ˜¯é¢å‘å¯¹è±¡çš„é«˜çº§è¯­è¨€â€¦</td></tr></tbody></table><ul><li>ç¬¬ä¸‰èŒƒå¼å’Œç¬¬äºŒèŒƒå¼å¾ˆç›¸åƒï¼Œç¬¬äºŒèŒƒå¼æ˜¯é’ˆå¯¹è”åˆä¸»é”®çš„ï¼Œè€Œç¬¬ä¸‰èŒƒå¼æ˜¯é’ˆå¯¹å½“å‰è¡¨å’Œå”¯ä¸€ä¸»é”®çš„ã€‚</li><li>ä¸‰å¤§èŒƒå¼ä»…ä»…æ˜¯ä¸€ä¸ªè§„èŒƒï¼Œèµ·åˆ°å‚è€ƒä½œç”¨ï¼Œä½†æ˜¯åœ¨çœŸå®é¡¹ç›®ä¸­è¦æŒ‰ç…§å®é™…ä¸šåŠ¡è¿›è¡Œè®¾è®¡</li></ul><h1>æ•°æ®çš„å¢åˆ æ”¹æŸ¥</h1><h2 id="ç®€å•ç»ƒä¹ CRUD">ç®€å•ç»ƒä¹ CRUD</h2><p>åˆ›å»ºä¸€å¼ æ–°çš„è¡¨ç”¨æ¥è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `T_EMP` (</span><br><span class="line"> `ID` INT(3) AUTO_INCREMENT COMMENT &#x27;ä¸»é”®ID&#x27;,</span><br><span class="line"> `NAME` VARCHAR(15) NOT NULL COMMENT &#x27;å§“å&#x27;,</span><br><span class="line"> `AGE` INT(3) NOT NULL COMMENT &#x27;å¹´é¾„&#x27;,</span><br><span class="line"> `PHONE` CHAR(11) COMMENT &#x27;è”ç³»ç”µè¯&#x27;,</span><br><span class="line"> `SALARY` INT(6) NOT NULL COMMENT &#x27;è–ªæ°´&#x27;,</span><br><span class="line"> `ADDRESS` VARCHAR(128) COMMENT &#x27;å®¶åº­ä½å€&#x27;,</span><br><span class="line"> `ENTER_TIME` DATETIME COMMENT &#x27;å…¥èŒæ—¶é—´&#x27;,</span><br><span class="line">  PRIMARY KEY(`ID`),</span><br><span class="line">  UNIQUE(`PHONE`)</span><br><span class="line">) COMMENT &#x27;å‘˜å·¥è¡¨&#x27;</span><br></pre></td></tr></table></figure><p>è¡¨è‚¯å®šæ˜¯è¦å­˜å‚¨æ•°æ®çš„ï¼Œé‚£ä¹ˆè‚¯å®šå°±è¦æœ‰å¯¹æ•°æ®çš„æ“ä½œäº†ï¼Œè¿™é‡Œç®€å•ç»ƒä¹ å¢åˆ æ”¹æŸ¥ï¼š</p><blockquote><p>æ’å…¥ï¼šINSERT</p></blockquote><p><code>INSERT</code>ä»£è¡¨æ’å…¥ï¼Œ<code>INTO</code>æ’å…¥åˆ°<code>T_EMP</code>è¡¨ï¼Œ<code>VALUES</code>ä»£è¡¨æ’å…¥çš„å…·ä½“çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-- å…¨å­—æ®µæ’å…¥ INSERT INTO è¡¨å VALUES(å€¼1ï¼Œå€¼2...)</span><br><span class="line">INSERT INTO `T_EMP` VALUES(NULL, &#x27;å¼ æ¶µå“²&#x27;, 22, &#x27;13344445555&#x27;, 4000, &#x27;å¤§è¿å¸‚&#x27;, &#x27;2019-11-11 12:00:00&#x27;);</span><br><span class="line"></span><br><span class="line">-- æŒ‰éœ€æ’å…¥ INSERT INTO è¡¨å(å­—æ®µ1ï¼Œå­—æ®µ2) VALUES(å€¼1ï¼Œå€¼2)</span><br><span class="line">INSERT INTO `T_EMP`(`NAME`, `AGE`, `SALARY`) VALUES(&#x27;ä¸èªå&#x27;, 24, 4800);</span><br><span class="line">  </span><br><span class="line">-- æ‰¹é‡æ’å…¥  ...VALUES(å€¼1ï¼Œå€¼2), (å€¼1ï¼Œå€¼2), (å€¼1ï¼Œå€¼2)...</span><br><span class="line">INSERT INTO `T_EMP` VALUES</span><br><span class="line">  (NULL, &#x27;å­™è¶å¦ƒ&#x27;, 19, &#x27;13300000001&#x27;, 3800, &#x27;æ¡‚æ—è¥¿è¡—&#x27;, &#x27;2019-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;è®¸å¨‡ç¿”&#x27;, 31, &#x27;13300000002&#x27;, 5000, &#x27;å¾æ±‡åŒº&#x27;, &#x27;2000-09-14 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;å´”å­å¸Œ&#x27;, 36, &#x27;13300000003&#x27;, 4500, &#x27;æµ¦ä¸œåŒº&#x27;, &#x27;2012-10-21 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;æ¨Šç‘¶èŠ³&#x27;, 28, NULL, 6000, &#x27;è™¹é¹°å¤§å¦&#x27;, &#x27;2020-01-18 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;é˜®æ­ç´&#x27;, 25, &#x27;13300000004&#x27;, 5300, NULL, &#x27;2018-12-25 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;å§šé“ç›Š&#x27;, 39, &#x27;13300000005&#x27;, 13000, &#x27;å¾æ±‡åŒº&#x27;, &#x27;2015-01-01 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;æœ±å’å¨´&#x27;, 52, NULL, 11000, &#x27;æ¡‚æ—è¥¿è¡—&#x27;, &#x27;1999-06-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;éƒ­ç§€æ™¶&#x27;, 46, NULL, 12000, &#x27;æ¡‚æ—è¥¿è¡—&#x27;, &#x27;2008-04-28 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;æˆ´æ•&#x27;, 33, &#x27;13300000006&#x27;, 8300, NULL, &#x27;2018-08-21 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;é©¬åº†ç‚³&#x27;, 19, &#x27;13300000007&#x27;, 4500, &#x27;ä¸‡æ³°å›½é™…&#x27;, &#x27;2021-01-01 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;ä¼å…†æ–Œ&#x27;, 21, NULL, 6000, &#x27;è™¹é¹°å¤§å¦&#x27;, &#x27;2019-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;å¼ æ»•é¾™&#x27;, 47, NULL, 11500, NULL, &#x27;2014-04-30 12:00:00&#x27;)</span><br><span class="line">  (NULL, &#x27;ç‹æ—&#x27;, 20, &#x27;13300000010&#x27;, 7800, &#x27;ç‹å®¶æ‘&#x27;, &#x27;2015-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;èƒ–è™&#x27;, 15, &#x27;13300000011&#x27;, 4300, &#x27;å¹¸ç¦å¤§è¡—&#x27;, &#x27;2015-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;å¼ æ¥šå²š&#x27;, 19, &#x27;13300000012&#x27;, 9300, &#x27;å¼‚äººæ‘&#x27;, &#x27;2015-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;å¼ æ¥šå²š&#x27;, 19, &#x27;13300000013&#x27;, 9300, &#x27;å¼‚äººæ‘&#x27;, &#x27;2015-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;è´¾æ­£ç»&#x27;, 23, NULL, 3800, &#x27;é™•è¥¿&#x27;, &#x27;2015-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;è¢å¤©ç½¡&#x27;, 65, &#x27;13300000014&#x27;, 3800, NULL, &#x27;2015-11-11 12:00:00&#x27;),</span><br><span class="line">  (NULL, &#x27;å¼ è¯‘&#x27;, 36, &#x27;13000000015&#x27;, 13000, &#x27;è˜‘è‡è¡—&#x27;, &#x27;2015-11-11 12:00:00&#x27;);</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢ï¼šSELECT</p></blockquote><p><code>SELECT</code>ä»£è¡¨æŸ¥è¯¢<code>*</code>æ‰€æœ‰å­—æ®µçš„å€¼ï¼Œ<code>FROM</code>ä»<code>T_EMP</code>è¡¨ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œ<code>WHERE</code>ä»£è¡¨è¿‡æ»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢æ‰€æœ‰æ•°æ®</span><br><span class="line">SELECT * FROM `T_EMP`</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢æŸä¸€åˆ—çš„å€¼</span><br><span class="line">SELECT `NAME`, `ADDRESS` FROM `T_EMP`</span><br><span class="line"></span><br><span class="line">-- åˆè¯†WHEREæ¡ä»¶å…³é”®å­—ï¼Œè¿™é‡ŒæŒ‡å®šæŸ¥è¯¢å§“åä¸º&#x27;å´”å­å¸Œ&#x27;çš„å‘˜å·¥</span><br><span class="line">SELECT * FROM `T_EMP` WHERE `NAME` = &#x27;å´”å­å¸Œ&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>æ›´æ–°ï¼šUPDATE</p></blockquote><p><code>UPDATE</code>ä¿®æ”¹<code>T_EMP</code>è¡¨ä¸­çš„<code>set</code>å§“åå“ˆå“ˆå“ˆï¼Œ<code>WHERE</code>è¦æ±‚ä¿®æ”¹IDä¸º7çš„å‘˜å·¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- ä¿®æ”¹æ•°æ®ï¼Œå¦‚æœä¸åŠ åé¢çš„ WHERE å°±ä¼šå°†æ‰€æœ‰è¡Œéƒ½ä¿®æ”¹</span><br><span class="line">UPDATE `T_EMP` SET `NAME` = &#x27;å“ˆå“ˆå“ˆ&#x27; WHERE `ID` = 7</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤ï¼šDELETE</p></blockquote><p><code>DELETE FROM</code>åˆ é™¤<code>T_EMP</code>è¡¨ä¸­çš„æ•°æ®ï¼Œ<code>WHERE</code>è¦æ±‚åˆ é™¤æ•°æ®çš„IDä¸º14</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ é™¤æ•°æ®ï¼Œå¦‚æœä¸åŠ åé¢çš„ WHERE å°±ä¼šå…¨éƒ¨åˆ é™¤ï¼Œè°¨æ…ä½¿ç”¨</span><br><span class="line">DELETE FROM `T_EMP` WHERE `ID` = 14</span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶æŸ¥è¯¢ä¸è¿ç®—ç¬¦">æ¡ä»¶æŸ¥è¯¢ä¸è¿ç®—ç¬¦</h2><blockquote><p>ç®€å•è¿ç®—ç¬¦ä¸»è¦åˆ†ä¸ºä¸¤ç§</p></blockquote><p><strong>æ¯”è¾ƒè¿ç®—ç¬¦ï¼š</strong></p><ul><li>ã€å¤§äº &gt;ã€‘ã€å°äº &lt;ã€‘ã€ç­‰äº =ã€‘ã€å¤§äºç­‰äº &gt;=ã€‘ã€å°äºç­‰äº &lt;=ã€‘ã€ä¸ç­‰äº ( &lt;&gt; æˆ–è€… != ) ã€‘</li></ul><p><strong>é€»è¾‘è¿ç®—ç¬¦ï¼š</strong></p><ul><li>ã€ä¸ ANDã€‘ã€æˆ– ORã€‘ã€é NOTã€‘</li></ul><p>ç‰¹æ®Šè¿ç®—ç¬¦</p><ul><li>æ˜¯å¦ä¸ºç©ºï¼šã€IS NULLã€‘ã€IS NOT NULLã€‘</li><li>åŒ…å«ä»¥ä¸‹ä»»æ„ä¸€ä¸ªå€¼ï¼šIN ( å€¼ï¼Œå€¼ï¼Œå€¼ )<ul><li>åœ¨<code>IN</code>çš„æ‹¬å·ä¸­ä¸ä»…å¯ä»¥ä¹¦å†™ç‰¹å®šçš„å€¼ï¼Œä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ—ä½œä¸ºå‚æ•°ï¼Œè¢«ç§°ä¸ºå­è¡¨æŸ¥è¯¢</li></ul></li><li>æ»¡è¶³åœ¨æŒ‡å®šçš„åŒºé—´å†…ï¼š<code>BETWEEN æœ€å°å€¼ AND æœ€å¤§å€¼</code>;</li></ul><blockquote><p>WHERE æ¡ä»¶è¯­å¥</p></blockquote><p>ä¸Šé¢æœ‰ç”¨åˆ°è¿‡<code>WHERE</code>ï¼Œå¯ä»¥é€šè¿‡<code>WHERE</code>é…åˆè¿ç®—ç¬¦æ¥ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿›è¡Œæ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢IDä¸º1çš„å‘˜å·¥</span><br><span class="line">SELECT * FROM `T_EMP` WHERE `ID` = 1</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢è–ªæ°´ä¸€ä¸‡ä»¥ä¸Šçš„å‘˜å·¥</span><br><span class="line">SELECT * FROM `T_EMP` WHERE `SALARY` &gt; 10000</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢2005å¹´å‰å…¥èŒçš„å‘˜å·¥</span><br><span class="line">SELECT * FROM `T_EMP` WHERE `ENTER_TIME` &lt; &#x27;2005-01-01 00:00:00&#x27;</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢å¹´é¾„å°äº20æˆ–è€…å¤§äº40çš„å‘˜å·¥</span><br><span class="line">SELECT * FROM `T_EMP` WHERE `AGE` &lt; 20 OR `AGE` &gt; 40</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢å¹´é¾„å¤§äº35è–ªæ°´ä½äºä¸€ä¸‡çš„å‘˜å·¥</span><br><span class="line">SELECT * FROM `T_EMP` WHERE `AGE` &gt; 35 AND `SALARY` &lt; 10000</span><br></pre></td></tr></table></figure><h2 id="æ›´å¤šæŸ¥è¯¢æ“ä½œ">æ›´å¤šæŸ¥è¯¢æ“ä½œ</h2><p>ä¸Šé¢æ¥è§¦çš„æ¯”è¾ƒè¿ç®—ç¬¦é…åˆé€»è¾‘è¿ç®—ç¬¦å¯ä»¥å®Œæˆå¤§å¤šæ•°æ“ä½œï¼Œè¿™é‡Œç»§ç»­å­¦ä¹ æ›´å¤šçš„æŸ¥è¯¢æŠ€å·§</p><blockquote><p>IN åŒ…å«</p></blockquote><p>è¦æ±‚æŸ¥è¯¢å´”å­å¸Œï¼Œæœ±å’å¨´ï¼Œé©¬åº†ç‚³ï¼Œè´¾æ­£ç»å››ä¸ªå‘˜å·¥çš„ä¿¡æ¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ORè¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">WHERE</span> `NAME` <span class="operator">=</span> <span class="string">&#x27;å´”å­å¸Œ&#x27;</span></span><br><span class="line">    <span class="keyword">OR</span> `NAME` <span class="operator">=</span> <span class="string">&#x27;æœ±å’å¨´&#x27;</span></span><br><span class="line">    <span class="keyword">OR</span> `NAME` <span class="operator">=</span> <span class="string">&#x27;é©¬åº†ç‚³&#x27;</span></span><br><span class="line">    <span class="keyword">OR</span> `NAME` <span class="operator">=</span> <span class="string">&#x27;è´¾æ­£ç»&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>OR</code>å…³é”®å­—çš„ç¡®å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯ä½¿ç”¨<code>IN</code>çš„è¯å¯ä»¥æå¤§ç®€åŒ–SQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åªè¦NAMEåŒ¹é…æ‹¬å·å†…çš„ä»»æ„ä¸€é¡¹éƒ½å¯ä»¥æŸ¥è¯¢åˆ°</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">WHERE</span> `NAME` <span class="keyword">IN</span> (<span class="string">&#x27;å´”å­å¸Œ&#x27;</span>, <span class="string">&#x27;æœ±å’å¨´&#x27;</span>, <span class="string">&#x27;é©¬åº†ç‚³&#x27;</span>, <span class="string">&#x27;è´¾æ­£ç»&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>AS åˆ«å</p></blockquote><p>æœ‰äº›æ—¶å€™è¡¨ä¸­çš„åˆ—è¿‡å¤šå¯èƒ½ä¼šé€ æˆæŸ¥çœ‹å¤±è¯¯ï¼Œé’ˆå¯¹è¿™ç‚¹å¯ä»¥å¯¹æ¯åˆ—åœ¨æŸ¥è¯¢æ˜¯èµ·ä¸€ä¸ªåˆ«åï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ­£å¸¸æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  `ID`,</span><br><span class="line">  `NAME`,</span><br><span class="line">  `AGE`,</span><br><span class="line">  `PHONE`,</span><br><span class="line">  `SALARY`,</span><br><span class="line">  `ADDRESS`,</span><br><span class="line">  `ENTER_TIME`</span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ«åæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  `ID` <span class="keyword">AS</span> <span class="string">&#x27;ç¼–å·&#x27;</span>,</span><br><span class="line">  `NAME` <span class="keyword">AS</span> <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">  `AGE` <span class="keyword">AS</span> <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">  `PHONE` <span class="keyword">AS</span> <span class="string">&#x27;ç”µè¯&#x27;</span>,</span><br><span class="line">  `SALARY` <span class="keyword">AS</span> <span class="string">&#x27;è–ªæ°´&#x27;</span>,</span><br><span class="line">  `ADDRESS` <span class="keyword">AS</span> <span class="string">&#x27;ä½å€&#x27;</span>,</span><br><span class="line">  `ENTER_TIME` <span class="keyword">AS</span> <span class="string">&#x27;å…¥èŒæ—¥æœŸ&#x27;</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  </span><br><span class="line"><span class="comment">-- ä¸€èˆ¬æƒ…å†µä¸‹ASå…³é”®å­—å¯ä»¥çœç•¥ä¸å†™ï¼Œä¾‹å¦‚</span></span><br><span class="line"><span class="keyword">SELECT</span> `ID` <span class="keyword">AS</span> <span class="string">&#x27;ç¼–å·&#x27;</span></span><br><span class="line"><span class="comment">-- å¯ä»¥ç®€å†™ä¸º</span></span><br><span class="line"><span class="keyword">SELECT</span> `ID` <span class="string">&#x27;ç¼–å·&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>BETWEEN  AND åŒºé—´</p></blockquote><p>æŸ¥è¯¢å¹´é¾„åœ¨20åˆ°50ä¹‹å‰çš„å‘˜å·¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸€èˆ¬å†™æ³•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">WHERE</span> `AGE` <span class="operator">&gt;=</span> <span class="number">20</span></span><br><span class="line">    <span class="keyword">AND</span> `AGE` <span class="operator">&lt;=</span> <span class="number">50</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">-- åŒºé—´å†™æ³•ï¼Œä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">WHERE</span> `AGE` <span class="keyword">BETWEEN</span> <span class="number">20</span> <span class="keyword">AND</span> <span class="number">50</span></span><br></pre></td></tr></table></figure><blockquote><p>LIKE æ¨¡ç³ŠæŸ¥è¯¢</p></blockquote><p>æ¨¡ç³ŠæŸ¥è¯¢ï¼Œé¡¾åæ€ä¹‰ï¼Œåˆ—ä¸­æœ‰éƒ¨åˆ†åŒ¹é…çš„å†…å®¹å°±å¯ä»¥æŸ¥è¯¢çš„åˆ°ï¼Œæ¨¡ç³ŠæŸ¥è¯¢éœ€è¦é…åˆé€šé…ç¬¦ä½¿ç”¨ï¼Œå¦åˆ™ä¸èµ·æ•ˆæœï¼ŒMySQLä¸­é’ˆå¯¹æ¨¡ç³ŠæŸ¥è¯¢æœ‰ä¸¤ä¸ªé€šé…ç¬¦ï¼š</p><ul><li><code>_</code>ï¼šä¸‹åˆ’çº¿ï¼ŒåªåŒ¹é…ä¸€ä¸ªå­—ç¬¦</li><li><code>%</code>ï¼šç™¾åˆ†å·ï¼ŒåŒ¹é…å¤šä¸ªå­—ç¬¦</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ¨¡ç³ŠæŸ¥è¯¢_  æ‰¾åˆ°ä»¥&quot;å¼ &quot;å¼€å¤´çš„å§“åä¸ºä¸¤ä¸ªå­—çš„å‘˜å·¥</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">WHERE</span> `NAME` <span class="keyword">LIKE</span> <span class="string">&#x27;å¼ _&#x27;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">-- æ¨¡ç³ŠæŸ¥è¯¢% æ‰¾åˆ°æ‰€æœ‰å§“åä»¥&quot;å¼ &quot;å¼€å¤´çš„å‘˜å·¥</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">WHERE</span> `NAME` <span class="keyword">LIKE</span> <span class="string">&#x27;å¼ %&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>DISTINCTï¼šå»é‡ ( äº†è§£ )</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„å§“å</span></span><br><span class="line"><span class="keyword">SELECT</span> `NAME` <span class="keyword">FROM</span> `T_EMP`</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°äº†åœ¨å‘˜å·¥è¡¨ä¸­æœ‰ä¸¤ä¸ªå¼ æ¥šå²šï¼Œè¿™é‡Œå¯ä»¥é’ˆå¯¹é‡å¤æ•°æ®è¿›è¡Œå»é‡æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨æŸ¥è¯¢çš„å­—æ®µ`NAME`å‰åŠ ä¸Šå…³é”®å­—ï¼Œä»£è¡¨æ ¹æ®è¿™ä¸ªå­—æ®µè¿›è¡Œå»é‡</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> `NAME` <span class="keyword">FROM</span> `T_EMP`</span><br></pre></td></tr></table></figure><p>è¿™å›å°±å¯ä»¥çœ‹å‡ºé‡å¤æ•°æ®å·²ç»ä¸è§äº†ï¼Œä½†æ˜¯åªæŸ¥è¯¢å‡ºäº†å§“åä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæœ€èµ·ç è¦ä¸IDä¸€åŒæŸ¥å‡ºæ¥æ‰å¯ä»¥ï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> `NAME`, `ID` <span class="keyword">FROM</span> `T_EMP`</span><br></pre></td></tr></table></figure><p>å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼ŒIDåˆ—çš„ç¡®æŸ¥è¯¢å‡ºæ¥äº†ï¼Œä½†æ˜¯å»é‡æ•ˆæœå´æ¶ˆå¤±äº†ï¼Œè¿™æ˜¯å› ä¸ºæŒ‰ç…§ä¸Šè¿°å†™æ³•ï¼Œé¦–å…ˆæ ¹æ®å§“åè¿›è¡Œåˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œç„¶åæ‰¾åˆ°å§“åé‡å¤çš„è¡Œå†æ ¹æ®IDè¿›è¡Œåˆ¤æ–­ï¼ŒIDä¸é‡å¤å°±ä»£è¡¨æ•°æ®æ²¡æœ‰é‡å¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é‚£ä¹ˆæˆ‘ä»¬å°è¯•ä¸€ä¸‹æŠŠIDæ”¾åœ¨å»é‡å‰é¢è¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> `ID`, <span class="keyword">DISTINCT</span> `NAME` <span class="keyword">FROM</span> `T_EMP`</span><br></pre></td></tr></table></figure><p>è¿™å›æ›´ç³Ÿç³•ï¼ŒSQLç›´æ¥æŠ¥é”™äº†ï¼Œå› ä¸ºä½¿ç”¨<code>DISTINCT</code>å°±å¿…é¡»æ”¾åœ¨æŸ¥è¯¢å¼€å¤´ï¼Œæ‰€ä»¥<code>DISTINCT</code>ä¸€èˆ¬ä¸ç”¨åšçœŸæ­£çš„å»é‡ï¼Œå¯ä»¥æ ¹æ®ä»–æŸ¥è¯¢ä¸é‡å¤æ•°æ®çš„æ•°é‡ï¼Œå¦‚ä½•è¿›è¡Œå»é‡æ“ä½œä¹Ÿä¼šåœ¨åé¢åœ¨æåˆ°</p><blockquote><p>NULLå€¼æ“ä½œ</p></blockquote><p>å¦‚æœå®ç°æŸ¥è¯¢æ‰€æœ‰æ²¡æœ‰ç•™ä¸‹æ‰‹æœºå·çš„å‘˜å·¥ï¼ŒSQLåº”è¯¥è¿™ä¹ˆå†™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `T_EMP` <span class="keyword">WHERE</span> `PHONE` <span class="operator">=</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure><p>å¯å®é™…æ•ˆæœå´æ˜¯ä¸€æ¡éƒ½æŸ¥ä¸å‡ºæ¥ï¼Œé‚£æ˜¯å› ä¸º<em>NULLå€¼æ˜¯ä¸å‚ä¸è¿ç®—</em>çš„ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨<code>IS NULL</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `T_EMP` <span class="keyword">WHERE</span> `PHONE` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³æŸ¥æ‰€æœ‰ç•™äº†æ‰‹æœºå·çš„å‘˜å·¥å‘¢ï¼Ÿä¹‹å‰é€»è¾‘è¿ç®—ä¸­æ¥è§¦çš„<code>NOT</code>å°±ç”¨ä¸Šäº†ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å–å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `T_EMP` <span class="keyword">WHERE</span> `PHONE` <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure><h2 id="æ’åºä¸åˆ†é¡µ">æ’åºä¸åˆ†é¡µ</h2><p>æˆ‘ä»¬åœ¨ç½‘é¡µä¸Šæ“ä½œä¸€äº›è¡¨æ ¼æ•°æ®çš„æ—¶å€™è‚¯å®šä½¿ç”¨è¿‡æ’åºå’Œåˆ†é¡µçš„åŠŸèƒ½ï¼Œè¿™äº›éƒ½æ˜¯å‰ç«¯å‘èµ·çš„è¯·æ±‚æœ€ç»ˆç§»äº¤åˆ°æ•°æ®åº“è¿›è¡Œå¤„ç†çš„ï¼Œè¿™é‡Œå°±å­¦ä¹ ä¸€ä¸‹æ’åºä¸åˆ†é¡µ</p><blockquote><p>ORDER BYï¼šæ’åº</p></blockquote><p>æ’åºæœ‰ä¸¤ç§è§„åˆ™ï¼Œä¸€ç§æ˜¯å‡åºï¼Œä¸€ç§æ˜¯é™åºï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸¤ä¸ªå…³é”®å­—ï¼š</p><ul><li><code>ASC</code>ï¼šå‡åºï¼Œé¦–è¡Œå€¼æœ€å°ï¼Œæœ«è¡Œå€¼æœ€å¤§</li><li><code>DESC</code>ï¼šé™åºï¼Œé¦–è¡Œå€¼æœ€æ‰“ï¼Œæœ«è¡Œå€¼æœ€å°</li></ul><p><code>ORDER BY</code>æ’åºï¼Œæ ¹æ®<code>SALARY</code>å­—æ®µè¿›è¡Œ<code>ASC</code>å‡åºæ’åº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ ¹æ®è–ªæ°´å‡åºæ’åº</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> `SALARY` <span class="comment">-- ASC</span></span><br></pre></td></tr></table></figure><p><code>ASC</code>å‡åºæ’åºæ˜¯é»˜è®¤æ’åºè§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥ä¸å†™ï¼Œå¦‚æœæƒ³å€’æ’çš„è¯å°±éœ€è¦å†™<code>DESC</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ ¹æ®è–ªæ°´å€’å™æ’åº</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> `SALARY` <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å¤šåˆ—åŒæ—¶æ’åºï¼Œæ¯ä¸ªæ’åºè§„åˆ™ç”¨é€—å·éš”å¼€ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ®µSQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å…ˆæŒ‰ç…§è–ªæ°´è¿›è¡Œé™åºæ’åºï¼Œè–ªæ°´ç›¸åŒçš„æŒ‰ç…§å¹´é¾„å¹´é¾„è¿›è¡Œå‡åºæ’åº</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    `SALARY` <span class="keyword">DESC</span>,</span><br><span class="line">    `AGE` <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure><blockquote><p>LIMITï¼šåˆ†é¡µ</p></blockquote><p>MySQLä¸­åˆ†é¡µä½¿ç”¨çš„å…³é”®å­—ä¸º<code>LIMIT</code>ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä»ç¬¬0ä¸ªå¼€å§‹ï¼ŒæŸ¥è¯¢5æ¡æ•°æ®ï¼Œä¸ºç¬¬ä¸€é¡µ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  LIMIT <span class="number">0</span>, <span class="number">5</span></span><br><span class="line"><span class="comment">-- ä»ç¬¬5ä¸ªå¼€å§‹ï¼ŒæŸ¥è¯¢5æ¡æ•°æ®ï¼Œä¸ºç¬¬äºŒé¡µ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  LIMIT <span class="number">5</span>, <span class="number">5</span></span><br></pre></td></tr></table></figure><p><code>LIMIT</code>åé¢ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»ç¬¬å‡ æ¡å¼€å§‹æŸ¥ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æŸ¥è¯¢å¤šå°‘ä¸ªæ•°æ®ï¼ŒæŒ‰ç…§åˆ†é¡µçš„é€»è¾‘åªéœ€è¦ä¼ å…¥é¡µç å’ŒæŸ¥è¯¢æ•°é‡å°±å¯å®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œé‚£ä¹ˆSQLåº”è¯¥ä¿®æ”¹ä¸ºä¸‹é¢è¿™ç§å†™æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- pageNumï¼ŒpageSizeä¸ºç¨‹åºä¼ è¿‡æ¥çš„å‚æ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  <span class="comment">-- è®¡ç®—çš„æ­¥éª¤åº”è¯¥äº¤ç»™Javaå¤„ç†ï¼ŒSQLè¿™è¾¹åªéœ€è¦è·å–åˆ°å€¼å°±å¯ä»¥äº†</span></span><br><span class="line">  LIMIT (pageNum <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> pageSize, pageSize</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ï¼šæŸ¥è¯¢ç¬¬äºŒé¡µï¼Œæ¯é¡µæ˜¾ç¤º6æ¡ï¼Œå°±åº”è¯¥å†™</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> `T_EMP`</span><br><span class="line">  LIMIT <span class="number">6</span>, <span class="number">6</span></span><br></pre></td></tr></table></figure><h1>å‡½æ•°ç›¸å…³æ“ä½œ</h1><p>å…ˆæ”¾ä¸€æ®µè½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">èšåˆå‡½æ•°</span><br><span class="line">--------------------------------</span><br><span class="line">è®¡æ•°ï¼šCOUNT()</span><br><span class="line">æ±‚å’Œï¼šSUM()</span><br><span class="line">å¹³å‡å€¼ï¼šAVG()</span><br><span class="line">æœ€å¤§å€¼ï¼šMAX()</span><br><span class="line">æœ€å°å€¼ï¼šMIN()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ•°å­¦å‡½æ•°</span><br><span class="line">--------------------------------</span><br><span class="line">ç»å¯¹å€¼ï¼šABS()</span><br><span class="line">å‘ä¸Šå–æ•´ï¼šCEILING()</span><br><span class="line">å‘ä¸‹å–è¯ï¼šFLOOR()</span><br><span class="line">0~1éšæœºæ•°ï¼šRAND()</span><br><span class="line">åˆ¤æ–­ç¬¦å·ï¼šSIGN() è´Ÿæ•°è¿”å›-1ï¼Œæ­£æ•°è¿”å›1ï¼Œ0è¿”å›0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å­—ç¬¦ä¸²å‡½æ•°</span><br><span class="line">--------------------------------</span><br><span class="line">å­—ç¬¦ä¸²é•¿åº¦ï¼šCHAR_LENGTH()</span><br><span class="line">å­—ç¬¦ä¸²æ‹¼æ¥ï¼šCONCAT(...)</span><br><span class="line">å…¨éƒ¨è½¬å¤§å†™ï¼šUPPER()</span><br><span class="line">å…¨éƒ¨è½¬å°å†™ï¼šLOWER()</span><br><span class="line">å­—ç¬¦ä¸²æ›¿æ¢ï¼šREPLACE(str, source, target)</span><br><span class="line">æˆªå–å­—ç¬¦ä¸²ï¼šSUBSTR()</span><br><span class="line">å­—ç¬¦ä¸²ç¿»è½¬ï¼šREVERSE()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ—¶é—´å‡½æ•°</span><br><span class="line">--------------------------------</span><br><span class="line">è·å–å½“å‰æ—¥æœŸï¼šCURRENT_DATE()</span><br><span class="line">è·å–å½“å‰æ—¶é—´ï¼šCURRENT_TIME()</span><br><span class="line">è·å–æ—¥æœŸæ—¶é—´ï¼šNOW()</span><br></pre></td></tr></table></figure><h2 id="èšåˆå‡½æ•°">èšåˆå‡½æ•°</h2><h2 id="åˆ†ç»„ä¸åˆ†ç»„å‡½æ•°">åˆ†ç»„ä¸åˆ†ç»„å‡½æ•°</h2><h2 id="å…¶ä»–å¸¸ç”¨å‡½æ•°">å…¶ä»–å¸¸ç”¨å‡½æ•°</h2><h3 id="æ•°å­¦å‡½æ•°">æ•°å­¦å‡½æ•°</h3><h3 id="å­—ç¬¦ä¸²å‡½æ•°">å­—ç¬¦ä¸²å‡½æ•°</h3><h3 id="æ—¶é—´å‡½æ•°">æ—¶é—´å‡½æ•°</h3><h1>å¤šè¡¨é“¾æ¥æŸ¥è¯¢</h1><h1>MySQLçš„äº‹åŠ¡</h1><h1>è§†å›¾ä¸ç´¢å¼•</h1><h1>ç”¨æˆ·æƒé™ç®¡ç†</h1>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2022/06/01/hello-world/"/>
    <url>/2022/06/01/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start">Quick Start</h2><h3 id="Create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>demo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatis-Plus å­¦ä¹ ç¬”è®°</title>
    <link href="/2022/05/23/MyBatis-Plus%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/05/23/MyBatis-Plus%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>MyBatis-Plus å­¦ä¹ ç¬”è®°</h1><p>MyBatis-Plus ( ç®€ç§° MP ) æ˜¯ä¸€æ¬¾åŸºäº MyBatis çš„å¢å¼ºå·¥å…·ï¼Œä»–å¹¶ä¸æ˜¯ç”±å®˜æ–¹æä¾›ï¼Œè€Œæ˜¯ç”±ä¸ªäººå¼€å‘å‡ºæ¥çš„ä¸€æ¬¾å¢å¼ºæ¡†æ¶ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿï¼Œåé¢ mybatis-plus ä¼šç®€ç§°ä¸º MP</p><blockquote><p>å®˜æ–¹è‡ªè¿°</p></blockquote><ul><li><strong>æ— ä¾µå…¥</strong>ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘</li><li><strong>æŸè€—å°</strong>ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ</li><li><strong>å¼ºå¤§çš„ CRUD æ“ä½œ</strong>ï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚</li><li><strong>æ”¯æŒ Lambda å½¢å¼è°ƒç”¨</strong>ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™</li><li><strong>æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ</strong>ï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜</li><li><strong>æ”¯æŒ ActiveRecord æ¨¡å¼</strong>ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ</li><li><strong>æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œ</strong>ï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰</li><li><strong>å†…ç½®ä»£ç ç”Ÿæˆå™¨</strong>ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨</li><li><strong>å†…ç½®åˆ†é¡µæ’ä»¶</strong>ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢</li><li><strong>åˆ†é¡µæ’ä»¶æ”¯æŒå¤šç§æ•°æ®åº“</strong>ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer ç­‰å¤šç§æ•°æ®åº“</li><li><strong>å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶</strong>ï¼šå¯è¾“å‡º Sql è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢</li><li><strong>å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶</strong>ï¼šæä¾›å…¨è¡¨ delete ã€ update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ</li></ul><h2 id="å¿«é€Ÿå…¥é—¨åˆä½“éªŒ">å¿«é€Ÿå…¥é—¨åˆä½“éªŒ</h2><p>è·Ÿç€å®˜æ–¹æ–‡æ¡£è¿›è¡Œä¸€æ¬¡ MP çš„å¿«é€Ÿå…¥é—¨ä½“éªŒï¼š</p><blockquote><p>å‰ç½®æ¡ä»¶å‡†å¤‡</p></blockquote><p>**1.**åˆ›å»ºæ•°æ®åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆå§‹åŒ–æµ‹è¯•</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">USER</span>`;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> T_USER;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">USER</span>`(</span><br><span class="line">  ID <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `NAME` <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">  AGE <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">  EMAIL <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‚®ç®±&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">USER</span>`(ID, `NAME`, AGE, EMAIL) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@qq.com&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;ç‹å¯Œè´µ&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@qq.com&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;è€å…«&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@qq.com&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;é©¬äº‘&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@qq.com&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;ç‹å¥æ—&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@qq.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æµ‹è¯•è¡¨åç§°ç»‘å®š</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> <span class="keyword">USER</span> <span class="keyword">TO</span> T_USER;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è‡ªåŠ¨å¡«å……ç»ƒä¹ </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> T_USER <span class="keyword">ADD</span> CREATE_TIME DATETIME <span class="keyword">DEFAULT</span> NOW();</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> T_USER <span class="keyword">ADD</span> CHANGE_TIME DATETIME <span class="keyword">DEFAULT</span> NOW();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¹è§‚é”ç»ƒä¹ </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> T_USER <span class="keyword">ADD</span> VERSION <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é€»è¾‘åˆ é™¤ç»ƒä¹ </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> T_USER <span class="keyword">ADD</span> DELETED <span class="type">INT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>**2.**å¿«é€Ÿåˆ›å»ºä¸€ä¸ª springboot çš„ç¨‹åºå¼•å…¥ç›¸å…³çš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mavenä¾èµ–å¼•å…¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis-plusä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>**3.**é…ç½®æ•°æ®åº“è¿æ¥</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql:///zhe</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">******</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé…ç½®äº†æ—¥å¿—è¾“å…¥ï¼Œæ–¹ä¾¿æ—¥åè§‚å¯Ÿ</span></span><br><span class="line"><span class="attr">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><blockquote><p>å¼€å§‹ç¼–ç </p></blockquote><p>åœ¨æˆ‘ä»¬æŠŠæ•°æ®åº“ä»¥åŠç¨‹åºéƒ½å¸ƒç½®å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å°è¯•åšä¸€æ¬¡ç®€å•çš„æŸ¥è¯¢ï¼š</p><p>**1.**åˆ›å»ºå®ä½“ç±»ä»¥åŠ dao æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ•°æ®è¡¨å¯¹åº”çš„å®ä½“ç±»</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**2.**åˆ›å»º dao æ¥å£ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ <font color="red">æ¥å£ç±»éœ€è¦ç»§æ‰¿ <code>BaseMapper</code> æŠ½è±¡ç±»å¹¶å¡«å†™å®ä½“ç±»å¯¹åº”æ³›å‹</font>ï¼Œç„¶åå°±ä¸ç”¨ç®¡äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºdaoæ¥å£</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123; &#125;</span><br></pre></td></tr></table></figure><p>**3.**æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æµ‹è¯•ç±»ä¸­ä¹¦å†™ä»£ç å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01MybatisPlusApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">  ud.selectList(<span class="literal">null</span>).forEach( item-&gt;System.out.println(item) );</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å°±è¿™ä¹ˆç®€å•çš„å®Œæˆäº†ï¼</p><h2 id="å¿«é€ŸCRUDç»ƒä¹ ">å¿«é€ŸCRUDç»ƒä¹ </h2><blockquote><p>insert æ’å…¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿«é€Ÿæ’å…¥ä¸€æ¡æ•°æ®</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01Test</span> &#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">      user.setName(<span class="string">&quot;å¼ æ¶µå“²&quot;</span>);</span><br><span class="line">      user.setAge(<span class="number">50</span>);</span><br><span class="line">      user.setEmail(<span class="string">&quot;zhang_hanzhe@qq.com&quot;</span>);</span><br><span class="line">      ud.insert(user);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>update æ›´æ–°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿«é€Ÿæ›´æ–°ä¸€æ¡æ•°æ®</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01Test</span> &#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">      user.setName(<span class="string">&quot;å¼ æ¶µå“²&quot;</span>);</span><br><span class="line">      user.setAge(<span class="number">21</span>);</span><br><span class="line">      user.setEmail(<span class="string">&quot;zhang_hanzhe@qq.com&quot;</span>);</span><br><span class="line">      ud.updateById(user);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>delete åˆ é™¤</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01Test</span> &#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// æ ¹æ®IDåˆ é™¤</span></span><br><span class="line">      ud.deleteById(<span class="number">1</span>);</span><br><span class="line">      <span class="comment">// æ ¹æ®IDåˆ é™¤å¤šä¸ª</span></span><br><span class="line">      ud.deleteBatchIds(Arrays.asList(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">      <span class="comment">// æ ¹æ®æ¡ä»¶åˆ é™¤</span></span><br><span class="line">      HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">      map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å¼ æ¶µå“²&quot;</span>);</span><br><span class="line">      ud.deleteByMap(map);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>select æŸ¥è¯¢</p></blockquote><p>ç”±äºåˆšåˆšçš„æµ‹è¯•å°†æ•°æ®éƒ½åˆ å…‰äº†ï¼Œè¿™é‡Œå»ºè®®åœ¨æ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–çš„ SQL é‡ç½®ä¸€ä¸‹æ•°æ®ï¼Œç„¶ååœ¨è·Ÿç€æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01Test</span> &#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// æ ¹æ®IDæŸ¥è¯¢</span></span><br><span class="line">      System.out.println(ud.selectById(<span class="number">1L</span>));</span><br><span class="line">      <span class="comment">// æ ¹æ®æŒ‡å®šIDæŸ¥è¯¢å¤šä¸ª</span></span><br><span class="line">      System.out.println(ud.selectBatchIds(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)));</span><br><span class="line">      <span class="comment">// æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line">      System.out.println(ud.selectList(<span class="literal">null</span>));</span><br><span class="line">      <span class="comment">// æ ¹æ®æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line">      HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">      map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;è€å…«&quot;</span>);</span><br><span class="line">      System.out.println(ud.selectByMap(map));</span><br><span class="line">      <span class="comment">// æŸ¥è¯¢æ€»è®°å½•æ•°</span></span><br><span class="line">      System.out.println(ud.selectCount(<span class="literal">null</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ³¨è§£å­¦ä¹ ">å¸¸ç”¨æ³¨è§£å­¦ä¹ </h2><h3 id="TableNameæ³¨è§£">TableNameæ³¨è§£</h3><p>åˆšåˆšæˆ‘ä»¬å¿«é€Ÿè¿‡äº†ä¸€é CRUDï¼Œè¡¨åå’Œå®ä½“ç±»æ˜¯å¯¹åº”çš„ï¼Œå¦‚æœæˆ‘ä»¬ç¨ä½œä¿®æ”¹çš„è¯å†æ¥å°è¯•ä¸€ä¸‹ï¼š</p><ul><li>è¡¨åï¼š<code>T_USER</code>ï¼Œå®ä½“ç±»åï¼š<code>UserEntity</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.jdbc.BadSqlGrammarException: </span><br><span class="line">### Error querying database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQ                                                                LSyntaxErrorException: Table &#x27;zhe.user_entity&#x27; doesn&#x27;t exist</span><br><span class="line">### The error may exist in site/hanzhe/dao/UserDao.java (best guess)</span><br><span class="line">### The error may involve defaultParameterMap</span><br><span class="line">### The error occurred while setting parameters</span><br><span class="line">### SQL: SELECT  id,name,age,email  FROM user_entity</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥å‘ç°ç¨‹åºæŠ¥é”™äº†ï¼Œå› ä¸ºä»–çš„ SQL æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„è¡¨æ˜é»˜è®¤æŒ‰ç…§å®ä½“ç±»çš„é©¼å³°è½¬ä¸‹åˆ’çº¿å®Œæˆçš„ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦ä½¿ç”¨ <code>@TableName</code> æ¥é‡æ–°é…ç½®ä¸€ä¸‹äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;T_USER&quot;)</span> <span class="comment">// é»˜è®¤å±æ€§å°±æ˜¯è¡¨åç§°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æˆåŠŸï¼è¯¥æ³¨è§£ä¸»è¦ç”¨äºå®ä½“ç±»å’Œè¡¨åç§°çš„ç»‘å®šï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰å…¶ä»–åŠŸèƒ½ä½†å¹¶ä¸å¸¸ç”¨ï¼Œå¦‚æœ‰éœ€è¦å»æŸ¥å®˜æ–¹æ–‡æ¡£</p><h3 id="TableId-ä¸»é”®æ³¨è§£">TableId ä¸»é”®æ³¨è§£</h3><p>ä»”ç»†çœ‹ä¹‹å‰çš„æ’å…¥è¯­å¥ä¼šå‘ç°æœ‰ä¸€ä¸ªç»†èŠ‚ï¼š==æˆ‘ä»¬å¹¶æ²¡æœ‰ä¸ºè¿™ä¸ªå¯¹è±¡è®¾ç½® IDï¼Œä½†æ˜¯æ•°æ®åº“ä¸­å´å­˜è¿›å»äº† ID==ï¼Œè¿™æ˜¯å› ä¸º MP ä¼šå¯¹è¡¨ä¸­çš„ä¸»é”®è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª IDï¼Œå…³äºä¸»é”®è‡ªåŠ¨å¡«å……æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ <code>@TableId</code> ä¸»é”®æ³¨è§£</p><p><code>@TableId</code> é»˜è®¤ <code>value</code> å¯¹åº”çš„æ˜¯ä¸»é”®å­—æ®µåç§°ï¼Œç¬¬äºŒä¸ª<code>type</code> æ˜¯æšä¸¾ç±»å‹ï¼Œç”¨æ¥ä¿®æ”¹è‡ªåŠ¨ç”Ÿæˆç±»å‹ï¼š</p><ul><li><code>IdType.AUTO</code>ï¼šå¯¹åº”æ•°æ®åº“ä¸­çš„è‡ªå¢</li><li><code>IdType.NONE</code>ï¼šä¸å¯¹ä¸»é”®è¿›è¡Œä»»ä½•å¤„ç†</li><li><code>IdType.INTUT</code>ï¼šæˆ‘ä»¬åœ¨æ‰§è¡Œæ’å…¥ä¹‹å‰æ‰‹åŠ¨è®¾ç½®å€¼</li><li><code>IdType.ASSIGN_ID</code>ï¼šä½¿ç”¨<strong>é›ªèŠ±ç®—æ³•</strong>è®¡ç®— ID</li><li><code>IdType.ASSIGN_UUID</code>ï¼šåˆ†é… UUID</li></ul><blockquote><p>ä¿®æ”¹è‡ªåŠ¨ç”Ÿæˆç±»å‹</p></blockquote><p>==ä½¿ç”¨ AUTO ç±»å‹å¿…é¡»å°†æ•°æ®åº“ä¸­çš„è‡ªå¢å¼€å¯==ï¼Œå‰©ä¸‹çš„ç±»å‹å¦‚æ³•ç‚®åˆ¶ï¼Œå°±ä¸å†™äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;T_USER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œä¿®æ”¹äº†å˜é‡åä¸º aaaï¼Œä½†æ˜¯é€šè¿‡valueç»‘å®šäº†æ•°æ®ä¸­çš„å­—æ®µåï¼Œæ‰€ä»¥ä¸ä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;ID&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long aaa;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TableField-éä¸»é”®æ³¨è§£">TableField éä¸»é”®æ³¨è§£</h3><p>æ—¢ç„¶ç”±ä¸»é”®æ³¨è§£ï¼Œå½“ç„¶ä¹Ÿå°±æœ‰éä¸»é”®æ³¨è§£ <code>@TableField</code>ï¼Œä¸€èˆ¬ç”¨æ¥ç»‘å®šåº“å†…çš„å­—æ®µåï¼Œè¿˜å¯ä»¥è¿›è¡Œä¸€äº›é«˜çº§æ“ä½œ</p><blockquote><p>è‡ªåŠ¨å¡«å……</p></blockquote><p>åœ¨æˆ‘ä»¬åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œæœ‰çš„è¡¨ä¼šæ¶‰åŠåˆ°æ—¶é—´åˆ—ï¼ŒåŒ…å«åˆ›å»ºæ—¶é—´ä»¥åŠä¿®æ”¹æ—¶é—´ï¼Œè¿™ä¸¤ä¸ªæˆ‘ä»¬å¯ä»¥é€šè¿‡ SQL å†™æ­»ï¼Œä¹Ÿå¯ä»¥åœ¨ java ä¸­åˆ›å»ºä¸€ä¸ª Date å®ä¾‹ä¸¢ç»™ä»–ï¼Œå­¦ä¹ äº† MP ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è‡ªåŠ¨å¡«å……äº† ( è‡ªå·±åˆ›å»ºå¥½ä¸¤ä¸ªåˆ— )ï¼š</p><p><strong>1.</strong><code>TableField</code> æ³¨è§£ä¸­çš„ <code>fill</code> è¡¨ç¤ºè‡ªåŠ¨å¡«å……ï¼Œä½¿ç”¨è‡ªåŠ¨å¡«å……ä¸€å®šè¦çŸ¥é“ä»€ä¹ˆæƒ…å†µä¸‹è¢«å¡«å……ï¼Œå¡«å……çš„å†…å®¹æ˜¯ä»€ä¹ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ä½“ç±»é…ç½®</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;T_USER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span>&#123;</span><br><span class="line"> ......</span><br><span class="line">    <span class="comment">// FieldFill.INSERT: åªæœ‰åœ¨æ’å…¥çš„æ—¶å€™å¡«å……</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// FieldFill.INSERT_UPDATE: æ’å…¥å’Œä¿®æ”¹çš„æ—¶å€™éƒ½å¡«å……</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date changeTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**2.**å®ä½“ç±»é…ç½®å¥½è‡ªåŠ¨å¡«å……æ—¶æœºæ—¶å€™ï¼Œæˆ‘ä»¬è¿˜è¦é…ç½®ä¸€ä¸‹è‡ªåŠ¨å¡«å……çš„å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨é…ç½®ç±»ä¸­é…ç½®è‡ªåŠ¨å¡«å……å†…å®¹</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FillConfig</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="comment">// ä¹¦å†™è§„åˆ™ï¼šç¬¬ä¸€ä¸ªå†™æ­»ï¼Œç¬¬äºŒä¸ªä¸ºå¡«å……çš„ç›®æ ‡å˜é‡åï¼Œç¬¬ä¸‰ä¸ªä¸ºå¡«å……ç±»å‹ï¼Œç¬¬å››ä¸ªæ˜¯å¯¹åº”çš„å€¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>   <span class="comment">// æ’å…¥çº§åˆ«é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="comment">// INSERT</span></span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, Date.class, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">// INSERT_UPDATE</span></span><br><span class="line">        <span class="built_in">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;changeTime&quot;</span>, Date.class, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// æ›´æ–°çº§åˆ«é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="comment">// UPDATE</span></span><br><span class="line">        <span class="built_in">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;changeTime&quot;</span>, Date.class, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éè¡¨ä¸­å­—æ®µ</p></blockquote><p>å®ä½“ç±»ä¸­å¹¶ä¸æ˜¯æ¯ä¸ªå±æ€§éƒ½æ˜¯è¡¨ä¸­çš„å­—æ®µï¼Œä¾‹å¦‚è¡¨ä¸­çš„æ€§åˆ«å­—æ®µï¼Œ1ä»£è¡¨ç”·ï¼Œ0ä»£è¡¨å¥³ï¼ŒåŒºåˆ†èµ·æ¥å°±å¾ˆéº»çƒ¦ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦åœ¨ç±»ä¸­å®šä¹‰ä¸¤ä¸ªå¸¸é‡ï¼Œå†å‘Šè¯‰ MP è¿™ä¸æ˜¯è¡¨ä¸­çš„å­—æ®µï¼Œå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;T_USER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span>&#123;</span><br><span class="line">    <span class="meta">@TableId(value = &quot;ID&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long aaa;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MALE</span> <span class="operator">=</span> <span class="number">1</span>;   <span class="comment">// ç”·</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FEMALE</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å¥³</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Version-ä¹è§‚é”">Version ä¹è§‚é”</h3><p>æ‰€è°“ä¹è§‚é”å°±æ˜¯åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€ä¸ªåˆ—ä½œä¸ºæ ‡è¯†åˆ—ï¼Œä¸€èˆ¬ä¸º versionï¼Œåœ¨è¿›è¡Œ upd ate ä¹‹å‰å…ˆè¿›è¡Œ select æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥è¯¢çš„ version å’Œæ›´æ–°æ—¶çš„ version æ˜¯ä¸€è‡´çš„å°±è¯æ˜æ²¡äººæ“ä½œè¿‡è¿™è¡Œè®°å½•ï¼Œé‚£ä¹ˆå°±è¿›è¡Œä¿®æ”¹ï¼Œå¹¶ä¸”ä¿®æ”¹ version åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å’Œä¿®æ”¹æ—¶çš„åˆ—ä¸ä¸€è‡´å°±è¯æ˜æœ‰äººè¿›è¡Œäº†ä¿®æ”¹ï¼Œä¸ºäº†é˜²æ­¢è„è¯»å°±ä¼šå–æ¶ˆæ›´æ–°ã€‚</p><blockquote><p>æµ‹è¯•ä¹è§‚é”</p></blockquote><p>åœ¨ä½¿ç”¨ä¹è§‚é”ä¹‹å‰æˆ‘ä»¬éœ€è¦æ·»åŠ ä¹è§‚é”æ’ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹è§‚é”å¯¹åº”æ³¨è§£ä¸º <code>@Version</code>ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œå¦‚æœå˜é‡åä¸å­—æ®µåå¯¹åº”ä¸ä¸Šå¯ä»¥ä½¿ç”¨ <code>@TableFiels</code> æ³¨è§£è¿›è¡Œç»‘å®šï¼Œè®°å¾—åœ¨æµ‹è¯•ä¹‹å‰è¦åœ¨æ•°æ®åº“ä¸­æ·»åŠ æ ‡è¯†å­—æ®µ ( å»ºè®®ä½¿ç”¨ version )ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ä½“ç±»ä»£ç </span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;T_USER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="meta">@Version</span>   <span class="comment">// æ·»åŠ @Versionæ³¨è§£</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦è¿™ä¸¤æ­¥ï¼Œè¿™æ ·ä¸€æ¥ä¹è§‚é”å°±é…ç½®å®Œæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥å¼€å§‹æµ‹è¯• ( version é»˜è®¤æ˜¯ 1 )ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01Test</span> &#123;</span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æŒ‰ç…§ä¹è§‚é”çš„é€»è¾‘ï¼Œä¿®æ”¹å‰å…ˆè·å–åˆ°versionï¼Œç„¶ååœ¨ä¿®æ”¹çš„æ—¶å€™åœ¨ä¼ è¿‡å»ï¼Œå¦‚æœå€¼ä¸€æ ·å°±å¯ä»¥ä¿®æ”¹</span></span><br><span class="line">  <span class="type">Integer</span> <span class="variable">version</span> <span class="operator">=</span> ud.selectById(<span class="number">2L</span>).getVersion();</span><br><span class="line">  <span class="type">UserEntity</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserEntity</span>();</span><br><span class="line">  user.setAaa(<span class="number">2L</span>);</span><br><span class="line">  user.setEmail(<span class="string">&quot;fu_gui@qq.com&quot;</span>);</span><br><span class="line">  user.setVersion(version);</span><br><span class="line">  ud.updateById(user);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•è¿è¡ŒæˆåŠŸï¼version å­—æ®µè¢«ä¿®æ”¹æˆäº† 2ï¼Œå†æ¬¡æµ‹è¯•ä¸€æ ·æˆåŠŸï¼version å˜æˆ 3ï¼ŒæŒ‰ç…§ä¹‹å‰åˆ†æçš„é€»è¾‘æ¯æ¬¡æ›´æ–°æ—¶ version éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€æ¬¡æ›´æ–°å¤±è´¥çš„æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01Test</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// åœ¨ä¿®æ”¹å‰è·å–åˆ°version</span></span><br><span class="line">  <span class="type">Integer</span> <span class="variable">v1</span> <span class="operator">=</span> ud.selectById(<span class="number">2L</span>).getVersion();</span><br><span class="line">  <span class="type">UserEntity</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserEntity</span>();</span><br><span class="line">  user1.setAaa(<span class="number">2L</span>);</span><br><span class="line">  user1.setEmail(<span class="string">&quot;update1@qq.com&quot;</span>);  <span class="comment">// æ³¨æ„è¿™é‡Œæ˜¯update1</span></span><br><span class="line">  user1.setVersion(v1);</span><br><span class="line">  <span class="comment">// åœ¨æ‰§è¡Œä¿®æ”¹ä¹‹å‰å¦ä¸€ä¸ªäººè¿›è¡Œäº†æ“ä½œå¹¶ä¸”å®Œæˆäº†ä¿®æ”¹</span></span><br><span class="line">  <span class="type">Integer</span> <span class="variable">v2</span> <span class="operator">=</span> ud.selectById(<span class="number">2L</span>).getVersion();</span><br><span class="line">  <span class="type">UserEntity</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserEntity</span>();</span><br><span class="line">  user2.setAaa(<span class="number">2L</span>);</span><br><span class="line">  user2.setEmail(<span class="string">&quot;update2@qq.com&quot;</span>);  <span class="comment">// æ³¨æ„è¿™é‡Œæ˜¯update2</span></span><br><span class="line">  user2.setVersion(v2);</span><br><span class="line">  System.out.println(ud.updateById(user2));  <span class="comment">// è¿™é‡Œæ‰§è¡Œäº†2</span></span><br><span class="line">  <span class="comment">// ç„¶åç¬¬ä¸€ä¸ªå¼€å§‹è¿›è¡Œä¿®æ”¹</span></span><br><span class="line">  System.out.println(ud.updateById(user1));  <span class="comment">// 1æ˜¯æœ€åæ‰§è¡Œçš„</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ 1 å’Œ 0ï¼Œä»£è¡¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒæˆåŠŸäº†ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œå¤±è´¥äº†ï¼ŒæŸ¥çœ‹æ•°æ®åº“ï¼Œé‚®ç®±ä¹Ÿæ˜¯ç•™åœ¨äº† update2ï¼ŒæˆåŠŸï¼</p><h3 id="TableLogic-é€»è¾‘åˆ é™¤">TableLogic é€»è¾‘åˆ é™¤</h3><p>å½“æˆ‘ä»¬åœ¨é¡µé¢ä¸­åˆ é™¤æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå¾€å¾€ä¸æ˜¯çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯é€šè¿‡ä¿®æ”¹æŸä¸ªå­—æ®µè®©ç”¨æˆ·ä¸åœ¨è¯»å–ï¼Œå› ä¸ºåœ¨æŸäº›ä¸šåŠ¡ä¸­è¢«åˆ é™¤çš„æ•°æ®ä¹Ÿæœ‰å­˜åœ¨çš„ä»·å€¼</p><p>åœ¨ MP ä¸­ä½¿ç”¨é€»è¾‘åˆ é™¤ä¹Ÿéå¸¸çš„ç®€å•ï¼Œå½“ç„¶æˆ‘ä»¬éœ€è¦åœ¨æ·»åŠ ä¸€ä¸ªåˆ—ä½œä¸ºé€»è¾‘åˆ é™¤åˆ— ( è¿™é‡Œæ¨èä½¿ç”¨ deleted )ï¼Œä¸”æ‰€æœ‰è¡¨ä¸­çš„é€»è¾‘åˆ é™¤å­—æ®µéƒ½è¦ä½¿ç”¨è¿™ä¸ªåå­—ï¼Œç„¶åæ¥çº¦å®šä¸€ä¸ªå€¼ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯ 0 ä»£è¡¨å·²åˆ é™¤ï¼Œ1 ä»£è¡¨æ­£å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ä½“ç±»è¿›è¡Œä¿®æ”¹ï¼Œç”±äºä¹‹å‰æµ‹è¯•å°†å±æ€§åä¹±ä¸ƒå…«ç³Ÿï¼Œè¿™é‡Œå°±é¡ºä¾¿éƒ½æ”¹å›æ¥äº†</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;T_USER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(value = &quot;ID&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date changeTime;</span><br><span class="line">    <span class="comment">// è¿™é‡Œé€šè¿‡@TableLogicè®¾ç½®äº†é€»è¾‘åˆ é™¤</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä½“ç±»ä¿®æ”¹å®Œæˆä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ªé…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€»è¾‘åˆ é™¤å­—æ®µåä¸ºdeleted</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-delete-field</span>=<span class="string">deleted</span></span><br><span class="line"><span class="comment"># è¢«åˆ é™¤çš„å˜é‡å€¼</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-delete-value</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># æ­£å¸¸æ˜¾ç¤ºçš„å˜é‡å€¼</span></span><br><span class="line"><span class="attr">mybatis-plus.global-config.db-config.logic-not-delete-value</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot01Test</span> &#123;</span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">  ud.deleteById(<span class="number">1L</span>);</span><br><span class="line">  ud.selectList(<span class="literal">null</span>).forEach(System.out::println);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•åæˆ‘ä»¬é€šè¿‡æ—¥å¿—å‘ç°ï¼ŒåŸæ¥çš„ delete è¯­å¥å˜æˆäº†ç°åœ¨çš„ update è¯­å¥ï¼Œè€Œä¸”åœ¨æ‰§è¡Œ selectList çš„æ—¶å€™æŸ¥è¯¢ä¸åˆ°åˆ é™¤åçš„æ•°æ®ï¼ŒMP å·²ç»å¸®æˆ‘ä»¬å…¨éƒ½é…ç½®å¥½äº†</p><h3 id="å¸¸ç”¨æ³¨è§£å°æ€»ç»“">å¸¸ç”¨æ³¨è§£å°æ€»ç»“</h3><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>@TableName</td><td>ç”¨æ¥ç»‘å®šå®ä½“ç±»å’Œæ•°æ®è¡¨åç§°</td></tr><tr><td>@TableId</td><td>ç”¨æ¥è®¾ç½®ä¸»é”®åˆ—ï¼Œå¯ä»¥ç»‘å®šåç§°ä»¥åŠä¿®æ”¹è‡ªåŠ¨ç”Ÿæˆç±»å‹ï¼Œä¾‹å¦‚é›ªèŠ±ç®—æ³•ï¼Œè‡ªå¢ç­‰</td></tr><tr><td>@TableField</td><td>ç”¨æ¥è®¾ç½®éä¸»é”®åˆ—ï¼Œå¯ä»¥è®¾ç½®ç»‘å®šåç§°ä»¥åŠè‡ªåŠ¨å¡«å……ç­‰ç­‰</td></tr><tr><td>@Version</td><td>ç”¨æ¥è®¾ç½®ä¹è§‚é”ï¼Œéœ€è¦é…åˆ <code>OptimisticLockerInterceptor</code> ç±»ä½¿ç”¨</td></tr><tr><td>@TableLogic</td><td>é…ç½®é€»è¾‘åˆ é™¤ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é€»è¾‘åˆ é™¤åˆ—ï¼Œåˆ é™¤å’Œæœªåˆ é™¤å¯¹åº”çš„å€¼</td></tr></tbody></table><h2 id="é«˜çº§æŸ¥è¯¢å­¦ä¹ ">é«˜çº§æŸ¥è¯¢å­¦ä¹ </h2><h3 id="Page-åˆ†é¡µæŸ¥è¯¢">Page åˆ†é¡µæŸ¥è¯¢</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ mybatis çš„æ—¶å€™ä½¿ç”¨çš„åˆ†é¡µæ’ä»¶æ˜¯ç¬¬ä¸‰æ–¹çš„ <code>PageHelper</code> åˆ†é¡µæ’ä»¶ï¼Œè€Œåœ¨ MP ä¸­ä¸ºæˆ‘ä»¬å†…ç½®äº†ä¸€ä¸ªåˆ†é¡µæ’ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®ƒé…ç½®è¿›æ¥å°±å¯ä»¥ä½¿ç”¨äº†</p><p>æµ‹è¯•åˆ†é¡µæŸ¥è¯¢é¦–å…ˆè¦æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ for å¾ªç¯æ’å…¥30æ¡æµ‹è¯•æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot09ApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="type">UserEntity</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserEntity</span>();</span><br><span class="line">            user.setName(<span class="string">&quot;ä¼å…µ&quot;</span> + i + <span class="string">&quot;å·&quot;</span>);</span><br><span class="line">            user.setAge(<span class="number">20</span>+i);</span><br><span class="line">            user.setEmail(<span class="string">&quot;sanbing&quot;</span> + (i+<span class="number">1</span>) + <span class="string">&quot;hao@163.com&quot;</span>);</span><br><span class="line">            ud.insert(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**1.**æµ‹è¯•æ•°æ®æ’å…¥å®Œæ¯•åï¼Œæˆ‘ä»¬å¼€å§‹ç»ƒä¹ åˆ†é¡µæŸ¥è¯¢ï¼Œé¦–å…ˆè¦å¼•å…¥ MP çš„åˆ†é¡µæ’ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>   <span class="comment">// è¿™äº›ç±»ä¼¼çš„é…ç½®å®˜æ–¹æ–‡æ¡£éƒ½æœ‰ï¼Œç›´æ¥ç…§æ¬å³å¯</span></span><br><span class="line"><span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">PaginationInterceptor</span> <span class="variable">paginationInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    paginationInterceptor.setCountSqlParser(<span class="keyword">new</span> <span class="title class_">JsqlParserCountOptimize</span>(<span class="literal">true</span>));</span><br><span class="line">    <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**2.**é…ç½®å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æŸ¥è¯¢æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot09ApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao ud;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// éœ€è¦åˆ›å»ºåˆ†é¡µå®ä¾‹ï¼Œå‚æ•°ä¸ºï¼š æŸ¥è¯¢ç¬¬2é¡µï¼Œæ¯é¡µæ˜¾ç¤º5æ¡è®°å½•</span></span><br><span class="line">        Page&lt;UserEntity&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢æ—¶ä½¿ç”¨selectPageè¿›è¡ŒæŸ¥è¯¢ï¼Œç»“æœä¼šè¿”å›ç»™pageå®ä¾‹</span></span><br><span class="line">        ud.selectPage(page, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// ç„¶ååœ¨é€šè¿‡pageå®ä¾‹è·å–ç›¸å…³åˆ†é¡µä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;======================== Page ========================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰ç¬¬&quot;</span> + page.getCurrent() + <span class="string">&quot;é¡µ&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ€»é¡µç ä¸º&quot;</span> + page.getPages() + <span class="string">&quot;é¡µ&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç»“æœé›†ä¸ºï¼š&quot;</span> + page.getRecords());</span><br><span class="line">        System.out.println(<span class="string">&quot;æŸ¥è¯¢åˆ°&quot;</span> + page.getSize() + <span class="string">&quot;æ¡è®°å½•&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ€»è®°å½•æ•°&quot;</span> + page.getTotal() + <span class="string">&quot;æ¡&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦æœ‰ä¸Šä¸€é¡µï¼š&quot;</span> + page.hasPrevious());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦æœ‰ä¸‹ä¸€é¡µï¼š&quot;</span> + page.hasNext());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥åˆ†é¡µå°±æµ‹è¯•å®Œæˆäº†ï¼</p><h3 id="Wrapper-æ¡ä»¶æ„é€ å™¨">Wrapper æ¡ä»¶æ„é€ å™¨</h3><p>wrapper æ¡ä»¶æ„é€ å™¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆ SQL ä¸­çš„ç»å¤§å¤šæ•°æ“ä½œï¼Œä¾‹å¦‚å¤§äºç­‰äºï¼Œå°äºï¼ŒåŒºé—´ä»¥åŠæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯¹åº”çš„æ¡ä»¶æ„é€ å™¨ä¸º <code>QueryWrapper</code>ï¼Œä¿®æ”¹æ“ä½œåŒæ ·ä¹Ÿæœ‰å¯¹åº”çš„æ¡ä»¶æ„é€ å™¨ <code>UpdateWrapper</code></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»ƒä¹ ä¸€ä¸‹ï¼š</p><blockquote><p>æŸ¥è¯¢å¹´é¾„åœ¨25-35ä¹‹é—´çš„ç”¨æˆ·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    QueryWrapper&lt;UserEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢å¹´é¾„åœ¨25-35ä¹‹é—´çš„ç”¨æˆ·</span></span><br><span class="line">    wrapper.between(<span class="string">&quot;AGE&quot;</span>, <span class="number">25</span>, <span class="number">35</span>);</span><br><span class="line">    ud.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢åç§°ä¸­åŒ…å« â€˜ä¼å…µâ€™ çš„ç”¨æˆ·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    QueryWrapper&lt;UserEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.like(<span class="string">&quot;NAME&quot;</span>, <span class="string">&quot;ä¼å…µ&quot;</span>);</span><br><span class="line">    ud.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢æ‰€æœ‰é‚®ç®±ä¸º null çš„ç”¨æˆ·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    QueryWrapper&lt;UserEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.isNull(<span class="string">&quot;EMAIL&quot;</span>);</span><br><span class="line">    ud.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢åç§°ä¸­ä¸åŒ…å« â€˜ä¼å…µâ€™ ä¸”å¹´é¾„å¤§äº 20 é‚®ç®±ä¸ä¸ºç©ºçš„æ‰€æœ‰ç”¨æˆ·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">QueryWrapper&lt;UserEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper    <span class="comment">// è¿™é‡Œä½¿ç”¨é“¾å¼ç¼–ç¨‹</span></span><br><span class="line">        .notLike(<span class="string">&quot;NAME&quot;</span>, <span class="string">&quot;ä¼å…µ&quot;</span>)</span><br><span class="line">        .gt(<span class="string">&quot;AGE&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .isNotNull(<span class="string">&quot;EMAIL&quot;</span>);</span><br><span class="line">    ud.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ˜ å°„mapper-xml">æ˜ å°„mapper.xml</h2><p>å¼€å§‹çš„æ—¶å€™ä¹Ÿè¯´äº†ï¼ŒMP æ˜¯åŸºäº mybatis æ¡†æ¶è¿›è¡Œçš„å¢å¼ºï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†ä¹‹å‰é‚£äº›åŠŸèƒ½ä¹‹å¤–æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æŠŠå®ƒå½“æˆ mybatis ä½¿ç”¨çš„ï¼Œå¯ä»¥é…ç½® mapper.xml æ˜ å°„æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥é…ç½® xml å¼€å‘ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠŠMPçœ‹åšæˆMybatiså³å¯ï¼Œæ‰€æœ‰çš„é…ç½®é¡¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯æ¢äº†ä¸ªåå­—</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">deleted</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">0</span></span><br><span class="line">  <span class="comment"># åœ¨è¿™é‡Œé…ç½®mapperæ˜ å°„æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mappers/*Mapper.xml</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç›®æ ‡ä½ç½®åˆ›å»º mapper æ–‡ä»¶ç»‘å®šæ¥å£è¿›è¡Œè°ƒç”¨å³å¯ï¼Œå’Œ mybatis æ˜¯ä¸€æ ·çš„æµç¨‹</p>]]></content>
    
    
    <categories>
      
      <category>å¼€å‘æ¡†æ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MyBatis-Plus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå­¦ä¹ ç¬”è®°</title>
    <link href="/2021/07/13/SpringBoot%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/07/13/SpringBoot%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>SpringBootå­¦ä¹ ç¬”è®°</h1><p>ç¬”è®°åŸºäº Springboot 2.4.0 è¿›è¡Œè®°å½•</p><h2 id="ç¬¬ä¸€ä¸ªSpringbootç¨‹åº">ç¬¬ä¸€ä¸ªSpringbootç¨‹åº</h2><p>ä½¿ç”¨ idea å¿«é€Ÿåˆ›å»ºä¸€ä¸ª boot ç¨‹åºï¼š</p><img src="/img/7.jpg" /><h3 id="ç›®å½•ç»“æ„ä»‹ç»">ç›®å½•ç»“æ„ä»‹ç»</h3><img src="/img/1.jpg" /><h3 id="pom-æ–‡ä»¶è§£æ">pom æ–‡ä»¶è§£æ</h3><ul><li>é¡¹ç›®å…ƒæ•°æ®ï¼šåˆ›å»ºæ—¶å€™è¾“å…¥çš„Project Metadataéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯Mavené¡¹ç›®çš„åŸºæœ¬å…ƒç´ ï¼ŒåŒ…æ‹¬ï¼šgroupIdã€artifactIdã€versionã€nameã€descriptionç­‰</li><li>parentï¼šç»§æ‰¿<code>spring-boot-starter-parent</code>çˆ¶å·¥ç¨‹ï¼Œä¸»è¦ç”¨äºä¾èµ–ç®¡ç†ã€æ§åˆ¶ç‰ˆæœ¬ç­‰å†…å®¹</li><li>dependenciesï¼šé¡¹ç›®å…·ä½“ä¾èµ–ï¼Œè¿™é‡ŒåŒ…å«äº†<code>spring-boot-starter-web</code>ç”¨äºå®ç°HTTPæ¥å£ï¼ˆè¯¥ä¾èµ–ä¸­åŒ…å«äº†Spring MVCï¼‰ï¼›<code>spring-boot-starter-test</code>ç”¨äºç¼–å†™å•å…ƒæµ‹è¯•çš„ä¾èµ–åŒ…ã€‚æ›´å¤šåŠŸèƒ½æ¨¡å—çš„ä½¿ç”¨æˆ‘ä»¬å°†åœ¨åé¢çš„æ•™ç¨‹ä¸­é€æ­¥å±•å¼€ã€‚</li><li>buildï¼šæ„å»ºé…ç½®éƒ¨åˆ†ã€‚é»˜è®¤ä½¿ç”¨äº†<code>spring-boot-maven-plugin</code>ï¼Œé…åˆ<code>spring-boot-starter-parent</code>å°±å¯ä»¥æŠŠSpring Bootåº”ç”¨æ‰“åŒ…æˆJARæ¥ç›´æ¥è¿è¡Œã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç»§æ‰¿ç›®æ ‡çˆ¶é¡¹ç›®çš„ä¾èµ–ï¼Œæ§åˆ¶ç»Ÿä¸€ç‰ˆæœ¬å· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é¡¹ç›®å…ƒæ•°æ® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>site.hanzhe<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-01-start<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot-09-mybatis-plus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>my frist springboot demo<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- é¡¹ç›®å…·ä½“ä¾èµ–ï¼Œå„ç§å¯åŠ¨å™¨ç­‰ç­‰ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ„å»ºé…ç½®éƒ¨åˆ† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ç±»ä»‹ç»">å¯åŠ¨ç±»ä»‹ç»</h3><p>springboot çš„å¯åŠ¨ç±»å’Œå¹³æ—¶å†™ Java æ—¶çš„ main å‡½æ•°å·®ä¸å¤ªå¤šï¼Œéœ€è¦æ³¨æ„çš„ç‚¹æœ‰ï¼š</p><ol><li>å¯åŠ¨ç±»è¦åŠ ä¸Š @SpringBootApplication æ³¨è§£ï¼Œæ ‡è¯†è¿™æ˜¯ä¸€ä¸ªå¯åŠ¨ç±»</li><li>åœ¨ main å‡½æ•°ä¸­è¦è°ƒç”¨ SpringApplication çš„é™æ€å‡½æ•° runï¼Œå¹¶ä¼ å…¥å¯åŠ¨ç±»çš„ class å’Œ args å‚æ•°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot10SwaggerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot10SwaggerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@SpringBootApplication</code> æ³¨è§£ä¸­åŒ…å«äº†è‡ªåŠ¨é…ç½®çš„æ³¨è§£ <code>EnableAutoConfiguration</code> å’Œè‡ªåŠ¨æ‰«æåŒ…çš„æ³¨è§£ <code>@ComponentScan</code> ç­‰ç­‰ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†å…¨è‡ªåŠ¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p><h3 id="springboot-å¯åŠ¨å°å½©è›‹">springboot å¯åŠ¨å°å½©è›‹</h3><p>åœ¨ resources ç›®å½•ä¸‹å¤åˆ¶ä¸€ä¸ª banner.txt çš„æ–‡ä»¶ï¼Œä»–ä¼šä»¥æŒ‰ç…§æ–‡ä»¶å†…çš„å›¾æ¡ˆä½œä¸ºå¯åŠ¨çš„ LOGO</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> _________________</span><br><span class="line">&lt;    W D N M D    &gt;</span><br><span class="line"> -----------------</span><br><span class="line">        \   ^__^</span><br><span class="line">         \  (oo)\_______</span><br><span class="line">            (__)\       )\/\</span><br><span class="line">                ||----w |</span><br><span class="line">                ||     ||</span><br></pre></td></tr></table></figure><h2 id="å¼€å‘æ³¨æ„äº‹é¡¹">å¼€å‘æ³¨æ„äº‹é¡¹</h2><p>boot é¡¹ç›®ä¸­å«æœ‰å¯åŠ¨ç±»ï¼Œä½äº <code>site.hanzhe.**Application.java</code>ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼šæˆ‘ä»¬åœ¨åˆ›å»ºç±»æˆ–è€…æ¥å£ä»¥åŠåŒ…çš„æ—¶å€™è¦æ±‚<em>å¿…é¡»åœ¨å¯åŠ¨ç±»åŒçº§ç›®å½•ä»¥åŠåŒçº§ç›®å½•çš„å­ç›®å½•ä¸‹</em>åˆ›å»º</p><p><font color="green">æ£€æµ‹çš„åˆ°ï¼š</font> site.hanzhe.dao.Test.java<br><font color="red">æ£€æµ‹ä¸åˆ°ï¼š</font> site.example.dao.Test.java</p><p>å¦‚æœæˆ‘ä»¬ä¸å¾—ä¸åœ¨å…¶ä»–ä½ç½®åˆ›å»ºç±»æˆ–è€…æ¥å£ï¼Œå¦‚æœæƒ³è¦è¢« Spring å‘ç°çš„è¯ï¼Œå¯ä»¥æ–°å»ºé…ç½®ç±»ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ol><li>åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ <code>@ComponentScan(&quot;æŒ‡å®šåŒ…çš„ä½ç½®&quot;)</code></li><li>åœ¨é…ç½®ç±»æˆ–å¯åŠ¨ç±»ä¸‹ï¼Œé€šè¿‡ <code>@Bean()</code> æ³¨è§£å°†å®ä¾‹æ”¾è¿› IOC å®¹å™¨ä¸­</li></ol><h2 id="é…ç½®æ–‡ä»¶çš„ä½¿ç”¨">é…ç½®æ–‡ä»¶çš„ä½¿ç”¨</h2><p>springboot ä¸­æ”¯æŒä¸¤ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯åˆ›å»ºé¡¹ç›®æ—¶æºå¸¦çš„ <code>properties</code> æ–‡ä»¶ï¼Œå¦ä¸€ç§æ˜¯ <code>yml</code> æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åä¸º <code>application</code></p><h3 id="propertiesé…ç½®æ–‡ä»¶">propertiesé…ç½®æ–‡ä»¶</h3><p>properties é…ç½®æ–‡ä»¶çš„ä¹¦å†™æ ¼å¼æ˜¯ä»¥ <code>.</code> åˆ†éš”ç¬¦æ§åˆ¶å±‚çº§ï¼Œè€Œåç”¨ <strong>=</strong> è¿›è¡Œèµ‹å€¼æ“ä½œ ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†tomcatå¯åŠ¨ç«¯å£å·æ”¹ä¸º8008</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8008</span></span><br><span class="line"><span class="comment"># é…ç½®MySQLçš„è¿æ¥å­—ç¬¦ä¸²ä¿¡æ¯</span></span><br><span class="line"><span class="attr">mysql.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">mysql.url</span>=<span class="string">jdbc:mysql://localhost:3306/database</span></span><br><span class="line"><span class="attr">mysql.username</span>=<span class="string">zhang</span></span><br><span class="line"><span class="attr">mysql.password</span>=<span class="string">hanzhe</span></span><br></pre></td></tr></table></figure><p>å¦‚æœèµ‹å€¼ä¸­åŒ…å« k-v çš„é”®å€¼å¯¹æˆ–è€…æ•°ç»„ï¼Œé›†åˆèµ‹å€¼ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é”®å€¼å¯¹èµ‹å€¼</span></span><br><span class="line"><span class="attr">person.map.key1</span>=<span class="string">value1</span></span><br><span class="line"><span class="attr">person.map.key2</span>=<span class="string">value2</span></span><br><span class="line"><span class="comment"># æ•°ç»„ï¼Œé›†åˆèµ‹å€¼</span></span><br><span class="line"><span class="attr">person.list</span>=<span class="string">1,2,3,4,5</span></span><br></pre></td></tr></table></figure><h3 id="å¸¸è§çš„ä¸€äº›é…ç½®é¡¹">å¸¸è§çš„ä¸€äº›é…ç½®é¡¹</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tomcaté»˜è®¤ç«¯å£å·</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8000</span></span><br><span class="line"><span class="comment"># ä¸Šä¸‹æ–‡è®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="attr">server.servlet.context-path</span>=<span class="string">/name</span></span><br><span class="line"><span class="comment"># å¼€å¯/å…³é—­ SpringBooté»˜è®¤å›¾æ ‡</span></span><br><span class="line"><span class="attr">spring.mvc.favicon.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># æ˜¯å¦å¼€å¯Debugæ¨¡å¼(ç”¨äºæŸ¥çœ‹ç»„ä»¶æ³¨å†ŒçŠ¶å†µ)</span></span><br><span class="line"><span class="attr">debug</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ—¶é—´æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²è§£ææ¨¡å¼</span></span><br><span class="line"><span class="attr">spring.mvc.date-format</span>=<span class="string">yyyy-MM-dd</span></span><br><span class="line"><span class="comment"># å¼€å¯/å…³é—­ Thymeleafæ¨¡æ¿å¼•æ“çš„ç¼“å­˜</span></span><br><span class="line"><span class="attr">spring.thymeleaf.cache</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># é™æ€èµ„æºè®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="attr">spring.mvc.static-path-pattern</span>=<span class="string">/resource/**</span></span><br><span class="line"><span class="comment"># é…ç½®æ•°æ®æº</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">druid</span></span><br><span class="line"><span class="attr">spring.datasource...</span>=<span class="string">...</span></span><br></pre></td></tr></table></figure><h3 id="yml-é…ç½®æ–‡ä»¶">yml é…ç½®æ–‡ä»¶</h3><p>yml é…ç½®çš„è¯­æ³•æ˜¯åˆ©ç”¨ <strong>ç©ºæ ¼</strong> æ§åˆ¶ç¼©è¿›çš„æ–¹å¼ç¼–å†™æ–‡ä»¶ï¼Œæ ¼å¼ä¸º <code>key: value</code> æœ‰äº›ç±»ä¼¼ JSONï¼Œvalue å‰éœ€è¦ç•™æœ‰ç©ºæ ¼ï¼Œå¤šå±‚çº§æ—¶ç”¨ <strong>å›è½¦+ç©ºæ ¼</strong> æ¥æ§åˆ¶å±‚çº§ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†tomcatå¯åŠ¨ç«¯å£å·æ”¹ä¸º8008</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"> <span class="attr">port:</span> <span class="number">8008</span></span><br><span class="line"> <span class="comment"># é…ç½®MySQLçš„è¿æ¥å­—ç¬¦ä¸²ä¿¡æ¯</span></span><br><span class="line"><span class="attr">mysql:</span></span><br><span class="line"> <span class="attr">driver:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"> <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/database</span></span><br><span class="line"> <span class="attr">username:</span> <span class="string">zhang</span></span><br><span class="line"> <span class="attr">password:</span> <span class="string">hanzhe</span></span><br></pre></td></tr></table></figure><p>å¦‚æœèµ‹å€¼ä¸­åŒ…å« k-v çš„é”®å€¼å¯¹æˆ–è€…æ•°ç»„ï¼Œé›†åˆèµ‹å€¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é”®å€¼å¯¹èµ‹å€¼</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line"> <span class="attr">key1:</span> <span class="string">value1</span></span><br><span class="line"> <span class="attr">key2:</span> <span class="string">value2</span></span><br><span class="line"><span class="comment"># è¡Œå†…èµ‹å€¼</span></span><br><span class="line"><span class="attr">person:</span> &#123; <span class="attr">key1:</span> <span class="string">value1</span> , <span class="attr">key1:</span> <span class="string">value1</span> &#125;</span><br><span class="line"><span class="comment"># array,list.setèµ‹å€¼ å‡å·+ç©ºæ ¼ å°±ç›¸å½“äºä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line"> <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line"> <span class="bullet">-</span> <span class="number">3</span></span><br><span class="line"><span class="comment"># array,list.setèµ‹å€¼ è¡Œå†…èµ‹å€¼</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line"> <span class="string">list=&#123;1,2,3,4,5&#125;</span></span><br></pre></td></tr></table></figure><p><strong>å…³äºå­—ç¬¦ä¸²èµ‹å€¼çš„ç»†èŠ‚ï¼š</strong></p><ul><li>æ— å¼•å·ï¼šé»˜è®¤èµ‹å€¼å­—ç¬¦ä¸²å¯ä»¥ä¸é€‚ç”¨å¼•å·ï¼Œç›´æ¥ä¹¦å†™ value å³å¯ï¼Œ</li><li>å•å¼•å·ï¼šå•å¼•å·å†…çš„å­—ç¬¦ä¸²æ”¯æŒç‰¹æ®Šæ ¼å¼ï¼Œä¾‹å¦‚ <code>'å“ˆå“ˆ\nå“ˆå“ˆ'</code>ï¼Œé‚£ä¹ˆè¾“å‡ºåˆ°æ§åˆ¶å°ä¹‹åå¯ä»¥å‘ç°å­—ç¬¦ä¸²ä¸­é—´ä¼šæœ‰æ¢è¡Œæ•ˆæœï¼Œå››ä¸ªå“ˆå“ˆä¹‹é—´æœ‰ä¸€ä¸ªæ¢è¡Œ</li><li>åŒå¼•å·ï¼šåŒå¼•å·å†…çš„å­—ç¬¦ä¸²å°±æ˜¯å­—ç¬¦ä¸²ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•æ”¹å˜ï¼ŒåŒæ ·ä½¿ç”¨ <code>&quot;å“ˆå“ˆ\nå“ˆå“ˆ&quot;</code>ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°ä¹‹åå¯ä»¥å‘ç°æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œæ§åˆ¶å°ä¸ŠåŸæ ·è¾“å‡ºäº† \n è¿™ä¸ªå­—ç¬¦ä¸²</li></ul><h3 id="ç±»çš„ç»‘å®šé…ç½®-å…¨å±€">ç±»çš„ç»‘å®šé…ç½® ( å…¨å±€ )</h3><p>å°†æŸäº›å›ºå®šçš„å±æ€§å€¼æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨é€šè¿‡ bean å…³è”å…¶ä¸­è¿›è¡Œä½¿ç”¨ï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><strong>propertiesé…ç½®æ–‡ä»¶å†™æ³•ï¼š</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.name</span>=<span class="string">å¼ æ¶µå“²</span></span><br><span class="line"><span class="attr">person.age</span>=<span class="string">22</span></span><br><span class="line"><span class="attr">person.cat.name</span>=<span class="string">å“ˆå“ˆ</span></span><br><span class="line"><span class="attr">person.cat.color</span>=<span class="string">ç™½è‰²</span></span><br></pre></td></tr></table></figure><p><strong>ymlé…ç½®æ–‡ä»¶å†™æ³•ï¼š</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">22</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">å¼ æ¶µå“²</span></span><br><span class="line">  <span class="attr">cat:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">å“ˆå“ˆ</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">æ©˜è‰²</span></span><br></pre></td></tr></table></figure><hr /><p>ä¹¦å†™ä¸é…ç½®æ–‡ä»¶å…³è”çš„ bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// é…ç½®æ–‡ä»¶çš„keyéƒ½æ˜¯ä»¥personä½œä¸ºå‰ç¼€çš„ï¼Œæ‰€ä»¥è¿™é‡Œè¦åŠ ä¸Š</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="comment">// åŒäº‹ä¹Ÿå¯ä»¥å±æ€§ä¸­çš„å±æ€§è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="comment">// ä¸€å †çš„get-set-toString-ä»£ç çœç•¥æ‰äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Personç±»ä¸­çš„Catå±æ€§å¯¹åº”çš„ç±»</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;cat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="comment">// ä¸€å †çš„get-set-toString-ä»£ç çœç•¥æ‰äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr />**æµ‹è¯•ç±»ä»£ç **ï¼Œé€šè¿‡æµ‹è¯•ç±»å¯ä»¥æŸ¥çœ‹åˆ°æ•°æ®å·²ç»è¢«å°è£…ä¸Šæ¥äº†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith( SpringRunner.class )</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBoot02ConfigApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> Person person;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>é…ç½®æ–‡ä»¶å…³è”çš„ bean å¿…é¡»æ·»åŠ åˆ° spring çš„ ioc å®¹å™¨ä¸­ã€‚</li><li>bean å¿…é¡»æä¾› get set æ–¹æ³•ï¼Œå…³è”æ³¨å…¥ä¾é çš„å°±æ˜¯ get set æ–¹æ³•</li><li>å¦‚æœä¸¤ç§ç±»å‹çš„é…ç½®æ–‡ä»¶å¹¶å­˜çš„æƒ…å†µä¸‹ï¼Œproperties çš„ä¼˜å…ˆçº§é«˜äº yml</li></ul><h3 id="ç±»ç»‘å®šé…ç½®-æŒ‡å®š">ç±»ç»‘å®šé…ç½® ( æŒ‡å®š )</h3><p>é…ç½®æ–‡ä»¶å¯ä»¥ä¹¦å†™å‚æ•°å’Œ bean å…³è”åœ¨ä¸€èµ·ï¼Œä½†æ˜¯å¦‚æœæŠŠæ‰€æœ‰å‚æ•°éƒ½æ”¾åœ¨ <code>application</code> å…¨å±€é…ç½®æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶å°±æ˜¾å¾—å¤ªè¿‡è‡ƒè‚¿ï¼Œå¦‚æœ bean éœ€è¦è¿›è¡Œå…³è”çš„è¯ï¼Œå»ºè®®æ–°å»ºä¸€ä¸ª properties æ–‡ä»¶å•ç‹¬å­˜å‚¨ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ°ä¸€ä¸ªæ³¨è§£ <code>@PropertySource(&quot;classpath:&quot;)</code></p><p>ä¹¦å†™ä¸€ä¸ªJavaBeanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;dog&quot;)</span></span><br><span class="line"><span class="comment">// æŒ‡å®šå…³è”ç±»è·¯å¾„ä¸‹çš„dog.propertiesæ–‡ä»¶</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:dog.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; eat;</span><br><span class="line">    <span class="comment">// æ­¤å¤„çœç•¥ get set toString æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹¦å†™dog.propertiesé…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dog.name</span>=<span class="string">å¿ çŠ¬</span></span><br><span class="line"><span class="attr">dog.eat</span>=<span class="string">ç‹—ç²®,é€šç”¨å® ç‰©ç‹¼,è‚‰</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBoot02ConfigApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> Dog dog;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(dog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶ç»‘å®šæç¤º">é…ç½®æ–‡ä»¶ç»‘å®šæç¤º</h3><p>åœ¨æˆ‘ä»¬é€šè¿‡ç±»ç»‘å®šåˆ°é…ç½®æ–‡ä»¶ä¹‹åï¼Œå°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ç…§ç€ç±»çš„æ ¼å¼ä¹¦å†™å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ springboot ä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªå·¥å…·æ¥å¼€å¯é…ç½®æ–‡ä»¶ä¸­çš„ä»£ç æç¤ºï¼š</p><blockquote><p>ä»£ç æç¤ºä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-rocessor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¾èµ–å¼•å…¥ååœ¨é…ç½®æ–‡ä»¶ä¸­å°±ä¼šæœ‰ä»£ç æç¤ºå•¦ï¼Œä½†æ˜¯è¿™ä¸ªä¾èµ–åœ¨è´Ÿè´£æˆ‘ä»¬åœ¨ç¼–ç ç¨‹åºä¸­ä½¿ç”¨ï¼Œé¡¹ç›®çœŸæ­£ä¸Šçº¿çš„æ—¶å€™å°±æ²¡æœ‰å¿…è¦åœ¨ç•™ç€ä»–äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½åœ¨é¡¹ç›®æ‰“åŒ…å‰å°†è¿™ä¸ªä¾èµ–åˆ é™¤ï¼Œæˆ–è€…è®©ä»–ä¸å‚ä¸æ‰“åŒ…ï¼š</p><blockquote><p>é…ç½®ä¾èµ–ä¸å‚ä¸æ‰“åŒ…</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-rocessor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Valueæ³¨è§£è·å–å€¼">@Valueæ³¨è§£è·å–å€¼</h3><p>å½“æœ‰äº›æ—¶å€™ä»…ä»…æ˜¯æƒ³å¼•ç”¨ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„å€¼è€Œä¸å…³è”èµ·æ¥ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ç”¨åˆ°@Valueæ³¨è§£</p><blockquote><p>å½“@ConfigurationPropertieså’Œ@ValueåŒæ—¶ä½¿ç”¨æ—¶ï¼Œ@ConfigurationPropertiesæƒé™é«˜äº@Value</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">// æ³¨æ„ï¼Œç›®æ ‡ç±»å¿…é¡»æ˜¯Springçš„ç»„ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person.cat.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// çœç•¥getã€setæ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æ˜¯å¦æ‹¿åˆ°äº†å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SpringBootTest</span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBoot02ConfigApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> Cat cat;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println( cat.getColor() );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶å ä½ç¬¦">é…ç½®æ–‡ä»¶å ä½ç¬¦</h3><p>æ— è®ºæ˜¯åœ¨ properties è¿˜æ˜¯ yml ä¸­éƒ½æœ‰ç€ å ä½ç¬¦ çš„å­˜åœ¨ï¼Œå ä½ç¬¦çš„è¡¨ç°å½¢å¼æ˜¯ <font color="red"><strong>${  }</strong></font>ï¼Œä½¿ç”¨å ä½ç¬¦å¯ä»¥å®ç°åœ¨å¼•ç”¨é…ç½®æ–‡ä»¶å†…çš„å€¼ï¼Œç”Ÿæˆéšæœºæ•°çš„åŠŸèƒ½</p><p>é¦–å…ˆä¸€ä¸ªJavaBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;cat&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:cat.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String number;</span><br><span class="line">    <span class="keyword">private</span> String Remarks;</span><br><span class="line">    <span class="comment">// çœç•¥çš„ get set toString æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨cat.propertiesé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å ä½ç¬¦</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥èµ‹å€¼ç»™çŒ«èµ·åå­—</span></span><br><span class="line"><span class="attr">cat.name</span>=<span class="string">çŒ«çˆ·</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨randomç”Ÿæˆ1-10çš„éšæœºå¹´é¾„</span></span><br><span class="line"><span class="attr">cat.age</span>=<span class="string">$&#123;random.int(1,10))&#125;</span></span><br><span class="line"><span class="comment"># ç»™çŒ«ç”Ÿæˆéšæœºç¼–å·</span></span><br><span class="line"><span class="attr">cat.number</span>=<span class="string">$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¼•ç”¨ç”Ÿæˆå¤‡æ³¨ name_age_sex ï¼Œå¦‚æœå¼•ç”¨æ— æ•ˆåˆ™ä½¿ç”¨å†’å·åçš„é»˜è®¤å€¼</span></span><br><span class="line"><span class="attr">cat.remarks</span>=<span class="string">$&#123;cat.name:åŒ¿å&#125;_$&#123;cat.age:0&#125;_$&#123;cat.sex:æœªçŸ¥&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestDemo</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println( cat );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶å­˜æ”¾ä½ç½®">é…ç½®æ–‡ä»¶å­˜æ”¾ä½ç½®</h3><p>åœ¨SpringBootä¸­çš„é…ç½®æ–‡ä»¶åªèƒ½æ”¾åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹æ‰å¯ä»¥è¢«è¯†åˆ«ï¼Œè¿™é‡Œåˆ—ä¸¾å››ä¸ªå¸¸ç”¨å¥½è®°çš„å­˜å‚¨ä½ç½®ï¼Œå…¶ä¸­æ¯ä¸ªä½ç½®çš„é…ç½®æ–‡ä»¶ä¹‹é—´åˆ†åˆ«æœ‰ç€ä¼˜å…ˆçº§çš„æ¦‚å¿µ</p><table><thead><tr><th>â†‘ <strong>é¡¹ç›®æ ¹ç›®å½• / config</strong></th></tr></thead><tbody><tr><td>â†‘ <strong>é¡¹ç›®æ ¹ç›®å½•</strong></td></tr><tr><td>â†“ <strong>resources / config</strong></td></tr><tr><td>â†“ <strong>resources</strong></td></tr></tbody></table><p>ä»¥ä¸Šå››ä¸ªå­˜æ”¾é…ç½®æ–‡ä»¶ç›®å½•çš„é¡ºåºæ˜¯æŒ‰ç…§ç”±é«˜åˆ°ä½çš„ä¼˜å…ˆçº§è¿›è¡Œæ’åºçš„ï¼Œ<font color="red">ä¼˜å…ˆçº§é«˜çš„é…ç½®æ–‡ä»¶ä¼šè¦†ç›–ä¼˜å…ˆçº§ä½çš„é…ç½®æ–‡ä»¶</font>ï¼Œä½†æ˜¯åªæœ‰åœ¨ä¼˜å…ˆçº§é«˜çš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨çš„é…ç½®ä¿¡æ¯æ‰ä¼šè¢«è¦†ç›–ï¼Œè€Œä¼˜å…ˆçº§é«˜çš„é…ç½®æ–‡ä»¶ä¸­ä¸å­˜åœ¨çš„é…ç½®ä¿¡æ¯ä¾ç„¶ç”Ÿæ•ˆï¼Œè¿™å°±è¯ç”Ÿäº†<font color="red">äº’è¡¥é…ç½®</font>ï¼Œä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹å¯¹é…ç½®è¿›è¡Œè°ƒä¼˜</p><h3 id="Jar-å‘½ä»¤è¡Œé…ç½®">Jar å‘½ä»¤è¡Œé…ç½®</h3><blockquote><p>ä¿®æ”¹æŸä¸€é¡¹é…ç½®</p></blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨é€šè¿‡ java -jar æ‰§è¡ŒæŸä¸ª jar åŒ…çš„æ—¶å€™ï¼Œæ‰‹åŠ¨ä¿®æ”¹æŸä¸ªé…ç½®é¡¹ï¼Œä¾‹å¦‚ï¼š</p><p><code>java -jar xxx.jar --server.port=8888</code></p><p><code>java -jar xxx.jar --spring.profiles.active=prod</code></p><blockquote><p>æŒ‡å®šæŸä¸ªè·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶</p></blockquote><p>é™¤å¼€ä¹‹å‰å››ä¸ªæ¯”è¾ƒå¸¸ç”¨å¥½è®°çš„å­˜æ”¾ä½ç½®ä¹‹å¤–ï¼Œè¿˜éœ€è¦äº†è§£è¿™ä¸ªé…ç½®ï¼Œåœ¨é¡¹ç›®æ‰“åŒ…ä¸ºjaråŒ…ä¹‹åï¼Œå¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™æ‰‹åŠ¨æŒ‡å®šéœ€è¦ä½¿ç”¨å“ªä¸€ä¸ª é…ç½®/æœ¬åœ°ç£ç›˜ æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar é¡¹ç›®å.jar --spring.config.location=æ–‡ä»¶è·¯å¾„</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <strong>å‘½ä»¤è¡Œ</strong> æŒ‡å®šçš„é…ç½®æ–‡ä»¶æ˜¯ç›®å‰ springboot ä¸­å·²çŸ¥ <strong>ä¼˜å…ˆçº§æœ€é«˜</strong> çš„ï¼Œä¸€èˆ¬åœ¨é¡¹ç›®æ‰“åŒ…æˆåŠŸåçªç„¶å‘ç°äº† BUG ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸ç”¨å»é¡¹ç›®ä¸­æ”¹ååœ¨é‡æ–°æ‰“åŒ…</p><h3 id="Profiles-æ¨¡å¼">Profiles æ¨¡å¼</h3><p>åœ¨æœ¬åœ°å¼€å‘ç¨‹åºæ—¶ä¼šè¿æ¥æœ¬åœ°çš„æ•°æ®åº“ï¼Œç¨‹åºä¸Šçº¿è¿è¡Œåä¼šè¿æ¥çœŸæ­£æ‡‚å¾—ç”Ÿäº§åº“ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥å†³å®šè¿æ¥çš„åº“çš„åœ°å€ï¼Œå¯å¦‚æœéœ€è¦ä¿®æ”¹çš„ä¸æ­¢æ˜¯æ•°æ®åº“åœ°å€é‚£å°±éå¸¸éº»çƒ¦äº†</p><p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <em>profileæ¨¡å¼</em>ï¼Œåˆ›å»ºå¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªé…ç½®æ–‡ä»¶ä»£è¡¨ä¸€ä¸ªç¯å¢ƒï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡å°‘é‡çš„ä¿®æ”¹å®ç°åœ¨å¤šä¸ªç¯å¢ƒä¹‹é—´æ¥å›çš„åˆ‡æ¢</p><p>profileæ¨¡å¼è¦æ±‚æ–‡ä»¶å‘½åçš„è§„èŒƒä¸ºï¼š<strong>application-{profile}.properties/yml</strong></p><h4 id="profileså¤šé…ç½®æ–‡ä»¶">profileså¤šé…ç½®æ–‡ä»¶</h4><p>å‡è®¾æœ‰ä¸‰ä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼šã€ é»˜è®¤ç¯å¢ƒï¼Œå¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒ ã€‘ï¼Œå¦‚æœæ²¡æœ‰åˆ»æ„é…ç½®åˆ™ä»¥é»˜è®¤ç¯å¢ƒä¸ºä¸»ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç¯å¢ƒ application.properties</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒ application-dev.properties</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒ application-prod.properties</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æƒ³è¦åˆ‡æ¢è‡³å¼€å‘ç¯å¢ƒæˆ–è€…ç”Ÿäº§ç¯å¢ƒçš„æ—¶å€™ï¼Œåªéœ€è¦åœ¨é»˜è®¤é…ç½®æ–‡ä»¶ä¸Šæ›´æ”¹å³å¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ application.properties</span></span><br><span class="line"><span class="comment"># æŒ‡å®šä½¿ç”¨devç¯å¢ƒçš„é…ç½®</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure><h4 id="ymlæ–‡æ¡£å—æ ¼å¼">ymlæ–‡æ¡£å—æ ¼å¼</h4><p>é™¤å¼€ properties å’Œ yml é€šç”¨çš„è¿™ç§å¤šæ–‡ä»¶çš„å½¢å¼ï¼Œymlè¿˜å•ç‹¬å­˜åœ¨ä¸€ç§å¤šæ–‡æ¡£å—æ¨¡å¼ï¼Œä»–ä½¿ç”¨ä¸‰ä¸ªå‡å·å°†ä¸€ä¸ªymlé…ç½®æ–‡ä»¶åˆ†å‰²ä¸ºè‹¥å¹²ä»½ï¼Œæ¯ä¸€ä»½å¯ä»£æ›¿ä¸€ä¸ªç¯å¢ƒ</p><p>åŒä¹‹å‰çš„è§„åˆ™ä¸€æ ·ï¼Œä¸‰ä¸ªæ–‡æ¡£å¿«ä¹‹é—´æ²¡æœ‰ä»»ä½•æ“ä½œæ—¶ï¼Œä»¥é»˜è®¤ç¯å¢ƒä¸ºä¸»</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8008</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒï¼Œè¿™ç§é€šè¿‡ --- è¿›è¡Œåˆ†å‰²çš„ç¯å¢ƒï¼Œéœ€è¦ä½¿ç”¨spring.profilesæ¥æŒ‡å®šå½“å‰ç¯å¢ƒæ ‡è¯†</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒï¼Œè¿™ç§é€šè¿‡ --- è¿›è¡Œåˆ†å‰²çš„ç¯å¢ƒï¼Œéœ€è¦ä½¿ç”¨spring.profilesæ¥æŒ‡å®šå½“å‰ç¯å¢ƒæ ‡è¯†</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æƒ³è¦åˆ‡æ¢è‡³å¼€å‘ç¯å¢ƒæˆ–è€…ç”Ÿäº§ç¯å¢ƒçš„æ—¶å€™ï¼Œåªéœ€è¦åœ¨é»˜è®¤é…ç½®æ–‡ä»¶ä¸Šæ›´æ”¹å³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8008</span></span><br><span class="line"><span class="comment"># æŒ‡å®šä½¿ç”¨devç¯å¢ƒçš„é…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><h4 id="æ‰“åŒ…ååŠ¨æ€ä¿®æ”¹ç¯å¢ƒ">æ‰“åŒ…ååŠ¨æ€ä¿®æ”¹ç¯å¢ƒ</h4><p>æˆ‘ä»¬å°†ç¨‹åºæ‰“ä¸ºä¸€ä¸ª jar åŒ…ä¹‹åï¼Œå¯ä»¥åœ¨è¿è¡Œè¯¥ jar åŒ…çš„æ—¶å€™æ¥æŒ‡å®šé€šè¿‡ä»€ä¹ˆç¯å¢ƒè¿è¡Œï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar application.jar --spring.profiles.active=dev</span><br></pre></td></tr></table></figure><p>è¿™ç§å±äºåœ¨è¿è¡Œ jar åŒ…æ—¶åŠ¨æ€æ·»åŠ å‚æ•°è¿›å»ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥è®¾ç½®ç«¯å£å·ä¹‹ç±»çš„ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar application.jar --server.port=<span class="number">8000</span></span><br></pre></td></tr></table></figure><h2 id="SpringBoot-Web-å¼€å‘">SpringBoot Web å¼€å‘</h2><p>springboot å¼€å‘ WEB åº”ç”¨ç¨‹åºéœ€è¦åœ¨ pom.xml ä¸­æ·»åŠ  WEB çš„åœºæ™¯å¯åŠ¨å™¨ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>é™æ€èµ„æºå­˜æ”¾ä½ç½®</p></blockquote><p>åœ¨é€šå¸¸çš„ web å¼€å‘çš„é¡¹ç›®ä¸­éƒ½æœ‰ä¸€ä¸ª webapp çš„ç›®å½•ç”¨æ¥å­˜æ”¾ç½‘é¡µå›¾ç‰‡ç­‰é™æ€èµ„æºï¼Œåœ¨ springboot ä¸­å¯ä»¥å‘ç°åœ¨ resources ç›®å½•ä¸‹æœ‰ä¸€ä¸ª static æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å°±ç±»ä¼¼ webapp ç›®å½•ï¼Œå¯ä»¥å­˜æ”¾é™æ€èµ„æº</p><blockquote><p>ä¼˜å…ˆçº§é—®é¢˜</p></blockquote><p>é™¤å¼€é¡¹ç›®è‡ªå¸¦çš„ static æ–‡ä»¶å¤¹ä¹‹å¤–ï¼Œspringboot è¿˜æä¾›äº†å…¶ä»–çš„æ–‡ä»¶å¤¹æ¥å­˜æ”¾èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥å† resources ç›®å½•ä¸‹æ‰‹åŠ¨åˆ›å»º [ public ] [ resources ]ï¼Œä¼˜å…ˆçº§ä¸ºï¼š<code>resources &gt; static &gt; public</code>ï¼Œå½“è®¿é—®åŒåèµ„æºæ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šè¦†ç›–ä¼˜å…ˆçº§ä½çš„</p><blockquote><p>é¦–é¡µè®¾ç½®</p></blockquote><p>åœ¨ä»¥ä¸Šçš„èµ„æºç›®å½•ä¸­ä»»æ„ä¸€ä¸ªç›®å½•ä¸‹æœ‰ index.html å‘½åçš„æ–‡ä»¶ï¼Œå°±ä¼šè¢«è®¾ç½®ä¸ºé»˜è®¤é¦–é¡µï¼Œå½“æœ‰å¤šä¸ªç›®å½•ä¸­å­˜åœ¨ index.html æ–‡ä»¶ï¼Œé»˜è®¤ä¼˜å…ˆçº§é«˜çš„ä¼šè¢«è®¾ç½®ä¸ºé¦–é¡µ</p><blockquote><p>è‡ªå®šä¹‰é”™è¯¯é¡µ</p></blockquote><p>å½“è¯·æ±‚ä¸å­˜åœ¨çš„èµ„æºæˆ–è€…æœåŠ¡å™¨å¼‚å¸¸æ—¶ä¼šæ˜¾ç¤ºæŠ¥é”™é¡µï¼Œå¯ä»¥å†é™æ€èµ„æºç›®å½•ä¸‹åˆ›å»º <code>error</code> æ–‡ä»¶å¤¹ï¼Œä»¥ <code>404.html</code> <code>500.html</code> å‘½åï¼Œspringboot ä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºè‡ªå®šä¹‰é”™è¯¯é¡µ</p><h2 id="Thymeleaf-æ¨¡æ¿å¼•æ“">Thymeleaf æ¨¡æ¿å¼•æ“</h2><p>Thymeleaf æ˜¯ springboot ä¸­çš„æ¨¡æ¿å¼•æ“ï¼Œä½¿ç”¨æ–¹æ³•ä¸ vue æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå¯ä»¥è·å–åŸŸä¸­çš„ä¿¡æ¯å¹¶åœ¨é¡µé¢ä¸­æ˜¾ç¤ºï¼ŒThymeleaf è‡ªå¸¦çš„è§†å›¾è§£æå™¨ä¸º **resourcesç›®å½•ä¸‹çš„ templates æ–‡ä»¶å¤¹ï¼Œä»¥ html ç»“å°¾</p><p>templates ç›®å½•ä¸‹çš„ html æ–‡ä»¶å±äºæ¨¡æ¿æ–‡ä»¶ï¼Œä¸å¯ä»¥ç›´æ¥è®¿é—®ï¼Œå¿…é¡»é€šè¿‡è§†å›¾è§£æå™¨è§£æåæ‰å¯ä»¥è¿›è¡Œè®¿é—®</p><h3 id="åˆä½“éªŒ-Thymeleaf">åˆä½“éªŒ Thymeleaf</h3><p><strong>1. å¼•ç”¨ï¼š</strong> ä½¿ç”¨ Thymeleaf æ¨¡æ¿è¯­è¨€éœ€è¦å¼•å…¥mavenä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">å»ºè®®Thymeleafç‰ˆæœ¬é«˜äºSpringBootï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="comment">SpringBoot 1 æ­é… Thymeleaf 2</span></span><br><span class="line"><span class="comment">SpringBoot 2 æ­é… Thymeleaf 3</span></span><br><span class="line"><span class="comment">åœ¨SpringBootçš„parentçš„parentä¸­å¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-java8time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2. ä¼ å€¼ï¼š</strong> åœ¨æ§åˆ¶å™¨ç±»ä¸­é€šè¿‡åŠ å…¥Modelå‚æ•°ï¼Œç„¶ååœ¨è·³è½¬é¡µé¢ä¹‹å‰addAttributeæ·»åŠ å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test1</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;thymeleatä¼ å€¼&quot;</span>);</span><br><span class="line">    <span class="comment">// è¿”å›çš„ 1 ä¼šè¢«è§†Thymeleafè§†å›¾è§£æå™¨è§£æä¸º templates/1.html</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. å–å€¼ï¼š</strong> åœ¨htmlé¡µé¢ä¸­è¿›è¡Œå–å€¼æ“ä½œ</p><blockquote><p>ä½¿ç”¨ Thymeleaf æ¨¡æ¿è¯­è¨€éœ€è¦ä»¥ th: ä¸ºå…³é”®å­—å¼€å¤´ï¼Œå¯¹å‚æ•°è¿›è¡Œæ“ä½œ</p></blockquote><blockquote><p>ä½¿ç”¨ th å…³é”®å­—ï¼Œéœ€è¦åœ¨htmlæ ‡ç­¾ä¹‹ä¸Šæ·»åŠ  xmlns:th=â€œ<a href="http://www.thymeleaf.org">http://www.thymeleaf.org</a>â€ å‘½åç©ºé—´</p></blockquote><blockquote><p>è¯»å–å€¼è¿˜å¯ä»¥ä½¿ç”¨ [ [  ] ] æ¥å¯¹å€¼è¿›è¡Œè§£æï¼Œç±»ä¼¼Vueä¸­çš„å·®å€¼è¡¨è¾¾å¼</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg1&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;msg2&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:each</span>=<span class="string">&quot;person : $&#123;persons&#125;&quot;</span>&gt;</span> [[$&#123;person&#125;]] <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Thymeleaf-è§†å›¾è§£æå™¨">Thymeleaf è§†å›¾è§£æå™¨</h3><p>ä½¿ç”¨ Thymeleaf æ¨¡æ¿ä¹¦å†™çš„ html é¡µé¢å¿…é¡»è¦æ”¾åœ¨ templates ç›®å½•ä¸‹ï¼Œè€Œ templates ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸å¯ä»¥è¢«ç›´æ¥è®¿é—®ï¼Œéœ€è¦é€šè¿‡è§†å›¾è§£æå™¨è¿›è¡Œç›®å½•è§£æåæ‰å¯ä»¥è¿›è¡Œè®¿é—®</p><p><strong>è‡ªå®šä¹‰è§†å›¾è§£æå™¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyViewConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry regi)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         å®ç°äº†WebMvcConfigurationæ¥å£åå¤å†™å…¶ä¸­çš„addViewControllersæ–¹æ³•</span></span><br><span class="line"><span class="comment">         é€šè¿‡æ–¹æ³•å†…æä¾›çš„å‚æ•°è¿›è¡Œè§†å›¾è§£æï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</span></span><br><span class="line"><span class="comment">         å°†/index.htmlè¯·æ±‚è§£æä¸ºindexè¯·æ±‚</span></span><br><span class="line"><span class="comment">         è¢«è§£æçš„indexä¼šè‡ªåŠ¨æ‰¾åˆ°templatesç›®å½•ä¸‹ä»¥htmlç»“å°¾çš„index</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        regi.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        regi.addViewController(<span class="string">&quot;/main.html&quot;</span>).setViewName(<span class="string">&quot;dashboard&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½¬å‘ä¸é‡å®šå‘çš„æ³¨æ„äº‹é¡¹</p><ol><li>redirect é‡å®šå‘çš„æ—¶å€™ï¼Œ<em>æœ‰ / ä¸ºé‡å®šå‘åˆ°æ ¹ç›®å½•çš„èµ„æºï¼Œæ—  / ä¸ºé‡å®šå‘åˆ°å½“å‰ç›®å½•ä¸‹çš„èµ„æº</em></li><li>forward è½¬å‘ï¼Œ<em>æ— è®ºæ˜¯å¦æœ‰ / éƒ½æ˜¯æŒ‡å‘æ ¹ç›®å½•çš„èµ„æº</em></li></ol><h3 id="Thymeleaf-å¸®åŠ©">Thymeleaf å¸®åŠ©</h3><p>æŒ‡ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">th:text  ä»¥æ™®é€šæ–‡æœ¬å½¢å¼æ¥æ”¶å€¼</span><br><span class="line">th:utext æ¥æ”¶å€¼åå¯ä»¥è§£æä¸ºhtml</span><br><span class="line">th:each  éå†æ¥æ”¶åˆ°çš„å®¹å™¨ï¼Œé›†åˆæ•°ç»„ç­‰ ( å˜é‡ : $&#123;å®¹å™¨å&#125; )</span><br><span class="line"></span><br><span class="line">th:fragment=&quot;name&quot; å°†å½“å‰æ ‡ç­¾åŠå­æ ‡ç­¾å†…çš„æ‰€æœ‰å…ƒç´ å°è£…ä¸ºä¸€ä¸ªç»„ä»¶(ä¸å½±å“å½“å‰é¡µ)ï¼Œå¯ä»¥åœ¨å…¶ä»–é¡µé¢å¼•ç”¨name</span><br><span class="line">th:insert=&quot;&quot; å¼•ç”¨çš„æ–¹å¼é€šè¿‡nameä½¿ç”¨å…¶ä»–é¡µé¢å°è£…çš„ç»„ä»¶ï¼Œä¸€èˆ¬ä½œç”¨åœ¨divä¸­ï¼Œç„¶åç»„ä»¶ä¼šå¡«å……åˆ°divå†…éƒ¨</span><br><span class="line">th:replace=&quot;&quot; æ›¿æ¢çš„æ–¹å¼é€šè¿‡nameä½¿ç”¨å…¶ä»–é¡µé¢å°è£…çš„ç»„ä»¶ï¼Œä¸€èˆ¬ä½œç”¨åœ¨divä¸­ï¼Œç„¶åç»„ä»¶ä¼šå°†å½“å‰dibæ ‡ç­¾æ›¿æ¢</span><br></pre></td></tr></table></figure><p>å„ç§å–å€¼ â€“ th æ ‡è¯†åæ‰å¯ä»¥ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;  &#125;  è¡¨è¾¾å¼è¯­å¥ï¼Œå¯ä»¥ä¹¦å†™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ifåˆ¤æ–­ï¼Œä¸‰å…ƒè¿ç®—ï¼Œä¹Ÿå¯ä»¥è·å–ä¼ å…¥çš„å‚æ•°</span><br><span class="line">@&#123;/ &#125;  è¡¨ç¤ºè¶…é“¾æ¥ï¼Œåœ¨ä¼ å‚çš„æ—¶å€™ä¸éœ€è¦ä½¿ç”¨é—®å¥½ï¼Œéœ€ä½¿ç”¨æ‹¬å·(key=&#x27;value&#x27;)</span><br><span class="line">#&#123;  &#125;  å›½é™…åŒ–æ¶ˆæ¯è¡¨è¾¾å¼ï¼Œç”¨æ¥è·å–propertiesé…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯</span><br><span class="line">~&#123; :: &#125;  ç”¨æ¥å®ç°ç»„ä»¶åŒ–ä¿¡æ¯ï¼Œ::çš„å·¦ä¾§ç”¨æ¥å¡«å†™ç»„ä»¶æ‰€åœ¨é¡µé¢ï¼Œå³ä¾§å¡«å†™ç»„ä»¶çš„åç§°</span><br></pre></td></tr></table></figure><p>Thymleaf çš„å·¥å…·ç±» â€“ #å·å¼€å¤´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#datas.format(date,str)&#125; æ—¶é—´æ ¼å¼åŒ–ï¼ŒæŒ‰ç…§æŒ‡å®šæ ¼å¼è¾“å‡ºdata</span><br></pre></td></tr></table></figure><h3 id="Thymeleaf-çš„å›½é™…åŒ–">Thymeleaf çš„å›½é™…åŒ–</h3><p>åœ¨å…¶ä»–å¤§å‹ç½‘ç«™ä¸Šå‡ ä¹éƒ½å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢ä¸Šæœ‰ä¸ªæ ‡è¯†å¯ä»¥è®¾ç½®å½“å‰é¡µé¢æ˜¾ç¤ºçš„è¯­è¨€ï¼Œè¿™é‡Œå°±æ˜¯ç”¨åˆ°äº†å›½é™…åŒ– (i18n) çš„æŠ€æœ¯ï¼Œå›½é™…åŒ–æ˜¯åœ¨èµ„æºç›®å½•ä¸­åˆ›å»º N å¤šä¸ª properties é…ç½®æ–‡ä»¶æ–‡ä»¶ï¼Œå°†å„å›½è¯­è¨€åˆ†åˆ«æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼è¿›è¡Œå­˜æ”¾ï¼Œç„¶åå°†é…ç½®æ–‡ä»¶ä¸­çš„å­—ç¬¦æå–åˆ°é¡µé¢ä¸Šæ¥ï¼Œä¾¿å®ç°äº†å›½é™…åŒ–æ•ˆæœ</p><img src="/img/3.jpg" /><p>åœ¨è¯­è¨€ä¿®æ”¹å®Œæˆååœ¨ application.properties ä¸­è®¾ç½®å›½é™…åŒ–é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šä¿¡æ¯è½¬æ¢ç›®æ ‡</span></span><br><span class="line"><span class="attr">spring.messages.basename</span>=<span class="string">i18n.login</span></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ä¸€ä¸ª<strong>åœ°å€æ˜ å°„ç±»</strong>ï¼Œå®ç° LocaleResolver æ¥å£ï¼Œç”¨æ¥åˆ†æè¯·æ±‚å¹¶è®¾ç½®å½“å‰é¡µé¢æ˜¾ç¤ºçš„è¯­è¨€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Language</span> <span class="keyword">implements</span> <span class="title class_">LocaleResolver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Locale <span class="title function_">resolveLocale</span><span class="params">(HttpServletRequest req)</span> &#123;</span><br><span class="line">        <span class="comment">// ç±»ä¼¼ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œé€šè¿‡é¡µé¢çš„ä¼ å€¼æ¥åˆ¤æ–­æ˜¯å¦å¯¹è¯­è¨€è¿›è¡Œä¿®æ”¹</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">language</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;language&quot;</span>);</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Locale</span>(<span class="string">&quot;en&quot;</span>,<span class="string">&quot;US&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;[Debug] language=&quot;</span> + language);</span><br><span class="line">        <span class="keyword">if</span>( language != <span class="literal">null</span> )</span><br><span class="line">            locale = <span class="keyword">new</span> <span class="title class_">Locale</span>(language.split(<span class="string">&quot;_&quot;</span>)[<span class="number">0</span>],language.split(<span class="string">&quot;_&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åå¯ä»¥<strong>éœ€è¦å°†åœ°å€æ˜ å°„ç±»è£…é…åˆ° Ioc å®¹å™¨ä¸­</strong>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ <font color="red">åœ°å€æ˜ å°„ç±»çš„ name å¿…é¡»æ˜¯ localeResolverÂ </font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// æ ‡æ³¨é…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyViewConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;localeResolver&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Language <span class="title function_">language</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Language</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ååªéœ€è¦åœ¨é¡µé¢ä¸­ä½¿ç”¨ Thymeleaf æ¨¡æ¿æ¥è·å–é…ç½®æ–‡ä»¶ä¸­çš„å€¼å¹¶è¾“å‡ºåœ¨é¡µé¢ä¸Šå³å¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- thçš„å‘½åç©ºé—´å¿…é¡»è¦å¯¼å…¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¯ä»¥é€šè¿‡ç»‘å®štextå±æ€§ä½¿ç”¨ #&#123; &#125; è·å–å€¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¬å·çš„å½¢å¼ç›´æ¥è¾“å‡ºå€¼ --&gt;</span></span><br><span class="line">        [[ #&#123; login.msg &#125; ]]</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="SpringBoot-çš„æ‹¦æˆªå™¨">SpringBoot çš„æ‹¦æˆªå™¨</h2><p>åœ¨ SpringBoot ä¸­ä½¿ç”¨ MVC çš„æ‹¦æˆªå™¨ï¼ŒåŒæ ·éœ€è¦å®ç° <code>HandlerInterceptor</code> æ¥å£ï¼ŒåŒæ ·ä¹Ÿè¦å¤å†™å…¶ä¸­çš„æ–¹æ³•ï¼Œé€šè¿‡é€»è¾‘ä»£ç åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦å¯ä»¥è®¿é—®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest req, HttpServletResponse resp, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‹¦æˆªå™¨å¼€å§‹å·¥ä½œ&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ( req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) == <span class="literal">null</span> )&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‹¦æˆªäº†ä¸€æ¬¡è¯·æ±‚&quot;</span>);</span><br><span class="line">            req.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;è¯·ç™»å½•ååœ¨è¿›è¡Œæ“ä½œ&quot;</span>);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/index.html&quot;</span>).forward(req, resp);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åçš„æ³¨å†Œæ‹¦æˆªå™¨ï¼Œéœ€è¦é€šè¿‡é…ç½®ç±»å¤å†™ <code>addInterceptors</code> æ–¹æ³•è¿›è¡Œæ³¨å†Œï¼Œæ˜¯å¦è¢«æ‹¦æˆªå™¨æ’é™¤ï¼Œæ‹¦æˆªå™¨éƒ½ä¼šè¿›è¡Œæ‹¦æˆªï¼Œåªä¸è¿‡æ»¡è¶³æ¡ä»¶çš„åœ¨è¢«æ‹¦æˆªå™¨æ‹¦æˆªåè¿˜æ˜¯ä¼šæ­£å¸¸å·¥ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// æ ‡æ³¨é…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyViewConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">        <span class="type">InterceptorRegistration</span> <span class="variable">interceptor</span> <span class="operator">=</span> </span><br><span class="line">                 registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">MyInterceptor</span>());</span><br><span class="line">        <span class="comment">// æ‹¦æˆªå…¨éƒ¨è¯·æ±‚</span></span><br><span class="line">        interceptor = interceptor.addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">        <span class="comment">// æ’é™¤æŒ‡å®šçš„å‡ ä¸ªè¯·æ±‚</span></span><br><span class="line">        interceptor.excludePathPatterns(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/index&quot;</span>, <span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/asserts/**&quot;</span>, <span class="string">&quot;/1.html&quot;</span>, <span class="string">&quot;/2.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SpringBoot-ä¸­ä½¿ç”¨-AOP">SpringBoot ä¸­ä½¿ç”¨ AOP</h2><p>åœ¨ SpringBoot ä¸­ä½¿ç”¨ aop é¢å‘åˆ‡é¢ç¼–ç¨‹éœ€è¦å¼•å…¥å¯¹åº”çš„ starter å¯åŠ¨å™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>è¿™é‡Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ Java çš„ JDK åŠ¨æ€ä»£ç†æ¨¡å¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨ CGLIB éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p></li><li><pre><code class="language-properties">spring.aop.proxy-target-class=true<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç°åœ¨å°±å¯ä»¥ä¹¦å†™åˆ‡é¢ç±»äº†ï¼Œå› ä¸º springboot ä¼˜äºé…ç½®ç®€åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨æ³¨è§£çš„æ–¹å¼è¿›è¡Œ aop åˆ‡å…¥</span><br><span class="line"></span><br><span class="line">&gt; ä½¿ç”¨ `@Aspect` æ³¨è§£æ¥æ ‡è¯†å½“å‰ç±»æ˜¯åˆ‡é¢ç±»ï¼Œç„¶ååœ¨ä½¿ç”¨ `@Component` å°†åˆ‡é¢ç±»äº¤ç»™ Spring è¿›è¡Œç®¡ç†å³å¯</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class Aop1 &#123;</span><br><span class="line">    @Before(&quot;execution(public * site.hanzhe.service..*(..))&quot;)</span><br><span class="line">    public void before(JoinPoint join)&#123;</span><br><span class="line">        System.out.println(&quot;[Debug] &quot;+join.getSignature().getName()+&quot; æ–¹æ³•æ‰§è¡Œ&quot;);</span><br><span class="line">        System.out.println(&quot;[Debug] æ‰§è¡Œæ—¶é—´ï¼š&quot; + </span><br><span class="line">                           new SimpleDateFormat().format(new Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">è‡³æ­¤ aop å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼Œå¦‚æœå‘ç° aop ä¸ç”Ÿæ•ˆå¯ä»¥å°è¯•åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span><br><span class="line"></span><br><span class="line">&gt; å› ä¸ºè¯¥é€‰é¡¹æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸éœ€è¦å»æ›´æ”¹ä»–ï¼Œä½†æ˜¯å½“aopæ— æ•ˆçš„æ—¶å€™å¯ä»¥å°è¯•æ‰‹åŠ¨å¼€å¯ä»–</span><br><span class="line"></span><br><span class="line">~~~properties</span><br><span class="line"># å¼€å¯SpringBootçš„aopåŠŸèƒ½</span><br><span class="line">spring.aop.auto=true</span><br></pre></td></tr></table></figure></code></pre></li></ul><h2 id="SpringBoot-çš„è¿‡æ»¤å™¨">SpringBoot çš„è¿‡æ»¤å™¨</h2><p>åœ¨ SpringBoot ä¸­åˆ›å»ºè¿‡æ»¤å™¨ç±»ï¼Œé‚£ä¹ˆè¯¥ç±»é¦–å…ˆè¦å®ç° Filter æ¥å£ï¼Œç„¶åé…åˆæ³¨è§£è¿›è¡Œä½¿ç”¨</p><blockquote><p>å®ç° Filter æ¥å£ï¼Œä½¿ç”¨ <code>@WebFilter(&quot;/*&quot;)</code> ç”Ÿå‘½ä»–æ˜¯è¿‡æ»¤å™¨ï¼Œç„¶åé…åˆ <code>@Order(1)</code> æ¥æŒ‡å®šä¼˜å…ˆçº§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. å¿…é¡»å®ç°Filteræ¥å£ï¼Œç„¶åæ·»åŠ æ³¨è§£ <span class="doctag">@WebFilter</span> æ³¨è§£</span></span><br><span class="line"><span class="comment"> *    1.1 urlPatterns ä¸ºè®¾ç½®çš„URLåŒ¹é…è§„åˆ™</span></span><br><span class="line"><span class="comment"> *    1.2 filterName ä¸ºFilterçš„åç§°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2. <span class="doctag">@Order</span>() æ³¨è§£ï¼Œé…åˆ <span class="doctag">@WebFilter</span> æ³¨è§£ä½¿ç”¨ï¼Œç”¨äºå¤šä¸ªè¿‡æ»¤å™¨æ—¶å®šä¹‰æ‰§è¡Œé¡ºåºï¼Œå€¼è¶Šå°è¶Šå…ˆæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, </span></span><br><span class="line"><span class="params">            ServletResponse servletResponse, </span></span><br><span class="line"><span class="params">            FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®å¥½è¿‡æ»¤å™¨ä¹‹åè¿˜è¦åœ¨å¯åŠ¨ç±»ä¸­ä½¿ç”¨ <code>@ServletComponentScan</code> è¿›è¡Œæ‰«æï¼Œè¢«æ‰«æåˆ°çš„ç±»æ‰å¯ä»¥ç”Ÿæ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ServletComponentScan(&quot;site.hanzhe.filter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot03Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot03Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»å…¸ï¼šå¤„ç†è·¨åŸŸè¯·æ±‚è¿‡æ»¤å™¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(</span></span><br><span class="line"><span class="params">            ServletRequest request,</span></span><br><span class="line"><span class="params">            ServletResponse response, FilterChain chain)</span></span><br><span class="line">   <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">  <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">  <span class="type">HttpServletResponse</span> <span class="variable">resp</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">  resp.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, req.getHeader(<span class="string">&quot;origin&quot;</span>));</span><br><span class="line">  resp.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"><span class="comment">//  resp.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;*&quot;);</span></span><br><span class="line"><span class="comment">//  resp.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</span></span><br><span class="line">  chain.doFilter(req, resp);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SpringBoot-æŒä¹…åŒ–">SpringBoot æŒä¹…åŒ–</h2><h3 id="æ•´åˆ-JDBC">æ•´åˆ JDBC</h3><p>åœ¨ SpringBoot ä¸­æ•´åˆ JDBC éå¸¸ç®€å•ï¼Œçœå»äº†ç¹ççš„ xml é…ç½®æ–‡ä»¶</p><h4 id="ç®€å•é…ç½®-JDBC">ç®€å•é…ç½® JDBC</h4><p><strong>1. åœ¨åˆ›å»º SpringBoot æ—¶å‹¾é€‰ JDBC å’ŒæŒ‡å®šæ•°æ®åº“é©±åŠ¨</strong></p><img src="/img/4.jpg" /><p><strong>2. åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ•°æ®æºç›¸å…³ä¿¡æ¯</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"># é«˜ç‰ˆæœ¬çš„SprignBootä¼šé»˜è®¤ç»§æ‰¿8ç‰ˆæœ¬ä»¥ä¸Šçš„MySQLé©±åŠ¨ï¼Œéœ€è¦åœ¨urlåé¢åŠ ä¸Šæ—¶åŒº serverTimezone=UTC</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mydb?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">zhang</span></span><br><span class="line"><span class="comment"># è¿™é‡Œå¯ä»¥æŒ‡å®šä½¿ç”¨jdbcæ—¶é€‰ç”¨çš„æ•°æ®æº # é»˜è®¤æ•°æ®æºä¸ºHikari</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string"></span></span><br></pre></td></tr></table></figure><p><strong>3. è¿™æ ·ä¸€æ¥ JDBC å°±å·²ç»é…ç½®å®Œæˆï¼Œåªéœ€è¦è¿›è¡Œæµ‹è¯•å³å¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationMainTests</span> &#123;</span><br><span class="line">    <span class="comment">// SpringBootä¸­éƒ½æ˜¯é…ç½®å¥½çš„ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±å¯ä»¥</span></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> DataSource ds;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ•°æ®æºï¼š&quot;</span> + ds);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> ds.getConnection();</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥å™¨ï¼š&quot;</span> + conn);</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">pre</span> <span class="operator">=</span> conn.prepareStatement(<span class="string">&quot;SELECT * FROM t_user&quot;</span>);</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">result</span> <span class="operator">=</span> pre.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (result.next())&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;ID = &quot;</span> + result.getInt(<span class="number">1</span>));</span><br><span class="line">            System.out.print(<span class="string">&quot;, å§“å=&quot;</span> + result.getString(<span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JdbcTemplate-æ¨¡æ¿">JdbcTemplate æ¨¡æ¿</h4><p>SpringBoot æä¾›äº†é¢„ç½®å¥½çš„jdbcæ¨¡æ¿ï¼Œå«åš JdbcLate ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ¨¡æ¿å¿«é€Ÿçš„å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationMainTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> JdbcTemplate jt;</span><br><span class="line"> <span class="meta">@Test</span>   <span class="comment">// æŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list_map = jt.queryForList(<span class="string">&quot;select * from t_user&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map map : list_map)</span><br><span class="line">            System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span>   <span class="comment">// æ·»åŠ </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_user values (null, ?, ?, ?, ?, &#x27;guest&#x27;)&quot;</span>;</span><br><span class="line">        String []arr = &#123;<span class="string">&quot;æ¥šæ˜“&quot;</span>,<span class="string">&quot;46514&quot;</span>,<span class="string">&quot;sadlj&quot;</span>,<span class="string">&quot;30000&quot;</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> jt.update(sql, arr);</span><br><span class="line">        System.out.println(i==<span class="number">1</span> ? <span class="string">&quot;æ‰§è¡ŒæˆåŠŸï¼&quot;</span> + i + <span class="string">&quot;è¡Œæ”¶åˆ°å½±å“&quot;</span> : <span class="string">&quot;æ‰§è¡Œå¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•´åˆ-MyBatis">æ•´åˆ MyBatis</h3><p>ä½¿ç”¨ SpringBoot æ•´åˆMyBatis éœ€è¦åˆ›å»ºé¡¹ç›®æ—¶å‹¾é€‰ mybatis æˆ–è€…ç›´æ¥æ·»åŠ  maven ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>1. åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰æ•°æ®åº“çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åé…ç½® mybatis çš„æ•´åˆ</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql:///mydb</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">zhang</span></span><br><span class="line"><span class="comment"># é…ç½®æ•´åˆMyBatis</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">site.hanzhe.bean</span>  <span class="comment"># åˆ«å</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*Mapper.xml</span> <span class="comment"># mapperæ˜ å°„è·¯å¾„</span></span><br><span class="line">  <span class="attr">configuration:</span> <span class="comment"># setting è®¾ç½®</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment"># æ—¥å¿—</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span> <span class="comment"># å¼€å¯é©¼å³°å‘½å</span></span><br></pre></td></tr></table></figure><p><strong>2. å¯¹åº”æ•°æ®è¡¨åˆ›å»ºå“åº”çš„ pojo</strong></p><blockquote><p>è¿™é‡Œä½¿ç”¨ Lombok ç”Ÿæˆçš„ get set toString ç­‰æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer rmb;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. ä¹¦å†™æ¥å£</strong></p><blockquote><p>æ¥å£éœ€è¦ä½¿ç”¨ Mapper æ³¨è§£æ¥æ ‡è¯†æ¥å£å¼€å‘ï¼ŒåŒæ—¶è¦ä½¿ç”¨ Repository æ³¨è§£å°†è¯¥æ¥å£äº¤ç»™ Spring ç®¡ç†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAllUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœåœ¨ä¸é€‚ç”¨ Mapper æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨å¯åŠ¨ç±»ä¸­ä½¿ç”¨ MapperScan æ¥æ‰¹é‡æ‰«ææ‰€æœ‰ mapper æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;site.hanzhe.dao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ApplicationMain.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4. å¯¹åº”æ¥å£å†™ mapper æ˜ å°„æ–‡ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;site.hanzhe.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select * from t_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>5. æµ‹è¯•ç±»</strong></p><blockquote><p>SpringBoot è‡ªåŠ¨å®Œæˆäº†æ‰€æœ‰æ“ä½œï¼Œåªéœ€è¦ç›´æ¥è°ƒç”¨ dao å°±å¯ä»¥å®Œæˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationMainTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> UserDao dao;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        List&lt;User&gt; list = dao.findAllUser();</span><br><span class="line">        <span class="keyword">for</span> (User u : list)</span><br><span class="line">            System.out.println(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PageHelper-æ’ä»¶">PageHelper æ’ä»¶</h3><p>åœ¨ springboot ä¸­æ•´åˆ mybatis æ—¶åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ PageHelper è¿›è¡Œåˆ†é¡µï¼Œå¯¼å…¥ springboot çš„åˆ†é¡µæ’ä»¶ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äº springboot ä¸éœ€è¦ä¹¦å†™ mybatis çš„é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥æœ‰å…³åˆ†é¡µçš„é…ç½®éƒ½åœ¨ properties æˆ– yml ä¸­è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ‡è¯†æ˜¯å“ªä¸€ç§æ•°æ®åº“</span></span><br><span class="line"><span class="attr">pagehelper.helperDialect</span>=<span class="string">mysql</span></span><br><span class="line"><span class="comment">#å¯ç”¨åˆç†åŒ–ï¼Œå¦‚æœpageNum&lt;1ä¼šæŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œå¦‚æœpageNum&gt;pagesä¼šæŸ¥è¯¢æœ€åä¸€é¡µ</span></span><br><span class="line"><span class="attr">pagehelper.reasonable</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#ä¸ºäº†æ”¯æŒstartPage(Object params)æ–¹æ³•ï¼Œå¢åŠ äº†è¯¥å‚æ•°æ¥é…ç½®å‚æ•°æ˜ å°„</span></span><br><span class="line"><span class="attr">pagehelper.params</span>=<span class="string">count=countSql</span></span><br><span class="line"><span class="comment">#æ”¯æŒé€šè¿‡ Mapper æ¥å£å‚æ•°æ¥ä¼ é€’åˆ†é¡µå‚æ•°ï¼Œé»˜è®¤å€¼falseï¼Œåˆ†é¡µæ’ä»¶ä¼šä»æŸ¥è¯¢æ–¹æ³•çš„å‚æ•°å€¼ä¸­ï¼Œè‡ªåŠ¨æ ¹æ®ä¸Šé¢ params é…ç½®çš„å­—æ®µä¸­å–å€¼ï¼ŒæŸ¥æ‰¾åˆ°åˆé€‚çš„å€¼æ—¶å°±ä¼šè‡ªåŠ¨åˆ†é¡µ</span></span><br><span class="line"><span class="attr">pagehelper.supportMethodsArguments</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#å¦‚æœ pageSize=0 å°±ä¼šæŸ¥è¯¢å‡ºå…¨éƒ¨çš„ç»“æœï¼ˆç›¸å½“äºæ²¡æœ‰æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="attr">pagehelper.page-size-zero</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>è¿™æ · springboot çš„ PageHelper å°±é…ç½®å®Œæˆäº†ï¼å…³äº PageHelper æ›´å¤šä½¿ç”¨æ–¹æ³•åœ¨ mybatis ä¸­æŸ¥çœ‹</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mybatisç¬”è®°</title>
    <link href="/2021/05/23/MyBatis%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/05/23/MyBatis%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>MyBatis ç¬”è®°</h1><p>MyBatis æ˜¯åŸºäº Java è¯­è¨€çš„å¼€æºçš„æŒä¹…å±‚æ¡†æ¶ï¼Œåˆ©ç”¨å®ä½“ç±»å’Œæ•°æ®è¡¨ä¹‹é—´äº§ç”Ÿäº†å…³è”ï¼Œé€šè¿‡æ˜ å°„æ–‡ä»¶ä¸­çš„ sql è¯­å¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ</p><p>ä½¿ç”¨ maven åˆ›å»ºå·¥ç¨‹éœ€è¦å¯¼å…¥ <code>mybatis</code> çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç®€å•å®ä¾‹æ¼”ç¤º">ç®€å•å®ä¾‹æ¼”ç¤º</h2><p>mybatisçš„æŒä¹…å±‚å¼€å‘æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸå§‹çš„ dao å¼€å‘ï¼Œæ¯”è¾ƒç¹çï¼Œè¿˜æœ‰ä¸€ç§æ˜¯åŸºäºæ¥å£çš„ JDK åŠ¨æ€ä»£ç†å¼€å‘ï¼Œä¹Ÿæ˜¯æœ€æ™®éçš„ä¸€ç§å¼€å‘æ¨¡å¼</p><h3 id="åŸå§‹daoå¼€å‘æ¨¡å¼">åŸå§‹daoå¼€å‘æ¨¡å¼</h3><p><strong>ä½¿ç”¨åŸå§‹ dao å¼€å‘æ¨¡å¼ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥ï¼š åˆ›å»º mybatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬å–åä¸º</strong> <code>mybatis-config.xml</code></p><blockquote><p>åœ¨dataSourceæ ‡ç­¾ä¸­é…ç½®æ•°æ®åº“è¿æ¥ï¼Œåœ¨mapperæ ‡ç­¾ä¸­é…ç½®xmlæ˜ å°„æ–‡ä»¶ç›®å½•ï¼Œç„¶åå»ä¹¦å†™xmlæ˜ å°„æ–‡ä»¶</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///test&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhang&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/beanMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥ï¼šåœ¨ä¸Šé¢çš„æ˜ å°„æ–‡ä»¶ç›®å½•å¯¹åº”çš„ä½ç½®åˆ›å»ºæ–‡ä»¶</strong></p><blockquote><p>mapper æ ‡ç­¾çš„ namespace å±æ€§è‡ªå®šä¹‰ä¹¦å†™ï¼Œselect æ ‡ç­¾çš„ id ä¸èƒ½ä¸å…¶ä»– id é‡å¤ï¼ŒresultType æ˜¯å’Œæ•°æ®åº“è¡¨å¯¹åº”çš„å®ä½“ç±»çš„å…¨é™å®šè·¯å¾„åï¼Œå®ä½“ç±»ä»…ä»…åªæœ‰å’Œè¡¨ä¸­å­—æ®µå¯¹åº”çš„å±æ€§åŠ get set toString æ–¹æ³•è€Œå·²</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;test1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;club.hanzhe.bean.Bean&quot;</span>&gt;</span></span><br><span class="line">        select * from test1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºdaoç±»ï¼Œé€šè¿‡daoæ¥å£ç±»æ¥æ“ä½œ mapper æ–‡ä»¶ä¸­çš„å¢åˆ æ”¹æŸ¥</strong></p><blockquote><p>daoç±»æƒ³è¦æ“ä½œmapperæ–‡ä»¶éœ€è¦ä½¿ç”¨å·¥å‚å¯¹è±¡ï¼Œå·¥å‚å¯¹è±¡æš‚æ—¶å°±ä¸åœ¨è¿™é‡Œåˆ›å»ºäº†ï¼Œç”±è°ƒç”¨è€…ç»™ä»–å¯¹è±¡è®©ä»–ä½¿ç”¨å°±è¡Œ</p><p>æ“ä½œmapperæ–‡ä»¶éœ€è¦ä½¿ç”¨mapperæ–‡ä»¶çš„ ==namespace.æ ‡ç­¾id==ï¼Œä¾‹å¦‚ ==test1.findAll==</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory ;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BeanDao</span><span class="params">( SqlSessionFactory factory )</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Bean&gt; <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        List&lt;Bean&gt; list = sqlSession.selectList(<span class="string">&quot;test1.findAll&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬å››æ­¥ï¼šåˆ›å»ºæµ‹è¯•ç±»ï¼Œå¯¹å†™å¥½çš„ä»£ç è¿›è¡Œæµ‹è¯•</strong></p><blockquote><p>å› ä¸ºè°ƒç”¨ä¸€ä¸ªdaoéƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥åˆ›å»ºä¸€ä¸ªä¾›æ‰€æœ‰daoä½¿ç”¨ï¼ŒèŠ‚çœèµ„æº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–é…ç½®æ–‡ä»¶å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        factory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tes1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">BeanDao</span> <span class="variable">dao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDao</span>(factory);</span><br><span class="line">        List&lt;Bean&gt; list = dao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Bean bean : list)</span><br><span class="line">            System.out.println(bean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†å¼€å‘">åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†å¼€å‘</h3><p><strong>ä½¿ç”¨åŠ¨æ€ä»£ç†å¼€å‘æ¨¡å¼ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥ï¼š åˆ›å»º mybatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬å–åä¸º <code>mybatis-config.xml</code></strong></p><blockquote><p>è¿™é‡Œå’Œ dao å¼€å‘çš„é…ç½®æ–‡ä»¶ä¸€æ¨¡ä¸€æ ·ï¼Œå¯ä»¥å»ä¸Šé¢ copy</p></blockquote><p><strong>ç¬¬äºŒæ­¥ï¼šåœ¨ä¸Šé¢çš„æ˜ å°„æ–‡ä»¶ç›®å½•å¯¹åº”çš„ä½ç½®åˆ›å»ºæ˜ å°„æ–‡ä»¶</strong></p><blockquote><p>è¿™é‡Œå’Œä¸Šé¢å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯åŠ¨æ€ä»£ç†çš„ mapper çš„ namespace æŒ‡å‘çš„å¿…é¡»æ˜¯æ¥å£çš„å…¨é™å®šåç§°</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;club.hanzhe.dao.BeanDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;club.hanzhe.bean.Bean&quot;</span>&gt;</span></span><br><span class="line">        select * from test1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰æ­¥ï¼šæŒ‰ç…§ä¸Šé¢æ˜ å°„æ–‡ä»¶ç›®å½•åˆ›å»ºæ¥å£</strong></p><blockquote><p>è¿™é‡Œå’Œä¸Šé¢ä¸åŒçš„æ˜¯ä¸éœ€è¦å¤ªå¤šç¹ççš„ç»“æ„ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–¹æ³•å³å¯å¯¹åº”mapperä¸­çš„å¢åˆ æ”¹æŸ¥ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼š==æ¥å£æ–¹æ³•åå¿…é¡»å’Œmapperçš„CRUDæ ‡ç­¾idä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™==</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDao</span> &#123;</span><br><span class="line">    List&lt;Bean&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬å››æ­¥ï¼šåˆ›å»ºæµ‹è¯•ç±»ï¼Œå¯¹å†™å¥½çš„ä»£ç è¿›è¡Œæµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            is = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶å¤±è´¥&quot;</span>);</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.factory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="type">BeanDao</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(BeanDao.class);</span><br><span class="line">        List&lt;Bean&gt; list = mapper.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Bean bean : list)</span><br><span class="line">            System.out.println(bean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="red">æ³¨æ„ï¼š</font>åœ¨ openSession çš„æ—¶å€™æ˜¯å¯ä»¥ä¼ å…¥ä¸€ä¸ª boolean å‚æ•°çš„ï¼Œå¦‚æœä¸ä¼ å‚æ•°é»˜è®¤ä¸º falseï¼Œå¦‚æœè¦æ‰§è¡Œ DML è¯­å¥è¿›è¡Œå¢åˆ æ”¹çš„è¯ï¼Œä¸€å®šè¦ä¼ å…¥ true åšä¸ºå‚æ•°ï¼Œå¦åˆ™ä»–ä¸ä¼šè‡ªåŠ¨æäº¤ ( ä½ å¯ä»¥æ‰‹åŠ¨æäº¤ )ï¼ŒæŸ¥è¯¢æ— éœ€æäº¤æ‰€ä»¥ä¸éœ€è¦è®¾ç½®</p><h2 id="Mybatis-çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶">Mybatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶</h2><p>mybatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½èµ·åä¸º <code>mybatis-config.xml</code> æˆ–è€…æ˜¯ <code>sqlMapConfig.xml</code> ï¼Œåœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡æŸäº›æ ‡ç­¾å¯¹ mybatis è¿›è¡Œä¸€äº›é…ç½®</p><p>==æ³¨æ„ï¼šmybatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶å†…ä¸å¯ä»¥ä¹¦å†™ä¸­æ–‡æ³¨é‡Š (è‹±æ–‡æˆ–æ•°å­—å¯ä»¥)ï¼Œå¦åˆ™æŠ¥é”™==</p><p>mybatis æä¾›äº†å¾ˆå¤šæ ‡ç­¾è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯è¿™äº›æ ‡ç­¾ä¹Ÿæœ‰ç€å…ˆåé¡ºåºï¼Œå¦‚æœæ ‡ç­¾ä¸æŒ‰é¡ºåºä¹¦å†™ä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„</p><ul><li>configurationï¼ˆé…ç½®æ–‡ä»¶çš„æ ¹æ ‡ç­¾ï¼‰<ul><li>propertiesï¼ˆå±æ€§)</li><li>settingsï¼ˆè®¾ç½®)</li><li>typeAliasesï¼ˆç±»å‹åˆ«å)</li><li>typeHandlersï¼ˆç±»å‹å¤„ç†å™¨)</li><li>objectFactoryï¼ˆå¯¹è±¡å·¥å‚)</li><li>pluginsï¼ˆæ’ä»¶)</li><li>environmentsï¼ˆç¯å¢ƒé…ç½®ï¼‰<ul><li>environmentï¼ˆç¯å¢ƒå˜é‡ï¼‰<ul><li>transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†å™¨ï¼‰</li><li>dataSourceï¼ˆæ•°æ®æºï¼‰</li></ul></li></ul></li><li>databaseIdProviderï¼ˆæ•°æ®åº“å‚å•†æ ‡è¯†)</li><li>mappersï¼ˆæ˜ å°„å™¨ï¼‰</li></ul></li></ul><p>ä¸Šé¢æ¥è‡ª mybatis å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œä¼šæŒ‘å¸¸ç”¨çš„æ ‡ç­¾è¿›è¡Œç¬”è®°</p><h3 id="Environments-ç¯å¢ƒé…ç½®">Environments ç¯å¢ƒé…ç½®</h3><h4 id="1-ç¯å¢ƒçš„é€‰æ‹©">1. ç¯å¢ƒçš„é€‰æ‹©</h4><p>åœ¨ mybatis é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ <code>environments</code> æ ‡ç­¾é…ç½®ç¯å¢ƒï¼Œåœ¨ä»–ä¸‹é¢å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª <code>environment</code> å­æ ‡ç­¾ï¼Œæ¯ä¸ªéƒ½ä»£è¡¨ä¸€ä¸ªç¯å¢ƒï¼Œç„¶ååœ¨ <code>environments</code> æ ‡ç­¾ä¸­ä½¿ç”¨ default å±æ€§å¯¹ç¯å¢ƒè¿›è¡Œé€‰æ‹©</p><blockquote><p>è¿™é‡Œä½¿ç”¨ default å¯¹ç¯å¢ƒè¿›è¡Œé€‰æ‹©ï¼Œç›®å‰é€‰æ‹©çš„æ˜¯MySQLçš„ç¯å¢ƒ</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">        è¿™æ˜¯MySQLçš„ç¯å¢ƒ</span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">        è¿™æ˜¯oracleçš„ç¯å¢ƒ</span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é™¤å¼€é…ç½®æ–‡ä»¶å†…çš„é»˜è®¤ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥åœ¨æ‰“å¼€<font color="red">æ‰“å¼€ä¼šè¯å·¥å‚çš„æ—¶å€™ä¼ å…¥æŒ‡å®šç¯å¢ƒçš„idè¿›è¡Œé€‰æ‹©ç¯å¢ƒ</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is, <span class="string">&quot;mysql&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š å°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒã€‚</strong></p><h4 id="2-äº‹åŠ¡ç®¡ç†å™¨">2. äº‹åŠ¡ç®¡ç†å™¨</h4><p>åœ¨æ¯ä¸ª <code>environment</code> å­æ ‡ç­¾ç¯å¢ƒä¸­æœ‰ <code>transactionManager</code> æ ‡ç­¾çš„ type å±æ€§å¯ä»¥å¯¹ SQL è¿›è¡Œäº‹åŠ¡æ§åˆ¶ç®¡ç†ï¼Œç®¡ç†äº‹åŠ¡çš„ç®¡ç†å™¨æœ‰ä¸¤ç§ï¼šã€ JDBC ã€‘ã€ MANAGED ã€‘</p><table><thead><tr><th>äº‹åŠ¡ç®¡ç†å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>JDBC</td><td>ç›´æ¥ä½¿ç”¨äº† JDBC çš„æäº¤å’Œå›æ»šè®¾ç½®ï¼Œå®ƒä¾èµ–äºä»æ•°æ®æºå¾—åˆ°çš„è¿æ¥æ¥ç®¡ç†äº‹åŠ¡ä½œç”¨åŸŸã€‚</td></tr><tr><td>MANAGED</td><td>ä»€ä¹ˆéƒ½ä¸åšï¼Œè®©å®¹å™¨æ¥ç®¡ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä¸å»ºè®®ä½¿ç”¨</td></tr></tbody></table><p>å»ºè®®ä½¿ç”¨ JDBC æ¥ç®¡ç†äº‹åŠ¡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-æ•°æ®æº">3. æ•°æ®æº</h4><p>æ•°æ®æºæ˜¯é…ç½® mybatis å’Œæ•°æ®åº“è¿›è¡Œè¿æ¥çš„ç›¸å…³é…ç½®ï¼Œä»–ç”± <code>environment</code> æ ‡ç­¾ä¸‹çš„ <code>dataSource</code> æ ‡ç­¾è¿›è¡Œè®¾ç½®</p><p>é€šè¿‡ <code>dataSource</code> æ ‡ç­¾çš„ type å±æ€§å¯ä»¥é€‰æ‹©æ•°æ®æºç±»å‹ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>UNPOOLED</td><td>åªæ˜¯æ¯æ¬¡è¢«è¯·æ±‚æ—¶æ‰“å¼€å’Œå…³é—­è¿æ¥ï¼Œååº”è¾ƒæ…¢ï¼Œé€‚ç”¨äºç®€å•å°å‹é¡¹ç›®</td></tr><tr><td>POOLED</td><td>ç›¸å¯¹äºUNPOOLEDç›¸æ¯”ä½¿ç”¨äº† æ•°æ®åº“è¿æ¥æ±  çš„æ„Ÿå¿µ</td></tr><tr><td>JNDI</td><td>èƒ½åœ¨å¦‚ EJB æˆ–åº”ç”¨æœåŠ¡å™¨è¿™ç±»å®¹å™¨ä¸­ä½¿ç”¨</td></tr></tbody></table><p>æ•°æ®æºæœ€åŸºæœ¬çš„å››ä¸ªå±æ€§ï¼š</p><ul><li>ã€driverã€‘ æ•°æ®åº“è¿æ¥é©±åŠ¨ç±»</li><li>ã€urlã€‘ æ•°æ®åº“é“¾æ¥åœ°å€</li><li>ã€usernameã€‘ ç”¨æˆ·å</li><li>ã€passwordã€‘ å¯†ç </li></ul><p><strong>æœ€å¸¸è§çš„ <code>environments</code> æ ‡ç­¾é…ç½®</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///test&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;******&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Mappers-æ˜ å°„æ ‡ç­¾">Mappers æ˜ å°„æ ‡ç­¾</h3><p>ä¹¦å†™çš„ mapper æ–‡ä»¶éœ€è¦è¢«æ˜ å°„åˆ°æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ï¼Œæ˜ å°„çš„æ ‡ç­¾å°±æ˜¯ <code>mappers</code> ï¼Œä»–ä¸‹é¢æœ‰ä¸¤ä¸ªå­æ ‡ç­¾ï¼Œåˆ†åˆ«æ˜¯ <code>mapper</code> å’Œ <code>package</code> æ˜ å°„æ–¹æ³•å¦‚ä¸‹ï¼š</p><p><strong>1. æ˜ å°„çš„æ–‡ä»¶åœ¨resourcesç›®å½•ä¸‹</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ˜ å°„å•ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;beanMapper.xml&quot;</span>/&gt;</span>&gt;</span><br><span class="line">    <span class="comment">&lt;!-- ä½¿ç”¨ * é€šé…ç¬¦æ˜ å°„å¤šä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;*Mapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2. æ˜ å°„çš„æ–‡ä»¶åœ¨daoåŒ…ä¸‹</strong></p><blockquote><p>å½“ mapper æ–‡ä»¶åœ¨ dao åŒ…ä¸‹çš„æ—¶ï¼Œmapper å’Œæ¥å£å¿…é¡»æ˜¯åŒåçš„ï¼Œæˆ–è€…åœ¨ resources ç›®å½•ä¸‹æœ‰ç€åŒçº§çš„ç›®å½•</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ˜ å°„å•ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;club.hanzhe.dao.BeanDao&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ˜ å°„å¤šä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;club.hanzhe.dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>3. æ¥å£æ³¨è§£å¼€å‘</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;club.hanzhe.dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼å½“mapperæ–‡ä»¶åœ¨daoåŒ…ä¸‹çš„æ—¶å€™ï¼Œéœ€è¦åœ¨mavençš„pomæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå¦åˆ™xmlæ–‡ä»¶å¯èƒ½ä¸ä¼šè¢«æ‰“åŒ…å‘å¸ƒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Properties-å±æ€§">Properties å±æ€§</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ä¼ ç»Ÿ JDBC çš„æ—¶å€™éƒ½ä¼šæŠŠ driverï¼Œurl ç­‰ç­‰æ”¾åœ¨ä¸€ä¸ª propertis åç¼€çš„æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å¯ä»¥é™ä½ä»£ç çš„è€¦åˆæ€§ï¼Œæ–¹ä¾¿ç¯å¢ƒåˆ‡æ¢ï¼Œmybatis ä¸­ä¹Ÿæ”¯æŒè¿™ç§åšæ³•ï¼Œä½¿ç”¨ <code>properties</code> æ ‡ç­¾å°±å¯ä»¥å®ç°</p><p><strong>1. æ‰‹å†™ properties é…ç½®æ–‡ä»¶</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://127.0.0.1/åº“å</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">*****</span></span><br></pre></td></tr></table></figure><p><strong>2. ä½¿ç”¨ properties æ ‡ç­¾å°†é…ç½®æ–‡ä»¶å¼•å…¥è¿›æ¥</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨è¯¥æ ‡ç­¾å°†é…ç½®æ–‡ä»¶å¼•å…¥è¿›æ¥ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨ $&#123;&#125; ç¬¦å·æ¥è°ƒç”¨é…ç½®æ–‡ä»¶å†…çš„å€¼äº† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¾‹å¦‚ï¼š --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="TypeAliases-åˆ«å">TypeAliases åˆ«å</h3><p>åœ¨æˆ‘ä»¬çš„ mapper æ˜ å°„æ–‡ä»¶ä¸­ï¼ŒCRUD æ ‡ç­¾ä¸­çš„å‚æ•°ï¼Œè¿”å›ç»“æœ resultType é€šå¸¸éƒ½æ˜¯å…¨é™å®šåï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;club.hanzhe.bean.Bean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>typeAliases</code> æ ‡ç­¾ä¸‹çš„ <code>typeAlias</code> å­æ ‡ç­¾==é…ç½®ç±»åˆ«å==ï¼Œå¯ä»¥ç®€åŒ–å…¨é™å®šåä¹¦å†™æ ¼å¼</p><blockquote><p>abcå°±æ˜¯è¿™ä¸ªç±»çš„ç±»åˆ«åï¼Œå°±å¯ä»¥åœ¨æ˜ å°„æ–‡ä»¶ä¸­ä½¿ç”¨äº†</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;club.hanzhe.bean.Bean&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;abc&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;abc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>typeAlias</code> æ ‡ç­¾ä¸­çš„ alias å±æ€§ä¹Ÿå¯ä»¥å¿½ç•¥ä¸å†™ï¼Œé»˜è®¤å·²ç±»åä½œä¸ºåˆ«å (åˆ«åé¦–å­—æ¯å°å†™å³å¯)</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;club.hanzhe.bean.Bean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;bean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœæ˜¯ä¸ªè¾ƒå¤§çš„é¡¹ç›®ï¼Œè¡¨å’Œå®ä½“ç±»æ¯”è¾ƒå¤šï¼Œå¦‚æœé€ä¸ªå®ä½“ç±»é…ç½®çš„è¯ä¼šå¾ˆéº»çƒ¦ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ <code>package</code> å­æ ‡ç­¾</p><blockquote><p>å°†æŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰ç±»å…¨éƒ¨é…ç½®åˆ«åï¼Œåˆ«åä¸ºç±»æœ¬èº«åå­— (é¦–å­—æ¯å°å†™)</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;club.hanzhe.bean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;bean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Settings-å…¨å±€è®¾ç½®">Settings å…¨å±€è®¾ç½®</h3><p>åœ¨ mybatis ä¸­å¯ä»¥å¯¹å…¨å±€è¿›è¡Œä¸€äº›è®¾ç½®ï¼Œè®¾ç½®éœ€è¦ç”¨ <code>settings</code> ä¸‹çš„ <code>setting</code> å­æ ‡ç­¾å®ç°ï¼Œæ ¼å¼ä½“ç°ä¸ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;è®¾ç½®åç§°&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¯¹åº”å‚æ•°å€¼&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„è®¾ç½®æœ‰ï¼š</p><table><thead><tr><th>è®¾ç½®å</th><th>ä½œç”¨æè¿°</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>cacheEnabled</td><td>è®¾ç½®å…¨å±€ç¼“å­˜çš„å¼€å¯å’Œå…³é—­</td><td>boolean</td></tr><tr><td>defaultStatementTimeout</td><td>è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå®ƒå†³å®šé©±åŠ¨ç­‰å¾…æ•°æ®åº“å“åº”çš„ç§’æ•°ã€‚</td><td>ä»»æ„æ­£æ•´æ•°</td></tr><tr><td>mapUnderscoreToCamelCase</td><td>æ˜¯å¦å¼€å¯é©¼å³°å‘½åè§„åˆ™</td><td>boolean</td></tr><tr><td>logImpl</td><td>é…ç½®æ—¥å¿—ä¿¡æ¯ï¼Œä¸ªäººæ¨èä½¿ç”¨ STDOUT_LOGGING æ—¥å¿—</td><td>@å®˜æ–¹æ–‡æ¡£</td></tr></tbody></table><h2 id="Mapper-æ˜ å°„æ–‡ä»¶">Mapper æ˜ å°„æ–‡ä»¶</h2><p>mapper æ˜ å°„æ–‡ä»¶ï¼Œç”¨æ¥è´Ÿè´£å’Œæ•°æ®åº“äº¤äº’çš„ sql ä»£ç ï¼Œä¸»è¦æ˜¯å¢åˆ æ”¹æŸ¥å››ä¸ªæ ‡ç­¾ä¸ºä¸»ï¼š</p><h3 id="å¢åˆ æ”¹æ ‡ç­¾">å¢åˆ æ”¹æ ‡ç­¾</h3><p>å¢åˆ æ”¹æ ‡ç­¾æ˜¯ç”¨æ¥ä¹¦å†™æ’å…¥ sql çš„æ ‡ç­¾ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å‡ ä¸ªå±æ€§å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span></span></span><br><span class="line"><span class="tag"> <span class="attr">id</span>=<span class="string">&quot;addBean&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">parameterType</span>=<span class="string">&quot;club.hanzhe.bean&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>id</td><td>ç”¨æ¥ä½œä¸ºæ ‡ç­¾çš„æ ‡è¯†ç¬¦ï¼Œä½¿ç”¨idå¯ä»¥ç›´æ¥æ‰¾åˆ°å½“å‰æ ‡ç­¾è°ƒç”¨</td></tr><tr><td>parameterType</td><td>æ¥å—çš„å‚æ•°çš„ç±»å‹ï¼Œå¦‚æœå‚æ•°ç±»å‹æ˜¯é›†åˆï¼Œé‚£ä¹ˆå°±å¡«é›†åˆå†…å…ƒç´ çš„ç±»å‹</td></tr><tr><td>flushCache</td><td>å¢åˆ æ”¹æ ‡ç­¾é»˜è®¤è®¾ç½®ä¸ºtrueï¼Œåªè¦è¯­å¥è¢«è°ƒç”¨ï¼Œå°±ä¼šæ¸…ç©ºæœ¬åœ°å’ŒäºŒçº§ç¼“å­˜</td></tr><tr><td>timeout</td><td>æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œé©±åŠ¨ç¨‹åºç­‰å¾…å“åº”çš„æ—¶é—´ï¼Œé»˜è®¤ä¸ºç©ºå€¼</td></tr></tbody></table><h3 id="æŸ¥è¯¢æ ‡ç­¾">æŸ¥è¯¢æ ‡ç­¾</h3><p>select æ ‡ç­¾æ˜¯ç”¨æ¥ä¸“é—¨ä¹¦å†™æŸ¥è¯¢è¯­å¥çš„æ ‡ç­¾ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å‡ ä¸ªå±æ€§å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span></span></span><br><span class="line"><span class="tag">    <span class="attr">id</span>=<span class="string">&quot;selectPerson&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultMap</span>=<span class="string">&quot;personResultMap&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">flushCache</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">timeout</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">fetchSize</span>=<span class="string">&quot;256&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultSetType</span>=<span class="string">&quot;FORWARD_ONLY&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é™¤å¼€å¢åˆ æ”¹ç›¸åŒçš„å±æ€§ä¹‹å¤–ï¼ŒæŸ¥è¯¢æœ‰ç€è‡ªå·±çš„å±æ€§</p><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>resultType</td><td>ç”¨æ¥è®¾ç½®æŸ¥è¯¢è¿”å›çš„æ•°æ®å¯¹åº”çš„å®ä½“ç±»</td></tr><tr><td>resultMap</td><td>å±äºé«˜çº§çš„parameterTypeï¼Œä»–å¯ä»¥æ‰‹åŠ¨é…ç½®å®ä½“ç±»å±æ€§å’Œæ•°æ®åº“å­—æ®µçš„æ˜ å°„</td></tr><tr><td>useCache</td><td>select é»˜è®¤ä¸º trueï¼Œæ‰§è¡ŒæŸ¥è¯¢åå°†æŸ¥è¯¢ç»“æœç¼“å­˜åœ¨äºŒçº§ç¼“å­˜ä¸­</td></tr></tbody></table><h3 id="æ·»åŠ æ—¶è¿”å›-ID">æ·»åŠ æ—¶è¿”å› ID</h3><p>è¿™é‡Œè®°ä¸€ä¸ªååˆ†å¥½ç”¨çš„å°åŠŸèƒ½ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ insert ä¹‹åï¼Œæƒ³è¦ç«‹åˆ»æ“ä½œè¿™è¡Œè®°å½•ï¼Œä½†æ˜¯ä»–çš„ä¸»é”®æ˜¯è‡ªå¢çš„ï¼Œæˆ‘ä»¬æƒ³è¦æ“ä½œä»–éœ€è¦è·å–ä»–çš„ IDï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡å±æ€§è®¾ç½®å›æ˜¾ ID</p><p>å‡è®¾å½“å‰æœ‰ä¸€ä¸ª beanï¼Œå±æ€§ä¸º useridï¼Œusernameï¼Œpassword</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- useGeneratedKeys=&quot;true&quot; å–å‡ºæ•°æ®åº“å†…è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”® --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- keyProperty=&quot;userid&quot; å°†ä¸»é”®è®¾ç½®åœ¨ bean ä¸­çš„æŸä¸ªå±æ€§ä¸Š --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span><span class="attr">keyProperty</span>=<span class="string">&quot;userid&quot;</span>&gt;</span></span><br><span class="line"> insert into t_user values(#&#123;username&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(<span class="string">&quot;å¼ &quot;</span>);</span><br><span class="line">    user.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    userDao.addUser(user);</span><br><span class="line">    <span class="comment">// å½“æˆ‘ä»¬æ‰§è¡Œæ’å…¥è¯­å¥åï¼Œå¦‚æœæ­£å¸¸è¿è¡Œï¼Œé‚£ä¹ˆuseridå°±ä¼šæˆåŠŸèµ‹å€¼</span></span><br><span class="line">    System.out.println(user.getUserid());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SQL-ä»£ç ç‰‡æ®µ">SQL ä»£ç ç‰‡æ®µ</h3><p>å¯ä»¥è¢«ç”¨æ¥å®šä¹‰å¯é‡ç”¨çš„ SQL ä»£ç æ®µï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>å®šä¹‰äº† id ä¸º t_user çš„ sql ä»£ç ç‰‡æ®µï¼Œåœ¨ä¸‹é¢çš„å¢åˆ æ”¹æŸ¥ä¸­å°±å¯ä»¥ä½¿ç”¨ <code>include</code> æ¥è°ƒç”¨äº†</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;t_user&quot;</span>&gt;</span>userid, username, usersex, usertel<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    SELECT <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;t_user&quot;</span> /&gt;</span> FROM t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å’Œ-çš„åŒºåˆ«">${ } å’Œ #{ } çš„åŒºåˆ«</h3><p>${ }å’Œ#{ }ä»–ä»¬éƒ½æ˜¯ç”¨æ¥æ¥æ”¶ä¼ å…¥å‚æ•°çš„ï¼Œåªä¸è¿‡æœ‰äº›ç»†èŠ‚éœ€è¦ç•™æ„ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€è¡ŒSQLè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> userid <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„ 1 æ˜¯éœ€è¦æ¥æ”¶ä¼ å…¥å‚æ•°çš„ï¼Œé‚£ä¹ˆè·å–åˆ°ä¼ å…¥å‚æ•°æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>${ }ï¼Œæ‹¼æ¥SQLå­—ç¬¦ä¸²</li><li>#{ }ï¼Œä½œä¸ºSQLå ä½ç¬¦</li></ul><p>å¦‚æœä½¿ç”¨ ${} çš„è¯ï¼Œé€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä»¥æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼æ‰§è¡Œï¼Œè¿™æ ·çš„è¯å°±å¾ˆå®¹æ˜“æ”¶åˆ°SQLæ³¨å…¥çš„æ”»å‡»</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> userid <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœä½¿ç”¨ #{} çš„è¯ï¼Œä»–æ˜¯å°† SQL ä»£ç é¢„å¤„ç†ä¹‹ååœ¨æ‰§è¡Œä¹‹å‰è¿›è¡Œå‚æ•°æ›¿æ¢ï¼Œä¼ å…¥çš„å‚æ•°éƒ½å°†ä½œä¸ºæ™®é€šå‚æ•°å¯¹å¾…ï¼Œé€šè¿‡æ‰§è¡Œæ—¥å¿—å°±å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> userid <span class="operator">=</span> ? ;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯äºŒè€…æœ€æ˜æ˜¾çš„å·®è·ï¼Œé€šè¿‡å ä½ç¬¦å¯ä»¥æœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥æ”»å‡»ï¼Œæ¨èä½¿ç”¨#{ }</p><h3 id="ResultMap-æ ‡ç­¾">ResultMap æ ‡ç­¾</h3><p>ä¸€èˆ¬ä½¿ç”¨ resultType è¿”å›å¯¹è±¡çš„æ—¶å€™ï¼Œæ˜¯æ•°æ®åº“è‡ªåŠ¨æ£€æµ‹å®ä½“ç±»ä¸­å’Œå­—æ®µåŒ¹é…çš„å±æ€§è¿›è¡Œå°è£…ï¼Œä½†æ˜¯å¦‚æœå®ä½“ç±»ä¸­çš„å±æ€§å’Œè¡¨ä¸­çš„å­—æ®µæˆªç„¶ä¸åŒçš„è¯ï¼Œå°±éœ€è¦æ‰‹åŠ¨é…ç½®ä»–ä»¬ä¹‹é—´çš„æ˜ å°„å…³ç³»äº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  idï¼šä¸ºå½“å‰æ ‡ç­¾çš„å‘½åï¼Œä¼šåœ¨selectæ ‡ç­¾ä¸­çš„è¿”å›ç±»å‹ä¸­ç”¨åˆ°</span></span><br><span class="line"><span class="comment">  typeï¼šä¸ºè¿”å›çš„ä¸»ç±»çš„ç±»å‹ï¼ŒStudentä¸­åŒ…å«Scoreç±»å‹çš„å˜é‡ï¼Œæ‰€ä»¥Sutdentæ˜¯ä¸»ç±»</span></span><br><span class="line"><span class="comment">  extendsï¼šç»§æ‰¿ï¼Œå°†æŒ‡å®šçš„resultMapçš„idä½œä¸ºå€¼æ”¾åœ¨è¿™é‡Œï¼Œä¼šç»§æ‰¿ä¹‹å‰ä¹¦å†™çš„æ˜ å°„</span></span><br><span class="line"><span class="comment">  autoMapperï¼šä¸ºå…¶ä»–å±æ€§è‡ªåŠ¨åŒ¹é…çš„å¼€å…³ï¼Œé»˜è®¤ä¸ºfalseå…³é—­çŠ¶æ€</span></span><br><span class="line"><span class="comment">   ä¸ºfalseæ—¶ï¼Œåªæœ‰æ‰‹åŠ¨é…ç½®çš„æ˜ å°„ä¼šåŒ¹é…æˆåŠŸï¼Œæœªè®¾ç½®çš„ä¸ºnullå€¼</span></span><br><span class="line"><span class="comment">   ä¸ºtrueæ—¶ï¼Œå°†æŒ‰ç…§æ‰‹åŠ¨é…ç½®çš„è¿›è¡ŒåŒ¹é…ï¼Œæ²¡æœ‰æ‰‹åŠ¨é…ç½®çš„ä¼šè‡ªåŠ¨æŒ‰ç…§å˜é‡ååŒ¹é…</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;map1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;club.hanzhe.pojo.U_T&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">       idæ ‡ç­¾ä¸ºè®¾ç½®å½“å‰ä¸»ç±»ä¸æ•°æ®è¡¨ä¸­å¯¹åº”è¡¨çš„ä¸»é”®çš„åŒ¹é…</span></span><br><span class="line"><span class="comment">       columnï¼šæ•°æ®è¡¨ä¸­çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">       propertyï¼šä¸è¯¥å­—æ®µå¯¹åº”çš„æœ¬ç±»ä¸­çš„å±æ€§</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;rowNo&quot;</span> <span class="attr">property</span>=<span class="string">&quot;rowNo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   resultæ ‡ç­¾ä¸ºè®¾ç½®å½“å‰ä¸»ç±»ä¸æ•°æ®è¡¨ä¸­å¯¹åº”è¡¨çš„å…¶ä»–å­—æ®µçš„åŒ¹é…</span></span><br><span class="line"><span class="comment">   columnï¼šæ•°æ®è¡¨ä¸­çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">   propertyï¼šä¸è¯¥å­—æ®µå¯¹åº”çš„æœ¬ç±»ä¸­çš„å±æ€§</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;u_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   associationæ ‡ç­¾ä¸ºè®¾ç½®å½“å‰ä¸»ç±»ä¸­æ˜ å°„çš„å…¶ä»–ç±»</span></span><br><span class="line"><span class="comment">   propertyï¼šç±»ä¸­çš„å±æ€§</span></span><br><span class="line"><span class="comment">   javaTypeï¼šå±æ€§æ‰€å¯¹åº”çš„é‚£ä¸ªç±»çš„å…¨é™å®šåï¼Œå¯ä»¥ä½¿ç”¨åˆ«å</span></span><br><span class="line"><span class="comment">   autoMappingï¼šè‡ªåŠ¨åŒ¹é…è¡¨ä¸­çš„å…¶ä»–å­—æ®µå’Œç±»ä¸­çš„å±æ€§</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;tel&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;club.hanzhe.pojo.Tel&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;telid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   collectionç”¨æ¥æ˜ å°„é›†åˆï¼Œå¤šç”¨äºä¸€å¯¹å¤šæŸ¥è¯¢ </span></span><br><span class="line"><span class="comment">   ä¸associationçš„å”¯ä¸€å·®åˆ«å°±æ˜¯javaTypeå˜æˆäº†ofType </span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;tel&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;club.hanzhe.pojo.Tel&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;telid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€-SQL">åŠ¨æ€ SQL</h3><p>é€šè¿‡ä¼ å…¥çš„å‚æ•°å¯¹ sql è¿›è¡Œçµæ´»åŒ–ä½¿ç”¨ï¼Œç±»ä¼¼ Java ä¸€æ ·ï¼Œé€šè¿‡ åˆ¤æ–­å¾ªç¯ æ¥æ§åˆ¶ SQL çš„æœ€ç»ˆæ‰§è¡Œ</p><blockquote><p>if åˆ¤æ–­æ ‡ç­¾</p></blockquote><p>å¦‚æœæ¥æ”¶çš„usernameå‚æ•°ä¸ä¸ºç©ºçš„è¯ï¼Œå°±è¿½åŠ å½“å‰æ ‡ç­¾å†…çš„sqlè¯­å¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findBean&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;bean&quot;</span>&gt;</span></span><br><span class="line">    select * from test</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null and id != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>where è¿‡æ»¤æ ‡ç­¾</p></blockquote><p>ä½¿ç”¨ where æ ‡ç­¾ä¹‹åï¼Œå¦‚æœ where å†…æœ‰ç¬¦åˆ if æ¡ä»¶çš„ä¼šè‡ªåŠ¨æ·»åŠ  where å…³é”®å­—ï¼Œå¦‚æœæ²¡æœ‰ç¬¦åˆçš„å°±ä¸æ·»åŠ </p><p>å¦‚æœæœ‰å¤šä¸ª if ç¬¦åˆæ¡ä»¶ï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸Š and æˆ–è€… or ç­‰åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæˆç«‹çš„æ¡ä»¶ä¼šé»˜è®¤çœç•¥å‰é¢çš„ and æˆ– orï¼Œåç»­çš„ä¼šæ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userid != null&quot;</span>&gt;</span></span><br><span class="line">            and userid = #&#123;userid &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">            and username like #&#123;username &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;usersex != null&quot;</span>&gt;</span></span><br><span class="line">            and usersex = #&#123;usersex &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;usertel!= null&quot;</span>&gt;</span></span><br><span class="line">            and usertel = #&#123;usertel &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>choose æ ‡ç­¾</p></blockquote><p>choose æ ‡ç­¾æœ‰ç€å’Œ switch ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä»–è¦æ±‚å½“å‰åˆ¤æ–­è‡³å°‘æˆç«‹ä¸€ä¸ªæ‰å¯ä»¥ç»“æŸï¼Œå¦‚æœæ²¡æœ‰æˆç«‹çš„ä¼šæ‰§è¡Œotherwise</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span><span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>set æ ‡ç­¾</p></blockquote><p>ä½¿ç”¨ set æ ‡ç­¾ä¹‹åï¼Œå¦‚æœ set å†…æœ‰ç¬¦åˆ if æ¡ä»¶çš„ä¼šè‡ªåŠ¨æ·»åŠ  set å…³é”®å­—ï¼Œå¦‚æœæ²¡æœ‰ç¬¦åˆçš„å°±ä¸æ·»åŠ ï¼Œéœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œ==set â†’ if å†…çš„ sql ç»“å°¾ä¸€å®šè¦å¸¦ä¸Šé€—å·==ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨çœç•¥ä½†ä¸ä¼šè‡ªåŠ¨è¿½åŠ ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span> &gt;</span></span><br><span class="line">    update t_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            username = #&#123;username &#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;usersex != null and usersex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            usersex = #&#123;usersex &#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;usertel != null and usertel != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            usertel = #&#123;usertel &#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where userid = #&#123;userid &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>foreach æ ‡ç­¾</p></blockquote><p>foreach æ ‡ç­¾ç”¨æ¥éå†ä¼ è¿›æ¥çš„é›†åˆæˆ–æ•°ç»„å®¹å™¨ï¼Œå¤šç”¨äºæ‰¹é‡åˆ é™¤æ“ä½œï¼Œé‡Œé¢çš„å±æ€§è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;find1&quot;</span>&gt;</span></span><br><span class="line"> delete from bean where id in</span><br><span class="line"> <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;, &quot;</span> <span class="attr">item</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">  #&#123; i &#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>collectionï¼šä¼ è¿›æ¥è¢«éå†çš„é‚£ä¸ªå®¹å™¨çš„åå­—ï¼Œå¯ä»¥æ˜¯æ•°ç»„æˆ–é›†åˆ</li><li>openï¼šå¾ªç¯å¼€å§‹å‰éœ€è¦æ·»åŠ çš„å‰ç¼€</li><li>closeï¼šå¾ªç¯ç»“æŸåéœ€è¦æ·»åŠ çš„åç½®</li><li>separatorï¼šæ¯å¾ªç¯ä¸€æ¬¡æ—¶éœ€è¦åœ¨ä¸­é—´æ·»åŠ çš„åˆ†éš”ç¬¦</li><li>itemï¼šè¢«å¾ªç¯å‡ºæ¥çš„æ¯ä¸ªå­—æ®µï¼Œåœ¨æ ‡ç­¾å†…ç›´æ¥ä½¿ç”¨å³å¯</li></ul><h3 id="cache-ç¼“å­˜æ ‡ç­¾">cache ç¼“å­˜æ ‡ç­¾</h3><h5 id="ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</h5><p>åœ¨ mybatis ä¸­<font color="red">ä¸€çº§ç¼“å­˜</font>æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œåœ¨è¿›è¡Œ openSession çš„æ—¶å€™å°±è‡ªåŠ¨æ‰“å¼€äº†ä¸€çº§ç¼“å­˜ï¼Œä¸”å¯¹äºä¸€çº§ç¼“å­˜çš„æ“ä½œï¼Œåªèƒ½æ¸…ç©ºï¼Œä¸èƒ½ç¦ç”¨ï¼Œ<font color="red">ä¸€çº§ç¼“å­˜çš„ä½œç”¨èŒƒå›´æ˜¯å½“å‰çš„ SqlSession å®ä¾‹</font></p><blockquote><p>åœ¨åŒä¸€ä¸ª SqlSession å®ä¾‹ä¸­ï¼Œä¸¤æ¬¡åŒæ ·çš„æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸¤ä¸ªSqlSessioné‚£ä¹ˆè¿›è¡Œç›¸åŒçš„æŸ¥è¯¢ç»“æœå°±ä¼šä¸åŒï¼Œè¿™é‡Œå°±ä¸å†™äº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> <span class="built_in">this</span>.factory.openSession(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">BeanDao</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(BeanDao.class);</span><br><span class="line">    <span class="type">Bean</span> <span class="variable">bean1</span> <span class="operator">=</span> mapper.findById(<span class="number">7844</span>);</span><br><span class="line">    <span class="type">Bean</span> <span class="variable">bean2</span> <span class="operator">=</span> mapper.findById(<span class="number">7844</span>);</span><br><span class="line">    System.out.println(bean1 == bean2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</h5><p>äºŒçº§ç¼“å­˜çš„èŒƒå›´æ˜¯åŸºäºå½“å‰çš„ mapper.xml é…ç½®æ–‡ä»¶çš„ mapper æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯å½“å‰çš„ namespace ä¸‹ï¼Œä¸€ä¸ªäºŒçº§ç¼“å­˜å¯ä»¥æ¨ªè·¨å¤šä¸ªä¸€çº§ç¼“å­˜ï¼Œè€ŒäºŒçº§ç¼“å­˜é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¼€å¯äºŒçº§ç¼“å­˜çš„æ–¹æ³•å°±æ˜¯==ä½¿ç”¨ cacheæ ‡ç­¾==</p><blockquote><p>æ²¡é”™ï¼Œåªè¦åœ¨ mapper ä¸‹é¢åŠ ä¸Šè¿™ä¹ˆä¸€å¥ä»£ç ï¼ŒäºŒçº§ç¼“å­˜å°±å¼€å¯å®Œæˆäº†ï¼Œç®€å•ç²—æš´</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å¼€å¯äºŒçº§ç¼“å­˜åè¿˜ä¸èƒ½ç«‹åˆ»ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ï¼Œ==éœ€è¦è®©è¯¥ mapper ç›¸å…³çš„æ‰€æœ‰ bean å®ç° Serializable åºåˆ—åŒ–æ¥å£==</p><h2 id="Mybatis-æ³¨è§£å¼€å‘">Mybatis æ³¨è§£å¼€å‘</h2><h3 id="CRUD-æ³¨è§£">CRUD æ³¨è§£</h3><p>åœ¨ mybatis ä¸­ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ mapper æ˜ å°„æ–‡ä»¶ï¼Œæ”¹ä¸ºä½¿ç”¨æ³¨è§£å¼€å‘ï¼Œåˆ†åˆ«ç›¸å¯¹ç€å¢åˆ æ”¹æŸ¥å››ä¸ªæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into t_user values(null,#&#123;name&#125;,#&#123;sex&#125;,#&#123;address&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete(&quot;DELETE FROM t_user WHERE u_id = #&#123;abc&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeUser</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update(&quot;update t_user set u_address=#&#123;address&#125; where u_name = #&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from t_user where u_id = #&#123;abc&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">( Integer id )</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼ä½¿ç”¨ mapper æ–‡ä»¶çš„æ—¶å€™éœ€è¦æ‰«æ mapper æ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼Œç„¶åæ‰å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨æ³¨è§£å¼€å‘ä¹Ÿéœ€è¦æ‰«æï¼š</p><blockquote><p>å°†æ‰€æœ‰å¸¦æœ‰æ³¨è§£çš„æ¥å£éƒ½æ‰«æ</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;club.hanzhe.dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Result-æ³¨è§£">Result æ³¨è§£</h3><p>ä½¿ç”¨ xml å¼€å‘æ—¶ï¼Œä¼šé‡åˆ°å­—æ®µä¸å®ä½“ç±»å±æ€§åä¸åŒ¹é…é€ æˆå°è£…å¤±è´¥çš„æƒ…å†µï¼Œèµ·åˆ«åè§£å†³æ˜¯ä¸€ç§æ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½ä½¿ç”¨ resultMap ç»“æœæ˜ å°„ï¼Œå°†å­—æ®µä¸å±æ€§åŒ¹é…ï¼Œæ³¨è§£å¼€å‘ä¹Ÿå¯ä»¥ä½¿ç”¨ resultMapï¼Œå¯¹åº”çš„æ³¨è§£æ˜¯ <code>@Results</code></p><blockquote><p>ä½¿ç”¨æ³¨è§£çš„æ–¹å¼åŒ¹é…å­—æ®µä¸å±æ€§æŸ¥è¯¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Results(</span></span><br><span class="line"><span class="meta">    id = &quot;r1&quot;, // idï¼šç»™å½“å‰resultsèµ·åå­—ï¼ŒåƒresultMapä¸€æ ·ç»§æ‰¿ä½¿ç”¨</span></span><br><span class="line"><span class="meta">    value = &#123; // valueï¼šé…ç½®å¤šä¸ªæ˜ å°„</span></span><br><span class="line"><span class="meta">  /*</span></span><br><span class="line"><span class="meta">   *  @Resultä¸­çš„å±æ€§ï¼š</span></span><br><span class="line"><span class="meta">   *   idï¼šè¡¨ä¸­çš„idåˆ—æ˜¯å¦ä¸ºä¸»é”®ï¼Œæ˜¯ä¸ºtrueï¼Œä¸å†™é»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="meta">   *   columnï¼šè¡¨ä¸­çš„å­—æ®µ</span></span><br><span class="line"><span class="meta">   *   propertyï¼šè¡¨ä¸­å­—æ®µå¯¹åº”çš„pojoä¸­çš„å±æ€§</span></span><br><span class="line"><span class="meta">   *   åªéœ€è¦å°†ä¸åŒ¹é…çš„å­—æ®µå±æ€§é…ä¸Šå³å¯ï¼ŒåŒ¹é…çš„å¯ä»¥çœç•¥ä¸å†™</span></span><br><span class="line"><span class="meta">   */</span></span><br><span class="line"><span class="meta">        @Result( column = &quot;u_id&quot; , property = &quot;id&quot; ),</span></span><br><span class="line"><span class="meta">        @Result( column = &quot;u_name&quot; , property = &quot;name&quot; ),</span></span><br><span class="line"><span class="meta">        @Result( column = &quot;u_sex&quot; , property = &quot;sex&quot; ),</span></span><br><span class="line"><span class="meta">        @Result( column = &quot;u_address&quot; , property = &quot;address&quot; )</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">( Integer id )</span>;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæœ‰å¦ä¸€ä¸ªæŸ¥è¯¢ä¸ä»–çš„è§„åˆ™ç›¸åŒï¼Œé‚£ä¹ˆå¯ä»¥å¼•ç”¨ä¹‹å‰å†™çš„Resultsçš„idå±æ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from t_user where u_name = #&#123;abc&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResultMap(&quot;r1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserByName</span><span class="params">( String name )</span>;</span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•åŠŸèƒ½">æ‰©å±•åŠŸèƒ½</h2><h3 id="Mybatis-é€†å‘å·¥ç¨‹">Mybatis é€†å‘å·¥ç¨‹</h3><p>é€†å‘å·¥ç¨‹æ˜¯æ ¹æ®æ•°æ®åº“ä¸­è¡¨çš„ä¿¡æ¯è¿›è¡Œè‡ªåŠ¨åˆ›å»ºå®ä½“ç±»ï¼Œæ¥å£ï¼Œæ˜ å°„æ–‡ä»¶çš„æŠ€æœ¯</p><h4 id="1-ç¯å¢ƒé…ç½®"><strong>1. ç¯å¢ƒé…ç½®</strong></h4><p>ä½¿ç”¨é€†å‘å·¥ç¨‹å¿…é¡»å¼•å…¥ä»–çš„ä¾èµ–æˆ–jaråŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-é€†å‘å·¥ç¨‹é…ç½®æ–‡ä»¶">2. é€†å‘å·¥ç¨‹é…ç½®æ–‡ä»¶</h4><p>ä½ å¯ä»¥<font color="red">åœ¨ä»»æ„ä½ç½® ( åŒ…æ‹¬é¡¹ç›®å¤– ) </font>åˆ›å»ºé€†å‘å·¥ç¨‹æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®çš„åœ°æ–¹æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>properties æ ‡ç­¾ä¸­çš„é…ç½®æ–‡ä»¶éœ€è¦è‡ªå·±ä¹¦å†™ï¼Œä¹Ÿå¯ä»¥ä¹¦å†™è¯¥æ ‡ç­¾åŠæ–‡ä»¶</li><li>jdbcConnection æ ‡ç­¾éœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹éœ€å‚è€ƒä¸Šé¢çš„ properties é…ç½®æ–‡ä»¶</li><li>javaModelGenerator æ ‡ç­¾éœ€è¦ä¿®æ”¹ï¼Œä»–æ˜¯å®ä½“ç±»ç”Ÿæˆçš„ç›®æ ‡åŒ…è·¯å¾„</li><li>sqlMapGenerator æ ‡ç­¾éœ€è¦ä¿®æ”¹ï¼Œä»–æ˜¯ mapper æ˜ å°„æ–‡ä»¶ç”Ÿæˆçš„ç›®æ ‡è·¯å¾„</li><li>javaClientGenerator æ ‡ç­¾éœ€è¦ä¿®æ”¹ï¼Œä»–æ˜¯æ¥å£ç”Ÿæˆçš„ç›®æ ‡åŒ…è·¯å¾„</li><li>table æ ‡ç­¾çš„ tableName å±æ€§éœ€è¦ä¿®æ”¹ï¼Œä»–æ˜¯é€†å‘å·¥ç¨‹æ‰€å‚è€ƒçš„æ•°æ®è¡¨<ul><li>å¦‚æœ‰å¤šä¸ªè¡¨è¢«å‚è€ƒå°±ä¹¦å†™å¤šä¸ª table æ ‡ç­¾ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ä¿®æ”¹ tableName å±æ€§</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;testTables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ˜¯å¦å»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Š trueæ˜¯ï¼šfalse å¦--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“è¿æ¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span> <span class="attr">connectionURL</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span> <span class="attr">userId</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span> <span class="attr">password</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- é»˜è®¤falseï¼ŒæŠŠJDBC DECIMAL å’Œ NUMERIC ç±»å‹è§£æä¸º Integerï¼Œä¸º trueæ—¶æŠŠJDBC DECIMALå’ŒNUMERICç±»å‹è§£æä¸ºjava.math.BigDecimal --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ç”Ÿæˆçš„å®ä½“ç±»å­˜æ”¾çš„ä½ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;club.hanzhe.bean&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--enableSubPackages,æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åç¼€--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--ä»æ•°æ®åº“è¿”å›çš„å€¼è¢«æ¸…é™¤å‰åç©ºæ ¼--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mapperæ˜ å°„æ–‡ä»¶å­˜æ”¾çš„ä½ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mappers&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--targetPackage:mapperæ¥å£ç”Ÿæˆçš„ä½ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;club.hanzhe.dao&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--tableNameä¸ºé€†å‘å·¥ç¨‹é’ˆå¯¹çš„è¡¨çš„è¡¨åï¼Œå¯ä»¥é€šé…ç¬¦åŒ¹é…æ‰€æœ‰è¡¨ï¼Œå‰©ä¸‹çš„å±æ€§ç»Ÿç»Ÿfalse--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;%&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-ä½¿ç”¨é€†å‘å·¥ç¨‹">3. ä½¿ç”¨é€†å‘å·¥ç¨‹</h4><p>åœ¨ç¯å¢ƒé…ç½®å®Œæˆåä½¿ç”¨ä¸‹é¢è¿™æ®µæ¨¡æ¿ä»£ç ï¼Œè¿è¡Œåå°±ä¼šå°†å®ä½“ç±»ï¼Œæ¥å£ï¼Œmapperæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ</p><blockquote><p>éœ€è¦åœ¨æ”¹ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®é…ç½®æ–‡ä»¶çš„æ–‡ä»¶ååŠä½ç½®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;String&gt; warnings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">overWriter</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// è¿™é‡ŒåŠ è½½åˆšåˆšåˆ›å»ºçš„é€†å‘å·¥ç¨‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">            <span class="type">File</span> <span class="variable">configFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;æ–‡ä»¶ä½äºç£ç›˜çš„ç»å¯¹è·¯å¾„&quot;</span>);</span><br><span class="line">            <span class="type">ConfigurationParser</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warnings);</span><br><span class="line">            <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> cp.parseConfiguration(configFile);</span><br><span class="line">            <span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(overWriter);</span><br><span class="line">            <span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(config, callback, warnings);</span><br><span class="line">            myBatisGenerator.generate(<span class="literal">null</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ“ä½œå¤±è´¥ï¼&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;==================================================&quot;</span>);</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PageHelper-åˆ†é¡µæ’ä»¶">PageHelper åˆ†é¡µæ’ä»¶</h3><p>pageHelper æ’ä»¶æ˜¯é’ˆå¯¹ mybatis è®¾è®¡çš„ä¸€æ¬¾åˆ†é¡µæ’ä»¶ï¼Œé€šè¿‡æ‹¦æˆªå™¨å¯¹ sql è¿›è¡Œæ“ä½œï¼Œä½¿å…¶æ‹¥æœ‰åˆ†é¡µçš„èƒ½åŠ›</p><h4 id="1-ç¯å¢ƒé…ç½®-v2">1. ç¯å¢ƒé…ç½®</h4><p>ä½¿ç”¨ pageHelper åˆ†é¡µæ’ä»¶éœ€è¦å¯¼å…¥ä»–çš„ maven ä¾èµ–æˆ–è€…å¯¼å…¥ä»–çš„ jar åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯ä»¥å®˜ç½‘æŸ¥è¯¢æœ€æ–°ç‰ˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ maven ä¾èµ–æ·»åŠ å®Œæˆåï¼Œè¿˜éœ€è¦åœ¨ mybatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ <code>plugins</code> æ ‡ç­¾æ³¨å†Œ pageHelper æ’ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-ä½¿ç”¨PageHelper">2. ä½¿ç”¨PageHelper</h4><p>PageHelper ä¾èµ–å¼•å…¥åï¼Œåœ¨ç¨‹åºä¸­å°±æœ‰äº† PageHelper ç±»ï¼Œè°ƒç”¨å®ƒçš„ startPage é™æ€æ–¹æ³•ï¼Œåç´§è·Ÿçš„ç¬¬ä¸€æ¡æŸ¥è¯¢è¯­å¥å°±æ˜¯åˆ†é¡µæŸ¥è¯¢</p><blockquote><p>startPage çš„é™æ€æ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æŸ¥è¯¢çš„é¡µç ï¼Œç¬¬äºŒä¸ªæ˜¯æ¯é¡µçš„æŸ¥è¯¢æ•°é‡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ç¬¬äºŒé¡µï¼Œæ¯é¡µ5æ¡è®°å½•</span></span><br><span class="line">    PageHelper.startPage(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">    List&lt;Bean&gt; list = mapper.findAll();</span><br><span class="line">    <span class="keyword">for</span> (Bean bean : list)</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†é¡µé™¤äº† PageHelper ç±»ï¼Œè¿˜æœ‰ä¸€ä¸ª PageInfo å¯ä»¥ä½¿ç”¨ï¼Œå°†æŸ¥è¯¢çš„ç»“æœå°è£…åˆ° PageInfo ä¸­ï¼Œå¯ä»¥æŸ¥è¯¢ä¸€äº›å’Œåˆ†é¡µç›¸å…³çš„ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">    <span class="type">BeanDao</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(BeanDao.class);</span><br><span class="line">    PageHelper.startPage(<span class="number">2</span>, <span class="number">5</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">PageInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>(mapper.findAll());</span><br><span class="line">    System.out.println(<span class="string">&quot;æ€»é¡µç ï¼š&quot;</span> + info.getPages());</span><br><span class="line">    System.out.println(<span class="string">&quot;æ€»è®°å½•æ•°ï¼š&quot;</span> + info.getTotal());</span><br><span class="line">    System.out.println(<span class="string">&quot;ç»“æœé›†ï¼š&quot;</span>);</span><br><span class="line">    List&lt;Bean&gt; list = info.getList();</span><br><span class="line">    <span class="keyword">for</span> (Bean bean : list)</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-PageInfoå¸¸ç”¨å‚æ•°">3. PageInfoå¸¸ç”¨å‚æ•°</h4><p>åœ¨å°†ç»“æœé›†å°è£…åˆ° PageInfo ä¸­çš„æ—¶å€™ï¼Œå¯ä»¥å¯é€‰æ€§çš„ä¼ å…¥ä¸€ä¸ªå¯¼èˆªé¡µç çš„å‚æ•°ï¼Œå¯ä»¥è·å–åˆ°å’Œå½“å‰é¡µç›¸é‚»çš„é¡µç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">    <span class="type">BeanDao</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(BeanDao.class);</span><br><span class="line">    PageHelper.startPage(<span class="number">201</span>, <span class="number">5</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// åœ¨åˆ›å»ºinfoå¯¹è±¡çš„æ—¶å€™å¯ä»¥è·Ÿéšä¸€ä¸ªintç±»å‹ï¼Œè¿™ä¸ªå€¼æ˜¯å½“å‰é¡µé™„è¿‘çš„é¡µç çš„æ•°é‡</span></span><br><span class="line">    <span class="type">PageInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>(mapper.findAll(), <span class="number">7</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å½“å‰é¡µï¼š&quot;</span> + info.getPageNum());</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¯é¡µæ˜¾ç¤ºæ•°é‡ï¼š&quot;</span> + info.getPageSize());</span><br><span class="line">    System.out.println(<span class="string">&quot;å½“å‰é¡µä¿¡æ¯ï¼š&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Object obj : info.getList())</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ€»é¡µç ï¼š&quot;</span> + info.getPages());</span><br><span class="line">    System.out.println(<span class="string">&quot;æ€»è®°å½•æ•°ï¼š&quot;</span> + info.getTotal());</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸Šä¸€é¡µï¼š&quot;</span> + info.getPrePage());</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸‹ä¸€é¡µï¼š&quot;</span> + info.getNextPage());</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦é¦–é¡µï¼š&quot;</span> + info.isIsFirstPage());</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦å°¾é¡µï¼š&quot;</span> + info.isIsLastPage());</span><br><span class="line">    System.out.println(<span class="string">&quot;å¯¼èˆªæ¡é¡µç :&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> page : info.getNavigatepageNums() )</span><br><span class="line">        System.out.print( page + <span class="string">&quot;  &quot;</span> );</span><br><span class="line">    System.out.println(<span class="string">&quot;\nå¯¼èˆªæ¡ä¸­é¦–é¡µ&quot;</span> + info.getNavigateFirstPage());</span><br><span class="line">    System.out.println(<span class="string">&quot;å¯¼èˆªæ¡ä¸­å°¾é¡µ&quot;</span> + info.getNavigateLastPage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œéœ€è¦æ³¨æ„ï¼==æ¯é¡µæ˜¾ç¤ºæ•°é‡æ˜¯æŒ‡åˆ†é¡µæ˜¯è®¾ç½®çš„æ•°é‡==ï¼Œä¾‹å¦‚è®¾ç½®æ¯é¡µåªæ˜¾ç¤º5æ¡ï¼Œè·å–åˆ°çš„å°±æ˜¯5ï¼Œè€Œä¸æ˜¯æœ€åä¸€é¡µåªæ˜¾ç¤ºä¸‰æ¡å°±è¿”å›ä¸‰ï¼Œè¿™æ˜¯é”™è¯¯çš„</li></ul><h4 id="åˆç†åŒ–æŸ¥è¯¢">åˆç†åŒ–æŸ¥è¯¢</h4><p>åœ¨ç½‘é¡µä¸­å¾€å¾€æœ‰äº›äººä¼šé’»ç©ºå­ä¹±æ”¹æ•°æ®ï¼Œä¾‹å¦‚åªæœ‰20é¡µæ•°æ®ï¼Œä»–ä¿®æ”¹äº†å‚æ•°è¯·æ±‚åˆ°äº†ç¬¬50é¡µï¼Œè¿™ç§æƒ…å†µç»å¸¸ä¼šå‘ç”Ÿï¼Œæ‰€ä»¥åœ¨æ³¨å†Œ pageHelper çš„æ—¶å€™å¯ä»¥æ·»åŠ ä¸€ä¸ªå‚æ•°ä½¿æ•°æ®å˜å¾—åˆç†åŒ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;reasonable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Lombok-æ’ä»¶">Lombok æ’ä»¶</h3><p>åœ¨æˆ‘ä»¬è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦å°†æŸ¥è¯¢çš„ç»“æœå°è£…åˆ°æŒ‡å®šçš„å®ä½“ç±»ä¸­ï¼Œè€Œå¯¹åº”çš„å®ä¾‹ç±»éœ€è¦ä¹¦å†™å“åº”çš„ get set æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•åŠ toString æ–¹æ³•ï¼Œè¿™æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™æ˜¯å¯ä»¥ä½¿ç”¨ lombok æ’ä»¶è¿›è¡Œè‡ªåŠ¨ç”ŸæˆåŠŸèƒ½</p><h4 id="1-ç¯å¢ƒé…ç½®-v3">1. ç¯å¢ƒé…ç½®</h4><p>ä½¿ç”¨ lombok éœ€è¦å¼•å…¥ä»–çš„ maven ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¾èµ–å¼•å…¥åè¿˜éœ€è¦åœ¨ç¼–è¾‘å™¨ä¸­å®‰è£… lombok çš„æ’ä»¶ ( IDEA ç¼–è¾‘å™¨ä¸ºä¾‹ ) <code>File â†’ settings â†’ plugins â†’ install JetBrains plugin...</code> åœ¨é‡Œé¢æœç´¢ lombok ä¸‹è½½å®‰è£…ï¼Œè€Œååœ¨ <code>file â†’ settings â†’ build,Exe.. â†’ Compiler â†’ Annotation Pro...</code> é‡Œé¢é€‰ä¸­å½“å‰é¡¹ç›®ï¼Œåœ¨å³é¢çš„ <code>Enable annotation processing</code> é€‰é¡¹æ‰“å‹¾</p><h4 id="2-ä½¿ç”¨-Lombok-æ’ä»¶">2. ä½¿ç”¨ Lombok æ’ä»¶</h4><p>åœ¨ç›®æ ‡å®ä½“ç±»ä¸Šï¼Œåªéœ€è¦ä¹¦å†™å¥½å±æ€§å³å¯ï¼Œæ— éœ€ä¹¦å†™å…¶ä»–å¤šä½™æ–¹æ³•ï¼Œä½¿ç”¨ lombok æä¾›çš„æ³¨è§£ç”¨æ¥ä¸€é”®ç”Ÿæˆï¼š</p><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>@Getter</td><td>ä¸€é”®ç”Ÿæˆæ‰€æœ‰ get æ–¹æ³•</td></tr><tr><td>@Setter</td><td>ä¸€é”®ç”Ÿæˆæ‰€æœ‰ set æ–¹æ³•</td></tr><tr><td>@ToString</td><td>ä¸€é”®ç”Ÿæˆ toString æ–¹æ³•</td></tr><tr><td>@Data</td><td>ä¸€é”®ç”Ÿæˆ get set toString ç­‰æ–¹æ³•</td></tr><tr><td>@NoArgsConstructor</td><td>ç”Ÿæˆæ— å‚æ„é€ æ–¹æ³•</td></tr><tr><td>@AllArgsConstructor</td><td>ç”Ÿæˆæœ‰å‚æ„é€ æ–¹æ³•</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JDK8æ–°ç‰¹æ€§</title>
    <link href="/2021/04/13/Java%E7%AC%94%E8%AE%B0/JDK8%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <url>/2021/04/13/Java%E7%AC%94%E8%AE%B0/JDK8%E6%96%B0%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1>å‡½æ•°å¼æ¥å£</h1><p>å‡½æ•°å¼æ¥å£æ˜¯1.8ä¸­çš„æ–°ç‰¹æ€§ï¼Œä»–ä¸å±äºæ–°è¯­æ³•ï¼Œæ›´åƒæ˜¯ä¸€ç§è§„èŒƒ</p><h2 id="é¢å‘å¯¹è±¡æ¥å£å¤ä¹ ">é¢å‘å¯¹è±¡æ¥å£å¤ä¹ </h2><p>åœ¨è¿™é‡Œå…ˆå›é¡¾ä¸€ä¸‹é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œåˆ›å»ºæ¥å£çš„å…³é”®å­—ä¸º<code>interface</code>ï¼Œè¿™é‡Œåˆ›å»ºä¸€ä¸ªæ—¥å¿—æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">info</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavaä¸­çš„æ¥å£æ˜¯ä¸èƒ½ç›´æ¥åˆ›å»ºå®ä¾‹çš„ï¼Œå› ä¸ºä»–çš„æŠ½è±¡æ–¹æ³•æ²¡æœ‰å¾—åˆ°å®ç°ï¼š</p><p><img src="..//img/JDK8-01.png" alt=""></p><p>å½“æˆ‘ä»¬æƒ³è¦åˆ›å»ºæ¥å£å®ä¾‹çš„æ—¶å€™ä¸€èˆ¬éƒ½é€šè¿‡å®ç°ç±»æ¥è·å–å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LogService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å“ˆå“ˆå“ˆå“ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å®ç°æ¥åˆ›å»ºè¿™ä¸ªæ¥å£çš„å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LogService</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogServiceImpl</span>();</span><br><span class="line">        log.info();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹æ¥å£ä¸­çš„æ–¹æ³•è¿›è¡Œå®ç°é™¤äº†å®ç°ç±»ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼æ¥åˆ›å»ºæ¥å£çš„å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LogService</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogService</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å˜¿å˜¿å˜¿&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£">ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£</h2><p><em>å½“ä¸€ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³• ( æ¥å£é»˜è®¤å®ç°ä¸ç®— ) çš„æ—¶å€™è¿™ä¸ªæ¥å£å°±æ˜¯å‡½æ•°å¼æ¥å£</em>ï¼Œä¸Šé¢çš„<code>LogService</code>å°±å±äºå‡½æ•°å¼æ¥å£ï¼Œè¿˜æœ‰å­¦ä¹ çº¿ç¨‹æ—¶çš„<code>Runnable</code>æ¥å£ä¹Ÿå±äºå‡½æ•°å¼æ¥å£</p><p>å‡½æ•°å¼æ¥å£è¿˜æœ‰ä¸€ä¸ªæ³¨è§£ä¸º<code>@FunctionalInterface</code>ï¼Œæ®æˆ‘äº†è§£è¿™ä¸ªæ³¨è§£å¯æœ‰å¯æ— ï¼Œå®ƒä¸»è¦èµ·åˆ°çš„æ˜¯æ£€æŸ¥çš„ä½œç”¨ï¼Œå½“æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•æ•°é‡å¤§äº1çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼š</p><p><img src="..//img/JDK8-02.png" alt=""></p><h2 id="å†…ç½®å¸¸ç”¨å‡½æ•°å¼æ¥å£">å†…ç½®å¸¸ç”¨å‡½æ•°å¼æ¥å£</h2><p>Javaä¸­å†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£ï¼Œè¿™é‡Œä»‹ç»å…¶ä¸­çš„å››ç§ï¼Œä¸ç”¨åˆ»æ„å»è®°ï¼Œç”¨åˆ°å°±æ˜ç™½äº†</p><table><thead><tr><th>å‡½æ•°å¼æ¥å£</th><th>å‚æ•°</th><th>è¿”å›å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Consumer<T></td><td>T</td><td>void</td><td>å¯¹ç±»å‹ä¸ºTçš„å®ä¾‹è¿›è¡Œæ“ä½œ</td></tr><tr><td>Supplier<T></td><td>æ— </td><td>T</td><td>è¿”å›ç±»å‹ä¸ºTçš„å®ä¾‹</td></tr><tr><td>Function&lt;T, R&gt;</td><td>T</td><td>R</td><td>é€šè¿‡å¯¹Tçš„æ“ä½œè¿”å›Rçš„å®ä¾‹</td></tr><tr><td>Predicate<T></td><td>T</td><td>boolean</td><td>é€šè¿‡å¯¹Tçš„æ“ä½œè¿”å›booleanå€¼</td></tr></tbody></table><p>é€šè¿‡å·§å¦™çš„è¿ç”¨å‡½æ•°å¼æ¥å£å¯ä»¥å®ç°å›è°ƒå‡½æ•°çš„åŠŸèƒ½</p><h1>Lambdaè¡¨è¾¾å¼</h1><p>Lambdaè¡¨è¾¾å¼æ˜¯1.8ä¸­çš„æ–°ç‰¹æ€§ï¼Œ<em>ä¸»è¦é’ˆå¯¹å‡½æ•°å¼æ¥å£çš„åŒ¿åå†…éƒ¨ç±»å®ç°åšäº†ç®€åŒ–</em></p><h2 id="è¡¨è¾¾å¼åŸºæœ¬è¯­æ³•">è¡¨è¾¾å¼åŸºæœ¬è¯­æ³•</h2><p>æ‰¾åˆ°ä¸Šé¢åŒ¿åå†…éƒ¨ç±»åˆ›å»º<code>LogService</code>çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LogService</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogService</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å˜¿å˜¿å˜¿&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºåˆ›å»ºçš„å®ä¾‹å°±æ˜¯æ¥å£æœ¬èº«ï¼Œæ‰€ä»¥<code>new</code>çš„éƒ¨åˆ†å°±å¯ä»¥çœç•¥ä¸å†™ï¼Œæ¥å£ä¸­éœ€è¦å®ç°çš„æŠ½è±¡æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆä¹Ÿæ²¡æœ‰å¿…è¦æŒ‡å®šå…·ä½“å®ç°çš„æ–¹æ³•åç§°ï¼Œç®€å†™åå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LogService</span> <span class="variable">log</span> <span class="operator">=</span> ()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å“ˆå“ˆå“ˆå“ˆ&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        log.info();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Lambdaè¡¨è¾¾å¼å‰é¢çš„æ‹¬å·<code>( )</code>å°±ä»£è¡¨å‚æ•°åˆ—è¡¨ï¼Œç®­å¤´<code>-&gt;</code>åé¢çš„ä»£ç å—å°±ä»£è¡¨ç€å®ç°çš„å…·ä½“æ–¹æ³•ä½“ï¼Œå¦‚æœ<code>info</code>æ–¹æ³•ä¸­æœ‰å‚æ•°å°±å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LogService</span> <span class="variable">log</span> <span class="operator">=</span> (msg)-&gt;&#123;</span><br><span class="line">            System.out.println(msg);</span><br><span class="line">        &#125;;</span><br><span class="line">        log.info(<span class="string">&quot;è€å…«ç§˜åˆ¶å°æ±‰å ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Lambdaè¡¨è¾¾å¼åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Runnableä¸ºå‡½æ•°å¼æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å¦ä¸€æ¡çº¿ç¨‹&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        System.out.println(<span class="string">&quot;Mainä¸»çº¿ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¡¨è¾¾å¼çš„ç®€å†™">è¡¨è¾¾å¼çš„ç®€å†™</h2><p>ä½¿ç”¨Lambdaè¡¨è¾¾å¼ä»£æ›¿åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•éå¸¸ç®€æ´ï¼Œä½†æ˜¯åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå®ƒè¿˜å¯ä»¥æ›´ç®€æ´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * åœ¨å‚æ•°åˆ—è¡¨åªæœ‰ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œ()å¯ä»¥çœç•¥ä¸å†™</span></span><br><span class="line"><span class="comment">         * å½“ä»£ç å—ä¸­åªæœ‰ä¸€å¥ä»£ç æ—¶&#123;&#125;å¯ä»¥çœç•¥ä¸å†™</span></span><br><span class="line"><span class="comment">         * å½“å‡½æ•°æœ‰è¿”å›å€¼ä¸”ä»£ç å—ä¸­åªæœ‰ä¸€å¥ä»£ç æ—¶returnå¯ä»¥çœç•¥ä¸å†™</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">LogService</span> <span class="variable">log</span> <span class="operator">=</span> msg-&gt;System.out.println(msg);</span><br><span class="line">        log.info(<span class="string">&quot;è€å…«ç§˜åˆ¶å°æ±‰å ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Lambdaè¡¨è¾¾å¼ç›¸æ¯”åŒ¿åå†…éƒ¨ç±»è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå½“ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ—¶ä¼šä¸ºåŒ¿åå†…éƒ¨ç±»ç”Ÿæˆä¸€ä¸ªclassæ–‡ä»¶ï¼Œè€Œä½¿ç”¨Lambdaè¡¨è¾¾å¼æ—¶å°±ä¸ä¼šé¢å¤–ç”Ÿæˆclassæ–‡ä»¶ï¼Œè¿™ä¸ªä¸åšé‡ç‚¹</p><h1>æ–¹æ³•å¼•ç”¨</h1><p>æ–¹æ³•å¼•ç”¨æ˜¯1.8ä¸­çš„æ–°ç‰¹æ€§ï¼Œé…åˆLambdaè¡¨è¾¾å¼ä½¿ç”¨å¯ä»¥è®©ä»£ç æ›´ç®€æ´</p><h2 id="æ–¹æ³•å¼•ç”¨åˆä½“éªŒ">æ–¹æ³•å¼•ç”¨åˆä½“éªŒ</h2><p>æ–¹æ³•å¼•ç”¨ä¸­éœ€è¦çš„ç‰¹æ®Šç¬¦å·ä¸ºåŒå†’å·<code>::</code>ï¼Œå…·ä½“è¡¨ç°ä¸ºä»¥ä¸‹å½¢å¼ï¼š</p><table><thead><tr><th>è¡¨ç°å½¢å¼</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>å¯¹è±¡::å®ä¾‹æ–¹æ³•</td><td>é€šè¿‡å¯¹è±¡è°ƒç”¨å®ä¾‹ä¸­çš„æ–¹æ³•</td></tr><tr><td>ç±»::å®ä¾‹æ–¹æ³•</td><td>é€šè¿‡ç±»è°ƒç”¨å®ä¾‹ä¸­çš„æ–¹æ³•</td></tr><tr><td>ç±»::é™æ€æ–¹æ³•</td><td>é€šè¿‡ç±»è°ƒç”¨å®ä¾‹ä¸­çš„é™æ€æ–¹æ³•</td></tr><tr><td>ç±»::new</td><td>åˆ›å»ºè¯¥ç±»çš„å®ä¾‹</td></tr></tbody></table><p><em>å½“Lambdaè¡¨è¾¾å¼ä¸­åªæœ‰ä¸€å¥å‡½æ•°è°ƒç”¨ä»£ç ï¼Œä¸”è°ƒç”¨çš„ç›®æ ‡å‡½æ•°çš„å‚æ•°åˆ—è¡¨å’ŒLambdaè¡¨è¾¾å¼æ¥æ”¶çš„å‚æ•°åˆ—è¡¨ä¸€è‡´æ—¶å°±å¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨</em>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»£è¡¨çš„å°±æ˜¯ä¸Šé¢è¡¨æ ¼ä¸­è¡¨ç°å½¢å¼çš„ç¬¬ä¸€è¡Œ  å¯¹è±¡::å®ä¾‹æ–¹æ³•</span></span><br><span class="line">        <span class="type">LogService</span> <span class="variable">log</span> <span class="operator">=</span> System.out::println;</span><br><span class="line">        log.info(<span class="string">&quot;è€å…«ç§˜åˆ¶å°æ±‰å ¡&quot;</span>);</span><br><span class="line">        <span class="comment">// forEachåŒæ ·å¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»¼åˆç»ƒä¹ ">ç»¼åˆç»ƒä¹ </h2><p>é’ˆå¯¹ä¸Šé¢çš„å‡½æ•°å¼æ¥å£ï¼ŒLambdaè¡¨è¾¾å¼ä»¥åŠæ–¹æ³•å¼•ç”¨åšç»ƒä¹ ï¼Œä»£ç ä¼šæœ‰äº›å¤šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»¼åˆç»ƒä¹ </span></span><br><span class="line"><span class="comment"> *   å‡½æ•°å¼æ¥å£ + Lambdaè¡¨è¾¾å¼ + æ–¹æ³•å¼•ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ–¹æ³•å¼•ç”¨  å¯¹è±¡::å®ä¾‹æ–¹æ³•</span></span><br><span class="line">        strToDate(<span class="string">&quot;2021-2-20 22:08:45&quot;</span>, System.out::println);</span><br><span class="line">        <span class="comment">// æ–¹æ³•å¼•ç”¨  ç±»::new</span></span><br><span class="line">        System.out.println(dateToStr(Date::<span class="keyword">new</span>));</span><br><span class="line">        <span class="comment">// å›è°ƒå‡½æ•°ï¼šå–æœ€å¤§å€¼</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> strListToIntList(Arrays.asList(<span class="string">&quot;135&quot;</span>, <span class="string">&quot;541&quot;</span>, <span class="string">&quot;244&quot;</span>), list -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">maxNumber</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (Integer item : list) &#123;</span><br><span class="line">                <span class="keyword">if</span> (item &gt; maxNumber) &#123;</span><br><span class="line">                    maxNumber = item;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> maxNumber;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€å¤§å€¼ä¸ºï¼š&quot;</span> + integer);</span><br><span class="line">        <span class="comment">// å®ç°è¿‡æ»¤å™¨åŠŸèƒ½</span></span><br><span class="line">        List&lt;Integer&gt; list = filter(Arrays.asList(<span class="number">800</span>, <span class="number">200</span>, <span class="number">1200</span>, <span class="number">600</span>, <span class="number">3000</span>, <span class="number">2400</span>), item -&gt; item &gt; <span class="number">1000</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Consumerï¼šé€šè¿‡æ—¶é—´å­—ç¬¦ä¸²å¿«é€Ÿè·å–Dateå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">strToDate</span><span class="params">(String date, Consumer&lt;Date&gt; consumer)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">parse</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            parse = sdf.parse(date);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;è½¬æ¢å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        consumer.accept(parse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Supplierï¼šé€šè¿‡Dateå¯¹è±¡å¿«é€Ÿè·å–åˆ°æ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">dateToStr</span><span class="params">(Supplier&lt;Date&gt; supplier)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> supplier.get();</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sdf.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Functionï¼šå°†Stringé›†åˆè½¬æ¢ä¸ºIntegerï¼Œåç»­æ“ä½œäº¤ç»™è°ƒç”¨è€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">strListToIntList</span><span class="params">(List&lt;String&gt; list, Function&lt;List&lt;Integer&gt;, Integer&gt; function)</span> &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; integerList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; iterator = list.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> Integer.valueOf(next);</span><br><span class="line">            integerList.add(integer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> function.apply(integerList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// predicateï¼šè¿”å›å¤§äº1000çš„æ•°å­—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">filter</span><span class="params">(List&lt;Integer&gt; list, Predicate&lt;Integer&gt; predicate)</span> &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; target = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Integer item : list) &#123;</span><br><span class="line">            <span class="keyword">if</span> (predicate.test(item)) &#123;</span><br><span class="line">                target.add(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æµå¼ç¼–ç¨‹</h1><p>æµå¼ç¼–ç¨‹æ˜¯1.8ä¸­çš„æ–°ç‰¹æ€§ï¼ŒåŸºäºå¸¸ç”¨çš„å››ç§å‡½æ•°å¼æ¥å£ä»¥åŠLambdaè¡¨è¾¾å¼å¯¹é›†åˆç±»æ•°æ®è¿›è¡Œç±»ä¼¼æµæ°´çº¿ä¸€èˆ¬çš„æ“ä½œ</p><p>æµå¼ç¼–ç¨‹åˆ†ä¸ºå¤§æ¦‚ä¸‰ä¸ªæ­¥éª¤ï¼š<code>è·å–æµ â†’ æ“ä½œæµ â†’ è¿”å›æ“ä½œç»“æœ</code></p><h2 id="æµçš„è·å–æ–¹å¼">æµçš„è·å–æ–¹å¼</h2><p>è¿™é‡Œå…ˆäº†è§£è·å–æµçš„å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼ï¼Œåé¢åœ¨è¿›è¡Œæµçš„æ“ä½œ</p><blockquote><p>é›†åˆä¸­è·å–æµ</p></blockquote><p>ä¼—æ‰€å‘¨çŸ¥Javaä¸­æ‰€æœ‰çš„é›†åˆéƒ½æ˜¯<code>Collection</code>ä¸‹çš„å®ç°ç±»ï¼Œåœ¨<code>Collection</code>æ¥å£ä¸­å°±æä¾›äº†è·å–æµçš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è·å–æµ</span></span><br><span class="line">        Stream&lt;Integer&gt; stream1 = list.stream();</span><br><span class="line">        <span class="comment">// è·å–æµ(å¤šçº¿ç¨‹ï¼Œå¤§æ•°æ®é‡ä¸‹æ•ˆç‡è¾ƒé«˜)</span></span><br><span class="line">        Stream&lt;Integer&gt; stream2 = list.parallelStream();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ•°ç»„ä¸­è·å–æµ</p></blockquote><p>é’ˆå¯¹æ•°ç»„Javaä¸­æä¾›äº†ä¸€ä¸ª<code>Arrays</code>å·¥å…·ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°ç»„è½¬æ¢ä¸ºé›†åˆåœ¨è·å–æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Integer[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(arr);</span><br><span class="line">        Stream&lt;Integer&gt; stream1 = list.stream();</span><br><span class="line">        Stream&lt;Integer&gt; stream2 = list.parallelStream();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥é€šè¿‡<code>Arrays</code>ç±»è·å–åˆ°æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Integer[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">        Stream&lt;Integer&gt; stream = Arrays.stream(arr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµçš„è·å–æ–¹å¼ æ€»ç»“ä¸è¡¥å……</p></blockquote><table><thead><tr><th>æ–¹æ³•å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Collection.stream()</td><td>ä»é›†åˆä¸­è·å–æµ</td></tr><tr><td>Collection.parallelStream()</td><td>ä»é›†åˆä¸­è·å–æµ ( å¤šçº¿ç¨‹ )</td></tr><tr><td>Arrays.stream(T[])</td><td>ä»æ•°ç»„ä¸­è·å–æµ</td></tr><tr><td>Stream.of(Tâ€¦ values)</td><td>ç›´æ¥ä¼ å…¥å¤šä¸ªå…ƒç´ è¿”å›ä¸€ä¸ªæµ</td></tr><tr><td>Stream.generate(Supplier<T> s)</td><td>Lambdaè¿”å›çš„æ¯ä¸ªå®ä¾‹éƒ½æ˜¯æµä¸­çš„ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>Stream iterate(final T seed, final UnaryOperator<T> f)</td><td>Lambdaæ¥æ”¶å‚æ•°ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç»“æœä½œä¸ºå…ƒç´ ï¼Œæ¯æ¬¡è¿”å›çš„ç»“æœéƒ½å°†ä½œä¸ºä¸‹ä¸€ä¸ªLambdaçš„å‚æ•° ( è¿­ä»£ )</td></tr></tbody></table><h2 id="æ“ä½œæµä¸­çš„æ•°æ®">æ“ä½œæµä¸­çš„æ•°æ®</h2><h3 id="å‡æ•°æ®æ¨¡æ‹Ÿ">å‡æ•°æ®æ¨¡æ‹Ÿ</h3><p>çŸ¥é“äº†å¦‚ä½•è·å–åˆ°æµä¹‹åï¼Œå°±è¦å¼€å§‹å­¦ä¹ æ“ä½œæµäº†ï¼Œåœ¨ç»ƒä¹ ä¹‹é—´å…ˆå†™ä¸€ä¸ªå‡çš„æ¥å£æ¥æ¨¡æ‹Ÿæ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥å£æ¨¡æ‹Ÿæ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;UserEntity&gt; <span class="title function_">selectList</span><span class="params">()</span> &#123;</span><br><span class="line">        ArrayList&lt;UserEntity&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;è€å…«&quot;</span>, <span class="number">32</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="number">8000</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;éƒ­è€å¸ˆ&quot;</span>, <span class="number">36</span>, <span class="string">&#x27;å¥³&#x27;</span>, <span class="number">7000</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;å¢æœ¬ä¼Ÿ&quot;</span>, <span class="number">32</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="number">18000</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;å¼ æ˜¥å¾·&quot;</span>, <span class="number">22</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="number">2800</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;å¤§å¸é©¬&quot;</span>, <span class="number">34</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="number">12000</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;è€å…«&quot;</span>, <span class="number">32</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="number">8000</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;è´¾ç²&quot;</span>, <span class="number">22</span>, <span class="string">&#x27;å¥³&#x27;</span>, <span class="number">21000</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;å‘¨æ·‘æ€¡&quot;</span>, <span class="number">26</span>, <span class="string">&#x27;å¥³&#x27;</span>, <span class="number">14800</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="string">&quot;PDD&quot;</span>, <span class="number">37</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="number">26300</span>));</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserEntityå®ä½“ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span> gender;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserEntity</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserEntity</span><span class="params">(String name, <span class="type">int</span> age, <span class="type">char</span> gender, <span class="type">int</span> salary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">getGender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(<span class="type">char</span> gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSalary</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSalary</span><span class="params">(<span class="type">int</span> salary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">that</span> <span class="operator">=</span> (UserEntity) o;</span><br><span class="line">        <span class="keyword">return</span> getAge() == that.getAge() &amp;&amp;</span><br><span class="line">                getGender() == that.getGender() &amp;&amp;</span><br><span class="line">                getSalary() == that.getSalary() &amp;&amp;</span><br><span class="line">                getName().equals(that.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(getName(), getAge(), getGender(), getSalary());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;å§“å=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, å¹´é¾„=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, æ€§åˆ«=&quot;</span> + gender +</span><br><span class="line">                <span class="string">&quot;, è–ªæ°´=&quot;</span> + salary +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å¼æ¥å£å¤ä¹ ">å‡½æ•°å¼æ¥å£å¤ä¹ </h3><p>åœ¨æ“ä½œæµå¼ç¼–ç¨‹ä¹‹å‰å…ˆæ¥å¤ä¹ ä¸€ä¸‹å‡½æ•°å¼æ¥å£ï¼Œè¿™é‡Œä»¥å®ç°é›†åˆçš„è¿‡æ»¤å™¨ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰å¥³æ€§å‘˜å·¥</span></span><br><span class="line">        ArrayList&lt;UserEntity&gt; result = filter(list, item -&gt; item.getGender() == <span class="string">&#x27;å¥³&#x27;</span>);</span><br><span class="line">        result.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰é›†åˆè¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;UserEntity&gt; <span class="title function_">filter</span><span class="params">(List&lt;UserEntity&gt; list, Predicate&lt;UserEntity&gt; predicate)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªç»“æœé›†</span></span><br><span class="line">        ArrayList&lt;UserEntity&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// ç©ºå€¼æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (list == <span class="literal">null</span> || list.size()==<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// éå†ä¼ å…¥çš„é›†åˆï¼Œæ ¹æ®è°ƒç”¨è€…åˆ¶å®šçš„è¿‡æ»¤è§„åˆ™è¿›è¡Œåˆ¤æ–­ï¼Œç¬¦åˆæ¡ä»¶å°±æ·»åŠ åˆ°ç»“æœé›†ä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (UserEntity entity : list) &#123;</span><br><span class="line">            <span class="keyword">if</span> (predicate.test(entity)) &#123;</span><br><span class="line">                result.add(entity);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±è·å–åˆ°äº†ä¸€ä¸ª ArrayList é›†åˆçš„è¿‡æ»¤å™¨</p><h3 id="æ“ä½œæµçš„æ–¹æ³•">æ“ä½œæµçš„æ–¹æ³•</h3><p>æµå¼ç¼–ç¨‹æ“ä½œæµéå¸¸ç±»ä¼¼ä¸Šé¢çš„ä»£ç ï¼Œå¸¸ç”¨å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th>æ–¹æ³•å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>filter()</td><td>å¾ªç¯é›†åˆä¸­æ¯ä¸ªå…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œè¿”å›falseçš„å…ƒç´ ä¼šè¢«è¿‡æ»¤æ‰</td></tr><tr><td>limit()</td><td>æˆªå–æ–¹æ³•ï¼Œä¼ å…¥ int ç±»å‹çš„ nï¼Œä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹åªè·å– n ä¸ª</td></tr><tr><td>skip()</td><td>è·³è¿‡æ–¹æ³•ï¼Œä¼ å…¥ long ç±»å‹çš„ nï¼Œæµå°†ä»ç¬¬ n+1 ä¸ªå…ƒç´ å¼€å§‹æ“ä½œ</td></tr><tr><td>distinct()</td><td>å»é‡æ–¹æ³•ï¼Œå»æ‰é›†åˆä¸­é‡å¤çš„å…ƒç´ ï¼Œåªä¿ç•™ç¬¬ä¸€ä¸ª</td></tr><tr><td>sorted()</td><td>æ’åºæ–¹æ³•ï¼Œé€šè¿‡åˆ¤æ–­è¿”å›çš„ boolean å€¼ä½œä¸ºå‚è€ƒè¿›è¡Œæ’åº</td></tr><tr><td>map()</td><td>è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œåé¢ç”¨åˆ°ä¼šè¯¦ç»†è¯´æ˜</td></tr></tbody></table><p><strong>ä½¿ç”¨æµå¼ç¼–ç¨‹éœ€è¦äº†è§£ä»–çš„ç‰¹ç‚¹ï¼š</strong></p><ol><li>æˆ‘ä»¬é€šè¿‡æµå¼ç¼–ç¨‹æ“ä½œé›†åˆæ˜¯ä¸ä¼šå½±å“é›†åˆæœ¬èº«</li><li>æµå¼ç¼–ç¨‹çš„ä»£ç éƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ï¼Œåªæœ‰åœ¨è·å–ç»“æœçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ</li></ol><blockquote><p>filter è¿‡æ»¤æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–åˆ°è–ªæ°´å¤§äº10000çš„æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                .filter(item-&gt;item.getSalary()&gt;<span class="number">10000</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>limit æˆªå–æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªè·å–ç»“æœä¸­çš„5æ¡æ•°æ®(ä»é¦–ä¸ªå¼€å§‹æˆªå–)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                .limit(<span class="number">5</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>skip è·³è¿‡æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œå°±è·³è¿‡äº†2ä¸ªå…ƒç´ ï¼Œä»&quot;å¢æœ¬ä¼Ÿ&quot;å¼€å§‹æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                .skip(<span class="number">2</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>distinctï¼šå»é‡æ–¹æ³•</p></blockquote><p>è¿™é‡Œéœ€è¦æä¸€å˜´ï¼Œ<strong>ä½¿ç”¨<code>distinct</code>æ–¹æ³•æ“ä½œçš„å®ä½“ç±»å¿…é¡»å¤å†™<code>equals</code>å’Œ<code>hashCode</code>æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»é‡æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªè€å…«åªå‰©ä¸‹ä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                .distinct()</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>sorted ï¼šæ’åºæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡è–ªæ°´å¯¹é›†åˆè¿›è¡Œæ’åº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                <span class="comment">// æ’åºéœ€è¦ä¼ å…¥ä¸€ä¸ªComparatoræ¯”è¾ƒå™¨ï¼Œè¿™é‡Œé€šè¿‡Integerç›´æ¥è·å–</span></span><br><span class="line">                <span class="comment">// é€šè¿‡è°ƒæ¢item1å’Œitem2çš„é¡ºåºå®ç°å‡åºé™åºçš„è°ƒæ•´</span></span><br><span class="line">                .sorted((item1, item2)-&gt;Integer.compare(item1.getSalary(), item2.getSalary()))</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>mapï¼šç”Ÿæˆæ–°çš„æ•°æ®</p></blockquote><p><code>map</code>åŒä¹‹å‰é‚£å‡ ä¸ªç¨å¾®æœ‰äº›åŒºåˆ«ï¼Œç±»ä¼¼<code>filter</code>æˆ–è€…<code>sorted</code>æ–¹æ³•éƒ½æ˜¯å¯¹é›†åˆè¿›è¡Œç¼–è¾‘ï¼Œè€Œ<code>map</code>å¯ä»¥å°†é›†åˆæ”¹å˜ä¸ºä¸€ç»„æ–°çš„æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡mapè¿”å›æ¯ä¸ªç”¨æˆ·çš„å§“åï¼Œå°†ç”¨æˆ·é›†åˆæ”¹å˜æˆäº†ç”¨æˆ·å§“åé›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                .map(UserEntity::getName)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿”å›æ“ä½œç»“æœ">è¿”å›æ“ä½œç»“æœ</h2><p>è¿”å›æ“ä½œç»“æœæ˜¯æµå¼ç¼–ç¨‹æœ€åä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œä¹‹å‰è¯´è¿‡æµå¼ç¼–ç¨‹æ“ä½œé›†åˆä¸ä¼šå½±å“é›†åˆæœ¬èº«ï¼Œé‚£ä¹ˆæƒ³è¦è·å–ç»“æœå°±éœ€è¦è¿›è¡Œè¿™æœ€åä¸€æ­¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<em>æµå¼ç¼–ç¨‹åªæœ‰åœ¨è¿”å›æ“ä½œç»“æœçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œæ“ä½œä»£ç </em></p><p>ä¹‹å‰ä½¿ç”¨çš„<code>forEach</code>å°±å±äºè¿”å›ç»“æœçš„ä»£ç ï¼Œå¦‚æœåªè°ƒç”¨äº†<code>filter</code>æ–¹æ³•è€Œæ²¡æœ‰è°ƒç”¨è¿”å›ç»“æœï¼Œé‚£ä¹ˆ<code>filter</code>æ–¹æ³•æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ®µä»£ç è¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç æ­£å¸¸æ‰§è¡Œï¼Œå¦‚æœå°†forEachç§»é™¤å°±ä¼šå‘ç°filterä¸­çš„æ‰“å°è¯­å¥åŒæ ·æ²¡æœ‰æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                .filter(item-&gt;&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;è¿‡æ»¤ä»£ç æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> item.getSalary() &gt; <span class="number">10000</span>;</span><br><span class="line">                &#125;).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨è·å–ç»“æœçš„æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>forEach()</td><td>å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œéå†</td></tr><tr><td>min()</td><td>ä¼ å…¥æ¯”è¾ƒå™¨è·å–æœ€å°å€¼</td></tr><tr><td>max()</td><td>ä¼ å…¥æ¯”è¾ƒå™¨è·å–æœ€å¤§å€¼</td></tr><tr><td>count()</td><td>è®¡ç®—æœ€ç»ˆç»“æœçš„æ•°é‡</td></tr><tr><td>collect()</td><td>å°†æ“ä½œç»“æœè½¬æ¢ä¸ºé›†åˆ</td></tr></tbody></table><blockquote><p>forEachï¼šå¾ªç¯éå†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// forEachæ˜¯æœ€ç®€å•çš„å¾ªç¯éå†ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        list.stream()</span><br><span class="line">                .filter(item-&gt;item.getSalary() &gt; <span class="number">10000</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>minï¼šå–æœ€å°å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">entity</span> <span class="operator">=</span> list.stream()</span><br><span class="line">                .filter(item -&gt; item.getSalary() &gt; <span class="number">10000</span>)</span><br><span class="line">                <span class="comment">// è·å–æœ€å°å€¼éœ€è¦ä¼ å…¥Comparatoræ¯”è¾ƒå™¨ï¼Œç›´æ¥ä»Comparatorä¸­å–å‡ºIntç±»å‹æ¯”è¾ƒå™¨</span></span><br><span class="line">                .mim(Comparator.comparingInt(UserEntity::getSalary))</span><br><span class="line">                <span class="comment">// è¿™é‡Œå¹¶ä¸ä¼šç›´æ¥è¿”å›å®ä½“ç±»ï¼Œéœ€è¦åœ¨getä¸€ä¸‹æ‰èƒ½è·å–åˆ°</span></span><br><span class="line">                .get();</span><br><span class="line">        System.out.println(entity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>maxï¼šå–æœ€å¤§å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        <span class="type">UserEntity</span> <span class="variable">entity</span> <span class="operator">=</span> list.stream()</span><br><span class="line">                .filter(item -&gt; item.getSalary() &gt; <span class="number">10000</span>)</span><br><span class="line">                <span class="comment">// maxåŒminä¸€è‡´</span></span><br><span class="line">                .max(Comparator.comparingInt(UserEntity::getSalary))</span><br><span class="line">                .get();</span><br><span class="line">        System.out.println(entity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>countï¼šå¯¹ç»“æœè¿›è¡Œè®¡æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–æœˆè–ªå¤§äº10000çš„äººæ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> list.stream()</span><br><span class="line">                .filter(item -&gt; item.getSalary() &gt; <span class="number">10000</span>)</span><br><span class="line">                .count();</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>collectï¼šè¿”å›æ“ä½œç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        List&lt;UserEntity&gt; collect = list.stream()</span><br><span class="line">                .filter(item -&gt; item.getSalary() &gt; <span class="number">10000</span>)</span><br><span class="line">                <span class="comment">// ç›´æ¥è°ƒç”¨collectæ–¹æ³•ï¼Œç„¶åè°ƒç”¨toListå°†ç»“æœè½¬æ¢ä¸ºListé›†åˆ</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(collect);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµå¼ç¼–ç¨‹ç»¼åˆç»ƒä¹ ">æµå¼ç¼–ç¨‹ç»¼åˆç»ƒä¹ </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµå¼ç¼–ç¨‹+é“¾å¼ç¼–ç¨‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        List&lt;UserEntity&gt; list = userService.selectList();</span><br><span class="line">        List&lt;String&gt; result = list.stream()</span><br><span class="line">                <span class="comment">// æ‰¾åˆ°æ‰€æœ‰ç”·æ€§å‘˜å·¥</span></span><br><span class="line">                .filter(item-&gt;item.getGender()==<span class="string">&#x27;ç”·&#x27;</span>)</span><br><span class="line">                <span class="comment">// å»é™¤é‡å¤æ•°æ®</span></span><br><span class="line">                .distinct()</span><br><span class="line">                <span class="comment">// æŒ‰ç…§å¹´é¾„è¿›è¡Œæ’åº</span></span><br><span class="line">                .sorted(Comparator.comparingInt(UserEntity::getAge))</span><br><span class="line">                <span class="comment">// è·å–ä»–ä»¬æ‰€æœ‰äººçš„åå­—</span></span><br><span class="line">                .map(UserEntity::getName)</span><br><span class="line">                <span class="comment">// æœ€åè½¬æ¢ä¸ºListé›†åˆ</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// æ‰“å°æŸ¥çœ‹æ•ˆæœ</span></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java ä¸­çš„ IO æµ</title>
    <link href="/2021/04/13/Java%E7%AC%94%E8%AE%B0/IO%E6%B5%81%E6%8A%80%E6%9C%AF/"/>
    <url>/2021/04/13/Java%E7%AC%94%E8%AE%B0/IO%E6%B5%81%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="Java-IO">Java IO</h2><p>Java ä¸­çš„ IO æµæ˜¯æˆ‘ä»¬é€šè¿‡ç¨‹åºå¯¹ç£ç›˜æˆ–ç½‘ç»œä¸­çš„æŸä¸ªæ–‡ä»¶è¿›è¡ŒæŸç§æ“ä½œçš„æ—¶å€™ä½¿ç”¨çš„æŠ€æœ¯</p><h3 id="File-æ–‡ä»¶ç±»">File æ–‡ä»¶ç±»</h3><p>File ç±»æ˜¯ä¸“é—¨å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„ç±»ï¼Œä¸€ä¸ª File å®ä¾‹ä»£è¡¨ç¡¬ç›˜ä¸­å®é™…å­˜åœ¨çš„ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ <strong>å®ƒåªèƒ½é’ˆå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸èƒ½æ“ä½œæ–‡ä»¶ä¸­çš„å†…å®¹</strong></p><blockquote><p>åˆ›å»º File ç±»çš„å®ä¾‹</p></blockquote><p>æ—¢ç„¶è¯´ File ç±»æ˜¯æ“ä½œæ–‡ä»¶çš„ï¼Œé‚£ä¹ˆå½“ç„¶ä¸€ä¸ªç±»å¯¹åº”çš„å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨åˆ›å»ºçš„æ—¶å€™å°±è¦å‘Šè¯‰ä»–ä»£è¡¨çš„æ˜¯ä»€ä¹ˆï¼Œåˆ›å»º File ç±»å®ä¾‹æœ€å¸¸è§çš„ä¸‰ç§æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–Fileç±»çš„å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFile1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ç›´æ¥è·å–ç›®æ ‡æ–‡ä»¶å®ä¾‹</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å®ä¾‹</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/&quot;</span>, <span class="string">&quot;3.txt&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–æŸä¸ªFileç±»å®ä¾‹(å¯¹åº”çš„æ˜¯æ–‡ä»¶å¤¹)ä¸‹çš„æŸä¸ªæ–‡ä»¶å®ä¾‹</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">f3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>( <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/&quot;</span>), <span class="string">&quot;3.txt&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>File ç±»çš„å¸¸ç”¨æ–¹æ³•ï¼šåˆ¤æ–­æ–¹æ³•</p></blockquote><p>File ç±»å…·ä½“æŒ‡å‘çš„æ˜¯ä»€ä¹ˆæ ·çš„å­—ç¬¦ä¸²æˆ‘ä»¬ä¸ä¸€å®šæ˜¯éƒ½çŸ¥é“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¾é ä¸€äº›åˆ¤æ–­çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fileç±»çš„åˆ¤æ–­æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFile1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç›®æ ‡æ˜¯å¦å­˜åœ¨ï¼š&quot;</span> + file.exists());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦æ˜¯æ–‡ä»¶ï¼š&quot;</span> + file.isFile());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹ï¼š&quot;</span> + file.isDirectory());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>File ç±»çš„å¸¸ç”¨æ–¹æ³•ï¼šè·å–æ–¹æ³•</p></blockquote><p>æˆ‘ä»¬æƒ³è¦é€šè¿‡ File ç¤ºä¾‹æ‹¿åˆ°ç›¸åº”çš„ä¿¡æ¯ï¼Œå°±éœ€è¦ç”¨åˆ°è·å–æ–¹æ³•å•¦ï¼Œæ–¹æ³•å¤šäº†ç‚¹è¿™é‡Œåˆ—äº†ä¸€ä¸ªè¡¨æ ¼ï¼š</p><table><thead><tr><th>è°ƒç”¨è€…</th><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>æ–‡ä»¶</td><td>getName()</td><td>è·å–æ–‡ä»¶ ( å¤¹ ) åç§°</td></tr><tr><td>æ–‡ä»¶</td><td>getPath()</td><td>è·å–æ–‡ä»¶ ( å¤¹ ) ç›¸å¯¹è·¯å¾„</td></tr><tr><td>æ–‡ä»¶</td><td>getAbsolutePath()</td><td>è·å–æ–‡ä»¶ ( å¤¹ ) ç»å¯¹è·¯å¾„</td></tr><tr><td>æ–‡ä»¶</td><td>length()</td><td>è·å–æ–‡ä»¶å¤§å° ( å•ä½ï¼šå­—èŠ‚ )</td></tr><tr><td>æ–‡ä»¶å¤¹</td><td>list()</td><td>è·å–æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ ( å¤¹ ) çš„å­—ç¬¦ä¸²æ•°ç»„</td></tr><tr><td>æ–‡ä»¶å¤¹</td><td>listFiles()</td><td>è·å–æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ ( å¤¹ ) çš„ File ç±»æ•°ç»„</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fileç±»çš„è·å–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFile1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==æ–‡ä»¶ç±»å‹=============================&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶åç§°ï¼š&quot;</span> + file.getName());</span><br><span class="line">        <span class="comment">// å½“æˆ‘ä»¬ç”¨ç›¸å¯¹è·¯å¾„åˆ›å»ºFileå¯¹è±¡çš„æ—¶å€™è¿”å›çš„å°±æ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç›¸å¯¹è·¯å¾„ï¼š&quot;</span> + file.getPath());</span><br><span class="line">        System.out.println(<span class="string">&quot;ç»å¯¹è·¯å¾„ï¼š&quot;</span> + file.getAbsolutePath());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å¤§å°ï¼š&quot;</span> + file.length() + <span class="string">&quot;å­—èŠ‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;==æ–‡ä»¶å¤¹ç±»å‹===========================&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">folder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/&quot;</span>);</span><br><span class="line">        <span class="comment">// å¦‚æœFileå¯¹è±¡æŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹çš„è¯è¿”å›å€¼æ˜¯ä½ç½®çš„ï¼Œæµ‹è¯•ç»“æœæ˜¯0</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å¤§å°ï¼š&quot;</span> + folder.length() + <span class="string">&quot;å­—èŠ‚&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : folder.list())</span><br><span class="line">            System.out.print( s + <span class="string">&quot;  &quot;</span> );</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="keyword">for</span> (File f : folder.listFiles())</span><br><span class="line">            System.out.print( f.getName() + <span class="string">&quot;  &quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ã€8ä½( Bit ) = 1å­—èŠ‚( Byte ) ã€‘â€“ã€1024å­—èŠ‚( Byte ) = 1å…†( M ) ã€‘â€“ã€1024å…†( M ) = 1G ã€‘</li></ul><blockquote><p>File ç±»çš„å¸¸ç”¨æ–¹æ³•ï¼šåˆ›å»ºã€é‡å‘½åä»¥åŠåˆ é™¤</p></blockquote><p>åˆ¤æ–­å’Œè·å–å·²ç»äº†è§£çš„å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥äº†è§£ä¸€ä¸‹åˆ›å»ºã€é‡å‘½åå’Œåˆ é™¤å‡½æ•°ï¼ŒFile ç±»åŸºæœ¬ä¹Ÿå°±å·®ä¸å¤šäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºã€é‡å‘½åä»¥åŠåˆ é™¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFile1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ª4.txtæœ¬èº«æ˜¯ä¸å­˜åœ¨çš„</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/4.txt&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºæ–‡ä»¶ï¼š&quot;</span> + file.createNewFile());</span><br><span class="line">        <span class="comment">// è¿™ä¸ªtestç›®å½•ä¹Ÿæ˜¯ä¸å­˜åœ¨çš„</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">folder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/test/&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºç›®å½•ï¼š&quot;</span> + folder.mkdir());</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºå¤šçº§ç›®å½•ï¼š&quot;</span> + </span><br><span class="line">                           <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/test/1/2/3/4/5/6/&quot;</span>).mkdirs());</span><br><span class="line">        <span class="comment">// é‡å‘½åæ–‡ä»¶</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">newName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/40.txt&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶é‡å‘½å&quot;</span> + file.renameTo(newName));</span><br><span class="line">        <span class="comment">// åˆ é™¤å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¤šçº§ç›®å½•æ— æ³•ç›´æ¥åˆ é™¤ï¼Œè¿™é‡Œå†™äº†ä¸€ä¸ªé€’å½’åˆ é™¤çš„å‡½æ•°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤æ–‡ä»¶ï¼š&quot;</span> + newName.delete());</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤æ–‡ä»¶å¤¹ï¼š&quot;</span> + folder.delete());</span><br><span class="line">        System.out.println(<span class="string">&quot;é€’å½’åˆ é™¤&quot;</span> + deletes(folder));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€’å½’åˆ é™¤å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">deletes</span><span class="params">( File file )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory() &amp;&amp; file.list().length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (File f : file.listFiles())</span><br><span class="line">                deletes(f);</span><br><span class="line">            file.delete();</span><br><span class="line">        &#125; <span class="keyword">else</span> file.delete();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å°ç»ƒä¹ ï¼šé€’å½’éå†æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰ æ–‡ä»¶/æ–‡ä»¶å¤¹ï¼Œæœ€ç»ˆåˆ é™¤åä¸ºã€ç—…æ¯’.exeã€‘çš„æ–‡ä»¶ ( æ–‡ä»¶è‡ªå·±åˆ›å»º )</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’éå†ä»¥åŠåˆ é™¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFile1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">StringBuilder</span> <span class="variable">marker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;|-&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/_Zhe/&quot;</span>);</span><br><span class="line">        findAndDelete(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">findAndDelete</span><span class="params">( File file )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( file.isDirectory() &amp;&amp; file.list().length &gt; <span class="number">0</span> )&#123;</span><br><span class="line">            System.out.println(marker.toString() + file.getName());</span><br><span class="line">            <span class="keyword">for</span> (File f : file.listFiles())&#123;</span><br><span class="line">                marker.append(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">                findAndDelete(f);</span><br><span class="line">                marker = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(marker.substring(<span class="number">0</span>, marker.length()-<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(marker.toString() + file.getName());</span><br><span class="line">            <span class="keyword">if</span> ( file.getName().equals(<span class="string">&quot;ç—…æ¯’.exe&quot;</span>) ) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> file.getAbsolutePath();</span><br><span class="line">                file.delete();</span><br><span class="line">                System.out.println(<span class="string">&quot;**********************************************&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;å·²åˆ é™¤ã€ç—…æ¯’.exeã€‘ï¼Œä½äº&quot;</span> + path);</span><br><span class="line">                System.out.println(<span class="string">&quot;**********************************************&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="IO-æµæ¦‚å¿µ">IO æµæ¦‚å¿µ</h3><p>IO æµï¼ŒI ä»£è¡¨ inputï¼ŒO ä»£è¡¨ outputï¼Œæ‰€ä»¥ IO æµå°±æ˜¯è¾“å…¥è¾“å…¥çš„æ•°æ®æµ</p><p>**æµçš„åˆ†ç±»ï¼š**Java ä¸­çš„ IO æµæœ‰ä¸¤å¤§åˆ†ç±»ï¼šä»¥å­—èŠ‚ä¸ºå•ä½çš„ <strong>å­—èŠ‚æµ</strong> ä»¥åŠä»¥å­—ç¬¦ä¸ºå•ä½ <strong>å­—ç¬¦æµ</strong></p><p>**æµçš„æ–¹å‘ï¼š**ä¸¤å¤§åˆ†ç±»ä¸­æ¯ç§æµéƒ½æœ‰ä¸¤ä¸ªæ–¹å‘ï¼Œä»¥å½“å‰åº”ç”¨ç¨‹åºçš„å†…å­˜ä¸ºåŸºå‡†ï¼Œå°†ç¡¬ç›˜ä¸­çš„æŸä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ä¸­å«åš <strong>è¾“å…¥æµ</strong>ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®å†™åˆ°ç¡¬ç›˜ä¸Šçš„æŸä¸ªæ–‡ä»¶ä¸­ï¼Œç§°ä¸º <strong>è¾“å‡ºæµ</strong></p><p>å…±ä¸¤å¤§åˆ†ç±»å››ç§ç±»å‹ï¼Œæ——ä¸‹åˆæœ‰å¤šä¸ªå®ç°ç±»ï¼Œç±»å…³ç³»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="C:/Users/Administrator/Desktop/Markdown/img/JavaSenior-02.jpg" alt="IOç±»å…³ç³»å›¾-å±ˆåšè€å¸ˆ"></p><blockquote><p>å…³äºå…³æµ</p></blockquote><p>**1.**æ— è®ºæ˜¯è¾“å…¥æµè¿˜æ˜¯è¾“å‡ºæµï¼Œåœ¨æˆ‘ä»¬ IO æµä½¿ç”¨å®Œæˆåä¸€å®šè¦è®°å¾— <code>close()</code> å…³æµ</p><p>**2.**å¦‚æœè¾“å…¥è¾“å…¥åŒæ—¶ä½¿ç”¨çš„è¯ï¼Œä¼˜å…ˆå…³é—­è¾“å‡ºæµï¼Œå†å…³é—­è¾“å…¥æµ</p><p>**3.**å¦‚æœæµä¹‹å‰æœ‰ä¸€æ¥å…³ç³» ( ä¾‹å¦‚å­—ç¬¦æµä¾èµ–å­—èŠ‚æµ )ï¼Œéœ€è¦å…ˆå…³é—­åè€…ï¼Œæœ€åå…³é—­å‰è€…</p><h3 id="å­—èŠ‚è¾“å‡ºæµ">å­—èŠ‚è¾“å‡ºæµ</h3><p><code>FileOutputStream</code> ä¸ºå­—èŠ‚è¾“å‡ºæµï¼Œå¸¸ç”¨å‡½æ•°åŒ…å«ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>close()</td><td>å…³é—­æµ</td></tr><tr><td>flush()</td><td>åˆ·æ–°æ­¤è¾“å‡ºæµå°†æ•°æ®éƒ½å†™å‡º</td></tr><tr><td>write(int b)</td><td>å°†æŒ‡å®šçš„å­—èŠ‚è¾“å‡º</td></tr><tr><td>write(byte[] b)</td><td>è¾“å‡ºæ•´ä¸ªå­—èŠ‚æ•°ç»„</td></tr><tr><td>write(byte[] b, int off, int len)</td><td>åŸºäº b æ•°ç»„ï¼Œä»ä¸‹æ ‡ off å¼€å§‹å†™æ»¡ len ä¸ªå­—èŠ‚</td></tr></tbody></table><p>æƒ³è¦ä½¿ç”¨å­—èŠ‚è¾“å‡ºæµé¦–å…ˆéœ€è¦åˆ›å»ºä»–çš„å®ä¾‹</p><blockquote><p>åˆ›å»ºå­—èŠ‚è¾“å‡ºæµå®ä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå­—èŠ‚è¾“å‡ºæµçš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œè¿™é‡Œæ¨èç›´æ¥ä½¿ç”¨ç¬¬ä¸€ç§è·¯å¾„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileOutputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>));</span><br><span class="line">        fos.close();</span><br><span class="line">        fos2.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè¾“å‡ºæµåœ¨ new å¯¹è±¡çš„æ—¶å€™å°±å·²ç»åœ¨ç›®æ ‡ä½ç½®åˆ›å»ºå¥½æ–‡ä»¶äº†ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ä¼šè¿›è¡Œè¦†ç›–ã€‚</li></ul><blockquote><p>å‘æ–‡ä»¶ä¸­è¾“å‡ºæ•°æ®</p></blockquote><p>ä¹‹å‰çš„è¡¨æ ¼ä¸­æœ‰ä»‹ç»è¾“å‡ºçš„å‡½æ•° writeï¼Œè¿™ä¸ªå‡½æ•°é‡è½½äº†ä¸‰æ¬¡ï¼Œæˆ‘ä»¬æ¥åˆ†åˆ«æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// writeå‡½æ•°æµ‹è¯•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileOutputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡åªå†™å‡ºä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        fos.write(<span class="number">97</span>);</span><br><span class="line">        fos.write(<span class="number">98</span>);</span><br><span class="line">        fos.write(<span class="number">99</span>);</span><br><span class="line">        fos.close();</span><br><span class="line">        <span class="comment">// å†™å‡ºæ•´ä¸ªå­—èŠ‚æ•°ç»„</span></span><br><span class="line">        fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/4.txt&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="string">&quot;You can kill me, but you can&#x27;t fuck me&quot;</span>.getBytes();</span><br><span class="line">        fos.write(bytes);</span><br><span class="line">        fos.close();</span><br><span class="line">        <span class="comment">// ä»æŒ‡å®šä½ç½®å¼€å§‹ï¼Œå†™æ»¡lenä¸ªåç»“æŸ -- kill</span></span><br><span class="line">        fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/5.txt&quot;</span>);</span><br><span class="line">        fos.write(bytes, <span class="number">8</span>, <span class="number">4</span>);</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å­—èŠ‚è¾“å‡ºæµå®ç°ç»­å†™ï¼Œæ¢è¡Œ</p></blockquote><p>æµä¸€æ—¦å…³é—­åå†æ¬¡åˆ›å»ºå†™å…¥æ•°æ®å°±ä¼šæŠŠä¹‹å‰çš„æ•°æ®éƒ½å¼„ä¸¢æ‰ï¼Œè¿™ç‚¹å°±æ¯”è¾ƒçƒ¦ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡åœ¨åˆ›å»ºå®ä¾‹å¯¹è±¡çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ª <code>true</code> å€¼æ¥å®ç°ç»­å†™çš„åŠŸèƒ½ï¼š</p><ul><li><code>public FileOutputStream(String name, boolean append)</code>ï¼Œname æ–‡ä»¶è·¯å¾„ï¼Œappend æ˜¯å¦ç»­å†™</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»­å†™å’Œæ¢è¡Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileOutputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// å†™å…¥ä¸€è¡Œæ•°æ®</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        fos.write(<span class="string">&quot;You can kill me&quot;</span>.getBytes());</span><br><span class="line">        fos.close();</span><br><span class="line">        <span class="comment">// è¿›è¡Œç»­å†™</span></span><br><span class="line">        fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        fos.write(<span class="string">&quot;\r\n&quot;</span>.getBytes());   <span class="comment">// åœ¨Windowsä¸­ï¼š\r å›è½¦ç¬¦ï¼Œ\n æ¢è¡Œç¬¦</span></span><br><span class="line">        fos.write(<span class="string">&quot;but you can&#x27;t fuck me!!!&quot;</span>.getBytes());</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®ç°å®æ—¶è¾“å‡ºæ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®æ—¶è¾“å‡ºæ•°æ®ï¼Œexitç»“æŸè¾“å‡º</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileOutputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;å†™å…¥æ•°æ®ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> ( flag ) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            <span class="keyword">if</span>( !str.equals(<span class="string">&quot;exit&quot;</span>) )</span><br><span class="line">                fos.write((str+<span class="string">&quot;\r\n&quot;</span>).getBytes());</span><br><span class="line">            <span class="keyword">else</span> flag = <span class="literal">false</span>;;</span><br><span class="line">        &#125;</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—èŠ‚è¾“å…¥æµ">å­—èŠ‚è¾“å…¥æµ</h3><p><code>FileOutputStream</code> ä¸ºè¾“å‡ºæµï¼Œå¸¸ç”¨å‡½æ•°å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>close()</td><td>å…³é—­æµ</td></tr><tr><td>read()</td><td>åˆ·æ–°æ­¤è¾“å‡ºæµå°†æ•°æ®éƒ½å†™å‡º</td></tr><tr><td>read(byte[] b)</td><td>è¯»å–åŒæ•°ç»„é•¿åº¦çš„å­—èŠ‚æ•°é‡å¹¶å­˜åˆ°æ•°ç»„ä¸­ï¼Œè¯»åˆ°æœ«å°¾æ—¶è¿”å› -1</td></tr><tr><td>read(byte[] b, int off, int len)</td><td>ä»ä¸‹æ ‡ off å¼€å§‹è¯»å…¥ len ä¸ªå­—èŠ‚å¹¶å­˜å‚¨åˆ°æ•°ç»„ä¸­ï¼Œè¯»åˆ°æœ«å°¾æ—¶è¿”å› -1</td></tr></tbody></table><p>å’Œè¾“å‡ºæµä¸€æ ·æœ‰ä¸¤ç§æ„é€ æ–¹æ³• ( è¿™é‡Œå°±ä¸å†™äº† )ï¼ŒåŒæ ·æˆ‘ä»¬ç›´æ¥é‡‡ç”¨è·¯å¾„å­—ç¬¦ä¸²çš„å½¢å¼è¿›è¡Œå®ä¾‹åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileInputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> <span class="number">0</span>; (read = fis.read()) != -<span class="number">1</span>; )</span><br><span class="line">            System.out.println((<span class="type">char</span>)read);</span><br><span class="line">        System.out.println(fis.read());</span><br><span class="line">        fis.close();</span><br><span class="line">        <span class="comment">// è¯»å–æ•°ç»„é•¿åº¦çš„å­—èŠ‚å­˜æ”¾è¿›æ•°ç»„ä¸­</span></span><br><span class="line">        fis = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">5</span>];</span><br><span class="line">        fis.read(bytes);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes));</span><br><span class="line">        <span class="comment">// ä»offå¼€å§‹è¯»å–lenä¸ªå­˜åˆ°bytesä¸­</span></span><br><span class="line">        fis = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/example/3.txt&quot;</span>);</span><br><span class="line">        bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span>( <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> <span class="number">0</span>; (read = fis.read(bytes, <span class="number">0</span>, bytes.length)) != -<span class="number">1</span>; )</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘çš„ 4.txt æ–‡ä»¶ä¸­åªæœ‰ abcde äº”ä¸ªè‹±æ–‡å­—æ¯ï¼Œåœ¨è¯»å–çš„æ—¶å€™æ˜æ˜¾æœ€åä¸€ä¸ªè¯»åˆ°çš„æ˜¯ dï¼ŒåŸå› ï¼š</p><p><img src="C:/Users/Administrator/Desktop/Markdown/img/JavaSenior-03.jpg" alt="https://www.cnblogs.com/xichji/p/11793464.html"></p><h3 id="å­—èŠ‚æµç»ƒä¹ -æ–‡ä»¶å¤åˆ¶">å­—èŠ‚æµç»ƒä¹ -æ–‡ä»¶å¤åˆ¶</h3><p>è¦æ±‚ï¼šå¤åˆ¶æŸä¸ªå›¾ç‰‡åˆ° D ç›˜ç›˜æ ¹ä¸‹é‡å‘½åä¸º stream.jpg</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—èŠ‚æµç»ƒä¹ -å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCopyFile</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> <span class="string">&quot;C:/Users/Administrator/Desktop/Markdown/img/1.jpg&quot;</span>;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/stream.jpg&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>; (len = fis.read(bytes))!= -<span class="number">1</span>; )</span><br><span class="line">            fos.write(bytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;å›¾ç‰‡å¤åˆ¶æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        fos.close();</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—èŠ‚æµä¸ç è¡¨">å­—èŠ‚æµä¸ç è¡¨</h3><p>åˆšåˆšæˆ‘ä»¬æ˜¯å…ˆå­¦ä¹ è¾“å‡ºæµï¼Œé€šè¿‡è¾“å‡ºæµå‘æ–‡æœ¬æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ï¼Œç„¶åå†ç”¨è¾“å…¥æµè¯»å›æ¥ï¼Œå¦‚æœæˆ‘ä»¬å…ˆä½¿ç”¨è¾“å…¥æµè¯»å–æ–‡æœ¬æ–‡ä»¶ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª 4.txt æ¥è¯»å–ä¸€ä¸‹å…¶ä¸­çš„å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileInputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å†…å®¹ï¼šå­¦ä¹ IOæµ</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/example/4.txt&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span>];</span><br><span class="line">        fis.read(bs);</span><br><span class="line">        <span class="comment">// æ‰“å°ï¼šÑ§Ï°IOï¿½ï¿½  </span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‘ç°æ‰“å°å‡ºæ¥çš„ç«Ÿç„¶æ˜¯ä¸€å †ä¹±ç ï¼Œåˆšåˆšç»ƒä¹ çš„æ—¶å€™è¿˜æ˜¯æ­£å¸¸çš„ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨çš„è¾“å‡ºæµï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼€å¯ç»­å†™çš„è¯ï¼Œè¾“å‡ºæµé»˜è®¤ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æ¥æ›¿æ¢æ‰ä¹‹å‰çš„æ—§çš„æ–‡ä»¶ï¼Œæ–°æ–‡ä»¶å°±ä¼šåŸºäº java å†™å…¥çš„å†…å®¹æ¥è®¾ç½®å¯¹åº”æ–‡ä»¶çš„ç è¡¨ï¼š</p><p><img src="C:/Users/Administrator/Desktop/Markdown/img/JavaSenior-04.jpg" alt=""></p><p>æˆ‘ä»¬è¯»å–äº† ANSI ç è¡¨ä¸­çš„å­—èŠ‚é€šè¿‡ <code>new String( bs )</code> ä»¥ UTF-8 è¿›è¡Œè§£ç ç»“æœå½“ç„¶æ˜¯ä¹±ç çš„ï¼Œæƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åªéœ€è¦åœ¨è½¬æ¢çš„æ—¶å€™ä¸ºä»–æŒ‡å®šç è¡¨å°±å¯ä»¥äº†ï¼Œç»æµ‹è¯•æ–‡æœ¬æ–‡ä»¶çš„ ANSI å¯¹åº”çš„æ˜¯ GBKï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileInputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å†…å®¹ï¼šå­¦ä¹ IOæµ</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/example/4.txt&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span>];</span><br><span class="line">        fis.read(bs);</span><br><span class="line">        <span class="comment">// æ‰“å°ï¼šå­¦ä¹ IOæµ</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bs, <span class="string">&quot;GBK&quot;</span>));</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å·²ç»å¯ä»¥å°† ANSI æ ¼å¼çš„å­—èŠ‚è¯»å› UTF-8 äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥åœ¨è¾“å‡ºçš„æ—¶å€™å°±è¾“å‡º ANSI å‘¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileOutputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/4.txt&quot;</span>);</span><br><span class="line">        <span class="comment">// åœ¨è·å–å­—èŠ‚æ•°ç»„çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºç è¡¨ï¼Œä»–å°±ä¼šæŒ‰ç…§ç è¡¨çš„æ ¼å¼è¿›è¡Œè½¬æ¢äº†</span></span><br><span class="line">        fos.write(<span class="string">&quot;ä¸€æ—¥ä¸‰é¤æƒ³åƒå¥½ï¼Œå°±åƒè€å…«ç§˜åˆ¶å°æ±‰å ¡&quot;</span>.getBytes(<span class="string">&quot;GBK&quot;</span>));</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Administrator/Desktop/Markdown/img/JavaSenior-05.jpg" alt=""></p><blockquote><p>å­—ç¬¦æµå¼•è¨€</p></blockquote><p>å­—èŠ‚æµä»¥å­—èŠ‚ä¸ºå•ä½é€‚ç”¨äºæ–‡ä»¶ ( å›¾ç‰‡ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ç­‰ ) ä¼ è¾“ç­‰ï¼Œè€Œå­—ç¬¦æµåå‘äºæ–‡æœ¬ ( .txtï¼Œ.mdï¼Œ.xml ) ä¼ è¾“ç­‰</p><p>åœ¨ GBK ç è¡¨ä¸­ä¸€ä¸ªå­—æ¯ä¸­å ç”¨ä¸€å­—èŠ‚ï¼Œä¸­æ–‡å ç”¨ä¸¤å­—èŠ‚ï¼Œåœ¨ UTF-8 ä¸­çš„ä¸­æ–‡è¦ä¸‰ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å°±æœ‰äº†å­—ç¬¦æµï¼Œå­—ç¬¦æµåªéœ€è¦è´Ÿè´£å¯¹æ•°æ®è¿›è¡Œæ“ä½œå³å¯ï¼Œæ— éœ€è€ƒè™‘å ç”¨å‡ ä¸ªå­—èŠ‚çš„é—®é¢˜ï¼Œ<strong>å­—ç¬¦æµå¯ä»¥ç†è§£ä¸ºå­—èŠ‚æµå’Œç è¡¨çš„ç»“åˆ</strong></p><h3 id="å­—ç¬¦è¾“å…¥æµ">å­—ç¬¦è¾“å…¥æµ</h3><p><code>FileReader</code> ä¸ºå­—ç¬¦è¾“å…¥æµï¼Œä½¿ç”¨é»˜è®¤çš„ ( å¤§å¤šä¸º UTF-8 ) ç è¡¨ï¼Œç”¨çš„åŒæ ·æ˜¯é‚£å‡ ä¸ª read å‡½æ•°ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†</p><blockquote><p>ä½¿ç”¨å­—ç¬¦è¾“å…¥æµ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦è¾“å…¥æµ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileReader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileReader</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:/example/5.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> read; (read = fr.read()) != -<span class="number">1</span>; )</span><br><span class="line">            System.out.println((<span class="type">char</span>) read);</span><br><span class="line">        fr.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦è¾“å‡ºæµ">å­—ç¬¦è¾“å‡ºæµ</h3><p><code>FileWriter</code> ä¸ºå­—ç¬¦è¾“å‡ºæµï¼Œä½¿ç”¨é»˜è®¤çš„ ( å¤§å¤šä¸º UTF-8 ) ç è¡¨ï¼Œç”¨çš„åŒæ ·æ˜¯é‚£å‡ ä¸ª write å‡½æ•°ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†</p><blockquote><p>ä½¿ç”¨å­—ç¬¦è¾“å‡ºæµ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•å­—ç¬¦è¾“å‡ºæµ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileWriter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileWriter</span> <span class="variable">fw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;D:/example/6.txt&quot;</span>);</span><br><span class="line">        fw.write(<span class="string">&quot;æµ‹è¯•å­—ç¬¦è¾“å‡ºæµï¼š\r\n&quot;</span>);</span><br><span class="line">        fw.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»­å†™ä»¥åŠå®æ—¶è¾“å‡ºæ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFileWriter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileWriter</span> <span class="variable">fw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;D:/example/6.txt&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;å†™å…¥æ•°æ®ï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>; flag; )&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            <span class="keyword">if</span>( !str.equals(<span class="string">&quot;exit&quot;</span>) )&#123;</span><br><span class="line">                fw.write(str+<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">                fw.flush();</span><br><span class="line">            &#125; <span class="keyword">else</span> flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—ç¬¦è¾“å‡ºæµçš„ write å‡½æ•°æ˜¯å°†å­—ç¬¦å†™åœ¨äº†ç¼“å†²åŒºä¸­ï¼Œåªæœ‰åœ¨ close å…³æµçš„æ—¶å€™æ‰ä¼šå°†ç¼“å†²åŒºçš„å­—ç¬¦å†™å‡ºï¼Œæƒ³è¦å®ç°å®æ—¶å†™å‡ºéœ€è¦é…åˆ flush å‡½æ•°å¼ºåˆ¶åˆ·æ–°å¹¶å†™å‡º</li></ul><blockquote><p>ç¼“å†²æµå¼•è¨€</p></blockquote><p>æˆ‘ä»¬å¹³æ—¶ç»å¸¸æ¥è§¦åˆ°çš„ IO æ–¹é¢çš„æ“ä½œï¼Œä¾‹å¦‚æ–‡ä»¶å¤åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å­—èŠ‚è¾“å…¥æµè¯»å–æ•°æ®ç„¶åç”¨å­—èŠ‚è¾“å‡ºæµè¿›è¡Œå†™å‡ºï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯æ–‡ä»¶åå¤§çš„æ—¶å€™å°±ä¼šæœ‰ä¸€ä¸ªæ•ˆç‡çš„æ¦‚å¿µï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç¼“å†²æµæ¥è§£å†³</p><p>ç¼“å†²æµï¼Œä¹Ÿå«åšé«˜æ•ˆæµï¼Œæ˜¯é’ˆå¯¹å¼€å§‹æè¿‡çš„å››ç§ç±»å‹è¿›è¡Œå¢å¼ºçš„æµ</p><h3 id="å­—èŠ‚ç¼“å†²æµ">å­—èŠ‚ç¼“å†²æµ</h3><p>å­—èŠ‚è¾“å…¥æµå¯¹åº”çš„ç¼“å†²æµä¸ºï¼š<code>BufferedInputStream(InputStrean in)</code></p><p>å­—èŠ‚è¾“å‡ºæµå¯¹åº”çš„ç¼“å†²æµä¸ºï¼š<code>BufferedOutputStream(OutputStream out)</code></p><blockquote><p>é€šè¿‡å¤§æ–‡ä»¶å¤åˆ¶æ¥æµ‹è¯•å­—èŠ‚æµä¸ç¼“å†²æµ</p></blockquote><p>åŒæ ·éƒ½æ˜¯é‚£å‡ ä¸ªè¯»å…¥å†™å‡ºä»¥åŠåˆ·æ–°å…³æµçš„å‡½æ•°ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—èŠ‚æµå¤åˆ¶å¤§æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBufferStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// IDEAç¤¾åŒºç‰ˆå®‰è£…åŒ…--å¤§å°572M</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/Download/ideaIC-2020.2.1.exe&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/ideaIC.exe&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> len; (len = fis.read(bs)) != -<span class="number">1</span>; )</span><br><span class="line">            fos.write(bs, <span class="number">0</span>, len);</span><br><span class="line">        <span class="comment">// æ–‡ä»¶å¤åˆ¶å®Œæˆï¼èŠ±è´¹7329ms</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å¤åˆ¶å®Œæˆï¼èŠ±è´¹&quot;</span> + </span><br><span class="line">                           (System.currentTimeMillis() - l) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        fos.close();</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦æµå¤åˆ¶å¤§æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBufferStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// IDEAç¤¾åŒºç‰ˆå®‰è£…åŒ…--å¤§å°572M</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/Download/ideaIC-2020.2.1.exe&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/ideaIC.exe&quot;</span>);</span><br><span class="line">        <span class="comment">// ç¼“å†²æµéœ€è¦å­—èŠ‚æµä½œä¸ºå‚æ•°</span></span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(fis);</span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(fos);</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> len; (len = bis.read(bs)) != -<span class="number">1</span>; )</span><br><span class="line">            bos.write(bs, <span class="number">0</span>, len);</span><br><span class="line">        <span class="comment">// æ–‡ä»¶å¤åˆ¶å®Œæˆï¼èŠ±è´¹3327ms</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶å¤åˆ¶å®Œæˆï¼èŠ±è´¹&quot;</span> + </span><br><span class="line">                           (System.currentTimeMillis() - l) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        bos.close();</span><br><span class="line">        bis.close();</span><br><span class="line">        fos.close();</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ç¼“å†²æµ">å­—ç¬¦ç¼“å†²æµ</h3><p>å­—ç¬¦è¾“å…¥æµå¯¹åº”çš„ç¼“å†²æµä¸ºï¼š<code>public BufferedReader(Reader in)</code></p><p>å­—ç¬¦è¾“å‡ºæµå¯¹åº”çš„ç¼“å†²æµä¸ºï¼š<code>public BufferedWriter(Writer out)</code></p><blockquote><p>æ–‡ä»¶å†…å®¹å¤åˆ¶ç»ƒä¹ </p></blockquote><p>ç›¸æ¯”ä¹‹å‰å­¦è¿‡çš„é‚£äº›ï¼Œå­—ç¬¦ç¼“å†²æµæœ‰ç€è‡ªå·±ä¸“å±çš„å‡½æ•°ï¼š</p><table><thead><tr><th>è°ƒç”¨è€…</th><th>å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>BufferedReader</td><td>readLine()</td><td>åªè¯»å–ä¸€è¡Œæ•°æ®ï¼Œè¯»åˆ°æœ€åè¿”å› null</td></tr><tr><td>BufferedWriter</td><td>newLine()</td><td>åˆ›å»ºä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä¼šæ ¹æ®å½“å‰ç³»ç»Ÿç¯å¢ƒåˆ›å»ºç¬¦åˆçš„æ¢è¡Œç¬¦</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦ç¼“å†²æµå®ç°æ–‡ä»¶å†…å®¹æ‹·è´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBufferChar</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åŒæ ·ï¼Œç¼“å†²æµéœ€è¦å­—ç¬¦æµä½œä¸ºå‚æ•°</span></span><br><span class="line">        <span class="type">FileReader</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:/Download/34059.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileWriter</span> <span class="variable">fw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;D:/example/æ¡ƒèŠ±æºè®°.txt&quot;</span>);</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">readBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(fr);</span><br><span class="line">        <span class="type">BufferedWriter</span> <span class="variable">writeBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(fw);</span><br><span class="line">        <span class="comment">// è¯»å–ä¸€è¡Œæ•°æ®ï¼Œè¯»åˆ°è¿”å›ç»™lineï¼Œè¯»ä¸åˆ°è¿”å›null</span></span><br><span class="line">        <span class="keyword">for</span> (String line; (line = readBuffer.readLine()) != <span class="literal">null</span>; ) &#123;</span><br><span class="line">            writeBuffer.write(line);</span><br><span class="line">            <span class="comment">/* åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªæ¢è¡Œç›¸å½“äºåœ¨æºæ–‡ä»¶åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€ä¸ªæ¢è¡Œï¼Œå› ä¸º</span></span><br><span class="line"><span class="comment">            å®ƒæ˜¯æŒ‰è¡Œè¯»çš„ï¼Œä¸å­˜åœ¨æ¢è¡Œçš„æ¦‚å¿µï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ¢è¡Œ */</span></span><br><span class="line">            writeBuffer.newLine();</span><br><span class="line">            writeBuffer.newLine();</span><br><span class="line">        &#125;</span><br><span class="line">        writeBuffer.close();</span><br><span class="line">        readBuffer.close();</span><br><span class="line">        fw.close();</span><br><span class="line">        fr.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Administrator/Desktop/Markdown/img/JavaSenior-06.jpg" alt=""></p><h3 id="å­—èŠ‚å­—ç¬¦è½¬æ¢æµ">å­—èŠ‚å­—ç¬¦è½¬æ¢æµ</h3><p>ä¹‹å‰è¯´è¿‡ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å­—èŠ‚æµå¤„ç†å­—ç¬¦çš„æ—¶å€™ï¼Œç”±äºä¸€ä¸ªä¸­æ–‡å¯èƒ½å¯¹åº”ä¸¤ä¸ªæˆ–ä¸‰ä¸ªå­—èŠ‚ï¼Œä¸æ–¹ä¾¿è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥æœ‰äº†å­—ç¬¦æµï¼Œä½†æ˜¯å­—ç¬¦æµä½¿ç”¨çš„æ˜¯é»˜è®¤ç è¡¨ ( å¤§å¤šæ˜¯ UTF8 )ï¼Œä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘æœ‰ GBK å­—ç¬¦é›†çš„æ–‡æœ¬ä»–å°±æ— æ³•å¤„ç†äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¬æ¢æµè¿›è¡Œæ“ä½œ</p><p>é¡¾åæ€ä¹‰ï¼Œè½¬æ¢æµå°±æ˜¯å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­å‘Šè¯‰ä»–åº”è¯¥ç”¨ä»€ä¹ˆç±»å‹çš„ç è¡¨ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥è§£å†³ç è¡¨çš„é—®é¢˜äº†</p><p>è½¬æ¢æµåˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>å­—èŠ‚è½¬å­—ç¬¦ï¼š<code>InputStreamReader</code>ï¼Œå°†è¯»å…¥å†…å­˜çš„å­—èŠ‚è½¬æ¢æˆç¨‹åºå¯å¤„ç†çš„å­—ç¬¦</li><li>å­—ç¬¦è½¬å­—èŠ‚ï¼š<code>OutputStreamWriter</code>ï¼Œå°†å¤„ç†å¥½çš„å­—ç¬¦è½¬æ¢æˆå­—èŠ‚å†™å‡º</li></ul><blockquote><p>è½¬æ¢æµç»ƒä¹ </p></blockquote><p>ä¹‹å‰æˆ‘ä»¬å­¦ä¹ å­—ç¬¦æµçš„æ—¶å€™åªæ“ä½œ UTF-8 ç±»å‹çš„æ–‡æœ¬æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œå› ä¸ºä½¿ç”¨å…¶ä»–ç¼–ç çš„æ—¶å€™ä¼šä¹±ä¹±ç ï¼Œç°åœ¨æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹å…¶ä»–çš„ç¼–ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¬æ¢æµç»ƒä¹ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConversionStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// è½¬æ¢æµé¡¾åæ€ä¹‰ï¼Œéœ€è¦æˆ‘ä»¬æä¾›å­—èŠ‚æµä»¥åŠå¯¹åº”çš„ç è¡¨æ¥è½¬æ¢ä¸ºå­—ç¬¦æµ</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/Download/73369.txt&quot;</span>);</span><br><span class="line">        <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(fis, <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–GBKç¼–ç çš„æ–‡æœ¬è½¬æ¢æˆunicodeç±»å‹çš„æ–‡æœ¬</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/example/å†°ç¯.txt&quot;</span>);</span><br><span class="line">        <span class="type">OutputStreamWriter</span> <span class="variable">osw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(fos, <span class="string">&quot;unicode&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> read; (read = isr.read()) != -<span class="number">1</span>;) &#123;</span><br><span class="line">            osw.write((<span class="type">char</span>) read);</span><br><span class="line">        &#125;</span><br><span class="line">        osw.close();</span><br><span class="line">        fos.close();</span><br><span class="line">        isr.close();</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="C:/Users/Administrator/Desktop/Markdown/img/JavaSenior-07.jpg" alt=""></p><blockquote><p>ã€æ‰©å±•ã€‘è¯¦ç»†çš„ [ ç¼–ç è¡¨/å­—ç¬¦é›† ] ä¿¡æ¯â€“åŸæ–‡åœ°å€ï¼š<a href="https://www.cnblogs.com/xichji/p/11793464.html#%E5%AD%97%E7%AC%A6%E9%9B%86">https://www.cnblogs.com/xichji/p/11793464.html#å­—ç¬¦é›†</a></p></blockquote><ul><li>ASCIIå­—ç¬¦é›†ï¼š<ul><li>ASCIIï¼ˆAmerican Standard Code for Information Interchangeï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰æ˜¯åŸºäºæ‹‰ä¸å­—æ¯çš„ä¸€å¥—ç”µè„‘ç¼–ç ç³»ç»Ÿï¼Œç”¨äºæ˜¾ç¤ºç°ä»£è‹±è¯­ï¼Œä¸»è¦åŒ…æ‹¬æ§åˆ¶å­—ç¬¦ï¼ˆå›è½¦é”®ã€é€€æ ¼ã€æ¢è¡Œé”®ç­‰ï¼‰å’Œå¯æ˜¾ç¤ºå­—ç¬¦ï¼ˆè‹±æ–‡å¤§å°å†™å­—ç¬¦ã€é˜¿æ‹‰ä¼¯æ•°å­—å’Œè¥¿æ–‡ç¬¦å·ï¼‰ã€‚</li><li>åŸºæœ¬çš„ASCIIå­—ç¬¦é›†ï¼Œä½¿ç”¨7ä½ï¼ˆbitsï¼‰è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå…±128å­—ç¬¦ã€‚ASCIIçš„æ‰©å±•å­—ç¬¦é›†ä½¿ç”¨8ä½ï¼ˆbitsï¼‰è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå…±256å­—ç¬¦ï¼Œæ–¹ä¾¿æ”¯æŒæ¬§æ´²å¸¸ç”¨å­—ç¬¦ã€‚</li></ul></li><li>ISO-8859-1å­—ç¬¦é›†ï¼š<ul><li>æ‹‰ä¸ç è¡¨ï¼Œåˆ«åLatin-1ï¼Œç”¨äºæ˜¾ç¤ºæ¬§æ´²ä½¿ç”¨çš„è¯­è¨€ï¼ŒåŒ…æ‹¬è·å…°ã€ä¸¹éº¦ã€å¾·è¯­ã€æ„å¤§åˆ©è¯­ã€è¥¿ç­ç‰™è¯­ç­‰ã€‚</li><li>ISO-8859-1ä½¿ç”¨å•å­—èŠ‚ç¼–ç ï¼Œå…¼å®¹ASCIIç¼–ç ã€‚</li></ul></li><li>GBxxxå­—ç¬¦é›†ï¼š<ul><li>GBå°±æ˜¯å›½æ ‡çš„æ„æ€ï¼Œæ˜¯ä¸ºäº†æ˜¾ç¤ºä¸­æ–‡è€Œè®¾è®¡çš„ä¸€å¥—å­—ç¬¦é›†ã€‚</li><li><strong>GB2312</strong>ï¼šç®€ä½“ä¸­æ–‡ç è¡¨ã€‚ä¸€ä¸ªå°äº127çš„å­—ç¬¦çš„æ„ä¹‰ä¸åŸæ¥ç›¸åŒã€‚ä½†ä¸¤ä¸ªå¤§äº127çš„å­—ç¬¦è¿åœ¨ä¸€èµ·æ—¶ï¼Œå°±è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œè¿™æ ·å¤§çº¦å¯ä»¥ç»„åˆäº†åŒ…å«7000å¤šä¸ªç®€ä½“æ±‰å­—ï¼Œæ­¤å¤–æ•°å­¦ç¬¦å·ã€ç½—é©¬å¸Œè…Šçš„å­—æ¯ã€æ—¥æ–‡çš„å‡åä»¬éƒ½ç¼–è¿›å»äº†ï¼Œè¿åœ¨ASCIIé‡Œæœ¬æ¥å°±æœ‰çš„æ•°å­—ã€æ ‡ç‚¹ã€å­—æ¯éƒ½ç»Ÿç»Ÿé‡æ–°ç¼–äº†ä¸¤ä¸ªå­—èŠ‚é•¿çš„ç¼–ç ï¼Œè¿™å°±æ˜¯å¸¸è¯´çš„&quot;å…¨è§’&quot;å­—ç¬¦ï¼Œè€ŒåŸæ¥åœ¨127å·ä»¥ä¸‹çš„é‚£äº›å°±å«&quot;åŠè§’&quot;å­—ç¬¦äº†ã€‚</li><li><strong>GBK</strong>ï¼šæœ€å¸¸ç”¨çš„ä¸­æ–‡ç è¡¨ã€‚æ˜¯åœ¨GB2312æ ‡å‡†åŸºç¡€ä¸Šçš„æ‰©å±•è§„èŒƒï¼Œä½¿ç”¨äº†åŒå­—èŠ‚ç¼–ç æ–¹æ¡ˆï¼Œå…±æ”¶å½•äº†21003ä¸ªæ±‰å­—ï¼Œå®Œå…¨å…¼å®¹GB2312æ ‡å‡†ï¼ŒåŒæ—¶æ”¯æŒç¹ä½“æ±‰å­—ä»¥åŠæ—¥éŸ©æ±‰å­—ç­‰ã€‚</li><li><strong>GB18030</strong>ï¼šæœ€æ–°çš„ä¸­æ–‡ç è¡¨ã€‚æ”¶å½•æ±‰å­—70244ä¸ªï¼Œé‡‡ç”¨å¤šå­—èŠ‚ç¼–ç ï¼Œæ¯ä¸ªå­—å¯ä»¥ç”±1ä¸ªã€2ä¸ªæˆ–4ä¸ªå­—èŠ‚ç»„æˆã€‚æ”¯æŒä¸­å›½å›½å†…å°‘æ•°æ°‘æ—çš„æ–‡å­—ï¼ŒåŒæ—¶æ”¯æŒç¹ä½“æ±‰å­—ä»¥åŠæ—¥éŸ©æ±‰å­—ç­‰ã€‚</li></ul></li><li>Unicodeå­—ç¬¦é›†ï¼š<ul><li>Unicodeç¼–ç ç³»ç»Ÿä¸ºè¡¨è¾¾ä»»æ„è¯­è¨€çš„ä»»æ„å­—ç¬¦è€Œè®¾è®¡ï¼Œæ˜¯ä¸šç•Œçš„ä¸€ç§æ ‡å‡†ï¼Œä¹Ÿç§°ä¸ºç»Ÿä¸€ç ã€æ ‡å‡†ä¸‡å›½ç ã€‚</li><li>å®ƒæœ€å¤šä½¿ç”¨4ä¸ªå­—èŠ‚çš„æ•°å­—æ¥è¡¨è¾¾æ¯ä¸ªå­—æ¯ã€ç¬¦å·ï¼Œæˆ–è€…æ–‡å­—ã€‚æœ‰ä¸‰ç§ç¼–ç æ–¹æ¡ˆï¼ŒUTF-8ã€UTF-16å’ŒUTF-32ã€‚æœ€ä¸ºå¸¸ç”¨çš„UTF-8ç¼–ç ã€‚</li><li>UTF-8ç¼–ç ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºUnicodeæ ‡å‡†ä¸­ä»»ä½•å­—ç¬¦ï¼Œå®ƒæ˜¯ç”µå­é‚®ä»¶ã€ç½‘é¡µåŠå…¶ä»–å­˜å‚¨æˆ–ä¼ é€æ–‡å­—çš„åº”ç”¨ä¸­ï¼Œä¼˜å…ˆé‡‡ç”¨çš„ç¼–ç ã€‚äº’è”ç½‘å·¥ç¨‹å·¥ä½œå°ç»„ï¼ˆIETFï¼‰è¦æ±‚æ‰€æœ‰äº’è”ç½‘åè®®éƒ½å¿…é¡»æ”¯æŒUTF-8ç¼–ç ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼€å‘Webåº”ç”¨ï¼Œä¹Ÿè¦ä½¿ç”¨UTF-8ç¼–ç ã€‚å®ƒä½¿ç”¨ä¸€è‡³å››ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç ï¼Œç¼–ç è§„åˆ™ï¼š<ol><li>128ä¸ªUS-ASCIIå­—ç¬¦ï¼Œåªéœ€ä¸€ä¸ªå­—èŠ‚ç¼–ç ã€‚</li><li>æ‹‰ä¸æ–‡ç­‰å­—ç¬¦ï¼Œéœ€è¦äºŒä¸ªå­—èŠ‚ç¼–ç ã€‚</li><li>å¤§éƒ¨åˆ†å¸¸ç”¨å­—ï¼ˆå«ä¸­æ–‡ï¼‰ï¼Œä½¿ç”¨ä¸‰ä¸ªå­—èŠ‚ç¼–ç ã€‚</li><li>å…¶ä»–æå°‘ä½¿ç”¨çš„Unicodeè¾…åŠ©å­—ç¬¦ï¼Œä½¿ç”¨å››å­—èŠ‚ç¼–ç ã€‚</li></ol></li></ul></li></ul><h3 id="æ‰©å±•-Properties">æ‰©å±• Properties</h3><p>properties åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œspringboot çš„é…ç½®æ–‡ä»¶å°±æ˜¯ properties å’Œ ymal æ–‡ä»¶ï¼Œproperties ç±»ä¸¥æ ¼æ¥è¯´ä¸å±äº IO ç±»ï¼Œå®ƒå…¶å®ä½äº <code>java.util.Properties</code> åŒ…ä¸‹ ç»§æ‰¿ <code>Hashtable</code> çš„ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆç±»ï¼Œåªä¸è¿‡ç±»ä¸­åŒ…å«äº†å’Œ IO ç›¸å…³çš„æ“ä½œ</p><blockquote><p>ç®€å•äº†è§£ Properties é›†åˆç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Propertiesé›†åˆç±»çš„ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå®ä¾‹</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">// æ·»åŠ /ä¿®æ”¹å€¼</span></span><br><span class="line">        ps.setProperty(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        ps.setProperty(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;hanzhe&quot;</span>);</span><br><span class="line">        ps.setProperty(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°æµ‹è¯•</span></span><br><span class="line">        System.out.println(ps);</span><br><span class="line">        <span class="comment">// è¿­ä»£éå†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;user--&quot;</span> + ps.getProperty(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;Object, Object&gt;&gt; iterator = ps.entrySet().iterator(); iterator.hasNext();)&#123;</span><br><span class="line">            Map.Entry&lt;Object, Object&gt; entyr = iterator.next();</span><br><span class="line">            System.out.println(entyr.getKey() + <span class="string">&quot;ï¼š&quot;</span> + entyr.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…åˆIOæµè¯»å–é…ç½®æ–‡ä»¶ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå®ä¾‹</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">// åŠ è½½propertiesé…ç½®æ–‡ä»¶</span></span><br><span class="line">        ps.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:/example/applitaion.properties&quot;</span>));</span><br><span class="line">        System.out.println(ps);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaæ³¨è§£ä¸åå°„</title>
    <link href="/2021/04/13/Java%E7%AC%94%E8%AE%B0/%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/"/>
    <url>/2021/04/13/Java%E7%AC%94%E8%AE%B0/%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h1>Javaæ³¨è§£</h1><p>åœ¨ java ä¸­ä»¥ <code>@</code> ç¬¦å·å¼€å¤´æ ‡åœ¨ç±»ä¸Šã€å‡½æ•°ä¸Šã€å±æ€§ç­‰ç­‰ä¸Šçš„å°±æ˜¯ java ä¸­çš„æ³¨è§£ ( Annotation )ï¼Œä»–æ˜¯åœ¨ JDK5 å¼•è¿›çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬åœ¨åˆå­¦ java çš„æ—¶å€™å°±æ¥è§¦è¿‡æ³¨è§£ï¼Œåªæ˜¯æ²¡æœ‰ç•™æ„è¿‡ç½¢äº†ã€‚</p><h2 id="å¸¸è§çš„æ³¨è§£">å¸¸è§çš„æ³¨è§£</h2><table><thead><tr><th>å¸¸è§æ³¨è§£</th><th>ä½œç”¨æè¿°</th></tr></thead><tbody><tr><td>@Override</td><td>è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯å¤å†™çˆ¶ç±»/æ¥å£çš„æ–¹æ³•</td></tr><tr><td>@Deprecated</td><td>è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºè¿‡æœŸæ–¹æ³•</td></tr><tr><td>@SuppressWarnings</td><td>å¿½ç•¥ä»£ç è­¦å‘Š</td></tr><tr><td>@FunctionalInterface</td><td>è¡¨ç¤ºå½“å‰æ¥å£æ˜¯å‡½æ•°å¼æ¥å£ï¼ŒJDK8å¼€å§‹æ”¯æŒ</td></tr></tbody></table><blockquote><p>ä»£ç ä¸¾ä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span> <span class="comment">// è¡¨ç¤ºå½“å‰æ¥å£æ˜¯å‡½æ•°å¼æ¥å£ JDK8</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Demo1Interfase</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> <span class="keyword">implements</span> <span class="title class_">Demo1Interfase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯å¤å†™çˆ¶ç±»/æ¥å£çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¤å†™Demo1Interfaseæ¥å£çš„æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated</span> <span class="comment">// è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºè¿‡æœŸæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘å·²ç»è¿‡æœŸäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(value = &quot;all&quot;)</span> <span class="comment">// å¿½ç•¥å…¨éƒ¨è­¦å‘Š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">good</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span><span class="string">&quot;hello&quot;</span>;  <span class="comment">// å®šä¹‰å˜é‡å´æ²¡æœ‰ä½¿ç”¨</span></span><br><span class="line">        System.out.println(<span class="string">&quot;good morning&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Demo1</span> <span class="variable">demo1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo1</span>();</span><br><span class="line">        demo1.print();  <span class="comment">// è¿‡æœŸæ–¹æ³•ä¼šæœ‰ä¸€é“æ¨ªçº¿ï¼ˆIDEAï¼‰</span></span><br><span class="line">        demo1.func();</span><br><span class="line">        <span class="comment">// ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥åˆ›å»ºå‡½æ•°å¼æ¥å£å®ä¾‹</span></span><br><span class="line">        <span class="type">Demo1Interfase</span> <span class="variable">d</span> <span class="operator">=</span>()-&gt; System.out.println(<span class="string">&quot;å‡½æ•°å¼æ¥å£&quot;</span>);</span><br><span class="line">        d.func();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…ƒæ³¨è§£ä»‹ç»">å…ƒæ³¨è§£ä»‹ç»</h2><p>å¦‚æœè¯´æ³¨è§£æ˜¯ä¸ºæˆ‘ä»¬å†™çš„ç±»ã€å‡½æ•°ã€å±æ€§æä¾›çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆ ==å…ƒæ³¨è§£å°±æ˜¯ä¸ºæ³¨è§£æä¾›çš„åŠŸèƒ½==ï¼Œä»–è§„å®šäº†æ³¨è§£çš„ä¸€äº›ä½¿ç”¨è§„åˆ™ã€‚</p><table><thead><tr><th>å…ƒæ³¨è§£åç§°</th><th>ä½œç”¨æè¿°</th></tr></thead><tbody><tr><td>@Target</td><td>é™åˆ¶æ³¨è§£å¯ä»¥åœ¨ä»€ä¹ˆä½ç½®ä½¿ç”¨ï¼Œä¾‹å¦‚ç±»ï¼Œå‡½æ•°ï¼Œå±æ€§ç­‰</td></tr><tr><td>@Retention</td><td>é™åˆ¶æ³¨è§£ä¿å­˜çº§åˆ«ï¼Œä¾‹å¦‚è¿è¡Œæ—¶ï¼Œç¼–è¯‘æ—¶æˆ–è€…æºç æ—¶</td></tr><tr><td>@Document</td><td>å¦‚æœä½¿ç”¨è¯¥å…ƒæ³¨è§£ï¼Œå¯ä»¥è¢« javadoc æ­¤ç±»çš„å·¥å…·æ–‡æ¡£åŒ–</td></tr><tr><td>@Inherited</td><td>å¯ä»¥è®©å­ç±»ç»§æ‰¿çˆ¶ç±»ä¸­çš„æ³¨è§£</td></tr><tr><td>@Repeatable</td><td>è¡¨ç¤ºå½“å‰æ³¨è§£å¯ä»¥åœ¨åŒä¸€ä¸ªç±»ï¼Œæ¥å£ï¼Œå‡½æ•°ä¸­å¤šæ¬¡ä½¿ç”¨ï¼ŒJDK8 å¼€å§‹æ”¯æŒ</td></tr></tbody></table><ul><li><code>@target</code> çš„å±æ€§å€¼æ˜¯ <code>ElementType</code> å¾—æšä¸¾ç±»å‹ï¼Œç”¨äºçº¦æŸä½œç”¨èŒƒå›´ï¼š<ul><li><code>TYPE</code>ï¼š å¯ä»¥ä½œç”¨åœ¨ç±»ï¼Œæ¥å£ï¼Œæ³¨è§£ï¼Œæšä¸¾ç±»ä¸Š</li><li><code>FIELD</code>ï¼šå¯ä»¥ä½œç”¨åœ¨ç±»çš„å±æ€§ä¸Š</li><li><code>METHOD</code>ï¼šå¯ä»¥ä½œç”¨åœ¨æ–¹æ³•ä¸Š</li><li><code>CONSTRUCTOR</code>ï¼šå¯ä»¥ä½œç”¨åœ¨æ„é€ æ–¹æ³•ä¸­</li><li><code>PARAMETER</code>ï¼šå¯ä»¥ä½œç”¨åœ¨å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­</li><li><code>LOCAL_VARIABLE</code>ï¼šå¯ä»¥ä½œç”¨åœ¨æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ä¸­</li><li><code>ANNOTATION_TYPE</code>ï¼šå¯ä»¥ä½œç”¨åœ¨æ³¨è§£ä¸Šï¼Œ<strong>TYPEä¸­å·²ç»åŒ…å«äº†</strong></li><li><code>PACKAGE</code>ï¼šå¯ä»¥ä½œç”¨åœ¨åŒ…ä¸Š</li><li><code>TYPE_USE</code>ï¼šèƒ½æ ‡æ³¨ä»»ä½•ç±»å‹ä¸Šï¼Œ<strong>JDK8 å¼€å§‹æ”¯æŒ</strong></li></ul></li><li><code>@Retention</code> å¯ä»¥é™åˆ¶æ³¨è§£çš„ä¿å­˜çº§åˆ«ï¼Œå€¼ä¸º <code>RetentionPolicy</code> çš„æšä¸¾ç±»å‹ï¼š<ul><li><code>SOURCE</code>ï¼šå¯ä»¥ä¿å­˜åœ¨æºä»£ç ä¸­</li><li><code>CLASS</code>ï¼šå¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¿å­˜åœ¨ class æ–‡ä»¶ä¸­</li><li><code>RUNTIME</code>ï¼šåœ¨è¿è¡Œæ—¶ä¿å­˜ï¼Œ==ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨è¿™ä¸ªå°±å¥½äº†==</li></ul></li></ul><h2 id="è‡ªå®šä¹‰æ³¨è§£">è‡ªå®šä¹‰æ³¨è§£</h2><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“ä»€ä¹ˆæ—¶æ³¨è§£äº†ï¼Œå¹¶ä¸”çŸ¥é“äº†ç”¨äºçº¦æŸæ³¨è§£çš„å…ƒæ³¨è§£ï¼Œæ¥ä¸‹æ¥å°±æ¥åŸºäºè¿™äº›çº¦æŸæ¥åˆ›å»ºè‡ªå®šä¹‰çš„æ³¨è§£</p><blockquote><p>åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£</p></blockquote><p>åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£å…¶å®å¾ˆç®€å•ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨ <code>interfase</code> å…³é”®å­—å‰é¢åŠ ä¸Š <code>@</code> ç¬¦å·ï¼Œè¿™æ ·ä¸€ä¸ªæ³¨è§£å°±åˆ›å»ºå¥½äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="comment">// å»ºè®®ä½¿ç”¨RUNTIME</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnno1 &#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyAnno1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MyAnno1</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;å¼ &quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MyAnno1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="meta">@MyAnno1</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;æ¶µå“²&quot;</span>;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.user + name +<span class="string">&quot;ï¼šfunc1 function run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Demo2</span>().func1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŸºäºå…ƒæ³¨è§£åŠ ä¸€äº›çº¦æŸ</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ³¨è§£å·²ç»åˆ›å»ºæˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è®©æ³¨è§£åªèƒ½åœ¨å‡½æ•°ä¸Šç”Ÿæ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span> <span class="comment">// åªåœ¨å‡½æ•°ä¸­ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnno1 &#123; &#125;</span><br></pre></td></tr></table></figure><p><img src="..//img/JavaSenior-01.jpg" alt=""></p><blockquote><p>æ³¨è§£å‚æ•°</p></blockquote><p>ç°åœ¨æˆ‘ä»¬çš„æ³¨è§£éœ€è¦æ¥æ”¶ä¸€äº›å‚æ•°ï¼Œåœ¨æ³¨è§£ä¸­æ·»åŠ å‚æ•°åˆ—è¡¨ä¹Ÿå¾ˆç®€å•ï¼Œå°±åƒæ¥å£ä¸­ä¹¦å†™æ–¹æ³•ä¸€æ ·å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnno1 &#123;</span><br><span class="line">    String <span class="title function_">user</span><span class="params">()</span>;</span><br><span class="line">    String[] name();</span><br><span class="line">    String <span class="title function_">gender</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;ç”·&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ¥å£ä¸­å®šä¹‰å‚æ•°åˆ—è¡¨åï¼Œä½¿ç”¨è¯¥æ³¨è§£çš„æ—¶å€™å¿…é¡»å°†å€¼å¡«å†™å®Œæ•´ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼Œå¦‚æœä½¿ç”¨äº† <code>dufault</code> è®¾ç½®é»˜è®¤å€¼çš„è¯å¯ä»¥ä¸ç”¨ä¼ å€¼ï¼Œå†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyAnno1(user = &quot;å¼ &quot;, name = &#123;&quot;æ¶µå“²&quot;, &quot;å“ˆå“ˆ&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func1</span><span class="params">()</span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ•°ç»„ name åªéœ€è¦ä¸€ä¸ªå‚æ•°çš„è¯ï¼Œé‚£ä¹ˆèŠ±æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥ä¸å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyAnno1(user = &quot;å¼ &quot;, name = &quot;æ¶µå“²&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func1</span><span class="params">()</span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ³¨è§£ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°çš„è¯ï¼Œå»ºè®®å˜é‡åå‘½åä¸º valueï¼Œè¿™æ ·çš„è¯åœ¨ä¼ å‚çš„æ—¶å€™å¯ä»¥çœç•¥ä¸å†™ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnno2 &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyAnno2(&quot;å“ˆå“ˆå“ˆå“ˆ&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ”¶å°¾å·¥ä½œ</p></blockquote><p>ç›®å‰æ¥è¯´æ³¨è§£å°±å·²ç»å­¦å®Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å­¦çš„æ³¨è§£éƒ½æ˜¯ â€œé¸¡è‚‹â€ï¼Œéƒ½æ˜¯ â€œç©ºæ¶å­â€ï¼Œä»–å…‰æœ‰æ³¨è§£çš„å‹ä½†æ˜¯æ²¡ç”¨åŠŸèƒ½ï¼Œæƒ³è¦è®©æˆ‘ä»¬çš„æ³¨è§£å«æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¾èµ–äºåå°„æŠ€æœ¯ã€‚</p><h1>Javaåå°„</h1><p>java çš„åå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è·å–ä»»ä½•ç±»çš„å®Œæ•´ç»“æ„ä¿¡æ¯ ( æ³¨æ„ï¼Œæ˜¯ç±»çš„ä¿¡æ¯ï¼Œä¸æ˜¯å®ä¾‹çš„ä¿¡æ¯ )ï¼Œå¹¶å¯ä»¥æ“ä½œå…¶å±æ€§ä»¥åŠæ–¹æ³•ã€‚</p><p>åœ¨ java ä¸­é’ˆå¯¹åå°„æœºåˆ¶ä¹Ÿæä¾›äº†ä¸€ä¸ªç±»ï¼š<code>Class</code>ï¼Œå¯ä»¥é€šè¿‡ class å®ä¾‹è¿›è¡Œç›¸å…³æ“ä½œ</p><h2 id="è·å–Classå®ä¾‹">è·å–Classå®ä¾‹</h2><blockquote><p>è·å–åˆ°æŸä¸ªç±»çš„ class å®ä¾‹ï¼Œæœ‰å¤§æ¦‚å››ç§æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º</p></blockquote><ol><li>é€šè¿‡å®ä¾‹çš„ <code>getClass()</code> å‡½æ•°è·å–</li><li>é€šè¿‡ç›®æ ‡ç±»çš„ <code>class</code> å±æ€§è·å–</li><li>é€šè¿‡Classç±»çš„é™æ€å‡½æ•° <code>forName()</code> è·å–</li><li>å¦‚æœæ˜¯åŸºæœ¬ç±»å‹åŒ…è£…ç±»å¯ä»¥ç”¨ <code>TYPE</code> å±æ€§è·å–</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–classå¯¹è±¡çš„4ç§æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªPersonå®ä¾‹</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="comment">// æ¼”ç¤ºå››ç§æ–¹æ³•è·å–classå®ä¾‹</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> p.getClass();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c2</span> <span class="operator">=</span> Person.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c3</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;site.hanzhe.entity.Person&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c4</span> <span class="operator">=</span> Integer.TYPE;</span><br><span class="line">        <span class="comment">// æ‰“å°æµ‹è¯•</span></span><br><span class="line">        System.out.println(c1);  System.out.println(c2);</span><br><span class="line">        System.out.println(c3);  System.out.println(c4);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œjava ä¸­æ¯ç§ç±»å‹åªæœ‰ä¸€ä¸ª class å®ä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// javaä¸­æ¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªclasså®ä¾‹ï¼Œæ— è®ºé€šè¿‡ä»€ä¹ˆæ–¹æ³•è·å–çš„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> p.getClass();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c2</span> <span class="operator">=</span> Person.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c3</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;site.hanzhe.entity.Person&quot;</span>);</span><br><span class="line">        System.out.println(c1.hashCode());</span><br><span class="line">        System.out.println(c2.hashCode());</span><br><span class="line">        System.out.println(c3.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>java ä¸­å‡ ä¹æ‰€æœ‰ç±»å‹éƒ½å¯ä»¥è·å–åˆ° class å®ä¾‹å¯¹è±¡</p></blockquote><ul><li>ç±»ï¼Œæ•°ç»„ï¼Œæšä¸¾çš„ class å®ä¾‹æ‰“å°å‡ºæ¥æ˜¯ä»¥ class å¼€å¤´çš„ï¼Œä¸”æ•°ç»„åé¢çš„ <code>[</code> æ ¹æ®ç»´åº¦è¿›è¡Œå˜åŒ–çš„</li><li>æ¥å£ï¼Œæ³¨è§£æ‰“å°çš„ class å®ä¾‹æ‰“å°å‡ºæ¥æ˜¯ä»¥ interface å¼€å¤´çš„</li><li>void å°±æ˜¯ void</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// javaä¸­å‡ ä¹æ‰€æœ‰ç±»å‹éƒ½å¯ä»¥è·å–åˆ°classå®ä¾‹å¯¹è±¡ï¼ŒåŒ…æ‹¬ä»–æœ¬èº«</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span>  <span class="operator">=</span> Class.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c2</span>  <span class="operator">=</span> Person.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c3</span>  <span class="operator">=</span> Runnable.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c4</span>  <span class="operator">=</span> <span class="type">int</span>[].class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c5</span>  <span class="operator">=</span> <span class="type">int</span>[][].class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c6</span>  <span class="operator">=</span> Deprecated.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c7</span>  <span class="operator">=</span> ElementType.class;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c8</span>  <span class="operator">=</span> <span class="keyword">void</span>.class;</span><br><span class="line">        System.out.println(c1);</span><br><span class="line">        System.out.println(c2);</span><br><span class="line">        System.out.println(c3);</span><br><span class="line">        System.out.println(c4);</span><br><span class="line">        System.out.println(c5);</span><br><span class="line">        System.out.println(c6);</span><br><span class="line">        System.out.println(c7);</span><br><span class="line">        System.out.println(c8);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡Classå®ä¾‹è·å–ç›¸å…³ä¿¡æ¯">é€šè¿‡Classå®ä¾‹è·å–ç›¸å…³ä¿¡æ¯</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸Šå››ç§æ–¹æ³•è·å–åˆ°æŸä¸ªç±»çš„ class å®ä¾‹ï¼Œè·å–åˆ° class å®ä¾‹ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥å®ä¾‹è·å–åˆ°ç±»ä¸­æ‰€æœ‰çš„ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡classå®ä¾‹å¯ä»¥è·å–åˆ°ç±»çš„ä»»ä½•ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è·å–åˆ°Personç±»çš„classå®ä¾‹</span></span><br><span class="line">        Class&lt;?&gt; c1 = Class.forName(<span class="string">&quot;site.hanzhe.entity.Person&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–å±æ€§ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> (Field field : c1.getFields())</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–æ‰€æœ‰å±æ€§: &quot;</span> + field);</span><br><span class="line">        <span class="keyword">for</span> (Field field : c1.getDeclaredFields())</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–å…¨éƒ¨å±æ€§(å«ç§æœ‰): &quot;</span> + field);</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–æŒ‡å®šå±æ€§&quot;</span> + c1.getField(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–æŒ‡å®šå±æ€§(å«ç§æœ‰)&quot;</span> + c1.getDeclaredField(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–å‡½æ•°ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> (Method method : c1.getMethods())</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–æ‰€æœ‰å‡½æ•°: &quot;</span> + method);</span><br><span class="line">        <span class="keyword">for</span> (Method method : c1.getDeclaredMethods())</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–æ‰€æœ‰å‡½æ•°(å«ç§æœ‰): &quot;</span> + method);</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–æŒ‡å®šå‡½æ•°: &quot;</span> + c1.getMethod(<span class="string">&quot;getName&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–æŒ‡å®šå‡½æ•°(å¸¦å‚æ•°): &quot;</span> + </span><br><span class="line">                           c1.getMethod(<span class="string">&quot;setName&quot;</span>, String.class));</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–æŒ‡å®šå‡½æ•°(å«ç§æœ‰): &quot;</span> + c1.getDeclaredMethod(<span class="string">&quot;show&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–æ„é€ å™¨ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : c1.getConstructors())</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–æ‰€æœ‰æ„é€ å™¨: &quot;</span> + constructor);</span><br><span class="line">        <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : c1.getDeclaredConstructors())</span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–æ‰€æœ‰æ„é€ å™¨(å«ç§æœ‰): &quot;</span> + constructor);</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–æŒ‡å®šå‡½æ•°(å¸¦å‚æ•°): &quot;</span> + </span><br><span class="line">                           c1.getConstructor(String.class, <span class="type">int</span>.class));</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–æŒ‡å®šå‡½æ•°(å«ç§æœ‰): &quot;</span> + </span><br><span class="line">                           c1.getDeclaredConstructor(<span class="type">int</span>.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>class.get***</code>ï¼šè·å–ç›®æ ‡ç±» ( åŒ…æ‹¬çˆ¶ç±» ) çš„ å­—æ®µ/å‡½æ•°</p><p><code>class.getDeclared***</code>ï¼šè·å–ç›®æ ‡ç±» ( åŒ…å«ç§æœ‰ä½†ä¸åŒ…å«çˆ¶ç±» ) çš„ å­—æ®µ/å‡½æ•°</p><h2 id="åŠ¨æ€åˆ›å»ºæ‰§è¡Œ">åŠ¨æ€åˆ›å»ºæ‰§è¡Œ</h2><p>åˆšåˆšæˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ class å®ä¾‹è·å–åˆ°æ‰€æœ‰çš„å‡½æ•°å’Œå±æ€§äº†ï¼Œæ—¢ç„¶å¯ä»¥è·å–é‚£ä¹ˆå°±ä¸€å®šå¯ä»¥è°ƒç”¨äº†</p><blockquote><p>é€šè¿‡åå°„è·å–ç±»çš„å®ä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseInstance</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;site.hanzhe.entity.Person&quot;</span>);</span><br><span class="line">        <span class="comment">// 1. é€šè¿‡classç›´æ¥åˆ›å»ºpersonå¯¹è±¡ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªå¼Šç«¯ï¼Œ</span></span><br><span class="line">        <span class="comment">// åªæœ‰åœ¨ç›®æ ‡ç±»æä¾›äº† public çš„ç©ºå‚æ„é€ æ‰å¯ä»¥è·å–åˆ°</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">        System.out.println(o);</span><br><span class="line">        System.out.println(<span class="string">&quot;======================================================&quot;</span>);</span><br><span class="line">        <span class="comment">// 2ã€å…ˆè·å–åˆ°classçš„æ„é€ æ–¹æ³•ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•è·å–åˆ°å®ä¾‹å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// è¿™ç§æ–¹æ³•å¯ä»¥è·å–åˆ°ä»»ä½•å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="comment">// -- è·å–å…·æœ‰ä¸¤ä¸ªStringä½œä¸ºå‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> </span><br><span class="line">              clazz.getDeclaredConstructor(String.class, String.class);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;å¼ &quot;</span>, <span class="string">&quot;æ¶µå“²&quot;</span>);</span><br><span class="line">        System.out.println(o1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>invokeï¼šè·å–åˆ°ç±»ä¸­çš„å‡½æ•°å¹¶æ‰§è¡Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseMethod</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;site.hanzhe.entity.Person&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> </span><br><span class="line">              clazz.getDeclaredConstructor(String.class, String.class);</span><br><span class="line">        <span class="comment">// è·å–åˆ°ç±»çš„å®ä¾‹</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;å¼ &quot;</span>, <span class="string">&quot;æ¶µå“²&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–åˆ°ç±»ä¸­çš„setNameå‡½æ•°ï¼Œéœ€è¦ä¸€ä¸ªStringä½œä¸ºå‚æ•°</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">setName</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨objå®ä¾‹æ‰§è¡ŒsetNameæ–¹æ³•</span></span><br><span class="line">        setName.invoke(obj, <span class="string">&quot;ä¸‰&quot;</span>);</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>get-setï¼šè·å–åˆ°ç±»ä¸­çš„å±æ€§è¿›è¡Œæ“ä½œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseField</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;site.hanzhe.entity.Person&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clazz.getDeclaredConstructor(String.class, String.class);</span><br><span class="line">        <span class="comment">// è·å–åˆ°ç±»çš„å®ä¾‹</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;å¼ &quot;</span>, <span class="string">&quot;æ¶µå“²&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–ç±»ä¸­åç§°ä¸ºnameçš„å˜é‡</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">// setä¿®æ”¹objçš„å±æ€§å€¼</span></span><br><span class="line">        name.set(obj, <span class="string">&quot;éº»å­&quot;</span>);</span><br><span class="line">        <span class="comment">// getè·å–åˆ°objå®ä¾‹ä¸­çš„å±æ€§å€¼</span></span><br><span class="line">        System.out.println(name.get(obj));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ—¶å€™å´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¼‚å¸¸ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalAccessException: Class site.hanzhe.reflect.UseField can not access a member of <span class="keyword">class</span> <span class="title class_">site</span>.hanzhe.entity.Person with modifiers <span class="string">&quot;private&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è·å–è®¿é—®æƒé™">è·å–è®¿é—®æƒé™</h2><p>ä¸Šé¢è·å–å˜é‡çš„æ—¶å€™æŠ›å‡ºäº† <code>IllegalAccessException</code> å¼‚å¸¸ï¼Œæç¤ºæˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ“ä½œ <code>private</code> ç§æœ‰å±æ€§ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ <em>å–æ¶ˆæƒé™æ£€æŸ¥</em> æ¥æš´åŠ›è·å–åˆ°å±æ€§çš„æƒé™</p><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>isAccessible()</td><td>è·å–åˆ°æ˜¯å¦æ‹¥æœ‰è®¿é—®æƒé™çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªbooleanå€¼</td></tr><tr><td>setAccessible( boolean flag)</td><td>è®¾ç½®è®¿é—®æƒé™ï¼Œtrue ä¸ºå¯è®¿é—®ï¼Œfalse ä¸ºä¸å¯è®¿é—®</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseField</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;site.hanzhe.entity.Person&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> </span><br><span class="line">              clazz.getDeclaredConstructor(String.class, String.class);</span><br><span class="line">        <span class="comment">// è·å–åˆ°ç±»çš„å®ä¾‹</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;å¼ &quot;</span>, <span class="string">&quot;æ¶µå“²&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–ç±»ä¸­åç§°ä¸ºnameçš„å˜é‡</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦å…·æœ‰æƒé™æ“ä½œï¼š&quot;</span> + name.isAccessible());  <span class="comment">// false</span></span><br><span class="line">        name.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦å…·æœ‰æƒé™æ“ä½œï¼š&quot;</span> + name.isAccessible());  <span class="comment">// true</span></span><br><span class="line">        name.set(obj, <span class="string">&quot;éº»å­&quot;</span>);</span><br><span class="line">        System.out.println(name.get(obj));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>é«˜çº§æ‰©å±•</h1><h2 id="Javaå†…å­˜åˆ†æ">Javaå†…å­˜åˆ†æ</h2><p>å½“ç¨‹åºä½¿ç”¨æŸä¸ªç±»çš„æ—¶å€™ä¼šå»å†…å­˜ä¸­æ£€æŸ¥ï¼Œå¦‚æœè¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–åŠ è½½ï¼š</p><p><strong>1.ã€ç±»çš„åŠ è½½ã€‘</strong> å°±æ˜¯ç¼–è¯‘å¥½çš„ .class æ–‡ä»¶è¯»å…¥è™šæ‹Ÿæœº</p><p>**2.ã€ç±»çš„é“¾æ¥ã€‘**ç±»çš„é“¾æ¥å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæµç¨‹ï¼š</p><ol><li>**éªŒè¯ï¼š**æ£€æŸ¥ class æ˜¯å¦ç¬¦åˆ JVM è§„èŒƒï¼Œæ£€æŸ¥å®‰å…¨é—®é¢˜é˜²æ­¢ç ´å JVM</li><li>**å‡†å¤‡ï¼š**ä¸ºè¯¥ç±»ä¸­çš„ static ä¿®é¥°çš„æˆå‘˜å˜é‡è®¾ç½®åˆå§‹å€¼ ( ä¾‹å¦‚ int ä¸º0ï¼ŒString ä¸º null ä¹‹ç±»çš„ )</li><li>**è§£æï¼š**ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ä¸ªâ€¦ä»¥ååœ¨ç ”ç©¶</li></ol><p>**3.ã€åˆå§‹åŒ–ã€‘**è¿™é‡Œä¼šæ‰§è¡Œç±»æ„é€ å™¨ <code>&lt;clinit&gt;</code>ï¼Œä»–ä¼šè‡ªåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—èåœ¨ä¸€èµ·äº§ç”Ÿçš„æ–¹æ³•ï¼Œä¼šæŒ‰ç…§ç±»ä¸­çš„ç¼–ç çš„é¡ºåºä»ä¸Šåˆ°ä¸‹çš„æµç¨‹æ‰§è¡Œ</p><h2 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨</h2><p>ä¸Šé¢ç®€å•å­¦ä¹ äº†ä¸€ä¸‹å…³äºç±»åŠ è½½çš„è¿‡ç¨‹ï¼ŒçŸ¥é“äº†ç±»æƒ³è¦ä½¿ç”¨å¿…é¡»è¦å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåœ¨ java ä¸­ç±»åŠ è½½å™¨å°±æ˜¯è´Ÿè´£å°†ç±»åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œjava ä¸­çš„ç±»åŠ è½½å™¨åˆ†ä¸ºä¸‰ç§ï¼š</p><p>**1.ã€ç³»ç»Ÿç±»åŠ è½½å™¨ã€‘**ç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯æœ€å¸¸ç”¨çš„ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½ classpath ä¸‹çš„ç±»æˆ–åŠ è½½ <code>java.class.path</code> æ‰€æŒ‡çš„ç›®å½•ä¸‹çš„ jar åŒ…è£…å…¥ï¼Œæˆ‘ä»¬æ‰€å†™çš„ Person ç±»ï¼ŒUser ç±»éƒ½æ˜¯é€šè¿‡ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½åˆ°å†…å­˜ä¸­å»çš„</p><p>**2.ã€æ‰©å±•ç±»åŠ è½½å™¨ã€‘**æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½çš„æ˜¯ jre ç›®å½•ä¸‹ lib/ext ä¸‹çš„ jar åŒ…æˆ– <code>java.ext.path</code> ç›®å½•ä¸‹çš„ jar åŒ…</p><p>**3.ã€å¼•å¯¼ç±»åŠ è½½å™¨ã€‘**ä¸»è¦è´Ÿè´£åŠ è½½æ ¸å¿ƒçš„ç±»ï¼Œä¾‹å¦‚ Stringï¼ŒScanner ç­‰ç­‰ï¼Œå¤„äºè¿™ä¸ªçŠ¶æ€ä¸‹ java æ˜¯æ²¡æ³•å·¥ä½œçš„ï¼Œæ‰€ä»¥è¿™ä¸ªç±»åŠ è½½å™¨ä½¿ç”¨ C ç¼–å†™çš„ï¼Œä¹Ÿå°±æ„å‘³ç€ java è·å–ä¸åˆ°è¿™ä¸ªç±»åŠ è½½å™¨</p><blockquote><p>è·å–ç±»åŠ è½½å™¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ç±»çš„ä¸‰ä¸­åŠ è½½å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// è·å–ç³»ç»Ÿç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader1</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        System.out.println(loader1);</span><br><span class="line">        <span class="comment">// è·å–æ‰©å±•ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">extLoader</span> <span class="operator">=</span> loader1.getParent();</span><br><span class="line">        System.out.println(extLoader);</span><br><span class="line">        <span class="comment">// è·å–å¼•å¯¼ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">bootstrapLoader</span> <span class="operator">=</span> extLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapLoader);</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹è‡ªå·±åˆ›å»ºçš„ç±»æ˜¯è¢«é‚£ä¸ªåŠ è½½å™¨åŠ è½½çš„</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;site.hanzhe.examle.Demo4&quot;</span>);</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> c1.getClassLoader();</span><br><span class="line">        System.out.println(loader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¤šçº¿ç¨‹</title>
    <link href="/2021/04/13/Java%E7%AC%94%E8%AE%B0/%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF/"/>
    <url>/2021/04/13/Java%E7%AC%94%E8%AE%B0/%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<h1>Javaå¤šçº¿ç¨‹</h1><blockquote><p>è¿›ç¨‹ï¼Œçº¿ç¨‹ä»¥åŠå¤šçº¿ç¨‹</p></blockquote><p>æƒ³å­¦ä¹ çº¿ç¨‹é¦–å…ˆè¦ææ‡‚è¿›ç¨‹ï¼Œè¿›ç¨‹æŒ‡çš„å°±æ˜¯æˆ‘ä»¬æ­£åœ¨è¿è¡Œçš„æŸä¸ªåº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ QQï¼Œå¾®ä¿¡ä»¥åŠè‡ªå·±ç¼–å†™çš„ java ç¨‹åºè¿è¡Œèµ·æ¥ä¹‹åéƒ½å±äºä¸€ä¸ªè¿›ç¨‹</p><p>çº¿ç¨‹æ˜¯æœ€å°çš„è¿ç®—è°ƒåº¦å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹è¦æ±‚è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨å•æ ¸å¤„ç†å™¨çš„æƒ…å†µä¸‹å¤šçº¿ç¨‹æ˜¯ä»¥äº¤æ›¿å½¢å¼è¿è¡Œçš„ï¼Œå¹¶ä¸æ˜¯åŒæ—¶è¿è¡Œï¼Œåªæ˜¯åˆ‡æ¢çš„é€Ÿåº¦æ¯”è¾ƒå¿«è€Œå·²ï¼Œå¤šæ ¸å¤„ç†å™¨ä¹Ÿæ˜¯åŒç†ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½å¯ä»¥è°ƒç”¨çº¿ç¨‹ï¼Œå¯ä»¥å®ç°åŒæ—¶è¿è¡Œ</p><p>æˆ‘ä»¬ç”¨ java ä¹¦å†™çš„æ§åˆ¶å°ç¨‹åºï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œmian å‡½æ•°å°±æ˜¯ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ä»£ç éƒ½æ˜¯åŸºäº mian çº¿ç¨‹æŒ‰ç…§é¡ºåºå¾€ä¸‹è·‘çš„ï¼Œæœ‰äº›æ—¶å€™æœ‰é‚£ç§è®¡ç®—é‡æ¯”è¾ƒå¤§çš„å‡½æ•°å°±ä¼šå¾ˆæµªè´¹æ—¶é—´ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åœ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å°†è¿™ä¸ªå‡½æ•°ä¸¢ç»™ä»–è°ƒç”¨ï¼Œå°±ä¸å½±å“ä¸»å‡½æ•°çš„æ‰§è¡Œæ—¶é—´äº†ï¼Œä¾‹å¦‚å‘é€é‚®ä»¶çš„æ—¶é—´å»¶è¿Ÿï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¤šçº¿ç¨‹çš„å¼‚æ­¥ç‰¹ç‚¹æ¥å®ç°</p><blockquote><p>Thread çº¿ç¨‹ç±»å¸¸ç”¨æ–¹æ³•</p></blockquote><table><thead><tr><th>ç±»å‹</th><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>å®ä¾‹</td><td>start();</td><td>æ¿€æ´»çº¿ç¨‹å¼€å§‹è¿è¡Œ</td></tr><tr><td>å®ä¾‹</td><td>run();</td><td>çº¿ç¨‹ç±»å¿…é¡»å¤å†™çš„å‡½æ•°ï¼ŒåŒ…å«è¯¥çº¿ç¨‹éœ€è¦å®Œæˆçš„é€»è¾‘ä»£ç ç­‰</td></tr><tr><td>å®ä¾‹</td><td>setName(String name)</td><td>ä¿®æ”¹å½“å‰çº¿ç¨‹åç§°</td></tr><tr><td>å®ä¾‹</td><td>setPriority(int priority)</td><td>è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§</td></tr><tr><td>å®ä¾‹</td><td>setDaemon(boolean on)</td><td>è®¾ç½®å®ˆæŠ¤å®ˆæŠ¤çº¿ç¨‹ ( true ) å’Œç”¨æˆ·çº¿ç¨‹ ( fasse )</td></tr><tr><td>å®ä¾‹</td><td>String getName()</td><td>è·å–å½“å‰çº¿ç¨‹åç§°</td></tr><tr><td>å®ä¾‹</td><td>int getPriority()</td><td>è·å–çº¿ç¨‹çš„ä¼˜å…ˆçº§</td></tr><tr><td>å®ä¾‹</td><td>join()</td><td>æš‚å®šå½“å‰çº¿ç¨‹ï¼Œç”±è°ƒç”¨è€…å¼€å§‹ä¸‹ä¸€æ¬¡æ‰§è¡Œ</td></tr><tr><td>å®ä¾‹</td><td>isAlive()</td><td>æ£€æµ‹çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€</td></tr><tr><td>â€”â€”</td><td>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</td><td>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</td></tr><tr><td>é™æ€</td><td>yield()</td><td>ç¤¼è®©ï¼šåœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œè°ƒç”¨è€…æ’é˜Ÿæ‰§è¡Œ</td></tr><tr><td>é™æ€</td><td>sleep(long time)</td><td>ç¡çœ ï¼šå½“å‰çº¿ç¨‹æš‚åœè¿è¡Œï¼Œtime æ¯«ç§’åç»§ç»­æ‰§è¡Œ</td></tr><tr><td>é™æ€</td><td>boolean holdsLock(Object x)</td><td>å½“å‰çº¿ç¨‹åœ¨æŒ‡å®šçš„å¯¹è±¡ä¸Šä¿æŒç›‘è§†é”æ—¶åä¼š true</td></tr><tr><td>é™æ€</td><td>Thread currentThread()</td><td>è¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹</td></tr></tbody></table><h2 id="çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼">çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼</h2><p>çº¿ç¨‹çš„åˆ›å»ºæœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œç®€å•ä»‹ç»å¸¸ç”¨çš„å‡ ç§</p><blockquote><p>ç»§æ‰¿ Thread ç±»</p></blockquote><p>å››éƒ¨æ›²ï¼šç»§æ‰¿ Thread ç±» â†’ å¤å†™ run æ–¹æ³• â†’ åˆ›å»ºå½“å‰ç±»å¯¹è±¡ ( å¤šæ€ï¼šThread ç±»å‹ ) â†’ start å¯åŠ¨çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šçº¿ç¨‹ç¬¬ä¸€ç§å®ç°æ–¹å¼ï¼šç»§æ‰¿Threadç±»å¤å†™runå‡½æ•°ï¼Œrunå‡½æ•°å†…å°±æ˜¯å¤šçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡äº†ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread1</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">300</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MyThread1</span>().start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;main æ‰§è¡Œäº†&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ã€å¤šçº¿ç¨‹æ‰§è¡Œã€‘&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®ç° Runnable æ¥å£</p></blockquote><p>å››éƒ¨æ›²ï¼šå®ç° Runnable æ¥å£ â†’ å¤å†™ run æ–¹æ³• â†’ åˆ›å»ºçº¿ç¨‹ç±»å¯¹è±¡ ( å°†å½“å‰ç±»ç¤ºä¾‹äº¤ç»™ä»– ) â†’ start å¯åŠ¨çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ã€å¤šçº¿ç¨‹æ‰§è¡Œã€‘&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>( <span class="keyword">new</span> <span class="title class_">MyThread2</span>() ).start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;main æ‰§è¡Œäº†&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¿«é€Ÿåˆ›å»ºçº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">300</span>;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>( ()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ã€å¤šçº¿ç¨‹æ‰§è¡Œã€‘æ‰§è¡Œäº†&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;main æ‰§è¡Œäº†&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»§æ‰¿ Thread ç±»å’Œå®ç° Runnable æ¥å£çš„åŒºåˆ«</p></blockquote><p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªå–ç¥¨çš„å°ç»ƒä¹ æ¥äº†è§£ä¸€ä¸‹ä¸¤ç§çº¿ç¨‹åˆ›å»ºçš„åŒºåˆ«</p><p><strong>Runnable æ¥å£å®ç°çš„å¤šçº¿ç¨‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€ç»ˆæ•°æ®å¯èƒ½ä¼šå‡ºç°äº›è®¸åå·®ï¼Œä¹‹ååœ¨è®²</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBuyTicket</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">ticketNum</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyBuyTicket</span> <span class="variable">mb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBuyTicket</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mb);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mb);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mb);</span><br><span class="line">        t1.setName(<span class="string">&quot;è€å…«&quot;</span>);</span><br><span class="line">        t2.setName(<span class="string">&quot;å¢æœ¬ä¼Ÿ&quot;</span>);</span><br><span class="line">        t3.setName(<span class="string">&quot;èœè™šé²²&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> ( ticketNum &gt; <span class="number">0</span> )&#123;</span><br><span class="line">            ticketNum--;</span><br><span class="line">            <span class="comment">// currentThreadè·å–å½“å‰è¿è¡Œçš„çº¿ç¨‹ï¼ŒgetNameè·å–çº¿ç¨‹çš„åç§°</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ã€&quot;</span> + </span><br><span class="line">                               Thread.currentThread().getName() + <span class="string">&quot;ã€‘æŠ¢åˆ°äº†ä¸€å¼ ç¥¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Thread ç±»å®ç°çš„å¤šçº¿ç¨‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBuyTicket</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">ticketNum</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBuyTicket</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBuyTicket</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBuyTicket</span>();</span><br><span class="line">        t1.setName(<span class="string">&quot;è€å…«&quot;</span>);</span><br><span class="line">        t2.setName(<span class="string">&quot;å¢æœ¬ä¼Ÿ&quot;</span>);</span><br><span class="line">        t3.setName(<span class="string">&quot;èœè™šé²²&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> ( ticketNum &gt; <span class="number">0</span> )&#123;</span><br><span class="line">            ticketNum--;</span><br><span class="line">            System.out.println(<span class="string">&quot;ã€&quot;</span> + </span><br><span class="line">                               Thread.currentThread().getName() + <span class="string">&quot;ã€‘æŠ¢åˆ°äº†ä¸€å¼ ç¥¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªå°ç»ƒä¹ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒThread æ¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç›¸åº”çš„å°±å¿…é¡»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ Runnable å¯ä»¥å®ç°å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡ï¼Œå…±äº«å¯¹è±¡å†…çš„æ•°æ®ï¼Œä½¿ç”¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ Runnable æ¥å£</p><h2 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>çº¿ç¨‹ä»åˆ›å»ºåˆ°ç»“æŸå…±åˆ†ä¸ºå¤§æ¦‚äº”ä¸ªç”Ÿå‘½å‘¨æœŸï¼š</p><ol><li>ã€æ–°å»ºã€‘ï¼šçº¿ç¨‹è¢«åˆ›å»ºå‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯ <code>new Thread()</code></li><li>ã€å°±ç»ªã€‘ï¼šçº¿ç¨‹å·²ç»åˆ›å»ºå®Œæ¯•å¹¶ä¸”å¯åŠ¨äº†ï¼Œä¹Ÿå°±æ˜¯å·²ç»è°ƒç”¨ <code>start()</code> æ–¹æ³•äº†ï¼Œéšæ—¶ç­‰å¾… CPU çš„è°ƒåº¦</li><li>ã€è¿è¡Œã€‘ï¼šçº¿ç¨‹è¢« CPU è°ƒåº¦ï¼Œæ­£åœ¨æ‰§è¡Œ run æ–¹æ³•å†…çš„é€»è¾‘</li><li>ã€é˜»å¡ã€‘ï¼šæ²¡æœ‰æ‰§è¡Œçš„èµ„æ ¼å’Œæ‰§è¡Œæƒåˆ©ï¼Œä¾‹å¦‚ <code>sleep(long time)</code></li><li>ã€é”€æ¯ã€‘ï¼šçº¿ç¨‹ä»»åŠ¡å·²ç»å®Œæˆï¼Œæ²¡æœ‰å†æ¬¡ä½¿ç”¨çš„åœ°æ–¹ï¼Œçº¿ç¨‹çš„å¯¹è±¡å˜æˆåƒåœ¾ï¼Œé‡Šæ”¾èµ„æºã€‚</li></ol><p>æ­£å¸¸çº¿ç¨‹çš„æµç¨‹å°±æ˜¯ã€æ–°å»ºã€‘â†’ã€å°±ç»ªã€‘â†’ã€è¿è¡Œã€‘â†’ã€å¯èƒ½ä¼šæœ‰é˜»å¡ã€‘â†’ã€å°±ç»ªã€‘â†’ã€è¿è¡Œã€‘â€¦â†’ã€é”€æ¯ã€‘</p><blockquote><p>çº¿ç¨‹ç¡çœ </p></blockquote><p>çº¿ç¨‹ç¡çœ æ˜¯æŒ‡æš‚æ—¶è®©çº¿ç¨‹åœæ­¢è¿è¡Œï¼Œåœ¨çº¦å®šæ—¶é—´å†…ä¸æ¥æ”¶ CPU çš„è°ƒåº¦ï¼Œç”¨æ³•ï¼š<code>Thread.sleep(long time)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡çº¿ç¨‹ç¡çœ å®ç°æ¯ç§’æ‰“å°ä¸€å¥è¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">1</span>; time &lt;= <span class="number">10</span>; time++ )&#123;</span><br><span class="line">            System.out.println( <span class="string">&quot;æœ¬ç«™å·²ä¸é—´æ–­è¿è¡Œ&quot;</span> + time + <span class="string">&quot;ç§’&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹åœæ­¢å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyThread3</span>()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æŸè¿è¡Œ</p></blockquote><p>è®©çº¿ç¨‹åœæ­¢è¿è¡Œï¼ŒJDK æä¾›äº† stop å®ä¾‹å‡½æ•°è¿›è¡Œåœæ­¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»ƒä¹ çº¿ç¨‹åœæ­¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>; <span class="literal">true</span>; count++ )</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹è·‘äº†&quot;</span> + count + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">MyThread3</span> <span class="variable">mt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mt);</span><br><span class="line">        t1.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        t1.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»æµ‹è¯•è¿™æ ·æ˜¯å¯ä»¥åœæ­¢çº¿ç¨‹çš„ï¼Œä½†æ˜¯å®˜æ–¹å¹¶ä¸å»ºè®®æˆ‘ä»¬è¿™ä¹ˆä½¿ç”¨ï¼Œæ¨èè‡ªå·±å®šä¹‰ä¸€ä¸ªæ ‡è¯†åœ¨å¤–éƒ¨æ§åˆ¶åœæ­¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>; flag; count++ )</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹è·‘äº†&quot;</span> + count + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = <span class="literal">false</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹åœæ­¢æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">MyThread3</span> <span class="variable">mt3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(mt3).start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        mt3.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>çº¿ç¨‹ç¤¼è®©</p></blockquote><p>æˆ‘ä»¬éƒ½çŸ¥é“çº¿ç¨‹æ˜¯è¢« CPU éšæœºè°ƒåº¦çš„ï¼Œä¸¤ä¸ªçº¿ç¨‹åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œå¦‚æœæƒ³è®©å¦ä¸€ä¸ªæ‰§è¡Œçš„å¤šä¸€ç‚¹å¯ä»¥ä½¿ç”¨çº¿ç¨‹ç¤¼è®©ï¼Œçº¿ç¨‹ç¤¼è®©å±äºé˜»å¡çš„å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¤¼è®©ä»…ä»…æ˜¯æ”¾å¼ƒå½“æ­¤è°ƒåº¦ï¼ŒCPU ä¼šé‡æ–°ä»ä¸¤ä¸ªçº¿ç¨‹ä¸­å†é€‰å‡ºä¸€ä¸ªè¿›è¡Œè°ƒåº¦ï¼Œé€‰ä¸­çš„å¯èƒ½è¿˜æ˜¯ä¹‹å‰çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹ç¤¼è®©å¹¶ä¸ä¼š 100% æˆåŠŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¿ç¨‹ç¤¼è®©</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++ )&#123;</span><br><span class="line">            <span class="comment">// è€å…«åŠ©äººä¸ºä¹é€‰æ‹©ç¤¼è®©</span></span><br><span class="line">            <span class="keyword">if</span>( i &gt;= <span class="number">90</span> &amp;&amp; Thread.currentThread().getName().equals(<span class="string">&quot;è€å…«&quot;</span>) )&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ã€è€å…«é€‰æ‹©ç¤¼è®©ã€‘&quot;</span>);</span><br><span class="line">                Thread.<span class="keyword">yield</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println( <span class="string">&quot;ã€&quot;</span> + Thread.currentThread().getName() </span><br><span class="line">                               + <span class="string">&quot;ã€‘è¿è¡Œäº†&quot;</span> + i + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread3</span> <span class="variable">mt3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mt3);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mt3);</span><br><span class="line">        t1.setName(<span class="string">&quot;è€å…«&quot;</span>);</span><br><span class="line">        t2.setName(<span class="string">&quot;èœè™šé²²&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>çº¿ç¨‹ç­‰å¾…</p></blockquote><p>æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ä¸­å¦‚æœè°ƒç”¨äº† join å‡½æ•°å°±ä¼šåœæ­¢ï¼Œä¸‹ä¸€ä¸ªè¿è¡Œçš„å‡½æ•°å°±æ˜¯ join çš„è°ƒç”¨è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i++ )&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println( <span class="string">&quot;ã€&quot;</span> + Thread.currentThread().getName()</span><br><span class="line">                               + <span class="string">&quot;ã€‘è¿è¡Œäº†&quot;</span> + i + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyThread3</span>());</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyThread3</span>());</span><br><span class="line">        t1.setName(<span class="string">&quot;è€å…«&quot;</span>);</span><br><span class="line">        t2.setName(<span class="string">&quot;èœè™šé²²&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            System.out.println( <span class="string">&quot;ã€mainçº¿ç¨‹ã€‘è¿è¡Œäº†&quot;</span> + i + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> ( i == <span class="number">500</span> )&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;mainå·²ç»è·‘åˆ°500ï¼ŒTæ¥æ’ä¸ªé˜Ÿ&quot;</span>);</span><br><span class="line">                <span class="comment">// mianå‡½æ•°ä¸­è°ƒç”¨äº†joinï¼Œmianåœæ­¢è¿è¡Œï¼Œè°ƒç”¨è€…t1å¼€å§‹ä¸‹æ¬¡æ‰§è¡Œ</span></span><br><span class="line">                t1.join();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>çº¿ç¨‹ä¼˜å…ˆçº§</p></blockquote><p>å½“æˆ‘ä»¬åˆ›å»ºäº†å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯åŠ¨çš„æ—¶å€™ï¼Œä»–ä»¬ä¼šè¢« CPU éšæœºè°ƒåº¦ï¼Œæ¯æ¬¡æ‰§è¡Œçš„é¡ºåºéƒ½ä¸åŒï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ä¼˜å…ˆçº§æ¥å†³å®šæ‰§è¡Œçš„å…ˆåé¡ºåº</p><p><code>setPriority(int priority)</code>ï¼šè®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œéœ€è¦ int ç±»å‹çš„å€¼ä½œä¸ºä¼˜å…ˆçº§å‚æ•°ï¼Œé»˜è®¤ä¼˜å…ˆçº§ä¸º 5ï¼Œå–å€¼èŒƒå›´ä¸º 1-10ï¼Œæ•°å€¼è¶Šå¤§å¯¹åº”çš„ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¯ä»¥é€šè¿‡ <code>setPriority()</code> æ¥è·å–çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ä¼šåœ¨è°ƒåº¦æ—¶è¢«ç»™äºˆä¼˜å…ˆï¼Œä½†è¿™ä¸ä»£è¡¨å¯åŠ¨åå°±ä¼šè¿è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyThread3</span><span class="params">(String msg)</span> &#123; <span class="built_in">this</span>.msg = msg; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>(<span class="string">&quot;æˆ‘æƒ³ç¬¬1ä¸ªæ‰§è¡Œ&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>(<span class="string">&quot;æˆ‘æƒ³ç¬¬2ä¸ªæ‰§è¡Œ&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>(<span class="string">&quot;æˆ‘æƒ³ç¬¬3ä¸ªæ‰§è¡Œ&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>(<span class="string">&quot;æˆ‘æƒ³ç¬¬4ä¸ªæ‰§è¡Œ&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>(<span class="string">&quot;æˆ‘æƒ³ç¬¬5ä¸ªæ‰§è¡Œ&quot;</span>);</span><br><span class="line">        t1.setPriority(<span class="number">5</span>);</span><br><span class="line">        t2.setPriority(<span class="number">4</span>);</span><br><span class="line">        t3.setPriority(<span class="number">3</span>);</span><br><span class="line">        t4.setPriority(<span class="number">2</span>);</span><br><span class="line">        t5.setPriority(<span class="number">1</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">        t5.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¯åŒºï¼šå¹¶ä¸æ˜¯ä¼˜å…ˆçº§é«˜æ‰§è¡Œç»“æŸååœ¨æ‰§è¡Œä¼˜å…ˆçº§ä½çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyThread3</span><span class="params">(String name)</span> &#123; <span class="built_in">super</span>(name); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>; count &lt; <span class="number">1000</span>; count++)</span><br><span class="line">            System.out.println(<span class="string">&quot;ã€&quot;</span> + <span class="built_in">this</span>.getName() + <span class="string">&quot;ã€‘æ‰§è¡Œäº†&quot;</span> + count + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>(<span class="string">&quot;è€å…«&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>(<span class="string">&quot;èœè™šé²²&quot;</span>);</span><br><span class="line">        t1.setPriority(<span class="number">6</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹</p></blockquote><p>çº¿ç¨‹ä¸­åŒ…å«äº†ä¸¤ç§ç±»å‹ï¼Œä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹å¯ä»¥åœ¨ä»»åŠ¡æœªå®Œæˆçš„æƒ…å†µä¸‹å¯ä»¥æ— ä¼‘æ­¢çš„è¿è¡Œï¼Œè€Œå®ˆæŠ¤çº¿ç¨‹åˆ™æ˜¯ä¸»çº¿ç¨‹ ( mian ) è¿è¡Œç»“æŸåå…³æœº JVM è™šæ‹Ÿæœºæ—¶å°±è·Ÿç€åœæ­¢è¿è¡Œäº†ï¼Œæˆ‘ä»¬åˆ›å»ºçš„çº¿ç¨‹æ²¡æœ‰ä¿®æ”¹è¿‡çš„è¯é»˜è®¤éƒ½æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œä¿®æ”¹çº¿ç¨‹ç±»å‹çš„å‡½æ•°ä¸º <code>setDaemon()</code>ï¼Œç”¨æˆ·çº¿ç¨‹ä¸º falseï¼Œå®ˆæŠ¤çº¿ç¨‹ä¸º true</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•ç”¨æˆ·çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread4</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100000</span>; i++)</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹è¿è¡Œäº†&quot;</span> + i + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºçš„çº¿ç¨‹é»˜è®¤å°±å±äºç”¨æˆ·çº¿ç¨‹ï¼Œä¸éœ€è¦ä¿®æ”¹ä»€ä¹ˆä¸œè¥¿</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread4</span>();</span><br><span class="line">        t1.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•å®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread4</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100000</span>; i++)</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹è¿è¡Œäº†&quot;</span> + i + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread4</span>();</span><br><span class="line">        <span class="comment">// è¿™é‡Œå°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤ç±»å‹</span></span><br><span class="line">        t1.setDaemon(<span class="literal">true</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="comment">// è®¾ç½®äº†500mså»¶æ—¶é˜²æ­¢çº¿ç¨‹æœªæ‰§è¡Œ</span></span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼šç”¨æˆ·çº¿ç¨‹ç­‰å¾… 10w æ¡æ•°æ®æ‰“å°å®Œæˆæ‰ç»“æŸç¨‹åºï¼Œè€Œå®ˆæŠ¤çº¿ç¨‹æ‰“å°åˆ° 4w å¤šçš„æ—¶å€™å°±ç»“æŸäº†ç¨‹åº</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½ å¥½å•Š</title>
    <link href="/2021/04/13/Java%E7%AC%94%E8%AE%B0/%E4%BD%A0%E5%A5%BD%E5%95%8A/"/>
    <url>/2021/04/13/Java%E7%AC%94%E8%AE%B0/%E4%BD%A0%E5%A5%BD%E5%95%8A/</url>
    
    <content type="html"><![CDATA[<h1>ä½ å¥½å•Š</h1><p>ç¬¬ä¸€ç¯‡é—®æ‰æ ¹æµ‹</p><p><img src="./image-20240802223537135.png" alt="image-20240802223802185"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Angularè„šæ‰‹æ¶</title>
    <link href="/2021/03/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/Angular%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/03/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/Angular%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>Angular è„šæ‰‹æ¶</h1><p>Angular ç¯å¢ƒæ­å»º</p><p>å®‰è£…  angular8 éœ€è¦ node ç‰ˆæœ¬æœ€ä½æ˜¯ <code>10.13</code>ï¼Œæˆ‘çš„ node æ˜¯ <code>8.17.0</code>ï¼Œé‚£ä¹ˆå°±æŒ‡å®šç‰ˆæœ¬å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç‰ˆæœ¬ï¼Œä½äºè¦æ±‚è¯·è·Ÿæ–°ç‰ˆæœ¬</span></span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…typescriptï¼Œå¯è·³è¿‡</span></span><br><span class="line">npm install -g typescript</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£… angular</span></span><br><span class="line">npm install @angular/cli@7.3.6 -g</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯ä»¥ä½¿ç”¨å½“å‰å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">ng v</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºä¸€ä¸ªç¨‹åº">åˆ›å»ºä¸€ä¸ªç¨‹åº</h2><p>å®‰è£…å®Œæˆååˆ›å»ºä¸€ä¸ªangular ç¨‹åºï¼Œä½¿ç”¨ <code>ng new é¡¹ç›®åç§°</code>ï¼Œåˆ›å»ºé¡¹ç›®æ—¶æœ‰ä¸¤ä¸ªæ­¥éª¤éœ€è¦æ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦å®‰è£…Angularçš„è·¯ç”±ç»„ä»¶</span></span><br><span class="line">? Would you like to add Angular routing? (y/N)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€‰æ‹©éœ€è¦ä½¿ç”¨çš„æ ·å¼è¡¨æ–‡ä»¶</span></span><br><span class="line">Which stylesheet format would you like to use? (Use arrow keys)</span><br></pre></td></tr></table></figure><p>é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œåœ¨æ§åˆ¶å°è¾“å…¥ <code>ng serve</code> ä¾¿å¯ä»¥è¿è¡Œ angular ç¨‹åºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>npm start</code>ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œangular çš„é»˜è®¤ç«¯å£å·ä¸º 4200</p><h2 id="ç›®å½•ç»“æ„è®²è§£">ç›®å½•ç»“æ„è®²è§£</h2><p>åœ¨ angular ç”Ÿæˆçš„ç›®å½•ç»“æ„ä¸­ï¼Œæœ‰ä¸€äº›æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œä¸€å®šè¦äº†è§£ï¼š</p><ul><li><code>e2e</code> å‰ç«¯æµ‹è¯•æ¨¡å—</li><li><code>node_modules</code> ç±»ä¼¼ java ä¸­çš„ libï¼Œæ·»åŠ çš„æ‰€æœ‰ç»„ä»¶éƒ½ä¼šå­˜æ”¾åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹</li><li><code>src</code> ç¼–å†™ angular é¡¹ç›®éƒ½åœ¨å½“å‰ç›®å½•ä¸‹è¿›è¡Œæ“ä½œ<ul><li><code>app</code> ä¸ºç»„ä»¶ç›®å½•ï¼Œangular ä¸­çš„æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯æ”¾åœ¨ app ç›®å½•ä¸‹è¿›è¡Œå­˜æ”¾çš„<ul><li><code>app.module.ts</code>  æ ¹æ¨¡å—ï¼Œç”¨æ¥æ³¨å†Œç»„ä»¶</li><li><code>app-routing.module.ts</code> è·¯ç”±ç»„ä»¶</li></ul></li><li><code>assets</code> èµ„æºç›®å½•ï¼Œéœ€è¦å¼•ç”¨çš„å›¾ç‰‡æˆ–å­—ä½“æ–‡ä»¶ç­‰ç­‰å¯ä»¥æ”¾åœ¨è¯¥ç›®å½•ä¸‹</li><li><code>environments</code> ç¯å¢ƒé…ç½®ï¼Œå¯ä»¥é’ˆå¯¹å„ç§ç¯å¢ƒç¼–å†™ä¸ä¸€æ ·çš„é…ç½®æ–‡ä»¶</li><li><code>browserslist</code> é…ç½®æµè§ˆå™¨æ”¯æŒ</li><li><code>index.html</code> Angular ä¾é ç»„ä»¶è¿›è¡Œå•é¡µé¢å¼€å‘ï¼Œæœ€ç»ˆä¼šæŒ‚åœ¨åˆ° index.html æ–‡ä»¶ä¸­</li><li><code>main.ts</code> é¡¹ç›®çš„å…¥å£æ–‡ä»¶</li><li><code>polyfills.ts</code> å¡«å……åº“æ–‡ä»¶</li><li><code>styles.css</code> å¼•ç”¨å…¨å±€æ€§è´¨çš„æ ·å¼æ–‡ä»¶ ( ä¾‹å¦‚ bootstrap çš„æ ·å¼æ–‡ä»¶ )</li></ul></li></ul><h2 id="ç»„ä»¶çš„åˆ›å»ºåŠä½¿ç”¨">ç»„ä»¶çš„åˆ›å»ºåŠä½¿ç”¨</h2><p>åœ¨ vue ä¸­ï¼Œç»„ä»¶æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ html éƒ¨åˆ†ï¼Œjs éƒ¨åˆ†ï¼Œcss éƒ¨åˆ†ï¼Œangular ä¸­çš„ç»„ä»¶ä¹Ÿæ˜¯åŒç†ï¼Œä¸è¿‡ vue ä¸­çš„ä¸‰ç§ç±»å‹ä»£ç åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ç¼–å†™ï¼Œè€Œ angular çš„ç»„ä»¶æ˜¯åˆ†å¼€ç¼–å†™çš„</p><blockquote><p>ç»„ä»¶å†…éƒ¨çš„htmlä»£ç åŠcssæ ·å¼éƒ½æ˜¯å•ç‹¬çš„æ–‡ä»¶è¿›è¡Œç»„åˆè€Œæˆçš„</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥angularæ ¸å¿ƒåŠŸèƒ½</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="comment">// ç»„åˆå½“å‰ç»„ä»¶çš„htmlåŠcssä»£ç </span></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-login&#x27;</span>, <span class="comment">// ä½¿ç”¨ç»„ä»¶çš„ç»„ä»¶åç§°</span></span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./login.component.html&#x27;</span>,  <span class="comment">// å¼•ç”¨çš„htmlä»£ç </span></span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;../app.component.css&#x27;</span>]     <span class="comment">// å¼•ç”¨çš„cssä»£ç </span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å°†å¯¹è±¡æš´éœ²å‡ºå»</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LoginComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span>&#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;&#125;  <span class="comment">// æ„é€ æ–¹æ³•ï¼Œæ‰§è¡Œä¼˜å…ˆçº§æœ€é«˜</span></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;&#125;     <span class="comment">// ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ˜¯OnInitä¸­å®ç°çš„æ¥å£æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»„ä»¶åˆ›å»ºå®Œæˆåéœ€è¦åœ¨ <code>app.module.ts</code> æ–‡ä»¶ä¸­ä½¿ç”¨ import å¼•ç”¨å¹¶åœ¨ declarations ä¸­æ³¨å†Œï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LoginComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./login/login.component&#x27;</span>;</span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  çœç•¥...</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">LoginComponent</span></span><br><span class="line">  ],</span><br><span class="line">  çœç•¥...</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure><hr />åˆ›å»ºç»„ä»¶å…¶å®å¯ä»¥ä¸éœ€è¦å¼•ç”¨å¤šä¸ªæ–‡ä»¶ï¼Œå®Œå…¨å¯ä»¥ä¸€ä¸ªæ–‡ä»¶æ¥ä¹¦å†™ç»„ä»¶ï¼Œåªä¸è¿‡æœ‰äº›éº»çƒ¦ï¼š<blockquote><p>å°†å¤–éƒ¨çš„ä»£ç é›†æˆåˆ°è¯¥æ–‡ä»¶ä¸­ï¼Œé™ä½äº†å¯è¯»æ€§ä¸”ä¸æ–¹ä¾¿ï¼Œä¸æ¨èä½¿ç”¨</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-login&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;h1&gt;è¿™é‡Œå†™htmlä»£ç &lt;/h1&gt;`</span>,</span><br><span class="line">  <span class="attr">style</span>: <span class="string">`è¿™é‡Œå†™cssä»£ç `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LoginComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span>&#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr />è¿™æ˜¯æœ€æ–¹ä¾¿çš„åˆ›å»ºç»„ä»¶çš„æ–¹æ³•ï¼Œåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤ `ng g component ç»„ä»¶å` å³å¯åœ¨ app ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä»¥ç»„ä»¶åå‘½åçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢çš„æ–‡ä»¶å…³è”åŠ `app.module.ts` çš„æ³¨å†Œéƒ½è‡ªåŠ¨é…ç½®æˆåŠŸï¼Œç›´æ¥å»ä½¿ç”¨å³å¯ï¼~<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨appç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªuserç»„ä»¶</span></span><br><span class="line">ng g component user</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨userç»„ä»¶ä¸‹åˆ›å»ºä¸€ä¸ªloginç»„ä»¶</span></span><br><span class="line">ng g component user/login</span><br></pre></td></tr></table></figure><h2 id="app-module-ts-é…ç½®æ–‡ä»¶">app.module.ts é…ç½®æ–‡ä»¶</h2><p>æ­£å¸¸åœ¨æˆ‘ä»¬åˆ›å»ºç»„ä»¶çš„æ—¶å€™ä¼šåœ¨è¯¥é…ç½®æ–‡ä»¶ä¸‹è¿›è¡Œæ³¨å†Œä»¥ä¾¿ä½¿ç”¨ï¼Œä½†æ˜¯ <code>app.module.ts</code> çš„åŠŸèƒ½è¿œä¸æ­¢æ³¨å†Œç»„ä»¶</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥æµè§ˆå™¨çš„è§£ææ¨¡å—ï¼Œç”¨æ¥è§£æç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="comment">// angularçš„æ ¸å¿ƒç»„ä»¶ï¼Œå¿…é¡»å¼•ç”¨</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œç»„ä»¶ä¹‹å‰éœ€è¦å°†è¢«æ³¨å†Œçš„ç»„ä»¶å¼•ç”¨åˆ°å½“å‰æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppRoutingModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app-routing.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LoginComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./login/login.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RegisterComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./register/register.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GetComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./get/get.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClientModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="comment">// æ³¨å†Œç»„ä»¶-è‡ªå·±åˆ›å»ºçš„ç»„ä»¶</span></span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span>,</span><br><span class="line">    <span class="title class_">LoginComponent</span>,</span><br><span class="line">    <span class="title class_">RegisterComponent</span>,</span><br><span class="line">    <span class="title class_">GetComponent</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// æ³¨å†Œæ¨¡å—-Angularæä¾›çš„åŠŸèƒ½æ¨¡å—ï¼Œé»˜è®¤æ˜¯ä¸ä½¿ç”¨çš„ï¼Œéœ€è¦å¼•ç”¨ååœ¨è¿™é‡Œæ³¨å†Œ</span></span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="title class_">AppRoutingModule</span>,</span><br><span class="line">    <span class="title class_">HttpClientModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// é…ç½®é¡¹ç›®ä¸­éœ€è¦å¼€å¯çš„æœåŠ¡</span></span><br><span class="line">  <span class="attr">providers</span>: [],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶æ¨¡æ¿çš„ä¹¦å†™">ç»„ä»¶æ¨¡æ¿çš„ä¹¦å†™</h2><p>angular çš„ç»„ä»¶ä¸»è¦æ˜¯ä¸€ä¸ª typescript ç»„ä»¶ï¼Œåœ¨ç»„ä»¶å†…å¯ä»¥å®šä¹‰å˜é‡åŠå‡½æ•°ï¼Œå®šä¹‰å˜é‡æ—¶éœ€è¦æºå¸¦ä¿®é¥°ç¬¦åŠç±»å‹ï¼š</p><p>ä¿®é¥°ç¬¦ï¼šã€publicã€‘ã€privateã€‘ã€protectedã€‘</p><p>ç±»å‹åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>å¸ƒå°”ç±»å‹ boolean</li><li>æ•°å­—ç±»å‹ number</li><li>å­—ç¬¦ä¸²ç±»å‹ string</li><li>å¯¹è±¡ç±»å‹ object</li><li>æ•°ç»„ç±»å‹ array</li><li>å…ƒç¥–ç±»å‹ tuple</li><li>æšä¸¾ç±»å‹ï¼š enum</li><li>ä»»æ„ç±»å‹ any</li><li>ç©ºç±»å‹ null undefined void never</li></ul><p>å®šä¹‰ä¸€ä¸ªæ ‡å‡†çš„å˜é‡ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LoginComponent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">name</span>:<span class="built_in">string</span> = <span class="string">&#x27;å¼ æ¶µå“²&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">list</span>:<span class="built_in">any</span>[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®ç»‘å®šæŒ‡ä»¤">æ•°æ®ç»‘å®šæŒ‡ä»¤</h3><p>ä¸€èˆ¬åœ¨ html ä¸­ä¼šä½¿ç”¨ä¸€äº›åœ¨ ts ä¸­å®šä¹‰å¥½çš„å˜é‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>&#123;&#123;&#125;&#125;</code> æ¥è¿›è¡Œè°ƒç”¨ï¼Œé’ˆå¯¹æ ‡ç­¾ä¸­çš„å±æ€§ä¹Ÿå¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·ä¼ å€¼ï¼Œä½†æ˜¯é™¤å¼€è¿™ä¸ªæ–¹æ³•ä¹‹å¤–è¿˜å¯ä»¥ä½¿ç”¨ <strong>[ å±æ€§ ] æ•°æ®ç»‘å®š</strong> æ¥å®ç°ç›®æ ‡æ•ˆæœ</p><blockquote><p>ä¾‹å¦‚æœ‰ä¸€ä¸ªå˜é‡ä¸º msg=â€˜æˆ‘æ˜¯ä¸€ä¸ªtitleâ€™</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ•°æ®è°ƒç”¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ç»‘å®šæ•°æ®åˆ°å±æ€§ä¸­ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">title</span>]=<span class="string">&quot;msg&quot;</span> &gt;</span>è¿™æ˜¯ä¸€ä¸ªdivæ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å°†æ•°æ®è§£æä¸ºhtmlæ ‡è®°è¯­è¨€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">innerHTML</span>]=<span class="string">&quot;msg&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æµç¨‹æ§åˆ¶æŒ‡ä»¤">æµç¨‹æ§åˆ¶æŒ‡ä»¤</h3><p><strong>æµç¨‹æ§åˆ¶æŒ‡ä»¤åˆ†ä¸ºå¾ªç¯å’Œåˆ¤æ–­</strong></p><blockquote><p>*ngFor å¾ªç¯æŒ‡ä»¤</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of list; let key=index&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;key&#125;&#125;--&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>*ngIf åˆ¤æ–­æŒ‡ä»¤</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of list; let key=index&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngIf</span>=<span class="string">&quot;key%2==1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123;key&#125;&#125;--&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngIf</span>=<span class="string">&quot;key%2==0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: blue;&quot;</span>&gt;</span>&#123;&#123;key&#125;&#125;--&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ngSwitch åˆ†æ”¯è¯­å¥</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngSwitch</span>]=<span class="string">&quot;state&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;1&#x27;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: blueviolet&quot;</span>&gt;</span>æ˜ŸæœŸ1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: blueviolet&quot;</span>&gt;</span>æ˜ŸæœŸ2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;3&#x27;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: blueviolet&quot;</span>&gt;</span>æ˜ŸæœŸ3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;4&#x27;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: blueviolet&quot;</span>&gt;</span>æ˜ŸæœŸ4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;5&#x27;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: blueviolet&quot;</span>&gt;</span>æ˜ŸæœŸ5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchDefault</span> <span class="attr">style</span>=<span class="string">&quot;color: blueviolet&quot;</span>&gt;</span>ä»Šå¤©æ”¾å‡ï¼<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€æ”¹å˜æ ·å¼">åŠ¨æ€æ”¹å˜æ ·å¼</h3><p><strong>åŠ¨æ€æ“ä½œclass</strong></p><blockquote><p>è¿™é‡Œå®šä¹‰äº† boolean ç±»å‹çš„ flagï¼Œå¯ä»¥é€šè¿‡æ“ä½œ flag å±æ€§åŠ¨æ€ä¿®æ”¹ class å±æ€§ï¼Œclass å±æ€§éœ€è¦å•å¼•å·</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;color-red&#x27;: flag, &#x27;color-blue&#x27;: !flag&#125;&quot;</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªdivæ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>åŠ¨æ€æ“ä½œ style</strong></p><blockquote><p>å’Œ class ç±»ä¼¼ï¼Œåœ¨ ngStyle ä¸­å¯ä»¥ç›´æ¥ä¸ºå±æ€§èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å˜é‡èµ‹å€¼å®ç°åŠ¨æ€æ•ˆæœ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngStyle</span>]=<span class="string">&quot;&#123;&#x27;color&#x27;: &#x27;red&#x27;, &#x27;background-color&#x27;: cor&#125;&quot;</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªdivæ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Angular-ç®¡é“">Angular ç®¡é“</h3><p>ç®¡é“ï¼Œå°±ç›¸å½“äº vue ä¸­çš„è¿‡æ»¤å™¨ï¼Œå½“ä½¿ç”¨ç®¡é“ååŸæœ¬è¾“å‡ºçš„å†…å®¹ä¼šè¢«ç®¡é“è¿›è¡Œå¤„ç†ï¼Œæ˜¾ç¤ºçš„æ˜¯å¤„ç†åçš„å†…å®¹</p><p><strong>å¸¸ç”¨ç®¡é“ï¼š</strong></p><table><thead><tr><th>ç®¡é“</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>uppercase</td><td>å°†æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯</td></tr><tr><td>lowercase</td><td>å°†æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯</td></tr><tr><td>date:â€˜yyyy-MM-dd HH:mm:ssâ€™</td><td>å°†dataæ—¶é—´è¿›è¡Œæ ¼å¼åŒ–ï¼Œåé¢è·Ÿä¸Šæ ¼å¼åŒ–çš„æ ·å¼</td></tr><tr><td>number:â€˜1.2-4â€™</td><td>å°æ•°æ ¼å¼åŒ–ï¼Œæœ€å°æœ‰ä¸€ä¸ªæ•´æ•°ä½ï¼Œå°æ•°ä½è‡³å°‘2ä¸ªï¼Œæœ€å¤š4ä¸ª</td></tr><tr><td>json</td><td>å°† object å¯¹è±¡è§£æä¸º json å­—ç¬¦ä¸²</td></tr></tbody></table><p><strong>ä½¿ç”¨ç®¡é“ï¼š</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ç®¡é“å¤„ç†æ‰“å°çš„dateå¯¹è±¡ï¼š&#123;&#123;time | date:&#x27;yyyy-MM-dd HH:mm:ss&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>è‡ªå®šä¹‰ç®¡é“ï¼š</strong></p><h3 id="è¡¨å•äº‹ä»¶">è¡¨å•äº‹ä»¶</h3><p>åœ¨ä½¿ç”¨è¡¨å•äº‹ä»¶ä¹‹å‰éœ€è¦å…ˆæŒæ¡æ™®é€šäº‹ä»¶å¦‚ä½•è°ƒç”¨ï¼š</p><blockquote><p>==ä½¿ç”¨æ‹¬å· ( ) å°†äº‹ä»¶åç§°æ‹¬èµ·æ¥==ï¼Œç„¶ååœ¨æŒ‡å®šäº‹ä»¶è§¦å‘åæ‰§è¡Œçš„ä»£ç å³å¯</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">func1</span>(<span class="params"></span>)&#123;  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿™æ˜¯ç‚¹å‡»äº‹ä»¶&quot;</span>)   &#125;</span><br><span class="line"><span class="title function_">func2</span>(<span class="params"></span>)&#123;  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿™æ˜¯æ»‘è¿‡äº‹ä»¶&quot;</span>)   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;func1()&quot;</span>&gt;</span>ç‚¹å‡»äº‹ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">mousemove</span>)=<span class="string">&quot;func2()&quot;</span>&gt;</span>æ»‘è¿‡äº‹ä»¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>è¡¨å•äº‹ä»¶</strong></p><blockquote><p>åœ¨é”®ç›˜æŒ‰ä¸‹æ—¶ä¼ å…¥äº†ä¸€ä¸ª $event å‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°å¯ä»¥è·å–åˆ°è¡¨å•ç›¸å…³çš„ä¿¡æ¯</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">down</span>(<span class="params"> e </span>)&#123;  <span class="variable language_">console</span>.<span class="title function_">log</span>( e );  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç›‘å¬é”®ç›˜æŒ‰ä¸‹äº‹ä»¶<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> (<span class="attr">keydown</span>)=<span class="string">&quot;down($event)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŒå‘æ•°æ®ç»‘å®š">åŒå‘æ•°æ®ç»‘å®š</h3><p><font color="red">åœ¨ angular ä¸­æƒ³è¦ä½¿ç”¨åŒå‘ç»‘å®šï¼Œå¿…é¡»è¦åœ¨ <code>app.module.ts</code> ä¸­å¼•ç”¨æ¨¡å—ï¼š</font></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">FormsModule</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@angular/forms&quot;</span>;</span><br><span class="line"><span class="attr">imports</span>: [ <span class="title class_">FormsModule</span> ]</span><br></pre></td></tr></table></figure><p>åœ¨å¼•å…¥äº†åŒå‘ç»‘å®šçš„æ¨¡å—ä¹‹åå°±å¯ä»¥è¿›è¡Œä½¿ç”¨äº†ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Angular çš„åŒå‘ç»‘å®š<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">å•å‘ç»‘å®šæµ‹è¯• <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> [<span class="attr">value</span>]=<span class="string">&quot;msg1&quot;</span>&gt;</span> &#123;&#123;msg1&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">åŒå‘ç»‘å®šæµ‹è¯• <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;msg2&quot;</span>&gt;</span> &#123;&#123;msg2&#125;&#125;</span><br></pre></td></tr></table></figure><hr />**è¡¨å•åŒå‘ç»‘å®šå®ä¾‹ï¼š**<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="attr">model</span>:<span class="built_in">object</span> = &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">sex</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">likes</span>: [<span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>],</span><br><span class="line">    <span class="attr">address</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">birthday</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>è¡¨å•&amp;angularäº¤äº’è”ç³»<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    å§“å:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.username&quot;</span>&gt;</span> </span><br><span class="line">    &#123;&#123;model.username&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    æ€§åˆ«ï¼š</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.sex&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sex1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç”·&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;sex1&quot;</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.sex&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sex2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;sex2&quot;</span>&gt;</span>å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span> --- &#123;&#123;model.sex&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    çˆ±å¥½ï¼š</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.likes[0]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è¿åŠ¨&quot;</span> <span class="attr">id</span>=<span class="string">&quot;like1&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;like1&quot;</span>&gt;</span>è¿åŠ¨<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.likes[1]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ¸¸æˆ&quot;</span> <span class="attr">id</span>=<span class="string">&quot;like2&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;like2&quot;</span>&gt;</span>æ¸¸æˆ<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.likes[2]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç¼–ç¨‹&quot;</span> <span class="attr">id</span>=<span class="string">&quot;like3&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;like3&quot;</span>&gt;</span>ç¼–ç¨‹<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    &#123;&#123;model.likes | json&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    ä½å€ï¼š</span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.address&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;æ²ˆé˜³&quot;</span>&gt;</span>æ²ˆé˜³<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;é’å²›&quot;</span>&gt;</span>é’å²›<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;å¤§è¿&quot;</span>&gt;</span>å¤§è¿<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    --- &#123;&#123;model.address&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    ç”Ÿæ—¥ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;model.birthday&quot;</span> &gt;</span></span><br><span class="line">    -- &#123;&#123;model.birthday&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><font color="red">åŒå‘ç»‘å®šåœ¨ form è¡¨å•å†…æ— æ•ˆ</font></p><h3 id="é™æ€èµ„æºè°ƒç”¨é—®é¢˜">é™æ€èµ„æºè°ƒç”¨é—®é¢˜</h3><p>åœ¨ angular çš„ç»„ä»¶æ¨¡æ¿ä¸­è°ƒç”¨é™æ€èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚å›¾ç‰‡å­—ä½“ç­‰ç­‰ï¼Œé¦–å…ˆè¦çŸ¥é“é™æ€èµ„æºå­˜æ”¾ç›®å½•æ˜¯ <code>assets</code> ç›®å½•ä¸‹ï¼Œå¼•ç”¨ä¹Ÿæ— éœ€ä½¿ç”¨ <code>./ æˆ–è€… ../</code> ä¹‹ç±»ï¼Œç›´æ¥è®¿é—®è¯¥ç›®å½•å³å¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ— è§†ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨assetcå³å¯è®¿é—®ç›®æ ‡æ–‡ä»¶å¤¹  --&gt;</span></span><br><span class="line">&lt;/img src=&quot;assets/google.jpg&quot; title=&quot;è¿™æ˜¯ä¸€å¼ å›¾ç‰‡&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡çš„åˆ›å»ºå’Œä½¿ç”¨">æœåŠ¡çš„åˆ›å»ºå’Œä½¿ç”¨</h2><p>åœ¨ angular æœ‰æœåŠ¡è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼Œå¯ä»¥åœ¨æœåŠ¡ä¸­å­˜æ”¾å±æ€§æˆ–æ–¹æ³•ï¼Œå¯ä»¥åœ¨å„ä¸ªç»„ä»¶å¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘å§‘ä¸”æŠŠå®ƒç†è§£ä¸º angular ç‰ˆçš„ vuex</p><p>æœåŠ¡åŒç»„ä»¶ä¸€æ ·ï¼Œéœ€è¦å…ˆåˆ›å»ºä»–ï¼Œåˆ›å»ºæœåŠ¡çš„æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g service æœåŠ¡å</span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨ app ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸¤ä¸ªæœåŠ¡æ–‡ä»¶ï¼Œåˆ›å»ºå®Œæˆåè¿˜ä¸èƒ½ç«‹å³ä½¿ç”¨ï¼Œéœ€è¦åˆ° <code>app.module.ts</code> æ–‡ä»¶ä¸­ import å¼•ç”¨å¹¶åœ¨ providers å¤„æ³¨å†ŒæœåŠ¡ï¼Œè¿™æ ·æ‰å¯ä»¥ä½¿ç”¨è¯¥æœåŠ¡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">GetService</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./service/get/get.service&#x27;</span>;</span><br><span class="line"><span class="attr">providers</span>: [<span class="title class_">GetService</span>],</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æœåŠ¡</strong></p><p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æœåŠ¡ï¼ŒåŒæ ·ä¹Ÿè¦ä½¿ç”¨ import å¼•ç”¨è¯¥æœåŠ¡ï¼Œç„¶åå¯ä»¥ç›´æ¥ new å°†æœåŠ¡å®ä¾‹åŒ–ä½¿ç”¨</p><blockquote><p>å®ä¾‹åŒ–è¦å†å’Œ import åŒçº§ä½ç½®è¿›è¡Œå®ä¾‹åŒ–</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">OnInit</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">GetService</span>&#125; <span class="keyword">from</span> <span class="string">&quot;../service/get/get.service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> get = <span class="keyword">new</span> <span class="title class_">GetService</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-model02&#x27;</span>,</span><br><span class="line">    <span class="attr">templateUrl</span>: <span class="string">&#x27;./model02.component.html&#x27;</span>,</span><br><span class="line">    <span class="attr">styleUrls</span>: [<span class="string">&#x27;./model02.component.css&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Model02Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(get.<span class="property">msg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±é€šè¿‡å®ä¾‹åŒ–å¯¹è±¡çš„æ–¹æ³•ä½¿ç”¨äº†æœåŠ¡ï¼Œä½†æ˜¯ angular å¹¶ä¸æ¨èè¿™ä¹ˆä½¿ç”¨ï¼Œæ‰€ä»¥æ­£å¸¸åº”è¯¥è¿™æ ·ï¼š</p><blockquote><p>åœ¨æ–¹æ³•å†…ä½¿ç”¨ get å±æ€§æ¥ä»£æ›¿ GetService å®ä¾‹åŒ–çš„è¿‡ç¨‹</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> get:GetService</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(get.<span class="property">msg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ„é€ æ–¹æ³•ä¸­å£°æ˜çš„å±æ€§ï¼Œåœ¨å½“å‰å®ä¾‹ä¸­ä»»ä½•ä½ç½®éƒ½å¯ä»¥è°ƒç”¨</li><li>get æœåŠ¡å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶åŒæ—¶ç”Ÿæ•ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªç»„ä»¶å¯¹æœåŠ¡å†…çš„å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªç»„ä»¶ä¼šçœ‹åˆ°ç¬¬ä¸€ä¸ªç»„ä»¶ä¿®æ”¹åçš„å‚æ•°ï¼Œå¯ä»¥å½“æˆ vue ä¸­çš„çŠ¶æ€ç®¡ç†è¿›è¡Œä½¿ç”¨</li></ul><p><strong>æœåŠ¡çš„è°ƒç”¨é—®é¢˜ï¼š</strong></p><ul><li><p>ç»„ä»¶äºæœåŠ¡ä¹‹é—´æ˜¯å•å‘é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶å¯ä»¥è°ƒç”¨æœåŠ¡çš„æ–¹æ³•åŠå±æ€§ï¼Œä½†æ˜¯æœåŠ¡ä¸èƒ½è°ƒç”¨ç»„ä»¶</p></li><li><p>ä½†æ˜¯æœåŠ¡å’ŒæœåŠ¡ä¹‹é—´æ˜¯åŒå‘é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡äºæœåŠ¡ä¹‹é—´å¯ä»¥äº’ç›¸è°ƒç”¨</p></li></ul><h2 id="DOMæ“ä½œåŠç”Ÿå‘½å‘¨æœŸå‡½æ•°">DOMæ“ä½œåŠç”Ÿå‘½å‘¨æœŸå‡½æ•°</h2><h3 id="OnInit-å‡½æ•°">OnInit å‡½æ•°</h3><p>åœ¨ä½¿ç”¨å‘½ä»¤åˆ›å»ºä¸€ä¸ª angular ç»„ä»¶çš„æ—¶å€™ï¼Œts æ–‡ä»¶ä¸­çš„ class ä¼šé»˜è®¤çš„å®ç°ä¸€ä¸ªæ¥å£ï¼š<code>OnInit</code>ï¼Œä¸”å¤å†™äº†å…¶ä¸­çš„ngOnInit åšä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•</p><blockquote><p>ngOninit æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨åŸç”Ÿ dom åŠ è½½å®Œæ¯•åï¼š</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>è¿™æ˜¯ç¬¬ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p2&quot;</span> [<span class="attr">innerText</span>]=<span class="string">&quot;str&quot;</span>&gt;</span>è¿™æ˜¯ç¬¬äºŒä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="attr">str</span>:<span class="built_in">string</span> = <span class="string">&quot;æˆ‘æ˜¯angularä¸­çš„å€¼&quot;</span>;</span><br><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨domæ“ä½œp1</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">p1</span>:<span class="built_in">any</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p1&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">innerText</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨domæ“ä½œp2</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">p2</span>:<span class="built_in">any</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p2&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">innerText</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œåœ¨ ngOnInit æ–¹æ³•ä¸­è·å–çš„ä¸¤ä¸ª dom èŠ‚ç‚¹çš„å†…å®¹ï¼Œéƒ½æ˜¯åŸç”Ÿçš„å†…å®¹ï¼Œä½¿ç”¨ angular å¯¹ p2 è¿›è¡Œçš„èµ‹å€¼å¹¶æ²¡æœ‰è¢« dom è·å–åˆ°ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®åœ¨ ngOnInit æ–¹æ³•ä¸­æ“ä½œ dom</p><h3 id="ngAfterViewInit-å‡½æ•°">ngAfterViewInit å‡½æ•°</h3><p>é‚£ä¹ˆé™¤å¼€ ngOnInit å‡½æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°å°±æ˜¯ <code>ngAfterViewInit</code>ï¼Œä»–å¹¶ä¸æ˜¯ä»æ¥å£ä¸­å¤å†™è€Œæ¥çš„ï¼Œè€Œæ˜¯å½“å‰ class é»˜è®¤è‡ªå¸¦çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</p><blockquote><p>ngAfterViewInit æ‰§è¡Œæ—¶æœºæ˜¯å½“å‰domåŠ è½½å®Œæ¯•ä¸”äºangularç»“åˆå</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>è¿™æ˜¯ç¬¬ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p2&quot;</span> [<span class="attr">innerText</span>]=<span class="string">&quot;str&quot;</span>&gt;</span>è¿™æ˜¯ç¬¬äºŒä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="attr">str</span>:<span class="built_in">string</span> = <span class="string">&quot;æˆ‘æ˜¯angularä¸­çš„å€¼&quot;</span>;</span><br><span class="line">ngAfterViewInit () &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨domæ“ä½œp1</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">p1</span>:<span class="built_in">any</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p1&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">innerText</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨domæ“ä½œp2</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">p2</span>:<span class="built_in">any</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p2&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">innerText</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œå¦‚æœåœ¨å½“å‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸‹æ“ä½œ domï¼Œè·å–åˆ°çš„ p2 çš„å€¼æ˜¯ç»è¿‡ angular å¤„ç†è¿‡çš„å€¼ï¼Œæ‰€ä»¥å¦‚æœåœ¨ç¨‹åºä¸­è¦å¯¹ dom è¿›è¡Œæ“ä½œçš„è¯å»ºè®®åœ¨å½“å‰æ–¹æ³•ä¸‹è¿›è¡Œæ“ä½œ</p><h3 id="ViewChild-æ“ä½œ-DOM">ViewChild æ“ä½œ DOM</h3><p>åœ¨ angular ä¸­æ“ä½œ domï¼Œé™¤å¼€ä½¿ç”¨åŸç”Ÿçš„ js ä»£ç ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ angular æä¾›çš„ <code>ViewChild</code> è¿›è¡Œæ“ä½œ</p><blockquote><p>angular çš„ç»„ä»¶ä¸­é»˜è®¤æ—¶ä¸æ”¯æŒä½¿ç”¨ ViewChild çš„ï¼Œéœ€è¦å…ˆæ·»åŠ ä»–çš„å¼•ç”¨æ‰å¯ä»¥ä½¿ç”¨ï¼Œæ·»åŠ å¼•ç”¨çš„æ–¹æ³•æ˜¯ï¼š</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">OnInit</span>, <span class="title class_">ViewChild</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>å¼•ç”¨æ·»åŠ å®Œæˆåï¼Œå¯¹è¦è·å– dom å¯¹è±¡çš„æ ‡ç­¾ä½¿ç”¨ # è¿›è¡Œæ ‡è¯†</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> #<span class="attr">ps</span> <span class="attr">id</span>=<span class="string">&quot;p2&quot;</span> [<span class="attr">innerText</span>]=<span class="string">&quot;str&quot;</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªpæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è€Œååœ¨ç»„ä»¶ä¸­è·å–å½“å‰èŠ‚ç‚¹çš„ dom å¯¹è±¡ï¼Œè·å–åˆ°ä¹‹åå°±å¯ä»¥å¯¹ä»–è¿›è¡Œæ­£å¸¸çš„ dom æ“ä½œäº†</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="attr">flag</span>:<span class="built_in">string</span> = <span class="string">&quot;æˆ‘æ˜¯angularä¸­çš„å€¼&quot;</span>;</span><br><span class="line"><span class="meta">@ViewChild</span>(<span class="string">&quot;ps&quot;</span>) <span class="attr">ps</span>:<span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">ngAfterViewInit</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ps</span>.<span class="property">nativeElement</span>.<span class="property">innerText</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ol><li>ViewChild å°† dom å¯¹è±¡å°è£…åœ¨äº†è‡ªèº«çš„ nativeElement å±æ€§ä¸­ï¼Œæ“ä½œ dom éœ€è¦å…ˆè°ƒç”¨ä»–</li><li><font color="red">æ— è®ºæ˜¯åŸç”Ÿ js æ“ä½œ dom è¿˜æ˜¯ ViewChild æ“ä½œdomï¼Œéƒ½è¦åœ¨ ngAfterViewInit å‡½æ•°ä¸­ï¼ŒåŸå› æ˜¯ä¸€æ ·çš„</font></li></ol><h3 id="æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°">æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°</h3><p>ä¸Šé¢åªä»‹ç»äº† ngOnInit å’Œ ngAfterViewInit ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä¹Ÿæ˜¯æœ€ä¸ºå¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåœ¨ Angular ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°è¿œä¸æ­¢è¿™ä¸¤ä¸ªï¼Œè¿™é‡Œå°±è¦è¯¦ç»†æ¼”ç¤ºä¸€ä¸‹æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LifeComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">msg</span>:<span class="built_in">string</span> = <span class="string">&quot;ç»„ä»¶ä¸­çš„msg&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1-æ„é€ å‡½æ•°---é™¤äº†ä½¿ç”¨ç®€å•çš„å€¼å¯¹å±€éƒ¨å˜é‡è¿›è¡Œåˆå§‹åŒ–ä¹‹å¤–ï¼Œä»€ä¹ˆéƒ½ä¸åº”è¯¥åš&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">ngOnChanges</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2-ngOnChages--- å½“çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼ æˆ–è¢«ä¼ å…¥åˆ°å­ç»„ä»¶çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3-ngOnInit--- ä¸€èˆ¬å°†åˆå§‹åŒ–æ—¶çš„Ajaxå†™åœ¨è¿™é‡Œ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ngDoCheck</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4-ngDoCheck--- æ£€æµ‹ä½œç”¨ï¼Œå½“å‰å®ä¾‹ä¸­çš„æŸä¸ªå±æ€§è¢«æ”¹å˜æ—¶æ‰§è¡Œ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ngAfterContentInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;5-ngAfterContentInit--- å½“æŠŠå†…å®¹æŠ•å½±è¿›ç»„ä»¶ä¹‹åè°ƒç”¨&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ngAfterContentChecked</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;6-ngAfterContentCheckedæ‰§è¡Œäº†--- æ¯æ¬¡å®Œæˆè¢«æŠ•å½±ç»„ä»¶å†…å®¹çš„å˜æ›´æ£€æµ‹ä¹‹åè°ƒç”¨&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ngAfterViewInit</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;7-ngAfterViewInit---- ç»„ä»¶ï¼Œè§†å›¾åŠå­è§†å›¾åŠ è½½å®Œæ¯•æ‰§è¡Œï¼Œä¸€èˆ¬åœ¨è¿™é‡Œæ“ä½œDOM&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ngAfterViewChecked</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;8-ngAfterViewChecked---- æ¯æ¬¡åšå®Œç»„ä»¶è§†å›¾å’Œå­è§†å›¾çš„å˜æ›´æ£€æµ‹ä¹‹åè°ƒç”¨&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ngOnDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;9-ngOnDestroyæ‰§è¡Œäº†Â·Â·Â·Â·&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">changeMsg</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&quot;æ•°æ®æ”¹å˜äº†&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Angular-ç»„ä»¶é€šä¿¡">Angular ç»„ä»¶é€šä¿¡</h2><p>ç»„ä»¶é€šä¿¡ï¼Œå› ä¸º angular å±äºå•é¡µé¢å¼€å‘ï¼Œé¡µé¢ä¸­çš„æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ä½¿ç”¨ç»„ä»¶è¿›è¡Œæ˜¾ç¤ºçš„ï¼Œä½†æ˜¯æ¯ä¸ªç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¸åŒï¼Œæœ‰æ—¶å€™åˆéš¾å…éœ€è¦å…¶ä»–ç»„ä»¶ä¼ æ¥æ•°æ®æ¥æ‰§è¡Œæœ¬ç»„ä»¶çš„é€»è¾‘ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°ç»„ä»¶é€šä¿¡äº†</p><p>æ‰€è°“çš„çˆ¶å­ç»„ä»¶ï¼Œå‡å¦‚å½“å‰ç¨‹åºä¸­æœ‰ä¸‰ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ Homeï¼ŒHeaderï¼ŒMainï¼Œè´Ÿè´£æ˜¾ç¤ºçš„ç»„ä»¶æ˜¯ Homeï¼Œåœ¨Home ç»„ä»¶ä¸­åˆ†åˆ«å¼•ç”¨å¹¶æ˜¾ç¤ºäº† Headerï¼ŒMainï¼Œè¿™æ—¶ Home å°±æ˜¯ Headerï¼ŒMain çš„çˆ¶ç»„ä»¶ï¼Œ Headerï¼ŒMain ä¹Ÿæ˜¯ Home çš„å­ç»„ä»¶</p><h3 id="çˆ¶ç»„ä»¶è·å–å­ç»„ä»¶æ•°æ®">çˆ¶ç»„ä»¶è·å–å­ç»„ä»¶æ•°æ®</h3><p>åœ¨çˆ¶ç»„ä»¶ä¸­è·å–å­ç»„ä»¶ä¸­çš„å±æ€§æˆ–è€…å‡½æ•°ï¼Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªä¹‹å‰å°±å­¦ä¹ è¿‡çš„çŸ¥è¯†ï¼š<code>ViewChild</code> æ¨¡å—ï¼Œä»–å¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­ä¸»åŠ¨çš„å»è·å–å­ç»„ä»¶ä¸­çš„å±æ€§åŠå‡½æ•°</p><blockquote><p>è·å–å­ç»„ä»¶ä¸­çš„å±æ€§åŠå‡½æ•°</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- çˆ¶ç»„ä»¶åœ¨å¼•ç”¨å­ç»„ä»¶çš„æ—¶å€™ï¼Œä¸ºä»–æ·»åŠ ä¸€ä¸ªViewChildæ ‡è¯† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-header</span> #<span class="attr">son</span>&gt;</span><span class="tag">&lt;/<span class="name">app-header</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sonä»£è¡¨çš„å°±æ˜¯å­ç»„ä»¶çš„å®ä¾‹ï¼Œç„¶ååœ¨çˆ¶ç»„ä»¶ä¸­å°±å¯ä»¥ä½¿ç”¨å­ç»„ä»¶ä¸­çš„å†…å®¹äº†</span></span><br><span class="line"><span class="comment">// å…¶ä¸­çš„goodï¼ŒlogAéƒ½æ˜¯åœ¨å­ç»„ä»¶ä¸­äº‹å…ˆå®šä¹‰å¥½çš„å±æ€§åŠæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="attr">title</span>: <span class="built_in">string</span> = <span class="string">&quot;çˆ¶ç»„ä»¶çš„å‚æ•°&quot;</span>;</span><br><span class="line"><span class="meta">@ViewChild</span>(<span class="string">&quot;son&quot;</span>) <span class="attr">son</span>:<span class="built_in">any</span>;</span><br><span class="line"><span class="title function_">getGood</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">son</span>.<span class="property">good</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getLogA</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">son</span>.<span class="title function_">logA</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­ç»„ä»¶è·å–çˆ¶ç»„ä»¶ä¸­çš„æ•°æ®">å­ç»„ä»¶è·å–çˆ¶ç»„ä»¶ä¸­çš„æ•°æ®</h3><p>å­ç»„ä»¶è·å–çˆ¶ç»„ä»¶éœ€è¦åœ¨å­ç»„ä»¶ä¸­å¼•ç”¨ä¸€ä¸ª <code>Input</code> æ¨¡å—ï¼Œè¿™æ ·å°±å¯ä»¥æ¥å—çˆ¶ç»„ä»¶ä¼ æ¥çš„å‚æ•°äº†</p><blockquote><p>è·å–çˆ¶ç»„ä»¶ä¸­çš„å±æ€§åŠå‡½æ•°</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨å•å‘ç»‘å®šå°†è‡ªå·±ä¼ å…¥ç»™å­ç»„ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-header</span> [<span class="attr">super</span>]=<span class="string">&quot;this&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">app-header</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨Inputè·å–åˆ°çˆ¶ç»„ä»¶ä¼ å…¥çš„å¯¹è±¡å¹¶ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="attr">title</span>:<span class="built_in">string</span>=<span class="string">&quot;undefined&quot;</span>;</span><br><span class="line"><span class="meta">@Input</span>() <span class="attr">super</span>:<span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–çˆ¶ç»„ä»¶ä¿¡æ¯çš„æ–¹æ³•</span></span><br><span class="line"><span class="title function_">getTitle</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = <span class="variable language_">this</span>.<span class="property">super</span>.<span class="property">title</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getLogB</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">super</span>.<span class="title function_">logB</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å­ç»„ä»¶çš„HTMLä»£ç  --&gt;</span></span><br><span class="line">æˆ‘æ˜¯Headerç»„ä»¶: &#123;&#123;title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;getTitle()&quot;</span>&gt;</span>è·å–çˆ¶ç»„ä»¶çš„titleå±æ€§<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;getLogB()&quot;</span>&gt;</span>è·å–çˆ¶ç»„ä»¶çš„logBå‡½æ•°<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="HTTP-æœåŠ¡">HTTP æœåŠ¡</h2><p>åœ¨ angular ä¸­å†…ç½®äº† HTTP æœåŠ¡å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œæƒ³è¦ä½¿ç”¨å®ƒå¿…é¡»è¦åœ¨ <code>app.module.ts</code> æ–‡ä»¶ä¸­å¼•ç”¨å¹¶æ³¨å†Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClientModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="attr">imports</span>: [ ... <span class="title class_">HttpClientModule</span> ... ],</span><br></pre></td></tr></table></figure><blockquote><p>å‘èµ·è¯·æ±‚ç¤ºä¾‹ï¼š</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">HttpClient</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@angular/common/http&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"><span class="keyword">public</span> http: HttpClient</span>) &#123; &#125;</span><br><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getRequest</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">postRequest</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‘èµ·Getè¯·æ±‚</span></span><br><span class="line"><span class="title function_">getRequest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&quot;è¯·æ±‚çš„ç›®æ ‡åœ°å€&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(url).<span class="title function_">toPromise</span>().<span class="title function_">then</span>( <span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>( <span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Error] è¯·æ±‚å¤±è´¥ï¼ å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‘èµ·Postè¯·æ±‚</span></span><br><span class="line"><span class="title function_">postRequest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&quot;è¯·æ±‚çš„ç›®æ ‡åœ°å€&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">post</span>(url).<span class="title function_">toPromise</span>().<span class="title function_">then</span>( <span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>( <span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Error] è¯·æ±‚å¤±è´¥ï¼ å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å°è£…HTTPæœåŠ¡</p></blockquote><p>å…³äº HTTP è¯·æ±‚è¿™é‡Œå°±ä¸è¯¦ç»†è®°ç¬”è®°äº†ï¼Œå°è£…ä¸€ä¸ªé€šç”¨æœåŠ¡æ¥ç®€åŒ–ä¼ å€¼ï¼Œcookie ç­‰è®¾ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°è£…å¥½çš„HTTPæœåŠ¡</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HttpService</span> &#123;</span><br><span class="line"></span><br><span class="line">    public <span class="attr">baseUrl</span>: string = <span class="string">&quot;http://localhost:8080&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private http: HttpClient</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// pathä¸ºè¯·æ±‚çš„è·¯å¾„ï¼Œå’ŒbaseUrlæ‹¼æ¥åå½¢æˆå®Œæˆçš„è¯·æ±‚URL</span></span><br><span class="line">    <span class="title function_">get</span>(<span class="params">path: string, data: any = <span class="literal">null</span></span>)&#123;</span><br><span class="line">        <span class="comment">// withCredentialsï¼šå…è®¸æºå¸¦Cookieï¼Œä¿æŒsessionidä¸€è‡´</span></span><br><span class="line">        <span class="comment">// paramsï¼šè¯·æ±‚æ—¶éœ€è¦æºå¸¦çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">let</span> param = &#123;<span class="attr">withCredentials</span>: <span class="literal">true</span>, <span class="attr">params</span>: data&#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">baseUrl</span> + path, param).<span class="title function_">toPromise</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">post</span>(<span class="params">path: string, data: any = <span class="literal">null</span></span>)&#123;</span><br><span class="line">        <span class="comment">// withCredentialsï¼šå…è®¸æºå¸¦Cookieï¼Œä¿æŒsessionidä¸€è‡´</span></span><br><span class="line">        <span class="comment">// paramsï¼šè¯·æ±‚æ—¶éœ€è¦æºå¸¦çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">let</span> param = &#123;<span class="attr">withCredentials</span>: <span class="literal">true</span>, <span class="attr">params</span>: data&#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">post</span>(<span class="variable language_">this</span>.<span class="property">baseUrl</span> + path, <span class="literal">null</span>, param).<span class="title function_">toPromise</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HomePage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">private http: HttpService</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">login</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res&quot;</span>, res);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">logout</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&quot;/logout&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res&quot;</span>, res);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Angular-çš„è·¯ç”±">Angular çš„è·¯ç”±</h2>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jQueryå­¦ä¹ ç¬”è®°</title>
    <link href="/2021/03/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/jQuery%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/03/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/jQuery%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>jQueryå­¦ä¹ ç¬”è®°</h1><p>jQuery æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´çš„ JS æ¡†æ¶ï¼Œå®ƒå°è£… JS ä¸­å¸¸ç”¨çš„åŠŸèƒ½ä»£ç ï¼Œæä¾›ä¸€ç§ç®€ä¾¿ä½¿ç”¨æ–¹å¼ï¼Œä¼˜åŒ–HTMLæ–‡æ¡£æ“ä½œã€äº‹ä»¶å¤„ç†ã€åŠ¨ç”»è®¾è®¡å’Œ AJAX è¯·æ±‚</p><p>æƒ³è¦åœ¨é¡µé¢ä¸Šä½¿ç”¨ jQuery éœ€è¦æ·»åŠ å¼•ç”¨ï¼š<code>https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js</code></p><blockquote><p>jQueryåˆä½“éªŒ</p></blockquote><ol><li>é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ JS</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æˆ‘ä»¬åœ¨é¡µé¢ä¸Šæƒ³è¦åœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ JS ä»£ç ï¼Œéœ€è¦ä½¿ç”¨windowçš„onload</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/* window.onload = function()&#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        console.log(123);</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">    &#125; */</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// jQueryä¸­ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼š</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">jQuery</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>jQuery çš„ç®€åŒ–å†™æ³•</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æˆ‘ä»¬æ¯æ¬¡ä½¿ç”¨jQueryçš„æ—¶å€™éƒ½éœ€è¦å†™ä¸€é•¿ä¸²çš„å•è¯ï¼Œè®©äººä¸çˆ½</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// è¿™é‡ŒjQueryä¸ºæˆ‘ä»¬æä¾›äº†ç®€åŒ–çš„å†™æ³•ï¼Œå°±æ˜¯ç¾å…ƒç¬¦å·ï¼š$</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ä½¿ç”¨ $ ç¬¦å¯ä»¥ä»£æ›¿jQueryè¿™ä¸ªå•è¯è¿›è¡Œä½¿ç”¨ï¼Œä»¥åä¹Ÿä¼šä½¿ç”¨è¿™ä¸ªç¬¦å·è¿›è¡Œç»ƒä¹ </span></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>æ›¿æ¢ $ ç¬¦å·</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// åœ¨ä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¼•å…¥å¤šä¸ªJSæ–‡ä»¶ï¼Œ$ç¬¦å¯èƒ½ä¼šä¸å…¶ä»–JSæ–‡ä»¶äº§ç”Ÿå†²çª</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é‡æ–°å®šä¹‰ä¸€ä¸ªå˜é‡JQæ¥ä»£æ›¿jQueryè¿™ä¸ªå•è¯ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹jQueryæ˜¯ä»€ä¹ˆ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(jQuery);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// é€šè¿‡æ‰“å°å¾—çŸ¥jQueryå˜é‡å…¶å®æ˜¯ä¸€ä¸ªå…¨å±€çš„å‡½æ•°ï¼Œæƒ³è¦æ›´åçš„è¯åªéœ€è¦åœ¨å®šä¹‰ä¸€ä¸ªå˜é‡èµ‹å€¼è¿™ä¸ªå¼•ç”¨å³å¯</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> <span class="variable constant_">JQ</span> = jQuery;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// é€šè¿‡æ–°çš„å˜é‡æ¥ä»£æ›¿jQueryè¿›è¡Œæ“ä½œ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">JQ</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ä¸Šé¢é‚£ç§æ–¹æ³•ç»æµ‹è¯•å¯è¡Œï¼Œä½†æ˜¯ç½‘ä¸Šæ›´æµè¡Œçš„æ˜¯ç§å†™æ³•ï¼ŒåŒæ ·ä¹Ÿæ˜¯å¯è¡Œçš„</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> <span class="variable constant_">JQ</span> = jQuery.<span class="title function_">noConflict</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">JQ</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é€‰æ‹©å™¨ç»ƒä¹ ">é€‰æ‹©å™¨ç»ƒä¹ </h2><blockquote><p>è®¤è¯†é€‰æ‹©å™¨</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>Pæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ä¸Šé¢æœ‰ä¸€ä¸ªpæ ‡ç­¾idä¸ºp1ï¼Œæˆ‘ä»¬æƒ³è¦è·å–åˆ°ä»–çš„domå¯¹è±¡éœ€è¦ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p1&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·å†™èµ·æ¥ä»£ç å¤ªé•¿äº†ï¼ŒjQuery ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿‡é€‰æ‹©å™¨æ¥è·å– DOM èŠ‚ç‚¹</p><h3 id="åŸºæœ¬é€‰æ‹©å™¨">åŸºæœ¬é€‰æ‹©å™¨</h3><blockquote><p>ä¸‰å¤§åŸºæœ¬é€‰æ‹©å™¨</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>pæ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span> divæ ‡ç­¾ <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sp&quot;</span>&gt;</span>spanæ ‡ç­¾1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sp&quot;</span>&gt;</span>spanæ ‡ç­¾2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p1 = $(<span class="string">&quot;#p1&quot;</span>);     <span class="comment">// IDé€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> div = $(<span class="string">&quot;div&quot;</span>);    <span class="comment">// æ ‡ç­¾é€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> span = $(<span class="string">&quot;.sp&quot;</span>);   <span class="comment">// classé€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¼–ç¨‹å¼é€‰æ‹©å™¨</p></blockquote><p>è¿™é‡Œåªç®€å•å†™äº†å‡ ä¸ªå¸¸ç”¨çš„é€‰æ‹©å™¨ï¼Œä¹‹åæœ‰ç”¨åˆ°çš„éšæ—¶ç™¾åº¦æŸ¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>1<span class="tag">&lt;/<span class="name">p</span>&gt;</span>    <span class="tag">&lt;<span class="name">p</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span>    <span class="tag">&lt;<span class="name">p</span>&gt;</span>3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p4&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>5<span class="tag">&lt;/<span class="name">p</span>&gt;</span>    <span class="tag">&lt;<span class="name">p</span>&gt;</span>6<span class="tag">&lt;/<span class="name">p</span>&gt;</span>    <span class="tag">&lt;<span class="name">p</span>&gt;</span>7<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¿™é‡Œè¦é¢‘ç¹ä½¿ç”¨p4è¿™ä¸ªjQueryå¯¹è±¡ï¼Œè¿™é‡Œå°±æš‚æ—¶å­˜èµ·æ¥äº†</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p = $(<span class="string">&quot;#p4&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p1 = p.<span class="title function_">next</span>(<span class="string">&quot;p&quot;</span>);     <span class="comment">// è·å–ä¸‹ä¸€ä¸ªåŒçº§çš„p</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p2 = p.<span class="title function_">nextAll</span>(<span class="string">&quot;p&quot;</span>);  <span class="comment">// è·å–åé¢æ‰€æœ‰åŒçº§çš„p</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p3 = p.<span class="title function_">prev</span>(<span class="string">&quot;p&quot;</span>);     <span class="comment">// è·å–ä¸Šä¸€ä¸ªåŒçº§çš„p</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p4 = p.<span class="title function_">prevAll</span>(<span class="string">&quot;p&quot;</span>);  <span class="comment">// è·å–æ‰€æœ‰åŒçº§çš„p</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> p5 = p.<span class="title function_">siblings</span>(<span class="string">&quot;p&quot;</span>); <span class="comment">// è·å–åŒçº§æ‰€æœ‰çš„p</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å±‚çº§é€‰æ‹©å™¨">å±‚çº§é€‰æ‹©å™¨</h3><p>jQuery çš„é€‰æ‹©å™¨ä¹Ÿæ”¯æŒå±‚çº§å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å±‚çº§å…³ç³»è·å–æŒ‡å®šçš„ç›®æ ‡å…ƒç´ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>div1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>div2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span></span><br><span class="line">        div3</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>span1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">            span2</span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>span2-1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>span2-2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>span3<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>div3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>div4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> ojb1 = $(<span class="string">&quot;#div&gt;span&quot;</span>);  <span class="comment">// å­é€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> ojb2 = $(<span class="string">&quot;#div span&quot;</span>);  <span class="comment">// åä»£é€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> ojb3 = $(<span class="string">&quot;#div+div&quot;</span>);  <span class="comment">// å…„å¼Ÿé€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> ojb4 = $(<span class="string">&quot;#div~div&quot;</span>);  <span class="comment">// å…„å¼Ÿé€‰æ‹©å™¨</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>obj1ï¼šå­é€‰æ‹©å™¨ï¼šé€‰æ‹©å½“å‰æ ‡ç­¾çš„<em>ä¸‹ä¸€çº§æ ‡ç­¾</em>ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾</li><li>ojb2ï¼šåä»£é€‰æ‹©å™¨ï¼šé€‰æ‹©å½“å‰æ ‡ç­¾ä¸‹<em>æ‰€æœ‰æ ‡ç­¾</em>ä¸­ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾</li><li>ojb3ï¼šå…„å¼Ÿé€‰æ‹©å™¨ï¼š+ è¡¨ç¤ºé€‰æ‹©åŒçº§åé¢<em>ç¬¬ä¸€ä¸ª</em>ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾</li><li>ojb3ï¼šå…„å¼Ÿé€‰æ‹©å™¨ï¼š~ è¡¨ç¤ºé€‰æ‹©åŒçº§åé¢<em>æ‰€æœ‰</em>ç¬¦åˆè°ƒé’±çš„æ ‡ç­¾</li></ul><h3 id="å¸¸ç”¨çš„è¿‡æ»¤é€‰æ‹©å™¨">å¸¸ç”¨çš„è¿‡æ»¤é€‰æ‹©å™¨</h3><p>å½“æˆ‘ä»¬æ— æ³•ç²¾å‡†çš„è·å–åˆ°ç›®æ ‡å…ƒç´ çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨è¿›è¡Œæ“ä½œ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>12<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>34<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>56<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>78<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>90<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ç›´æ¥è·å–liä¼šè¿”å›å¤šä¸ªliï¼Œé€šè¿‡ :firstæ¥è·å–æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªliå…ƒç´ </span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> obj1 = $(<span class="string">&quot;li:first&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åŒ :firstæƒ³æ³•ï¼Œ:lastç”¨äºè·å–æœ€åä¸€ä¸ªå…ƒç´ </span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> obj2 = $(<span class="string">&quot;li:last&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¿”å›æ‰€æœ‰liä¸­ç´¢å¼•ä¸ºå¶æ•°çš„å…ƒç´ ï¼Œ0ä¹Ÿç®—ä½œä¸ºå¶æ•°</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> obj3 = $(<span class="string">&quot;li:even&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åŒ:evenç›¸åï¼Œ:oddç”¨äºå–åŸºæ•° (å¯ä»¥åˆ©ç”¨å¥‡å¶æ•°æ¥åšéš”è¡Œå˜è‰²çš„è¯´)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> obj4 = $(<span class="string">&quot;li:odd&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–ç´¢å¼•å¤§äº2çš„li</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> obj5 = $(<span class="string">&quot;li:gt(2)&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–ç´¢å¼•å°äº2çš„li</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> obj6 = $(<span class="string">&quot;li:lt(2)&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// é€šè¿‡ä¸‹æ ‡è·å–æ‰§è¡Œli</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> obj7 = $(<span class="string">&quot;li:eq(2)&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ›´å¤šé€‰æ‹©å™¨">æ›´å¤šé€‰æ‹©å™¨</h3><p>æ›´å¤šé€‰æ‹©å™¨æˆ‘æ˜¯è®°ä¸è¿‡æ¥äº†ï¼Œè¿™é‡Œåªè®°å½•äº†å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„é€‰æ‹©å™¨ï¼Œéœ€è¦ä½¿ç”¨æ›´å¤šéšæ—¶æŸ¥è¯¢</p><p><code>https://blog.csdn.net/pseudonym_/article/details/76093261</code></p><h2 id="å…ƒç´ æ“ä½œ">å…ƒç´ æ“ä½œ</h2><p>å’Œ JS ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ jQuery å¯¹è±¡è·å–åˆ°è¿™ä¸ªæ ‡ç­¾çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œä¸”æ¯” JS æ“ä½œè¦ä¾¿æ·çš„å¤š</p><h3 id="ä¸€èˆ¬å…ƒç´ æ“ä½œ">ä¸€èˆ¬å…ƒç´ æ“ä½œ</h3><p>ä»¥è¿™æ®µ HTML ä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d1&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æˆ‘æ˜¯title&quot;</span>&gt;</span>å“å‘¦ä¸é”™å“¦<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è·å–æ“ä½œ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–d1çš„å±æ€§titleçš„å€¼</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> title = $(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;title&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–d1æ ‡ç­¾å†…çš„å†…å®¹(ä»…æ–‡æœ¬)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> text = $(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–d1æ ‡ç­¾å†…çš„å†…å®¹(HTMLä¹Ÿä¼šä»¥æ–‡æœ¬æ–¹å¼è¯»å–)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> text = $(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">html</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–d2æ ‡ç­¾å†…çš„æ‰€æœ‰å­æ ‡ç­¾</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> children = $(<span class="string">&quot;#d2&quot;</span>).<span class="title function_">children</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">/* è¿™é‡Œé’ˆå¯¹childrenæ•°ç»„ï¼Œå¯ä»¥ç”¨jQueryçš„eachå‡½æ•°è¿›è¡Œéå† */</span></span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åœ¨åŒ¿åå‡½æ•°ä¸­thisä»£è¡¨çš„å°±æ˜¯æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ </span></span></span><br><span class="line"><span class="language-javascript">        children.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ä½†æ˜¯å¦‚æœä½¿ç”¨çš„æ˜¯ç®­å¤´å‡½æ•°ï¼Œthisçš„æŒ‡å‘å°±ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡å‚æ•°åˆ—è¡¨è·å–ä¿¡æ¯</span></span></span><br><span class="line"><span class="language-javascript">        children.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">index, item</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// ç¬¬ä¸€ä¸ªæ˜¯ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå¯¹åº”ç€æ•°ç»„å†…çš„å…ƒç´ </span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(index, item);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹æ“ä½œ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ä¿®æ”¹d1çš„å±æ€§titleçš„å€¼</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;å“å‘¦ä¸é”™å“¦&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ä¿®æ”¹d1æ ‡ç­¾å†…çš„æ–‡æœ¬(ä¸ä¼šè¢«æ¸²æŸ“ä¸ºHTML)</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;fontæ ‡ç­¾/font&gt;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ä¿®æ”¹d1æ ‡ç­¾å†…çš„æ–‡æœ¬(ä¼šè¢«æ¸²æŸ“ä¸ºHTML)</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;fontæ ‡ç­¾/font&gt;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ä¿®æ”¹d2æ ‡ç­¾ä¸‹ç¬¬äºŒä¸ªspanä¸‹çš„ç¬¬ä¸€ä¸ªimgçš„srcå±æ€§</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#d2&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">children</span>().<span class="title function_">eq</span>(<span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">         .<span class="title function_">children</span>().<span class="title function_">eq</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">// é™¤å¼€attrï¼Œpropä¹Ÿå¯ä»¥æ“ä½œæ ‡ç­¾çš„å±æ€§</span></span></span><br><span class="line"><span class="language-javascript">         .<span class="title function_">prop</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;/img/hello.jpg&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤æ“ä½œ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åˆ é™¤äº†d1çš„titleï¼Œè¿˜å¯ä»¥åˆ é™¤removeClass</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">removeAttr</span>(<span class="string">&quot;title&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åˆ é™¤äº†d2æ ‡ç­¾å†…ç¬¬äºŒä¸ªspanä¸‹çš„ç¬¬ä¸€ä¸ªimgæ ‡ç­¾</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#d2&quot;</span>).<span class="title function_">children</span>().<span class="title function_">eq</span>(<span class="number">1</span>).<span class="title function_">children</span>().<span class="title function_">eq</span>(<span class="number">0</span>).<span class="title function_">remove</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// æ¸…ç©ºd2ä¸‹æ‰€æœ‰çš„æ ‡ç­¾ä»¥åŠæ–‡æœ¬</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#d2&quot;</span>).<span class="title function_">empty</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ æ“ä½œ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// è¿™é‡Œçš®ä¸€ä¸‹</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> <span class="variable constant_">JQ</span> = jQuery;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// jQueryåªæ˜¯éœ€è¦ä¸€ä¸ªåŒ¿åå‡½æ•°è€Œå·²ï¼Œè¿™é‡Œä¼ ä¸€ä¸ªç®­å¤´å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥çš„</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">JQ</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">JQ</span>(<span class="string">&quot;#d1&quot;</span>).<span class="title function_">remove</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–åˆ°d2ä¸‹çš„ç¬¬ä¸€ä¸ªspan</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> span = <span class="title function_">JQ</span>(<span class="string">&quot;#d2&quot;</span>).<span class="title function_">children</span>().<span class="title function_">eq</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">        span.<span class="title function_">text</span>(<span class="string">&quot;ã€åŸå§‹çš„spanã€‘&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// æ·»åŠ åˆ°å†…éƒ¨(è¿½åŠ åœ¨åŸæœ‰å†…å®¹åé¢)</span></span></span><br><span class="line"><span class="language-javascript">        span.<span class="title function_">append</span>(<span class="title function_">JQ</span>(<span class="string">&quot;&lt;button&gt;è¿½åŠ åˆ°spanå†…éƒ¨&lt;/button&gt;&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">JQ</span>(<span class="string">&quot;&lt;button&gt;è¢«è¿½åŠ åˆ°spanå†…éƒ¨&lt;/button&gt;&quot;</span>).<span class="title function_">appendTo</span>(span);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// æ·»åŠ åˆ°å†…éƒ¨(æ·»åŠ åœ¨åŸæœ‰å†…å®¹çš„å‰é¢)</span></span></span><br><span class="line"><span class="language-javascript">        span.<span class="title function_">prepend</span>(<span class="title function_">JQ</span>(<span class="string">&quot;&lt;button&gt;ä»å‰é¢æ·»åŠ åˆ°å†…éƒ¨&lt;/button&gt;&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">JQ</span>(<span class="string">&quot;&lt;button&gt;ä»å‰é¢è¢«æ·»åŠ åˆ°å†…éƒ¨&lt;/button&gt;&quot;</span>).<span class="title function_">prependTo</span>(span);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¿½åŠ åˆ°spanåé¢</span></span></span><br><span class="line"><span class="language-javascript">        span.<span class="title function_">after</span>(<span class="title function_">JQ</span>(<span class="string">&quot;&lt;p&gt;è¿½åŠ åˆ°spanåé¢&lt;/p&gt;&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">JQ</span>(<span class="string">&quot;&lt;p&gt;è¢«è¿½åŠ åˆ°spanåé¢&lt;/p&gt;&quot;</span>).<span class="title function_">insertAfter</span>(span);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// æ·»åŠ åˆ°spanå‰é¢</span></span></span><br><span class="line"><span class="language-javascript">        span.<span class="title function_">before</span>(<span class="title function_">JQ</span>(<span class="string">&quot;&lt;p&gt;æ·»åŠ åˆ°spanå‰é¢&lt;/p&gt;&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">JQ</span>(<span class="string">&quot;&lt;p&gt;è¢«æ·»åŠ åˆ°spanå‰é¢&lt;/p&gt;&quot;</span>).<span class="title function_">insertBefore</span>(span);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ·»åŠ åˆ°å†…éƒ¨å’Œæ·»åŠ åˆ°åŒçº§çš„æ–¹æ³•ï¼Œä»–ä»¬çš„é¡ºåºæ˜¯ç›¸åçš„</p><blockquote><p>æ ·å¼æ“ä½œ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(()=&gt;&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> d1 = $(<span class="string">&quot;#d1&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è®¾ç½®æ ·å¼ã€è·å–æ ·å¼çš„å€¼</span></span></span><br><span class="line"><span class="language-javascript">        d1.<span class="title function_">css</span>(<span class="string">&quot;color&quot;</span>, <span class="string">&quot;red&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(d1.<span class="title function_">css</span>(<span class="string">&quot;color&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è·å–ç›®æ ‡æ ‡ç­¾çš„å®½é«˜</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;width&quot;</span>, d1.<span class="title function_">width</span>());</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;height&quot;</span>, d1.<span class="title function_">height</span>());</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é™¤å¼€è¿™ç§æ–¹å¼æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ jQuery çš„ <code>attr</code> æˆ–è€… <code>prop</code> å‡½æ•°æ¥åŠ¨æ€ä¿®æ”¹æ ‡ç­¾çš„ class æ¥è¾¾åˆ°ä¿®æ”¹æ ·å¼çš„ç›®çš„</p><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>$(â€œ#idâ€).attr(â€œclassâ€, â€œæ ·å¼â€)</td><td>ä¸ºè¯¥æ ‡ç­¾é‡æ–°è®¾ç½®æ ·å¼</td></tr><tr><td>$(â€œ#idâ€).addClass(â€œæ ·å¼â€)</td><td>åœ¨åŸæœ‰çš„ class åŸºç¡€ä¸Šè¿½åŠ æ–°çš„ class</td></tr><tr><td>$(â€œ#idâ€).removeClass(â€œæ ·å¼â€)</td><td>åœ¨åŸæœ‰çš„ class åŸºç¡€ä¸Šç§»é™¤æŒ‡å®šçš„ class</td></tr><tr><td>$(â€œ#idâ€).removeClass()</td><td>è¯¥æ–¹æ³•åœ¨ä¸å†™å‚æ•°çš„æƒ…å†µä¸‹å°†ç§»é™¤æ‰€æœ‰ class</td></tr><tr><td>$(â€œ#idâ€).hasClass(â€œæ ·å¼â€)</td><td>è¯¥æ ‡ç­¾æ˜¯å¦åŒ…å«æŒ‡å®šçš„ class æ ·å¼</td></tr></tbody></table><blockquote><p>å…¶ä»–æ“ä½œ</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¤åˆ¶ä¸æ›¿æ¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(()=&gt;&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> d1 = $(<span class="string">&quot;#d1&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// cloneå¤åˆ¶è¯¥èŠ‚ç‚¹</span></span></span><br><span class="line"><span class="language-javascript">        d1.<span class="title function_">after</span>(d1.<span class="title function_">clone</span>());</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// cloneå¤åˆ¶è¯¥èŠ‚ç‚¹(è¿åŒäº‹ä»¶ä¸€èµ·å¤åˆ¶)</span></span></span><br><span class="line"><span class="language-javascript">        d1.<span class="title function_">after</span>(d1.<span class="title function_">clone</span>(<span class="literal">true</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> d2 = $(<span class="string">&quot;#d2&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¢«æ›¿æ¢çš„æ ‡ç­¾è°ƒç”¨å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">        d2.<span class="title function_">replaceWith</span>($(<span class="string">&quot;&lt;font id=&#x27;font&#x27; color=&#x27;blue&#x27;&gt;æˆ‘æ¥æ›¿æ¢è¿™ä¸ªæ ‡ç­¾&lt;/font&gt;&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// æ›¿æ¢åçš„æ ‡ç­¾è°ƒç”¨å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;è¿™é‡Œåœ¨æ›¿æ¢ä¸€æ¬¡&lt;/font&gt;&quot;</span>).<span class="title function_">replaceAll</span>($(<span class="string">&quot;#font&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è¡¨å•å…ƒç´ æ“ä½œ">è¡¨å•å…ƒç´ æ“ä½œ</h3><p>ä¹‹å‰è”ç³»äº†æ™®é€šæ ‡ç­¾çš„ä¸€äº›æ“ä½œï¼Œç„¶åæ¥ç»ƒä¹ ä¸€ä¸‹åŸºäº form è¡¨å•ä¸­çš„æ ‡ç­¾çš„æ“ä½œ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¿™ä¸ªæ˜¯è¡¨å•ä»£ç  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span><br><span class="line">        å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        è´¦å·ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;account&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        å¯†ç ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        æ€§åˆ«ï¼š</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç”·&quot;</span>/&gt;</span> ç”·</span><br><span class="line">        <span class="symbol">&amp;nbsp;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>/&gt;</span> å¥³</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        çˆ±å¥½ï¼š</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ¸¸æ³³&quot;</span> /&gt;</span> æ¸¸æ³³</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥èº«&quot;</span> /&gt;</span> å¥èº«</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¡æ‹‰OK&quot;</span> /&gt;</span> å¡æ‹‰OK</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;likes&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¤§ä¿å¥&quot;</span> /&gt;</span> å¤§ä¿å¥</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        ä½å€ï¼š</span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>åŒ—äº¬<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>ä¸Šæµ·<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>å¹¿ä¸œ<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>æ·±åœ³<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>æäº¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¿™ä¸ªæ˜¯jQueryä»£ç  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(()=&gt;&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// åŠ¨æ€è®¾ç½®è¡¨å•çš„æäº¤å‚æ•°</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> form = $(<span class="string">&quot;#form&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        form.<span class="title function_">attr</span>(<span class="string">&quot;action&quot;</span>, <span class="string">&quot;http://www.baidu.com&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        form.<span class="title function_">attr</span>(<span class="string">&quot;method&quot;</span>, <span class="string">&quot;post&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// å°è¯•è·å–äº†è¡¨å•ä¸­çš„å€¼ï¼Œç„¶åæäº¤äº†è¡¨å•</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> button = $(<span class="string">&quot;button&quot;</span>).<span class="title function_">eq</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åŠ¨æ€ç»‘å®šå•å‡»äº‹ä»¶ï¼Œæäº¤è¡¨å•</span></span></span><br><span class="line"><span class="language-javascript">        button.<span class="title function_">click</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> id = $(<span class="string">&quot;#form input[type=&#x27;hidden&#x27;]&quot;</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> name = $(<span class="string">&quot;#form input[type=&#x27;text&#x27;]&quot;</span>).<span class="title function_">eq</span>(<span class="number">0</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> accunt = $(<span class="string">&quot;#form input[type=&#x27;text&#x27;]&quot;</span>).<span class="title function_">eq</span>(<span class="number">1</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> password = $(<span class="string">&quot;#form input[name=&#x27;password&#x27;]&quot;</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> gender = $(<span class="string">&quot;#form input[name=&#x27;gender&#x27;]:checked&quot;</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> address = $(<span class="string">&quot;#form select&gt;option:selected&quot;</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> likes = [];</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;#form input[name=&#x27;likes&#x27;]:checked&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                 .<span class="title function_">each</span>(<span class="function">(<span class="params">index, item</span>)=&gt;</span>likes.<span class="title function_">push</span>($(item).<span class="title function_">val</span>()));</span></span><br><span class="line"><span class="language-javascript">            form.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="äº‹ä»¶å‡½æ•°">äº‹ä»¶å‡½æ•°</h2><h2 id="ç‰¹æ•ˆå’ŒåŠ¨ç”»">ç‰¹æ•ˆå’ŒåŠ¨ç”»</h2><h2 id="DOMéå†">DOMéå†</h2><h2 id="AJAXè¯·æ±‚">AJAXè¯·æ±‚</h2>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jQuery</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringMVCå­¦ä¹ ç¬”è®°</title>
    <link href="/0202/06/13/SpringMVC%E7%AC%94%E8%AE%B0/"/>
    <url>/0202/06/13/SpringMVC%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1>SpringMVC ç¬”è®°</h1><p>SpringMVCæ˜¯åŸºäºMVCå¤„ç†æ¨¡å¼çš„webæ¡†æ¶ï¼Œåˆ†ç¦»äº† æ§åˆ¶å™¨ - æ¨¡å‹å¯¹è±¡ - è¿‡æ»¤å™¨ ä»¥åŠå¤„ç†ç¨‹åºå¯¹è±¡</p><p>SpringMVCçš„å·¥ä½œæµç¨‹:</p><ol><li>å®¢æˆ·ç«¯é€šè¿‡æµè§ˆå™¨å‘å‡ºè¯·æ±‚ï¼Œé€šè¿‡web.xmlçš„é…ç½®è°ƒç”¨DispatcherServlet ( æ ¸å¿ƒå¤„ç†å™¨ ) æ¥æ”¶è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚äº¤ç»™å¤„ç†å™¨æ˜ å°„å™¨å¤„ç†</li><li>æ˜ å°„å™¨ ( BeanNameUrlHandlerMapping ) é€šè¿‡è¯·æ±‚çš„urlåœ°å€è§£æå‡ºæ˜ å°„å…³ç³»ï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰ç¬¦åˆè§„åˆ™çš„Beanï¼Œç„¶åå°†æ˜ å°„å…³ç³»è¿”è¿˜ç»™æ ¸å¿ƒå¤„ç†å™¨ï¼Œç”±æ ¸å¿ƒå¤„ç†å™¨å°†æ˜ å°„å…³ç³»äº¤ç»™æ˜ å°„å™¨<br>3. é€‚é…å™¨ ( SimpleControllerHandlerAdapter ) æ ¸å¿ƒå¤„ç†å™¨ï¼Œåº•å±‚ä½¿ç”¨äº†instanceOfæŠ€æœ¯ï¼Œä¸»è¦æ˜¯åˆ¤æ–­å¯¹åº”æ˜ å°„å…³ç³»çš„Beanæ˜¯å¦ç»§æ‰¿äº†Controlleræ¥å£ï¼Œç¬¦åˆåˆ™è°ƒç”¨å¯¹åº”çš„Beanæ‰§è¡Œå¯¹åº”é€»è¾‘ï¼Œå¹¶å°†ç»“æœè¿”è¿˜ç»™é€‚é…å™¨ï¼Œç„¶åè¿”è¿˜ç»™æ ¸å¿ƒå¤„ç†å™¨</li><li>æ ¸å¿ƒå¤„ç†å™¨è°ƒç”¨è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰é€‚é…å™¨è¿”è¿˜çš„ç»“æœè¿›è¡Œè§£æï¼Œè§£æä¸ºViewè¿”è¿˜ç»™å¤„ç†å™¨</li><li>æ ¸å¿ƒå¤„ç†å™¨è°ƒç”¨Viewå°†æ¨¡å‹æ•°æ®æ¸²æŸ“ä¸ºè§†å›¾</li><li>æ ¸å¿ƒå¤„ç†å™¨å‘å®¢æˆ·ç«¯åšå‡ºå“åº”</li></ol><blockquote><p>åœ¨ä½¿ç”¨ springmvc ä¹‹å‰éœ€è¦åœ¨ maven ä¸­å¼•å…¥ç›®æ ‡ä¾èµ–ï¼š</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬”è®°å°†åŸºäº springmvc 5.1.5 è®°å½•</p><h2 id="MVCçš„ä¸¤ç§å®ç°æ–¹å¼">MVCçš„ä¸¤ç§å®ç°æ–¹å¼</h2><h3 id="XMLé…ç½®MVC">XMLé…ç½®MVC</h3><blockquote><p>é…ç½® web.xml</p></blockquote><p>åœ¨ web.xml ä¸­é…ç½® mvc çš„ DispatcherServlet çš„æ˜ å°„è·¯å¾„ä¸º <strong>/</strong> ( æ‰€æœ‰è¯·æ±‚ )ï¼Œè®©æ‰€æœ‰è¯·æ±‚éƒ½äº¤ç»™ mvc æ ¸å¿ƒæ§åˆ¶å™¨è¿›è¡Œå¤„ç†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- init-paramæ ‡ç­¾ç”¨æ¥æŒ‡å®šmvcæ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨é…ç½® web.xml çš„æ—¶å€™å¯ä»¥ä¸ç”¨é…ç½® init-param ï¼Œä»–ä¼šé»˜è®¤çš„å» WEB-INF ç›®å½•ä¸‹æ‰¾é…ç½®æ–‡ä»¶ï¼Œè¿™æ—¶å€™æ–‡ä»¶åå¿…é¡»æ˜¯ <code>servlet-name</code> æ ‡ç­¾å†…çš„å€¼ï¼Œä¸”åé¢å¿…é¡»åŠ ä¸Š-servletï¼Œä¾‹å¦‚ springmvc-servlet.xml</p><blockquote><p>é…ç½® springmvc</p></blockquote><p>å®šä¹‰äº†æ˜ å°„å™¨åŠé€‚é…å™¨ï¼Œå°†è‡ªå·±ä¹¦å†™çš„å®ç°äº†Controllerçš„æ§åˆ¶å™¨ç±»è£…é…åœ¨Beanä¸­ï¼Œæ˜ å°„å™¨å’Œé€‚é…å™¨æ˜¯å¯ä»¥çœç•¥ä¸å†™çš„ï¼Œä»–æœ‰è‡ªå·±çš„é»˜è®¤é…ç½®ï¼Œå¦‚æœå†™äº†å…¶ä¸­çš„ä¸€ä¸ªï¼Œé‚£ä¹ˆå»ºè®®å¦ä¸€ä¸ªä¸€å®šè¦å†™ä¸Š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¤„ç†æ˜ å°„å…³ç³»--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é€‚é…å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™æ§åˆ¶å™¨ç±»</p></blockquote><p>æ§åˆ¶å™¨å°±æ˜¯ mvc ä¸ºæˆ‘ä»¬å°è£…å¥½çš„ web ä¸­çš„ servlet ç±»ï¼Œä»–å¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ï¼Œçœå»äº†æˆ‘ä»¬åœ¨ web å¼€å‘ä¸­è¾ƒä¸ºéº»çƒ¦çš„ web.xml é…ç½®ç­‰ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">handleRequest</span><span class="params">(HttpServletRequest request,                                   HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    System.out.println(<span class="string">&quot;æ§åˆ¶å™¨è¢«æˆåŠŸæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    model.addObject(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;con1 goto index.jsp&quot;</span>);</span><br><span class="line">    model.setViewName(<span class="string">&quot;index.jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ModelAndView ç±»ï¼š<ul><li>ç”¨æ¥è´Ÿè´£ mvc ä¸­ä¸»è¦çš„é€»è¾‘ï¼Œå…¶ä¸­ setViewName æ–¹æ³•ç»è¿‡è§†å›¾è§£æå™¨åå°±æ˜¯è½¬å‘çš„ç›®æ ‡è·¯å¾„</li><li>addObject æ–¹æ³•å°±ç±»ä¼¼ request ä¸­çš„ setAttribute æ–¹æ³•</li></ul></li></ul><h3 id="æ³¨è§£é…ç½®MVC">æ³¨è§£é…ç½®MVC</h3><p>æ³¨è§£é…ç½® springmvc ç›¸æ¯”é…ç½®æ–‡ä»¶æ¥è¯´æ›´ä¸ºç®€å•ï¼Œå»ºè®®é‡æ–°å¼€ä¸ªé¡¹ç›®æ¥å†™</p><blockquote><p>é‡å†™é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼€å¯æ³¨è§£é…ç½®mvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scanæ‰«ææ³¨è§£æ‰€åœ¨çš„åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;club.hanzhe.web&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ§åˆ¶å™¨ç±»ä»£ç ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Con1</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/main&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">method01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;mvc function run&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨äº† <code>@Controller</code> æ³¨è§£ï¼Œè¡¨æ˜å½“å‰ç±»æ˜¯æ§åˆ¶å™¨ç±»ã€‚</li><li>æ¯ä¸ªæ–¹æ³•ä¸Šéƒ½å¯ä»¥ä½¿ç”¨ <code>@RequestMapping</code> æ¥æŒ‡å®šç›®æ ‡è®¿é—®è·¯å¾„</li></ol><h2 id="MVC-çš„è§†å›¾è§£æå™¨">MVC çš„è§†å›¾è§£æå™¨</h2><p>åœ¨æ¯ä¸ªæ§åˆ¶å™¨ä¸­ä¼šè¿”å› ModelAndView çš„å®ä¾‹ï¼Œè¿™äº›è¿”å›çš„å®ä¾‹ä¼šè¢«è§†å›¾è§£æå™¨æ¥å—å¹¶è§£æå¤„ç†ï¼ŒsetViewName ä¼šè¢«è§£æä¸ºè·¯å¾„æ‹¼æ¥åˆ°è§†å›¾è§£æå™¨ä¸­ï¼ŒaddObject ä¸­çš„æ•°æ®ä¼šè¢«å°è£…åˆ°ç›®æ ‡è·¯å¾„çš„ request åŸŸä¸­</p><p>è§†å›¾è§£æå™¨é…ç½®ä¸­çš„é…ç½®åŠæœ€å¸¸ç”¨çš„ä¸¤ä¸ªå±æ€§</p><ul><li>prefixï¼šæ˜¯è§£æè§†å›¾åç§°åæ‹¼æ¥åœ¨å‰é¢çš„å‰ç¼€ï¼Œ<strong>/</strong> ä»£è¡¨ç›®æ ‡è§†å›¾åœ¨æ ¹ç›®å½•</li><li>suffixï¼šæ˜¯è§£æè§†å›¾åç§°åæ‹¼æ¥åœ¨åé¢çš„åç¼€ï¼Œ.jsp ä»£è¡¨è§£æåä¸º jsp è§†å›¾</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è¯·æ±‚å‚æ•°ç»‘å®š">è¯·æ±‚å‚æ•°ç»‘å®š</h2><h3 id="ç®€å•ç±»å‹ç»‘å®š">ç®€å•ç±»å‹ç»‘å®š</h3><p>æƒ³è¦ä»€ä¹ˆåå­—ï¼Œä»€ä¹ˆç±»å‹çš„å‚æ•°ï¼Œç›´æ¥å†™åœ¨å¤„ç†è¯·æ±‚çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå˜é‡åè¦ä¸è¯·æ±‚å‚æ•°è¡¨å•çš„ name å€¼ç›¸åŒ</p><p>ä¾‹å¦‚ï¼šlocalhost:8080/Day01/1.action?user=abc</p><p>è¿™æ—¶è¡¨å•ä¼ æ¥çš„æ•°æ®ä¸­ name ä¸º userï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;1&quot;)</span> <span class="comment">// ç®€å•å‚æ•°ç»‘å®šï¼Œå˜é‡åéœ€è¦ä¸è¡¨å•çš„nameç›¸åŒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">( String user )</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰“å°æµ‹è¯•</span></span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure><p>å¦‚æœå‚æ•°åˆ—è¡¨å’Œæäº¤çš„è¡¨å•çš„ name ä¸åŒï¼Œéœ€è¦ä½¿ç”¨æ³¨è§£è·å–æŒ‡å®š name çš„å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚åœ°å€ï¼š localhost:8080/username=zhang</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test</span><span class="params">( <span class="meta">@RequestParam(&quot;username&quot;)</span>String name )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;è·å–åˆ°çš„å€¼ï¼š&quot;</span> + name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="pojoç±»å‹ç»‘å®š">pojoç±»å‹ç»‘å®š</h3><p>åŒç®€å•ç±»å‹ç»‘å®šä¸€è‡´ï¼Œç›´æ¥å†™åœ¨å‚æ•°åˆ—è¡¨ä¸­å³å¯ï¼Œè¯·æ±‚å‚æ•°ä¸­ä¼šå¯¹åº”æŒ‡å®špojoä¸­å±æ€§çš„å˜é‡åï¼Œä½†æ˜¯å¦‚æœæƒ³è¦èµ‹å€¼æˆåŠŸï¼Œéœ€è¦pojoå¯¹å…¶ä¸­æ¯ä¸ªå˜é‡æä¾›æ­£ç¡®çš„Setæ–¹æ³•</p><p>ä¾‹å¦‚ï¼šlocalhost:8080/Day01/1.action?name=zhang&amp;pwd=hanzhe&amp;age=123</p><p>è¡¨å•ä¸­ä¼ æ¥çš„æ•°æ®ï¼Œå…¶ä¸­nameå’Œpwdæ˜¯pojoä¸­çš„å±æ€§ï¼Œè€Œageæ˜¯å‚æ•°åˆ—è¡¨ä¸­çš„å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;1&quot;)</span> <span class="comment">// pojoç±»å‹å‚æ•°ç»‘å®šï¼Œéœ€è¦pojoä¸­æœ‰å¯¹åº”çš„å±æ€§ï¼Œä¸”æœ‰setæ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">( User user , Integer age )</span> &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    System.out.println(<span class="string">&quot;æµ‹è¯•æ•°æ® = &quot;</span> + age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Dateç±»å‹ç»‘å®š">Dateç±»å‹ç»‘å®š</h3><p>Dateæ—¶é—´ç±»å‹åœ¨ç»‘å®šçš„æ—¶å€™éœ€è¦æ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼šã€@DateTimeFromat( pattren = â€œâ€ ) Date dã€‘ï¼Œè¿™æ ·å°±å¯ä»¥è®©å­—ç¬¦ä¸²ç±»å‹çš„æ—¶é—´æŒ‰ç…§æŒ‡å®šçš„ç±»å‹è½¬æ¢ä¸ºDateå¯¹è±¡</p><p>ä¾‹å¦‚ï¼šlocalhost:8080/Day01/1.action?date=2012-12-25</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;1&quot;)</span> <span class="comment">// dateç±»å‹æ•°æ®ç»‘å®š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">( <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> Date date )</span> &#123;</span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>().format(date));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RequestMapping">@RequestMapping</h2><p>ç”¨æ¥å®šä¹‰æ˜ å°„è·¯å¾„ï¼Œå¯ä»¥å®šä¹‰åœ¨æ–¹æ³•ä¸Šï¼Œè®©è¯·æ±‚ä»…å¯¹å½“å‰æ–¹æ³•æœ‰æ•ˆï¼Œä¹Ÿå¯ä»¥å®šä¹‰åœ¨ç±»ä¸Šï¼Œåšä¸ºæ–¹æ³•çš„ä¸Šçº§è·¯å¾„</p><p>@RequestMappingæœ‰å¾ˆå¤šå±æ€§ï¼Œå¯ä»¥ç­›é€‰é«˜çº§è¯·æ±‚ï¼š</p><ol><li>valueå±æ€§ï¼šä»£è¡¨è®¿é—®çš„è·¯å¾„åœ°å€ï¼Œåœ¨æ²¡æœ‰ç¬¬äºŒä¸ªå±æ€§å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¯çœç•¥ä¸å†™</li><li>pahtå±æ€§ï¼šä½œç”¨ç­‰åŒäºvalueï¼Œvalueå’Œpathå±æ€§ä¸å…è®¸åŒæ—¶å‡ºç°åŒä¸€ä¸ªRequestMappingä¸­</li><li>methodå±æ€§ï¼šæ˜¯ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¯ä»¥å¯¹è¯·æ±‚æ–¹æ³•è¿›è¡Œæ‹¦æˆªï¼Œä¾‹å¦‚åªå…è®¸ get post è¯·æ±‚æ‰å¯ä»¥è®¿é—®</li><li>paramså±æ€§ï¼šæ˜¯ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¯ä»¥å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œçº¦æŸï¼Œä¾‹å¦‚è®¿é—®è¯¥è¯·æ±‚å¿…é¡»æºå¸¦ name pwd å‚æ•°ï¼Œ</li></ol><h4 id="å¸¸è§çš„ä¸‰ç§è¯·æ±‚æ–¹æ³•">å¸¸è§çš„ä¸‰ç§è¯·æ±‚æ–¹æ³•</h4><ol><li><p>å«æœ‰å ä½ç¬¦ã€?ã€‘è®¿é—®è·¯å¾„</p><p>â€‹ ä¹¦å†™æ–¹å¼ï¼špaht = â€œ**?**oâ€</p><p>â€‹ è®¿é—®æ–¹å¼ï¼šlocalhost:8080/Day01/**?**o.action</p><p>â€‹ æ³¨æ„ï¼šï¼Ÿä»£è¡¨çš„æ˜¯å•ä¸ªå ä½ç¬¦ï¼Œo.actionå‰é¢ä¸èƒ½ç•™ç©ºï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå­—ç¬¦</p></li><li><p>å«æœ‰é€šé…ç¬¦ã€*ã€‘è®¿é—®è·¯å¾„</p><p>â€‹    ä¹¦å†™æ–¹å¼ï¼špath = â€œ*****oâ€</p><p>â€‹    è®¿é—®æ–¹å¼ï¼šlocalhost:8080/Day01/*****o.action</p><p>â€‹    æ³¨æ„ï¼š* ä»£è¡¨0ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ï¼Œo.actionæˆ–15416516o.actionéƒ½å¯ä»¥è®¿é—®çš„åˆ°</p></li><li><p>å‚æ•°è®¿é—®è·¯å¾„ï¼š{ }</p><p>â€‹    ä»¥å‚æ•°åˆ—è¡¨åšä¸ºè·¯å¾„ï¼Œæ¯ä¸ªå‚æ•°éœ€è¦ç”¨{ }æ‹¬èµ·æ¥</p><p>â€‹    ä¹¦å†™æ–¹å¼ï¼špath = â€œ{name}/{pwd}/{age}â€</p><p>â€‹ è®¿é—®æ–¹å¼ï¼šlocalhost:8080/Day01/zhang/hanzhe/20.action</p><ol><li>æƒ³è¦è·å–åˆ°ä¼ å…¥çš„å€¼éœ€è¦åœ¨å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ æ³¨è§£@PathVariable**ï¼Œ<strong>ä¾‹å¦‚ï¼špublic void test(</strong>@PathVariable**(â€œnameâ€)String name , â€¦â€¦)</li></ol></li><li><p>åœ¨ä½¿ç”¨å‚æ•°è®¿é—®è·¯å¾„çš„åŒæ—¶ä¹Ÿå¯ä»¥è·å–è¡¨å•çš„å€¼ï¼Œä½¿ç”¨**@RequestParam**æ³¨è§£å°±å¯ä»¥è·å–ï¼Œä¸”è¯¥æ³¨è§£å¯ä»¥çœç•¥ä¸å†™</p></li></ol><h3 id="è½¬å‘ä¸é‡å®šå‘">è½¬å‘ä¸é‡å®šå‘</h3><p>åœ¨ SpringMVC ä¸­é€šè¿‡è§†å›¾è§£æå™¨æ‹¼æ¥çš„å­—ç¬¦ä¸²å¯ä»¥åšä¸ºè·¯å¾„è®¿é—®å®ç°ç½‘é¡µè·³è½¬åŠŸèƒ½ï¼ŒåŸºäºè§†å›¾è§£æå™¨çš„ç½‘é¡µè·³è½¬ä½¿ç”¨çš„æ˜¯è½¬å‘çš„æœºåˆ¶ï¼Œæƒ³è¦å®ç°é‡å®šå‘çš„æ–¹æ³•æœ‰ä¸¤ç§æ–¹æ³•</p><p><strong>1. é€šè¿‡è¯·æ±‚ä¸å“åº”</strong></p><p>å¯ä»¥åœ¨å¤„ç†å™¨æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­è‡ªè¡Œæ·»åŠ  HttpServletRequest å’Œ HttpServletResponse å‚æ•°è¿›è¡Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(HttpServletRequest req, HttpServletResponse resp, Model model)</span> </span><br><span class="line">       <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// æºå¸¦å‚æ•°</span></span><br><span class="line">    model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;æºå¸¦çš„è½¬å‘å‚æ•°&quot;</span>);</span><br><span class="line">    <span class="comment">// è½¬å‘åˆ°æŒ‡å®šé¡µé¢</span></span><br><span class="line">    req.getRequestDispatcher(<span class="string">&quot;list.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    <span class="comment">// é‡å®šå‘åˆ°æŒ‡å®šé¡µé¢</span></span><br><span class="line">    resp.sendRedirect(<span class="string">&quot;list.jsp&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. é€šè¿‡ MVC çš„ String è¿”å›å€¼</strong></p><p>åœ¨å½“å¤„ç†å™¨æ–¹æ³•ä¸º String ç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥æ§åˆ¶é¡µé¢è·³è½¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/tiao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¿”å›listå­—ç¬¦ä¸²ï¼Œç»è¿‡è§†å›¾è§£æå™¨åæ‹¼æ¥è·¯å¾„ï¼Œä¸ºè½¬å‘æ•ˆæœ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">    <span class="comment">// åŠ ä¸Šforwardå‰ç¼€ï¼ŒæŒ‡å®šé¡µé¢è·³è½¬ä¸ºè½¬å‘å½¢å¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:list.jsp&quot;</span>;</span><br><span class="line">    <span class="comment">// åŠ ä¸Šredirectå‰ç¼€ï¼ŒæŒ‡å®šé¡µé¢è·³è½¬ä¸ºé‡å®šå‘å½¢å¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:list.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å“åº”æ•°æ®çš„æ–¹æ³•">å“åº”æ•°æ®çš„æ–¹æ³•</h2><p><strong>1. è¯·æ±‚å‚æ•°çš„å“åº”è·¯å¾„è®¾ç½®ï¼š</strong></p><p>åœ¨é€šè¿‡æ³¨è§£è¿›è¡Œå¤„ç†è¯·æ±‚ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•çš„æ—¶å€™å¯ä»¥æŒ‡å®šè¿”å›å€¼ç±»å‹ä¸ºStringç±»å‹ï¼Œé€šè¿‡è§†å›¾è§£æå™¨å°†å­—ç¬¦ä¸²æ‹¼æ¥ä¸ºèµ„æºå</p><p><strong>2. è¯·æ±‚å‚æ•°çš„é»˜è®¤é»˜è®¤è·¯å¾„ï¼š</strong></p><p>ä½†æ˜¯åœ¨å¹¶æ²¡æœ‰æŒ‡å®šä»–è·³è½¬åˆ°æŸä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼Œé€šè¿‡é…ç½®è§†å›¾è§£æå™¨ä¼šé»˜è®¤æŒ‡å®šä¸€ä¸ªèµ„æºï¼Œå°±æ˜¯ä»¥å½“å‰è·¯å¾„ä¸ºåŸºç¡€çš„jspæ–‡ä»¶</p><p>ä¾‹å¦‚è¯·æ±‚ï¼š<code>localhost:8080/Day02/demo2/1.do</code>æ—¶ï¼Œä»–ä¼šé»˜è®¤è·³è½¬åˆ°<code>localhost:8080/Day02/demo2/1.jsp</code>èµ„æºä¸‹ï¼Œä¸”åˆ©ç”¨çš„æ—¶è½¬å‘çš„æŠ€æœ¯</p><p>åœ¨ä»–è½¬å‘è¿›è¡Œè½¬å‘çš„æ—¶å€™ï¼Œå°±å¯ä»¥æºå¸¦ä¸€äº›å‚æ•°</p><h3 id="ç»‘å®šWebå‚æ•°">ç»‘å®šWebå‚æ•°</h3><p>å¯ä»¥åœ¨å¤„ç†è¯·æ±‚çš„æ–¹æ³•ä¸Šç›´æ¥ä¹¦å†™è¯·æ±‚å’Œç›¸åº”å¯¹åº”çš„å¯¹è±¡ï¼Œå°±åƒdoGetå’ŒdoPostä¸€æ ·</p><ol><li><p>è¦ä½¿ç”¨Requestæˆ–Responseå¯¹è±¡ï¼Œç›´æ¥åœ¨å‚æ•°åˆ—è¡¨ä¸­ä¹¦å†™å³å¯ï¼Œç±»ä¼¼doGetæˆ–è€…doPost</p></li><li><p>ä½¿ç”¨Cookieçš„è¯ï¼Œå¯ä»¥åœ¨å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨@CookieValueçš„æ³¨è§£ï¼Œåé¢è·Ÿä¸ŠObject oç”¨æ¥å­˜å‚¨ä»–å¯¹åº”çš„Valueï¼Œä»–æœ‰ä¸‰ä¸ªä¸»è¦çš„å±æ€§ï¼š</p><ol><li>nameï¼šcookieçš„nameå€¼ï¼Œé€šè¿‡nameå¯ä»¥è·å–åˆ°å¯¹åº”çš„valueå€¼</li><li>requiredï¼šæ˜¯ä¸ªbooleanå€¼ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™ä»£è¡¨å½“å‰nameæ˜¯å¿…å¤‡æ¡ä»¶ï¼Œfalseåˆ™æ˜¯å¯æœ‰å¯æ— çš„æ¡ä»¶</li><li>defaultValueï¼šæ²¡æœ‰è·å–åˆ°å½“å‰Cookieçš„æƒ…å†µä¸‹è®¾ç½®çš„é»˜è®¤å€¼ï¼Œå¯ä»¥é¿å…å› ä¸ºrequiredæ‰€äº§ç”Ÿçš„å¼‚å¸¸</li></ol></li><li><p>CookieåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡requestå¯¹è±¡è·å–ï¼Œconfigï¼Œcontextï¼Œsessionç­‰éƒ½æ˜¯å¦‚æ­¤</p></li></ol><h3 id="å“åº”æ•°æ®å¯¹è±¡">å“åº”æ•°æ®å¯¹è±¡</h3><p><strong>1. Mapé›†åˆæ–¹å¼å“åº”æ•°æ®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;1&quot;)</span> <span class="comment">// Mapé›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">( Map&lt;String , String&gt; map )</span> &#123;</span><br><span class="line">    map.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;Mapå“åº”çš„æ•°æ®&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. Modelæ¨¡å‹å“åº”æ•°æ®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;2&quot;)</span> <span class="comment">// Modelæ¨¡å‹</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test2</span><span class="params">( Model model )</span> &#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;Modelå“åº”çš„æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;demo3/1&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><strong>3. ModelMapå“åº”æ•°æ®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;3&quot;)</span> <span class="comment">// Mapé›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test3</span><span class="params">( ModelMap mm )</span> &#123;</span><br><span class="line">    mm.addAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;ModelMapå“åº”çš„æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;demo3/1&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4. ModelAndViewå“åº”æ•°æ®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;4&quot;)</span> <span class="comment">// Mapé›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">test4</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;demo3/1&quot;</span>);</span><br><span class="line">    mod.addObject(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;ModelAndViewå“åº”çš„æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="comment">// mod.setViewName(&quot;demo3/1&quot;);</span></span><br><span class="line">    <span class="keyword">return</span> mod;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°ç»†èŠ‚ï¼š</p><ol><li>ä¹‹å‰ä¸‰ä¸ªå“åº”æ•°æ®çš„æ–¹å¼éƒ½æ˜¯é€šè¿‡è¿”å›Stringç±»å‹æ¥æŒ‡å®šè·¯å¾„</li><li>ModelAndViewä½¿ç”¨ä»–æœ¬èº«è®¾ç½®è·³è½¬èµ„æºè·¯å¾„ï¼Œè®¾ç½®çš„æ–¹å¼æœ‰ä¸¤ç§<ol><li>é€šè¿‡æ„é€ æ–¹æ³•ï¼š<strong>new</strong> ModelAndView(â€œdemo3/1â€);</li><li>è°ƒç”¨setæ–¹æ³•ï¼šmod.setViewName(â€œdemo3/1â€);</li></ol></li></ol><h2 id="SpringMVC-æ‹¦æˆªå™¨">SpringMVC æ‹¦æˆªå™¨</h2><p>springmvc ä¸­çš„æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨æœ‰äº›ç±»ä¼¼ï¼Œä»–çš„ä½œç”¨æ˜¯æ‰«ææŒ‡å®šçš„è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œæ‹¦æˆªï¼Œå¯ä»¥åœ¨æ‹¦æˆªå‰å’Œæ‹¦æˆªåå¯¹è¯·æ±‚è¿›è¡Œä¸€äº›æ“ä½œï¼Œç¬¦åˆè¯·æ±‚è¦æ±‚çš„ä¼šè¢«æ”¾è¡Œï¼Œä¸ç¬¦åˆçš„åˆ™ä¼šè¢«æ‹¦æˆª</p><p>æ‹¦æˆªçš„ç›®æ ‡ä»…é™äºè¯·æ±‚ï¼Œä¸åŒ…å« JSP ç­‰ã€‚</p><blockquote><p>1.ç¼–å†™æ‹¦æˆªå™¨</p></blockquote><p>springmvc ä¸­ä¸ºæˆ‘ä»¬æä¾›çš„æ‹¦æˆªå™¨æ¥å£ä¸º <code>HandlerInterceptor</code>ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸ªæ¥å£å¹¶å¤å†™å…¶ä¸­çš„å‡½æ•°ï¼Œå¤å†™çš„å‡½æ•°åŒ…æ‹¬ï¼š</p><p><code>preHandle</code>ï¼šè¿”å›ä¸€ä¸ª boolean å€¼ï¼Œ==true ä¸ºé€šè¿‡ï¼Œfalse ä¸ºæ‹¦æˆª==</p><p><code>postHandle</code>ï¼šæ‹¦æˆªè¯·æ±‚åéœ€è¦æ‰§è¡Œçš„é€»è¾‘åœ¨è¿™é‡Œä¹¦å†™ã€‚</p><p><code>afterCompletion</code>ï¼šæ‹¦æˆªå™¨å·¥ä½œå®Œæˆåçš„å–„åé€»è¾‘å†™åœ¨è¿™é‡Œã€‚</p><p>å®ç°æ¥å£æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å¼ºåˆ¶è¦æ±‚å¤å†™å…¶ä¸­å…¨éƒ¨çš„æ–¹æ³•ï¼Œæœ‰æ—¶å€™æˆ‘å¯èƒ½åªéœ€è¦ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ—¶å°±è¢«å¼ºè¿«å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ mvc ä¸­æä¾›äº†ä¸€ä¸ª <strong>æ‹¦æˆªå™¨é€‚é…å™¨</strong> <code>HandlerInterceptorAdapter</code> æ¥åšè¿™ä¸ªè¿‡æ¸¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">extends</span> <span class="title class_">HandlerInterceptorAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest req, HttpServletResponse resp, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‹¦æˆªå™¨æ‰§è¡Œç¬¬&quot;</span> + count + <span class="string">&quot; æ¬¡ï¼Œæ‹¦æˆªè¯·æ±‚ç›®æ ‡ä¸º&quot;</span>);</span><br><span class="line">        System.out.println(req.getRequestURL().toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>2.æ³¨å†Œæ‹¦æˆªå™¨</p></blockquote><p>åœ¨æ‹¦æˆªå™¨ç±»ä¹¦å†™å®Œæ¯•ä¹‹åå» SpringMVC çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®æ‹¦æˆªå™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- s ç»“å°¾æ˜¯å¤æ•°ï¼Œä»£è¡¨ç€å¯ä»¥é…ç½®å¤šä¸ªæ‹¦æˆªå™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åˆ¶å®šæ‹¦æˆªçš„è·¯å¾„å’Œå¤„ç†æ‹¦æˆªé€»è¾‘çš„æ‹¦æˆªå™¨ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- éœ€è¦æ³¨æ„çš„æ˜¯ mvc:mappingæ ‡ç­¾è¦åœ¨ä¸Šé¢ï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;club.hanzhe.config.MyInterceptor&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ä¸Šä¼ å’Œä¸‹è½½">ä¸Šä¼ å’Œä¸‹è½½</h2><blockquote><p>æ·»åŠ mavenä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- jstlæ ¸å¿ƒæ ‡ç­¾åº“ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Apacheçš„ä¸Šä¼ ç»„ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å•æ–‡ä»¶ä¸Šä¼ </p></blockquote><p>åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œæ–‡ä»¶ä¸Šä¼ æ˜¯éœ€è¦ä¾é  file ç±»å‹è¡¨å•å®Œæˆçš„ï¼Œå¹¶ä¸” <strong>è¡¨å•çš„æäº¤æ–¹å¼å¿…é¡»æ˜¯postï¼Œä¸”éœ€è¦ä¿®æ”¹å±æ€§<code>enctype=&quot;multipart/form-data&quot;</code></strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath&#125;/uploadFile&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç‚¹å‡»ä¸Šä¼ &quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“æäº¤è¡¨å•åï¼Œä¼šè®¿é—®åç«¯ uploadFile æ§åˆ¶å™¨è´Ÿè´£å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/uploadFile&quot;)</span>     <span class="comment">// å•æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">upload</span><span class="params">(MultipartFile file, ModelAndView mv)</span> &#123;</span><br><span class="line"> mv.setViewName(<span class="built_in">this</span>.upload(file));</span><br><span class="line"> <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å‚æ•°åˆ—è¡¨ä¸­çš„MultipartFileå°±ä»£è¡¨è¢«æ¥æ”¶çš„æ–‡ä»¶ï¼Œfileå˜é‡è¦å¯¹åº”è¡¨å•ä¸­inputçš„nameå±æ€§</li></ul><blockquote><p>è¯¥å‡½æ•°ä¸ºä¸Šé¢ä»£ç ä¸­è°ƒç”¨çš„å‡½æ•°ï¼Œå°è£…æ”¹ä»£ç ç”¨äºç­‰ä¸‹å¤šæ–‡ä»¶ä¸Šä¼ æ—¶å¤ç”¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file ä»£è¡¨éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">( MultipartFile file )</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¸Šä¼ æ–‡ä»¶çš„åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="comment">// å°†å½“å‰æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šçš„è·¯å¾„</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\Download&quot;</span> + File.separator + System.currentTimeMillis() + filename ));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»£ç å‘ç”Ÿå¼‚å¸¸äº†&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error.jsp&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>File.separator ä»£è¡¨æ–‡ä»¶åˆ†éš”ç¬¦ï¼Œå³ä¸ºWindowsç³»ç»Ÿä¸­<code>E:\Download</code>ä¸­çš„æ–œæ ï¼Œå› ä¸ºWindowsäºLinuxçš„æ–‡ä»¶åˆ†éš”ç¬¦ä¸åŒï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°±ä½¿ç”¨äº†Fileç±»ä¸­çš„åˆ†éš”ç¬¦</p></li><li><p>System.currentTimeMillis( ) æ—¶é—´æˆ³</p></li></ul><h2 id="æ–‡ä»¶ä¸‹è½½">æ–‡ä»¶ä¸‹è½½</h2><p>æ–‡ä»¶ä¸Šä¼ åœ¨ä¹‹å‰å·²ç»ä¹¦å†™å®Œæ¯•ï¼Œæ‰“å¼€ä¹‹å‰è®¾ç½®å¥½çš„ç›®å½•å¯ä»¥å‘ç°æ–‡ä»¶å·²ç»å¯ä»¥æ­£å¸¸ä¸Šä¼ äº†ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å®ç°æ–‡ä»¶çš„ä¸‹è½½åŠŸèƒ½ã€‚</p><p>æƒ³è¦å®ç°æ–‡ä»¶çš„ä¸‹è½½åŠŸèƒ½ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“æœ‰å¤šå°‘å¯ä»¥è¢«ä¸‹è½½çš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è®©ç”¨æˆ·ä¼˜å…ˆè®¿é—®æ§åˆ¶å™¨ï¼Œç»è¿‡å¤„ç†ååœ¨è·³è½¬åˆ°ä¸‹è½½é¡µé¢ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/downFile&quot;)</span>    <span class="comment">// æ–‡ä»¶éå†åŠä¸‹è½½</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">downFile</span><span class="params">(ModelAndView mv)</span> &#123;</span><br><span class="line"> <span class="comment">// å°†ä¸Šä¼ ç›®å½•å°è£…ä¸ºå¯¹è±¡</span></span><br><span class="line"> <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\Download&quot;</span>);</span><br><span class="line"> String[] list = file.list();</span><br><span class="line"> <span class="comment">// å°†æºå¸¦ç€æ–‡ä»¶åçš„é›†åˆå­˜åˆ°requeståŸŸä¸­å‘é€åˆ°jspé¡µé¢ä¸Š</span></span><br><span class="line"> mv.addObject(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line"> mv.setViewName(<span class="string">&quot;download.jsp&quot;</span>);</span><br><span class="line"> <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·³è½¬åˆ°ä¸‹è½½é¡µé¢åï¼Œæ­¤æ—¶çš„requeståŸŸä¸­å·²ç»å°è£…äº†æ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä½¿ç”¨jstlæ ‡ç­¾åº“çš„eachè¿›è¡Œå¾ªç¯éå†å³å¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;tab&quot;</span> <span class="attr">border</span>=<span class="string">&quot;1px dashed black&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;5px&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;list&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;file&quot;</span> <span class="attr">varStatus</span>=<span class="string">&quot;status&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;status.index+3&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;file&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath&#125;/down?name=$&#123;file&#125;&quot;</span>&gt;</span>ä¸‹è½½<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“ç‚¹å‡»ä¸‹è½½çš„æ—¶å€™ä¼šè®¿é—®æŒ‡å®šçš„æ§åˆ¶å™¨ï¼Œå¹¶æºå¸¦æƒ³è¦ä¸‹è½½çš„æ–‡ä»¶çš„æ–‡ä»¶åï¼Œè¿™æ—¶å°±å¯ä»¥é€šè¿‡Javaæ¥è¿›è¡Œä¸‹è½½äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/down&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">down</span><span class="params">(String name, HttpServletResponse resp)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–ä¸‹è½½çš„æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\Download&quot;</span> + File.separator + name);</span><br><span class="line">    <span class="comment">// ä¿®æ”¹è¯·æ±‚å¤´</span></span><br><span class="line">    resp.setHeader(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸‹è½½çš„æ–‡ä»¶å</span></span><br><span class="line">    resp.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span>+name );</span><br><span class="line">    <span class="comment">// åˆ›å»ºç¼“å­˜åŒºï¼Œå¤§å°ä¸º8192å­—èŠ‚</span></span><br><span class="line">    <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8192</span>];</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¾“å…¥æµï¼Œè¯»å–åˆ°æŒ‡å®šæ–‡ä»¶çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file));</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¾“å‡ºæµï¼Œç”¨äºä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> resp.getOutputStream();</span><br><span class="line">        <span class="comment">// å½“ i ä¸º -1 çš„æ—¶å€™ï¼Œå°±ä»£è¡¨æ–‡ä»¶è¾“å‡ºå®Œæ¯•äº†ï¼Œå¯ä»¥åœæ­¢å¾ªç¯ä»£ç äº†</span></span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> bis.read(buffer); i != -<span class="number">1</span>; ) &#123;</span><br><span class="line">            os.write(buffer, <span class="number">0</span>, i);</span><br><span class="line">            i = bis.read(buffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‡ºé”™äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”±äºä¹‹å‰ä¸‹è½½çš„ a æ ‡ç­¾ä½¿ç”¨äº† target=â€œ_blankâ€ï¼Œæ‰€ä»¥è¿™é‡Œçš„æµè§ˆå™¨ä¼šæ–°å»ºé¡µé¢è¿›è¡Œä¸‹è½½ï¼Œå‘èµ·ä¸‹è½½åå½“å‰é¡µé¢ä¹Ÿä¼šè‡ªåŠ¨å…³é—­ï¼Œä¸ä¼šå½±å“ä½ çš„æ­£å¸¸æ“ä½œ ( è¿™é‡Œæˆ‘è¿˜æ²¡ä¸ä¸ºä»€ä¹ˆé¡µé¢ä¼šè‡ªåŠ¨å…³é—­ï¼Œåº”è¯¥æ˜¯è¯·æ±‚å¤´è®¾ç½®çš„é—®é¢˜å§ )ï¼Œè¿™æ ·ä¸€æ¥æ–‡ä»¶çš„ä¸‹è½½ä¹Ÿå°±å®Œæˆäº†ï¼</p><h2 id="å¤šæ–‡ä»¶ä¸Šä¼ ">å¤šæ–‡ä»¶ä¸Šä¼ </h2><p>å¤šæ–‡ä»¶ä¸Šä¼ è¿™é‡Œï¼Œå‰ç«¯é¡µé¢å¹¶æ²¡æœ‰ä»€ä¹ˆæ”¹å˜ï¼Œåªä¸è¿‡inputä»ä¸€ä¸ªå˜æˆäº†ä¸¤ä¸ª ( æ³¨æ„nameå±æ€§ä¸è¦é‡å)ï¼ŒJavaä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><blockquote><p>è¿™é‡Œçš„å‚æ•°åˆ—è¡¨ç”± <code>Multipart</code> æ”¹ä¸ºäº† <code>MultipartHttpServletRequest</code>ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥è·å–å¤šä¸ªæ–‡ä»¶çš„ä¿¡æ¯äº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/uploadFiles&quot;)</span>     <span class="comment">// å¤šæ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">uploads</span><span class="params">(MultipartHttpServletRequest files, ModelAndView mv)</span> &#123;</span><br><span class="line"> <span class="comment">// è·å–æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶å</span></span><br><span class="line">    Iterator&lt;String&gt; names = files.getFileNames();</span><br><span class="line"> <span class="comment">// å¾ªç¯ä¿å­˜æ¯ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">while</span> (names.hasNext())</span><br><span class="line">        <span class="built_in">this</span>.upload( files.getFile(names.next()) );</span><br><span class="line">    mv.setViewName(<span class="string">&quot;success.jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RestFul-é£æ ¼">RestFul é£æ ¼</h2><p>RestFul åªæ˜¯ä¸€ç§é£æ ¼ï¼ŒåŸºäºè¿™ä¸ªé£æ ¼è®¾è®¡çš„ç¨‹åºå¯ä»¥æ›´ç®€æ´ï¼Œæœ‰å±‚æ¬¡ï¼Œæ›´æ˜“äºå®ç°ç¼“å­˜ç­‰æœºåˆ¶,  ä»–å®ç°äº†è¯·æ±‚ç›¸åŒçš„è·¯å¾„è€Œäº§ç”Ÿä¸åŒçš„é€»è¾‘çš„æ•ˆæœ,  å®ç°äº† URL å¤ç”¨</p><p>ä¸€èˆ¬åŸºäºæ•°æ®å¢åˆ æ”¹æŸ¥å‘å‡ºçš„è¯·æ±‚ï¼Œæ˜¯é€šè¿‡==åŒºåˆ†ä¸åŒçš„è·¯å¾„==è¾¾åˆ° CRUD çš„æ•ˆæœï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localhost:8080/dropUser?id=1  åˆ é™¤ç”¨æˆ·</span><br><span class="line">localhost:8080/finduser?id=1  æŸ¥è¯¢ç”¨æˆ·</span><br></pre></td></tr></table></figure><p>è€Œ RestFul æ˜¯é€šè¿‡==åŒºåˆ†è¯·æ±‚çš„æ–¹æ³•==è¾¾åˆ° CRUD çš„æ•ˆæœï¼Œä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localhost:8080/user?id=1 åˆ é™¤ç”¨æˆ· å‘å‡ºDELETEè¯·æ±‚</span><br><span class="line">localhost:8080/user?id=1 æŸ¥è¯¢ç”¨æˆ· å‘å‡ºGETè¯·æ±‚</span><br></pre></td></tr></table></figure><p>åœ¨ RestFul ä¸­é’ˆå¯¹å¢åˆ æ”¹æŸ¥åˆ†åˆ«å¯¹åº”ç€å››ç§è¯·æ±‚æ–¹æ³•</p><p><strong>ï¼» æ·»åŠ : POST ï¼½ï¼» åˆ é™¤: DELETE ï¼½ï¼» ä¿®æ”¹: PUT ï¼½ï¼» æŸ¥è¯¢: GET ï¼½</strong></p><p>é’ˆå¯¹åŒºåˆ†å››ç§è¯·æ±‚çš„æ–¹æ³•æœ‰ä¸¤ç§æ‰‹æ®µï¼š</p><ol><li><p>é€šè¿‡ RequestMapping ä¸­çš„ method å±æ€§è¿›è¡ŒåŒºåˆ†è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»…æ¥æ”¶ä»¥postæ–¹æ³•å‘å‡ºçš„è¯·æ±‚</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/user&quot;, method = RequestMethod.POST)</span></span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡æ¯ä¸ªæ–¹æ³•å¯¹åº”çš„æ³¨è§£è¿›è¡ŒåŒºåˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping</span><br><span class="line">@DeleteMapping</span><br><span class="line">@PutMapping</span><br><span class="line">@GetMapping</span><br></pre></td></tr></table></figure></li></ol><h2 id="å¯¼å‡ºExcelè¡¨æ ¼">å¯¼å‡ºExcelè¡¨æ ¼</h2>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringMVC</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
