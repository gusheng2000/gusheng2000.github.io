

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/myfavicon.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Shi_Kang">
  <meta name="keywords" content="">
  
    <meta name="description" content="Redis 笔记 redis 是一款 NoSQL 数据库，是最常见的一款非关系型数据库，主要使用 key - value 的形式存储数据，和 mysql 不同，redis 并不会直接把数据存储到硬盘中，而是存储在内存中，也正是这样的设定让 redis 的存取操作特别的快。 Redis 的下载及安装  redis 的下载  首先要去 redis 的官网下载他的压缩包，官网 [ 中文 ] 直连地址如下">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis 笔记">
<meta property="og:url" content="http://example.com/2022/10/19/Redis%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Shi_Kang">
<meta property="og:description" content="Redis 笔记 redis 是一款 NoSQL 数据库，是最常见的一款非关系型数据库，主要使用 key - value 的形式存储数据，和 mysql 不同，redis 并不会直接把数据存储到硬盘中，而是存储在内存中，也正是这样的设定让 redis 的存取操作特别的快。 Redis 的下载及安装  redis 的下载  首先要去 redis 的官网下载他的压缩包，官网 [ 中文 ] 直连地址如下">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2023/11/26/GyIdrAsehtBv1ug.png">
<meta property="article:published_time" content="2022-10-19T14:46:25.000Z">
<meta property="article:modified_time" content="2024-10-12T02:08:00.583Z">
<meta property="article:author" content="Shi_Kang">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2023/11/26/GyIdrAsehtBv1ug.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Redis 笔记 - Shi_Kang</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null},"gtag":null,"woyaola":null,"cnzz":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Shi·s Web Space</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/banner/category.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Redis 笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-10-19 22:46" pubdate>
          October 19, 2022 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          10k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          85 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Redis 笔记</h1>
            
            
              <div class="markdown-body">
                
                <h1>Redis 笔记</h1>
<p>redis 是一款 NoSQL 数据库，是最常见的一款非关系型数据库，主要使用 key - value 的形式存储数据，和 mysql 不同，redis 并不会直接把数据存储到硬盘中，而是存储在内存中，也正是这样的设定让 redis 的存取操作特别的快。</p>
<h2 id="Redis-的下载及安装">Redis 的下载及安装</h2>
<blockquote>
<p>redis 的下载</p>
</blockquote>
<p>首先要去 redis 的官网下载他的压缩包，官网 [ 中文 ] 直连地址如下：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//www.redis.cn/</span><br></code></pre></td></tr></table></figure>
<p>进入官网后直接下载即可，然后远程连接 服务器/虚拟机 将下载好的文件上传至 <code>/usr/local</code> 目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">进入到usr/local目录</span><br>cd /usr/local<br><span class="hljs-meta prompt_"># </span><span class="language-bash">上传文件后，执行解压命令</span><br>tar -zxvf redis-5.0.5.tar.gz<br></code></pre></td></tr></table></figure>
<blockquote>
<p>redis 的安装</p>
</blockquote>
<p>在执行安装命令之前，首选需要安装 gcc 的依赖，如已安装请忽略</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install gcc<br></code></pre></td></tr></table></figure>
<p>然后切换到 redis 目录下开始执行安装命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">切换目录到redis下</span><br>cd redis-5.0.5<br><span class="hljs-meta prompt_"># </span><span class="language-bash">执行安装命令</span><br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure>
<p>这样一来，安装就顺利结束了，如果提示 -bash: make: command not found 则代表 gcc 没有装，需要重新安装 gcc 环境</p>
<blockquote>
<p>redis 的配置</p>
</blockquote>
<p>实际上这个时候 redis 已经可以正常运行了，运行 redis 的命令为 <code>redis-server</code>，但是当我们运行的时候会发现，redis 直接将窗口锁定了，我们不能进行任何的操作，一旦解锁也就意味着 redis 停止工作了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">19196:C 15 Jun 2020 22:13:31.574 <span class="hljs-comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br>19196:C 15 Jun 2020 22:13:31.574 <span class="hljs-comment"># Redis version=5.0.8, bits=64, commit=0000</span><br>0000, modified=0, pid=19196, just started<br>19196:C 15 Jun 2020 22:13:31.574 <span class="hljs-comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span><br>                _._                                                  <br>           _.-``__ <span class="hljs-string">&#x27;&#x27;</span>-._                                             <br>      _.-``    `.  `_.  <span class="hljs-string">&#x27;&#x27;</span>-._           Redis 5.0.8 (00000000/0) 64 bit<br>  .-`` .-```.  ```\/    _.,_ <span class="hljs-string">&#x27;&#x27;</span>-._                                   <br> (    <span class="hljs-string">&#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="hljs-string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="hljs-string">&#x27;|     Port: 6379</span><br><span class="hljs-string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 19196<br>  `-._    `-._  `-./  _.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                   <br> |`-._`-._    `-.__.-<span class="hljs-string">&#x27;    _.-&#x27;</span>_.-<span class="hljs-string">&#x27;|                                  </span><br><span class="hljs-string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="hljs-string">&#x27;    |           http://redis.io        </span><br><span class="hljs-string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                   <br> |`-._`-._    `-.__.-<span class="hljs-string">&#x27;    _.-&#x27;</span>_.-<span class="hljs-string">&#x27;|                                  </span><br><span class="hljs-string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="hljs-string">&#x27;    |                                  </span><br><span class="hljs-string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                   <br>      `-._    `-.__.-<span class="hljs-string">&#x27;    _.-&#x27;</span>                                       <br>          `-._        _.-<span class="hljs-string">&#x27;                                           </span><br><span class="hljs-string">              `-.__.-&#x27;</span>                                               <br><br>19196:M 15 Jun 2020 22:13:31.575 <span class="hljs-comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br>19196:M 15 Jun 2020 22:13:31.575 <span class="hljs-comment"># Server initialized</span><br>..................<br></code></pre></td></tr></table></figure>
<p>这时我们需要对配置文件做一些手脚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 建议弄个备份，玩儿备份就好，redis 的配置文件还是很重要的</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">复制配置文件</span><br>cp redis.conf /root/redis.conf<br>cd /root<br><span class="hljs-meta prompt_"># </span><span class="language-bash">编辑配置文件信息</span><br>vim redis.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改为daemonize为<span class="hljs-built_in">yes</span>，可以后台运行 redis，否则会锁定命令行</span><br>daemonize yes<br></code></pre></td></tr></table></figure>
<blockquote>
<p>运行 redis 并创建连接</p>
</blockquote>
<p>首先我们来运行服务端 <code>redis-sever</code>，需要注意的是这里要指定配置文件进行启动，否则还是会以默认配置执行，还是会锁定当前窗口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 默认执行，会锁定窗口</span><br>redis-server<br><span class="hljs-comment"># 指定配置文件执行，咱们配置了后台运行，不会锁定窗口</span><br>redis-server redis.conf<br><span class="hljs-comment">## 出现下面这堆东西就代表执行成功了 ##</span><br>19203:C 15 Jun 2020 22:15:09.851 <span class="hljs-comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br>19203:C 15 Jun 2020 22:15:09.851 <span class="hljs-comment"># Redis version=5.0.8, bits=64, commit=00000000, modified=0, pid=19203, just started</span><br>19203:C 15 Jun 2020 22:15:09.851 <span class="hljs-comment"># Configuration loaded</span><br></code></pre></td></tr></table></figure>
<p>接下来让我们启动客户端 <code>redis-cli</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">如果直接输入则默认连接本地的6379端口</span><br>redis-cli<br>127.0.0.1:6379&gt;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">也可以通过参数来指定目标IP地址或端口号</span><br>redis-cli -h 127.0.0.1 -p 6379<br>127.0.0.1:6379&gt;<br></code></pre></td></tr></table></figure>
<p>尝试输入一个 ping 命令，测试服务是否正常工作，如果返回 PONG 就证明一切正常</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; PING<br>PONG<br></code></pre></td></tr></table></figure>
<blockquote>
<p>关闭 redis</p>
</blockquote>
<p>如果不时用任何配置让他默认启动的话，直接 Ctrl + C 就可以关闭 redis，那么后台运行应该怎么关？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 连接到指定的服务后，执行关闭命令即可</span><br>127.0.0.1:6379&gt; shutdown<br><span class="hljs-comment"># 也可以在不连接的情况下直接通过redis-cli执行关闭命令</span><br>redis-cli shutdown<br></code></pre></td></tr></table></figure>
<h2 id="设置访问密码">设置访问密码</h2>
<p>我们刚刚成功连接到了 redis 服务器，但是这仅仅是本地的，我们目前并不能够远程 ip 地址直接访问，因为我们的 redis 默认开启了保护模式，将来我们的项目是要跑在网络上要用 java 代码操作的，想要远程连接必须要先设置密码！</p>
<blockquote>
<p>临时设置密码</p>
</blockquote>
<p>为了可以远程操作，我们可以设置一个临时的密码，连接上 redis 客户端，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置密码</span><br>127.0.0.1:6379&gt; config <span class="hljs-built_in">set</span> requirepass 123456<br>OK<br><span class="hljs-comment"># 设置密码是实时的，需要登录才可以进行操作</span><br>127.0.0.1:6379&gt; keys *<br>(error) NOAUTH Authentication required.<br><span class="hljs-comment"># 验证redis密码</span><br>127.0.0.1:6379&gt; auth 123456<br>OK<br><span class="hljs-comment"># 获取密码</span><br>127.0.0.1:6379&gt; config get requirepass<br>1) <span class="hljs-string">&quot;requirepass&quot;</span><br>2) <span class="hljs-string">&quot;zhang&quot;</span><br><span class="hljs-comment"># 取消之前设置的密码，留空即可</span><br>127.0.0.1:6379&gt; config <span class="hljs-built_in">set</span> requirepass <span class="hljs-string">&#x27;&#x27;</span><br>OK<br></code></pre></td></tr></table></figure>
<p>这样一个临时的密码就设置成功了，只要 redis 始终保持正常运行，秘密是不会失效的</p>
<blockquote>
<p>设置永久性密码</p>
</blockquote>
<p>如果觉得临时密码并不能够满足你的安全感，那么可以通过修改配置文件来设置密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 在redis.conf中找到requirepass然后在后面追加密码，重启redis即可</span><br>requirepass 你的密码<br></code></pre></td></tr></table></figure>
<h2 id="配置文件讲解">配置文件讲解</h2>
<p>学习 redis 最好是跟着官方文档走，记笔记只是为了让自己更加熟练，推荐 redis 中文网：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.redis.net.cn<span class="hljs-regexp">/order/</span><br></code></pre></td></tr></table></figure>
<p>刚刚在安装 redis 的时候简单修改了一下 daemonize 属性的值，让他可以不锁定当前命令行且后台运行，redis 有很多需要了解的常规性配置，这里大概记个笔记：</p>
<p>redis 的配置文件中注释非常多，官方很友好的将模块划分开来，这里就记几个我个人觉得常用的配置</p>
<blockquote>
<p>######################## NETWORK ######################## 网络</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 绑定客户端IP</span><br><span class="hljs-comment"># 如果需要远程连接redis的话，要么在这里添加你的IP地址，要么将这句话注释掉</span><br><span class="hljs-comment"># 注释掉之后，所有的IP就都可以访问了</span><br><span class="hljs-built_in">bind</span> 127.0.0.1<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 保护模式</span><br><span class="hljs-comment"># redis没有设置访问密码的情况下，如果开启了保护模式就不能远程连接了</span><br>protected-mode <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 启动端口号，不多赘述</span><br>port 6379<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 客户端超时时间/s</span><br><span class="hljs-comment"># 当客户端连接服务端的时候，超出 n 秒没有任何操作就自动切断连接</span><br><span class="hljs-comment"># 设置为 0 代表无超时时间</span><br><span class="hljs-built_in">timeout</span> 0<br></code></pre></td></tr></table></figure>
<blockquote>
<p>######################## GENERAL ######################## 常用</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 守护进程</span><br><span class="hljs-comment"># 这个就是之前设置的后台运行</span><br><span class="hljs-comment"># 守护进程就是Windows系统中的服务，将redis以服务的形式运行</span><br>daemonize <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### PID文件</span><br><span class="hljs-comment"># 如果开启了守护进程后台运行redis，那么这个就一定要有</span><br>pidfile /var/run/redis_6379.pid<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 日志级别</span><br><span class="hljs-comment"># 记录执行日志时可选择的记录级别，选项分别有：</span><br><span class="hljs-comment"># debug，verbose，notice，warning，具体描述配置文件中有，一般不用设置这个</span><br>loglevel notice<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 日志文件名称</span><br>logfile <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 默认数据库个数</span><br><span class="hljs-comment"># 可以在这里手动对数据库数量进行设置，我就改成5个啦，闲的没事儿</span><br>databases 16<br></code></pre></td></tr></table></figure>
<blockquote>
<p>######################## SECURITY ######################## 安全</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#### 密码</span><br><span class="hljs-comment"># 安全中最常用的就是密码设置了，访问数据库必须要密码，不然就乱套了</span><br><span class="hljs-comment"># 默认是注释的，也就是没有密码</span><br>requirepass foobared<br></code></pre></td></tr></table></figure>
<h2 id="Redis-基础命令">Redis 基础命令</h2>
<p>redis 中也有库的概念，初始数量为 16 个，可以在配置文件中进行修改，他是按照从 0 开始的递增顺序命名的，和 mysql 不同，redis 不支持为某个数据库单独命名，也不支持为每个数据库设置单独的访问密码，默认我们启动 redis 时使用的是第 0 个数据库。</p>
<p>==切换数据库==应该怎么操作呢？只需要执行 select 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 当我们使用select切换到其他数据库的时候，端口号后面会提示当前使用数据库 [1]，默认库就不会提示</span><br>127.0.0.1:6379&gt; <span class="hljs-keyword">select</span> 1<br>OK<br>127.0.0.1:6379[1]&gt;<br></code></pre></td></tr></table></figure>
<p>在我们学习 mysql 的时候，需要通过使用 sql 语句对数据进行 CRUD，而在 redis 我们需要记的是命令</p>
<blockquote>
<p>验证登录密码</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; auth 123456<br>OK<br></code></pre></td></tr></table></figure>
<blockquote>
<p>数据的简单 CRUD</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># set命令，因为key是唯一的，所以set既是添加，也是修改，如果有空格需要用双引号引起来</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> user zhang<br>OK<br><span class="hljs-comment"># get命令，就是查询喽</span><br>127.0.0.1:6379&gt; get user<br><span class="hljs-string">&quot;zhang&quot;</span><br><span class="hljs-comment"># del命令，就是删除喽</span><br>127.0.0.1:6379&gt; del user<br>(<span class="hljs-built_in">integer</span>) 1<br><span class="hljs-comment"># 删除之后查不到了</span><br>127.0.0.1:6379&gt; get user<br>(nil)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看当前库数据总计数</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[1]&gt; dbsize<br>(<span class="hljs-built_in">integer</span>) 4<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看当前库所有的 key，* 代表通配符</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[1]&gt; keys *<br>1) <span class="hljs-string">&quot;user&quot;</span><br>2) <span class="hljs-string">&quot;sex&quot;</span><br>3) <span class="hljs-string">&quot;name&quot;</span><br>4) <span class="hljs-string">&quot;age&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>清空当前数据库</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[1]&gt; flushdb<br>OK<br></code></pre></td></tr></table></figure>
<blockquote>
<p>清空所有数据库</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; flushall<br>OK<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看当前库是否存在该 key，只要不返回 0 就代表存在，exists 是否存在</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; exists name<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<blockquote>
<p>将当前库的数据移动到其他库 move 移动，name 为 key，1 为目标数据库</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; move name 1<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<blockquote>
<p>设置消亡时间 ( 过期时间 )，expire 单位/秒，ttl 查询</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置user</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> user zhanghanzhe<br>OK<br><span class="hljs-comment"># 设置user的消亡时间为10秒</span><br>127.0.0.1:6379&gt; expire user 10<br>(<span class="hljs-built_in">integer</span>) 1<br><span class="hljs-comment"># 一开始的时候还是可以获取的 </span><br>127.0.0.1:6379&gt; get user<br><span class="hljs-string">&quot;zhanghanzhe&quot;</span><br><span class="hljs-comment"># 查询过期时间，还剩3秒</span><br>127.0.0.1:6379&gt; tll user<br>(<span class="hljs-built_in">integer</span>) 3<br><span class="hljs-comment"># 这会变-2了</span><br>127.0.0.1:6379&gt; tll user<br>(<span class="hljs-built_in">integer</span>) -2<br><span class="hljs-comment"># 获取不到了</span><br>127.0.0.1:6379&gt; get user<br>(nil)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看 key 的数据类型</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; type name<br>string<br></code></pre></td></tr></table></figure>
<h2 id="五大基本类型">五大基本类型</h2>
<p>在上面我们介绍了最后一个命令，是一个 <code>type</code> 命令，使用它可以查看指定 key 的数据类型，这里接触了一个新的知识，就是数据类型，redis 中有有多少数据类型呢？</p>
<h3 id="String-字符串">String 字符串</h3>
<p>string 就是字符串啦，我们使用简单的 set 命令设置的数据，如果没有指定，默认就是 string 类型的，就像 java 的 api 一样，string 类型有自己专属的命令</p>
<p><em>string 类型的命令大多是都是以 str 开头的</em></p>
<p>字符串操作就是之前学习的 get set 命令，就不多赘述了</p>
<blockquote>
<p>组合命令 返回并修改</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 组合命令，修改新的value同时返回修改前的value</span><br>getset name hanzhe<br></code></pre></td></tr></table></figure>
<blockquote>
<p>数据的批量操作</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; mset user zhang name hanzhe age 21<br>OK<br>127.0.0.1:6379&gt; mget user name age<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;hanzhe&quot;</span><br>3) <span class="hljs-string">&quot;21&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>带有验证的 setnx</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 同样是设置值，因为key是唯一的，所以他在设置之前会有一个效验，如果已存在就不修改</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> name zhang<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; setnx name hanzhe<br>(<span class="hljs-built_in">integer</span>) 0<br><span class="hljs-comment"># 批量操作也是一样，因为原子性的原因，他们要么全都成功，要么全都失败。</span><br>127.0.0.1:6379&gt; msetnx view 123 name hanzhe<br>(<span class="hljs-built_in">integer</span>) 0<br></code></pre></td></tr></table></figure>
<blockquote>
<p>追加字符 append</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> name zhang<br>OK<br>127.0.0.1:6379&gt; append name <span class="hljs-string">&quot; &quot;</span><br>(<span class="hljs-built_in">integer</span>) 6<br>127.0.0.1:6379&gt; append name hanzhe<br>(<span class="hljs-built_in">integer</span>) 12<br>127.0.0.1:6379&gt; get name<br><span class="hljs-string">&quot;zhang hanzhe&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>返回字符串长度 strlen</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; strlen name<br>(<span class="hljs-built_in">integer</span>) 12<br></code></pre></td></tr></table></figure>
<blockquote>
<p>自增，自减 incr decr</p>
</blockquote>
<p>在 java 中，如果想要对字符串 +1 需要转换类型，而在 redis 中他们自动为我们进行了处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> view 1<br>OK<br><span class="hljs-comment"># 自增 +1</span><br>127.0.0.1:6379&gt; incr view<br>(<span class="hljs-built_in">integer</span>) 2<br><span class="hljs-comment"># 自减 -1</span><br>127.0.0.1:6379&gt; decr view<br>(<span class="hljs-built_in">integer</span>) 1<br><span class="hljs-comment"># 自增，指定步长为3</span><br>127.0.0.1:6379&gt; incrby view 3<br>(<span class="hljs-built_in">integer</span>) 4<br><span class="hljs-comment"># 自减，指定步长为2</span><br>127.0.0.1:6379&gt; decrby view 2<br>(<span class="hljs-built_in">integer</span>) 2<br></code></pre></td></tr></table></figure>
<blockquote>
<p>截取字符串 getrange，==截取是将获取的结果进行截取，并不会对 key 本身造成改变==</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> name zhanghanzhe<br>OK<br><span class="hljs-comment"># 从下标0开始，截取到4，共截取了5位，包头包尾，如果是0到-1则代表获取全部的字符串</span><br>127.0.0.1:6379&gt; getrange name 0 4<br><span class="hljs-string">&quot;zhang&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>替换字符串 setrange</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 从下标5开始替换，直至替换结束，这个会对name进行修改。</span><br>127.0.0.1:6379&gt; setrange name 5 chunde<br>(<span class="hljs-built_in">integer</span>) 11<br>127.0.0.1:6379&gt; get name<br><span class="hljs-string">&quot;zhangchunde&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>设置消亡时间 ( 过期时间 ) setex 单位/秒</p>
</blockquote>
<p>之前我们使用过一个叫 <code>expire</code> 的命令，也是用来设置消亡时间的，但是他执行设置已存在的 key，而这个命令可以在设置变量的同时设置消亡时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; setex name 10 zhang<br>OK<br></code></pre></td></tr></table></figure>
<h3 id="List-列表集合">List 列表集合</h3>
<p>list 是用来存储 string 的一个列表, ==redis 的列表是双向的==，list 默认从右向左延伸，也就是每次添加元素都会添加在左面，==list 列表允许重复元素的出现==</p>
<p><em>list中的命令，大多数都是以小写字母 L 开头的</em></p>
<blockquote>
<p>创建-添加元素 lpush，rpush</p>
</blockquote>
<p>lpush 默认从左侧添加，如需从右侧添加可以使用 <code>r</code> 开头声明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lpush name han<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; lpush name zhang<br>(<span class="hljs-built_in">integer</span>) 2<br>127.0.0.1:6379&gt; rpush name zhe<br>(<span class="hljs-built_in">integer</span>) 3<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看列表 lrange</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看之前创建的list，仅支持从左侧查看</span><br>127.0.0.1:6379&gt; lrange name 0 -1<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhe&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>添加，追加元素 2</p>
</blockquote>
<p>之前介绍了 <code>push</code> 命令可以添加元素，通过 l 开头或者 r 开头可以控制左侧添加还是右侧添加，其实添加元素还可以使用 <code>linsert</code> 命令，和 <code>push</code> 不同的是， <code>push</code> 是在首位添加，而 <code>linsert</code> 是从 <strong>左面开始在第一个目标 key 的前后添加</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lpush name han<br>(<span class="hljs-built_in">integer</span>) 1<br><span class="hljs-comment"># 在name中的han前面添加zhang</span><br>127.0.0.1:6379&gt; linsert name before han zhang<br>(<span class="hljs-built_in">integer</span>) 2<br><span class="hljs-comment"># 在name中的han后面添加zhe</span><br>127.0.0.1:6379&gt; linsert name after han zhe<br>(<span class="hljs-built_in">integer</span>) 3<br>127.0.0.1:6379&gt; lrange name 0 -1<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhe&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>修改指定下标的 value</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lrange name 0 -1<br>1) <span class="hljs-string">&quot;zhe&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhe&quot;</span><br><span class="hljs-comment"># 修改下标0的值为zhang</span><br>127.0.0.1:6379&gt; lset name 0 zhang<br>OK<br>127.0.0.1:6379&gt; lrange name 0 -1<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhe&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>移除首尾 pop，移除多个 lrem</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 移除左侧第一个，返回被移除的数据</span><br>127.0.0.1:6379&gt; lpop name<br><span class="hljs-string">&quot;zhang&quot;</span><br><span class="hljs-comment"># 移除右侧第一个，返回被移除的数据</span><br>127.0.0.1:6379&gt; rpop name<br><span class="hljs-string">&quot;zhe&quot;</span><br>127.0.0.1:6379&gt; lpush name one<br>(<span class="hljs-built_in">integer</span>) 4<br>127.0.0.1:6379&gt; rpush name one one<br>(<span class="hljs-built_in">integer</span>) 6<br><span class="hljs-comment"># 移除多个元素，仅支持从左侧移除，2数量，one为具体要移除的值，精确匹配，不支持通配符</span><br>127.0.0.1:6379&gt; lrem name 2 one<br>(<span class="hljs-built_in">integer</span>) 2<br></code></pre></td></tr></table></figure>
<blockquote>
<p>返回长度 llen</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lpush name han zhang<br>(<span class="hljs-built_in">integer</span>) 2<br>127.0.0.1:6379&gt; rpush name zhe<br>(<span class="hljs-built_in">integer</span>) 3<br><span class="hljs-comment"># 获取集合长度</span><br>127.0.0.1:6379&gt; llen name<br>(<span class="hljs-built_in">integer</span>) 3<br></code></pre></td></tr></table></figure>
<blockquote>
<p>获取指定下标的value</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lrange name 0 -1<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhe&quot;</span><br>127.0.0.1:6379&gt; lindex name 0<br><span class="hljs-string">&quot;zhang&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>截取列表 ltrim</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lrange list 0 -1<br>1) <span class="hljs-string">&quot;five&quot;</span><br>2) <span class="hljs-string">&quot;four&quot;</span><br>3) <span class="hljs-string">&quot;three&quot;</span><br>4) <span class="hljs-string">&quot;two&quot;</span><br>5) <span class="hljs-string">&quot;one&quot;</span><br><span class="hljs-comment"># 从下标1开始截取到2，会修改变量中的值</span><br>127.0.0.1:6379&gt; ltrim list 1 2<br>OK<br>127.0.0.1:6379&gt; lrange list 0 -1<br>1) <span class="hljs-string">&quot;four&quot;</span><br>2) <span class="hljs-string">&quot;three&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>获取排序结果 sort，不会影响本体，<code>字母排序/alpha</code>，<code>倒序排序/desc</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lpush num 10 30 20 40<br>(<span class="hljs-built_in">integer</span>) 4<br><span class="hljs-comment"># 默认从小到大</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">sort</span> num<br>1) <span class="hljs-string">&quot;10&quot;</span><br>2) <span class="hljs-string">&quot;20&quot;</span><br>3) <span class="hljs-string">&quot;30&quot;</span><br>4) <span class="hljs-string">&quot;40&quot;</span><br><span class="hljs-comment"># 可以从大到小</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">sort</span> num desc<br>1) <span class="hljs-string">&quot;40&quot;</span><br>2) <span class="hljs-string">&quot;30&quot;</span><br>3) <span class="hljs-string">&quot;20&quot;</span><br>4) <span class="hljs-string">&quot;10&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 字母排序</span><br>127.0.0.1:6379&gt; lpush En python java switch<br>(<span class="hljs-built_in">integer</span>) 3<br>127.0.0.1:6379&gt; <span class="hljs-built_in">sort</span> En alpha<br>1) <span class="hljs-string">&quot;java&quot;</span><br>2) <span class="hljs-string">&quot;python&quot;</span><br>3) <span class="hljs-string">&quot;switch&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>组合命令：移动元素</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; lrange name 0 -1<br>1) <span class="hljs-string">&quot;han&quot;</span><br>2) <span class="hljs-string">&quot;zhe&quot;</span><br>3) <span class="hljs-string">&quot;zhang&quot;</span><br><span class="hljs-comment"># 移除目标元素并添加到目标位置</span><br>127.0.0.1:6379&gt; rpoplpush name name<br><span class="hljs-string">&quot;zhang&quot;</span><br>127.0.0.1:6379&gt; lrange name 0 -1<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhe&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="Set-无序集合">Set 无序集合</h3>
<p>set 集合是 string 类型的 ==无序集合==，且==不允许存入重复数据==，如果重复存入相同的值会报错</p>
<p><em>还是老规矩，set 集合的命令特点，就是以 s 开头</em></p>
<blockquote>
<p>set 集合的 CRUD</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 添加 sadd</span><br>127.0.0.1:6379&gt; sadd code java<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; sadd code python switch<br>(<span class="hljs-built_in">integer</span>) 2<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看 smembers，这里就可以看出，set集合是无序的</span><br>127.0.0.1:6379&gt; smembers code<br>1) <span class="hljs-string">&quot;python&quot;</span><br>2) <span class="hljs-string">&quot;java&quot;</span><br>3) <span class="hljs-string">&quot;switch&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 删除元素</span><br>127.0.0.1:6379&gt; srem code switch<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看目标 set 集合长度 scard</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; scard code<br>(<span class="hljs-built_in">integer</span>) 3<br></code></pre></td></tr></table></figure>
<blockquote>
<p>检查 set 集合中是否包含指定的值 sismember，存在返回 1，不存在返回 0</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; sismember code java<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<blockquote>
<p>随机性的获取和移除</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; sadd num 1 2 3 4 5 6 7 8 9<br>(<span class="hljs-built_in">integer</span>) 9<br><span class="hljs-comment"># 随机获取一个值</span><br>127.0.0.1:6379&gt; srandmember num 1<br>1) <span class="hljs-string">&quot;7&quot;</span><br>127.0.0.1:6379&gt; srandmember num 1<br>1) <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-comment"># 随机移除一个值</span><br>127.0.0.1:6379&gt; spop num 1<br>1) <span class="hljs-string">&quot;2&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>获取多个集合中的 ==差集==，==交集==，==并集==</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 前置条件--拥有三个set集合</span><br>127.0.0.1:6379&gt; sadd key1 1 2 3 4<br>(<span class="hljs-built_in">integer</span>) 4<br>127.0.0.1:6379&gt; sadd key2 3 4 5 6<br>(<span class="hljs-built_in">integer</span>) 4<br>127.0.0.1:6379&gt; sadd key3 1 6 7 8<br>(<span class="hljs-built_in">integer</span>) 4<br></code></pre></td></tr></table></figure>
<p>差集 <code>sdiff</code>，取出两个集合中不同的元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 以第一个key为主，依次与每个key取差集</span><br>127.0.0.1:6379&gt; sdiff key1 key2<br>1) <span class="hljs-string">&quot;1&quot;</span><br>2) <span class="hljs-string">&quot;2&quot;</span><br>127.0.0.1:6379&gt; sdiff key1 key2 key3<br>1) <span class="hljs-string">&quot;2&quot;</span><br>127.0.0.1:6379&gt; sdiff key2 key1 key3<br>1) <span class="hljs-string">&quot;5&quot;</span><br></code></pre></td></tr></table></figure>
<p>交集 <code>sinter</code>，取出两个集合中相同的元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 以第一个key为主，依次与每个key取交集</span><br>127.0.0.1:6379&gt; sinter key1 key2<br>1) <span class="hljs-string">&quot;3&quot;</span><br>2) <span class="hljs-string">&quot;4&quot;</span><br>127.0.0.1:6379&gt; sinter key1 key3<br>1) <span class="hljs-string">&quot;1&quot;</span><br>127.0.0.1:6379&gt; sinter key1 key2 key3<br>(empty list or <span class="hljs-built_in">set</span>)<br></code></pre></td></tr></table></figure>
<p>并集 <code>sunion</code>，取出两个集合中所有的元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 以第一个key为主，依次与每个key取并集</span><br>127.0.0.1:6379&gt; sunion key1 key2<br>1) <span class="hljs-string">&quot;1&quot;</span><br>2) <span class="hljs-string">&quot;2&quot;</span><br>3) <span class="hljs-string">&quot;3&quot;</span><br>4) <span class="hljs-string">&quot;4&quot;</span><br>5) <span class="hljs-string">&quot;5&quot;</span><br>6) <span class="hljs-string">&quot;6&quot;</span><br>127.0.0.1:6379&gt; sunion key1 key2 key3<br>1) <span class="hljs-string">&quot;1&quot;</span><br>2) <span class="hljs-string">&quot;2&quot;</span><br>3) <span class="hljs-string">&quot;3&quot;</span><br>4) <span class="hljs-string">&quot;4&quot;</span><br>5) <span class="hljs-string">&quot;5&quot;</span><br>6) <span class="hljs-string">&quot;6&quot;</span><br>7) <span class="hljs-string">&quot;7&quot;</span><br>8) <span class="hljs-string">&quot;8&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="Hash-散列集合">Hash 散列集合</h3>
<p>hash 类型就像 map，是由一个个的 key-value 组成的对象，而且 ==key 不能重复==，<strong>存入相同的 key 和 value 后，最后一个存入的会覆盖之前存入的结果</strong></p>
<p><em>老规矩，几乎所有 hash 的指令都以 h 开头</em></p>
<blockquote>
<p>添加，批量添加，hash 没有修改，覆盖就是修改</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs hash">127.0.0.1:6379&gt; hset user name zhanghanzhe<br>(integer) 1<br>127.0.0.1:6379&gt; hmset user sex nan age 21<br>OK<br></code></pre></td></tr></table></figure>
<blockquote>
<p>获取，批量获取</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 通过key获取value</span><br>127.0.0.1:6379&gt; hget user name<br><span class="hljs-string">&quot;zhanghanzhe&quot;</span><br>127.0.0.1:6379&gt; hmget user name sex age<br>1) <span class="hljs-string">&quot;zhanghanzhe&quot;</span><br>2) <span class="hljs-string">&quot;nan&quot;</span><br>3) <span class="hljs-string">&quot;21&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 获取所有key</span><br>127.0.0.1:6379&gt; hkeys user<br>1) <span class="hljs-string">&quot;name&quot;</span><br>2) <span class="hljs-string">&quot;sex&quot;</span><br>3) <span class="hljs-string">&quot;age&quot;</span><br><span class="hljs-comment"># 获取所有value</span><br>127.0.0.1:6379&gt; hvals user<br>1) <span class="hljs-string">&quot;zhanghanzhe&quot;</span><br>2) <span class="hljs-string">&quot;nan&quot;</span><br>3) <span class="hljs-string">&quot;21&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 获取所有的key和value</span><br>127.0.0.1:6379&gt; hgetall user<br>1) <span class="hljs-string">&quot;name&quot;</span><br>2) <span class="hljs-string">&quot;zhanghanzhe&quot;</span><br>3) <span class="hljs-string">&quot;sex&quot;</span><br>4) <span class="hljs-string">&quot;nan&quot;</span><br>5) <span class="hljs-string">&quot;age&quot;</span><br>6) <span class="hljs-string">&quot;21&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>删除指令</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; hdel user name<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; hdel user sex age<br>(<span class="hljs-built_in">integer</span>) 2<br></code></pre></td></tr></table></figure>
<blockquote>
<p>自增和自减</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; hset map key1 5<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; hincrby map key1 2<br>(<span class="hljs-built_in">integer</span>) 7<br>127.0.0.1:6379&gt; hincrby map key1 -3<br>(<span class="hljs-built_in">integer</span>) 4<br></code></pre></td></tr></table></figure>
<blockquote>
<p>判断是否存在，存在返回 1，不存在返回 2</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; hexists map key1<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<h3 id="Zset-有序集合">Zset 有序集合</h3>
<p>zset 有序集合和 set 集合类似，都是不允许重复的值出现，只不过相比于 set 集合，zset 多了一个排序的功能，在添加值得时候需要给他一个 <code>分值</code>，<font color="red"><code>分值</code> 可以重复但 <code>value</code> 不允许重复</font>，默认按照分值从小到大排序</p>
<p><em>老规矩，几乎所有 zset 的指令都以 z开头</em></p>
<blockquote>
<p>添加元素 zadd，第一个是分值，第二个是 value</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; zadd user 1 zhang<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; zadd user 2 han 3 zhe<br>(<span class="hljs-built_in">integer</span>) 2<br></code></pre></td></tr></table></figure>
<blockquote>
<p>删除元素</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; zrem user zhang han zhe<br>(<span class="hljs-built_in">integer</span>) 3<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看集合</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 正常查看集合</span><br>127.0.0.1:6379&gt; zrange user 0 -1<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhe&quot;</span><br><span class="hljs-comment"># 倒序查看集合</span><br>127.0.0.1:6379&gt; zrevrange user 0 -1<br>1) <span class="hljs-string">&quot;zhe&quot;</span><br>2) <span class="hljs-string">&quot;han&quot;</span><br>3) <span class="hljs-string">&quot;zhang&quot;</span><br><span class="hljs-comment"># 查看带有分值的集合</span><br>127.0.0.1:6379&gt; zrange user 0 -1 withscores<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;1&quot;</span><br>3) <span class="hljs-string">&quot;han&quot;</span><br>4) <span class="hljs-string">&quot;2&quot;</span><br>5) <span class="hljs-string">&quot;zhe&quot;</span><br>6) <span class="hljs-string">&quot;3&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>获取集合内元素的数量 zcard zcount</p>
</blockquote>
<p>这里需要注意：==- inf 代表无穷小，+ inf 代表无穷大==</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; zadd user 10 zhang 12 wang 18 li 20 zhao 28 bai 30 guo<br>(<span class="hljs-built_in">integer</span>) 6<br><span class="hljs-comment"># 获取当前集合数量</span><br>127.0.0.1:6379&gt; zcard user<br>(<span class="hljs-built_in">integer</span>) 6<br><span class="hljs-comment"># 获取当前集合分值符合区间内的数量</span><br>127.0.0.1:6379&gt; zcount user -inf +inf<br>(<span class="hljs-built_in">integer</span>) 6<br>127.0.0.1:6379&gt; zcount user 10 20<br>(<span class="hljs-built_in">integer</span>) 4<br></code></pre></td></tr></table></figure>
<h2 id="三大特殊类型">三大特殊类型</h2>
<h3 id="地理位置">地理位置</h3>
<p><code>Geospatial</code> 类型用来存储有关经纬度的地理位置信息，默认经度第一位，维度第二位，redis 中针对经纬度的存储范围有一定的限制：</p>
<ul>
<li>经度有效范围：-180 ~ 180</li>
<li>维度有效范围：-85.05112878 ~ 85.05112878</li>
</ul>
<p><em>老规矩，几乎所有指令都是以 geo开头的</em></p>
<blockquote>
<p>添加地理位置信息 geoadd</p>
</blockquote>
<p>在添加经纬度的时候如果超出了范围会报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; geoadd point 126.64 45.75 hei<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; geoadd point 125.32 43.88 ji 123.42 41.79 liao<br>(<span class="hljs-built_in">integer</span>) 2<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看指定地区的经纬度 ( 已存入的 )，同理，添加也是修改</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; geopos point ji<br>1) 1) <span class="hljs-string">&quot;125.32000154256820679&quot;</span><br>   2) <span class="hljs-string">&quot;43.87999897829567431&quot;</span><br>127.0.0.1:6379&gt; geopos point hei ji liao<br>1) 1) <span class="hljs-string">&quot;126.64000242948532104&quot;</span><br>   2) <span class="hljs-string">&quot;45.74999965248261447&quot;</span><br>2) 1) <span class="hljs-string">&quot;125.32000154256820679&quot;</span><br>   2) <span class="hljs-string">&quot;43.87999897829567431&quot;</span><br>3) 1) <span class="hljs-string">&quot;123.41999977827072144&quot;</span><br>   2) <span class="hljs-string">&quot;41.78999971580505246&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>计算两地的距离 geodist</p>
</blockquote>
<p>使用 <code>geodist</code> 获取距离是通过经纬度计算出来的 <strong>直线距离</strong>，并不是路途距离，默认获取单位是米，可以通过制定后缀来设置获取的单位： <code>m/米</code>，<code>km/千米</code>，<code>mi英里</code>，<code>ft英尺</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 获取吉林到黑龙江的直线距离</span><br>127.0.0.1:6379&gt; geodist point hei ji<br><span class="hljs-string">&quot;232604.0065&quot;</span><br>127.0.0.1:6379&gt; geodist point hei ji km<br><span class="hljs-string">&quot;232.6040&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>雷达方式获取目标经纬度附近的地理位置 georadius</p>
</blockquote>
<p>雷达方式，以经纬度为中心，距离为半径按照圆形扫描，类似微信附近的人功能</p>
<p><code>withdist距离km</code>，<code>withdist经纬度</code>，<code>count 1 显示第一个符合要求的</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 返回经度125维度43附近300km的位置信息</span><br>127.0.0.1:6379&gt; georadius point 125 43 300 km<br>1) <span class="hljs-string">&quot;ji&quot;</span><br>2) <span class="hljs-string">&quot;liao&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 多要求获取</span><br>127.0.0.1:6379&gt; georadius point 125 43 300 km withdist withcoord count 1<br>1) 1) <span class="hljs-string">&quot;ji&quot;</span><br>   2) <span class="hljs-string">&quot;101.2331&quot;</span><br>   3) 1) <span class="hljs-string">&quot;125.32000154256820679&quot;</span><br>      2) <span class="hljs-string">&quot;43.87999897829567431&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用已存在的地理位置进行获取</span><br>127.0.0.1:6379&gt; georadiusbymember point ji 250 km<br>1) <span class="hljs-string">&quot;ji&quot;</span><br>2) <span class="hljs-string">&quot;hei&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>移除元素</p>
</blockquote>
<p><code>Geospatial</code> 类型比较特殊，他没有给咱们提供移除的指令，但是 <code>Geospatial</code> 的底层是基于 <code>zset</code> 实现的，我们可以通过 <code>zset</code> 来移除指定的 key 即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; zrange point 0 -1<br>1) <span class="hljs-string">&quot;liao&quot;</span><br>2) <span class="hljs-string">&quot;ji&quot;</span><br>3) <span class="hljs-string">&quot;hei&quot;</span><br>127.0.0.1:6379&gt; zrem point hei<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; geopos point hei<br>1) (nil)<br></code></pre></td></tr></table></figure>
<h3 id="基数统计">基数统计</h3>
<p><code>hyperloglog</code> 他是一种专门用来统计及基数的类型，当然其中的元素不允许重复，相比于 set 集合，例如计算网站访问量时，可以交给 <code>hyperloglog</code> 进行处理，他的内存占用是固定的 12KB。</p>
<p>但是因为他仅仅是计算基数的类型，所以并不能像 set 集合一样，获取到元素的具体的值，而且该类型有一定的误差，如果对精准度没有太大要求，那么推荐使用 <code>hyperloglog</code></p>
<p><em>老规矩，几乎所有指令都是以 pf开头的</em></p>
<blockquote>
<p>添加元素 pfadd</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; pfadd num1 1 2 3 4 5<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; pfadd num2 3 4 5 6 7<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看元素个数</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; pfcount num1<br>(<span class="hljs-built_in">integer</span>) 5<br></code></pre></td></tr></table></figure>
<blockquote>
<p>将两个集合合并为一个集合</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; pfmerge num3 num1 num2<br>OK<br>127.0.0.1:6379&gt; pfcount num3<br>(<span class="hljs-built_in">integer</span>) 7<br></code></pre></td></tr></table></figure>
<h3 id="进制存储">进制存储</h3>
<p><code>bitmap</code> 是基于二进制进行存储的，二进制只有 0 和 1 两个值，可以分别用来代表两种相对不同的状态，例如 打卡 &lt;=&gt; 未打卡，可以抽象的理解为 boolean 类型中的 true 和 false 的感觉。</p>
<p><em>命令几乎都以 bit 结尾</em></p>
<blockquote>
<p>添加元素 [ 0 代表未打卡，1 代表打卡 ]</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; setbit sign 0 1<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; setbit sign 1 1<br>(<span class="hljs-built_in">integer</span>) 0<br>127.0.0.1:6379&gt; setbit sign 2 0<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; setbit sign 3 1<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看某个状态 – 返回 1 代表打卡，0 代表未打卡</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; getbit sign 1<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<blockquote>
<p>查看多少人符合条件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; bitcount sign<br>(<span class="hljs-built_in">integer</span>) 3<br></code></pre></td></tr></table></figure>
<h2 id="Redis-的事务">Redis 的事务</h2>
<p>事务就是一组命令的集合，将平时多次执行的命令放在一起，然后按照命令顺序依次执行，而且执行过程中不会被干扰，事务执行结束后不会保留，也就意味着每次执行事务都需要重新创建，可得出 redis 事务的三个特点：<font color="red">顺序性</font>，<font color="red">排他性</font>，<font color="red">一次性</font>。</p>
<p>还有几点需要注意：==redis 的事务中，没有原子性和隔离性的概念，也不包含回滚==，所有命令在加入事务的时候，并没有直接执行，而是被放在了执行的队列中，也就不存在隔离性。</p>
<p>事务涉及到的关键字：<code>开启/multi</code>，<code>执行/exec</code>，<code>放弃/discard</code>，<code>监视/watch</code>，<code>关闭监视/unwatch</code></p>
<h3 id="使用事务">使用事务</h3>
<blockquote>
<p>事务的执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 当输入multi的时候就表示事务开始了，当使用exec的时候，就表示要执行了</span><br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> k1 v1<br>QUEUED<br>127.0.0.1:6379&gt; mset k2 v2 k3 v3<br>QUEUED<br>127.0.0.1:6379&gt; <span class="hljs-built_in">exec</span><br>1) OK<br>2) OK<br>127.0.0.1:6379&gt; mget k1 k2 k3<br>1) <span class="hljs-string">&quot;v1&quot;</span><br>2) <span class="hljs-string">&quot;v2&quot;</span><br>3) <span class="hljs-string">&quot;v3&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 当我事务添加中途，不想执行了，那么可以使用discard命令来放弃当前事务</span><br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> k1 zhang<br>QUEUED<br>127.0.0.1:6379&gt; discard<br>OK<br>127.0.0.1:6379&gt; get k1<br><span class="hljs-string">&quot;v1&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>事务的异常处理机制</p>
</blockquote>
<p>和 java 有点类似，redis 针对事务也分所谓的 <code>编译时异常</code> 和 <code>运行时异常</code>，只不过这里的 <code>编译时异常</code> 指的是命令是否正确，针对不同的异常，redis 事务处理的方式也不一致</p>
<ul>
<li>命令错误的处理方式</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 当我在执行命令的时候，命令输入有误，这时整个事务都不会执行</span><br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> user zhang<br>QUEUED<br>127.0.0.1:6379&gt; sett name hanzhe<br>(error) ERR unknown <span class="hljs-built_in">command</span> `sett`, with args beginning with: `name`, `hanzhe`, <br>127.0.0.1:6379&gt; <span class="hljs-built_in">exec</span><br>(error) EXECABORT Transaction discarded because of previous errors.<br><span class="hljs-comment"># 因为事务报错，所以user并没有存进去，哪怕他是第一条命令</span><br>127.0.0.1:6379&gt; get user<br>(nil)<br></code></pre></td></tr></table></figure>
<ul>
<li>逻辑错误的处理方式</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 自增的变量是字符而不是数字</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> money zhang<br>OK<br><span class="hljs-comment"># 然后我们再来执行事务</span><br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379&gt; incrby money 3000<br>QUEUED<br>127.0.0.1:6379&gt; decrby money 188<br>QUEUED<br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> user zhang<br>QUEUED<br>127.0.0.1:6379&gt; <span class="hljs-built_in">exec</span> <span class="hljs-comment"># 他会直接提示前两句执行失败，但是第三句执行成功</span><br>1) (error) ERR value is not an <span class="hljs-built_in">integer</span> or out of range<br>2) (error) ERR value is not an <span class="hljs-built_in">integer</span> or out of range<br>3) OK<br><span class="hljs-comment"># 这里也是可以获取到的，哪怕他是最后一条，不符合原子性</span><br>127.0.0.1:6379&gt; get user<br><span class="hljs-string">&quot;zhang&quot;</span><br></code></pre></td></tr></table></figure>
<p>因为 redis 的事务管理并不严格，所以 redis 的事务又被人戏称 <strong>伪事务</strong></p>
<h3 id="乐观锁">乐观锁</h3>
<p>在我们执行事务的时候，如果是处在多线程的环境下，我通过事务对某个数据进行改变，但是在我命令缓存完成还没有执行的时候，另一条线程进来对这个数据进行了修改，那么就会发生难以想象的改变。</p>
<blockquote>
<p>模拟举例说明：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 线程1 启动事务</span><br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379&gt; incrby money 3000<br>QUEUED<br>127.0.0.1:6379&gt; decrby money 188 <br>QUEUED<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 线程2 中途插入</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> money 200000<br>(<span class="hljs-built_in">integer</span>) 200100<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 线程1 这时刚刚提交事务</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">exec</span><br>1) (<span class="hljs-built_in">integer</span>) 203000<br>2) (<span class="hljs-built_in">integer</span>) 202812<br></code></pre></td></tr></table></figure>
<p>可以发现，在事务执行的过程中数据被改变了，结果也造成影响了</p>
<blockquote>
<p>什么是乐观锁？</p>
</blockquote>
<p>关于锁，有两个概念，一个是 <code>悲观锁</code>，还有一个是 <code>乐观锁</code>，悲观锁类似 java 中的多线程锁 <code>synchronized</code>，将整个方法上锁，无论是否有多条线程访问都会工作，在安全的前提下影响了性能，而 <code>乐观锁</code> 是在指令添加前将被操作的那个 key 监视起来，如果在执行的时候发现目标 key 发生了改变，那么就将当前事务取消不执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 线程1</span><br><span class="hljs-comment"># 在启动事务之前，监视目标key</span><br>127.0.0.1:6379&gt; watch money<br>OK<br><span class="hljs-comment"># 启动事务</span><br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379&gt; incrby money 3000<br>QUEUED<br>127.0.0.1:6379&gt; decrby money 188<br>QUEUED<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 线程2 中途插入</span><br>127.0.0.1:6379&gt; incrby money 200000<br>(<span class="hljs-built_in">integer</span>) 200100<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 线程1 这时刚刚提交事务</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">exec</span><br>(nil)<br></code></pre></td></tr></table></figure>
<p>可以发现，被监视的 key 发生改变后，事务执行就被中断了，那么之后应该如何处理呢？</p>
<blockquote>
<p>乐观锁善后</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.关闭当前事务</span><br>127.0.0.1:6379&gt; discard<br>OK<br><span class="hljs-comment"># 关闭监控</span><br>127.0.0.1:6379&gt; unwatch<br>OK<br><span class="hljs-comment">## 重新监控，再走一遍事务逻辑.....</span><br><span class="hljs-comment">## 在执行前在进行比对....</span><br></code></pre></td></tr></table></figure>
<h2 id="持久化保存策略">持久化保存策略</h2>
<p>我们都是到，redis 是操作内存的数据库，正因为这样的特点才让他的存取速度特别快，但是在内存中存放的数据，当我们重新启动服务器的时候就会丢失，这个时候就需要接触到 <code>持久化</code> 这个技术了，持久化就是把当前进程数据生成快照保存到硬盘的过程。</p>
<p>redis 的持久化操作分为两种，分别为 <code>RDB</code> 和 <code>AOF</code>，两种方式只能同时使用一种，redis 使用的 <strong>默认持久化方式为 RDB</strong>，</p>
<h3 id="RDB-方式">RDB 方式</h3>
<p>RDB ( Redis DataBase ) 持久方式，会单起一条线程，在指定的时间间隔内将内存中的数据以二进制形式写入、临时文件中，写入成功后默认存放到 redis 的安装目录下的 <code>dump.rdb</code> 文件中，如果你使用自己的配置启动的 redis，那么 <code>dump.rdb</code> 会和你的配置文件同级。</p>
<p>RDB 的持久化有两种触发机制，一种是手动命令持久化，一种是自动持久化。</p>
<blockquote>
<p>手动持久化 <code>save</code>，<code>bgsave</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; save<br>OK<br>127.0.0.1:6379&gt; bgsave<br>Background saving started<br></code></pre></td></tr></table></figure>
<ul>
<li><code>save</code> 命令会阻塞当前 redis 服务器，期间不能正常提供服务，这一现象直至数据保存完毕后恢复正常。</li>
<li><code>bgsave</code> 会执行 fork 子进程负责持久化操作，在创建子进程的时候会有短暂的阻塞，时间很短。</li>
</ul>
<p>除开这种主动的持久化之外，一些其他的命令也会完成持久化的操作，例如：<code>flushall</code>，<code>shutdown</code> 等等。</p>
<blockquote>
<p>自动持久化</p>
</blockquote>
<p>配置文件中的 SNAPSHOTTING 模块就是用来做 RDB 持久化的，里面有这样几句配置命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">################################ SNAPSHOTTING  ################################ 快照</span><br><span class="hljs-comment"># save 时间/s 数据修改次数</span><br><span class="hljs-comment"># 例如 save 900 1，如果数据只修改了一次，那么就900秒持久化一次</span><br>save 900 1<br>save 300 10<br>save 60 10000<br><span class="hljs-comment"># 当RDB最后一次保存失败后，是否停止接受数据，默认yes (否则没人知道它坏了)</span><br>stop-writes-on-bgsave-error <span class="hljs-built_in">yes</span><br><span class="hljs-comment"># 是否以压缩形式保存，默认为yes</span><br>rdbcompression <span class="hljs-built_in">yes</span><br><span class="hljs-comment"># 是否效验数据完整性，默认为yes</span><br>rdbchecksum <span class="hljs-built_in">yes</span><br><span class="hljs-comment"># 持久化保存文件名</span><br>dbfilename dump.rdb<br><span class="hljs-comment"># 持久化文件保存路径</span><br><span class="hljs-built_in">dir</span> ./<br></code></pre></td></tr></table></figure>
<p>一般我们不需要该他的配置文件，预设的就够用了。</p>
<h3 id="AOF-方式">#####AOF 方式#####</h3>
<p>同样还是在配置文件中，APPEND ONLY MODE 模块就是负责 AOF 持久化的，和 RDB 不同， AOF 的原理是将所有曾经使用过的存入操作的命令都记录下来，存放到 <code>appendonly.aof</code> 文件中，是可以看个模糊的大概的。</p>
<blockquote>
<p>AOF 持久化配置</p>
</blockquote>
<p>AOF 也可以手动触发，只需要执行 <code>bgrewriteaof</code> 命令即可，但是一般都用配置文件管理，配置信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">############################## APPEND ONLY MODE ############################### 仅附加模式</span><br><span class="hljs-comment"># 是否开启AOF，默认为no</span><br>appendonly no<br><span class="hljs-comment"># 指定更新条件，可以选择三个值：</span><br> <span class="hljs-comment"># no：每次修改都同步，数据完整性强，性能偏低</span><br> <span class="hljs-comment"># always：每秒同步一次，数据完整性较好</span><br> <span class="hljs-comment"># everysec：让操作系统自己同步数据，消耗资源最低</span><br>appendfsync everysec<br><span class="hljs-comment"># 百分比，如果数据文件大小占据了指定百分比，会触发重写。</span><br>auto-aof-rewrite-percentage 100<br><span class="hljs-comment"># 必须满足最小大小才可以重写</span><br>auto-aof-rewrite-min-size 64mb<br></code></pre></td></tr></table></figure>
<blockquote>
<p>AOF 重写</p>
</blockquote>
<ul>
<li>##########################################################################</li>
</ul>
<p>有关于持久化策略，以后再细学</p>
<h3 id="比较RDB和AOF">比较RDB和AOF</h3>
<p><code>RDB</code>：RDB 是二进制文件，按照时间进行数据同步，每次同步都会执行 fork 操作，如果为了追求数据数据完整性不停的同步，会极大的影响 redis 工作效率，更==适合做定期备份，用于灾难恢复==</p>
<p><code>AOF</code>：AOF 通过记录命令实现持久化，通过控制参数可以精确到秒级。</p>
<ul>
<li>##########################################################################</li>
</ul>
<p>有关于持久化策略，以后再细学</p>
<h3 id="文件损坏修复">文件损坏修复</h3>
<p>当我们的数据文件损坏导致 redis 无法启动的时候，我们可以尝试运行 redis 的修复工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">redis-check-aof --fix 配置文件<br>redis-check-rdb --fix 配置文件<br></code></pre></td></tr></table></figure>
<ul>
<li>##########################################################################</li>
</ul>
<p>有关于持久化策略，以后再细学</p>
<h2 id="Redis-整合">Redis 整合</h2>
<p>所有程序均是以 maven 为基础搭建的</p>
<h3 id="原生-Java-整合">原生 Java 整合</h3>
<p>使用 java 项目整合 redis 进行操作，首先要添加 maven 依赖</p>
<blockquote>
<p>正常操作 redis</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>添加依赖完成后，便可以直接通过 java 代码创建连接并操作数据库了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 创建连接</span><br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">redis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;IP地址&quot;</span>, <span class="hljs-number">6379</span>);<br>        <span class="hljs-comment">// 验证连接密码</span><br>        redis.auth(<span class="hljs-string">&quot;你的密码&quot;</span>);<br>        <span class="hljs-comment">// 清空当前数据库</span><br>        redis.flushDB();<br>        <span class="hljs-comment">// 正常的增删改查</span><br>        System.out.println(redis.ping());<br>        System.out.println(redis.set(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;zhang&quot;</span>));<br>        System.out.println(redis.get(<span class="hljs-string">&quot;user&quot;</span>));<br>        <span class="hljs-comment">// 关闭连接</span><br>        redis.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>直接创建 jedis 对象就可以创建远程连接，而且实例内的方法和 redis 的指令用法等等几乎一模一样，非常好用。</p>
<blockquote>
<p>redis 连接池</p>
</blockquote>
<p>一般来说 jedis 已经可以很好的操作 redis 数据库了，但是在项目中如果频繁的创建和关闭连接，是很耗费服务器资源的，所以这里可以使用 jedis 的连接池进行操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 使用默认的连接池操作</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisPoolDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 创建jedis连接池对象</span><br>        <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(<span class="hljs-string">&quot;IP地址&quot;</span>, <span class="hljs-number">6379</span>);<br>        <span class="hljs-comment">//  从连接池中获取连接</span><br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">redis</span> <span class="hljs-operator">=</span> pool.getResource();<br>        <span class="hljs-comment">// 正常操作jedis</span><br>        redis.auth(<span class="hljs-string">&quot;密码&quot;</span>);<br>        redis.set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;hanzhe&quot;</span>);<br>        System.out.println(redis.get(<span class="hljs-string">&quot;name&quot;</span>));<br>        <span class="hljs-comment">// 关闭连接</span><br>        redis.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 使用自定义配置的连接池</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisPoolDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 创建连接池配置对象</span><br>        <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">poolConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();<br>        <span class="hljs-comment">// 设置最大连接数</span><br>        poolConfig.setMaxTotal(<span class="hljs-number">50</span>);<br>        <span class="hljs-comment">// 设置最大空闲连接数</span><br>        poolConfig.setMaxIdle(<span class="hljs-number">10</span>);<br>        <span class="hljs-comment">// 按照指定的配置创建连接</span><br>        <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(poolConfig, <span class="hljs-string">&quot;IP地址&quot;</span>, <span class="hljs-number">6379</span>);<br>        <span class="hljs-comment">// 获取连接后面的操作就是一样的了</span><br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">redis</span> <span class="hljs-operator">=</span> pool.getResource();<br>        <span class="hljs-comment">// ........</span><br>        <span class="hljs-comment">// 关闭连接</span><br>        redis.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>检查 redis 数据库</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;name&quot;</span><br>2) <span class="hljs-string">&quot;user&quot;</span><br>127.0.0.1:6379&gt; mget user name<br>1) <span class="hljs-string">&quot;zhang&quot;</span><br>2) <span class="hljs-string">&quot;hanzhe&quot;</span><br>127.0.0.1:6379&gt; <br></code></pre></td></tr></table></figure>
<p>经过检查发现，java 操作 redis 不存在其他的问题，整合基本完成。</p>
<blockquote>
<p>控制台打印警告问题</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">SLF4J: Failed to load class <span class="hljs-string">&quot;org.slf4j.impl.StaticLoggerBinder&quot;</span>.<br>SLF4J: Defaulting to no-operation (NOP) logger implementation<br>SLF4J: See http://www.slf4j.org/codes.html<span class="hljs-comment">#StaticLoggerBinder for further details.</span><br></code></pre></td></tr></table></figure>
<p>如果控制台打印如上的警报信息，可以引入 slf4j 的 maven 依赖进行解决</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="Springboot-整合">Springboot 整合</h3>
<p>springboot 整合同样需要引入对应的 maven 依赖，和 jedis 有些许的不同，springboot 中封装的类并不可以直接调用类似命令的函数，而是对他们进行了二次封装</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>修改配置文件</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># IP地址</span><br><span class="hljs-attr">spring.redis.host</span>=<span class="hljs-string">IP地址</span><br><span class="hljs-comment"># 端口</span><br><span class="hljs-attr">spring.redis.port</span>=<span class="hljs-string">6379</span><br><span class="hljs-comment"># 访问密码</span><br><span class="hljs-attr">spring.redis.password</span>=<span class="hljs-string">密码</span><br><span class="hljs-comment"># 最大连接数</span><br><span class="hljs-attr">spring.redis.pool.max-active</span>=<span class="hljs-string">50</span><br><span class="hljs-comment"># 最大空闲连接数</span><br><span class="hljs-attr">spring.redis.pool.max-idle</span>=<span class="hljs-string">10</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>简单操作数据库</p>
</blockquote>
<p>操作数据库，需要注入 <code>RedisTemplate</code> 对象进行操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Redis2SpringbootApplicationTests</span> &#123;<br>    <span class="hljs-comment">// 自动注入对象</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;zhang&quot;</span>);<br>        <span class="hljs-comment">// 可以正常读取存入的 user 信息</span><br>        System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;user&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>RedisTemplate</code> 将数据类型对应的指令函数分别命名为 <code>opsForValue()</code>，<code>opsForList()</code>，<code>opsForSet()</code>，<code>opsForHash()</code>，<code>opsForHyperLogLog()</code> ，<code>opsForZSet()</code></p>
<blockquote>
<p>高级操作数据库</p>
</blockquote>
<p>上面的方法封装了各种数据类型的简单操作，接下来就是一些高级的操作了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Redis2SpringbootApplicationTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 获取当前连接</span><br>        <span class="hljs-type">RedisConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> redisTemplate.getConnectionFactory();<br>        <span class="hljs-type">RedisConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.getConnection();<br>        <span class="hljs-comment">// ping测试，清空库，停止服务，关闭连接等等高级操作</span><br>        System.out.println(connection.ping());<br>        connection.flushDb();<br>        connection.flushAll();<br>        connection.shutdown();<br>        connection.close();<br>        <span class="hljs-comment">// 开启事务等等相关设置也在这里</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>乱码问题</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Java 代码</span><br>redisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;zhang&quot;</span>);<br>System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>));<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># redis 数据库</span><br>127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;\xac\xed\x00\x05t\x00\x04name&quot;</span><br></code></pre></td></tr></table></figure>
<p>我们通过 springboot 向 redis 中插入一个字符串，发现存进去的字符串存在乱码问题，这时候我们可以通过使用 <code>RedisTemplate</code> 的子类 <code>StringRedisTemplate</code> 进行操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Redis2SpringbootApplicationTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate string;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        string.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;zhang&quot;</span>);<br>        System.out.println(string.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># name 也可以正常存取</span><br>127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;name&quot;</span><br>2) <span class="hljs-string">&quot;\xac\xed\x00\x05t\x00\x04name&quot;</span><br>127.0.0.1:6379&gt; get name<br><span class="hljs-string">&quot;zhang&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>自定义 RedisTemplate</p>
</blockquote>
<p>字符串可以通过 <code>StringRedisTemplate</code> 来解决问题，但是存入其他类型的还是会出现问题，这时可自己创建一个 <code>RedisTemplate</code> 来代替原本的类工作。<em>代码来自互联网</em></p>
<p>1.首先要引入 maven 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>2.创建配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUtil</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> &#123;<br>        RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>();<br>        template.setConnectionFactory(factory);<br>        <span class="hljs-type">Jackson2JsonRedisSerializer</span> <span class="hljs-variable">jackson2JsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>(Object.class);<br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">om</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>        jackson2JsonRedisSerializer.setObjectMapper(om);<br>        <span class="hljs-type">StringRedisSerializer</span> <span class="hljs-variable">stringRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>        <span class="hljs-comment">// key采用String的序列化方式</span><br>        template.setKeySerializer(stringRedisSerializer);<br>        <span class="hljs-comment">// hash的key也采用String的序列化方式</span><br>        template.setHashKeySerializer(stringRedisSerializer);<br>        <span class="hljs-comment">// value序列化方式采用jackson</span><br>        template.setValueSerializer(jackson2JsonRedisSerializer);<br>        <span class="hljs-comment">// hash的value序列化方式采用jackson</span><br>        template.setHashValueSerializer(jackson2JsonRedisSerializer);<br>        template.afterPropertiesSet();<br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这个时候自定义的  就已经完成了，现在再来测试一遍是否乱码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Redis2SpringbootApplicationTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;zhang&quot;</span>);<br>        System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 乱码问题已经解决，这个特殊符号是字符串的转义</span><br>127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;name&quot;</span><br>127.0.0.1:6379&gt; get name<br><span class="hljs-string">&quot;\&quot;zhang\&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>通过序列化将对象存储到 redis 中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// implements Serializable 序列化接口一定要实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-comment">/* 省略get-set-toString方法 */</span><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Redis2SpringbootApplicationTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        p.setUsername(<span class="hljs-string">&quot;张涵哲&quot;</span>);<br>        p.setPassword(<span class="hljs-string">&quot;zhang&quot;</span>);<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;user&quot;</span>, p);<br>        System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;user&quot;</span>));<br>    &#125;<br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> 可以正常读取</span><br><span class="hljs-comment"> Person&#123;username=&#x27;张涵哲&#x27;, password=&#x27;zhang&#x27;&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>
<h2 id="订阅与发布">订阅与发布</h2>
<p>redis 的订阅发布是一种通讯模式，分别为 <code>发送者/sub</code> 和 <code>订阅者/pub</code> 两种身份，发布者负责发送一些信息，然后由订阅者接收，涉及到的命令也非常少</p>
<blockquote>
<p>最常用：简单使用订阅和发布完成交互 <code>subscribe</code>，<code>publish</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 订阅者 当我订阅s1频道的时候，命令行就会被锁定，静等s1频道发送信息</span><br>127.0.0.1:6379&gt; subscribe s1<br>Reading messages... (press Ctrl-C to quit)<br>1) <span class="hljs-string">&quot;subscribe&quot;</span><br>2) <span class="hljs-string">&quot;s1&quot;</span><br>3) (<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 发布者 只需要在固定的频道发送消息即可，不用考虑订阅者状态</span><br>127.0.0.1:6379&gt; publish s1 haha<br>(<span class="hljs-built_in">integer</span>) 1<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 订阅者 命令行状态发生改变：</span><br>1) <span class="hljs-string">&quot;message&quot;</span>  <span class="hljs-comment"># 提示接受到了消息</span><br>2) <span class="hljs-string">&quot;s1&quot;</span>     <span class="hljs-comment"># 如果订阅了多个，在这里区分发布者频道</span><br>3) <span class="hljs-string">&quot;haha&quot;</span>    <span class="hljs-comment"># 频道发送的消息</span><br></code></pre></td></tr></table></figure>
<h2 id="主从复制">主从复制</h2>
<p>在我们的项目越做越大的情况下，一个 redis 服务可能已经不支持我们的读写效率了，这个时候我们需要配置多个服务器，在每个服务器上都配置 redis 的环境，让他们分别为一个程序提供服务，这种工作方式被称之为集群</p>
<p>在多个服务器中选中一台服务器为主机 ( Master )，其他为从机 ( Slave )，主机负责写入数据 ( set… )，而从机负责读取数据 ( get )，为了多个服务器之间数据同步的问题，所以有了主从复制的技术。</p>
<p>这里可以通过复制多个配置文件，修改端口号来实现 <code>伪集群</code>，设置 6379 为主机，6380 为从机，后面简称为 79 和 80</p>
<h3 id="通过命令实现">通过命令实现</h3>
<p>选择 79 为主机，连接主机输入 <code>info replication</code> 命令即可查看当前机器配置状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; info replication<br><span class="hljs-comment"># Replication</span><br>role:master<br>connected_slaves:0<br>master_replid:49e04dfecc70d4b55f17798d80b1d77ac4289c12<br>master_replid2:0000000000000000000000000000000000000000<br>master_repl_offset:0<br>second_repl_offset:-1<br>repl_backlog_active:0<br>repl_backlog_size:1048576<br>repl_backlog_first_byte_offset:0<br>repl_backlog_histlen:0<br></code></pre></td></tr></table></figure>
<p>第二行位置显示 role:master，代表当前端口是主机，==redis 默认每台机器都是主机==，配置主从复制只需要配置从机就可以了。</p>
<p>配置从机 <code>slaveof</code> 认主，只需要找到目标 Redis 服务器作为自己的主人就可以了，这样一来从机就可以获取到主机的数据了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 80，81 端口</span><br>127.0.0.1:6380&gt; slaveof localhost 6379<br>OK<br>127.0.0.1:6380&gt; info replication<br><span class="hljs-comment"># Replication</span><br>role:slave<br>master_host:127.0.0.1<br>master_port:6379<br>master_link_status:up<br>master_last_io_seconds_ago:7<br>master_sync_in_progress:0<br>slave_repl_offset:434<br>slave_priority:100<br>slave_read_only:1<br>connected_slaves:0<br>master_replid:5ec4f58da9447b03e682d76edb61cbf5e4cf89a2<br>master_replid2:0000000000000000000000000000000000000000<br>master_repl_offset:434<br>second_repl_offset:-1<br>repl_backlog_active:1<br>repl_backlog_size:1048576<br>repl_backlog_first_byte_offset:1<br>repl_backlog_histlen:434<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="category-chain-item">中间件</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Redis/" class="print-no-link">#Redis</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Redis 笔记</div>
      <div>http://example.com/2022/10/19/Redis笔记/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Shi_Kang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>October 19, 2022</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/11/13/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/vue%E7%AC%94%E8%AE%B0/" title="Vue 笔记">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Vue 笔记</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/21/Spring%E7%AC%94%E8%AE%B0/" title="Spring 笔记">
                        <span class="hidden-mobile">Spring 笔记</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'gusheng2000/gusheng2000.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'Comment');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>skr</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
